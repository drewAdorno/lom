System.register("chunks:///_virtual/SurveyInfoView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./ObjectUtil.ts","./HttpClient.ts","./MessageView.ts","./SurveyControl.ts","./BaseView.ts"],(function(t){"use strict";var i,e,n,o,s,r,h,a,d,u,c,l,f,v,m,p,g,C,w,I,x,G,q;return{setters:[function(t){i=t.inheritsLoose,e=t.createForOfIteratorHelperLoose},function(t){n=t.cclegacy,o=t.Button,s=t.Label,r=t.ScrollView,h=t.UITransform,a=t.Vec2,d=t.isValid,u=t.js,c=t.Widget,l=t.Toggle,f=t.EditBox},function(t){v=t.ItemGrid},function(t){m=t.ListItem},function(t){p=t.default},function(t){g=t.default},function(t){C=t.default},null,function(t){w=t.default},function(t){I=t.HttpClient},function(t){x=t.default},function(t){G=t.default},function(t){q=t.BaseView}],execute:function(){n._RF.push({},"5cb47lMDqtMBqD1lBbvGnXY","SurveyInfoView",void 0);var L=["radio","checkbox","matrix-radio","matrix-checkbox","select","input"],y=(t("default",function(t){function n(){var i;return(i=t.call(this)||this).viewGo=void 0,i.scrollGo=void 0,i.contentGo=void 0,i.nodeTime=void 0,i.txtTitle=void 0,i.txtTime=void 0,i.scrollReward=void 0,i.commitGo=void 0,i.questionInfo=void 0,i.questionGoList=[],i.ItemMaker={},i.questionItems={},i.questionItemList=[],i.linkQuestion=[],i.questionLink=[],i.selectedLink={},i.totalNum=0,i.questionVersion=void 0,i.isLoadComplete=void 0,i.startTime=0,i.deltaTime=0,i.leftTime=0,i.canUpdate=!1,i.name="SurveyInfoView",i.url="ui/module/survey/SurveyInfoView",i}i(n,t);var u=n.prototype;return u.onInit=function(){var t=this,i=this.findChild("btnClose");this.addComponentCallbackListener(i,o.EventType.CLICK,(function(){t.close()})),this.viewGo=this.findChild("view"),this.scrollGo=this.findChild("view/scroll"),this.contentGo=this.findChild("view/scroll/view/content");for(var e=1;e<=6;e++){var n=this.findChild("view/question/question"+e);n&&(n.active=!1,this.questionGoList[e]=n)}this.ItemMaker={1:T,2:S,3:k,4:b,6:Q},this.txtTitle=p.findChildComponent(this.contentGo,"title/title/Label",s),this.nodeTime=p.findChild(this.contentGo,"title/nodeTime"),this.txtTime=p.findChildComponent(this.contentGo,"title/nodeTime/txtTime",s);var d=p.findChildComponent(this.contentGo,"title/rewardScroll",r);this.scrollReward=this.addUIList(d,y),this.commitGo=this.findChild("view/commit");var u=this.findChild("view/commit/btncommit");this.addComponentCallbackListener(u,o.EventType.CLICK,(function(){if(t.questionInfo&&t.isLoadComplete){for(var i=[],e=298,n=0;n<t.questionItemList.length;n++){var o=t.questionItemList[n],s=o.getAnswerInfo(),d=s.info,u=s.isHide;if(d)e=e+o.getItemSize().y+20,i.push(d);else if(!u){if(x.showFlyTip(GetLanguage(300067)),e<t.contentGo.getComponent(h).contentSize.height-t.scrollGo.getComponent(h).contentSize.height){var c=t.scrollGo.getComponent(r);c.scrollToOffset(new a(c.getScrollOffset().x,e),.2)}return}}var l=C.serverTime-t.startTime;IS(G).commitResult(t.questionInfo,l,i,t.questionVersion),IS(G).reqReward(t.questionInfo.ques_id,1),t.close()}}))},u.registerUpdateHandler=function(){},u.onAfterOpen=function(){this.questionInfo=this.openArgs[0],this.questionInfo?this.updateQuestionInfo():this.close()},u.onBeforeClose=function(){this.removeAllQuestion(),this.questionInfo=null,this.canUpdate=!1,this.isLoadComplete=!1},u.onDestroy=function(){},u.onUpdate=function(t){this.canUpdate&&(this.deltaTime=this.deltaTime+t,this.deltaTime>=1&&(this.deltaTime=0,this.leftTime=this.leftTime-1,this.leftTime>0?this.txtTime.string=C.formatTimeStringForSecond(this.leftTime):(this.txtTime.string=C.formatTimeStringForSecond(0),this.canUpdate=!1)))},u.updateQuestionInfo=function(){var t,i,e=this;this.isLoadComplete=!1,this.startTime=C.serverTime,0==this.questionInfo.ques_type?this.nodeTime.active=!1:(this.nodeTime.active=!0,this.leftTime=this.questionInfo.end_time-C.serverTime,this.txtTime.string=C.formatTimeStringForSecond(this.leftTime),this.canUpdate=!0),this.txtTitle.string=this.questionInfo.title,this.scrollReward.datas=null!=(t=this.questionInfo.resource_list)?t:[],this.removeAllQuestion(),i=this.questionInfo.file_name,I.requestUrl(i,!1,(function(t){if(d(e.contentGo)){var i=JSON.parse(t),n=i.questionAndOptions;e.totalNum=n.length;for(var o=0;o<e.totalNum;o++)e.addQuestion(n[o]);e.commitGo.setParent(e.contentGo),e.questionVersion=i.version,e.isLoadComplete=!0}}))},u.sortOptions=function(t){var i=[];for(var e in t){if(t.hasOwnProperty(e))"1"==t[e].isOrder&&i.push(e)}if(i.length<=1)return t;var n=w.copyArray(i);w.shuffle(n);var o=[],s=0,r=i[s];for(var h in t)if(t.hasOwnProperty(h)){var a=t[h];if(null==r||h<r)o[h]=a;else if(h==r){var d=n[s];o[h]=t[d],r=i[s+=1]}}return o},u.addQuestion=function(t){t.options=w.objectToArray(t.options);var i=L.indexOf(t.type),n=t.questionId;if(t.options&&"1"==t.outOrder&&(t.options=this.sortOptions(t.options)),i>=0){var o=this.ItemMaker[i+1];if(o){var s=this.questionItems[n];if(!s){var r=this.questionGoList[i+1],h=nodeInstantiate.instantiate(r);if(t.link&&Array.isArray(t.link)&&t.link.length>0){for(var a,d=e(t.link);!(a=d()).done;){var u=a.value;this.linkQuestion[u]=n,this.questionLink[n]||(this.questionLink[n]=[]),this.questionLink[n].push(u)}h.active=!1}else h.active=!0;h.setParent(this.contentGo),(s=new o).init(h,this),this.questionItems[n]=s,this.questionItemList.push(s)}s.setData(t)}}},u.removeAllQuestion=function(){for(var t in this.commitGo.setParent(this.viewGo),this.questionItems){if(this.questionItems.hasOwnProperty(t))this.questionItems[t].remove()}this.questionItems={},this.questionItemList=[],this.linkQuestion=[],this.questionLink=[],this.selectedLink={}},u.checkLink=function(t,i){var n=this.linkQuestion[t],o=this.questionItems[n];if(o)if(i)o.setActive(!0),this.selectedLink[t]=!0;else{this.selectedLink[t]=!1;var s=this.questionLink[n],r=!1;if(s&&s.length>0)for(var h,a=e(s);!(h=a()).done;){var d=h.value;if(this.selectedLink[d]){r=!0;break}}r||o.setActive(!1)}},n}(q)),function(t){function e(){for(var i,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(i=t.call.apply(t,[this].concat(n))||this).itemGridNode=void 0,i.itemGrid=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){this.itemGridNode=p.findChild(this.node,"itemGrid"),this.itemGrid=new v(this.view,this.itemGridNode)},n.onRender=function(t,i){this.itemGrid.SetItemId(t.gtid,t.num)},e}(m)),T=function(){function t(){this.view=void 0,this.node=void 0,this.data=void 0,this.txtQuestion=void 0,this.answerGo=void 0,this.answerItemGo=void 0,this.input=void 0,this.toggleList=[]}var i=t.prototype;return i.init=function(t,i){this.view=i,this.node=t,this.onInit()},i.onInit=function(){this.txtQuestion=p.findChildComponent(this.node,"txtQuestion",s),this.answerGo=p.findChild(this.node,"answer"),this.answerItemGo=p.findChild(this.node,"answer/answer"),this.answerItemGo.active=!1},i.setData=function(t){var i=this;this.data=t,this.txtQuestion.string=u.formatStr("%s/%s. %s",t.number,this.view.totalNum,t.questionName);for(var e=t.options.length,n=function(e){var n=t.options[e],o=nodeInstantiate.instantiate(i.answerItemGo);o.setParent(i.answerGo),o.active=!0;var r=o.getComponent(l),h=t.number+"_"+(e+1),a=p.findChild(o,"input");a.active=!1,i.input=p.findChildComponent(o,"input/input",f),i.view.addComponentCallbackListener(r.node,l.EventType.TOGGLE,(function(){i.view.checkLink(h,r.isChecked),n.other&&(a.active=r.isChecked)})),p.findChildComponent(o,"txtOption",s).string=n.text,i.toggleList.push(r)},o=0;o<e;o++)n(o);var r=90+e*this.answerGo.getComponent(h).height+50;this.node.getComponent(h).height=r},i.getAnswerInfo=function(){var t,i=null,e=!0;if(!this.node.active)return{info:i,isHide:e};e=!1;for(var n="",o="",s=0;s<this.toggleList.length;s++)if(this.toggleList[s].isChecked){n=(t=this.data.options[s]).key,t.other&&(o=this.input.string);break}return"1"!=this.data.required||t?{info:i={questionId:this.data.questionId,number:this.data.number,type:this.data.type,value:n,text:o},isHide:e}:{info:i,isHide:e}},i.setActive=function(t){this.node.active!=t&&(this.node.active=t)},i.getItemSize=function(){return this.node.getComponent(h).contentSize},i.remove=function(){this.node.destroy()},t}(),S=function(){function t(){this.view=void 0,this.node=void 0,this.data=void 0,this.txtQuestion=void 0,this.txtDesc=void 0,this.answerGo=void 0,this.answerItemGo=void 0,this.input=void 0,this.toggleList=[],this.selectNum=0,this.selectList=[]}var i=t.prototype;return i.init=function(t,i){this.view=i,this.node=t,this.onInit()},i.onInit=function(){this.txtQuestion=p.findChildComponent(this.node,"txtQuestion",s),this.txtDesc=p.findChildComponent(this.node,"txtDesc",s),this.answerGo=p.findChild(this.node,"answer"),this.answerItemGo=p.findChild(this.node,"answer/answer"),this.answerItemGo.active=!1},i.setData=function(t){var i=this;this.data=t,this.txtQuestion.string=u.formatStr("%s/%s. %s",t.number,this.view.totalNum,t.questionName);var e=0;t.maxChoice&&t.maxChoice>0?(this.txtDesc.string=g.formatStrWithMirrorDeal(GetLanguage(300068),t.minChoice,t.maxChoice),e=120):(this.txtDesc.string="",e=90),this.answerGo.getComponent(c).top=e;for(var n=t.options.length,o=function(e){var n=t.options[e],o=nodeInstantiate.instantiate(i.answerItemGo);o.setParent(i.answerGo),o.active=!0;var r=p.findChildComponent(o,"Toggle",l),h=t.number+"_"+(e+1),a=p.findChild(o,"input");a.active=!1,i.input=p.findChildComponent(o,"input/input",f),i.view.addComponentCallbackListener(r.node,l.EventType.TOGGLE,(function(){var o=i.selectList[e],s=r.isChecked;if(s!=o&&(s||null!=o)){var d=!0;t.maxChoice&&t.maxChoice>0&&(s?i.selectNum>=t.maxChoice?(d=!1,r.isChecked=!1,i.selectList[e]=!1,x.showFlyTip(g.formatStrWithMirrorDeal(GetLanguage(300069),t.maxChoice))):(i.selectNum=i.selectNum+1,i.selectList[e]=!0):(i.selectNum=i.selectNum-1,i.selectList[e]=!1)),d&&i.view.checkLink(h,s),n.other&&(a.active=r.isChecked)}})),p.findChildComponent(o,"txtOption",s).string=n.text,i.toggleList.push(r)},r=0;r<n;r++)o(r);var a=e+n*this.answerGo.getComponent(h).height+50;this.node.getComponent(h).height=a},i.getAnswerInfo=function(){var t,i=null,e=!0;if(!this.node.active)return{info:i,isHide:e};e=!1;for(var n="",o="",s=0;s<this.toggleList.length;s++)this.toggleList[s].isChecked&&(n+=(t=this.data.options[s]).key,t.other&&(o=this.input.string));return"1"==this.data.required&&""==n?{info:i,isHide:e}:{info:i={questionId:this.data.questionId,number:this.data.number,type:this.data.type,value:n,text:o},isHide:e}},i.setActive=function(t){this.node.active!=t&&(this.node.active=t)},i.getItemSize=function(){return this.node.getComponent(h).contentSize},i.remove=function(){this.node.destroy()},t}(),k=function(){function t(){this.view=void 0,this.node=void 0,this.data=void 0,this.txtQuestion=void 0,this.answerGo=void 0,this.answerItemGo=void 0,this.txtScores=[],this.toggleList=[]}var i=t.prototype;return i.init=function(t,i){this.view=i,this.node=t,this.onInit()},i.onInit=function(){this.txtQuestion=p.findChildComponent(this.node,"txtQuestion",s);for(var t=1;t<=5;t++){var i=p.findChild(this.node,"score/score"+t),e=p.findChildComponent(this.node,"score/score"+t+"/Label",s);this.txtScores.push({node:i,txt:e})}this.answerGo=p.findChild(this.node,"answer"),this.answerItemGo=p.findChild(this.node,"answer/answer"),this.answerItemGo.active=!1},i.setData=function(t){this.data=t,this.txtQuestion.string=u.formatStr("%s/%s. %s",t.number,this.view.totalNum,t.questionName);for(var i=0;i<this.txtScores.length;i++){var e;(null==(e=t.header[i])?void 0:e.text)?(this.txtScores[i].node.active=!0,this.txtScores[i].txt.string=t.header[i].text):this.txtScores[i].node.active=!1}for(var n=t.options.length,o=0;o<n;o++){var r=t.options[o],a=nodeInstantiate.instantiate(this.answerItemGo);a.setParent(this.answerGo),a.active=!0;for(var d=[],c=1;c<=5;c++){var f,v=p.findChildComponent(a,"Toggle/Toggle"+c,l);(null==(f=t.header[c-1])?void 0:f.text)?(v.node.active=!0,d.push(v)):v.node.active=!1}this.toggleList.push(d),p.findChildComponent(a,"txtOption",s).string=r.text}var m=130+n*this.answerGo.getComponent(h).height+20*(n-1)+50;this.node.getComponent(h).height=m},i.getAnswerInfo=function(){var t=null,i=!0;if(!this.node.active)return{info:t,isHide:i};i=!1;for(var e="",n=this.toggleList.length,o=0;o<n;o++){for(var s="",r=this.toggleList[o],h=0;h<r.length;h++)if(r[h].isChecked){s=this.data.header[h].key;break}if("1"==this.data.required&&""==s)return{info:t,isHide:i};""!=s&&(o<n?e=e+s+";":e+=s)}return"1"==this.data.required&&""==e?{info:t,isHide:i}:{info:t={questionId:this.data.questionId,number:this.data.number,type:this.data.type,value:e,text:""},isHide:i}},i.setActive=function(t){this.node.active!=t&&(this.node.active=t)},i.getItemSize=function(){return this.node.getComponent(h).contentSize},i.remove=function(){this.node.destroy()},t}(),b=function(){function t(){this.view=void 0,this.node=void 0,this.data=void 0,this.txtQuestion=void 0,this.answerGo=void 0,this.answerItemGo=void 0,this.txtScores=[],this.toggleList=[]}var i=t.prototype;return i.init=function(t,i){this.view=i,this.node=t,this.onInit()},i.onInit=function(){this.txtQuestion=p.findChildComponent(this.node,"txtQuestion",s);for(var t=1;t<=5;t++){var i=p.findChild(this.node,"score/score"+t),e=p.findChildComponent(this.node,"score/score"+t+"/Label",s);this.txtScores.push({node:i,txt:e})}this.answerGo=p.findChild(this.node,"answer"),this.answerItemGo=p.findChild(this.node,"answer/answer"),this.answerItemGo.active=!1},i.setData=function(t){this.data=t,this.txtQuestion.string=u.formatStr("%s/%s. %s",t.number,this.view.totalNum,t.questionName);for(var i=0;i<this.txtScores.length;i++){var e;(null==(e=t.header[i])?void 0:e.text)?(this.txtScores[i].node.active=!0,this.txtScores[i].txt.string=t.header[i].text):this.txtScores[i].node.active=!1}for(var n=t.options.length,o=0;o<n;o++){var r=t.options[o],a=nodeInstantiate.instantiate(this.answerItemGo);a.setParent(this.answerGo),a.active=!0;for(var d=[],c=1;c<=5;c++){var f,v=p.findChildComponent(a,"Toggle/Toggle"+c,l);(null==(f=t.header[c-1])?void 0:f.text)?(v.node.active=!0,d.push(v)):v.node.active=!1}this.toggleList.push(d),p.findChildComponent(a,"txtOption",s).string=r.text}var m=130+n*this.answerGo.getComponent(h).height+20*(n-1)+50;this.node.getComponent(h).height=m},i.getAnswerInfo=function(){var t=null,i=!0;if(!this.node.active)return{info:t,isHide:i};i=!1;for(var e="",n=this.toggleList.length,o=0;o<n;o++){for(var s="",r=this.toggleList[o],h=0;h<r.length;h++)r[h].isChecked&&(s+=this.data.header[h].key);if("1"==this.data.required&&""==s)return{info:t,isHide:i};""!=s&&(o<n?e=e+s+";":e+=s)}return"1"==this.data.required&&""==e?{info:t,isHide:i}:{info:t={questionId:this.data.questionId,number:this.data.number,type:this.data.type,value:e,text:""},isHide:i}},i.setActive=function(t){this.node.active!=t&&(this.node.active=t)},i.getItemSize=function(){return this.node.getComponent(h).contentSize},i.remove=function(){this.node.destroy()},t}(),Q=function(){function t(){this.view=void 0,this.node=void 0,this.data=void 0,this.txtQuestion=void 0,this.input=void 0}var i=t.prototype;return i.init=function(t,i){this.view=i,this.node=t,this.onInit()},i.onInit=function(){this.txtQuestion=p.findChildComponent(this.node,"txtQuestion",s),this.input=p.findChildComponent(this.node,"input/input",f)},i.setData=function(t){this.data=t,this.txtQuestion.string=u.formatStr("%s/%s. %s",t.number,this.view.totalNum,t.questionName)},i.getAnswerInfo=function(){var t=null,i=!0;if(!this.node.active)return{info:t,isHide:i};i=!1;var e=this.input.string;return"1"==this.data.required&&""==e?{info:t,isHide:i}:{info:t={questionId:this.data.questionId,number:this.data.number,type:this.data.type,value:e},isHide:i}},i.setActive=function(t){this.node.active!=t&&(this.node.active=t)},i.getItemSize=function(){return this.node.getComponent(h).contentSize},i.remove=function(){this.node.destroy()},t}();n._RF.pop()}}}));

