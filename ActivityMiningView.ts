System.register("chunks:///_virtual/ActivityMiningView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./RedPoint.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./SpineSkeleton.ts","./ConfigGlobal.ts","./MessageView.ts","./ActivityControl.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./ActivityMiningDataCache.ts","./BaseView.ts"],(function(t){"use strict";var i,e,n,s,o,a,l,h,d,v,c,f,r,u,C,p,m,L,g,b,w;return{setters:[function(t){i=t.inheritsLoose},function(t){e=t.cclegacy,n=t.Label,s=t.Button,o=t.HorizontalTextAlignment,a=t.Vec2,l=t.js},function(t){h=t.RedPointType},function(t){d=t.default},function(t){v=t.default},function(t){c=t.default},null,function(t){f=t.SpineSkeleton},function(t){r=t.ConfigGlobal},function(t){u=t.default},function(t){C=t.default},function(t){p=t.default},function(t){m=t.ActivityType,L=t.ActivityState,g=t.ActivityEventDefine},function(t){b=t.default},function(t){w=t.BaseView}],execute:function(){e._RF.push({},"790789lZAZOG5965ZPb+sti","ActivityMiningView",void 0);t("default",function(t){function e(){var i;return(i=t.call(this)||this).mentionFinish=void 0,i.mentionTxt=void 0,i.txtTimeDesc=void 0,i.txtLeftTime=void 0,i.leftTime=0,i.deltaTime=0,i.canUpdate=!1,i.btnGo=void 0,i.btnContinue=void 0,i.btnCancel=void 0,i.levelList={},i.levelChoose=1,i.chapterDataList=null,i.mainGroupId=0,i.levelData=null,i.bossEffectID=0,i.bossSpine=void 0,i.BossIDSel=void 0,i.btnGift=void 0,i.btnGuild=void 0,i.name="ActivityMiningView",i.url="ui/module/mining/ActivityMiningView",i.fullScreen=!0,i}i(e,t);var w=e.prototype;return w.onInit=function(){var t=this;this.txtTimeDesc=this.findChildComponent("view/nodeTime/txtDesc",n),this.txtLeftTime=this.findChildComponent("view/nodeTime/txtTime",n);var i=this.findChild("view/btnClose");this.addComponentCallbackListener(i,s.EventType.CLICK,(function(){t.close()}));var e=this.findChild("title/tips");this.addComponentCallbackListener(e,s.EventType.CLICK,(function(){for(var t=r.LIMITED_RANK_SYSTEM_DETAILS,i="",e=0;e<t.length;e++)t[e][0]==m.Mining&&(i=GetLanguage(t[e][1]));""!=i&&u.showBoxTip({tip:i,btnCnt:1,horizontalAlign:o.LEFT})})),this.btnGo=this.findChild("view/chooseList/btnGo"),this.addComponentCallbackListener(this.btnGo,s.EventType.CLICK,(function(){uiMgr.openView("ActivityMiningGameView",t.levelChoose)})),this.btnContinue=this.findChild("view/chooseList/btnContinue"),this.addComponentCallbackListener(this.btnContinue,s.EventType.CLICK,(function(){uiMgr.openView("ActivityMiningGameView",t.levelChoose)})),this.btnCancel=this.findChild("view/chooseList/btnCancel"),this.addComponentCallbackListener(this.btnCancel,s.EventType.CLICK,(function(){IS(C).send_24_129(t.levelChoose)}));for(var l=function(i){t.levelList[i]={levelId:null,node:t.findChild("view/levelList/view/content/"+i),btn:t.findChild("view/levelList/view/content/"+i+"/btn"),select:t.findChild("view/levelList/view/content/"+i+"/btn/select"),isLock:t.findChild("view/levelList/view/content/"+i+"/isLock"),isFinish:t.findChild("view/levelList/view/content/"+i+"/isFinish"),txt1:t.findChildComponent("view/levelList/view/content/"+i+"/btn/Label",n),txt2:t.findChildComponent("view/levelList/view/content/"+i+"/isLock/Label",n),needDay:0};var e=v.formatStr(GetLanguage(300686),i);t.levelList[i].txt1.string=e,t.levelList[i].txt2.string=e,t.addComponentCallbackListener(t.levelList[i].btn,s.EventType.CLICK,(function(){t.changeChoose(t.levelList[i].levelId)})),t.addComponentCallbackListener(t.levelList[i].isLock,s.EventType.CLICK,(function(){var e=t.levelData[i-1];u.showFlyTip(v.formatStrWithMirrorDeal(GetLanguage(201212),e.open_time))}))},d=1;d<6;d++)l(d);this.mentionTxt=this.findChild("view/mentionTxt"),this.mentionFinish=this.findChild("view/mentionFinish"),this.btnGift=this.findChild("view/btnGift"),this.addComponentCallbackListener(this.btnGift,s.EventType.CLICK,(function(){uiMgr.openView("ActivityMiningPassView",14)})),this.btnGuild=this.findChild("view/btnGuild"),this.addComponentCallbackListener(this.btnGuild,s.EventType.CLICK,(function(){uiMgr.openView("ActivityMiningGuideView")})),this.addRedPoint("MiningPassView/Reward",this.btnGift,new a(41,30),h.Dot)},w.onAttack=function(){this.bossSpine&&(this.bossSpine.setAnimation(0,"hit",!1),this.bossSpine.addAnimation(0,"idle",!0))},w.changeChoose=function(t){for(var i in this.levelData)if(this.levelData.hasOwnProperty(i)){var e=this.levelData[i];this.levelList[e.id].select.active=this.levelList[e.id].levelId==t}if(this.levelChoose=t,null!=this.chapterDataList[t]){var n=0==this.chapterDataList[t].round||this.chapterDataList[t].round==this.levelData[t-1].round[4];this.mentionTxt.active=!1,this.btnGo.active=n,this.btnContinue.active=!n,this.btnCancel.active=!n,this.mentionFinish.active=1==this.chapterDataList[t].finish}else this.mentionFinish.active=!1,this.mentionTxt.active=!0,this.btnGo.active=!1,this.btnContinue.active=!1,this.btnCancel.active=!1;var s=configMining_level.getDataByKey(t).boss;this.refreshBossShow(s),this.onAttack()},w.refreshBossShow=function(t){var i=this.findChild("view/bossRoot/icon");this.removeUIEffect(this.bossEffectID),this.bossEffectID=this.addUIEffect("prefab/model/"+t,i,-1,null,this.levelData[this.levelChoose-1].boss_size/100),this.bossSpine=d.findChildComponent(i,t+"/model",f)},w.onAfterOpen=function(){var t=IS(p).GetActivityInfo(m.Mining);if(t){var i;IS(C).send_24_126();var e=null!=(i=t.state_time[t.state])?i:t.state_time[L.Open];if(this.leftTime=e.end_time-c.serverTime,this.leftTime>0){var n="";t.state==L.Preview?n=GetLanguage(200763):t.state==L.Open?n=GetLanguage(200764):t.state==L.EndShow&&(n=GetLanguage(200765)),this.txtTimeDesc.string=n,this.canUpdate=!0,this.txtLeftTime.string=l.formatStr("%s",c.formatTimeStringForSecond(this.leftTime))}else this.txtLeftTime.string=GetLanguage(200026)}else u.showFlyTip(GetLanguage(200086)),uiMgr.openView("ActivityMiningGameView",this.levelChoose),this.close();IS(b).checkHasOpenGuide()||(uiMgr.openView("ActivityMiningGuideView"),IS(b).setOpenGuide())},w.registerUpdateHandler=function(){this.addEvent(g.OnMiningInfoUpdate,this.updateInfo,this),this.addEvent(g.OnMiningSettleUpdate,this.updateInfo,this)},w.updateInfo=function(){var t;this.chapterDataList=IS(b).getChapterData(),this.mainGroupId=IS(b).mainGroupId,this.levelData=null!=(t=configMining_level.getDataByList("group",this.mainGroupId))?t:[];var i=IS(p).GetActivityInfo(m.Mining);if(i&&i.state==L.Open){var e,n=null!=(e=i.state_time[i.state])?e:i.state_time[L.Open],s=c.serverTime-n.start_time,o=Math.floor(s/86400)+1,a=1;for(var l in this.levelData)if(this.levelData.hasOwnProperty(l)){var h=this.levelData[l];this.levelList[h.id].levelId=h.id,this.levelList[h.id].isLock.active=o<h.open_time,this.levelList[h.id].needDay=h.open_time-o,this.levelList[h.id].btn.active=o>=h.open_time,o>=h.open_time&&null!=this.chapterDataList[h.id]&&(a=h.id),this.levelList[h.id].isFinish.active=this.chapterDataList[h.id]&&1==this.chapterDataList[h.id].finish}this.changeChoose(a)}},w.onUpdate=function(t){this.canUpdate&&(this.deltaTime=this.deltaTime+t,this.deltaTime>=1&&(this.deltaTime=0,this.leftTime=this.leftTime-1,this.leftTime>0?this.txtLeftTime.string=l.formatStr("%s",c.formatTimeStringForSecond(this.leftTime)):(this.txtLeftTime.string=GetLanguage(200026),this.canUpdate=!1)))},w.onBeforeClose=function(){},w.onDestroy=function(){},e}(w));e._RF.pop()}}}));

