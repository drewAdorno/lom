System.register("chunks:///_virtual/ChapterMountCC.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BattleData.ts","./ChapterMount.ts","./EnumDefine.ts","./EventDefine.ts","./AudioMgr.ts","./MathUtil.ts","./ObjectUtil.ts","./ChapterDefine.ts","./DungeonControl.ts","./DungeonDefine.ts","./GameSetting.ts","./MessageView.ts"],(function(t){"use strict";var e,n,a,o,i,u,r,f,c,s,l,h,g,p,d,M,b;return{setters:[function(t){e=t.inheritsLoose,n=t.regeneratorRuntime,a=t.createForOfIteratorHelperLoose},function(t){o=t.cclegacy},function(t){i=t.ChapterType},function(t){u=t.ChapterMount},function(t){r=t.RunState},function(t){f=t.EventDefine},function(t){c=t.audioMgr},function(t){s=t.default},function(t){l=t.default},function(t){h=t.ChapterEventDefine},function(t){g=t.default},function(t){p=t.DungeonEvent},function(t){d=t.default,M=t.GameSettingKey},function(t){b=t.default}],execute:function(){o._RF.push({},"3ec554ZA7tNr73edqjEQHV8","ChapterMountCC",void 0);t("ChapterMountCC",function(t){function o(){for(var e,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))||this).buffPool=[],e}e(o,t);var u=o.prototype;return u.getWeightRandIndex=function(t,e){for(var n=s.getRandomInt(0,e),a=0,o=0;o<t.length&&!(n<(a+=t[o].weight));o++);return o},u.getBuffList=function(t,e){var n=configMount_chapter.getDataByKey(t),a=[],o=0;return n.buff_pool.forEach((function(t){if(!e||!e.includes(t)){var n=configMount_chapter_bufflist.getDataByKey(t);a.push(n),o+=n.weight}})),[a,o]},u.init=function(){normalEvent.on(p.TYPE_SELECTED_BUFF_ID,this.onSelectBuffId,this)},u.start=function(){t.prototype.start.call(this),c.playMusic("bgm_shikongdaoxuta")},u.destroy=function(){normalEvent.off(p.TYPE_SELECTED_BUFF_ID,this.onSelectBuffId,this),this.buffPool.length=0},u.onSelectBuffId=function(t,e){if(battleMain.runState=r.Running,battleMain.curRecord&&battleMain.curRecord.buff_collects.push(t),0!=t){if(this.addBuff(t),1==e)normalEvent.emit(f.MountDebuffChange,t);else if(2==e){this.buffPool.push(t);var n=configMount_chapter.getDataByKey(battleMain.data.chapterId);battleMain.startNextPart(n),normalEvent.emit(f.MountBuffChange,this.buffPool)}}else{var a=configMount_chapter.getDataByKey(battleMain.data.chapterId);battleMain.startNextPart(a)}},u.endResult=n().mark((function t(e,a,o){return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,coroutine.wait(1);case 2:c.playMusic("battle"),battleMain.enterChapter(),0==a&&battleMain.checkCheat()&&(a=1,this.bossHp=0,b.showBoxTip({tip:GetLanguage(200998),btnCnt:1,func:function(t){},ensure:GetLanguage(200129)})),battleMain.curRecord&&battleMain.curRecord.manual?IS(g).reqDungeonMountResult(e,a,battleMain.curRecord.buff_collects,1,battleMain.curRecord.collects,[{k:3,v:this.bossHp}]):IS(g).reqDungeonMountResult(e,a,battleMain.curRecord?battleMain.curRecord.buff_collects:[],0,[],[{k:3,v:this.bossHp}]),normalEvent.emit(h.BATTLE_STATE,i.Mount,!1),battleMain.toResult(e,i.Mount,a,o);case 8:case"end":return t.stop()}}),t,this)})),u.toResult=function(t,e){var n=this;void 0===e&&(e=!1);var o=this.battleMain,i=this.config,u=configMount_chapter.getDataByKey(i.next_part);if(0==t&&null!=u&&u.level==i.level)return o.data.chapterId=u.id,o.runningToPart=!0,void o.addFrameTimer(1,1,(function(){o.runState=r.Pause;var t,e=n.getBuffList(i.id,n.buffPool),u=e[1],f=e[0];i.buff_guarantee.length>0&&(t=l.copyArray(i.buff_guarantee));for(var c=[];c.length<3;){var s=n.getWeightRandIndex(f,u);if(t&&t.length>0){if(t[0]!=f[s].quality)continue;t.splice(0,1)}c.push(f[s].mount_buff_id),u-=f[s].weight,f.splice(s,1)}if(1==IS(d).Get(M.MOUNT_AUTO_GET)){for(var h,g,b=a(c);!(g=b()).done;){var v=g.value;configMount_chapter_bufflist.getDataByKey(v).quality>0&&(h=v)}normalEvent.emit(p.TYPE_SELECTED_BUFF_ID,h,2)}else uiMgr.openView("MountDungeonSelectView",c,2)}));this.getBossHp(),this.bossUnit&&(t=0),coroutine.start(this.endResult(i.id,t,e),"battle")},o}(u));o._RF.pop()}}}));

