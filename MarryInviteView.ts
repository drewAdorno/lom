System.register("chunks:///_virtual/MarryInviteView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./index57.ts","./ChatDataCache.ts","./ChatDefine.ts","./FriendControl.ts","./GuildControl.ts","./GuildDataCache.ts","./GuildDefine.ts","./RoleDataCache.ts","./MarryControl.ts","./MarryDefine.ts","./MarryDialogDataCache.ts","./ItemIcon.ts","./BaseView.ts"],(function(i){"use strict";var e,t,n,o,r,s,a,d,l,h,f,c,v,m,_,u,I,C,p,g,y,S,F,T;return{setters:[function(i){e=i.inheritsLoose},function(i){t=i.cclegacy,n=i.Button,o=i.Label,r=i.ScrollView,s=i.UITransform,a=i.Sprite,d=i.LabelOutline,l=i.Color},function(i){h=i.ListItem},function(i){f=i.default},function(i){c=i.default},null,function(i){v=i.ChatDataCache},function(i){m=i.ChatDefine},function(i){_=i.default},function(i){u=i.default},function(i){I=i.default},function(i){C=i.GuildEventDefine},function(i){p=i.RoleDataCache},function(i){g=i.default},function(i){y=i.MarryEventDefine},function(i){S=i.default},function(i){F=i.IconAseetType},function(i){T=i.BaseView}],execute:function(){t._RF.push({},"3ee13Zpz+NOlaIzKlKfFVLk","MarryInviteView",void 0);i("default",function(i){function t(){var e;return(e=i.call(this)||this).inviteCount=void 0,e.friendList=void 0,e.selectTab=0,e.familySelect=void 0,e.friendSelect=void 0,e.noFamily=void 0,e.inviteInfo_list=void 0,e.friend_info_list=void 0,e.friendInfo=void 0,e.list_content=void 0,e.item_height=109,e.screen_height=682,e.is_send_server=!1,e.send_num=0,e.page=1,e.utScrollView=void 0,e.lover_id=void 0,e.loverName=void 0,e.selfGender=void 0,e.loverGender=void 0,e.isSendToServer=!1,e.name="MarryInviteView",e.url="ui/module/marry/MarryInviteView",e}e(t,i);var a=t.prototype;return a.onInit=function(){var i=this,e=this.findChild("root/imgMask");this.addComponentCallbackListener(e,n.EventType.CLICK,(function(){i.close()}));var t=this.findChild("root/btnClose");this.addComponentCallbackListener(t,n.EventType.CLICK,(function(){i.close()})),this.noFamily=this.findChild("root/noFamily"),this.inviteCount=this.findChildComponent("root/inviteCount",o),this.friendList=this.addUIList(this.findChildComponent("root/friendList",r),L),this.friendSelect=this.findChild("root/btnFriend/isSelect");var a=this.findChild("root/btnFriend");this.addComponentCallbackListener(a,n.EventType.CLICK,(function(){i.selectTab=1,i.refreshList()})),this.familySelect=this.findChild("root/btnFamily/isSelect");var d=this.findChild("root/btnFamily");this.addComponentCallbackListener(d,n.EventType.CLICK,(function(){i.selectTab=2,i.refreshList()})),this.utScrollView=this.findChildComponent("root/friendList/view",s),this.addComponentCallbackListener(this.friendList.node,r.EventType.SCROLL_TO_BOTTOM,(function(){i.is_send_server||i.checkNeedSend()})),this.list_content=this.findChild("root/friendList/view/content")},a.refreshPage=function(){this.send_num=1,this.page=1,this.isSendToServer=!1,this.is_send_server=!1},a.GetDetailHeight=function(){return 90*this.friend_info_list.length},a.checkNeedSend=function(){!this.friendInfo||this.friend_info_list.length>=this.friendInfo.total_num||(this.page+=1,IS(g).send_favor_friend_info_c2s(this.page),this.isSendToServer=!0)},a.registerUpdateHandler=function(){this.addEvent(y.MARRY_INVITE_FRIEND_LIST_UPDATE,this.updateInviteInfo),this.addEvent(C.GUILD_INFO_UPDATE,this.updateFamilyInfo,this),this.addEvent(y.MARRY_FAVOR_FRIEND_INFO_UPDATE,this.updateFriendInfo,this),this.addEvent(y.MARRY_FAVOR_FRIEND_SEND_FLOWER,this.refreshPage,this)},a.onAfterOpen=function(){this.lover_id=IS(S).GetLoverId(),this.loverName="",this.selfGender=IS(p).GetGender(),this.loverGender=IS(S).GetLoverGender(),this.selectTab=1,IS(g).send_marry_invite_friend_c2s()},a.updateInviteInfo=function(){var i=IS(S).GetInviteInfo();this.inviteCount.string=c.formatStr(GetLanguage(204115),i.min,i.max),this.refreshList()},a.updateFriendInfo=function(){var i=IS(S).GetFavorFriendInfo();i&&i.friend_list&&i.friend_list.length>0?(this.friendList.node.active=!0,this.friendList.datas=i.friend_list,this.friendInfo=i,this.friend_info_list=i.friend_list):this.friendList.node.active=!1,this.isSendToServer=!1,this.is_send_server=!1},a.updateFamilyInfo=function(){IS(I).GetGuildInfo();var i=IS(I).GetMemberList(),e=[];for(var t in i)if(i.hasOwnProperty(t)){var n=i[t];e.push(n)}e.sort((function(i,e){return i.is_online==e.is_online?0==i.is_online&&i.offline_time!=e.offline_time?e.offline_time-i.offline_time:i.career!=e.career?IS(I).CompareCareer(i.career,e.career):i.role_id-e.role_id:0==i.is_online?1:-1})),this.friendList.datas=e},a.refreshList=function(){this.friendSelect.active=1==this.selectTab,this.familySelect.active=2==this.selectTab,1==this.selectTab?(this.noFamily.active=!1,this.friend_info_list=[],IS(g).send_favor_friend_info_c2s(1),this.send_num=1,this.page=1,this.isSendToServer=!1,this.is_send_server=!1):2==this.selectTab&&(IS(p).HasGuild()?(this.friendList.node.active=!0,this.noFamily.active=!1,IS(u).send_29_1(IS(p).GetGuildId())):(this.friendList.node.active=!1,this.noFamily.active=!0))},a.onBeforeClose=function(){},a.onDestroy=function(){},t}(T));var L=function(i){function t(){for(var e,t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return(e=i.call.apply(i,[this].concat(n))||this).imgFrame=void 0,e.imgIcon=void 0,e.imgHeadFrame=void 0,e.rank=void 0,e.rankIcon=void 0,e.btnSend=void 0,e.isSend=void 0,e.refuse=void 0,e.accept=void 0,e.family=void 0,e.familyTitle=void 0,e.friend=void 0,e.favorIcon=void 0,e.titleOutline=void 0,e.friendFavorTitle=void 0,e.friendFavorCount=void 0,e.name=void 0,e.power=void 0,e.player_id=void 0,e}e(t,i);var r=t.prototype;return r.onInit=function(){var i=this;this.imgFrame=f.findChildComponent(this.node,"imgFrame",a),this.imgIcon=f.findChildComponent(this.node,"imgFrame/imgIcon",a),this.imgHeadFrame=f.findChildComponent(this.node,"imgFrame/imgHeadFrame",a),this.rank=f.findChildComponent(this.node,"rank",o),this.rankIcon=f.findChildComponent(this.node,"rankIcon",a),this.isSend=f.findChild(this.node,"isSend"),this.refuse=f.findChild(this.node,"refuse"),this.accept=f.findChild(this.node,"accept"),this.view.loadIcon(f.findChildComponent(this.node,"btnSend",a),"marry_dialog","jh_icon_fasongqingjian"),this.btnSend=f.findChild(this.node,"btnSend"),this.view.addComponentCallbackListener(this.btnSend,n.EventType.CLICK,(function(){i.onSendClick()})),this.family=f.findChild(this.node,"family"),this.familyTitle=f.findChildComponent(this.node,"family/familyTitle",o),this.friend=f.findChild(this.node,"friend"),this.favorIcon=f.findChildComponent(this.node,"friend/favorIcon",a),this.friendFavorTitle=f.findChildComponent(this.node,"friend/favorIcon/favorTitle",o),this.titleOutline=f.findChildComponent(this.node,"friend/favorIcon/favorTitle",d),this.friendFavorCount=f.findChildComponent(this.node,"friend/favorCount",o),this.name=f.findChildComponent(this.node,"Node/name",o),this.power=f.findChildComponent(this.node,"Node/power",o),this.view.addComponentCallbackListener(this.imgFrame.node,n.EventType.CLICK,(function(){i.player_id&&IS(_).reqOtherRoleNotice(i.player_id)}))},r.onRender=function(i,e){if(this.data=i,e<3?(this.rankIcon.node.active=!0,this.rank.node.active=!1,this.view.loadIcon(this.rankIcon,"common","common_ICON_paiming0"+(e+1))):(this.rankIcon.node.active=!1,this.rank.node.active=!0,this.rank.string=(e+1).toString()),this.friend.active=1==this.view.selectTab,this.family.active=2==this.view.selectTab,i&&i.role_id)if(1==this.view.selectTab){var t;this.player_id=i.role_id,this.name.string=i.name,this.power.node.active=!0,this.power.string=GetLanguage(200295)+i.cur_power,this.friendFavorCount.string=null!=(t=i.favor)?t:0,this.view.loadRemoteIcon(i.head.url,this.imgIcon);var n=i.head.frame_id;if(n>0){this.imgHeadFrame.node.active=!0;var o=configAvatar_frame.getDataByKey(n);this.view.loadIcon(this.imgHeadFrame,"icon_frame",o.icon)}else this.imgHeadFrame.node.active=!1;var r=configFavorability_level.getDataByKey(i.favor_lv);r.level_group<3?(this.titleOutline.color=(new l).fromHEX(r.color),1==r.level_group?this.friendFavorTitle.node.setPosition(1,-15):this.friendFavorTitle.node.setPosition(20,-15),i.gender!=this.view.selfGender?(this.friendFavorTitle.string=GetLanguage(r.desc[0]),this.view.loadIcon(this.favorIcon,"icon_marry",r.icon[0],null,F.ICON_SPRITE)):2==this.view.selfGender?(this.friendFavorTitle.string=GetLanguage(r.desc[2]),this.view.loadIcon(this.favorIcon,"icon_marry",r.icon[2],null,F.ICON_SPRITE)):(this.friendFavorTitle.string=GetLanguage(r.desc[1]),this.view.loadIcon(this.favorIcon,"icon_marry",r.icon[1],null,F.ICON_SPRITE))):(this.titleOutline.color=(new l).fromHEX(r.color),this.friendFavorTitle.node.setPosition(1,-20),i.gender!=this.view.selfGender?(this.friendFavorTitle.string=GetLanguage(r.desc[0]),this.view.loadIcon(this.favorIcon,"icon_marry",r.title[0],null,F.ICON_SPRITE)):2==this.view.selfGender?(this.friendFavorTitle.string=GetLanguage(r.desc[2]),this.view.loadIcon(this.favorIcon,"icon_marry",r.title[2],null,F.ICON_SPRITE)):(this.friendFavorTitle.string=GetLanguage(r.desc[1]),this.view.loadIcon(this.favorIcon,"icon_marry",r.title[1],null,F.ICON_SPRITE))),this.player_id==this.view.lover_id&&(this.view.loverName=i.name)}else if(2==this.view.selectTab){this.player_id=i.role_id,this.name.string=i.role_name,this.power.node.active=!1;var s=configGuild_career.getDataByKey(i.career);s&&(this.familyTitle.string=s.name),this.view.loadRemoteIcon(i.role_head.url,this.imgIcon);var a=i.role_head.frame_id;if(a>0){this.imgHeadFrame.node.active=!0;var d=configAvatar_frame.getDataByKey(a);this.view.loadIcon(this.imgHeadFrame,"icon_frame",d.icon)}else this.imgHeadFrame.node.active=!1;this.player_id==this.view.lover_id&&(this.view.loverName=i.role_name)}if(this.player_id&&this.player_id!=this.view.lover_id&&this.player_id!=IS(p).GetRoleId()){var h=IS(S).CheckInviteState(this.player_id);this.btnSend.active=-1==h,this.isSend.active=0==h,this.refuse.active=2==h,this.accept.active=1==h}else this.btnSend.active=!1,this.isSend.active=!1,this.refuse.active=!1,this.accept.active=!1},r.onSendClick=function(){if(this.player_id){var i=this.view.loverGender&&this.view.loverGender==this.view.selfGender?0:1;IS(v).SendShareData(m.ChatLinkType.WeddingInvite,{time:IS(S).GetWeddingDate(),type:i,selfName:IS(p).GetRoleName(),loverName:this.view.loverName},m.Channel.Private,this.player_id),IS(g).send_marry_invite_friend_c2s()}},t}(h);t._RF.pop()}}}));

