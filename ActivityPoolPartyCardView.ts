System.register("chunks:///_virtual/ActivityPoolPartyCardView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./RedPoint.ts","./RedPointMgr.ts","./NodeUtil.ts","./TimeUtil.ts","./index57.ts","./BagDefine.ts","./BagModel.ts","./ActivityControl.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./ActivityPoolPartyDefine.ts","./BaseView.ts"],(function(t){"use strict";var i,e,s,a,n,o,d,r,h,c,l,v,u,f,m,C,w,p,k,T,y,I;return{setters:[function(t){i=t.inheritsLoose},function(t){e=t.cclegacy,s=t.Button,a=t.Vec2,n=t.Label,o=t.ScrollView},function(t){d=t.ItemGrid},function(t){r=t.ListItem},function(t){h=t.RedPointType},function(t){c=t.RedPointMgr},function(t){l=t.default},function(t){v=t.default},null,function(t){u=t.BagEventDefine},function(t){f=t.BagModel},function(t){m=t.default},function(t){C=t.default},function(t){w=t.ActivityType,p=t.ActivityEventDefine,k=t.ActivityState,T=t.ActivityTaskState},function(t){y=t.CardItemList},function(t){I=t.BaseView}],execute:function(){e._RF.push({},"e3d00vcqwpNabPQCC0fMoUu","ActivityPoolPartyCardView",void 0);t("default",function(t){function e(){var i;return(i=t.call(this)||this).txtLeftTime=void 0,i.cardProgressNum=void 0,i.cardItemList=[],i.taskTitle=void 0,i.taskRewardList=void 0,i.taskRewardBtn=void 0,i.taskReward=void 0,i.taskValueNode=void 0,i.taskValue=void 0,i.tipsView=void 0,i.timer=void 0,i.leftTime=void 0,i.showTaskItem=void 0,i.name="ActivityPoolPartyCardView",i.url="ui/module/activityPoolParty/ActivityPoolPartyCardView",i}i(e,t);var d=e.prototype;return d.onInit=function(){var t=this,i=this.findChild("imgMask");this.addComponentCallbackListener(i,s.EventType.CLICK,(function(){t.close()}));var e=this.findChild("view/btnClose");this.addComponentCallbackListener(e,s.EventType.CLICK,(function(){t.close()}));var o=this.findChild("view/btnSend");this.addComponentCallbackListener(o,s.EventType.CLICK,(function(){uiMgr.openView("ActivityPoolPartyCardMsgView")})),this.addRedPoint("ActivityPoolPartyCardMsgCheck",o,new a(70,20),h.Dot,1),IS(c).updateRed("ActivityPoolPartyCardMsgCheck"),this.tipsView=this.findChild("tipsView");var d=this.findChild("tipsView/mask");this.addComponentCallbackListener(d,s.EventType.CLICK,(function(){t.tipsView.active=!1}));var r=this.findChild("view/haveTip/btn");this.addComponentCallbackListener(r,s.EventType.CLICK,(function(){t.tipsView.active=!0})),this.txtLeftTime=this.findChildComponent("view/nodeTime/txtTime",n),this.InitCardList(),this.InitTask()},d.InitCardList=function(){var t=this;this.cardProgressNum=this.findChildComponent("view/card/cardProgress/value",n);for(var i=function(i){var e={id:y[i],mask:t.findChild("view/card/card"+(i+1)+"/mask"),num:t.findChildComponent("view/card/card"+(i+1)+"/num",n)};t.addComponentCallbackListener(t.findChild("view/card/card"+(i+1)),s.EventType.CLICK,(function(){uiMgr.openView("ActivityPoolPartyOperateView",y[i])})),t.cardItemList.push(e)},e=0;e<y.length;e++)i(e)},d.InitTask=function(){var t=this;this.taskTitle=this.findChildComponent("view/cardReward/title",n),this.taskRewardBtn=this.findChild("view/cardReward/btnGreen"),this.addComponentCallbackListener(this.taskRewardBtn,s.EventType.CLICK,(function(){IS(m).send_24_15(w.PoolPartyPuzzle,t.showTaskItem.task_id,t.showTaskItem.group_id)}));var i=this.findChild("view/cardReward/title/tips");this.addComponentCallbackListener(i,s.EventType.CLICK,(function(){})),this.taskReward=this.findChild("view/cardReward/isReward"),this.taskRewardList=this.addUIList(this.findChildComponent("view/cardReward/rewardScroll",o),P,!1),this.taskValueNode=this.findChild("view/cardReward/value"),this.taskValue=this.findChildComponent("view/cardReward/value/value",n)},d.registerUpdateHandler=function(){this.addEvent(u.GOODS_LIST_UPDATE,this.updateInfo,this),this.addEvent(p.OnActivityListUpdate,this.updateTask,this),this.addEvent(p.OnActivityInfoTaskUpdate,this.updateTask,this),this.addEvent(p.OnActivityCollectInfo,this.updateInfo,this)},d.onAfterOpen=function(){var t=this;IS(m).send_24_14(w.PoolPartyPuzzle),this.tipsView.active=!1,this.updateInfo();var i=IS(C).GetActivityInfo(w.PoolPartyPuzzle);if(i){var e,s=null!=(e=i.state_time[i.state])?e:i.state_time[k.Open];this.leftTime=s.end_time-v.serverTime,this.timer&&(this.removeTimer(this.timer),this.timer=null),this.leftTime>0?(this.txtLeftTime.string=v.formatActivityTimeStringForSecond(this.leftTime),this.timer=this.addTimer(1,this.leftTime,(function(){var i=s.end_time-v.serverTime;t.txtLeftTime.string=i>0?v.formatActivityTimeStringForSecond(t.leftTime):GetLanguage(200026)}))):this.txtLeftTime.string=GetLanguage(200026)}this.updateTask()},d.onBeforeClose=function(){},d.onDestroy=function(){},d.updateInfo=function(){for(var t=0;t<this.cardItemList.length;t++){var i=this.cardItemList[t],e=IS(f).getGoodsCountByGoodsGtid(i.id);i.num.string=e+"/1",i.mask.active=!(e>0)}},d.updateTask=function(){var t=IS(C).GetActivityInfo(w.PoolPartyPuzzle);if(t){var i=[];for(var e in t.task_list)i.push(t.task_list[e]);i.sort((function(t,i){return t.task_id<i.task_id?-1:1})),this.showTaskItem=null;for(var s=0;s<i.length;s++)if(i[s].state!=T.HadGet||s==i.length-1){this.showTaskItem=i[s];break}this.showTaskItem&&(this.taskRewardList.datas=this.showTaskItem.cfg.reward,this.taskTitle.string=this.showTaskItem.cfg.desc,this.taskReward.active=this.showTaskItem.state==T.HadGet,this.showTaskItem.state==T.Normal?(this.taskValueNode.active=!0,this.taskValue.string=this.showTaskItem.count+"/"+this.showTaskItem.cfg.condition[2],this.taskRewardBtn.active=!1):(this.taskValueNode.active=!1,this.taskRewardBtn.active=this.showTaskItem.state==T.CanGet))}},e}(I));var P=function(t){function e(){for(var i,e=arguments.length,s=new Array(e),a=0;a<e;a++)s[a]=arguments[a];return(i=t.call.apply(t,[this].concat(s))||this).itemGridNode=void 0,i.itemGrid=void 0,i}i(e,t);var s=e.prototype;return s.onInit=function(){this.itemGridNode=l.findChild(this.node,"itemGrid"),this.itemGrid=new d(this.view,this.itemGridNode)},s.onRender=function(t,i){this.itemGrid.SetItemId(t[0],t[1])},e}(r);e._RF.pop()}}}));

