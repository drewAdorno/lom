System.register("chunks:///_virtual/GvGRankingRewardView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./V2.ts","./GuildPinItem.ts","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./BaseView.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./CommonModel.ts","./FriendControl.ts","./GuildControl.ts","./GuildDataCache.ts","./RoleDataCache.ts","./RoleDefine.ts","./GvGControl.ts","./GvGDataCache.ts","./GvGDefine.ts"],(function(t){"use strict";var i,n,e,o,r,a,s,d,h,c,l,f,v,m,u,g,k,p,y,C,I,R,w,S,G,T;return{setters:[function(t){i=t.inheritsLoose},function(t){n=t.cclegacy,e=t.Button,o=t.Label,r=t.Sprite,a=t.ScrollView,s=t.js},function(t){d=t.V2},function(t){h=t.GuildPinItem},function(t){c=t.ItemGrid},function(t){l=t.ListItem},function(t){f=t.default},function(t){v=t.default},function(t){m=t.BaseView},function(t){u=t.default},function(t){g=t.ActivityType},function(t){k=t.CommonModel},function(t){p=t.default},function(t){y=t.default},function(t){C=t.default},function(t){I=t.RoleDataCache},function(t){R=t.PlayerAttr},function(t){w=t.default},function(t){S=t.GvGDataCache},function(t){G=t.GvGEventDefine,T=t.GvGRoleRankToRankIcon}],execute:function(){var x,_,L;n._RF.push({},"21496Z5i+9FzrNFANmPE+t1","GvGRankingRewardView",void 0);var M=1,N=2,F=((x={})[M]="",x[N]="",x),b=((_={})[1]=new d(0,0),_[2]=new d(0,0),_[3]=new d(0,0),_),B=((L={})[1]=999000220,L[2]=999000216,L[3]=999000214,L[4]=999000212,L),A=(t("default",function(t){function n(){var i;return(i=t.call(this)||this).curType=void 0,i.curRanking=void 0,i.txtTitle=void 0,i.typeToRankInfo={},i.rankList=void 0,i.typeItems=void 0,i.rankingItems=void 0,i.nodeReward=void 0,i.nodeRank=void 0,i.nodeRewardBg=void 0,i.nodeRankBg=void 0,i.nodeGuildTop=void 0,i.nodePlayerTop=void 0,i.myFrame=void 0,i.myIcon=void 0,i.myFlag=void 0,i.txtMyRank=void 0,i.txtMyScore=void 0,i.txtMyName=void 0,i.txtMyServer=void 0,i.guildTopList={},i.playerTopList={},i.rewardList=void 0,i.rankInfo=void 0,i.name="GvGRankingRewardView",i.url="ui/module/gvg/GvGRankingRewardView",i}i(n,t);var d=n.prototype;return d.onInit=function(){var t=this,i=this.findChild("imgMask");this.addComponentCallbackListener(i,e.EventType.CLICK,(function(){t.onMaskClick()}));var n=this.findChild("content/btnClose");this.addComponentCallbackListener(n,e.EventType.CLICK,(function(){t.close()})),this.txtTitle=this.findChildComponent("content/title/txtTitle",o),this.nodeReward=this.findChild("content/nodeReward"),this.nodeRank=this.findChild("content/nodeRank"),this.nodeRewardBg=this.findChild("content/imgBgReward"),this.nodeRankBg=this.findChild("content/imgBgRank"),this.nodeGuildTop=this.findChild("content/guildTopRank"),this.nodePlayerTop=this.findChild("content/playerTopRank"),this.typeItems=[];for(var d=function(i){var n=t.findChild(s.formatStr("content/typeBtns/btnType%s",i));t.addComponentCallbackListener(n,e.EventType.CLICK,(function(){t.curType!=i&&(t.curType=i,t.updateContent())})),t.typeItems.push({node:n,nodeSelect:f.findChild(n,"imgSelect"),type:i})},c=1;c<=2;c++)d(c);this.rankingItems=[];for(var l=function(i){var n=t.findChild(s.formatStr("content/bottomBtns/btnRanking%s",i));t.addComponentCallbackListener(n,e.EventType.CLICK,(function(){t.curRanking!=i&&(t.curRanking=i,t.updateContent())})),t.rankingItems.push({node:n,nodeSelect:f.findChild(n,"imgSelect"),ranking:i})},v=1;v<=4;v++)l(v);this.txtMyRank=this.findChildComponent("content/nodeReward/myRank/rankNum",o),this.txtMyScore=this.findChildComponent("content/nodeReward/myRank/score",o),this.txtMyName=this.findChildComponent("content/nodeReward/myRank/info/name",o),this.txtMyServer=this.findChildComponent("content/nodeReward/myRank/info/txtServer",o),this.myFrame=this.findChildComponent("content/nodeReward/myRank/imgFrame",r),this.myIcon=this.findChildComponent("content/nodeReward/myRank/imgFrame/imgIcon",r),this.myFlag=new h(this,f.findChild(this.node,"content/nodeReward/myRank/GuildPinItem"));var m=this.findChildComponent("content/nodeReward/rankList",a);this.rewardList=this.addUIList(m,A,!0);for(var u=1;u<=3;u++){var g=new U;g.init(this.findChild("content/guildTopRank/rank"+u),this,u),this.guildTopList[u]=g}for(var k=1;k<=3;k++){var p=new E;p.init(this.findChild("content/playerTopRank/rank"+k),this,k),this.playerTopList[k]=p}},d.registerUpdateHandler=function(){this.addEvent(G.GVG_WEEK_RANK_BACK,this.onGvGWeekRankBack,this)},d.onMaskClick=function(){this.close()},d.onAfterOpen=function(){var t;for(var i in this.guildTopList)this.guildTopList.hasOwnProperty(i)&&this.guildTopList[i].show();for(var n in this.playerTopList)this.playerTopList.hasOwnProperty(n)&&this.playerTopList[n].show();var e=IS(u).GetActivityInfo(g.GvG),o=configFamiliybrawl.getDataByKey(e.roundCfg.group_id),r=configRanktype.getDataByKey(o.family_rank_cross_id),a=configRanktype.getDataByKey(o.self_rank_cross_id);(t={})[M]=r.prefix,t[N]=a.prefix,F=t,this.curRanking=IS(S).curRanking||1,this.curType=1,IS(w).reqGvGWeekRank(1),IS(w).reqGvGWeekRank(2),this.updateContent()},d.updateContent=function(){this.txtTitle.string=GetLanguage_UI(B[this.curRanking]);for(var t=0;t<this.typeItems.length;t++){var i=this.typeItems[t];i.nodeSelect.active=i.type==this.curType}for(var n=0;n<this.rankingItems.length;n++){var e=this.rankingItems[n];e.nodeSelect.active=e.ranking==this.curRanking}var o=configFamiliybrawl_rank.getDataByKey(this.curRanking);if(this.curType==M){if(this.nodeGuildTop.active=!0,this.nodePlayerTop.active=!1,this.myFrame.node.active=!1,IS(I).HasGuild()){var r=IS(C).GetGuildInfo();this.txtMyName.string=r.name,this.myFlag.node.active=!0,this.myFlag.SetItem(r.guild_flag),this.txtMyServer.node.active=1==IS(S).ifCross,1==IS(S).ifCross&&(this.txtMyServer.string=s.formatStr("[s%s]",IS(I).GetServerId()))}else this.txtMyName.string=GetLanguage(200083),this.myFlag.node.active=!1,this.txtMyServer.node.active=!1;var a=[].concat(configFamiliybrawl_rank_reward.getDataByList("group",o.family_rank_reward));a.sort((function(t,i){return t.rank_range[0]-i.rank_range[0]})),this.rewardList.datas=a,this.rewardList.scrollTo(0,0),this.UpdateRankInfo()}else if(this.curType==N){this.nodeGuildTop.active=!1,this.nodePlayerTop.active=!0,this.myFlag.node.active=!1,this.myFrame.node.active=!0,this.txtMyServer.node.active=1==IS(S).ifCross,1==IS(S).ifCross&&(this.txtMyServer.string=s.formatStr("[s%s]",IS(I).GetServerId())),this.txtMyName.string=IS(I).GetRoleAttr(R.ROLE_ATTR_NAME),this.loadRemoteIcon(IS(I).GetRoleAttr(R.ROLE_ATTR_HEAD_URL),this.myIcon);var d=[].concat(configFamiliybrawl_rank_reward.getDataByList("group",o.self_rank_reward));d.sort((function(t,i){return t.rank_range[0]-i.rank_range[0]})),this.rewardList.datas=d,this.rewardList.scrollTo(0,0),this.UpdateRankInfo()}},d.onBeforeClose=function(){this.typeToRankInfo={}},d.onDestroy=function(){},d.UpdateRankInfo=function(){if(this.rankInfo=this.getRankInfo(),this.rankInfo){var t,i={};this.curType==M?i=this.guildTopList:this.curType==N&&(i=this.playerTopList);for(var n=0;n<3;n++)this.rankInfo.rank_info.length>=n?i[n+1].show(this.rankInfo.rank_info[n]):i[n+1].show(null);this.txtMyRank.string=0!=this.rankInfo.my_rank_info.rank?this.rankInfo.my_rank_info.rank:GetLanguage(200037),this.txtMyScore.string=s.formatStr("%s%s",F[this.curType],v.GetNumString(null!=(t=this.rankInfo.my_rank_info.score)?t:0))}else{if(this.curType==M)for(var e=1;e<=3;e++)this.guildTopList[e].show(null);else if(this.curType==N)for(var o=1;o<=3;o++)this.playerTopList[o].show(null);this.txtMyRank.string=GetLanguage(200037),this.txtMyScore.string=s.formatStr("%s%s",F[this.curType],0)}},d.getRankInfo=function(){if(this.curRanking==IS(S).curRanking)return this.typeToRankInfo[this.curType]},d.onGvGWeekRankBack=function(t){this.typeToRankInfo[t.type]=t,this.UpdateRankInfo()},n}(m)),function(t){function n(){for(var i,n=arguments.length,e=new Array(n),o=0;o<n;o++)e[o]=arguments[o];return(i=t.call.apply(t,[this].concat(e))||this).rewardScroll=void 0,i.txtRank=void 0,i.rankIcon=void 0,i}i(n,t);var e=n.prototype;return e.onInit=function(){this.txtRank=f.findChildComponent(this.node,"rankNum",o),this.rankIcon=f.findChildComponent(this.node,"rankIcon",r);var t=f.findChildComponent(this.node,"rewardScroll",a);this.rewardScroll=this.view.addUIList(t,D,!1),this.rewardScroll.touchEvent=!1},e.onRender=function(t,i){this.rewardScroll.datas=t.rank_reward;var n=t.rank_range[0],e=t.rank_range[1];n==e&&n<=3?(this.rankIcon.node.active=!0,this.txtRank.node.active=!1,this.view.loadIcon(this.rankIcon,"common","common_ICON_paiming0"+n)):(this.rankIcon.node.active=!1,this.txtRank.node.active=!0,t.show&&""!=t.show?this.txtRank.string=t.show:this.txtRank.string=s.formatStr("%s-%s",n,e))},n}(l)),D=function(t){function n(){for(var i,n=arguments.length,e=new Array(n),o=0;o<n;o++)e[o]=arguments[o];return(i=t.call.apply(t,[this].concat(e))||this).itemGridNode=void 0,i.itemGrid=void 0,i}i(n,t);var e=n.prototype;return e.onInit=function(){this.itemGridNode=f.findChild(this.node,"itemGrid"),this.itemGrid=new c(this.view,this.itemGridNode)},e.onRender=function(t,i){this.itemGrid.SetItemId(t[0],t[1])},n}(l),E=function(){function t(){this.view=void 0,this.node=void 0,this.rank=void 0,this.txtName=void 0,this.txtServer=void 0,this.txtScore=void 0,this.imgFrame=void 0,this.imgIcon=void 0,this.rankIcon=void 0,this.job=void 0,this.data=void 0,this.role=void 0}var i=t.prototype;return i.init=function(t,i,n){this.view=i,this.node=t,this.rank=n,this.onInit()},i.onInit=function(){var t=this;this.job=f.findChild(this.node,"role"),this.txtName=f.findChildComponent(this.node,"nameInfo/name",o),this.txtServer=f.findChildComponent(this.node,"nameInfo/txtServer",o),this.txtScore=f.findChildComponent(this.node,"score",o),this.imgFrame=f.findChild(this.node,"imgFrame"),this.imgIcon=f.findChildComponent(this.node,"imgFrame/imgIcon",r),this.view.addComponentCallbackListener(this.imgFrame,e.EventType.CLICK,(function(){t.data&&IS(p).reqOtherRoleNotice(t.data.belong_id)}));var i=f.findChild(this.node,"role/click");this.view.addComponentCallbackListener(i,e.EventType.CLICK,(function(){t.data&&IS(p).reqOtherRoleNotice(t.data.belong_id)})),this.rankIcon=f.findChildComponent(this.node,"imgFrame/rank_icon",r),this.view.loadIcon(this.rankIcon,"rank",T[this.rank])},i.show=function(t){if(this.data=t,this.txtName.string=GetLanguage(200038),this.txtScore.string=F[N]+"0",this.imgIcon.node.active=!1,this.txtServer.node.active=!1,null!=this.role&&(this.view.removeUnitModel(this.role),this.role=null),t){var i=t.figure;this.role=IS(k).AddRoleModel(this.view,i,this.job,null,.9),this.view.getUnitModel(this.role).mount=i.mount_figure,this.imgIcon.node.active=!0,this.view.loadRemoteIcon(t.head.url,this.imgIcon),i.mount_figure<=0&&(this.view.getUnitModel(this.role).position=b[this.rank]),this.view.loadRemoteIcon(t.head.url,this.imgIcon),this.txtName.string=t.name,this.txtScore.string=F[N]+v.GetNumString(t.score),this.txtServer.node.active=1==IS(S).ifCross,1==IS(S).ifCross&&(this.txtServer.string=s.formatStr("[s%s]",t.serv_id))}},t}(),U=function(){function t(){this.view=void 0,this.node=void 0,this.rank=void 0,this.flag=void 0,this.txtName=void 0,this.txtServer=void 0,this.txtScore=void 0,this.rankIcon=void 0,this.data=void 0}var i=t.prototype;return i.init=function(t,i,n){this.view=i,this.node=t,this.rank=n,this.onInit()},i.onInit=function(){var t=this;this.txtName=f.findChildComponent(this.node,"info/name/name",o),this.txtServer=f.findChildComponent(this.node,"info/txtServer",o),this.txtScore=f.findChildComponent(this.node,"score",o),this.flag=new h(this.view,f.findChild(this.node,"GuildPinItem")),this.view.addComponentCallbackListener(this.flag.node,e.EventType.CLICK,(function(){t.data&&IS(y).send_29_1(t.data.belong_id)})),this.rankIcon=f.findChildComponent(this.node,"rank_icon",r),this.view.loadIcon(this.rankIcon,"common","common_ICON_paiming0"+this.rank)},i.show=function(t){this.data=t,this.txtName.string=GetLanguage(200038),this.txtScore.string=F[M]+"0",this.flag.node.active=!1,this.txtServer.node.active=!1,t&&(this.flag.node.active=!0,this.flag.SetItem(t.guild_flag),this.txtName.string=t.name,this.txtScore.string=F[M]+v.GetNumString(t.score),this.txtServer.node.active=1==IS(S).ifCross,1==IS(S).ifCross&&(this.txtServer.string=s.formatStr("[s%s]",t.serv_id)))},t}();n._RF.pop()}}}));

