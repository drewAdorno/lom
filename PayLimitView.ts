System.register("chunks:///_virtual/PayLimitView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./TimeUtil.ts","./index57.ts","./BagModel.ts","./PayControl.ts","./PayDataCache.ts","./PayDefine.ts","./BaseSubView.ts"],(function(t){"use strict";var i,e,n,o,s,a,r,d,h,l,c,u,m,f,p,v,g,y,C,I;return{setters:[function(t){i=t.inheritsLoose,e=t.createForOfIteratorHelperLoose},function(t){n=t.cclegacy,o=t.Button,s=t.Animation,a=t.ScrollView,r=t.Label,d=t.isValid,h=t.js,l=t.Sprite,c=t.tween},function(t){u=t.ItemGrid},function(t){m=t.ListItem},function(t){f=t.default},function(t){p=t.default},null,function(t){v=t.BagModel},function(t){g=t.default},function(t){y=t.default},function(t){C=t.PayEventDefine},function(t){I=t.BaseSubView}],execute:function(){n._RF.push({},"7c940xvso1ND44zYn5tZPUA","PayLimitView",void 0);t("default",function(t){function e(){var i;return(i=t.call(this)||this).scroll=void 0,i.content=void 0,i.scorllLength=0,i.time=0,i.btnBox=void 0,i.boxRed=void 0,i.animTop=void 0,i.isFirstOpen=void 0,i.name="PayLimitView",i.url="ui/module/shop/PayLimitView",i}i(e,t);var n=e.prototype;return n.onInit=function(){this.boxRed=this.findChild("top/box/red"),this.btnBox=this.findChild("top/box"),this.addComponentCallbackListener(this.btnBox,o.EventType.CLICK,(function(){uiMgr.openView("PayRechargeRewardView")})),this.animTop=this.findChildComponent("top",s),this.content=this.findChild("scrollList/view/content");var t=this.findChildComponent("scrollList",a);this.scroll=this.addUIList(t,b,!0,0)},n.registerUpdateHandler=function(){this.addEvent(C.PAY_INFO_UPDATE,this.updateInfo,this)},n.onAfterOpen=function(){this.isFirstOpen=!0,this.animTop.play(),this.updateInfo()},n.onBeforeClose=function(){},n.onDestroy=function(){},n.onUpdate=function(t){if(this.time=this.time+t,this.time>1){this.time=0;for(var i=0;i<this.scorllLength;i++){var e=this.scroll.getItemByListId(i);null!=e&&e.UpdateTime()}}},n.updateInfo=function(){var t=this;this.btnBox.active=!1,this.boxRed.active=!1;var i=IS(y).GetGiftListByTabType(2),e=IS(y).GetGiftListByTabType(3),n=[GetLanguage(200480),i],o=[GetLanguage(200481),e],a=[];if(i.length>0&&a.push(n),e.length>0&&a.push(o),this.scorllLength=a.length,this.scroll.datas=a,this.isFirstOpen){this.content.setPosition(0,0,0);for(var r=function(i){var e=t.scroll.getItemByListId(i);if(null!=e){var n=e.node.getComponent(s);n.play(),n.pause(),c(e.node).delay(.08+.08*i).call((function(){e.PlayAnim()})).start()}},d=0;d<a.length;d++)r(d);this.addTimer(.08+.08*(a.length-1)+.3,1,(function(){t.isFirstOpen=!1,t.scroll.updateAll()}))}},e}(I));var b=function(t){function n(){for(var i,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(i=t.call.apply(t,[this].concat(n))||this).txtTitle=void 0,i.txtTime=void 0,i.scroll=void 0,i.anim=void 0,i.opacity=void 0,i}i(n,t);var o=n.prototype;return o.onInit=function(){this.adaptiveSize=!0,this.anim=this.node.getComponent(s),this.txtTitle=f.findChildComponent(this.node,"title/Label",r),this.txtTime=f.findChildComponent(this.node,"title/time",r);var t=f.findChildComponent(this.node,"scroll",a);this.scroll=this.view.addUIList(t,w,!1,0),this.scroll.touchEvent=!1},o.onRender=function(t,i){if(!this.view.isFirstOpen){var n=this.node.position;this.node.setPosition(360,n.y)}this.txtTitle.string=t[0],this.UpdateTime();for(var o,s=[],a=e(t[1]);!(o=a()).done;){var r=o.value,d=IS(y).GetPayGiftInfo(r.id);if(null!=d){if(0==d.payCfg.price&&2==d.rewardState)continue;s.push(r)}else s.push(r)}var h=Math.ceil(s.length/2),l=406*h+30*(h-1)+27+.01;this.scroll.height=l,this.scroll.datas=s,this.ut.height=130+l},o.PlayAnim=function(){this.anim.play()},o.UpdateTime=function(){if(d(this.txtTime))for(var t=0;t<this.data[1].length;t++){var i=this.data[1][t].id,e=IS(y).GetPayGiftInfo(i);if(null!=e){var n=e.end_time-p.serverTime;this.txtTime.string=p.formatENTimeStringForSecond(n);break}}},n}(m),w=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(i=t.call.apply(t,[this].concat(n))||this).txtName=void 0,i.txtPrice=void 0,i.txtDiscount=void 0,i.discountNode=void 0,i.btnBuy=void 0,i.rewardScroll=void 0,i.scrollNode=void 0,i.out=void 0,i.red=void 0,i.itemGridNode=void 0,i.itemGrid=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){var t=this;this.txtPrice=f.findChildComponent(this.node,"btnBuy/Label",r),this.txtName=f.findChildComponent(this.node,"txtName",r),this.txtDiscount=f.findChildComponent(this.node,"discount/Label",r),this.discountNode=f.findChild(this.node,"discount"),this.out=f.findChild(this.node,"out"),this.itemGridNode=f.findChild(this.node,"itemGrid"),this.itemGrid=new u(this.view,this.itemGridNode),this.red=f.findChild(this.node,"btnBuy/red"),this.btnBuy=f.findChild(this.node,"btnBuy"),this.view.addComponentCallbackListener(this.btnBuy,o.EventType.CLICK,(function(){0==t.data.price?IS(g).send_19_2(t.data.id):IS(y).Pay(t.data.id)}));var i=f.findChildComponent(this.node,"rewardScroll",a);this.scrollNode=i.node,this.rewardScroll=this.view.addUIList(i,x,!1,0),this.rewardScroll.touchEvent=!1},n.onRender=function(t,i){0==t.price?(this.txtPrice.string=GetLanguage(200045),this.red.active=!0):(this.txtPrice.string=IS(y).GetPriceString(t.cost_level),this.red.active=!1),0==t.ratio?this.discountNode.active=!1:(this.discountNode.active=!0,this.txtDiscount.string=100*t.ratio+"%");var e=IS(y).GetPayGiftInfo(t.id);this.out.active=!1,null!=e&&(e.payCfg.buy_times>0&&e.bought_times>=e.payCfg.buy_times?this.out.active=!0:0==e.payCfg.price&&2==e.rewardState&&(this.out.active=!0,this.red.active=!1)),t.buy_times>0?null!=e?0==e.payCfg.price&&2==e.rewardState?this.txtName.string=h.formatStr("%s(%s/%s)",t.name,t.buy_times,t.buy_times):this.txtName.string=h.formatStr("%s(%s/%s)",t.name,e.bought_times,t.buy_times):this.txtName.string=h.formatStr("%s(%s/%s)",t.name,0,t.buy_times):this.txtName.string=t.name,1==t.reward.length?(this.itemGridNode.active=!0,this.scrollNode.active=!1,this.itemGrid.SetItemId(t.reward[0][0],t.reward[0][1])):(this.itemGridNode.active=!1,this.scrollNode.active=!0,2==t.reward.length?this.scrollNode.setPosition(13,-40):this.scrollNode.setPosition(13,10),this.rewardScroll.datas=t.reward)},e}(m),x=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(i=t.call.apply(t,[this].concat(n))||this).imgFrame=void 0,i.imgIcon=void 0,i.txtNum=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){var t=this;this.imgFrame=f.findChildComponent(this.node,"imgFrame",l),this.imgIcon=f.findChildComponent(this.node,"imgIcon",l),this.txtNum=f.findChildComponent(this.node,"txtNum",r),this.view.addComponentCallbackListener(this.node,o.EventType.CLICK,(function(){IS(v).OpenItemTips(t.data[0],t.node)}))},n.onRender=function(t,i){var e,n=t[0],o=configGoods.getDataByKey(n),s=o.quality;this.txtNum.string=t[1],3==o.type?(e="icon_skill",this.imgIcon.node.setScale(.5,.5,.5)):4==o.type?(e="icon_pet",this.imgIcon.node.setScale(.6,.6,.6)):(e="icon_item",this.imgIcon.node.setScale(.7,.7,.7));var a=configColor.getDataByKey(s);this.view.loadIcon(this.imgIcon,e,o.icon),this.view.loadIcon(this.imgFrame,"icon_equip",a.path)},e}(m);n._RF.pop()}}}));

