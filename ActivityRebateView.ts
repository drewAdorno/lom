System.register("chunks:///_virtual/ActivityRebateView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./index3.ts","./UIList.ts","./UIRichText.ts","./NodeUtil.ts","./StorageUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./ConfigGlobal.ts","./MessageView.ts","./MainViewModel.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./ActivityRechargeControl.ts","./ActivityRechargeDataCache.ts","./UIDefine.ts","./EaseMethod.ts","./BaseView.ts"],(function(t){"use strict";var i,e,n,o,s,a,r,c,l,d,h,u,f,p,m,v,g,T,C,w,_,y,L,S,A,k,I,b,x;return{setters:[function(t){i=t.inheritsLoose,e=t.createForOfIteratorHelperLoose},function(t){n=t.cclegacy,o=t.Button,s=t.HorizontalTextAlignment,a=t.Label,r=t.Sprite,c=t.ScrollView,l=t.Toggle,d=t.js,h=t.randomRangeInt,u=t.RichText},null,function(t){f=t.ListItem},function(t){p=t.UIRichText},function(t){m=t.default},function(t){v=t.default},function(t){g=t.default},function(t){T=t.default},null,function(t){C=t.ConfigGlobal},function(t){w=t.default},function(t){_=t.MainViewModel},function(t){y=t.default},function(t){L=t.ActivityEventDefine,S=t.ActivityState},function(t){A=t.default},function(t){k=t.default},function(t){I=t.PanelTabType},function(t){b=t.EasingMethod},function(t){x=t.BaseView}],execute:function(){n._RF.push({},"b8870zQZIZABKXeMfMcHTvC","ActivityRebateView",void 0);t("default",function(t){function n(){var i;return(i=t.call(this)||this).nodeArr=void 0,i.txtCost=void 0,i.txtTimes=void 0,i.txtNeed=void 0,i.tipsScroll=void 0,i.skipAnim=void 0,i.togSkip=void 0,i.rerwardList=[],i.txtLeftTime=void 0,i.deltaTime=0,i.leftTime=0,i.canUpdate=!1,i.finalIndex=0,i.moveTween=void 0,i.reward_list=[],i.actionTime=3,i.tipsTimer=0,i.curTips=0,i.actType=void 0,i.name="ActivityRebateView",i.url="ui/module/activity/ActivityRebateView",i.actType=69,i}i(n,t);var u=n.prototype;return u.onInit=function(){var t=this,i=this.findChild("imgMask");this.addComponentCallbackListener(i,o.EventType.CLICK,(function(){t.close()}));var e=this.findChild("view/bg/tips");this.addComponentCallbackListener(e,o.EventType.CLICK,(function(){for(var i=C.LIMITED_RANK_SYSTEM_DETAILS,e="",n=0;n<i.length;n++)i[n][0]==t.actType&&(e=GetLanguage(i[n][1]));""!=e&&w.showBoxTip({tip:e,btnCnt:1,horizontalAlign:s.LEFT})})),this.txtLeftTime=this.findChildComponent("view/nodeTime/txtTime",a),this.txtCost=this.findChildComponent("view/turn/desc/cost/Label",a),this.txtTimes=this.findChildComponent("view/turn/desc/tips/Label",a),this.nodeArr=this.findChild("view/turn/arrow"),this.addComponentCallbackListener(this.nodeArr,o.EventType.CLICK,(function(){var i;(null!=(i=IS(k).getInfo(t.actType).last_count)?i:0)>0?IS(A).send_24_83(t.actType):w.showFlyTip(GetLanguage(14810084))}));for(var n=0;n<8;n++){var d=this.findChild("view/turn/roll/item"+(n+1)),h={node:d,index:n,cfg_id:0,img:m.findChildComponent(d,"img",r),ratio:m.findChildComponent(d,"ratio/img",r)};this.rerwardList.push(h)}var u=this.findChildComponent("view/record/ScrollView",c);this.tipsScroll=this.addUIList(u,M),this.txtNeed=this.findChildComponent("view/btn/tips",p);var f=this.findChild("view/btn");this.addComponentCallbackListener(f,o.EventType.CLICK,(function(){uiMgr.closeAllView(["MainView","MessageView","GuideView","BattleHubView"]),IS(_).TryJumpToMainViewPanel(I.Main_Shop,I.Shop_Cash)})),this.togSkip=this.findChildComponent("view/toggleSkip",l),this.addComponentCallbackListener(this.togSkip.node,l.EventType.TOGGLE,(function(){t.togSkip.isChecked?v.set("SkipAcRebateAnim","1"):v.set("SkipAcRebateAnim","0")})),this.loadIcon(this.findChildComponent("view/toggleSkip/Checkmark",r),"zqkh","zqkh_ui_gouxuan01"),this.skipAnim=this.findChild("skipAnim"),this.addComponentCallbackListener(this.skipAnim,o.EventType.CLICK,(function(){t.SkipAnim()}));var g=this.findChild("view/btnShow/btnShow");this.addComponentCallbackListener(g,o.EventType.CLICK,(function(){uiMgr.openView("ActivityRebateTipsView",t.actType)}))},u.registerUpdateHandler=function(){this.addEvent(L.OnActivityRebateInfoUpdate,this.updateInfo,this),this.addEvent(L.OnActivityRebateLottery,this.updateLotteryResult,this)},u.onAfterOpen=function(){var t;this.togSkip.isChecked="1"==v.get("SkipAcRebateAnim"),IS(A).send_24_82(this.actType),IS(A).send_24_84(this.actType),this.skipAnim.active=!1;var i=IS(y).GetActivityInfo(this.actType),e=null!=(t=i.state_time[i.state])?t:i.state_time[S.Open];this.leftTime=e.end_time-T.serverTime,this.leftTime>0?(this.canUpdate=!0,this.txtLeftTime.string=T.formatTimeStringForSecond(this.leftTime)):this.txtLeftTime.string=GetLanguage(200026)},u.onBeforeClose=function(){this.canUpdate=!1,this.tipsTimer=0},u.onDestroy=function(){},u.onUpdate=function(t){this.canUpdate&&(this.deltaTime=this.deltaTime+t,this.deltaTime>=1&&(this.deltaTime=0,this.leftTime=this.leftTime-1,this.leftTime>0?this.txtLeftTime.string=T.formatTimeStringForSecond(this.leftTime):(this.txtLeftTime.string=GetLanguage(200026),this.canUpdate=!1)))},u.updateInfo=function(){for(var t,i,n,o=this,s=IS(y).GetActivityInfo(this.actType),a=IS(k).getInfo(this.actType),r=configLucky_cat.getDataByKeys("type",s.type,"group_id",s.roundCfg.group_id),c=r.get_lucky_cat_cost,l=c[c.length-1][1],h=e(c);!(n=h()).done;){var u=n.value;if(u[0]==a.use_count+1){l=u[1];break}}this.txtCost.string=String(l/100);for(var f,p=[],m=configLucky_cat_reward.getDatas(),v=e(m);!(f=v()).done;){var T=f.value;1==T.time&&T.act_type==s.type&&T.activity_group==s.roundCfg.group_id&&p.push(T)}for(var C=0;C<8;C++){var w=p[C],_=this.rerwardList[C];_.cfg_id=w.id,this.loadIcon(_.img,"act_rebate",w.icon_picture),this.loadIcon(_.ratio,"act_rebate",w.per_picture)}if(this.txtTimes.string=g.formatStrWithMirrorDeal(GetLanguage(300058),null!=(t=a.last_count)?t:0),a.need_process&&0!=a.need_process){var L=d.formatStr("<b><outline width = 2 color=#462809><color=#ffffff>%s</color><color=#16ee5e>(%s)</color></outline></b>",g.formatStrWithMirrorDeal(GetLanguage(300059),a.need_process?a.need_process/100:0),g.formatStrWithMirrorDeal(GetLanguage(300159),r.get_lucky_cat_count-a.use_count-a.last_count));this.txtNeed.string=L}else this.txtNeed.string=d.formatStr("<b><outline width = 2 color=#462809><color=#FF0000>%s</color></outline></b>",GetLanguage(300161));this.tipsScroll.datas=null!=(i=a.report_list)?i:[],0!=this.tipsTimer&&this.removeTimer(this.tipsTimer),a.report_list&&a.report_list.length>0&&(this.tipsTimer=this.addTimer(1,-1,(function(){o.curTips=o.curTips+1,o.curTips==a.report_list.length&&(o.curTips=0);var t=0==o.curTips?0:1;o.tipsScroll.scrollTo(o.curTips,t)})))},u.updateLotteryResult=function(t){if(t.act_type==this.actType)if(this.togSkip.isChecked)uiMgr.openView("GoodsGetView",t.reward_list);else{for(var i,n=t.reward_id,o=e(this.rerwardList);!(i=o()).done;){var s=i.value;if(s.cfg_id==n){this.finalIndex=s.index;break}}this.reward_list=t.reward_list,this.skipAnim.active=!0,this.doLotteryTween()}},u.doLotteryTween=function(){var t=this;null!=this.moveTween&&this.moveTween.stop();var i=720+45*this.finalIndex+h(-15,15);i=-i,this.moveTween=this.addTween(0,1,this.actionTime,(function(e,n){t.nodeArr.angle=i*n})).easing(b.CUBIC_OUT).call((function(){uiMgr.openView("GoodsGetView",t.reward_list),t.skipAnim.active=!1}),.5).start()},u.SkipAnim=function(){null!=this.moveTween&&this.moveTween.stop();var t=720+45*this.finalIndex+h(-15,15);t=-t,this.nodeArr.angle=t,uiMgr.openView("GoodsGetView",this.reward_list),this.skipAnim.active=!1},n}(x));var M=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(i=t.call.apply(t,[this].concat(n))||this).txt=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){this.txt=m.findChildComponent(this.node,"txt",u)},n.onRender=function(t,i){var e=T.formatDate(T.ServerDate(1e3*t.time),GetLanguage(300056)),n=g.formatStrWithMirrorDeal(GetLanguage(300057),t.target_name,t.value/1e4);this.txt.string=d.formatStr("<b><color=#624324>%s%s</color><b>",e,n)},e}(f);n._RF.pop()}}}));

