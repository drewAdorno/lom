System.register("chunks:///_virtual/FlyPetSceneShowView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AudioMgr.ts","./index3.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./RoleDataCache.ts","./FlyPetControl.ts","./FlyPetDataCache.ts","./FlyPetDefine.ts","./EaseMethod.ts","./BaseView.ts"],(function(e){"use strict";var t,i,o,n,s,h,d,a,l,m,_,f,r,c,u,v,p;return{setters:[function(e){t=e.inheritsLoose},function(e){i=e.cclegacy,o=e.Button,n=e.Sprite,s=e.Label,h=e.ProgressBar,d=e.Vec2,a=e.Vec3},function(e){l=e.audioMgr},null,function(e){m=e.default},function(e){_=e.default},null,function(e){f=e.RoleDataCache},function(e){r=e.default},function(e){c=e.default},function(e){u=e.FlyPetEventDefine},function(e){v=e.EasingMethod},function(e){p=e.BaseView}],execute:function(){i._RF.push({},"29a4aYWxitNNo1C+pkOL5Fx","FlyPetSceneShowView",void 0);e("default",function(e){function i(){var t;return(t=e.call(this)||this).title=void 0,t.me_item={},t.other_item={},t.pet_state_1=void 0,t.pet_state_2=void 0,t.pet_state_3=void 0,t.pet_state_2_time=void 0,t.pet_state_2_slider=void 0,t.delate_time=0,t.is_tween_a=!1,t.is_tween_b=!1,t.nodeModelRoot1=void 0,t.nodeModelRoot2=void 0,t.nodeModelNode1=void 0,t.nodeModelNode2=void 0,t.titleLabel=void 0,t.modelPet1=void 0,t.modelPet2=void 0,t.moveTween1=void 0,t.moveTween2=void 0,t.speed1=50,t.speed2=50,t.wait_timer=void 0,t.home_id=void 0,t.home_info=void 0,t.is_can_run=!1,t.ice=void 0,t.ice1=void 0,t.ice_icon=void 0,t.name="FlyPetSceneShowView",t.url="ui/module/flypet/FlyPetSceneShowView",t.fullScreen=!0,t}t(i,e);var p=i.prototype;return p.onInit=function(){var e=this,t=this.findChild("btnMask");this.addComponentCallbackListener(t,o.EventType.CLICK,(function(){e.onMaskClick()}));var i=this.findChild("btnExit");this.addComponentCallbackListener(i,o.EventType.CLICK,(function(){e.onMaskClick()})),this.ice=this.findChild("ice"),this.ice1=this.findChild("ice1"),this.ice_icon=this.findChild("ice/icon");var d=this.findChild("me_item"),a=this.findChildComponent("me_item/frame",n),l=this.findChildComponent("me_item/icon",n),m=this.findChild("me_item/add");this.addComponentCallbackListener(d,o.EventType.CLICK,(function(){if(e.home_info.fly_a&&e.home_info.fly_a.id>0){var t=0;e.home_info.fly_a.role_id==IS(f).GetRoleId()&&(t=1),IS(r).send_66_31(e.home_info.fly_a.id,t)}else uiMgr.openView("FlyPetSelectView",e.home_info.id)})),this.me_item={node:d,frame:a,icon:l,add:m};var _=this.findChild("other_item"),c=this.findChildComponent("other_item/frame",n),u=this.findChildComponent("other_item/icon",n),v=this.findChild("other_item/add");this.addComponentCallbackListener(_,o.EventType.CLICK,(function(){if(e.home_info.fly_b&&e.home_info.fly_b.id>0){var t=0;e.home_info.fly_b.role_id==IS(f).GetRoleId()&&(t=1),IS(r).send_66_31(e.home_info.fly_b.id,t)}else uiMgr.openView("FlyPetSelectView",e.home_info.id)})),this.other_item={node:_,frame:c,icon:u,add:v},this.nodeModelRoot1=this.findChild("play_node/nodePlayer1"),this.nodeModelRoot2=this.findChild("play_node/nodePlayer2"),this.nodeModelNode1=this.findChild("play_node/nodePlayer1/rolemodel"),this.nodeModelNode2=this.findChild("play_node/nodePlayer2/rolemodel"),this.titleLabel=this.findChildComponent("titleBg/title",s),this.pet_state_1=this.findChild("state/state1"),this.pet_state_2=this.findChild("state/state2"),this.pet_state_3=this.findChild("state/state3"),this.pet_state_2_time=this.findChildComponent("state/state2/normal/time",s),this.pet_state_2_slider=this.findChildComponent("state/state2/normal/hp",h)},p.onMaskClick=function(){this.close()},p.onAfterOpen=function(){l.playMusic("bgm_peizhong"),this.delate_time=0,this.home_id=this.openArgs[0],this.home_info=IS(c).GetHomeById(this.home_id),""!=this.home_info.name?this.titleLabel.string=this.home_info.name:this.titleLabel.string=m.formatStrWithMirrorDeal(GetLanguage(205207),this.home_info.id),this.updatePetModelShow(),this.home_info&&2==this.home_info.state&&IS(r).send_66_28(this.home_id)},p.registerUpdateHandler=function(){this.addEvent(u.HomeListBack,this.updateData)},p.addUseTimer=function(){var e=this;this.wait_timer&&(this.removeTimer(this.wait_timer),this.wait_timer=null),this.wait_timer||(this.wait_timer=this.addTimer(1,-1,(function(){e.pet_state_2_time.string=_.formatTimeForSecond(e.home_info.end_time-_.serverTime);var t=(e.home_info.end_time-_.serverTime)/(e.home_info.end_time-e.home_info.start_time);e.pet_state_2_slider.progress=Math.min(1,t)})))},p.updatePetModelShow=function(){if(this.wait_timer&&(this.removeTimer(this.wait_timer),this.wait_timer=null),this.ice1.active=!1,this.ice.active=!0,this.ice_icon.active=1==this.home_info.state,this.pet_state_1.active=0==this.home_info.state,this.pet_state_2.active=1==this.home_info.state,this.pet_state_3.active=2==this.home_info.state,1==this.home_info.state){this.pet_state_2_time.string=_.formatTimeForSecond(this.home_info.end_time-_.serverTime);var e=(this.home_info.end_time-_.serverTime)/(this.home_info.end_time-this.home_info.start_time);this.pet_state_2_slider.progress=Math.min(1,e),this.addUseTimer()}if(null!=this.modelPet1&&(this.removeUIEffect(this.modelPet1),this.modelPet1=null),null!=this.modelPet2&&(this.removeUIEffect(this.modelPet2),this.modelPet2=null),this.is_can_run=!1,this.home_info.fly_a&&this.home_info.fly_a.id&&this.home_info.fly_b&&this.home_info.fly_b.id){this.me_item.add.active=!1,this.other_item.add.active=!1,this.me_item.icon.node.active=!0,this.other_item.icon.node.active=!0,this.is_can_run=!0,this.delate_time=0;var t=configFly.getDataByKey(this.home_info.fly_a.config_id),i=configUnitModel.getDataByKey(t.unitid),o=configFly.getDataByKey(this.home_info.fly_b.config_id),n=configUnitModel.getDataByKey(o.unitid);this.loadIcon(this.me_item.icon,"icon_flypet",t.icon),this.ice1.active=1==t.type,this.ice.active=1!=t.type,this.loadIcon(this.other_item.icon,"icon_flypet",o.icon),this.modelPet1=this.addUIEffect(i.path,this.nodeModelNode1,-1,new d(0,-60),i.scale/100*4),this.modelPet2=this.addUIEffect(n.path,this.nodeModelNode2,-1,new d(0,-60),n.scale/100*4),this.nodeModelRoot1.setPosition(this.GetRandomPoint()),this.nodeModelRoot2.setPosition(this.GetRandomPoint())}else this.me_item.add.active=!0,this.other_item.add.active=!0,this.me_item.icon.node.active=!1,this.other_item.icon.node.active=!1},p.onUpdate=function(e){this.is_can_run&&(this.delate_time+=e,this.delate_time>2&&this.tryTween())},p.tryTween=function(){var e=this;if(2*Math.random()>1)if(this.is_tween_a){if(!this.is_tween_b){this.is_tween_b=!0;var t=this.GetRandomPoint(),i=this.nodeModelRoot2.getPosition(),o=Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2))/this.speed2;t.x>=i.x?this.nodeModelRoot2.setScale(new a(1,1,1)):this.nodeModelRoot2.setScale(new a(-1,1,1)),this.moveTween2=this.addMoveTween(this.nodeModelRoot2,o,i.x,i.y,t.x,t.y,(function(){e.is_tween_b=!1,e.moveTween2&&(e.moveTween2.stop(),e.moveTween2=null)}))}}else{this.is_tween_a=!0;var n=this.GetRandomPoint(),s=this.nodeModelRoot1.getPosition(),h=Math.sqrt(Math.pow(n.x-s.x,2)+Math.pow(n.y-s.y,2))/this.speed1;n.x>=s.x?this.nodeModelRoot1.setScale(new a(1,1,1)):this.nodeModelRoot1.setScale(new a(-1,1,1)),this.moveTween1=this.addMoveTween(this.nodeModelRoot1,h,s.x,s.y,n.x,n.y,(function(){e.is_tween_a=!1,e.moveTween1&&(e.moveTween1.stop(),e.moveTween1=null)}))}},p.GetRandomPoint=function(){var e=720*Math.random()-360,t=620*Math.random()-310;return new a(e,t,0)},p.addMoveTween=function(e,t,i,o,n,s,h){return this.addTween(0,1,t,(function(t,h){var d=(n-i)*h+i,l=(s-o)*h+o;e.setPosition(new a(d,l,0))})).easing(v.LINEAR).call((function(){null!=h&&h()}),10*Math.random()).start()},p.onBeforeClose=function(){l.playMusic("battle"),null!=this.modelPet1&&(this.removeUIEffect(this.modelPet1),this.modelPet1=null),null!=this.modelPet2&&(this.removeUIEffect(this.modelPet2),this.modelPet2=null),this.moveTween1&&(this.moveTween1.stop(),this.moveTween1=null),this.moveTween2&&(this.moveTween2.stop(),this.moveTween2=null),this.wait_timer&&(this.removeTimer(this.wait_timer),this.wait_timer=null)},p.updateData=function(){this.home_info=IS(c).GetHomeById(this.home_id),this.home_info?this.updatePetModelShow():this.close()},p.onDestroy=function(){},i}(p));i._RF.pop()}}}));

