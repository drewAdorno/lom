System.register("chunks:///_virtual/BattleChapterTeam20Panel.ts",["cc","./BattleData.ts","./MetaAttrib.ts","./EventDefine.ts","./NodeUtil.ts","./TimeUtil.ts","./FixMath.ts","./ChapterDefine.ts","./MessageView.ts","./GuildWarControl.ts","./GuildWarDataCache.ts","./IBattleChapterPanel.ts"],(function(t){"use strict";var e,i,s,n,a,h,o,r,p,d,u,c,l,m,f,T,_,g,C;return{setters:[function(t){e=t.cclegacy,i=t.ProgressBar,s=t.Label,n=t.Sprite,a=t.UITransform,h=t.Button,o=t.math},function(t){r=t.ChapterType},function(t){p=t.AttribDefine},function(t){d=t.EventDefine},function(t){u=t.default},function(t){c=t.default},function(t){l=t.FixMath},function(t){m=t.ChapterEventDefine},function(t){f=t.default,T=t.TYPE_YES},function(t){_=t.default},function(t){g=t.GuildWarDataCache},function(t){C=t.BattleInfoType}],execute:function(){e._RF.push({},"eb4ccBnjitKi7sSzq1tc5kX","BattleChapterTeam20Panel",void 0);t("BattleChapterTeam20Panel",function(){function t(t,e){this.view=void 0,this.node=void 0,this.infoType=C.Team20,this.bottomY=20,this.nodeTime=void 0,this.pbTime=void 0,this.txtTime=void 0,this.txtChapter=void 0,this.pbBossHP=void 0,this.txtBossHP=void 0,this.chapterTime=0,this._progress=1,this._curPress=1,this._utBar=void 0,this._barAni=!1,this._lastTime=0,this._speed=3,this.txtLevel=void 0,this.node=e,this.view=t,this.onInit()}var e=t.prototype;return e.reset=function(){var t=configLeague_gve_chapter.getDataByKey(battleMain.data.chapterId);this.txtChapter.string=GetLanguage_UI(999000345)+" "+t.level,this.updateTime(),this.pbBossHP.progress=1,this._utBar.width=582},e.onInit=function(){var t=this;this.nodeTime=u.findChild(this.node,"time"),this.pbTime=u.findChildComponent(this.nodeTime,"pbTime",i),this.txtTime=u.findChildComponent(this.nodeTime,"txtTime",s);var e=u.findChildComponent(this.nodeTime,"Sprite",n);this.view.loadIcon(e,"battle","zxgq_ui_shijian"),this.txtChapter=u.findChildComponent(this.node,"txtChapter",s),this.pbBossHP=u.findChildComponent(this.node,"pbBossHP",i),this.txtBossHP=u.findChildComponent(this.node,"pbBossHP/txtBossHP",s),this._utBar=u.findChildComponent(this.node,"pbBossHP/imgBar",a),this.txtLevel=u.findChildComponent(this.node,"boss/txtLevel",s);var o=u.findChild(this.node,"btnExit");this.view.addComponentCallbackListener(o,h.EventType.CLICK,(function(){f.showBoxTip({tip:GetLanguage(300110),ensure:GetLanguage(200129),cancel:GetLanguage(200054),func:function(e){e==T&&t.exitBattle()}})}))},e.initBattleEvent=function(){battleEvent.on(d.BossHpChange,this.onBossHpChange,this),battleEvent.on(d.UnitHpNumChange,this.onUnitHpNumChange,this),this.onUnitHpNumChange(1)},e.onBossHpChange=function(t,e){this._progress=Math.min(1,t.data.currenHp/t.data.getAttrib(p.hp)),this.pbBossHP.progress=this._progress,this.txtBossHP.string=t.data.currenHp+"/"+t.data.getAttrib(p.hp)},e.onUnitHpNumChange=function(t){var e=t+configLeague_gve_chapter.getDataByKey(battleMain.data.chapterId).level-1;this.txtLevel.string=e>100?"Lv.âˆž":"Lv."+e,this._curPress=1,this._utBar.width=582*this._curPress},e.updateTime=function(){this.chapterTime!=battleMain.chapter.chapterTime&&(this.chapterTime=battleMain.chapter.chapterTime,this.txtTime.string=c.formatTimeForSecond(this.chapterTime),IS(g).in_sec+=1,!IS(g).popTips&&IS(g).in_sec>30&&(IS(g).popTips=!0,f.showFlyTip(GetLanguage(201891)))),this.pbTime.progress=battleMain.chapter.chapterTime/battleMain.chapter.maxChapterTime},e.updatePart=function(){},e.exitBattle=function(){uiMgr.close("ChatView"),IS(_).reqGuildBossExit(),battleMain.enterChapter(),battleMain.toResult(battleMain.data.chapterId,r.Team20,1,!1),normalEvent.emit(m.BATTLE_STATE,r.Team20,!1)},e.onUpdate=function(t){this.updateTime();var e=l.round(Math.abs(this._curPress-this._progress));if(this._barAni){if(this._lastTime=0,e<this._speed*t&&this._speed<=1)return this._barAni=!1,this._utBar.width=582*this._progress,void(this._curPress=this._progress);this._curPress=o.lerp(this._curPress,this._progress,this._speed*t),this._utBar.width=582*this._curPress,e=l.round(Math.abs(this._curPress-this._progress))}0!=e&&(this._lastTime+=t,this._lastTime>.3&&(this._barAni=!0,this._speed=o.clamp(1/(1-e),1,3)))},t}());e._RF.pop()}}}));

