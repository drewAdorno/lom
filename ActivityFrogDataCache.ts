System.register("chunks:///_virtual/ActivityFrogDataCache.ts",["./rollupPluginModLoBabelHelpers.js","cc","./RedPointMgr.ts","./StorageUtil.ts","./TimeUtil.ts","./index57.ts","./ConfigGlobal.ts","./BagDefine.ts","./BagModel.ts","./BattlePassControl.ts","./ChapterDefine.ts","./RoleDataCache.ts","./ActivityControl.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./HorseCarnivalDataCache.ts","./BaseView.ts"],(function(e){"use strict";var t,i,n,o,r,s,a,c,g,l,u,d,v,h,f,p,y,I,_,F,m;return{setters:[function(e){t=e.createForOfIteratorHelperLoose},function(e){i=e.cclegacy,n=e.js,o=e.Vec2},function(e){r=e.RedPointMgr},function(e){s=e.default},function(e){a=e.default},null,function(e){c=e.ConfigGlobal},function(e){g=e.BagEventDefine},function(e){l=e.BagModel},function(e){u=e.default},function(e){d=e.ChapterEventDefine},function(e){v=e.RoleDataCache},function(e){h=e.default},function(e){f=e.default},function(e){p=e.ActivityType,y=e.ActivityState,I=e.ActivityTaskState,_=e.ActivityEventDefine},function(e){F=e.HorseCarnivalDataCache},function(e){m=e.ViewEvent}],execute:function(){i._RF.push({},"5fec4W2Pk1CToBSp1rY2Q/9","ActivityFrogDataCache",void 0);e("default",function(){var e=i.prototype;function i(){this.curMoleLevelId=1,this.challengeLevelId=1,this.curChallengeLevelStage=0,this.challengeLevelStage=1,this.curMoleHammer=1,this.MoleMapCenter=new o(0,0),this.radiusCenter=30,this.radiusSecure=100,this.skillEnergy=100,this.skillDamage=1,this.skillCount=0,this.levelScore=1,this.levelTopScore=[],this.levelResult=1,this.levelKillInfo=void 0,this.leftHP=5,this.openLevelList=[1,2,3,4,5,6],this.openLevelID=1,this.openHammerList=[1,2,3],this.act_day=1,this.mapEdge=void 0,this.levelInfo=void 0,this.hammerInfo=void 0,this.sendProList=[{type:p.FrogFind,send:function(){IS(h).send_24_52(p.FrogFind)},redCheck:function(){}}],this.viewList=void 0,this.curOpen=0,this.otherViewNum=0,this.isDungeon=void 0,normalEvent.on(_.OnActivityListUpdate,this.activityChange,this),normalEvent.on(_.OnActivityInfoUpdate,this.activityChange,this),normalEvent.on(m.ViewOpen,this.onViewOpen,this),normalEvent.on(m.ViewClose,this.onViewClose,this),normalEvent.on(d.BATTLE_STATE,this.onBattleState,this),normalEvent.on(_.OnActivityFindUpdate,this.onActivityFindUpdate,this),normalEvent.on(g.GOODS_INFO_UPDATE,this.onBagUpdate,this)}return e.clear=function(){},e.activityChange=function(e){void 0===e&&(e=null),this.checkPop();var t=IS(f).GetActivityInfo(p.FrogFlappy);t&&t.state==y.Open&&IS(f).UpdateMainRedByActType(p.FrogFlappy);for(var i=0;i<this.sendProList.length;i++){var n=this.sendProList[i].type;if(!e||e.type==n){var o=IS(f).GetActivityInfo(n);o&&o.state==y.Open?this.sendProList[i].send():this.sendProList[i].redCheck&&this.sendProList[i].redCheck()}}},e.checkPop=function(){var e=IS(f).GetActivityInfo(p.Frog);if(e&&e.state==y.Open){var t,i=a.ServerDate(1e3*a.serverTime),o=n.formatStr("#%s#%s#%s",i.getFullYear(),i.getMonth()+1,i.getDate()),r="ActivityFrogPopView"+IS(v).GetRoleId();if((null!=(t=s.get(r))?t:"")==o)return;uiMgr.ViewIsAddPop("ActivityFrogPopView")||(uiMgr.addPopView("ActivityFrogPopView"),s.set(r,o))}},e.onViewOpen=function(e){if("ActivityFindIcon"!=e){var i=IS(f).GetActivityInfo(p.FrogFind);if(i&&i.state==y.Open){if(!this.viewList){this.viewList={};for(var n,o=configMoonfestival_search.getDatas(),r=t(o);!(n=r()).done;){var s=n.value;s.type==i.type&&s.group_id==i.roundCfg.group_id&&(this.viewList[s.system_view]=s.id)}}var a=this.viewList[e];if(a&&a==IS(f).getCurFind(p.FrogFind))this.curOpen=a,this.isDungeon||uiMgr.openView("ActivityFindIcon",a),this.otherViewNum=0;else if(0!=this.curOpen){var c=uiMgr.getOpenView("ActivityFindIcon");c&&c.close(),this.otherViewNum++}}}},e.onViewClose=function(e){if("ActivityFindIcon"!=e){var i=IS(f).GetActivityInfo(p.FrogFind);if(i&&i.state==y.Open){if(!this.viewList){this.viewList={};for(var n,o=configMoonfestival_search.getDatas(),r=t(o);!(n=r()).done;){var s=n.value;s.type==i.type&&s.group_id==i.roundCfg.group_id&&(this.viewList[s.system_view]=s.id)}}var a=this.viewList[e];if(a&&a==IS(f).getCurFind(p.FrogFind)){var c=uiMgr.getOpenView("ActivityFindIcon");c&&c.close(),this.curOpen=0,this.otherViewNum=0}else 0!=this.curOpen&&(this.otherViewNum--,0!=this.otherViewNum||this.isDungeon||uiMgr.openView("ActivityFindIcon",this.curOpen))}}},e.onBattleState=function(e,t){var i=IS(f).GetActivityInfo(p.FrogFind);if(i&&i.state==y.Open)if(t){this.isDungeon=!0;var n=uiMgr.getOpenView("ActivityFindIcon");n&&n.close()}else this.isDungeon=!1,0!=this.curOpen&&0==this.otherViewNum&&uiMgr.openView("ActivityFindIcon",this.curOpen)},e.onActivityFindUpdate=function(e){if(e&&e.act_type==p.FrogFind&&e.pig_id==this.curOpen){this.curOpen=0;var t=uiMgr.getOpenView("ActivityFindIcon");t&&t.close()}},e.onBagUpdate=function(e,t){1146==t&&(IS(f).UpdateMainRedByActType(p.FrogPass),IS(r).changeValue("frog_pass",this.getPassRedNum()));var i=IS(f).GetActivityInfo(p.FrogEgg);i&&i.state==y.Open&&t==c.break_gold_egg_expend.find((function(e){return e[0]==p.FrogEgg}))[1][0]&&(IS(f).UpdateMainRedByActType(p.FrogEgg),IS(r).changeValue("frog_egg",this.getEggRed()))},e.GetRedNum=function(){var e=0;return e+=this.GetStoreRed(),e+=this.getFindRedNum(),e+=this.getPassRedNum(),e+=this.getEggRed(),e=(e+=IS(F).getRedNum(p.FrogTurn))+IS(f).GetTaskRedNum(p.FrogGame)+(1==parseInt(s.get("FrogGame_NewLevel_"+IS(v).GetRoleId()))?1:0)},e.GetLoginRedNum=function(){var e,i=IS(f).GetActivityInfo(p.FrogLogin);if(!i||i.state!=y.Open)return 0;var n=IS(f).GetSignInfo(p.FrogLogin);if(!n)return 0;for(var o,r=null!=(e=n.get_day)?e:[],s=configAct_login.getDatas(),a=t(s);!(o=a()).done;){var c=o.value;if(c.act_type==i.type&&c.group_id==i.roundCfg.group_id&&n.day>=c.day&&!r.includes(c.id))return 1}return 0},e.GetStoreRed=function(){var e=IS(f).GetActivityInfo(p.Frog);if(!e||e.state!=y.Open)return 0;if(e){var t,i=String(e.id)+"#"+String(e.round),n="ActivityFrogStoreRed"+IS(v).GetRoleId();return(null!=(t=s.get(n))?t:"")==i?0:1}return 0},e.getFindRedNum=function(){var e=IS(f).GetActivityInfo(p.FrogFind);if(!e||e.state!=y.Open)return 0;var t=IS(f).getFindInfo(p.FrogFind);if(!t)return 0;var i=t.list;for(var n in i){if(i.hasOwnProperty(n))if(1==i[n])return 1}return 0==t.total_reward&&IS(f).isAllFind(p.FrogFind)?1:0},e.getPassRedNum=function(){var e=IS(f).GetActivityInfo(p.FrogPass);if(!e||e.state!=y.Open)return 0;var t=0,i=e.roundCfg.group_id;return t=(t=t+u.checkRewardRP(i)>=0?1:0)+u.checkAddRewardRP(i)>0?1:0,t+=u.checkSpecialRewardRP(i),IS(l).getGoodsCountByGoodsGtid(1146)>0&&t++,t},e.getEggRed=function(){var e=IS(f).GetActivityInfo(p.FrogEgg);if(!e||e.state!=y.Open)return 0;var i=c.break_gold_egg_expend.find((function(e){return e[0]==p.FrogEgg}))[1];if(IS(l).getGoodsCountByGoodsGtid(i[0])>=16)return 1;var n=0,o=IS(f).getEggInfo(p.FrogEgg);if(!o)return 0;for(var r,s=configBreak_cumulative_times.getDataByList("type",e.type),a=t(s);!(r=a()).done;){var g=r.value;if(!o.sum_rewards[g.id])break;n++}n>=s.length&&(n=s.length-1);var u=s[n];return!o.sum_rewards[u.id]&&o.total>=u.cumulative_times?1:0},e.updateLevelInfo=function(){var e=configMole_level.getDataByKey(this.curMoleLevelId);this.levelInfo={group:e.group,challenge_level:e.challenge_level,time:e.time,monster_id:this.curChallengeLevelStage>0?configMole_level.getDataByKey(this.openLevelID).monster_id:e.monster_id,guard_point:e.guard_point,enemy_refresh:e.enemy_refresh,enemy_nub:e.enemy_nub,boss:e.boss?e.boss:0,boss_id:e.boss_id?e.boss_id:[0,0],boss_time:e.boss_time?e.boss_time:0,hp_score:e.hp_score};var t=configMole_hammer.getDataByKey(this.curMoleHammer);this.hammerInfo={attack:t.attack,attack_range:t.attack_range,energy_multiplier:t.energy_multiplier/1e4,kill_multiplier:t.kill_multiplier/1e4};var i=configMole_main.getDataByKey(1);this.radiusCenter=i.guard_zone[1],this.radiusSecure=i.safety_zone[1],this.skillEnergy=i.special_move,this.skillDamage=i.special_move_damage},e.checkCurLevel=function(){this.curMoleLevelId=this.curMoleLevelId>this.challengeLevelId?this.challengeLevelId:this.curMoleLevelId},e.getFlappyFrogRed=function(){var e=IS(f).GetActivityInfo(p.FrogFlappy);if(!e||e.state!=y.Open)return 0;var t=[];for(var i in e.task_list)e.task_list.hasOwnProperty(i)&&t.push(e.task_list[i]);return t[0].state==I.CanGet?1:0},i}());i._RF.pop()}}}));

