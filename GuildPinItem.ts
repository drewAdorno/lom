System.register("chunks:///_virtual/GuildPinItem.ts",["cc","./ItemIcon.ts","./ConfigGlobal.ts","./GuildDefine.ts","./NodeUtil.ts"],(function(i){"use strict";var t,s,o,n,e,h,a,g,v,d;return{setters:[function(i){t=i.cclegacy,s=i.Vec3,o=i.UITransform,n=i.Color,e=i.Sprite,h=i.Node},function(i){a=i.IconAseetType},function(i){g=i.ConfigGlobal},function(i){v=i.FlagColorDefine},function(i){d=i.default}],execute:function(){t._RF.push({},"4ee3cbRVdRLoaMdPQrOcQWM","GuildPinItem",void 0);var c=g.guild_flag_moving_range;i("GuildPinItem",function(){function i(i,t,s){var n=this;void 0===s&&(s=!1),this.view=void 0,this.imgFram=void 0,this.imgFlag=void 0,this.imgMask=void 0,this.imgIcon=void 0,this.IconUt=void 0,this.change=void 0,this.changeUt=void 0,this.node=void 0,this.flagUt=void 0,this.posGo=void 0,this.posUt=void 0,this.rotaGo=void 0,this.rotaUt=void 0,this.isRotMoving=void 0,this.isPosMoving=void 0,this.isSizeMoving=void 0,this.saveAngleZ=0,this.savePos=void 0,this.drift=void 0,this.limitWidthMax=void 0,this.limitWidthMin=void 0,this.saveData=void 0,this.view=i,this.node=t,this.imgFram=d.findChildComponent(this.node,"imgFrame",e),this.imgFlag=d.findChildComponent(this.node,"imgFlag",e),this.flagUt=this.imgFlag.node.getComponent(o),this.imgMask=d.findChildComponent(this.node,"imgMask",e),this.imgIcon=d.findChildComponent(this.node,"imgMask/imgIcon",e),this.IconUt=this.imgIcon.node.getComponent(o),this.change=d.findChild(this.node,"change"),this.changeUt=this.change.getComponent(o),this.posGo=d.findChild(this.node,"change/pos"),this.posUt=this.posGo.getComponent(o),this.rotaGo=d.findChild(this.node,"change/rota"),this.rotaUt=this.rotaGo.getComponent(o),this.limitWidthMax=this.IconUt.width*g.guild_flag_design_size[1],this.limitWidthMin=this.IconUt.width*g.guild_flag_design_size[0],this.isRotMoving=!1,this.isPosMoving=!1,this.isSizeMoving=!1,this.change.active=s;for(var a=function(i){var t=d.findChild(n.node,"change/"+i);n.view.addComponentCallbackListener(t,h.EventType.TOUCH_START,(function(){n.onSizeTouchStart(i)})),n.view.addComponentCallbackListener(t,h.EventType.TOUCH_MOVE,(function(s){n.onSizeTouchMove(s,i,t)})),n.view.addComponentCallbackListener(t,h.EventType.TOUCH_END,(function(t){n.onSizeTouchEnd(t,i)})),n.view.addComponentCallbackListener(t,h.EventType.TOUCH_CANCEL,(function(t){n.onSizeTouchEnd(t,i)}))},v=0;v<4;v++)a(v);this.view.addComponentCallbackListener(this.rotaGo,h.EventType.TOUCH_START,(function(){n.onRotationTouchStart()})),this.view.addComponentCallbackListener(this.rotaGo,h.EventType.TOUCH_MOVE,(function(i){n.onRotationTouchMove(i)})),this.view.addComponentCallbackListener(this.rotaGo,h.EventType.TOUCH_END,(function(i){n.onRotationTouchEnd(i)})),this.view.addComponentCallbackListener(this.rotaGo,h.EventType.TOUCH_CANCEL,(function(i){n.onRotationTouchEnd(i)})),this.view.addComponentCallbackListener(this.posGo,h.EventType.TOUCH_START,(function(){n.onPositionTouchStart()})),this.view.addComponentCallbackListener(this.posGo,h.EventType.TOUCH_MOVE,(function(i){n.onPositionTouchMove(i)})),this.view.addComponentCallbackListener(this.posGo,h.EventType.TOUCH_END,(function(i){n.onPositionTouchEnd(i)})),this.view.addComponentCallbackListener(this.posGo,h.EventType.TOUCH_CANCEL,(function(i){n.onPositionTouchEnd(i)}))}var t=i.prototype;return t.onRotationTouchStart=function(){this.isRotMoving=!0},t.onRotationTouchMove=function(i){if(this.isRotMoving){var t=i.getUILocation(),o=new s(t.x,t.y,0),n=this.rotaUt.convertToNodeSpaceAR(o);this.ChangeIconRotation(Number((-.1*n.x).toFixed(0)))}},t.onRotationTouchEnd=function(i){this.isRotMoving&&(this.isRotMoving=!1)},t.onPositionTouchStart=function(){this.isPosMoving=!0},t.onPositionTouchMove=function(i){if(this.isPosMoving){var t=i.getUILocation(),o=new s(t.x,t.y,0),n=this.flagUt.convertToNodeSpaceAR(o),e=new s(Number(n.x.toFixed(0)),Number(n.y.toFixed(0)));this.ChangeIconPos(e)}},t.onPositionTouchEnd=function(i){this.isPosMoving&&(this.isPosMoving=!1)},t.onSizeTouchStart=function(i){this.isSizeMoving=!0},t.onSizeTouchMove=function(i,t,n){if(this.isSizeMoving){var e=i.getUILocation(),h=new s(e.x,e.y,0),a=n.getComponent(o).convertToNodeSpaceAR(h),g=Math.abs(a.x)>=Math.abs(a.y)?Math.abs(a.x):Math.abs(a.y);switch(t){case 0:a.x<=0&&a.y>=0?this.ChangeIconWidth(Number(g.toFixed(0))):this.ChangeIconWidth(Number((-g).toFixed(0)));break;case 1:a.x>=0&&a.y>=0?this.ChangeIconWidth(Number(g.toFixed(0))):this.ChangeIconWidth(Number((-g).toFixed(0)));break;case 2:a.x<=0&&a.y<=0?this.ChangeIconWidth(Number(g.toFixed(0))):this.ChangeIconWidth(Number((-g).toFixed(0)));break;case 3:a.x>=0&&a.y<=0?this.ChangeIconWidth(Number(g.toFixed(0))):this.ChangeIconWidth(Number((-g).toFixed(0)))}}},t.onSizeTouchEnd=function(i,t){this.isSizeMoving&&(this.isSizeMoving=!1,this.saveAngleZ>360&&(this.saveAngleZ=this.saveAngleZ-360),this.saveAngleZ<-360&&(this.saveAngleZ=this.saveAngleZ+360))},t.ChangePicData=function(i,t){switch(this.saveData[i-1].v=t,i){case 1:this.view.loadIcon(this.imgFlag,"icon_guildflag",g.guild_flag_shape[this.saveData[0].v-1][1]+"_1",null,a.ICON_SPRITE),this.view.loadIcon(this.imgFram,"icon_guildflag",g.guild_flag_shape[this.saveData[0].v-1][1]+"_2",null,a.ICON_SPRITE),this.view.loadIcon(this.imgMask,"icon_guildflag",g.guild_flag_shape[this.saveData[0].v-1][1]+"_3",null,a.ICON_SPRITE);break;case 2:this.imgFram.color=new n(v[this.saveData[1].v]);break;case 3:this.view.loadIcon(this.imgMask,"icon_guildflag",g.guild_flag_shape[this.saveData[0].v-1][1]+"_3",null,a.ICON_SPRITE),this.view.loadIcon(this.imgIcon,"icon_guildflag",g.guild_flag_design[this.saveData[2].v-1][1]+"",null,a.ICON_SPRITE,!0);break;case 4:this.imgIcon.color=new n(v[this.saveData[3].v])}},t.SetItem=function(i){if(void 0===i&&(i=null),i&&i.length>=8){this.saveData=i,this.saveAngleZ=i[4].v,this.savePos=new s(i[5].v,i[6].v);var t=128*Number((i[7].v/10).toFixed(1));this.IconUt.width=t,this.IconUt.height=t,this.changeUt.width=t,this.changeUt.height=t,this.posUt.width=t,this.posUt.height=t}else{this.saveAngleZ=0,this.savePos=new s(0,0);var o=128*Number(1..toFixed(1));this.IconUt.width=o,this.IconUt.height=o,this.changeUt.width=o,this.changeUt.height=o,this.posUt.width=o,this.posUt.height=o,this.saveData=[],this.saveData.push({k:1,v:g.guild_flag_default[0],s:""}),this.saveData.push({k:2,v:g.guild_flag_default[1],s:""}),this.saveData.push({k:3,v:g.guild_flag_default[2],s:""}),this.saveData.push({k:4,v:g.guild_flag_default[3],s:""}),this.saveData.push({k:5,v:0,s:""}),this.saveData.push({k:6,v:0,s:""}),this.saveData.push({k:7,v:24,s:""}),this.saveData.push({k:8,v:10,s:""})}this.view.loadIcon(this.imgFlag,"icon_guildflag",g.guild_flag_shape[this.saveData[0].v-1][1]+"_1",null,a.ICON_SPRITE),this.view.loadIcon(this.imgFram,"icon_guildflag",g.guild_flag_shape[this.saveData[0].v-1][1]+"_2",null,a.ICON_SPRITE),this.imgFram.color=new n(v[this.saveData[1].v]),this.view.loadIcon(this.imgMask,"icon_guildflag",g.guild_flag_shape[this.saveData[0].v-1][1]+"_3",null,a.ICON_SPRITE),this.view.loadIcon(this.imgIcon,"icon_guildflag",g.guild_flag_design[this.saveData[2].v-1][1]+"",null,a.ICON_SPRITE,!0),this.imgIcon.color=new n(v[this.saveData[3].v]),this.imgIcon.node.position=this.savePos,this.change.position=this.savePos,this.imgIcon.node.setRotationFromEuler(0,0,this.saveAngleZ),this.change.setRotationFromEuler(0,0,this.saveAngleZ)},t.ChangeIconPos=function(i,t){void 0===t&&(t=!0);var s=i;i.x>=c[1]&&(s.x=c[1]),i.x<=c[0]&&(s.x=c[0]),i.y>=c[1]&&(s.y=c[1]),i.y<=c[0]&&(s.y=c[0]),this.imgIcon.node.position=s,this.change.position=s,t&&(this.savePos=s)},t.ChangeIconRotation=function(i){this.saveAngleZ=this.saveAngleZ+i,this.saveAngleZ>360&&(this.saveAngleZ=this.saveAngleZ-360),this.saveAngleZ<-360&&(this.saveAngleZ=this.saveAngleZ+360),this.imgIcon.node.setRotationFromEuler(0,0,this.saveAngleZ),this.change.setRotationFromEuler(0,0,this.saveAngleZ)},t.ChangeIconWidth=function(i){var t=Number((this.IconUt.width+i).toFixed(0));if(t>=this.limitWidthMax||t<=this.limitWidthMin){var s=t>=this.limitWidthMax?this.limitWidthMax:this.limitWidthMin;this.IconUt.width=s,this.IconUt.height=s,this.changeUt.width=s,this.changeUt.height=s,this.posUt.width=s,this.posUt.height=s}else this.IconUt.width=t,this.IconUt.height=t,this.changeUt.width=t,this.changeUt.height=t,this.posUt.width=t,this.posUt.height=t},t.SetChange=function(i){void 0===i&&(i=!1),this.change.active=i},t.SaveData=function(){this.saveAngleZ>360&&(this.saveAngleZ=this.saveAngleZ-360),this.saveAngleZ<-360&&(this.saveAngleZ=this.saveAngleZ+360),this.saveData[4].v=this.saveAngleZ,this.saveData[5].v=this.savePos.x,this.saveData[6].v=this.savePos.y,this.saveData[7].v=10*Number((this.IconUt.width/128).toFixed(1))},i}());t._RF.pop()}}}));

