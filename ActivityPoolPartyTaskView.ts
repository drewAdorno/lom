System.register("chunks:///_virtual/ActivityPoolPartyTaskView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./MessageView.ts","./ActivityControl.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./HorseCarnivalDataCache.ts","./ActivityPoolPartyDataCache.ts","./BaseView.ts"],(function(t){"use strict";var e,i,n,s,o,a,r,d,h,c,l,v,f,u,g,m,y,p,T,C,w,A;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,n=t.Button,s=t.Label,o=t.ScrollView,a=t.ProgressBar,r=t.sys},function(t){d=t.ItemGrid},function(t){h=t.ListItem},function(t){c=t.default},function(t){l=t.default},function(t){v=t.default},null,function(t){f=t.default},function(t){u=t.default},function(t){g=t.default},function(t){m=t.ActivityEventDefine,y=t.ActivityTaskState,p=t.ActivityType,T=t.ActivityState},function(t){C=t.HorseCarnivalDataCache},function(t){w=t.default},function(t){A=t.BaseView}],execute:function(){i._RF.push({},"a873eZiyiBJW7A9FNFnyePv","ActivityPoolPartyTaskView",void 0);t("default",function(t){function i(){var e;return(e=t.call(this)||this).txtLeftTime=void 0,e.taskList=void 0,e.deltaTime=0,e.leftTime=0,e.canUpdate=!1,e.showNodeActInfoIdx=void 0,e.showNodeActNode=[],e.showNodeByAct=[{Activity:[p.PoolPartyTurn],nodeList:[],closeBtn:"container/btnClose"},{Activity:[p.PoolPartyEndTurn],nodeList:[],closeBtn:"container/btnClose"}],e.name="ActivityPoolPartyTaskView",e.url="ui/module/activityPoolParty/ActivityPoolPartyTaskView",e}e(i,t);var a=i.prototype;return a.onInit=function(){var t=this,e=this.findChild("imgMask");this.addComponentCallbackListener(e,n.EventType.CLICK,(function(){t.close()})),this.initActCloseNode(),this.txtLeftTime=this.findChildComponent("container/bg/nodeTime/txtTime",s);var i=this.findChildComponent("container/taskList",o);this.taskList=this.addUIList(i,G)},a.registerUpdateHandler=function(){this.addEvent(m.OnActivityInfoTaskUpdate,this.OnTaskUpdate,this),this.addEvent(m.OnActivityInfoUpdate,this.OnTaskUpdate,this)},a.initActCloseNode=function(){for(var t=this,e=0;e<this.showNodeByAct.length;e++){var i=this.showNodeByAct[e].nodeList;this.showNodeByAct[e].closeBtn&&this.addComponentCallbackListener(this.findChild(this.showNodeByAct[e].closeBtn),n.EventType.CLICK,(function(){t.close()}));for(var s=[],o=0;o<i.length;o++){var a=i[o];s.push(this.findChild(a))}this.showNodeActNode[e]=s}},a.showActNode=function(){var t=IS(w).GetShowActNodeIdx(this.showNodeByAct,this.openArgs[0]);if(this.showNodeActInfoIdx!=t){this.showNodeActInfoIdx=t;for(var e=0;e<this.showNodeActNode.length;e++)for(var i=this.showNodeActNode[e],n=0;n<i.length;n++)i[n].active=t==e}},a.onAfterOpen=function(){IS(u).send_24_14(this.openArgs[0]),this.showActNode(),this.canUpdate=!0;var t=v.ServerDate(1e3*(v.serverTime+86400)),e=l.formatStrWithMirrorDeal(GetLanguage(700030181),t.getFullYear(),t.getMonth()+1,t.getDate(),0,0,0),i=v.getServerDateByLocalStr(e).getTime()/1e3;this.leftTime=i-v.serverTime,this.leftTime>=0&&(this.txtLeftTime.string=l.formatStrWithMirrorDeal(GetLanguage(200980),v.formatTimeStringForSecond(this.leftTime))),this.OnTaskUpdate()},a.onBeforeClose=function(){this.canUpdate=!1},a.onDestroy=function(){},a.onUpdate=function(t){if(this.canUpdate&&(this.deltaTime=this.deltaTime+t,this.deltaTime>=1&&(this.deltaTime=0,this.leftTime=this.leftTime-1,this.leftTime>=0))){this.txtLeftTime.string=v.formatTimeStringForSecond(this.leftTime);var e=v.ServerDate(1e3*(v.serverTime+86400)),i=l.formatStrWithMirrorDeal(GetLanguage(700030181),e.getFullYear(),e.getMonth()+1,e.getDate(),0,0,0),n=v.getServerDateByLocalStr(i).getTime()/1e3;this.leftTime=n-v.serverTime,this.leftTime>0&&(this.txtLeftTime.string=v.formatTimeStringForSecond(this.leftTime))}},a.OnTaskUpdate=function(){var t=IS(g).GetActivityInfo(this.openArgs[0]),e=[];for(var i in t.task_list)t.task_list.hasOwnProperty(i)&&e.push(t.task_list[i]);e.sort((function(t,e){return 0==t.id||0==e.id?0==t.id?-1:1:t.state==y.CanGet&&e.state!=y.CanGet?-1:t.state!=y.CanGet&&e.state==y.CanGet?1:t.state!=e.state?t.state-e.state:t.id-e.id})),e.unshift({id:0}),e.unshift({id:0}),this.taskList.datas=e},i}(A));var G=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))||this).txtDesc=void 0,e.btnGo=void 0,e.btnGet=void 0,e.received=void 0,e.undone=void 0,e.pb=void 0,e.schedule=void 0,e.itemGridNode=void 0,e.itemGrid=void 0,e.bg=void 0,e.bg2=void 0,e.txtDesc2=void 0,e}e(i,t);var o=i.prototype;return o.onInit=function(){var t=this;this.bg=c.findChild(this.node,"imgBg"),this.bg2=c.findChild(this.node,"imgBg2"),this.itemGridNode=c.findChild(this.node,"itemGrid"),this.itemGrid=new d(this.view,this.itemGridNode),this.txtDesc=c.findChildComponent(this.node,"txtDesc",s),this.txtDesc2=c.findChildComponent(this.node,"txtDesc2",s),this.pb=c.findChildComponent(this.node,"ProgressBar",a),this.schedule=c.findChildComponent(this.node,"ProgressBar/schedule",s),this.received=c.findChild(this.node,"received"),this.undone=c.findChild(this.node,"undone"),this.btnGet=c.findChild(this.node,"btnGet"),this.view.addComponentCallbackListener(this.btnGet,n.EventType.CLICK,(function(){IS(u).send_24_15(t.view.openArgs[0],t.data.task_id,t.data.group_id)})),this.btnGo=c.findChild(this.node,"btnGo"),this.view.addComponentCallbackListener(this.btnGo,n.EventType.CLICK,(function(){if(0==t.index)t.view.openArgs[0]==p.PoolPartyTurn?uiMgr.openView("ActivityPoolPartyTurnView"):uiMgr.openView("ActivityPoolPartyEndTurnView");else{var e=IS(g).GetActivityInfo(p.PoolPartyEgg);if(e&&e.state==T.Open)uiMgr.openView("ActivityPoolPartyEggView");else if(e&&e.state==T.Preview){var i=e.state_time[T.Open].start_time-v.serverTime;f.showFlyTip(l.formatStrWithMirrorDeal(GetLanguage(201410),v.formatTimeStringForSecond(i)))}else f.showFlyTip(GetLanguage(200026))}t.view.close()}))},o.onRender=function(t,e){if(0==t.id)if(this.btnGo.active=!0,this.pb.node.active=!1,this.received.active=!1,this.undone.active=!1,this.btnGet.active=!1,this.bg.active=!1,this.bg2.active=!0,this.txtDesc.string="",0==e){var i=IS(C).GetDrawReward(this.view.openArgs[0]),n=configGoods.getDataByKey(i[0]);this.txtDesc2.string=l.formatStr(GetLanguage(201749),i[1],n.name),this.itemGrid.SetItemId(i[0],i[1])}else{var s=IS(C).GetDrawReward(this.view.openArgs[0]),o=configGoods.getDataByKey(s[0]);this.txtDesc2.string=l.formatStr(GetLanguage(205480),s[1],o.name),this.itemGrid.SetItemId(s[0],s[1])}else{this.btnGo.active=!1,this.pb.node.active=!0,this.bg.active=!0,this.bg2.active=!1,this.txtDesc.string=t.cfg.desc,this.txtDesc2.string="",this.itemGrid.SetItemId(t.cfg.reward[0][0],t.cfg.reward[0][1]);var a=t.cfg.condition[2];this.schedule.string=r.uiMirror?a+"/"+Math.min(a,t.count):Math.min(a,t.count)+"/"+a,this.pb.progress=t.count/t.cfg.condition[2],t.state==y.CanGet?(this.received.active=!1,this.undone.active=!1,this.btnGet.active=!0):t.state==y.HadGet?(this.received.active=!0,this.undone.active=!1,this.btnGet.active=!1):(this.received.active=!1,this.undone.active=!0,this.btnGet.active=!1)}},i}(h);i._RF.pop()}}}));

