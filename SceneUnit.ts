System.register("chunks:///_virtual/SceneUnit.ts",["./rollupPluginModLoBabelHelpers.js","cc","./V2.ts","./UIEffectAsset.ts","./PolyNavAgent.ts","./NodeUtil.ts","./SpineSkeleton.ts","./TowerGameDefine.ts"],(function(t){"use strict";var e,i,o,n,s,a,r,d,h,c,p,l;return{setters:[function(t){e=t.inheritsLoose,i=t.createClass},function(t){o=t.cclegacy,n=t.Vec2,s=t.Rect},function(t){a=t.V2},function(t){r=t.UIEffectAsset},function(t){d=t.PolyNavAgent},function(t){h=t.default},function(t){c=t.SpineSkeleton},function(t){p=t.RoleBirthPoint,l=t.MoveSpeed}],execute:function(){o._RF.push({},"07f71trVCBOGoSO0g4MInG/","SceneUnit",void 0);var u=t("SceneUnit",function(){function t(){this.id=void 0,this.uid=0,this.del=!1,this.isDestroy=!1,this.type=1,this.rect=new s}var e=t.prototype;return e.update=function(t){this.del||this.onUpdate(t)},e.destroy=function(){this.isDestroy||(this.isDestroy=!0,this.del=!0,this.onDestroy())},t}());t("SceneRole",function(t){function o(e,i){var o;return(o=t.call(this)||this).map=void 0,o.info=void 0,o.model=void 0,o.moveType=0,o.velocity=void 0,o.target=void 0,o.pos=void 0,o.btnBreak=void 0,o.nodePb=void 0,o.pbPicking=void 0,o.pickingNum=0,o.animator=void 0,o.isAttackCD=void 0,o.lastAttackTime=0,o.info=i,o.uid=i.role_id,o.map=e,o.pos=new a(i.pos.x,i.pos.y),o.id="role:"+i.role_id,o}e(o,t);var n=o.prototype;return n.onUpdate=function(t){this.del||this.isAttackCD&&((new Date).getTime()-this.lastAttackTime)/1e3>1/this.info.attackSpeed&&(this.isAttackCD=!1)},n.tryAttack=function(){return!this.isAttackCD&&(this.lastAttackTime=(new Date).getTime(),this.isAttackCD=!0,!0)},n.onDestroy=function(){},i(o,[{key:"position",get:function(){return this.pos},set:function(t){this.pos=t}},{key:"depth",get:function(){return this.model.depth},set:function(t){this.model.depth=t}}]),o}(u)),t("SceneMonster",function(t){function o(e,i,o){var n;switch((n=t.call(this)||this).model=void 0,n.agent=void 0,n.moveType=0,n.animator=void 0,n.dir=void 0,n.point=void 0,n.hp=void 0,n.type=2,o){case 1:n.model=r.alloc("prefab/model/MX_jy_banlanjuxi",e.nodeUnit,-1);break;case 2:n.model=r.alloc("prefab/model/MX_jy_baobaoxueshanlang",e.nodeUnit,-1);break;case 3:n.model=r.alloc("prefab/model/MX_jy_shuyao",e.nodeUnit,-1);break;case 4:n.model=r.alloc("prefab/model/MX_jy_juxingwugong",e.nodeUnit,-1)}n.id="monster:"+i.monster_id;var s=new a(i.pos.x,i.pos.y);return n.model.position=s,n.agent=new d(e.polyNav),n.agent.pos.set(s.x,s.y),n.agent.maxSpeed=l,n.hp=i.hp,n.point=i.point,n}e(o,t);var s=o.prototype;return s.onDestroy=function(){this.model&&this.model.free()},s.onUpdate=function(t){if(!this.del){if(0==this.moveType&&this.moveToTarget(new n(p.x,p.y)),this.agent.onUpdate(t),this.model.node&&1==this.moveType){this.animator||(this.animator=h.findChildComponent(this.model.node,"model",c));var e=this.animator;this.agent.isMove?"run"!=e.animation&&e.setAnimation(0,"run",!0):("idle"!=e.animation&&e.setAnimation(0,"idle",!0),this.moveType=0)}this.rect.center=this.agent.pos,this.model.position=this.agent.pos;var i=this.agent.dir;if(this.model.node&&i!=this.dir){var o=1==i?0:-1;this.model.node.setRotationFromEuler(0,180*o,0),this.dir=i}}},s.moveToTarget=function(t){return!(n.distance(this.position,t)<1)&&(this.agent.activePath.push(t),this.moveType=1,this.agent.isMove=!0,!0)},s.hit=function(t){return this.hp=this.hp-t,this.hp<=0},i(o,[{key:"position",get:function(){return this.model.position},set:function(t){this.model.position=t}},{key:"depth",get:function(){return this.model.depth},set:function(t){this.model.depth=t}}]),o}(u));o._RF.pop()}}}));

