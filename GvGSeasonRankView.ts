System.register("chunks:///_virtual/GvGSeasonRankView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./V2.ts","./GuildPinItem.ts","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./BaseView.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./CommonModel.ts","./FriendControl.ts","./GuildControl.ts","./GuildDataCache.ts","./RankControl.ts","./RankDefine.ts","./RankModel.ts","./RoleDataCache.ts","./RoleDefine.ts","./GvGDataCache.ts","./GvGDefine.ts"],(function(t){"use strict";var i,n,e,o,r,a,s,d,h,c,l,m,f,v,u,y,g,p,k,I,C,R,S,w,x,_,T,G;return{setters:[function(t){i=t.inheritsLoose},function(t){n=t.cclegacy,e=t.Button,o=t.Label,r=t.Sprite,a=t.ScrollView,s=t.js,d=t.sys},function(t){h=t.V2},function(t){c=t.GuildPinItem},function(t){l=t.ItemGrid},function(t){m=t.ListItem},function(t){f=t.default},function(t){v=t.default},function(t){u=t.BaseView},function(t){y=t.default},function(t){g=t.ActivityType},function(t){p=t.CommonModel},function(t){k=t.default},function(t){I=t.default},function(t){C=t.default},function(t){R=t.default},function(t){S=t.RankDefine},function(t){w=t.RankModel},function(t){x=t.RoleDataCache},function(t){_=t.PlayerAttr},function(t){T=t.GvGDataCache},function(t){G=t.GvGRoleRankToRankIcon}],execute:function(){var L,M;n._RF.push({},"26c76t3hfpMzY6yY98K6cn5","GvGSeasonRankView",void 0);var F=1,N=2,b=3,A=4,B=((L={})[F]="",L[N]="",L[b]="",L[A]="",L),D=((M={})[1]=new h(0,0),M[2]=new h(0,0),M[3]=new h(0,0),M),P=(t("default",function(t){function n(){var i,n,e;return(e=t.call(this)||this).curType=void 0,e.rankList=void 0,e.typeItems=void 0,e.nodeReward=void 0,e.nodeRank=void 0,e.nodeRewardBg=void 0,e.nodeRankBg=void 0,e.nodeGuildTop=void 0,e.nodePlayerTop=void 0,e.myFrame=void 0,e.myIcon=void 0,e.myFlag=void 0,e.txtMyRank=void 0,e.txtMyScore=void 0,e.txtMyName=void 0,e.txtMyServer=void 0,e.myRewardFrame=void 0,e.myRewardIcon=void 0,e.myRewardFlag=void 0,e.txtRewardMyRank=void 0,e.txtRewardMyScore=void 0,e.txtRewardMyName=void 0,e.txtRewardMyServer=void 0,e.guildTopList={},e.playerTopList={},e.rewardList=void 0,e.btnServer=void 0,e.rankId=((i={})[F]=0,i[N]=0,i[b]=0,i[A]=0,i),e.curRankPage=((n={})[F]=0,n[N]=0,n[b]=0,n[A]=0,n),e.rankInfo=void 0,e.name="GvGSeasonRankView",e.url="ui/module/gvg/GvGSeasonRankView",e}i(n,t);var d=n.prototype;return d.onInit=function(){var t=this,i=this.findChild("imgMask");this.addComponentCallbackListener(i,e.EventType.CLICK,(function(){t.onMaskClick()}));var n=this.findChild("content/btnClose");this.addComponentCallbackListener(n,e.EventType.CLICK,(function(){t.close()})),this.btnServer=this.findChild("content/title/btnServer"),this.addComponentCallbackListener(this.btnServer,e.EventType.CLICK,(function(){uiMgr.openView("GvGJoinServerListView")})),this.nodeReward=this.findChild("content/nodeReward"),this.nodeRank=this.findChild("content/nodeRank"),this.nodeRewardBg=this.findChild("content/imgBgReward"),this.nodeRankBg=this.findChild("content/imgBgRank"),this.nodeGuildTop=this.findChild("content/guildTopRank"),this.nodePlayerTop=this.findChild("content/playerTopRank"),this.typeItems=[];for(var d=function(i){var n=t.findChild(s.formatStr("content/bottomBtns/btnRanking%s",i));t.addComponentCallbackListener(n,e.EventType.CLICK,(function(){t.curType!=i&&(t.curType=i,t.updateContent())})),t.typeItems.push({node:n,nodeSelect:f.findChild(n,"imgSelect"),type:i})},h=1;h<=4;h++)d(h);this.txtMyRank=this.findChildComponent("content/nodeRank/myRank/rankNum",o),this.txtMyScore=this.findChildComponent("content/nodeRank/myRank/score",o),this.txtMyName=this.findChildComponent("content/nodeRank/myRank/info/name",o),this.txtMyServer=this.findChildComponent("content/nodeRank/myRank/info/txtServer",o),this.myFrame=this.findChildComponent("content/nodeRank/myRank/imgFrame",r),this.myIcon=this.findChildComponent("content/nodeRank/myRank/imgFrame/imgIcon",r),this.myFlag=new c(this,f.findChild(this.node,"content/nodeRank/myRank/GuildPinItem")),this.txtRewardMyRank=this.findChildComponent("content/nodeReward/myRank/rankNum",o),this.txtRewardMyScore=this.findChildComponent("content/nodeReward/myRank/score",o),this.txtRewardMyName=this.findChildComponent("content/nodeReward/myRank/info/name",o),this.txtRewardMyServer=this.findChildComponent("content/nodeReward/myRank/info/txtServer",o),this.myRewardFrame=this.findChildComponent("content/nodeReward/myRank/imgFrame",r),this.myRewardIcon=this.findChildComponent("content/nodeReward/myRank/imgFrame/imgIcon",r),this.myRewardFlag=new c(this,f.findChild(this.node,"content/nodeReward/myRank/GuildPinItem"));var l=this.findChildComponent("content/nodeRank/rankList",a);this.rankList=this.addUIList(l,P),this.addComponentCallbackListener(l.node,a.EventType.SCROLL_TO_BOTTOM,(function(){if(t.curRankPage[t.curType]<t.rankInfo.max_page){t.curRankPage[t.curType]++;var i=new Array;i.push({type:t.rankId[t.curType],server:1,page:t.curRankPage[t.curType]}),IS(R).reqRankList(i)}}));var m=this.findChildComponent("content/nodeReward/rankList",a);this.rewardList=this.addUIList(m,E,!0);for(var v=1;v<=3;v++){var u=new K;u.init(this.findChild("content/guildTopRank/rank"+v),this,v),this.guildTopList[v]=u}for(var y=1;y<=3;y++){var g=new U;g.init(this.findChild("content/playerTopRank/rank"+y),this,y),this.playerTopList[y]=g}},d.registerUpdateHandler=function(){this.addEvent(S.RankInfoBack,this.UpdateRankInfo,this)},d.onMaskClick=function(){this.close()},d.onAfterOpen=function(){var t,i,n;for(var e in this.guildTopList)this.guildTopList.hasOwnProperty(e)&&this.guildTopList[e].show();for(var o in this.playerTopList)this.playerTopList.hasOwnProperty(o)&&this.playerTopList[o].show();this.btnServer.active=1==IS(T).ifCross;var r=IS(y).GetActivityInfo(g.GvG),a=configFamiliybrawl.getDataByKey(r.roundCfg.group_id);this.rankId=((t={})[F]=a.self_rank_cross_id,t[N]=a.self_rank_cross_id,t[b]=a.family_rank_cross_id,t[A]=a.family_rank_cross_id,t);var s=configRanktype.getDataByKey(a.self_rank_cross_id),d=configRanktype.getDataByKey(a.family_rank_cross_id);(i={})[F]=s.prefix,i[N]=s.prefix,i[b]=d.prefix,i[A]=d.prefix,B=i,this.curRankPage=((n={})[F]=1,n[N]=1,n[b]=1,n[A]=1,n);var h=new Array;h.push({type:this.rankId[F],server:1,page:1}),IS(R).reqRankList(h);var c=new Array;c.push({type:this.rankId[b],server:1,page:1}),IS(R).reqRankList(c),this.curType=1,this.updateContent()},d.updateContent=function(){for(var t=0;t<this.typeItems.length;t++){var i=this.typeItems[t];i.nodeSelect.active=i.type==this.curType}if(this.nodeRank.active=this.curType==F||this.curType==b,this.nodeReward.active=this.curType==N||this.curType==A,this.nodeRankBg.active=this.curType==F||this.curType==b,this.nodeRewardBg.active=this.curType==N||this.curType==A,this.curType==b||this.curType==A){if(this.nodeGuildTop.active=!0,this.nodePlayerTop.active=!1,this.curType==b){if(this.myFrame.node.active=!1,IS(x).HasGuild()){var n=IS(C).GetGuildInfo();this.txtMyName.string=n.name,this.myFlag.node.active=!0,this.myFlag.SetItem(n.guild_flag),this.txtMyServer.node.active=1==IS(T).ifCross,1==IS(T).ifCross&&(this.txtMyServer.string=s.formatStr("[s%s]",IS(x).GetServerId()))}else this.txtMyName.string=GetLanguage(200083),this.myFlag.node.active=!1,this.txtMyServer.node.active=!1;this.rankList.scrollTo(0,0)}else{if(this.myRewardFrame.node.active=!1,IS(x).HasGuild()){var e=IS(C).GetGuildInfo();this.txtRewardMyName.string=e.name,this.myRewardFlag.node.active=!0,this.myRewardFlag.SetItem(e.guild_flag),this.txtRewardMyServer.node.active=1==IS(T).ifCross,1==IS(T).ifCross&&(this.txtRewardMyServer.string=s.formatStr("[s%s]",IS(x).GetServerId()))}else this.txtRewardMyName.string=GetLanguage(200083),this.myRewardFlag.node.active=!1,this.txtRewardMyServer.node.active=!1;var o=IS(y).GetActivityInfo(g.GvG),r=configFamiliybrawl.getDataByKey(o.roundCfg.group_id),a=[].concat(configFamiliybrawl_rank_reward.getDataByList("group",r.family_rank_cross_reward));a.sort((function(t,i){return t.rank_range[0]-i.rank_range[0]})),this.rewardList.datas=a,this.rewardList.scrollTo(0,0)}this.UpdateRankInfo()}else if(this.curType==F||this.curType==N){if(this.nodeGuildTop.active=!1,this.nodePlayerTop.active=!0,this.curType==F)this.myFlag.node.active=!1,this.myFrame.node.active=!0,this.txtMyServer.node.active=1==IS(T).ifCross,1==IS(T).ifCross&&(this.txtMyServer.string=s.formatStr("[s%s]",IS(x).GetServerId())),this.txtMyName.string=IS(x).GetRoleAttr(_.ROLE_ATTR_NAME),this.loadRemoteIcon(IS(x).GetRoleAttr(_.ROLE_ATTR_HEAD_URL),this.myIcon),this.rankList.scrollTo(0,0);else{this.myRewardFlag.node.active=!1,this.myRewardFrame.node.active=!0,this.txtRewardMyServer.node.active=1==IS(T).ifCross,1==IS(T).ifCross&&(this.txtRewardMyServer.string=s.formatStr("[s%s]",IS(x).GetServerId())),this.txtRewardMyName.string=IS(x).GetRoleAttr(_.ROLE_ATTR_NAME),this.loadRemoteIcon(IS(x).GetRoleAttr(_.ROLE_ATTR_HEAD_URL),this.myRewardIcon);var d=IS(y).GetActivityInfo(g.GvG),h=configFamiliybrawl.getDataByKey(d.roundCfg.group_id),c=[].concat(configFamiliybrawl_rank_reward.getDataByList("group",h.self_rank_cross_reward));c.sort((function(t,i){return t.rank_range[0]-i.rank_range[0]})),this.rewardList.datas=c,this.rewardList.scrollTo(0,0)}this.UpdateRankInfo()}},d.onBeforeClose=function(){var t;this.rankId=((t={})[F]=0,t[N]=0,t[b]=0,t[A]=0,t),this.rankList.clearData()},d.onDestroy=function(){},d.UpdateRankInfo=function(){if(this.rankInfo=IS(w).GetRankInfoByType(this.rankId[this.curType]),this.rankInfo){var t,i;if(this.curType==b||this.curType==A)for(var n=1;n<=3;n++)this.guildTopList[n].show(this.rankInfo.rank_list[n-1]);else if(this.curType==F||this.curType==N)for(var e=1;e<=3;e++)this.playerTopList[e].show(this.rankInfo.rank_list[e-1]);this.txtMyRank.string=0!=this.rankInfo.my_info.rank?this.rankInfo.my_info.rank:GetLanguage(200037),this.txtMyScore.string=s.formatStr("%s%s",B[this.curType],v.GetNumString(null!=(t=this.rankInfo.my_info.score)?t:0)),this.txtRewardMyRank.string=0!=this.rankInfo.my_info.rank?this.rankInfo.my_info.rank:GetLanguage(200037),this.txtRewardMyScore.string=s.formatStr("%s%s",B[this.curType],v.GetNumString(null!=(i=this.rankInfo.my_info.score)?i:0)),this.curType!=b&&this.curType!=F||(this.rankList.datas=this.rankInfo.rank_list)}else this.rankList.datas=[]},n}(u)),function(t){function n(){for(var i,n=arguments.length,e=new Array(n),o=0;o<n;o++)e[o]=arguments[o];return(i=t.call.apply(t,[this].concat(e))||this).imgFrame=void 0,i.imgIcon=void 0,i.flag=void 0,i.txtRank=void 0,i.rankIcon=void 0,i.txtName=void 0,i.txtServer=void 0,i.txtScore=void 0,i}i(n,t);var a=n.prototype;return a.onInit=function(){var t=this;this.imgFrame=f.findChildComponent(this.node,"imgFrame",r),this.imgIcon=f.findChildComponent(this.node,"imgFrame/imgIcon",r),this.flag=new c(this.view,f.findChild(this.node,"GuildPinItem")),this.txtRank=f.findChildComponent(this.node,"rankNum",o),this.rankIcon=f.findChildComponent(this.node,"rankIcon",r),this.txtName=f.findChildComponent(this.node,"info/name",o),this.txtServer=f.findChildComponent(this.node,"info/txtServer",o),this.txtScore=f.findChildComponent(this.node,"score",o),this.view.addComponentCallbackListener(this.imgFrame.node,e.EventType.CLICK,(function(){IS(k).reqOtherRoleNotice(t.data.belong_id)}))},a.onRender=function(t,i){var n=this.view;n.curType==b?(this.flag.node.active=!0,this.imgFrame.node.active=!1,this.flag.SetItem(t.guild_flag)):n.curType==F&&(this.flag.node.active=!1,this.imgFrame.node.active=!0,this.view.loadRemoteIcon(t.head.url,this.imgIcon)),this.txtName.string=t.name,this.txtScore.string=B[n.curType]+v.GetNumString(t.score),this.txtServer.node.active=1==IS(T).ifCross,1==IS(T).ifCross&&(this.txtServer.string=s.formatStr("[s%s]",t.serv_id)),t.rank<=3?(this.rankIcon.node.active=!0,this.txtRank.node.active=!1,this.view.loadIcon(this.rankIcon,"common","common_ICON_paiming0"+t.rank)):(this.rankIcon.node.active=!1,this.txtRank.node.active=!0,this.txtRank.string=t.rank)},a.onItemClick=function(){var t=this.view;t.curType==b?IS(I).send_29_1(this.data.belong_id):t.curType==F&&IS(k).reqOtherRoleNotice(this.data.info.belong_id)},n}(m)),E=function(t){function n(){for(var i,n=arguments.length,e=new Array(n),o=0;o<n;o++)e[o]=arguments[o];return(i=t.call.apply(t,[this].concat(e))||this).rewardScroll=void 0,i.txtRank=void 0,i.rankIcon=void 0,i}i(n,t);var e=n.prototype;return e.onInit=function(){this.txtRank=f.findChildComponent(this.node,"rankNum",o),this.rankIcon=f.findChildComponent(this.node,"rankIcon",r);var t=f.findChildComponent(this.node,"rewardScroll",a);this.rewardScroll=this.view.addUIList(t,O)},e.onRender=function(t,i){this.rewardScroll.datas=t.rank_reward;var n=t.rank_range[0],e=t.rank_range[1];n==e&&n<=3?(this.rankIcon.node.active=!0,this.txtRank.node.active=!1,this.view.loadIcon(this.rankIcon,"common","common_ICON_paiming0"+n)):(this.rankIcon.node.active=!1,this.txtRank.node.active=!0,t.show&&""!=t.show?this.txtRank.string=t.show:this.txtRank.string=s.formatStr("%s-%s",n,e))},n}(m),O=function(t){function n(){for(var i,n=arguments.length,e=new Array(n),o=0;o<n;o++)e[o]=arguments[o];return(i=t.call.apply(t,[this].concat(e))||this).itemGridNode=void 0,i.itemGrid=void 0,i}i(n,t);var e=n.prototype;return e.onInit=function(){this.itemGridNode=f.findChild(this.node,"itemGrid"),this.itemGrid=new l(this.view,this.itemGridNode)},e.onRender=function(t,i){this.itemGrid.SetItemId(t[0],t[1])},n}(m),U=function(){function t(){this.view=void 0,this.node=void 0,this.rank=void 0,this.txtName=void 0,this.txtServer=void 0,this.txtScore=void 0,this.imgFrame=void 0,this.imgIcon=void 0,this.rankIcon=void 0,this.job=void 0,this.data=void 0,this.role=void 0}var i=t.prototype;return i.init=function(t,i,n){this.view=i,this.node=t,this.rank=n,this.onInit()},i.onInit=function(){var t=this;this.job=f.findChild(this.node,"role"),this.txtName=f.findChildComponent(this.node,"nameInfo/name",o),this.txtServer=f.findChildComponent(this.node,"nameInfo/txtServer",o),this.txtScore=f.findChildComponent(this.node,"score",o),this.imgFrame=f.findChild(this.node,"imgFrame"),this.imgIcon=f.findChildComponent(this.node,"imgFrame/imgIcon",r),this.view.addComponentCallbackListener(this.imgFrame,e.EventType.CLICK,(function(){t.data&&IS(k).reqOtherRoleNotice(t.data.belong_id)}));var i=f.findChild(this.node,"role/click");this.view.addComponentCallbackListener(i,e.EventType.CLICK,(function(){t.data&&IS(k).reqOtherRoleNotice(t.data.belong_id)})),this.rankIcon=f.findChildComponent(this.node,"imgFrame/rank_icon",r),this.view.loadIcon(this.rankIcon,"rank",G[this.rank])},i.show=function(t){if(this.data=t,this.txtName.string=GetLanguage(200038),this.txtScore.string=B[F]+"0",this.imgIcon.node.active=!1,this.txtServer.node.active=!1,null!=this.role&&(this.view.removeUnitModel(this.role),this.role=null),t){var i=t.figure;this.role=IS(p).AddRoleModel(this.view,i,this.job,null,.9),d.uiMirror&&(this.view.getUnitModel(this.role).dir=-1),this.view.getUnitModel(this.role).mount=i.mount_figure,this.imgIcon.node.active=!0,this.view.loadRemoteIcon(t.head.url,this.imgIcon),i.mount_figure<=0&&(this.view.getUnitModel(this.role).position=D[this.rank]),this.view.loadRemoteIcon(t.head.url,this.imgIcon),this.txtName.string=t.name,this.txtScore.string=B[F]+v.GetNumString(t.score),this.txtServer.node.active=1==IS(T).ifCross,1==IS(T).ifCross&&(this.txtServer.string=s.formatStr("[s%s]",t.serv_id))}},t}(),K=function(){function t(){this.view=void 0,this.node=void 0,this.rank=void 0,this.flag=void 0,this.txtName=void 0,this.txtServer=void 0,this.txtScore=void 0,this.rankIcon=void 0,this.data=void 0}var i=t.prototype;return i.init=function(t,i,n){this.view=i,this.node=t,this.rank=n,this.onInit()},i.onInit=function(){var t=this;this.txtName=f.findChildComponent(this.node,"info/name/name",o),this.txtServer=f.findChildComponent(this.node,"info/txtServer",o),this.txtScore=f.findChildComponent(this.node,"score",o),this.flag=new c(this.view,f.findChild(this.node,"GuildPinItem")),this.view.addComponentCallbackListener(this.flag.node,e.EventType.CLICK,(function(){t.data&&IS(I).send_29_1(t.data.belong_id)})),this.rankIcon=f.findChildComponent(this.node,"rank_icon",r),this.view.loadIcon(this.rankIcon,"common","common_ICON_paiming0"+this.rank)},i.show=function(t){this.data=t,this.txtName.string=GetLanguage(200038),this.txtScore.string=B[b]+"0",this.flag.node.active=!1,this.txtServer.node.active=!1,t&&(this.flag.node.active=!0,this.flag.SetItem(t.guild_flag),this.txtName.string=t.name,this.txtScore.string=B[b]+v.GetNumString(t.score),this.txtServer.node.active=1==IS(T).ifCross,1==IS(T).ifCross&&(this.txtServer.string=s.formatStr("[s%s]",t.serv_id)))},t}();n._RF.pop()}}}));

