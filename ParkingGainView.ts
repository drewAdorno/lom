System.register("chunks:///_virtual/ParkingGainView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./BaseView.ts","./ConfigGlobal.ts","./MessageView.ts","./RoleDataCache.ts","./RoleDefine.ts","./ParkingControl.ts","./ParkingDataCache.ts","./ParkingDefine.ts"],(function(t){"use strict";var i,e,n,a,o,r,s,d,f,h,c,l,u,p,_,m,v,g,C,T,I,R,k,L,E;return{setters:[function(t){i=t.inheritsLoose,e=t.createForOfIteratorHelperLoose},function(t){n=t.cclegacy,a=t.Button,o=t.ScrollView,r=t.Label,s=t.sys,d=t.Vec3,f=t.ProgressBar,h=t.Sprite,c=t.UITransform,l=t.RichText},function(t){u=t.ItemGrid},function(t){p=t.ListItem},function(t){_=t.default},function(t){m=t.default},function(t){v=t.default},function(t){g=t.BaseView},function(t){C=t.ConfigGlobal},function(t){T=t.default},function(t){I=t.RoleDataCache},function(t){R=t.PlayerAttr},function(t){k=t.default},function(t){L=t.ParkingDataCache},function(t){E=t.ParkingEventDefine}],execute:function(){n._RF.push({},"c732eg39ZFK36pPeVmJ9azj","ParkingGainView",void 0);t("default",function(t){function n(){var i,e;return(e=t.call(this)||this).scrollEquipList=void 0,e.timeTxt=void 0,e.txtHP=void 0,e.pbHP=void 0,e.awardList=[],e.CarID=void 0,e.imgHeadIcon=void 0,e.imgHeadFrame=void 0,e.txtName=void 0,e.nodeBuff=void 0,e.nodeTip=void 0,e.txtTips=void 0,e.btnBuff=void 0,e.roleInfo=((i={})[R.ROLE_ATTR_LVL]=0,i[R.ROLE_ATTR_EXP]=0,i[R.ROLE_ATTR_ID]=0,i[R.ROLE_ATTR_NAME]="",i[R.ROLE_ATTR_VIP]=0,i[R.ROLE_ATTR_SERVER]=0,i[R.ROLE_ATTR_CUR_POWER]=0,i[R.ROLE_ATTR_GUILD_NAME]="",i[R.ROLE_ATTR_POWER_SHOW]=0,i[R.ROLE_ATTR_CUR_JOB]=0,i[R.ROLE_ATTR_JOB_TIMES]=0,i[R.ROLE_ATTR_STYLE]=0,i[R.ROLE_ATTR_RENAME]=0,i[R.ROLE_ATTR_GENDER]=0,i[R.ROLE_ATTR_SKIN]=0,i[R.ROLE_ATTR_HEAD_ID]=0,i[R.ROLE_ATTR_HEAD_FRAME_ID]=0,i[R.ROLE_ATTR_HEAD_URL]="",i),e.name="ParkingGainView",e.url="ui/module/parking/ParkingGainView",e.poolTime=3e3,e}i(n,t);var u=n.prototype;return u.onInit=function(){var t=this,i=this.findChild("imgMask");this.addComponentCallbackListener(i,a.EventType.CLICK,(function(){t.onMaskClick()}));var e=this.findChild("content/btnStart");this.addComponentCallbackListener(e,a.EventType.CLICK,(function(){T.showBoxTip({tip:GetLanguage(201100),title:GetLanguage(200048),func:function(i){"type_yes"==i&&(3==IS(L).car_list[t.CarID].parking_data.type?IS(k).reqCrossParkStop(t.CarID):IS(k).reqParkStop(t.CarID),t.close())}})})),this.adjustMirrorNode(this.findChild("content/imgBg-001/gg_png_title01"),0,!0);var n=this.findChild("content/btnGoto");this.addComponentCallbackListener(n,a.EventType.CLICK,(function(){IS(L).is_focus=!0;var i=IS(L).car_list[t.CarID];if(3==i.parking_data.type)return IS(k).reqCrossParkDetail(i.parking_data.master_id),void t.close();var e=0;1==i.parking_data.type&&(e=Math.ceil(i.parking_data.pos/C.park_public_each_num)),IS(k).reqParkingInfo(i.parking_data.type,i.parking_data.master_id,e),t.close()}));var l=this.findChildComponent("content/scrollEquipList",o);this.scrollEquipList=this.addUIList(l,A),this.timeTxt=this.findChildComponent("content/timeTxt/time",r),s.uiMirror&&(this.timeTxt.node.scale=new d(1,1,1)),this.txtHP=this.findChildComponent("content/bgHP/num",r),this.pbHP=this.findChildComponent("content/bgHP/ProgressBar",f);for(var u=1;u<3;u++){var p={node:this.findChild("content/Node/icon_bg"+u),icon:this.findChildComponent("content/Node/icon_bg"+u,h),rate:this.findChildComponent("content/Node/icon_bg"+u+"/rateTxt",r),award:this.findChildComponent("content/Node/icon_bg"+u+"/awardTxt",r)};if(this.adjustMirrorNode(p.node,200,!1),s.uiMirror)p.rate.node.scale=new d(1,1,1),p.award.node.scale=new d(1,1,1),p.award.getComponent(c).anchorX=0;this.awardList.push(p)}this.imgHeadIcon=this.findChildComponent("content/bgHP/frame/icon",h),this.imgHeadFrame=this.findChildComponent("content/bgHP/frame/imgHeadFrame",h),this.txtName=this.findChildComponent("content/bgHP/name",r),this.nodeBuff=this.findChild("content/bgHP/SpecialBuff"),this.nodeTip=this.findChild("content/bgHP/tips");var _=this.findChild("content/bgHP/tips/mask");this.nodeTip.active=!1,this.addComponentCallbackListener(this.nodeBuff,a.EventType.CLICK,(function(){t.nodeTip.active=!t.nodeTip.active})),this.addComponentCallbackListener(_,a.EventType.CLICK,(function(){t.nodeTip.active=!1})),this.txtTips=this.findChildComponent("content/bgHP/tips/txt",r),this.btnBuff=this.findChild("content/btnbuff"),this.addComponentCallbackListener(this.btnBuff,a.EventType.CLICK,(function(){t.onShowProtectTime()}));var m=this.findChild("content/tips/txt/mask");this.findChild("content/tips").active=!1,this.addComponentCallbackListener(m,a.EventType.CLICK,(function(){t.findChild("content/tips").active=!1}))},u.registerUpdateHandler=function(){this.addEvent(E.PARKING_CAR_LIST_UPDATE,this.updateData,this)},u.onMaskClick=function(){this.close()},u.onAfterOpen=function(){this.CarID=this.openArgs[0],this.addTimer(1,-1,this.refreshIdleTime,this),this.updateData()},u.onShowProtectTime=function(){for(var t,i=IS(L).car_list[this.CarID],n=0,a=e(i.parking_data.ext);!(t=a()).done;){var o=t.value;7==o.k&&(n=o.v)}var r=Math.max(30,Math.floor((n-i.parking_data.start_time)/60));this.findChildComponent("content/tips/txt",l).string=m.formatStrWithMirrorDeal(GetLanguage(201709),r),this.findChild("content/tips").active=!0},u.onBeforeClose=function(){},u.onDestroy=function(){},u.refreshAwardItem=function(){for(var t,i=IS(L).car_list[this.CarID],n=[],a=0,o=0,r=e(i.parking_data.reward_list);!(t=r()).done;){var s=t.value;201!=s.gtid?202!=s.gtid?n.push(s):o=s.num:a=s.num}this.scrollEquipList.datas=n;for(var d,f=0,h=0,c=0,l=i.parking_data.ext,u=e(l);!(d=u()).done;){var p=d.value;3==p.k?h=p.v:4==p.k?c=p.v:7==p.k&&(f=p.v)}var _=this.awardList[0];_.rate.string=h+"/m",this.loadIcon(_.icon,"icon_item","201"),_.award.string=m.GetNumString(a);var g=this.awardList[1];g.rate.string=c+"/m",this.loadIcon(g.icon,"icon_item","202"),g.award.string=m.GetNumString(o),this.btnBuff.active=f>v.serverTime},u.refreshIdleTime=function(){var t=IS(L).car_list[this.CarID].parking_data.start_time,i=Math.min(Math.max(v.serverTime-t,0),60*C.park_time_limit),e=v.formatTimeForSecond(i);this.timeTxt.string=e,this.updateDebuffTime(),i%60==0&&(IS(k).reqCarListInfo(),this.refreshAwardItem())},u.refreshRestHP=function(){for(var t,i=IS(L).car_list[this.CarID],n=i.parking_data.ext,a=0,o=1,r=1==i.parking_data.protect_ratio?1:0,s=i.parking_data.is_replace,d=e(n);!(t=d()).done;){var f=t.value;1==f.k?a=f.v:2==f.k&&(o=f.v)}this.pbHP.progress=a/o,this.txtHP.string=(a/o*100).toFixed(2)+"%";var h=IS(I).GetHeadUrl(),c=(IS(I).GetRoleAttr(R.ROLE_ATTR_HEAD_ID),IS(I).GetRoleAttr(R.ROLE_ATTR_HEAD_FRAME_ID)),l=IS(I).GetRoleName();if(1==r&&1==s&&(this.UpdateChangeInfo(i.parking_data.info_list),h=this.roleInfo[R.ROLE_ATTR_HEAD_URL],c=this.roleInfo[R.ROLE_ATTR_HEAD_FRAME_ID],l=this.roleInfo[R.ROLE_ATTR_NAME],this.roleInfo[R.ROLE_ATTR_HEAD_ID]),this.txtName.string=l,this.loadRemoteIcon(h,this.imgHeadIcon),c>0){var u=configAvatar_frame.getDataByKey(c);this.loadIcon(this.imgHeadFrame,"icon_frame",u.icon),this.imgHeadFrame.node.active=!0}else this.imgHeadFrame.node.active=!1},u.updateDebuffTime=function(){for(var t,i=IS(L).car_list[this.CarID].parking_data.ext,n=0,a=0,o=e(i);!(t=o()).done;){var s=t.value;5==s.k?n=s.v:6==s.k&&(a=s.v)}if(!configPark_pvp_debuff.getDataByKeys("num",n,"type",3!=IS(L).type?1:3)||0==n&&0==a)this.nodeBuff.active=!1;else{var d=_.findChildComponent(this.nodeBuff,"nodeTime/txtTime",r),f=v.getTimeLeft(a-v.serverTime);d.string=f}},u.updateBuffInfo=function(){for(var t,i=IS(L).car_list[this.CarID].parking_data.ext,n=0,a=0,o=0,s=e(i);!(t=s()).done;){var d=t.value;5==d.k?n=d.v:6==d.k?a=d.v:7==d.k&&(o=d.v)}var f=configPark_pvp_debuff.getDataByKeys("num",n,"type",3!=IS(L).type?1:3);if(!f||0==n&&0==a)this.nodeBuff.active=!1;else{this.nodeBuff.active=!0;var c=_.findChildComponent(this.nodeBuff,"imgIcon",h);this.loadIcon(c,"parking","gg_ui_debuff");var l=_.findChildComponent(this.nodeBuff,"num",r);this.updateDebuffTime(),l.string=n+"",this.txtTips.string=m.formatStr.apply(m,[f.debuff_desc].concat(f.desc_parm))}this.btnBuff.active=o>v.serverTime},u.updateData=function(){this.updateBuffInfo(),this.refreshAwardItem(),this.refreshRestHP()},u.UpdateChangeInfo=function(t){var i=t.kv,n=t.ks;if(null!=i)for(var a,o=e(i);!(a=o()).done;){var r=a.value;this.updateRoleAttr(r.k,r.v)}if(null!=n)for(var s,d=e(n);!(s=d()).done;){var f=s.value;this.updateRoleAttr(f.k,f.s)}},u.updateRoleAttr=function(t,i){var e=this.roleInfo[t];if(null!=e)return e=i,this.roleInfo[t]=e,e},n}(g));var A=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return(i=t.call.apply(t,[this].concat(n))||this).itemGridNode=void 0,i.itemGrid=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){this.itemGridNode=_.findChild(this.node,"itemGrid"),this.itemGrid=new u(this.view,this.itemGridNode)},n.onRender=function(t,i){this.itemGrid.SetItemId(t.gtid,t.num)},e}(p);n._RF.pop()}}}));

