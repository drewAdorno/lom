System.register("chunks:///_virtual/PlantStealView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./ObjectUtil.ts","./FriendControl.ts","./PlantControl.ts","./PlantDataCache.ts","./PlantDefine.ts","./PlantModel.ts","./BaseView.ts"],(function(t){"use strict";var e,i,n,a,o,s,r,h,d,l,m,f,c,u,v,g,S,C,p,I;return{setters:[function(t){e=t.inheritsLoose,i=t.createForOfIteratorHelperLoose},function(t){n=t.cclegacy,a=t.Button,o=t.ScrollView,s=t.Label,r=t.Sprite,h=t.UITransform,d=t.Vec3},function(t){l=t.ListItem},function(t){m=t.default},function(t){f=t.default},function(t){c=t.default},null,function(t){u=t.default},function(t){v=t.default},function(t){g=t.default},function(t){S=t.PlantDataCache},function(t){C=t.PlantEventDefine},function(t){p=t.PlantModel},function(t){I=t.BaseView}],execute:function(){var L;n._RF.push({},"02fddiP46JPNJtHVe87xjOJ","PlantStealView",void 0),function(t){t[t.None=0]="None",t[t.Growing=1]="Growing",t[t.Steal=2]="Steal",t[t.Stealing=3]="Stealing"}(L||(L={}));t("PlantStealView",function(t){function i(){var e;return(e=t.call(this)||this).itemList=void 0,e.curWaitFarmInfoRoleId=void 0,e.dt=0,e.name="PlantStealView",e.url="ui/module/plant/PlantStealView",e}e(i,t);var n=i.prototype;return n.onInit=function(){var t=this.findChild("imgMask");this.addComponentCallbackListener(t,a.EventType.CLICK,(function(){}));var e=this.findChildComponent("content/ScrollView",o);this.itemList=this.addUIList(e,R)},n.registerUpdateHandler=function(){var t=this;this.addEvent(C.FARM_STEAL_SEARCH_LIST,this.onRefreshList,this),this.addEvent(C.FARM_STEAL_REFRESH_LIST,this.onRefreshList,this),this.addEvent(C.ROLE_HOME_FARM_INFO_BACK,(function(e){t.curWaitFarmInfoRoleId&&e.role_id==t.curWaitFarmInfoRoleId&&(IS(p).tryOpenFarm(e),uiMgr.close("PlantStealView"))})),this.addEvent(C.FARM_STOLEN_INFO_UPDATE,this.onRefreshList,this)},n.onAfterOpen=function(){this.trySetParent(),IS(g).reqStealList()},n.trySetParent=function(){var t=uiMgr.getOpenView("PlantMainView");t&&t.nodeSubRoot&&this.node.setParent(t.nodeSubRoot)},n.onBeforeClose=function(){},n.onDestroy=function(){},n.onUpdate=function(t){this.dt+=t,this.dt>=1&&(this.dt=0,this.itemList.items.forEach((function(t,e,i){t.updateTimer()})))},n.onRefreshList=function(){for(var t=u.clone(IS(S).stealSearchList),e=u.clone(IS(S).stealEnemyList),i=IS(p).getStealingList(),n={},a=0;a<i.length;a++)n[i[a].id]=i[a];if(i.length<=0)this.itemList.datas=[t,e];else{for(var o=!1,s=0;s<t.length;s++){var r=n[t[s].id];if(null!=r){t[s].state=L.Stealing,t[s].time=r.end_time,o=!0;break}}for(var h=0;h<e.length;h++){var d=n[e[h].id];if(null!=d){e[h].state=L.Stealing,e[h].time=d.end_time,o=!0;break}}if(!o)for(var l=0;l<i.length;l++){var m=i[l];t.push({id:m.id,name:m.name,head:m.head,level:m.level,state:L.Stealing,time:m.end_time})}t.sort((function(t,e){var i=t.state==L.Stealing;if(i!=(e.state==L.Stealing))return i?-1:1})),this.itemList.datas=[t,e]}},i}(I));var R=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),a=0;a<i;a++)n[a]=arguments[a];return(e=t.call.apply(t,[this].concat(n))||this).txtFilter=void 0,e.btnRefresh=void 0,e.imgbtnRefresh=void 0,e.btnRefreshMask=void 0,e.txtTime=void 0,e.itemList=void 0,e.nodeNone=void 0,e.utNode=void 0,e.utScroll=void 0,e.utMask=void 0,e}e(i,t);var n=i.prototype;return n.onInit=function(){var t=this;this.adaptiveSize=!0,this.txtFilter=m.findChildComponent(this.node,"title/txtFilter",s),this.btnRefresh=m.findChildComponent(this.node,"title/btnRefresh",a),this.imgbtnRefresh=m.findChildComponent(this.node,"title/btnRefresh",r),this.btnRefreshMask=m.findChild(this.btnRefresh.node,"mask"),this.txtTime=m.findChildComponent(this.btnRefresh.node,"txtTime",s),this.nodeNone=m.findChild(this.node,"none"),this.view.addComponentCallbackListener(this.btnRefresh.node,a.EventType.CLICK,(function(){var e;0==t.index&&c.serverTime>=(null!=(e=IS(S).stealSearchRefreshTime)?e:0)&&(IS(g).reqUpdateStealList(),t.btnRefreshMask.active=!0,t.txtTime.string="",t.txtTime.node.active=!0)}));var e=m.findChildComponent(this.node,"ScrollView",o);this.itemList=this.view.addUIList(e,_,!1),this.itemList.touchEvent=!1,this.utScroll=e.getComponent(h),this.utMask=m.findChildComponent(this.node,"ScrollView/view",h),this.utNode=this.node.getComponent(h)},n.onRender=function(t,e){this.txtFilter.string=[GetLanguage_UI(100649),GetLanguage(300087)][e],this.view.loadIcon(this.imgbtnRefresh,"farm","zy_btn_shuaxin"),this.btnRefresh.node.active=0==e,this.nodeNone.active=1==e&&0==t.length,0==e&&(t.length=Math.max(t.length,3)),this.utNode.height=t.length<=3?436:436+118*(t.length-3),this.utScroll.height=t.length<=3?358:358+118*(t.length-3),this.utMask.height=t.length<=3?358:358+118*(t.length-3),this.itemList.datas=t},n.updateTimer=function(){if(this.txtTime.node.active){var t,e=c.serverTime,i=null!=(t=IS(S).stealSearchRefreshTime)?t:0;e<i?this.txtTime.string=i-e+"S":(this.txtTime.node.active=!1,this.btnRefreshMask.active=!1)}this.itemList.items.forEach((function(t,e,i){t.updateTimer()}))},i}(l),_=function(t){function n(){for(var e,i=arguments.length,n=new Array(i),a=0;a<i;a++)n[a]=arguments[a];return(e=t.call.apply(t,[this].concat(n))||this).btnRoleInfo=void 0,e.imgIcon=void 0,e.imgHeadFrame=void 0,e.imgbtnPlant=void 0,e.txtLevel=void 0,e.txtName=void 0,e.imgState=void 0,e.txtState=void 0,e.state=void 0,e}e(n,t);var o=n.prototype;return o.onInit=function(){var t=this;this.btnRoleInfo=m.findChild(this.node,"imgFrame"),this.view.addComponentCallbackListener(this.btnRoleInfo,a.EventType.CLICK,(function(){t.data.id&&IS(v).reqOtherRoleNotice(t.data.id,1)})),this.imgIcon=m.findChildComponent(this.node,"imgFrame/imgIcon",r),this.imgHeadFrame=m.findChildComponent(this.node,"imgFrame/imgHeadFrame",r),this.imgbtnPlant=m.findChildComponent(this.node,"btnPlant",r),this.txtLevel=m.findChildComponent(this.node,"txtLevel",s),this.txtName=m.findChildComponent(this.node,"txtName",s),this.imgState=m.findChildComponent(this.node,"state/imgState",r),this.txtState=m.findChildComponent(this.node,"state/txtState",s);var e=m.findChild(this.node,"btnPlant");this.view.addComponentCallbackListener(e,a.EventType.CLICK,(function(){t.data.id&&(t.view.curWaitFarmInfoRoleId=t.data.id,IS(g).reqFarmInfo(t.data.id))}))},o.onRender=function(t,e){for(var n,a=i(this.node.children);!(n=a()).done;){n.value.active=null!=t}if(null!=t){if(t.head&&""!==t.head.url?this.view.loadRemoteIcon(t.head.url,this.imgIcon):this.view.loadIcon(this.imgIcon,"player","grxx_ui_morentouxiang"),this.txtName.string=t.name,this.txtLevel.string="Lv."+t.level,this.state=t.state,this.imgState.node.scale=new d(1,1,1),this.view.loadIcon(this.imgbtnPlant,"farm","zy_icon_rukou"),t.head&&t.head.frame_id>0){var o=configAvatar_frame.getDataByKey(t.head.frame_id);this.view.loadIcon(this.imgHeadFrame,"icon_frame",o.icon),this.imgHeadFrame.node.active=!0}else this.imgHeadFrame.node.active=!1;switch(t.state){case L.None:this.view.loadIcon(this.imgState,"farm","zy_ui_zhanwuziyuan"),this.txtState.string=GetLanguage(300134);break;case L.Growing:this.view.loadIcon(this.imgState,"farm","zy_ui_ketouqu01");break;case L.Steal:this.view.loadIcon(this.imgState,"farm","zy_ui_ketouqu02"),this.txtState.string=GetLanguage(300140);break;case L.Stealing:this.view.loadIcon(this.imgState,"farm","zy_icon_xiaotou"),this.imgState.node.scale=new d(.4,.4,1);break;default:console.error("Bad EStealType state")}this.updateTimer()}},o.updateTimer=function(){if(this.state==L.Growing){var t=c.serverTime,e=this.data.time;t>=e?(this.view.loadIcon(this.imgState,"farm","zy_ui_ketouqu02"),this.txtState.string=GetLanguage(300140),this.state=L.Steal):this.txtState.string=f.formatStrWithMirrorDeal(GetLanguage(300135),c.formatTimeForSecond(e-t))}else this.state==L.Stealing&&(this.txtState.string=c.formatTimeForSecond(Math.max(0,this.data.time-c.serverTime))+"\n"+GetLanguage(300136))},n}(l);n._RF.pop()}}}));

