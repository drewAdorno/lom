System.register("chunks:///_virtual/JobSelectView_2.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AudioMgr.ts","./NodeUtil.ts","./StorageUtil.ts","./StringUtil.ts","./index57.ts","./ItemIcon.ts","./ConfigGlobal.ts","./ActivityDefine.ts","./ActivityStrategyControl.ts","./ActivityStrategyDataCache.ts","./MessageView.ts","./EquipModel.ts","./RoleControl.ts","./RoleDataCache.ts","./RoleDefine.ts","./BaseView.ts"],(function(i){"use strict";var t,e,o,n,s,l,a,c,d,h,r,v,f,u,g,m,p,S,C,k,_,b,y,I,L,J,w;return{setters:[function(i){t=i.inheritsLoose},function(i){e=i.cclegacy,o=i.Button,n=i.Label,s=i.Sprite,l=i.RichText,a=i.UITransform,c=i.Node,d=i.js,h=i.Toggle,r=i.sys,v=i.Layout},function(i){f=i.audioMgr},function(i){u=i.default},function(i){g=i.default},function(i){m=i.default},null,function(i){p=i.IconAseetType},function(i){S=i.ConfigGlobal},function(i){C=i.ActivityType},function(i){k=i.default},function(i){_=i.default},function(i){b=i.default},function(i){y=i.EquipModel},function(i){I=i.default},function(i){L=i.RoleDataCache},function(i){J=i.PlayerAttr},function(i){w=i.BaseView}],execute:function(){e._RF.push({},"0c944nYJWZN+7DCkLkJHa6Z","JobSelectView_2",void 0);i("default",function(i){function e(){var t;return(t=i.call(this)||this).togNode=void 0,t.togSkip=void 0,t.txtTitle=void 0,t.curSelectJob=0,t.imgFrame=void 0,t.imgIcon=void 0,t.activeSkillName=void 0,t.activeSkillDesc=void 0,t.passiveList=[],t.jobItems=[],t.line_0=void 0,t.line_1=void 0,t.line_2=void 0,t.line_1_select=void 0,t.line_2_select=void 0,t.activityType=void 0,t.name="JobSelectView_2",t.url="ui/module/role/JobSelectView_2",t}t(e,i);var J=e.prototype;return J.onInit=function(){var i=this,t=this.findChild("imgMask");this.addComponentCallbackListener(t,o.EventType.CLICK,(function(){i.close()}));var e=this.findChild("Button");this.addComponentCallbackListener(e,o.EventType.CLICK,(function(){i.onJobClick()})),this.txtTitle=this.findChildComponent("title/Label",n),this.line_0=this.findChild("line/line_0"),this.line_1=this.findChild("line/line_1"),this.line_2=this.findChild("line/line_2"),this.line_1_select=this.findChild("line/line_1/light"),this.line_2_select=this.findChild("line/line_2/light"),this.imgFrame=u.findChildComponent(this.node,"skill/active/frame",s),this.imgIcon=u.findChildComponent(this.node,"skill/active/frame/icon",s),this.activeSkillName=u.findChildComponent(this.node,"skill/active/name",n),this.activeSkillDesc=u.findChildComponent(this.node,"skill/active/desc/view/content/desc",l);var f=u.findChildComponent(this.node,"skill/active/desc/view/content",a);this.addComponentCallbackListener(this.activeSkillDesc.node,c.EventType.SIZE_CHANGED,(function(){f.height=i.activeSkillDesc.node.getComponent(a).height}));for(var p=S.job_passive_skill,C=function(t){var e=u.findChild(i.node,d.formatStr("skill/passive/item%s",t+1)),l={node:e,frame:u.findChildComponent(e,"frame",s),icon:u.findChildComponent(e,"frame/icon",s),txtLev:u.findChildComponent(e,"lev",n),mask:u.findChild(e,"mask"),levLimit:0,skillId:0,skillLev:0};i.addComponentCallbackListener(e,o.EventType.CLICK,(function(){if(0==l.skillId)b.showFlyTip(m.formatStrWithMirrorDeal(GetLanguage(200110),p[t]));else{var i=configSkill_level.getDataByKeys("id",l.skillId,"level",l.skillLev);uiMgr.openView("JobSkillTipsView",m.formatStr.apply(m,[i.desc].concat(i.desc_parm)),l.node)}})),i.passiveList.push(l)},k=0;k<5;k++)C(k);for(var _=0;_<3;_++){var y=this.findChild(d.formatStr("job_%s",_)),I=new T;I.init(y,this,_),this.jobItems.push(I)}this.togNode=this.findChild("tog"),this.togSkip=this.findChildComponent("tog/toggleSkip",h),this.addComponentCallbackListener(this.togSkip.node,h.EventType.TOGGLE,(function(){i.togSkip.isChecked?g.set("SkipJobAnim","1"):g.set("SkipJobAnim","0")})),r.uiMirror&&this.dealMirrorLayout(this.togNode.getComponent(v))},J.onJobClick=function(){var i=this,t=IS(L).GetJob(),e=IS(y).getShowEquipCfgIdByLocation(1),o=configJobs.getDataByKey(this.curSelectJob),n=IS(L).GetTypeUsedSkin(1),s=this.activityType,l=m.formatStrWithMirrorDeal(GetLanguage(200579),o.name);b.showBoxTip({tip:l,title:GetLanguage(200048),func:function(o){if("type_yes"==o){if(i.activityType==C.Strategy?(t=IS(_).job,e=IS(_).getShowEquipCfgIdByLocation(1),IS(k).reqActStrategyTabJob(i.curSelectJob)):IS(I).send_3_6(i.curSelectJob),uiMgr.close("JobSelectView_4"),i.close(),f.playSound("common_evolution"),i.togNode.active&&i.togSkip.isChecked)return;uiMgr.openView("JobEffectView",t,e,i.curSelectJob,n,s)}}})},J.registerUpdateHandler=function(){},J.onAfterOpen=function(){this.activityType=this.openArgs[1];var i=IS(L).GetJob();this.activityType==C.Strategy&&(i=IS(_).job);var t=configJobs.getDataByKey(i);this.txtTitle.string=m.formatStrWithMirrorDeal(GetLanguage(200580),t.change_times+1),this.curSelectJob=this.openArgs[0],this.updateSkill(),this.jobItems[0].show(i),this.jobItems[1].show(this.curSelectJob),this.jobItems[1].node.setPosition(145,145,0),this.jobItems[2].node.active=!1,this.line_0.active=!0,this.line_1.active=!1,this.line_2.active=!1;var e=IS(L).GetRoleId();(""==g.get("JobSelectRecord"+e,!1)?[]:g.get("JobSelectRecord"+e,!0))[t.change_times]?(this.togNode.active=!0,this.togSkip.isChecked="1"==g.get("SkipJobAnim")):this.togNode.active=!1},J.onBeforeClose=function(){},J.onDestroy=function(){},J.updateSkill=function(){var i=configJobs.getDataByKey(this.curSelectJob),t=configSkill.getDataByKey(i.skill[0][1][0]),e=IS(L).GetLevel(),o=configSkill_level.getDataByKeys("id",t.id,"level",e);this.activeSkillName.string=t.name,this.activeSkillDesc.string=d.formatStr("<b><color=#304231>%s</color></b>",m.formatStr.apply(m,[o.desc].concat(o.desc_parm))),this.loadIcon(this.imgFrame,"icon_skill",d.formatStr("common_ICON_jinengkuang0%s",t.quality)),this.loadIcon(this.imgIcon,"icon_skill",t.icon,null,p.UI_ATLAS,!0);for(var n=0;n<5;n++){var s=this.passiveList[n];if(n<i.passive_skill.length){s.levLimit=i.passive_skill[n][0],s.skillId=i.passive_skill[n][1][0],s.skillLev=i.passive_skill[n][1][1];var l=configSkill.getDataByKey(s.skillId);s.icon.node.active=!0,this.loadIcon(s.frame,"icon_skill",d.formatStr("common_ICON_jinengkuang0%s",l.quality)),this.loadIcon(s.icon,"icon_skill",l.icon,null,p.ICON_SPRITE,!0),s.txtLev.string=d.formatStr("Lv.%s",s.levLimit),e<s.levLimit?(s.mask.active=!0,s.txtLev.node.active=!0):(s.mask.active=!1,s.txtLev.node.active=!1)}else s.levLimit=0,s.skillId=0,s.skillLev=0,this.loadIcon(s.frame,"icon_skill","common_ICON_jinengwenhao"),s.icon.node.active=!1,s.mask.active=!0,s.txtLev.node.active=!1}},e}(w));var T=function(){function i(){this.view=void 0,this.node=void 0,this.index=void 0,this.job=void 0,this.txtName=void 0,this.icon=void 0,this.selectBg=void 0,this.nameSelectBg=void 0}var t=i.prototype;return t.init=function(i,t,e){this.view=t,this.node=i,this.index=e,this.onInit()},t.onInit=function(){this.selectBg=u.findChild(this.node,"selectBg"),this.nameSelectBg=u.findChild(this.node,"nameSelectBg"),this.txtName=u.findChildComponent(this.node,"name",n),this.icon=u.findChildComponent(this.node,"icon",s);var i=u.findChildComponent(this.node,"nameSelectBg/Sprite/Sprite",s);this.view.loadIcon(i,"job","zj_ui_xuanze")},t.show=function(i){this.node.active=!0,this.job=i;var t=configJobs.getDataByKey(this.job),e=IS(L).GetRoleAttr(J.ROLE_ATTR_GENDER);this.txtName.string=t.name,2==e&&5==t.change_times?(this.view.loadIcon(this.icon,"icon_job",d.formatStr("job_%s_2",this.job),null,p.ICON_SPRITE),this.icon.node.setPosition(r.uiMirror?-t.position[2]:t.position[2],t.position[3],0)):(this.view.loadIcon(this.icon,"icon_job",d.formatStr("job_%s",this.job),null,p.ICON_SPRITE),this.icon.node.setPosition(r.uiMirror?-t.position[0]:t.position[0],t.position[1],0)),this.icon.node.setScale(r.uiMirror?-t.scale:t.scale,t.scale,t.scale),this.updateSelect()},t.updateSelect=function(){this.selectBg.active=this.view.curSelectJob==this.job,this.nameSelectBg.active=this.view.curSelectJob==this.job},i}();e._RF.pop()}}}));

