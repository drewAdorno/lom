System.register("chunks:///_virtual/MainView_ChatInfo.ts",["./rollupPluginModLoBabelHelpers.js","cc","./RedPoint.ts","./RedPointMgr.ts","./BaseSubView.ts","./ChatDataCache.ts","./ChatDefine.ts"],(function(t){"use strict";var e,n,i,a,o,s,h,c,r,d,C,p,u,f,l,g;return{setters:[function(t){e=t.inheritsLoose},function(t){n=t.cclegacy,i=t.Button,a=t.UITransform,o=t.Label,s=t.sys,h=t.NodeEventType,c=t.Sprite,r=t.Vec2,d=t.Vec3},function(t){C=t.RedPointType},function(t){p=t.RedPointMgr},function(t){u=t.BaseSubView},function(t){f=t.ChatDataCache},function(t){l=t.ChatDefine,g=t.ChatEventDefine}],execute:function(){n._RF.push({},"e9c08oVJ69EIInuzyXt4YN1","MainView_ChatInfo",void 0);t("default",function(t){function n(){var e;return(e=t.call(this)||this).btnChatRoot=void 0,e.imgChatIcon=void 0,e.tipIcon=void 0,e.txtName=void 0,e.content=void 0,e.face=void 0,e.faceOriScale=void 0,e.curType=void 0,e.name="MainView_ChatInfo",e}e(n,t);var u=n.prototype;return u.onInit=function(){var t=this;this.btnChatRoot=this.findChild(""),this.addComponentCallbackListener(this.btnChatRoot,i.EventType.CLICK,(function(){uiMgr.openView("ChatView",t.curType)})),this.tipIcon=this.findChild("tipIcon"),this.addComponentCallbackListener(this.tipIcon,i.EventType.CLICK,(function(){uiMgr.openView("ChatView",l.ViewType.Private)})),this.imgChatIcon=this.findChild("imgChatIcon");var e=this.findChild("name/messageContent"),n=this.findChildComponent("name",a);this.txtName=this.findChildComponent("name",o),s.uiMirror?(e.setScale(-1,1,1),e.setPosition(-(n.width+7),-1.389)):e.setPosition(n.width+7,-1.389),this.txtName.node.on(h.SIZE_CHANGED,(function(){s.uiMirror?e.setPosition(-(n.width+7),-1.389):e.setPosition(n.width+7,-1.389)})),this.content=this.findChildComponent("name/messageContent/content",o),this.face=this.findChildComponent("name/messageContent/face",c),this.faceOriScale=this.face.node.scale},u.registerUpdateHandler=function(){this.addEvent(g.InsertNewMsg,this.updateMessage,this),this.addEvent(g.UpdateChatMsg,this.updateMessage,this),this.addEvent(g.UpdateChatRed,this.UpdateShowTipState,this)},u.onAfterOpen=function(){this.addRedPoint("chat_red",this.imgChatIcon,new r(24,14),C.Dot,.7),IS(p).changeValue("chat_red",IS(f).GetChatRed()),this.updateMessage(),this.UpdateShowTipState()},u.updateMessage=function(t){var e,n,i,a,o=IS(f).GetChatInfo(l.Channel.World,0);o&&o.length>0&&(e=o[o.length-1]);var h=IS(f).GetChatInfo(l.Channel.Guild,0);h&&h.length>0&&(n=h[h.length-1]),i=IS(f).GetNewestPrivateInfo();var c=IS(f).GetChatInfo(l.Channel.News,0);c&&c.length>0&&(a=c[c.length-1]);var r,C,p=0;if(this.curType=null,e&&e.time>p&&(p=e.time,r=GetLanguage(200443),C=e,this.curType=l.ViewType.World),n&&n.time>p&&(p=n.time,r=GetLanguage(200444),C=n,this.curType=l.ViewType.Guild),i&&i.time>p&&(p=i.time,r=GetLanguage(200445),C=i,this.curType=l.ViewType.Private),a&&a.time>p&&(p=a.time,r=GetLanguage(200446),C=a,this.curType=l.ViewType.News),C){var u=C.name;if(this.txtName.string=s.uiMirror?"："+u+r:r+u+"：",C.type==l.ChatContentType.Conetnt||C.type==l.ChatContentType.Share||C.type==l.ChatContentType.Pic||C.type==l.ChatContentType.Voice){var g=C.content;g.length>=42-u.length&&(g=g.substring(0,Math.max(0,42-u.length))+"..."),this.face.node.active=!1,C.type==l.ChatContentType.Pic?this.content.string=GetLanguage(200179):C.type==l.ChatContentType.Voice?this.content.string=GetLanguage(999000624):this.content.string=g}else if(C.type==l.ChatContentType.Face){this.face.node.active=!0,this.content.string="";var v=IS(f).GetFaceIconByContent(C.content),m=v[0],y=v[1],I=this.faceOriScale.y*y.scale;this.face.node.scale=new d(I,I,I),this.loadIcon(this.face,"icon_chat",m)}this.txtName.node.active=!0}else this.txtName.string="",this.content.string=""},u.UpdateShowTipState=function(){IS(f).GetPrivateRed()>0?(this.imgChatIcon.active=!1,this.tipIcon.active=!0):(this.imgChatIcon.active=!0,this.tipIcon.active=!1)},u.onBeforeClose=function(){},u.onDestroy=function(){},n}(u));n._RF.pop()}}}));

