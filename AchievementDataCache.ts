System.register("chunks:///_virtual/AchievementDataCache.ts",["cc","./RedPointMgr.ts","./ObjectUtil.ts","./PetDefine.ts","./PetModel.ts","./SkillDefine.ts","./SkillModel.ts","./TaskDataCache.ts","./TaskDefine.ts","./AchievementDefine.ts"],(function(e){"use strict";var t,i,n,c,o,l,s,a,h,r,d,m,p;return{setters:[function(e){t=e.cclegacy},function(e){i=e.RedPointMgr},function(e){n=e.default},function(e){c=e.PetEventDefine},function(e){o=e.PetModel},function(e){l=e.SKILLEventDefine},function(e){s=e.SkillModel},function(e){a=e.TaskDataCache},function(e){h=e.TaskType,r=e.TaskState,d=e.TaskEventDefine},function(e){m=e.AchievementEventDefine,p=e.AchievementDefine}],execute:function(){t._RF.push({},"0d380B+I5FE3LF98ngEZV8E","AchievementDataCache",void 0);e("AchievementDataCache",function(){var e=t.prototype;function t(){this.collectionList=void 0,this.collectionRed=void 0,this.allRed=0,this.cacheGroupData=void 0,this.accomplishmenInfo=void 0,this.accomplishmenRed=0,this.accomplishmenTaskRed=0,this.collectionList={},this.collectionRed={},normalEvent.on(l.PASSIVE_SKILL_LIST_UPDATE,this.UpdateRed,this),normalEvent.on(l.ACTIVE_SKILL_LIST_UPDATE,this.UpdateRed,this),normalEvent.on(l.SYSTEM_SKILL_LIST_UPDATE,this.UpdateRed,this),normalEvent.on(c.PET_LIST_UPDATE,this.UpdateRed,this),normalEvent.on(d.TASK_INFO_UPDATE,this.UpdateAccomplishmentTaskRed,this)}return e.clear=function(){this.collectionList={},this.collectionRed={}},e.modifyCollectiongList=function(e){if(null!=e.type_list){for(var t in e.type_list)if(this.collectionList[e.type_list[t].type]={},null!=e.type_list[t].collection_list)for(var i in e.type_list[t].collection_list){var n=e.type_list[t].collection_list[i];this.collectionList[e.type_list[t].type][n.cfg_id]=n}normalEvent.emit(m.AchievementUpdate),this.UpdateRed()}},e.updateCollectiongList=function(e){if(null!=e.collection){var t=e.collection,i=configIllustrated.getDataByKey(t.cfg_id);null==this.collectionList[i.type]&&(this.collectionList[i.type]={}),this.collectionList[i.type][t.cfg_id]=t,normalEvent.emit(m.AchievementUpdate),this.UpdateRed()}},e.GetCollectionLevelByTypeAndId=function(e,t){if(null!=this.collectionList[e]){var i=this.collectionList[e][t];if(null!=i)return i.lv}return 0},e.GetCollectionInfoByTypeAndId=function(e,t){if(null!=this.collectionList[e]){var i=this.collectionList[e][t];if(null!=i)return i}return null},e.GetCollectionStateByTypeAndId=function(e,t){if(null!=this.collectionList[e]){var i=this.collectionList[e][t];if(null!=i){if(0==i.state){var n=configIllustrated.getDataByKeys("id",i.cfg_id,"level",i.lv),c=!0;for(var l in n.condition){var a=n.condition[l][0],h=n.condition[l][1],r=n.condition[l][2];if(1==a){var d=IS(s).getSystemSkillInfoBySkillId(h);if(null==d||d.skill_lv<r){c=!1;break}}else if(2==a){var m=IS(o).getPetInfoByPetId(h);if(null==m||m.level<r){c=!1;break}}}return c?p.AchievementState.Reward:0==i.lv?p.AchievementState.Lock:p.AchievementState.Normal}return p.AchievementState.Normal}}return p.AchievementState.Lock},e.UpdateRed=function(){var e=n.clone(this.collectionRed);for(var t in this.collectionRed={},this.collectionList){var c=this.collectionList[t];for(var o in c){if(this.GetCollectionStateByTypeAndId(t,o)==p.AchievementState.Reward){var l;this.collectionRed[t]=(null!=(l=this.collectionRed[t])?l:0)+1;break}}}this.allRed=0;for(var s=!1,h=1;h<=3;h++){var r,d=null!=(r=this.collectionRed[h])?r:0;this.allRed+=d,this.collectionRed[h]!=e[h]&&(IS(i).changeValue("collect_red/"+h,d),s=!0)}s&&(IS(i).changeValue("collect_red",this.allRed),IS(i).changeValue("MainTaskAndAchieve",IS(a).GetTaskAndAchieveRed()),normalEvent.emit(m.AchievementRedUpdate))},e.GetRedByType=function(e){var t;return null!=(t=this.collectionRed[e])?t:0},e.GetHasRed=function(){return this.allRed},e.GetAccomplishmentTask=function(){var e=configAchievement.getDatas(),t=!0;if(!this.cacheGroupData){t=!1,this.cacheGroupData={};for(var i=0;i<e.length;i++){var n=e[i];this.cacheGroupData[n.group]||(this.cacheGroupData[n.group]=[]),this.cacheGroupData[n.group].push(n)}}var c=[];for(var o in this.cacheGroupData){var l=this.cacheGroupData[o];t||l.sort((function(e,t){e.id,t.id}));for(var s=0;s<l.length;s++){var d=l[s],m=IS(a).GetTaskItem(h.Achievement,d.id);!m||m.state==r.Received&&s!=l.length-1||c.push(d)}}return c},e.UpdateAccomplishmentInfo=function(e){this.accomplishmenInfo=e,this.UpdateAccomplishmentRed(),normalEvent.emit(m.AccomplishmentUpdate)},e.GetAccomplishmentId=function(){return this.accomplishmenInfo?this.accomplishmenInfo.now_id:1},e.GetAccomplishmentProgress=function(){return this.accomplishmenInfo?this.accomplishmenInfo.progress:0},e.GetAccomplishmentGetId=function(){return this.accomplishmenInfo?this.accomplishmenInfo.get_id:0},e.UpdateAccomplishmentRed=function(){var e=this.GetAccomplishmentId(),n=0,c=configAchievement_total.getDataByKey(e);c&&(this.GetAccomplishmentProgress()>=c.number&&this.GetAccomplishmentGetId()!=this.GetAccomplishmentId()&&(n=1));n!=this.accomplishmenRed&&(this.accomplishmenRed=n,IS(i).changeValue("MainTaskAndAchieve",IS(a).GetTaskAndAchieveRed()),IS(i).changeValue("accomplishment_red",IS(t).GetAccomplishmentRed()),normalEvent.emit(m.AccomplishmentRedUpdate))},e.UpdateAccomplishmentTaskRed=function(){var e=0,n=IS(a).GetTaskList(h.Achievement);for(var c in n){if(n[c].state==r.Complete){e=1;break}}e!=this.accomplishmenTaskRed&&(this.accomplishmenTaskRed=e,IS(i).changeValue("MainTaskAndAchieve",IS(a).GetTaskAndAchieveRed()),IS(i).changeValue("accomplishment_red",IS(t).GetAccomplishmentRed()),normalEvent.emit(m.AccomplishmentRedUpdate))},e.GetAccomplishmentRed=function(){return this.GetAccomplishmentFinishRed()+this.accomplishmenTaskRed},e.GetAccomplishmentFinishRed=function(){return this.accomplishmenRed},t}());t._RF.pop()}}}));

