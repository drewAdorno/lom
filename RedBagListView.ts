System.register("chunks:///_virtual/RedBagListView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIList.ts","./RedPoint.ts","./RedPointMgr.ts","./NodeUtil.ts","./TimeUtil.ts","./index57.ts","./MessageView.ts","./RoleDataCache.ts","./ChatControl.ts","./ChatDataCache.ts","./ChatDefine.ts","./BaseView.ts"],(function(t){"use strict";var e,i,n,a,o,s,r,d,h,l,c,p,g,f,u,y,m,C,v,L,_,b,R;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,n=t.Button,a=t.ScrollView,o=t.Vec2,s=t.Sprite,r=t.Label,d=t.LabelOutline,h=t.sys,l=t.Layout,c=t.Vec3},function(t){p=t.ListItem},function(t){g=t.RedPointType},function(t){f=t.RedPointMgr},function(t){u=t.default},function(t){y=t.default},null,function(t){m=t.default},function(t){C=t.RoleDataCache},function(t){v=t.default},function(t){L=t.ChatDataCache},function(t){_=t.ChatEventDefine,b=t.RedBagState},function(t){R=t.BaseView}],execute:function(){i._RF.push({},"7eaa7fbPS9EVrprkC4sEEzZ","RedBagListView",void 0);t("RedBagListView",function(t){function i(){var e;return(e=t.call(this)||this).scroll=void 0,e.openType=void 0,e.typeList={},e.emptyList=void 0,e.emptyMy=void 0,e.name="RedBagListView",e.url="ui/module/Chat/RedBagListView",e.poolTime=3e3,e}e(i,t);var s=i.prototype;return s.onInit=function(){var t=this;this.addComponentCallbackListener(this.findChild("imgMask"),n.EventType.CLICK,(function(){t.close()})),this.addComponentCallbackListener(this.findChild("dialog/btnClose"),n.EventType.CLICK,(function(){t.close()})),this.emptyList=this.findChild("dialog/emptyList"),this.emptyMy=this.findChild("dialog/emptyMy");var e=this.findChildComponent("dialog/content/ScrollView",a);this.scroll=this.addUIList(e,T);for(var i=function(e){t.typeList[e]={tabNormal:t.findChild("dialog/tabScroll/item"+(e+1)+"/normal"),highLight:t.findChild("dialog/tabScroll/item"+(e+1)+"/highLight"),tabBtn:t.findChild("dialog/tabScroll/item"+(e+1))},t.addComponentCallbackListener(t.typeList[e].tabBtn,n.EventType.CLICK,(function(){t.openType!=e&&t.Refresh(e)}))},o=0;o<2;o++)i(o)},s.onAfterOpen=function(){var t;this.addRedPoint("grab_red_bag",this.typeList[0].tabBtn,new o(65,12),g.Dot,1),IS(f).changeValue("grab_red_bag",IS(L).GetGrabRedBagRed()),this.addRedPoint("send_red_bag",this.typeList[1].tabBtn,new o(65,12),g.Dot,1),IS(f).changeValue("send_red_bag",IS(L).GetSendRedBagRed()),this.openType=null;var e=null!=(t=this.openArgs[0])?t:0;this.Refresh(e)},s.registerUpdateHandler=function(){this.addEvent(_.UpdateRedBagList,this.RefreshRedBagList,this)},s.Refresh=function(t){for(var e in this.openType=t,this.typeList){var i=this.typeList[e],n=parseInt(e);i.tabNormal.active=n!=this.openType,i.highLight.active=n==this.openType}IS(v).send_red_brief_list_c2s(),this.scroll.scrollView.scrollToTop(),this.RefreshRedBagList(),1==this.openType?IS(L).SetNewSendRedBagEmpty():IS(L).SetNewGrabRedBagEmpty()},s.RefreshRedBagList=function(){var t=new Array,e=IS(L).GetRedBagDictByType(this.openType);for(var i in e){var n=e[i];null!=n&&(n.state!=b.UnClaimed&&n.state!=b.UnSent||t.push(n))}t.sort((function(t,e){var i=0,n=0,a=configRed_packet.getDataByKey(t.cfg_id),o=configRed_packet.getDataByKey(e.cfg_id);return a.quality>o.quality?i+=1e5:(a.quality<o.quality||(i+=1e5),n+=1e5),t.expiry_time<e.expiry_time?i+=1e3:(t.expiry_time>e.expiry_time||(i+=1e3),n+=1e3),i>n?-1:1})),this.scroll.datas=t,this.emptyList.active=0==t.length&&0==this.openType,this.emptyMy.active=0==t.length&&1==this.openType},s.onBeforeClose=function(){},s.onDestroy=function(){},i}(R));var T=function(t){function i(){for(var e,i,n,a,o,s,r,d=arguments.length,h=new Array(d),l=0;l<d;l++)h[l]=arguments[l];return(r=t.call.apply(t,[this].concat(h))||this).bg=void 0,r.sendDes=void 0,r.channel=void 0,r.txtChannel=void 0,r.txtOutline=void 0,r.time=void 0,r.desc=void 0,r.timer=void 0,r.bgImg=((e={})[1]="redpacket1_1",e[2]="redpacket1_2",e[3]="redpacket1_3",e),r.bgPos=((i={})[1]=0,i[2]=0,i[3]=-5,i),r.channelImg=((n={})[0]="redpacket_tag02",n[1]="redpacket_tag01",n),r.channelTextID=((a={})[0]=200678,a[1]=200677,a),r.channelTextColor=((o={})[0]="#FFFFFF",o[1]="#FFF71E",o),r.channelOutlineColor=((s={})[0]="#122D5E",s[1]="#943B30",s),r}e(i,t);var a=i.prototype;return a.onInit=function(){var t=this;this.bg=u.findChildComponent(this.node,"bg",s),this.sendDes=u.findChildComponent(this.node,"sendDes",r),this.channel=u.findChildComponent(this.node,"channel",s),this.txtChannel=u.findChildComponent(this.node,"channel/Label",r),this.txtOutline=u.findChildComponent(this.node,"channel/Label",d),this.time=u.findChildComponent(this.node,"time",r),this.desc=u.findChildComponent(this.node,"desc",r),this.view.addComponentCallbackListener(u.findChild(this.node,""),n.EventType.CLICK,(function(){if(t.data.state==b.UnSent){if(0==configRed_packet.getDataByKey(t.data.cfg_id).type&&!IS(C).HasGuild())return void m.showFlyTip(configErrorInfo.getDataByKey(147).info);uiMgr.openView("RedBagSendView",t.data)}else{var e=configRed_packet.getDataByKey(t.data.cfg_id);IS(v).send_red_grab_c2s(t.data.id,e.type)}})),h.uiMirror&&this.view.dealMirrorLayout(this.channel.node.getComponent(l))},a.onRender=function(t,e){var i=this;this.timer&&(this.view.removeTimer(this.timer),this.timer=null);var n=configRed_packet.getDataByKey(t.cfg_id);n&&(this.desc.string=n.tiny_title,this.time.string=y.formatENTimeStringForSecond(t.expiry_time-y.serverTime),this.view.loadIcon(this.channel,"red_bag",this.channelImg[n.type]),this.txtChannel.string=GetLanguage(this.channelTextID[n.type]),this.txtChannel.color=this.txtChannel.color.fromHEX(this.channelTextColor[n.type]),this.txtOutline.color=this.txtOutline.color.fromHEX(this.channelOutlineColor[n.type]),this.sendDes.string=this.data.state==b.UnSent?GetLanguage(999100087):GetLanguage(999100088),this.view.loadIcon(this.bg,"red_bag",this.bgImg[n.quality]),t.expiry_time>y.serverTime&&(this.timer=this.view.addTimer(1,t.expiry_time-y.serverTime,(function(){i.time.string=y.formatENTimeStringForSecond(t.expiry_time-y.serverTime)}))),this.bg.node.position=new c(0,this.bgPos[n.quality],0))},a.destroy=function(){this.timer&&(this.view.removeTimer(this.timer),this.timer=null)},i}(p);i._RF.pop()}}}));

