System.register("chunks:///_virtual/ArtifactSkinView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./index57.ts","./ItemIcon.ts","./BagModel.ts","./ArtifactControl.ts","./ArtifactDataCache.ts","./ArtifactDefine.ts","./BaseSubView.ts"],(function(t){"use strict";var i,e,n,o,s,a,r,h,l,c,d,f,I,S,k,v,g,C,u,m,p,b,y,D;return{setters:[function(t){i=t.inheritsLoose,e=t.createForOfIteratorHelperLoose},function(t){n=t.cclegacy,o=t.Button,s=t.ScrollView,a=t.UITransform,r=t.Node,h=t.Vec3,l=t.sys,c=t.Layout,d=t.Label,f=t.Sprite,I=t.js},function(t){S=t.ItemGrid},function(t){k=t.SelectedType,v=t.ListItem},function(t){g=t.default},function(t){C=t.default},null,function(t){u=t.IconAseetType},function(t){m=t.BagModel},function(t){p=t.default},function(t){b=t.ArtifactDataCache},function(t){y=t.ArtifactEvent},function(t){D=t.BaseSubView}],execute:function(){n._RF.push({},"8ad485vZf9H5qjJCHl9WhGf","ArtifactSkinView",void 0);t("default",function(t){function n(){var i;return(i=t.call(this)||this).nodeRoot=void 0,i.btnUnlock=void 0,i.btnUse=void 0,i.btnCancel=void 0,i.btnLeft=void 0,i.btnRight=void 0,i.nodeItem=void 0,i.nodeTop=void 0,i.ArtifactUIList=void 0,i.starUIList=void 0,i.imgFrame=void 0,i.imgIcon=void 0,i.artifactEffectID=0,i.btnUseSkill=void 0,i.btnNoUseSkill=void 0,i.btnUpgrade=void 0,i.skinIDSel=void 0,i.starInfo=[],i.artifactInfo=[],i.iconOriPos=void 0,i.name="ArtifactSkinView",i.url="ui/module/artifact/ArtifactSkinView",i.poolTime=3e3,i}i(n,t);var v=n.prototype;return v.onInit=function(){var t=this;this.nodeRoot=this.findChild("root"),this.addComponentCallbackListener(this.findChild("root/previewBtn"),o.EventType.CLICK,(function(){IS(p).previewBattle(t.skinIDSel)})),this.btnUnlock=this.findChild("root/btnUnlock"),this.addComponentCallbackListener(this.btnUnlock,o.EventType.CLICK,(function(){IS(p).reqSkinLevelUp(t.skinIDSel)})),this.btnUseSkill=this.findChild("root/nodeSkill/btnUse"),this.addComponentCallbackListener(this.btnUseSkill,o.EventType.CLICK,(function(){IS(p).reqUseSkill(t.skinIDSel)})),this.btnNoUseSkill=this.findChild("root/nodeSkill/btnNoUse"),this.addComponentCallbackListener(this.btnNoUseSkill,o.EventType.CLICK,(function(){IS(p).reqUseSkill(0)})),this.btnCancel=this.findChild("root/nodeShow/btnCancel"),this.addComponentCallbackListener(this.btnCancel,o.EventType.CLICK,(function(){IS(p).reqUseArtifact(0)})),this.btnUse=this.findChild("root/nodeShow/btnUse"),this.addComponentCallbackListener(this.btnUse,o.EventType.CLICK,(function(){IS(p).reqUseArtifact(t.skinIDSel)})),this.btnLeft=this.findChild("root/nodeShow/btnLeft"),this.addComponentCallbackListener(this.btnLeft,o.EventType.CLICK,(function(){for(var i,n=e(t.artifactInfo);!(i=n()).done;){var o=i.value;if(o.skin==t.skinIDSel){t.skinIDSel=t.artifactInfo[t.artifactInfo.indexOf(o)-1].skin;break}}t.refreshAll()})),this.btnRight=this.findChild("root/nodeShow/btnRight"),this.addComponentCallbackListener(this.btnRight,o.EventType.CLICK,(function(){for(var i,n=e(t.artifactInfo);!(i=n()).done;){var o=i.value;if(o.skin==t.skinIDSel){t.skinIDSel=t.artifactInfo[t.artifactInfo.indexOf(o)+1].skin;break}}t.refreshAll()})),this.btnUpgrade=this.findChild("root/nodeSkill/btnUpgrade"),this.addComponentCallbackListener(this.btnUpgrade,o.EventType.CLICK,(function(){uiMgr.openView("ArtifactUpgradeInfoView",t.skinIDSel,IS(b).getSkinLevelByID(t.skinIDSel))}));var i=this.findChildComponent("root/ScrollView",s);this.ArtifactUIList=this.addUIList(i,L),this.ArtifactUIList.selectedMode=k.SINGLE;var n=this.findChildComponent("root/nodeShow/ScrollView",s);this.starUIList=this.addUIList(n,A),this.nodeItem=this.findChild("root/item"),this.nodeTop=this.findChild("root/nodeTop");var d=this.findChild("root/nodeSkill/ScrollView/view/content/item"),f=this.findChildComponent("root/nodeSkill/ScrollView/view/content",a);d.on(r.EventType.SIZE_CHANGED,(function(){f.height=d.getComponent(a).height}));var I=this.findChild("root/nodeShow/icon");this.iconOriPos=new h(l.uiMirror?-I.position.x:I.position.x,I.position.y,0),l.uiMirror&&(this.dealMirrorLayout(this.findChildComponent("root/nodeChange/common_ui_xiaotidi",c)),this.dealMirrorLayout(this.findChildComponent("root/nodeSkill/common_ui_xiaotidi",c)))},v.rebuildArtifactList=function(){var t=configArtifact_skin.getDataByList("skin_level",0),i=0;this.artifactInfo=[];for(var n,o=e(t.entries());!(n=o()).done;){var s=n.value,a=(s[0],s[1]);if(IS(b).checkArtifactCanShow(a.artifact_id)){var r=IS(b).getSkinLevelByID(a.artifact_id);this.artifactInfo.push({skin:a.artifact_id,level:r,state:IS(b).getArtifactState(a.artifact_id)})}}this.artifactInfo.sort((function(t,i){return t.state>i.state?-1:1}));for(var h,l=e(this.artifactInfo.entries());!(h=l()).done;){var c=h.value,d=c[0];c[1].skin==this.skinIDSel&&(i=d)}return i},v.onAfterOpen=function(){this.rebuildArtifactList(),this.skinIDSel=this.artifactInfo[0].skin,this.refreshAll()},v.refreshAll=function(){this.refreshArtifactShow(),this.refreshArtifactSkill(),this.refreshArtifactAttr(),this.refreshArtifactChange(),this.refreshItemNum(),this.refreshUseSkillBtn()},v.registerUpdateHandler=function(){this.addEvent(y.TYPE_ARTIFACT_CHANGE,this.onSkinStateChange,this),this.addEvent(y.TYPE_ARTIFACT_SKIN_EFFECT_SEL,this.onRefreshArtifactSel,this),this.addEvent(y.TYPE_ARTIFACT_USE_SKILL,this.refreshUseSkillBtn,this)},v.refreshItemNum=function(){var t=this.findChildComponent("root/nodeItem/Label",d),i=IS(m).getGoodsCountByGoodsGtid(1);t.string=""+i,IS(b).checkSkinRP()},v.refreshUseSkillBtn=function(){IS(b).getSkinLevelByID(this.skinIDSel)<=0?(this.btnUseSkill.active=!1,this.btnNoUseSkill.active=!1):(this.btnUseSkill.active=IS(b).skill_use!=this.skinIDSel,this.btnNoUseSkill.active=IS(b).skill_use==this.skinIDSel)},v.onSkinStateChange=function(){IS(b).getSkinLevelByID(this.skinIDSel)?this.btnUse.active=!0:this.btnUse.active=!1,this.skinIDSel==IS(b).artifact_id?this.btnCancel.active=!0:this.btnCancel.active=!1,this.refreshArtifactShow(),this.refreshArtifactSkill(),this.refreshArtifactAttr(),this.refreshItemNum(),this.refreshUseSkillBtn(),this.checkPageBtn()},v.refreshArtifactSkill=function(){var t=g.findChildComponent(this.nodeRoot,"nodeSkill/Frame",f),i=g.findChildComponent(this.nodeRoot,"nodeSkill/Icon",f),e=g.findChildComponent(this.nodeRoot,"nodeSkill/txtName",d),n=g.findChildComponent(this.nodeRoot,"nodeSkill/ScrollView/view/content/item",d),o=IS(b).getSkinLevelByID(this.skinIDSel);o?o<10&&(this.btnUpgrade.active=!0):this.btnUpgrade.active=!1;var s=configArtifact_skin.getDataByKeys("artifact_id",this.skinIDSel,"skin_level",IS(b).getSkinLevelByID(this.skinIDSel));0==s.skin_skill.length&&(s=configArtifact_skin.getDataByKeys("artifact_id",this.skinIDSel,"skin_level",IS(b).getSkinLevelByID(this.skinIDSel)+1));var a=configSkill.getDataByKey(s.skin_skill[0][0]);this.loadIcon(t,"icon_skill",I.formatStr("common_ICON_jinengkuang0%s",a.quality)),this.loadIcon(i,"icon_skill",a.icon,null,u.ICON_SPRITE),e.string=a.name;var r=configSkill_level.getDataByKeys("id",s.skin_skill[0][0],"level",s.skin_skill[0][1]);n.string=C.formatStr.apply(C,[r.desc].concat(r.desc_parm))},v.refreshArtifactShow=function(){var t=this.findChild("root/nodeShow/icon"),i=this.findChildComponent("root/nodeShow/bgName/txtName",d);this.removeUIEffect(this.artifactEffectID),this.artifactEffectID=this.addUIEffect(configArtifact.getDataByKey(this.skinIDSel).path,t,-1,null,1,(function(t){l.uiMirror&&(t.dir=-1)}));var e=this.rebuildArtifactList();this.ArtifactUIList.datas=this.artifactInfo,this.ArtifactUIList.scrollTo(e);var n=configArtifact.getDataByKey(this.skinIDSel);i.string=n.name,this.starInfo=[0,0,0,0,0];for(var o=0;o<IS(b).getSkinLevelByID(this.skinIDSel);o++){var s=o%5;this.starInfo[s]+=1}this.starUIList.datas=this.starInfo,t.position=new h(this.iconOriPos.x,0!=n.back_location_adjust?n.back_location_adjust:this.iconOriPos.y,0)},v.onRefreshArtifactSel=function(t){this.skinIDSel!=t&&(this.skinIDSel=t,this.refreshAll())},v.refreshArtifactAttr=function(){var t=this.findChildComponent("root/nodeChange/txtBase",d),i=this.findChildComponent("root/nodeChange/txtNext",d),e=this.findChildComponent("root/nodeChange/txtEffect",d),n=configArtifact_skin.getDataByKeys("artifact_id",this.skinIDSel,"skin_level",IS(b).getSkinLevelByID(this.skinIDSel)),o=configArtifact_skin.getDataByKeys("artifact_id",this.skinIDSel,"skin_level",IS(b).getSkinLevelByID(this.skinIDSel)+1),s=this.findChild("root/nodeChange/txtNext"),a=this.findChild("root/nodeChange/Sprite"),r=this.findChildComponent("root/btnUnlock/txtLabel",d);if(null==n.expend||0==n.expend.length)r.string=GetLanguage(200127),e.string=configAttribute.getDataByKey(Number(n.attr[0][0])).name+":",t.string=n.attr[0][1]/100+"%",s.active=!1,a.active=!1,this.nodeItem.active=!1,this.btnUnlock.active=!1,this.btnUpgrade.active=!1,this.nodeTop.active=!0;else{s.active=!0,a.active=!0,this.nodeItem.active=!0,this.btnUnlock.active=!0,this.nodeTop.active=!1,new S(this,this.nodeItem).SetItemId(n.expend[0][0],0);var h=IS(m).getGoodsCountByGoodsGtid(n.expend[0][0]),l=n.expend[0][1];this.findChildComponent("root/item/txtNext",d).string=h+"/"+l,e.string=configAttribute.getDataByKey(Number(o.attr[0][0])).name+":",null==n.attr||0==n.attr.length?(t.string="0%",i.string=o.attr[0][1]/100+"%",r.string=GetLanguage(200101)):(t.string=n.attr[0][1]/100+"%",i.string=o.attr[0][1]/100+"%",r.string=GetLanguage(200128))}},v.refreshArtifactChange=function(){var t=this.findChild("root/nodeShow/icon"),i=this.findChildComponent("root/nodeShow/bgName/txtName",d);this.removeUIEffect(this.artifactEffectID),this.artifactEffectID=this.addUIEffect(configArtifact.getDataByKey(this.skinIDSel).path,t,-1,null,1,(function(t){l.uiMirror&&(t.dir=-1)}));var e=configArtifact.getDataByKey(this.skinIDSel);i.string=e.name,this.checkPageBtn()},v.checkPageBtn=function(){this.btnLeft.active=!0,this.btnRight.active=!0;for(var t,i=e(this.artifactInfo);!(t=i()).done;){var n=t.value;n.skin==this.skinIDSel&&(0==this.artifactInfo.indexOf(n)&&(this.btnLeft.active=!1),this.artifactInfo.indexOf(n)==this.artifactInfo.length-1&&(this.btnRight.active=!1))}IS(b).getSkinLevelByID(this.skinIDSel)?this.btnUse.active=!0:this.btnUse.active=!1,this.skinIDSel==IS(b).artifact_id?this.btnCancel.active=!0:this.btnCancel.active=!1},v.onBeforeClose=function(){},v.onDestroy=function(){},n}(D));var L=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(i=t.call.apply(t,[this].concat(n))||this).imgFrame=void 0,i.imgIcon=void 0,i.imgLock=void 0,i.imgRP=void 0,i.nodeUse=void 0,i.nodeSel=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){this.imgFrame=g.findChildComponent(this.node,"frame",f),this.imgIcon=g.findChildComponent(this.node,"icon",f),this.imgLock=g.findChild(this.node,"lock"),this.imgRP=g.findChild(this.node,"rp"),this.nodeUse=g.findChild(this.node,"nodeUse"),this.nodeSel=g.findChild(this.node,"sel")},n.onRender=function(t,i){this.data=t;var e=configArtifact.getDataByKey(this.data.skin).icon_small,n=configArtifact.getDataByKey(this.data.skin).quality,o=configColor.getDataByKey(n).path;this.view.loadIcon(this.imgFrame,"icon_equip",o),this.view.loadIcon(this.imgIcon,"icon_item",e),this.checkState();var s=this.view;this.nodeSel.active=s.skinIDSel==this.data.skin},n.checkState=function(){this.imgLock.active=!1,this.imgRP.active=!1,this.imgFrame.grayscale=!1,this.imgIcon.grayscale=!1,this.nodeUse.active=!1,1==this.data.state?(this.imgLock.active=!0,this.imgFrame.grayscale=!0,this.imgIcon.grayscale=!0):5==this.data.state&&(this.imgRP.active=!0),this.data.skin==IS(b).artifact_id&&(this.nodeUse.active=!0)},n.onItemClick=function(){normalEvent.emit(y.TYPE_ARTIFACT_SKIN_EFFECT_SEL,this.data.skin)},e}(v),A=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(i=t.call.apply(t,[this].concat(n))||this).imgOne=void 0,i.imgTwo=void 0,i.imgThree=void 0,i.imgDark=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){this.imgOne=g.findChild(this.node,"one"),this.imgTwo=g.findChild(this.node,"two"),this.imgThree=g.findChild(this.node,"three"),this.imgDark=g.findChild(this.node,"dark")},n.onRender=function(t,i){this.imgDark.active=0==t,this.imgOne.active=1==t,this.imgTwo.active=2==t,this.imgThree.active=3==t},n.onItemClick=function(){},e}(v);n._RF.pop()}}}));

