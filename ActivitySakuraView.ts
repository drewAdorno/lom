System.register("chunks:///_virtual/ActivitySakuraView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AudioMgr.ts","./RedPoint.ts","./RedPointMgr.ts","./StorageUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./BattlePassDefine.ts","./MessageView.ts","./RoleDataCache.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./HorseCarnivalDataCache.ts","./ActivitySakuraDataCache.ts","./ActivitySakuraDefine.ts","./BaseView.ts"],(function(t){"use strict";var e,i,a,n,s,r,o,u,d,f,l,h,c,v,m,p,g,S,T,k,w,C,y;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,a=t.Label,n=t.Button,s=t.Vec2,r=t.js},function(t){o=t.audioMgr},function(t){u=t.RedPointType},function(t){d=t.RedPointMgr},function(t){f=t.default},function(t){l=t.default},function(t){h=t.default},null,function(t){c=t.BattlePassDefine},function(t){v=t.default},function(t){m=t.RoleDataCache},function(t){p=t.default},function(t){g=t.ActivityType,S=t.ActivityState,T=t.ActivityEventDefine},function(t){k=t.HorseCarnivalDataCache},function(t){w=t.default},function(t){C=t.ActivitySakuraEvent},function(t){y=t.BaseView}],execute:function(){i._RF.push({},"f4145DJWktAbbCNLdTr5apL","ActivitySakuraView",void 0);t("default",function(t){function i(){var e;return(e=t.call(this)||this).txtTimeDesc=void 0,e.txtLeftTime=void 0,e.leftTime=0,e.deltaTime=0,e.canUpdate=!1,e.name="ActivitySakuraView",e.url="ui/module/activitySakura/ActivitySakuraView",e.fullScreen=!0,e}e(i,t);var y=i.prototype;return y.onInit=function(){var t=this;this.txtTimeDesc=this.findChildComponent("view/nodeTime/txtDesc",a),this.txtLeftTime=this.findChildComponent("view/nodeTime/txtTime",a);var e=this.findChild("view/btnClose");this.addComponentCallbackListener(e,n.EventType.CLICK,(function(){t.close()}));var i=this.findChild("view/nodeTime/tips");this.addComponentCallbackListener(i,n.EventType.CLICK,(function(){IS(p).ShowSysTips(g.Sakura)}));var r=this.findChild("view/btnGame");this.addRedPoint("sakura_game",r,new s(80,30),u.Dot),this.addComponentCallbackListener(r,n.EventType.CLICK,(function(){var t=IS(p).GetActivityInfo(g.SakuraGame);if(t&&t.state==S.Open)uiMgr.openView("ActivitySakuraGameMainView");else if(t&&t.state==S.Preview){var e=t.state_time[S.Open].start_time-h.serverTime;v.showFlyTip(l.formatStrWithMirrorDeal(GetLanguage(201410),h.formatTimeStringForSecond(e)))}else v.showFlyTip(GetLanguage(200026))}));var o=this.findChild("view/btnFind");this.addRedPoint("sakura_find",o,new s(80,30),u.Dot),this.addComponentCallbackListener(o,n.EventType.CLICK,(function(){var t=IS(p).GetActivityInfo(g.SakuraFind);if(t&&t.state==S.Open)uiMgr.openView("ActivitySakuraFindView");else if(t&&t.state==S.Preview){var e=t.state_time[S.Open].start_time-h.serverTime;v.showFlyTip(l.formatStrWithMirrorDeal(GetLanguage(201410),h.formatTimeStringForSecond(e)))}else v.showFlyTip(GetLanguage(200026))}));var d=this.findChild("view/btnPass");this.addRedPoint("sakura_pass",d,new s(80,30),u.Dot),this.addComponentCallbackListener(d,n.EventType.CLICK,(function(){var t=IS(p).GetActivityInfo(g.SakuraPass);if(t&&t.state==S.Open)uiMgr.openView("ActivitySakuraPassView");else if(t&&t.state==S.Preview){var e=t.state_time[S.Open].start_time-h.serverTime;v.showFlyTip(l.formatStrWithMirrorDeal(GetLanguage(201410),h.formatTimeStringForSecond(e)))}else v.showFlyTip(GetLanguage(200026))}));var f=this.findChild("view/btnTurn");this.addRedPoint("sakura_turn",f,new s(80,30),u.Dot),this.addComponentCallbackListener(f,n.EventType.CLICK,(function(){var t=IS(p).GetActivityInfo(g.SakuraTurn);if(t&&t.state==S.Open)uiMgr.openView("ActivitySakuraTurnView");else if(t&&t.state==S.Preview){var e=t.state_time[S.Open].start_time-h.serverTime;v.showFlyTip(l.formatStrWithMirrorDeal(GetLanguage(201410),h.formatTimeStringForSecond(e)))}else v.showFlyTip(GetLanguage(200026))}));var c=this.findChild("view/btnRank");this.addComponentCallbackListener(c,n.EventType.CLICK,(function(){uiMgr.openView("ActivitySakuraRankView",g.SakuraPass)}));var m=this.findChild("view/btnTask");this.addRedPoint("sakura_task",m,new s(25,30),u.Dot),this.addComponentCallbackListener(m,n.EventType.CLICK,(function(){var t=IS(p).GetActivityInfo(g.SakuraTurn);if(t&&t.state==S.Open)uiMgr.openView("ActivitySakuraTaskView",g.SakuraTurn);else if(t&&t.state==S.Preview){var e=t.state_time[S.Open].start_time-h.serverTime;v.showFlyTip(l.formatStrWithMirrorDeal(GetLanguage(201410),h.formatTimeStringForSecond(e)))}else v.showFlyTip(GetLanguage(200026))}));var T=this.findChild("view/btnGift");this.addComponentCallbackListener(T,n.EventType.CLICK,(function(){var t=IS(p).GetActivityInfo(g.SakuraTurn);if(t&&t.state==S.Open)uiMgr.openView("ActivitySakuraGiftView",g.SakuraTurn);else if(t&&t.state==S.Preview){var e=t.state_time[S.Open].start_time-h.serverTime;v.showFlyTip(l.formatStrWithMirrorDeal(GetLanguage(201410),h.formatTimeStringForSecond(e)))}else v.showFlyTip(GetLanguage(200026))}));var k=this.findChild("view/btnStore");this.addRedPoint("sakura_store",k,new s(25,30),u.Dot),this.addComponentCallbackListener(k,n.EventType.CLICK,(function(){uiMgr.openView("ActivitySakuraStoreView",g.Sakura)}))},y.registerUpdateHandler=function(){this.addEvent(T.OnActivityInfoUpdate,this.updateInfo,this),this.addEvent(T.OnActivityInfoTaskUpdate,this.updateRed,this),this.addEvent(T.OnActivityInfoUpdate,this.updateRed,this),this.addEvent(c.BATTLE_PASS_INFO_UPDATE,this.updateRed,this),this.addEvent(T.OnHorseCarnivalUpdate,this.updateRed,this),this.addEvent(T.OnHorseCarnivalReward,this.updateRed,this),this.addEvent(T.OnActivityFindUpdate,this.updateRed,this),this.addEvent(C.OnSakuraGameNewLevelUpdate,this.updateRed,this)},y.onAfterOpen=function(){o.playMusic("fhj_mainBgm"),this.updateRed();var t=IS(p).GetActivityInfo(g.Sakura);if(t){var e,i=null!=(e=t.state_time[t.state])?e:t.state_time[S.Open];if(this.leftTime=i.end_time-h.serverTime,this.leftTime>0){var a="";t.state==S.Preview?a=GetLanguage(200763):t.state==S.Open?a=GetLanguage(200764):t.state==S.EndShow&&(a=GetLanguage(200765)),this.txtTimeDesc.string=a,this.canUpdate=!0,this.txtLeftTime.string=r.formatStr("%s",h.formatTimeStringForSecond(this.leftTime))}else this.txtLeftTime.string=GetLanguage(200026)}else this.txtTimeDesc.string=GetLanguage(200765),this.txtLeftTime.string=GetLanguage(200026)},y.onBeforeClose=function(){o.playMusic("battle"),this.canUpdate=!1},y.onDestroy=function(){},y.onUpdate=function(t){this.canUpdate&&(this.deltaTime=this.deltaTime+t,this.deltaTime>=1&&(this.deltaTime=0,this.leftTime=this.leftTime-1,this.leftTime>0?this.txtLeftTime.string=r.formatStr("%s",h.formatTimeStringForSecond(this.leftTime)):(this.txtLeftTime.string=GetLanguage(200026),this.canUpdate=!1)))},y.updateRed=function(){IS(d).changeValue("sakura_task",IS(p).GetTaskRedNum(g.SakuraTurn)),IS(d).changeValue("sakura_pass",IS(w).getPassRedNum()),IS(d).changeValue("sakura_turn",IS(k).getRedNum(g.SakuraTurn)),IS(d).changeValue("sakura_store",IS(w).GetStoreRed()),IS(d).changeValue("sakura_find",IS(w).getFindRedNum());var t=IS(p).GetActivityInfo(g.SakuraGame);if(t&&t.state==S.Open){var e=IS(p).GetTaskRedNum(g.SakuraGame),i=1==parseInt(f.get("SakuraGame_NewLevel_"+IS(m).GetRoleId()))?1:0;IS(d).changeValue("sakura_game",e+i)}else IS(d).changeValue("sakura_game",0)},y.updateInfo=function(t){if(t.type==g.Sakura&&t.state!=S.Null){var e,i=null!=(e=t.state_time[t.state])?e:t.state_time[S.Open];if(this.leftTime=i.end_time-h.serverTime,this.leftTime>0){var a="";t.state==S.Preview?a=GetLanguage(200763):t.state==S.Open?a=GetLanguage(200764):t.state==S.EndShow&&(a=GetLanguage(200765)),this.txtTimeDesc.string=a,this.canUpdate=!0,this.txtLeftTime.string=r.formatStr("%s",h.formatTimeStringForSecond(this.leftTime))}else this.txtLeftTime.string=GetLanguage(200026)}},i}(y));i._RF.pop()}}}));

