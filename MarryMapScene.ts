System.register("chunks:///_virtual/MarryMapScene.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BattleData.ts","./V2.ts","./AudioMgr.ts","./NodeUtil.ts","./StorageUtil.ts","./TimeUtil.ts","./ConfigGlobal.ts","./ObjectUtil.ts","./PolyNav2D.ts","./ChapterDataCache.ts","./CommonDefine.ts","./MessageView.ts","./LoginDefine.ts","./RoleDataCache.ts","./RoleDefine.ts","./MarryControl.ts","./MarryDataCache.ts","./MarryDefine.ts","./SceneCamera8.ts","./SceneLine2.ts","./SceneUnit5.ts"],(function(i){"use strict";var e,t,n,s,o,r,a,h,d,l,u,c,f,m,g,v,p,y,w,S,T,B,_,M,I,C,P,N,k,L,b,A,U,x,D,E,R,G,O,F,V,H,Q,q;return{setters:[function(i){e=i.createForOfIteratorHelperLoose},function(i){t=i.cclegacy,n=i.Prefab,s=i.UITransform,o=i.Button,r=i.Node,a=i.Vec3,h=i.Vec2,d=i.isValid,l=i.KeyCode,u=i.find,c=i.Camera,f=i.Sprite,m=i.Label,g=i.LabelOutline,v=i.sys,p=i.Color},function(i){y=i.ChapterType},function(i){w=i.V2},function(i){S=i.audioMgr},function(i){T=i.default},function(i){B=i.default},function(i){_=i.default},function(i){M=i.ConfigGlobal},function(i){I=i.default},function(i){C=i.PolyNav2D},function(i){P=i.ChapterDataCache},function(i){N=i.CommonEventDefine},function(i){k=i.default},function(i){L=i.LoginEventDefine},function(i){b=i.RoleDataCache},function(i){A=i.PlayerAttr},function(i){U=i.default},function(i){x=i.default},function(i){D=i.MarryEventDefine,E=i.MarryMap,R=i.RoleUpdateFlag,G=i.WeddingStage,O=i.BridPos},function(i){F=i.SceneCamera},function(i){V=i.SceneLine},function(i){H=i.SceneDog,Q=i.SceneRole,q=i.SceneBox}],execute:function(){var K;t._RF.push({},"5dafaN9tLRLc4qhiJIpppmE","MarryMapScene",void 0);i("MarryMapScene",function(){function i(i){this.node=void 0,this.units=[],this.unitMap={},this.view=void 0,this.mapCamera=new F(this),this.owner=void 0,this.nodeUnit=void 0,this.nodeUnitHub=void 0,this.polyNav=void 0,this.polyNav1=void 0,this.polyNav2=void 0,this.polyNav3=void 0,this.ut=void 0,this.sceneLine=void 0,this.onLoadViewSuccess=void 0,this.startTouchPos=void 0,this.movePaths=[],this.collectPointTime=0,this.collectNum=0,this.leftBrid=void 0,this.rightBrid=void 0,this.dog=void 0,this.mapUrl=void 0,this.stage=void 0,this.timerPanel=void 0,this.timeOutTimer=void 0,this.curMusic=void 0,this.photoBtn=void 0,this.marryEff=void 0,this.hugTime=void 0,this.pickingTimer=0,this.checkPickingTime=0,this.counting=0,K=u("SceneRoot"),this.view=i,this.mapCamera.nodeCamera=T.findChild(K,"SceneCamera"),this.mapCamera.camera=this.mapCamera.nodeCamera.getComponent(c)}var t=i.prototype;return t.load=function(){var i=this;this.node||(null!=this.onLoadViewSuccess&&(resourceMgr.cancelLoadRes(this.mapUrl,this.onLoadViewSuccess),this.onLoadViewSuccess=null),this.onLoadViewSuccess=function(e){if(i.onLoadViewSuccess=null,!e.error&&null!=e.item&&null!=e.item.asset){var t=e.item.asset,n=nodeInstantiate.instantiate(t);i.node=n,n.setParent(K),i.onInit()}},resourceMgr.loadRes(this.mapUrl,n,this.onLoadViewSuccess))},t.onInit=function(){var i=this;this.nodeUnit=T.findChild(this.node,"unit"),this.ut=this.nodeUnit.getComponent(s),this.nodeUnitHub=T.findChild(this.node,"unitHub");var e=this.view;this.marryEff=T.findChild(this.node,"MX_tx_jiehun_1"),this.sceneLine=new V(T.findChild(this.node,"nodeLine")),this.polyNav1=T.findChildComponent(this.node,"polyNav2D1",C),this.polyNav2=T.findChildComponent(this.node,"polyNav2D2",C),this.polyNav3=T.findChildComponent(this.node,"polyNav2D3",C),this.photoBtn=T.findChild(this.node,"camera"),e.addComponentCallbackListener(this.photoBtn,o.EventType.CLICK,(function(){uiMgr.openView("MarryPhotoView")})),this.polyNav=this.polyNav2;var t=T.findChild(this.node,"map_jiehun");e.addComponentCallbackListener(t,r.EventType.TOUCH_END,(function(e){if(i.owner&&i.view.GetIsCanMove()){var t=e.getLocation(),n=new a(t.x,t.y,0),s=i.mapCamera.camera.screenToWorld(n);s.add3f(2e3,0,0),i.moveToTarget(s)}})),this.timerPanel=new W(this.view,T.findChild(this.node,"time")),this.open()},t.registerEvent=function(){var i=this,e=this.view;e.addEvent(D.MARRY_BOX_SHOW,this.showBox,this),e.addEvent(N.KEY_DOWN,this.onKeyDown,this),e.addEvent(D.MARRY_STAGE_STATE,(function(){i.UpdateMarryState(!1,!0)}),this),e.addEvent(D.MARRY_MAIN_QUESTION,this.UpdateTalkInfo,this),e.addEvent(D.MARRY_OPERATE_CHANGE,(function(e){if(2==e.action){var t="role:"+e.action_id,n=i.unitMap[t];if(n)n.playFire()}})),e.addEvent(L.RECONNECT_NET_LINK,this.ReLogin,this),e.addEvent(D.MARRY_SHOW_NAME_STATE,this.ShowNameStateChange,this)},t.ShowNameStateChange=function(){IS(x).GetMarryStageInfo();for(var i=0;i<this.units.length;i++){var e=this.units[i];if(1==e.type)e.showNameState(!this.view.isHideName)}},t.ReLogin=function(){this.stage>0&&IS(U).send_marry_party_stage_c2s()},t.open=function(){var i=IS(x).GetMarryStageInfo();if(i){if(K.active||(K.active=!0),E[i.party_type]&&E[i.party_type]!=this.mapUrl&&(null!=this.onLoadViewSuccess&&(resourceMgr.cancelLoadRes(this.mapUrl,this.onLoadViewSuccess),this.onLoadViewSuccess=null),this.mapUrl=E[i.party_type],this.node&&(this.node.destroy(),this.node=null)),this.node)return this.node.active=!0,this.registerEvent(),void this.onAfterOpen();this.load()}},t.UpdateMemberNum=function(){var i=IS(x).GetMarryStageInfo();if(i){for(var e={},t=0;t<i.bride_list.length;t++){e[i.bride_list[t]]=!0}for(var n=0,s=0;s<this.units.length;s++){var o=this.units[s];1!=o.type||e[o.uid]||n++}this.view.updateMemberNum(n)}},t.close=function(){K.active&&(K.active=!1),this.node&&(this.node.active=!1),null!=this.onLoadViewSuccess&&this.mapUrl&&(resourceMgr.cancelLoadRes(this.mapUrl,this.onLoadViewSuccess),this.onLoadViewSuccess=null),this.onBeforeClose()},t.destroy=function(){this.close(),this.node&&(this.node.destroy(),this.mapUrl&&resourceMgr.releaseResRef(this.mapUrl),this.node=null)},t.onAfterOpen=function(){normalEvent.emit(D.MARRY_SCENE_LOAD_FINISH),this.checkPickingTime=1;var i=IS(x).GetMarryStateInfo();i&&i>0&&IS(U).send_marry_party_main_question_c2s(),this.showBox()},t.onBeforeClose=function(){if(null!=this.owner){for(var i,t=e(this.units);!(i=t()).done;){i.value.destroy()}this.sceneLine.closeLine(),this.mapCamera.follow=null,this.units.length=0,this.unitMap={},this.owner=null,this.timeOutTimer&&(this.view.removeTimer(this.timeOutTimer),this.timeOutTimer=null),S.playMusic("battle"),this.curMusic=null,this.stage=null,this.marryEff.active=!1,this.hugTime&&(this.view.removeTimer(this.hugTime),this.hugTime=null),this.mapCamera.ResetCam(),this.closePickingBox()}},t.onDestroy=function(){},t.moveOwner=function(i){if(this.owner){this.sceneLine.closeLine();var e=this.owner.moveType;this.owner.moveToDir(i),2!=e&&(this.movePaths.length=0,this.collectPointTime=.16),this.IsFakeScene()||1!=e&&0!=this.owner.moveType||(this.movePaths.push(new h(this.owner.position.x,this.owner.position.y)),IS(U).send_marry_scene_move_c2s(this.movePaths))}},t.moveToTarget=function(i){if(this.owner&&this.owner.moveToTarget(i)){var e=I.copyArray(this.owner.agent.activePath);this.IsFakeScene()||IS(U).send_marry_scene_move_c2s(e),this.sceneLine.showLine(e)}},t.boxClick=function(i){if(this.owner){var e=IS(x).boxMap;if(this.owner.rect.intersects(i.rect)){var t=e[i.uid];if(t&&t.role_list&&t.role_list.length>0&&t.role_list.includes(Number(IS(b).GetRoleId())))return void k.showFlyTip(GetLanguage(200339));var n=IS(x).boxInfo;n&&n.round>0&&this.checkPickingBox(0)}else this.moveToTarget(new h(i.position.x,i.position.y))}},t._updateDepth=function(){this.units.sort((function(i,e){var t=1,n=0,s=i.position.y-e.position.y;return(t-=100*s)-(n+=100*s)}));for(var i=0;i<this.units.length;++i){this.units[i].depth=i}},t.onUpdate=function(i){if(this.node){var e=IS(x);0!=e.roleUpdateFlag&&(e.roleUpdateFlag&R.All&&this.loadAllPlayer(),e.roleUpdateFlag&R.Add&&this.addPlayer(),e.roleUpdateFlag&R.Del&&this.delPlayerOut(),e.roleUpdateFlag&R.Move&&this.movePlayer(),e.roleUpdateFlag&R.Break&&this.breakPlayer(),e.roleUpdateFlag&R.SetPos&&this.setPlayerPos()),e.roleUpdateFlag=0,this._updateDepth();for(var t=0;t<this.units.length;t++){var n=this.units[t];n.del?(n.destroy(),this.units.splice(t,1),t--):n.update(i)}if(this.owner){this.mapCamera.onUpdate(),this.owner.agent.isMove||this.sceneLine.closeLine(),this.stage==G.Main&&(this.leftBrid.agent.isMove||(this.leftBrid.SetAnimScale(1),this.rightBrid.SetAnimScale(1))),2==this.owner.moveType&&(this.collectPointTime<=0&&(this.movePaths.push(new h(this.owner.position.x,this.owner.position.y)),this.collectNum++,this.collectNum>=6&&(!this.IsFakeScene()&&this.view.GetIsCanMove()&&IS(U).send_marry_scene_move_c2s(I.copyArray(this.movePaths)),this.movePaths.length=0,this.collectNum=0),this.collectPointTime=.16+i),this.collectPointTime-=i);var s=IS(x).boxInfo;s&&s.round>0&&this.checkPickingBox(i)}var o=IS(P),r=o.currentLoadType==y.Main||o.chapterType==y.Main;K.active!=r&&(K.active=r)}},t.UpdateMarryState=function(i,e){var t=this;this.timeOutTimer&&(this.view.removeTimer(this.timeOutTimer),this.timeOutTimer=null);var n=IS(x).GetMarryStageInfo();if(this.updateUnitsPolyNav(),n){if(this.stage==n.stage&&!i)return;if(n.stage==G.Main||n.stage==G.Over){var s="WeddingStateChange_"+IS(b).GetRoleId()+"_"+n.stage,o=B.get(s);o&&Number(o)==n.wedding_id||(uiMgr.openView("MarryWeddingNoticeView"),B.set(s,n.wedding_id))}this.timerPanel.show(n),this.stage=n.stage;var r=O[n.party_type],a="yanhui_mainbgm";if(n.stage==G.Main?(a="hunli_mainbgm",this.leftBrid&&(this.sceneLine.closeLine(),e?(this.leftBrid.agent.maxSpeed=45,this.rightBrid.agent.maxSpeed=45,this.leftBrid.position=r.oriPos[0],this.rightBrid.position=r.oriPos[1],this.leftBrid.SetAnimScale(.2),this.rightBrid.SetAnimScale(.2),this.leftBrid.moveToTarget(r.endPos[0]),this.rightBrid.moveToTarget(r.endPos[1])):(this.leftBrid.agent.maxSpeed=45,this.rightBrid.agent.maxSpeed=45,this.leftBrid.position=r.oriPos[0],this.rightBrid.position=r.oriPos[1],this.leftBrid.moveToTarget(r.endPos[0]),this.rightBrid.moveToTarget(r.endPos[1])))):n.stage==G.Question&&(this.sceneLine.closeLine(),a="hunli_mainbgm",this.leftBrid&&(this.leftBrid.ToDir(1),this.rightBrid.ToDir(-1),this.leftBrid.agent.maxSpeed=150,this.rightBrid.agent.maxSpeed=150,this.leftBrid.position=r.endPos[0],this.rightBrid.position=r.endPos[1])),i&&n.stage>G.Question&&this.rightBrid&&h.equals(this.rightBrid.agent.pos,r.endPos[1])&&this.rightBrid.ToDir(-1),a!=this.curMusic&&(this.curMusic=a,S.playMusic(a)),this.leftBrid&&n.stage!=G.Question&&(this.leftBrid.ShowTalk(),this.rightBrid.ShowTalk()),n.stage!=G.Question&&(this.marryEff.active=!1,this.hugTime&&(this.view.removeTimer(this.hugTime),this.hugTime=null),this.mapCamera.UnLockCam()),n.stage!=G.Main&&n.stage!=G.Question)this.dog&&(this.dog.destroy(),this.dog=null),this.leftBrid&&(this.leftBrid.SetAnimScale(1),this.rightBrid.SetAnimScale(1));else if(!this.dog){var d;this.dog=new H(this);var l=((d={})[2]=new h(0,-100),d[3]=new h(0,-100),d);this.dog.position=l[n.party_type]}n.stage>0&&n.stage<4&&n.stage_time>0&&(this.timeOutTimer=this.view.addTimer(n.stage_time+15,1,(function(){IS(U).send_marry_party_stage_c2s(),t.timeOutTimer=null})))}else this.timerPanel.show();this.leftBrid&&(n?(this.leftBrid.showNameInfo(2!=n.stage&&3!=n.stage),this.rightBrid.showNameInfo(2!=n.stage&&3!=n.stage)):(this.leftBrid.showNameInfo(!0),this.rightBrid.showNameInfo(!0))),this.UpdateMemberNum()},t.GetMarryJobAnimName=function(i,e){var t=configJobs.getDataByKey(i.info.figure.job_figure),n=configJobs.getDataByKey(e.info.figure.job_figure),s="",o="";return 2==i.info.figure.gender&&2==i.info.figure.gender?(s="bao",o="bao"):i.info.figure.gender==e.info.figure.gender?(s="quan",o="quan"):(s="qin",o="qin"),i.info.figure.gender==e.info.figure.gender&&(t.change_times>=4&&n.change_times<4?s+="2":t.change_times<4&&n.change_times>=4&&(o+="2")),{left:s,right:o}},t.UpdateTalkInfo=function(){var i=this;this.hugTime&&(this.view.removeTimer(this.hugTime),this.hugTime=null);var e=IS(x),t=e.GetMarryStageInfo();if(!t||t.stage!=G.Main&&t.stage!=G.Question)this.dog&&(this.dog.destroy(),this.dog=null);else if(!this.dog){var n;this.dog=new H(this);var s=((n={})[2]=new h(0,-100),n[3]=new h(0,-100),n);this.dog.position=s[t.party_type]}if(t&&3==t.stage){var o=e.GetAnswerInfo();if(o&&this.leftBrid){var r=IS(x).GetWeddingTalk(o.question);r&&(0==o.answer&&this.dog.ShowTalk(GetLanguage(r.question)),o.answer&&o.answer_id==this.leftBrid.uid?(this.leftBrid.ShowTalk(GetLanguage(r.answerList[o.answer-1])),this.rightBrid.ShowTalk()):o.answer&&o.answer_id==this.rightBrid.uid?(this.rightBrid.ShowTalk(GetLanguage(r.answerList[o.answer-1])),this.leftBrid.ShowTalk()):(this.leftBrid.ShowTalk(),this.rightBrid.ShowTalk()))}if(o&&3==o.question&&this.leftBrid){this.leftBrid.ShowTalk(),this.rightBrid.ShowTalk();var a=configWedding_talk.getDataByKey(3);this.hugTime=this.view.addTimer(a.time,1,(function(){i.dog.ShowTalk(),i.mapCamera.PlayCamAnim(new h(0,20),350,(function(){var e=i.GetMarryJobAnimName(i.leftBrid,i.rightBrid);S.playSound("hunli_hpend"),i.leftBrid.SetAnimScale(.2),i.leftBrid.SetAnimation(e.left),i.rightBrid.SetAnimScale(.2),i.rightBrid.SetAnimation(e.right),i.hugTime=null,i.leftBrid.info.figure.gender!=i.rightBrid.info.figure.gender&&(i.hugTime=i.view.addTimer(1.5,1,(function(){i.marryEff.active=!0,i.hugTime=null})))}))}))}}},t.IsFakeScene=function(){var i=IS(x).GetMarryStageInfo();return!i||0==i.stage},t.loadAllPlayer=function(){for(var i=0;i<this.units.length;i++){var e=this.units[i];1==e.type&&(e.destroy(),this.units.splice(i,1),i--,delete this.unitMap[e.id])}this.owner=null;var t=IS(x),n=t.roleMap,s=t.GetMarryStageInfo();if(s){var o={};if(s)for(var r=0;r<s.bride_list.length;r++){o[s.bride_list[r]]=!0}var a=0,h=0,d=[];for(var l in this.leftBrid=null,this.rightBrid=null,n){var u=n[l],c=new Q(this,u);this.units.push(c),this.unitMap[c.id]=c,u.role_id==IS(b).GetRoleId()&&(this.owner=c,this.mapCamera.follow=c);var f=!this.view.isHideName;!o[u.role_id]||1!=u.figure.gender&&0!=u.figure.gender?o[u.role_id]&&2==u.figure.gender&&(h++,d.push(c),this.rightBrid=c):(a++,d.push(c),this.leftBrid=c),c.showNameState(f)}if(a>1||h>1){for(var m=0;m<s.bride_list.length;m++)for(var g=s.bride_list[m],v=0;v<d.length;v++)d[v].uid==g&&(0==m?this.leftBrid=d[v]:this.rightBrid=d[v]);var p;this.leftBrid.uid>this.rightBrid.uid&&(p=this.leftBrid,this.leftBrid=this.rightBrid,this.rightBrid=p)}this.UpdateMarryState(!0),this.UpdateTalkInfo()}},t.addPlayer=function(){for(var i,t=IS(x),n=(t.GetMarryStageInfo(),t.roleMap),s=t.roleActions[R.Add],o=e(s);!(i=o()).done;){var r=i.value,a="role:"+r;if(this.unitMap[a]){if((this.stage==G.Main||this.stage==G.Question)&&(this.leftBrid&&this.leftBrid.id==a||this.rightBrid&&this.rightBrid.id==a))continue;var h=this.unitMap[a];this.units.splice(this.units.indexOf(h),1),h.destroy(),delete this.unitMap[a]}var d=n[r],l=new Q(this,d),u=!this.view.isHideName;this.units.push(l),this.unitMap[l.id]=l,this.leftBrid&&this.leftBrid.id==a&&(this.leftBrid=l),this.rightBrid&&this.rightBrid.id==a&&(this.rightBrid=l),l.showNameState(u)}s.clear(),this.UpdateMemberNum()},t.delPlayerOut=function(){for(var i,t=IS(x).roleActions[R.Del],n=e(t);!(i=n()).done;){var s="role:"+i.value;this.unitMap[s]&&(this.unitMap[s].del=!0,delete this.unitMap[s])}t.clear(),this.UpdateMemberNum()},t.movePlayer=function(){for(var i,t=IS(x),n=t.roleMap,s=t.roleActions[R.Move],o=e(s);!(i=o()).done;){var r=i.value,a="role:"+r;if(this.owner&&this.owner.id!=a&&(this.stage!=G.Main&&this.stage!=G.Question||!(this.leftBrid&&this.leftBrid.id==a||this.rightBrid&&this.rightBrid.id==a))){var h=this.unitMap[a];h&&!h.del&&(h.agent.activePath=n[r].pos_list,h.moveType=1,h.agent.isMove=!0)}}s.clear()},t.breakPlayer=function(){for(var i,t=IS(x),n=t.roleMap,s=t.roleActions[R.Break],o=e(s);!(i=o()).done;){var r=i.value,a="role:"+r;if(this.owner&&this.owner.id!=a){var h=this.unitMap[a];h&&!h.del&&d(h.nodeActive)&&(h.nodeActive.active=1!=n[r].break,h.titleicon.active=1!=n[r].break)}}s.clear()},t.setPlayerPos=function(){for(var i,t=IS(x),n=t.roleActions[R.SetPos],s=t.roleMap,o=e(n);!(i=o()).done;){var r=i.value,a="role:"+r;if(this.stage!=G.Main&&this.stage!=G.Question||!(this.leftBrid&&this.leftBrid.id==a||this.rightBrid&&this.rightBrid.id==a)){var h=this.unitMap[a];h&&!h.del&&d(h.nodeActive)&&(this.owner&&this.owner.id==a&&this.sceneLine.closeLine(),h.moveType,h.position=new w(s[r].pos.x,s[r].pos.y))}}n.clear()},t.showBox=function(){for(var i=0;i<this.units.length;i++){var e=this.units[i];2==e.type&&(e.destroy(),this.units.splice(i,1),i--,delete this.unitMap[e.id])}var t=IS(x).boxInfo;if(null!=t&&0!=t.round){var n=IS(x).boxMap;for(var s in n){var o=n[s],r=new q(this,o);this.units.push(r),this.unitMap[r.id]=r}}},t.closePickingBox=function(){this.view.removeTimer(this.pickingTimer),this.pickingTimer=0,this.counting=0,this.owner&&this.owner.refreshPickingState(this.counting)},t.checkPickingBox=function(i){var t=this;if(0==this.pickingTimer)if(this.checkPickingTime>0)this.checkPickingTime-=i;else{this.checkPickingTime=1;for(var n,s=!1,o=e(this.units);!(n=o()).done;){var r=n.value;if(2==r.type&&this.owner.rect.intersects(r.rect)){s=!0;break}}if(s){var a=IS(x).boxMap,h=this.view;this.pickingTimer=h.addTimer(.16,-1,(function(){var i=IS(x).boxInfo;if(null!=i&&0!=i.round){for(var n,s=!1,o=null,r=e(t.units);!(n=r()).done;){var h=n.value;2==h.type&&(t.owner.rect.intersects(h.rect)&&(o=a[h.uid],s=!0))}if(o&&o.role_list&&o.role_list.length>0&&o.role_list.includes(Number(IS(b).GetRoleId())))return t.closePickingBox(),void k.showFlyTip(GetLanguage(200339));s?(t.counting+=.16,t.counting>=M.treasure_hunt_pick_time&&(t.closePickingBox(),IS(U).send_marry_scene_box_open_c2s(o)),t.owner.refreshPickingState(t.counting)):(t.closePickingBox(),k.showFlyTip(GetLanguage(200340)))}else t.closePickingBox()}))}}},t.updateUnitsPolyNav=function(){var i=IS(x).GetMarryStageInfo();!i||i.stage!=G.Main&&i.stage!=G.Question?this.polyNav=this.polyNav2:this.polyNav=this.polyNav1,i&&i.stage!=G.NotStart||(this.polyNav=this.polyNav2);for(var e=0;e<this.units.length;e++){var t=this.units[e];if(1==t.type){var n=t;!this.leftBrid||n.uid!=this.leftBrid.uid&&n.uid!=this.rightBrid.uid?n.updatePolyNav(this.polyNav):n.updatePolyNav(this.polyNav2)}}},t.onKeyDown=function(i){2!=GlobalDefine.SERVER_LIST_TYPE&&(i==l.F8&&this.mapCamera.PlayCamAnim(new h(0,20),350),i==l.F7&&this.mapCamera.UnLockCam())},i}());var W=function(){function i(i,e){this.view=void 0,this.node=void 0,this.fram1=[],this.fram2=[],this.headIcon=[],this.nameBg=[],this.name=[],this.nameOutline=[],this.timeTxt=void 0,this.timer=void 0,this.marryTimeDes=void 0,this.view=i,this.node=e;for(var t=0;t<2;t++)this.fram1[t]=T.findChild(e,"Icon"+t+"/icon1"),this.fram2[t]=T.findChild(e,"Icon"+t+"/icon2"),this.headIcon[t]=T.findChildComponent(e,"Icon"+t+"/mask/head/image",f),this.nameBg[t]=T.findChild(e,"Icon"+t+"/nameBg"),this.name[t]=T.findChildComponent(e,"Icon"+t+"/nameTxt",m),this.nameOutline[t]=T.findChildComponent(e,"Icon"+t+"/nameTxt",g);if(this.marryTimeDes=T.findChildComponent(e,"timeTitle",m),this.timeTxt=T.findChildComponent(e,"timeTitle/timeNum",m),v.uiMirror){var n=this.marryTimeDes.node.position;this.marryTimeDes.node.setPosition(-n.x,n.y,0);var o=T.findChildComponent(e,"timeTitle",s);o.anchorPoint=new h(0,.5),n=this.timeTxt.node.position,this.timeTxt.node.setPosition(-n.x,n.y,0),(o=T.findChildComponent(e,"timeTitle/timeNum",s)).anchorPoint=new h(0,.5)}}var t=i.prototype;return t.show=function(i){var t=this;this.timer&&(this.view.removeTimer(this.timer),this.timer=null);var n=IS(x).GetMarryStateInfo();if(n&&i&&i.stage>=G.previewStart&&i.stage<=G.End){this.node.active=!0,this.marryTimeDes.string=i.stage<=1?GetLanguage(200763):GetLanguage(204128),n.bride_list.sort((function(i,e){return i.figure.gender<e.figure.gender?-1:1}));for(var s=0;s<n.bride_list.length;s++){var o=n.bride_list[s],r=o.info_list.kv,a=o.info_list.ks,h={};if(null!=r)for(var d,l=e(r);!(d=l()).done;){var u=d.value;h[u.k]=u.v}if(null!=a)for(var c,f=e(a);!(c=f()).done;){var m=c.value;h[m.k]=m.s}this.view.loadRemoteIcon(h[A.ROLE_ATTR_HEAD_URL],this.headIcon[s],null,null,!0),this.name[s].string=h[A.ROLE_ATTR_NAME],this.fram1[s].active,o.figure.gender,this.fram2[s].active,o.figure.gender,this.nameOutline[s].color=2==o.figure.gender?new p("#D22F53"):new p("##296C85"),this.view.loadIcon(this.nameBg[s],"marry_wedding",2==o.figure.gender?"hl_touxiang_mingzi_bg02":"hl_touxiang_mingzi_bg")}this.timeTxt.string=_.formatTimeForSecond(n.stage_time-_.serverTime),this.timer=this.view.addTimer(1,n.stage_time-_.serverTime,(function(){n.stage_time-_.serverTime>0?t.timeTxt.string=_.formatTimeForSecond(n.stage_time-_.serverTime):(t.node.active=!1,t.timer&&(t.view.removeTimer(t.timer),t.timer=null))}))}else this.node.active=!1},t.close=function(){this.timer&&(this.view.removeTimer(this.timer),this.timer=null)},i}();t._RF.pop()}}}));

