System.register("chunks:///_virtual/GvGControl.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BattleData.ts","./BattleDataFill.ts","./FixMath.ts","./ChapterDataCache.ts","./ChapterDefine.ts","./MessageView.ts","./GvGDataCache.ts","./GvGDefine.ts"],(function(e){"use strict";var n,t,a,_,g,o,r,i,s,v,c,d;return{setters:[function(e){n=e.createForOfIteratorHelperLoose},function(e){t=e.cclegacy},function(e){a=e.ChapterType,_=e.PlayerData,g=e.BattleData},function(e){o=e.BattleDataFill},function(e){r=e.FixMath},function(e){i=e.ChapterDataCache},function(e){s=e.ChapterEventDefine},function(e){v=e.default},function(e){c=e.GvGDataCache},function(e){d=e.GvGEventDefine}],execute:function(){t._RF.push({},"ec203SmN4RDXqOZpytE8rHJ","GvGControl",void 0);var l=[];e("default",function(){var e=t.prototype;function t(){netManager.addEventListener("gvg.gvg_info_s2c",this.on_gvg_info_s2c,this),netManager.addEventListener("gvg.gvg_select_road_s2c",this.on_gvg_select_road_s2c,this),netManager.addEventListener("gvg.gvg_road_info_s2c",this.on_gvg_road_info_s2c,this),netManager.addEventListener("gvg.gvg_road_change_s2c",this.on_gvg_road_change_s2c,this),netManager.addEventListener("gvg.gvg_fight_info_s2c",this.on_gvg_fight_info_s2c,this),netManager.addEventListener("gvg.gvg_fight_report_s2c",this.on_gvg_fight_report_s2c,this),netManager.addEventListener("gvg.gvg_fight_settlement_s2c",this.on_gvg_fight_settlement_s2c,this),netManager.addEventListener("gvg.gvg_road_update_s2c",this.on_gvg_road_update_s2c,this),netManager.addEventListener("gvg.gvg_play_video_s2c",this.on_gvg_play_video_s2c,this),netManager.addEventListener("gvg.play_video_test_s2c",this.gvg_play_video_test_s2c,this),netManager.addEventListener("gvg.gvg_map_update_s2c",this.on_gvg_map_update_s2c,this),netManager.addEventListener("gvg.gvg_serv_list_s2c",this.on_gvg_serv_list_s2c,this),netManager.addEventListener("gvg.gvg_season_info_s2c",this.on_gvg_season_info_s2c,this),netManager.addEventListener("gvg.gvg_hall_s2c",this.on_gvg_hall_s2c,this),netManager.addEventListener("gvg.gvg_hall_of_fame_s2c",this.on_gvg_hall_of_fame_s2c,this),netManager.addEventListener("gvg.gvg_rank_s2c",this.on_gvg_rank_s2c,this),netManager.addEventListener("gvg.gvg_rank_list_s2c",this.on_gvg_rank_list_s2c,this),netManager.addEventListener("gvg.gvg_settlement_week_s2c",this.on_gvg_settlement_week_s2c,this),netManager.addEventListener("gvg.gvg_settlement_season_s2c",this.on_gvg_settlement_season_s2c,this),netManager.addEventListener("gvg.gvg_road_change_all_s2c",this.on_gvg_road_change_all_s2c,this),netManager.addEventListener("gvg.gvg_week_rank_s2c",this.on_gvg_week_rank_s2c,this),netManager.addEventListener("gvg.gvg_role_change_s2c",this.on_gvg_role_change_s2c,this),normalEvent.on(s.CHAPTER_BATTLE_RESUTL,this.onPvpOrRecordVideoEnd,this)}return e.clear=function(){printLog("GvGControl")},e.onPvpOrRecordVideoEnd=function(e,t,_,g,o,r){if(t==a.Gvg&&l.length>0){for(var i,s=n(l);!(i=s()).done;){var v,c=i.value,d=c[0],f=c[1];(v=uiMgr).openView.apply(v,[d].concat(f))}l=[]}},e.onLogin=function(){},e.onReconnect=function(){},e.reqGvGInfo=function(){netManager.send("gvg.gvg_info_c2s",{})},e.on_gvg_info_s2c=function(e){if(IS(c).factStep=e.step||0,IS(c).step=e.step?IS(c).getStepTypeByStep(e.step):0,IS(c).timeList=e.time_list||[],IS(c).ifJoin=e.if_join||0,IS(c).myRoad=e.my_road||0,IS(c).ifCross=e.if_cross||0,IS(c).curSeason=e.season||0,IS(c).curRound=e.round||0,IS(c).curRanking=e.ranking||0,IS(c).endTime=e.end_time||0,e.map_info){IS(c).status=e.map_info.status,IS(c).enemyName=e.map_info.name,IS(c).enemyId=e.map_info.guild_id,IS(c).enemyServerId=e.map_info.serv_id;var n=e.map_info.road_list;if(n&&n.length>0)for(var t=0;t<n.length;t++)IS(c).roadIdToInfo[n[t].road]=n[t]}normalEvent.emit(d.GVG_INFO_UPDATE)},e.reqGvGSelectRoad=function(e){netManager.send("gvg.gvg_select_road_c2s",{road:e})},e.reqGvGRoadInfo=function(e,n){netManager.send("gvg.gvg_road_info_c2s",{type:e,road:n})},e.on_gvg_select_road_s2c=function(e){var n=e.road;null!=n&&(IS(c).myRoad=n,normalEvent.emit(d.GVG_INFO_UPDATE),normalEvent.emit(d.GVG_ROAD_INFO_BACK,1,n,e.player_list))},e.on_gvg_road_info_s2c=function(e){var n=e.road,t=e.type,a=e.player_list||[];2==t&&IS(c).roadIdToInfo[n]&&(IS(c).roadIdToInfo[n].enemy_num=a.length),normalEvent.emit(d.GVG_ROAD_INFO_BACK,t,n,a),normalEvent.emit(d.GVG_ROAD_INFO_UPDATE,n)},e.reqGvGRoadChange=function(e,n){netManager.send("gvg.gvg_road_change_c2s",{road:e,road_info:n})},e.on_gvg_road_change_s2c=function(e){var n=e.road;null!=n&&(0==e.code?v.showFlyTip(GetLanguage(200386)):null!=uiMgr.getOpenView("GvGRoadInfoView")&&v.showFlyTip(configErrorInfo.getDataByKey(e.code).info),normalEvent.emit(d.GVG_ROAD_INFO_UPDATE,n,!0,e.player_list))},e.reqGvGFightInfo=function(e){netManager.send("gvg.gvg_fight_info_c2s",{road:e})},e.on_gvg_fight_info_s2c=function(e){normalEvent.emit(d.GVG_FIGHT_INFO_BACK,e)},e.reqGvGFightReport=function(e){netManager.send("gvg.gvg_fight_report_c2s",{road:e})},e.on_gvg_fight_report_s2c=function(e){normalEvent.emit(d.GVG_FIGHT_REPORT_BACK,e.road,e.report)},e.on_gvg_fight_settlement_s2c=function(e){uiMgr.openView("GvGResultView",e)},e.on_gvg_road_update_s2c=function(e){var n=e.road_info;if(!(null==n||n.length<=0)){for(var t={},a=0;a<n.length;a++){var _=n[a],g=_.road;IS(c).roadIdToInfo[g]&&2==IS(c).roadIdToInfo[g].status&&2!=_.status&&(t[g]=!0),IS(c).roadIdToInfo[g]=_}for(var o=0;o<n.length;o++){var r=n[o].road;t[r]&&normalEvent.emit(d.GVG_ROAD_PLAY_EFFECT,r,n[o].status),normalEvent.emit(d.GVG_ROAD_INFO_UPDATE,r)}}},e.reqGvgVideo=function(e,n,t){void 0===n&&(n=0);var _=IS(i);0==_.currentLoadType&&(_.chapterType=a.Gvg,_.currentLoadType=_.chapterType,(l=[]).push(["GvGMapView",[]]),l.push(["GvGReportView",[t]]),_.battleData=null,netManager.send("gvg.gvg_play_video_c2s",{vid:e,source:n}))},e.on_gvg_play_video_s2c=function(e){var n=IS(i);if(n.currentLoadType==a.Gvg)if(n.currentLoadType=0,0==e.code){uiMgr.closeAllView(["MainView","MessageView","GuideView","BattleHubView"]),battleMain.enterChapter(0);var t=new g;t.chapterId=140001,t.seed=e.seed,t.chapterType=a.Gvg,t.recordType=1,t.source=e.source,0==e.winner_id?t.recordWin=0:t.recordWin=e.winner_id==e.atk_data.id?1:2,t.playerList[1]=new _(1),t.playerList[2]=new _(2),o.setPlayerList(e.atk_data,t.playerList[1],a.Gvg),o.setPlayerList(e.def_data,t.playerList[2],a.Gvg),t.playerImage=1==e.if_change,n.battleData=t,normalEvent.emit(s.BATTLE_STATE,a.Gvg,!0)}else l=[]},e.reqLog=function(e,n){netManager.send("role.client_log_c2s",{role_id:e,log:n})},e.gvg_play_video_test_s2c=function(e){var n=IS(i);if(n.chapterType=e.chapter_type,n.currentLoadType=n.chapterType,n.battleData=null,n.currentLoadType=0,0==e.code){uiMgr.closeAllView(["MainView","MessageView","GuideView","BattleHubView"]),battleMain.enterChapter(0);var t=new g;t.chapterId=e.chapter_id,t.seed=r.roundInt(Number(e.seed)),t.chapterType=n.chapterType,t.recordType=1,t.source=e.source,t.recordWin=e.winner_id==e.atk_data.id?1:2,t.playerList[1]=new _(1),t.playerList[2]=new _(2),o.setPlayerList(e.atk_data,t.playerList[1],n.chapterType),o.setPlayerList(e.def_data,t.playerList[2],n.chapterType),t.playerImage=1==e.if_change,n.battleData=t,normalEvent.emit(s.BATTLE_STATE,n.chapterType,!0),printLogErr(JSON.stringify(e))}else l=[]},e.reqGvGCancelRedPoint=function(e){netManager.send("gvg.gvg_cancel_red_point_c2s",{type:e})},e.on_gvg_map_update_s2c=function(e){var n=e.map_info;if(n){2==IS(c).status&&2!=n.status&&(IS(c).waitPlayHomeBreak=!0),IS(c).status=n.status,IS(c).enemyName=n.name,IS(c).enemyId=n.guild_id,IS(c).enemyServerId=n.serv_id;var t=n.road_list;if(t&&t.length>0)for(var a=0;a<t.length;a++)IS(c).roadIdToInfo[t[a].road]=t[a];normalEvent.emit(d.GVG_INFO_UPDATE)}},e.reqGvGServList=function(){netManager.send("gvg.gvg_serv_list_c2s",{})},e.on_gvg_serv_list_s2c=function(e){var n=e.serv_list||[];normalEvent.emit(d.GVG_SERVER_LIST_BACK,n)},e.reqGvGSeasonInfo=function(){netManager.send("gvg.gvg_season_info_c2s",{})},e.on_gvg_season_info_s2c=function(e){normalEvent.emit(d.GVG_SEASON_INFO_BACK,e)},e.reqGvGHall=function(){netManager.send("gvg.gvg_hall_c2s",{})},e.on_gvg_hall_s2c=function(e){normalEvent.emit(d.GVG_HALL_INFO_BACK,e)},e.reqGvGHallOfFame=function(){netManager.send("gvg.gvg_hall_of_fame_c2s",{})},e.on_gvg_hall_of_fame_s2c=function(e){normalEvent.emit(d.GVG_HALL_OF_FAME_INFO_BACK,e)},e.reqGvGRank=function(){netManager.send("gvg.gvg_rank_c2s",{})},e.on_gvg_rank_s2c=function(e){normalEvent.emit(d.GVG_RANK_INFO_BACK,e)},e.reqGvGRankList=function(e){netManager.send("gvg.gvg_rank_list_c2s",{ranking:e})},e.on_gvg_rank_list_s2c=function(e){normalEvent.emit(d.GVG_RANK_LIST_BACK,e)},e.on_gvg_settlement_week_s2c=function(e){uiMgr.openView("GvGWeekResultView",e)},e.on_gvg_settlement_season_s2c=function(e){uiMgr.openView("GvGSeasonResultView",e)},e.reqGvGRoadChangeAll=function(e,n){netManager.send("gvg.gvg_road_change_all_c2s",{road:e,road1:n})},e.on_gvg_road_change_all_s2c=function(e){var n=e.road_info_list;if(0!=e.code&&null!=uiMgr.getOpenView("GvGRoadExchangeView")&&v.showFlyTip(configErrorInfo.getDataByKey(e.code).info),n&&n.length>0)for(var t=0;t<n.length;t++)IS(c).roadIdToInfo[n[t].road]=n[t],normalEvent.emit(d.GVG_ROAD_INFO_BACK,1,n[t].road,n[t].player_list);normalEvent.emit(d.GVG_INFO_UPDATE)},e.reqGvGWeekRank=function(e){netManager.send("gvg.gvg_week_rank_c2s",{type:e})},e.on_gvg_week_rank_s2c=function(e){normalEvent.emit(d.GVG_WEEK_RANK_BACK,e)},e.reqGvGRoleChange=function(e,n){netManager.send("gvg.gvg_role_change_c2s",{road:e,info:n})},e.on_gvg_role_change_s2c=function(e){var n=e.road_info_list;if(0!=e.code&&null!=uiMgr.getOpenView("GvGSingleAdjustView")&&(v.showFlyTip(configErrorInfo.getDataByKey(e.code).info),701==e.code&&uiMgr.close("GvGSingleAdjustView")),n&&n.length>0)for(var t=0;t<n.length;t++)IS(c).roadIdToInfo[n[t].road]=n[t],normalEvent.emit(d.GVG_ROAD_INFO_BACK,1,n[t].road,n[t].player_list);normalEvent.emit(d.GVG_INFO_UPDATE)},t}());t._RF.pop()}}}));

