System.register("chunks:///_virtual/ScienceDataCache.ts",["cc","./ConfigGlobal.ts","./RedPointMgr.ts","./ObjectUtil.ts","./index57.ts","./BagModel.ts","./BagDefine.ts","./CommonDefine.ts","./RoleDefine.ts","./RoleDataCache.ts","./ScienceDefine.ts","./ScienceModel.ts","./UIDefine.ts"],(function(e){"use strict";var i,n,t,c,o,s,a,l,h,d,r,f,u,p;return{setters:[function(e){i=e.cclegacy,n=e.js},function(e){t=e.ConfigGlobal},function(e){c=e.RedPointMgr},function(e){o=e.default},null,function(e){s=e.BagModel},function(e){a=e.BagEventDefine},function(e){l=e.CommonEventDefine},function(e){h=e.RoleEventDefine},function(e){d=e.RoleDataCache},function(e){r=e.ScienceEventDefine},function(e){f=e.ScienceModel},function(e){u=e.OpenFunction,p=e.PanelTabType}],execute:function(){i._RF.push({},"4556dosoZxHhbrQb6rrhoS/","ScienceDataCache",void 0);e("ScienceDataCache",function(){var e=i.prototype;function i(){this.typeToScienceTreeInfo=void 0,this.cacheScienceList=void 0,this.testList=void 0,this.selectIndex=void 0,this.loopNum=void 0,this.cacheCfgList=void 0,this.typeToScienceTreeInfo={},this.cacheScienceList={},this.cacheScienceList[1]={},this.cacheScienceList[2]={},this.cacheCfgList={},this.cacheCfgList[1]={},this.cacheCfgList[2]={},this.initCacheCfgList(),normalEvent.on(a.GOODS_INFO_UPDATE,this.onGoodsInfoUpdate,this),normalEvent.on(h.ROLE_OPEN_FUNCTION_UPDATE,this.onRoleOpenFunctionUpdate,this)}return e.clear=function(){normalEvent.off(a.GOODS_INFO_UPDATE,this.onGoodsInfoUpdate,this),normalEvent.off(h.ROLE_OPEN_FUNCTION_UPDATE,this.onRoleOpenFunctionUpdate,this)},e.onRoleOpenFunctionUpdate=function(e){e==u.FUNC_SCIENCE_AND_TECHNOLOGY&&this.updateAllScienceRedPoint()},e.onGoodsInfoUpdate=function(e,i){i==t.mine_ore&&this.updateAllScienceRedPoint()},e.initScienceTreeByType=function(e){var i=e.type;this.typeToScienceTreeInfo[i]={type:i,doing:e.doing,etime:e.etime,scienceIdToInfo:{}};var n=e.science_list;if(null!=n){for(var t=0;t<n.length;t++)this.typeToScienceTreeInfo[i].scienceIdToInfo[n[t].science_id]=n[t];this.updateAllScienceRedPoint()}else this.updateAllScienceRedPoint()},e.updateScienceTreeByType=function(e){var i=e.type;null==this.typeToScienceTreeInfo[i]&&(this.typeToScienceTreeInfo[i]={}),this.typeToScienceTreeInfo[i].doing=e.doing,this.typeToScienceTreeInfo[i].etime=e.etime,null==this.typeToScienceTreeInfo[i].scienceIdToInfo&&(this.typeToScienceTreeInfo[i].scienceIdToInfo={});for(var n=e.science_list||[],t=0;t<n.length;t++)this.typeToScienceTreeInfo[i].scienceIdToInfo[n[t].science_id]=n[t],normalEvent.emit(r.SCIENCE_ITEM_UPDATE,n[t].science_id);normalEvent.emit(r.SCIENCE_TREE_UPDATE,i),this.updateAllScienceRedPoint()},e.initCacheCfgList=function(){var e,i,n=configScience.getDatas(),t={},c={};if(n){for(var s=0;s<n.length;s++){var a=n[s];e=a.id,i=a.level,1==a.type?(o.isEmpty(t[e])&&(t[e]=a),t[e].level>i&&(t[e]=a)):2==a.type&&(o.isEmpty(c[e])&&(c[e]=a),c[e].level>i&&(c[e]=a))}this.cacheCfgList[1]=t,this.cacheCfgList[2]=c}var l,h={};for(var d in t){var r=t[d],f=r.display;if(null==f||f.length<=0)l=r;else for(var u=0;u<f.length;u++){var p=f[u];null==h[p]&&(h[p]={level:t[p].level,id:p,parent:0,childId:[]}),h[p].parent=h[p].parent+1,h[p].childId.push(r.id)}}for(var S in this.testList=h,this.selectIndex=1,this.loopNum=0,this.cacheScienceList[1]={},this.cacheScienceList[2]={},h[l.id]&&this.loopFun(h[l.id],1),h={},c){var I=c[S],v=I.display;if(null==v||v.length<=0)l=I;else for(var g=0;g<v.length;g++){var T=v[g];null==h[T]&&(h[T]={level:c[T].level,id:T,parent:0,childId:[]}),h[T].parent=h[T].parent+1,h[T].childId.push(I.id)}}this.testList=h,this.selectIndex=2,this.loopNum=0,h[l.id]&&this.loopFun(h[l.id],1)},e.loopFun=function(e,i){if(this.loopNum=this.loopNum+1,!(this.loopNum>80)){this.cacheScienceList[this.selectIndex][e.id]={index:i,level:e.level,id:e.id,childId:e.childId};for(var n=0;n<e.childId.length;n++){var t=e.childId[n];this.testList[t]?null==this.cacheScienceList[this.selectIndex][t]&&this.loopFun(this.testList[t],i+1):this.cacheScienceList[this.selectIndex][t]={index:i+1,level:1,id:t,childId:[]}}}},e.checkScienceCanUpgrade=function(e){var i=IS(f).getScienceLevelByScienceId(e);if(configScience.getDataByList("id",e).length==i)return{canUpgrade:!1,conditionOk:!1};var n,t,c=i+1,o=configScience.getDataByKeys("id",e,"level",c),a=o.condition;if(null!=a)for(var l=0;l<a.length;l++)if(n=a[l][0],t=a[l][1],IS(f).getScienceLevelByScienceId(n)<t)return{canUpgrade:!1,conditionOk:!1};var h=o.cost;return{canUpgrade:IS(s).getGoodsCountByGoodsGtid(h[0][0])>=h[0][1],conditionOk:!0}},e.updateScienceRedPoint=function(e){IS(c).changeValue(n.formatStr("MainView/tab-%s/science/scienceItem-%s",p.Main_Mystery,e),this.getScienceRedPoint(e))},e.getScienceRedPoint=function(e){if(!IS(d).CheckFuncOpen(u.FUNC_SCIENCE_AND_TECHNOLOGY))return 0;var i=this.typeToScienceTreeInfo[1];return null==i||0!=i.doing?0:1==this.checkScienceCanUpgrade(e).canUpgrade?1:0},e.getAllScienceRedPoint=function(){if(!IS(d).CheckFuncOpen(u.FUNC_SCIENCE_AND_TECHNOLOGY))return 0;var e=this.typeToScienceTreeInfo[1];if(null==e)return 0;if(0!=e.doing)return 0;var i=0;for(var n in this.cacheCfgList[1])0!=this.getScienceRedPoint(Number(n))&&(i+=1);return i},e.updateAllScienceRedPoint=function(){for(var e in this.cacheCfgList[1])this.updateScienceRedPoint(Number(e));this.updateScienceRootRedPoint()},e.updateScienceRootRedPoint=function(){IS(c).changeValue(n.formatStr("MainView/tab-%s/science",p.Main_Mystery),this.getAllScienceRedPoint()),normalEvent.emit(l.UPDATE_MAIN_MYSTERY_RED_POINT)},i}());i._RF.pop()}}}));

