System.register("chunks:///_virtual/ActivitySakuraDataCache.ts",["./rollupPluginModLoBabelHelpers.js","cc","./RedPointMgr.ts","./StorageUtil.ts","./TimeUtil.ts","./index57.ts","./BagDefine.ts","./BagModel.ts","./BattlePassControl.ts","./ChapterDefine.ts","./RoleDataCache.ts","./ActivityControl.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./HorseCarnivalDataCache.ts","./BaseView.ts"],(function(t){"use strict";var e,i,n,r,o,a,s,u,c,d,v,h,f,l,p,g,S,y;return{setters:[function(t){e=t.createForOfIteratorHelperLoose},function(t){i=t.cclegacy,n=t.js},function(t){r=t.RedPointMgr},function(t){o=t.default},function(t){a=t.default},null,function(t){s=t.BagEventDefine},function(t){u=t.BagModel},function(t){c=t.default},function(t){d=t.ChapterEventDefine},function(t){v=t.RoleDataCache},function(t){h=t.default},function(t){f=t.default},function(t){l=t.ActivityState,p=t.ActivityType,g=t.ActivityEventDefine},function(t){S=t.HorseCarnivalDataCache},function(t){y=t.ViewEvent}],execute:function(){i._RF.push({},"ba544UsUXlJXasgxsMtPr1s","ActivitySakuraDataCache",void 0);var I=t("default",function(){var t=i.prototype;function i(){this.sourceList=[],this.endList=[],this.routeComplete=[],this.routeList=[],this.gridInfo=[],this.curLevelId=1,this.openLevelList=[1],this.act_day=1,this.viewList=void 0,this.curOpen=0,this.otherViewNum=0,this.isDungeon=void 0,this.sendProList=[{type:p.SakuraFind,send:function(){IS(h).send_24_52(p.SakuraFind)},redCheck:function(){}}],normalEvent.on(g.OnActivityListUpdate,this.activityChange,this),normalEvent.on(g.OnActivityInfoUpdate,this.activityChange,this),normalEvent.on(s.GOODS_INFO_UPDATE,this.onBagUpdate,this),normalEvent.on(y.ViewOpen,this.onViewOpen,this),normalEvent.on(y.ViewClose,this.onViewClose,this),normalEvent.on(d.BATTLE_STATE,this.onBattleState,this),normalEvent.on(g.OnActivityFindUpdate,this.onActivityFindUpdate,this)}return t.clear=function(){},t.activityChange=function(t){void 0===t&&(t=null),this.checkPop();for(var e=0;e<this.sendProList.length;e++){var i=this.sendProList[e].type;if(!t||t.type==i){var n=IS(f).GetActivityInfo(i);n&&n.state==l.Open?this.sendProList[e].send():this.sendProList[e].redCheck&&this.sendProList[e].redCheck()}}},t.checkPop=function(){var t=IS(f).GetActivityInfo(p.Sakura);if(t&&t.state==l.Open){var e,i=a.ServerDate(1e3*a.serverTime),r=n.formatStr("#%s#%s#%s",i.getFullYear(),i.getMonth()+1,i.getDate()),s="ActivitySakuraPopView"+IS(v).GetRoleId();if((null!=(e=o.get(s))?e:"")==r)return;uiMgr.ViewIsAddPop("ActivitySakuraPopView")||(uiMgr.addPopView("ActivitySakuraPopView"),o.set(s,r))}},t.onBagUpdate=function(t,e){1913==e&&(IS(f).UpdateMainRedByActType(p.SakuraPass),IS(r).changeValue("sakura_pass",this.getPassRedNum()))},t.onViewOpen=function(t){if("ActivityFindIcon"!=t){var i=IS(f).GetActivityInfo(p.SakuraFind);if(i&&i.state==l.Open){if(!this.viewList){this.viewList={};for(var n,r=configMoonfestival_search.getDatas(),o=e(r);!(n=o()).done;){var a=n.value;a.type==i.type&&a.group_id==i.roundCfg.group_id&&(this.viewList[a.system_view]=a.id)}}var s=this.viewList[t];if(s&&s==IS(f).getCurFind(p.SakuraFind))this.curOpen=s,this.isDungeon||uiMgr.openView("ActivityFindIcon",s),this.otherViewNum=0;else if(0!=this.curOpen){var u=uiMgr.getOpenView("ActivityFindIcon");u&&u.close(),this.otherViewNum++}}}},t.onViewClose=function(t){if("ActivityFindIcon"!=t){var i=IS(f).GetActivityInfo(p.SakuraFind);if(i&&i.state==l.Open){if(!this.viewList){this.viewList={};for(var n,r=configMoonfestival_search.getDatas(),o=e(r);!(n=o()).done;){var a=n.value;a.type==i.type&&a.group_id==i.roundCfg.group_id&&(this.viewList[a.system_view]=a.id)}}var s=this.viewList[t];if(s&&s==IS(f).getCurFind(p.SakuraFind)){var u=uiMgr.getOpenView("ActivityFindIcon");u&&u.close(),this.curOpen=0,this.otherViewNum=0}else 0!=this.curOpen&&(this.otherViewNum--,0!=this.otherViewNum||this.isDungeon||uiMgr.openView("ActivityFindIcon",this.curOpen))}}},t.onBattleState=function(t,e){var i=IS(f).GetActivityInfo(p.SakuraFind);if(i&&i.state==l.Open)if(e){this.isDungeon=!0;var n=uiMgr.getOpenView("ActivityFindIcon");n&&n.close()}else this.isDungeon=!1,0!=this.curOpen&&0==this.otherViewNum&&uiMgr.openView("ActivityFindIcon",this.curOpen)},t.onActivityFindUpdate=function(t){if(t&&t.act_type==p.SakuraFind&&t.pig_id==this.curOpen){this.curOpen=0;var e=uiMgr.getOpenView("ActivityFindIcon");e&&e.close()}},t.getRedNum=function(){var t=0;t+=this.getPassRedNum(),t+=this.GetStoreRed(),t+=this.GetTurnRed(),t+=this.getFindRedNum();var e=IS(f).GetActivityInfo(p.SakuraGame);return e&&e.state==l.Open&&(t=t+IS(f).GetTaskRedNum(p.SakuraGame)+(1==parseInt(o.get("SakuraGame_NewLevel_"+IS(v).GetRoleId()))?1:0)),t},t.getFindRedNum=function(){var t=IS(f).GetActivityInfo(p.SakuraFind);if(!t||t.state!=l.Open)return 0;var e=IS(f).getFindInfo(p.SakuraFind);if(!e)return 0;var i=e.list;for(var n in i){if(i.hasOwnProperty(n))if(1==i[n])return 1}return 0==e.total_reward&&IS(f).isAllFind(p.SakuraFind)?1:0},t.getPassRedNum=function(){var t=IS(f).GetActivityInfo(p.SakuraPass);if(!t||t.state!=l.Open)return 0;var e=0,i=t.roundCfg.group_id;return e=(e=e+c.checkRewardRP(i)>=0?1:0)+c.checkAddRewardRP(i)>0?1:0,e+=c.checkSpecialRewardRP(i),IS(u).getGoodsCountByGoodsGtid(1913)>0&&e++,e},t.GetStoreRed=function(){var t=IS(f).GetActivityInfo(p.Sakura);if(!t||t.state!=l.Open)return 0;if(t){var e,i=String(t.id)+"#"+String(t.round),n="ActivitySakuraStoreRed"+IS(v).GetRoleId();return(null!=(e=o.get(n))?e:"")==i?0:1}return 0},t.GetTurnRed=function(){var t=IS(f).GetActivityInfo(p.SakuraTurn);if(!t||t.state!=l.Open)return 0;var e=0;return e+=IS(S).getRedNum(p.SakuraTurn)},t.CheckRouteComplete=function(){for(var t,i=e(this.sourceList);!(t=i()).done;){var n=t.value;if(0==this.routeComplete[n])return!1}return!0},t.ResetRouteComplete=function(){for(var t,i=e(this.sourceList);!(t=i()).done;){var n=t.value;this.routeComplete[n]=!1}},i}());t("Route",function(){function t(t,e){this.sourceId=void 0,this.routeTrace=[],this.round=void 0,this.routeId=void 0,this.routeColor=void 0,this.sourceId=t,this.routeId=IS(I).routeList.length,this.routeColor=e,this.round=0}var i=t.prototype;return i.addRoute=function(t,e,i){this.round=t,null==this.routeTrace[t]&&(this.routeTrace[t]=[]),this.routeTrace[t].push([e,i])},i.checkInRoute=function(t,i){for(var n,r=e(this.routeTrace);!(n=r()).done;)for(var o,a=n.value,s=e(a);!(o=s()).done;){var u=o.value;if(u[0]==t&&u[1]==i)return!0}return!1},t}());i._RF.pop()}}}));

