System.register("chunks:///_virtual/PlantMainView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AudioMgr.ts","./index3.ts","./RedPoint.ts","./RedPointMgr.ts","./NodeUtil.ts","./PlatformUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./ItemIcon.ts","./SpineSkeleton.ts","./ConfigGlobal.ts","./ObjectUtil.ts","./BagModel.ts","./MessageView.ts","./GainBuffDataCache.ts","./GainBuffDefine.ts","./RoleDataCache.ts","./RoleDefine.ts","./PlantControl.ts","./PlantDataCache.ts","./PlantDefine.ts","./PlantModel.ts","./PlantShopView.ts","./BaseView.ts","./EaseMethod.ts"],(function(t){"use strict";var i,e,n,o,a,d,s,h,r,l,u,c,f,m,p,g,I,T,v,C,S,y,_,E,R,L,F,B,w,O,x,b,G,M,A,P,z,N,D,U,V,k,K,H,X,q,j;return{setters:[function(t){i=t.inheritsLoose,e=t.createForOfIteratorHelperLoose},function(t){n=t.cclegacy,o=t.Button,a=t.Vec3,d=t.Widget,s=t.Sprite,h=t.Label,r=t.ProgressBar,l=t.UITransform,u=t.Vec2,c=t.sys,f=t.screen,m=t.js,p=t.Color,g=t.LabelOutline,I=t.Layout},function(t){T=t.audioMgr},null,function(t){v=t.RedPointType},function(t){C=t.RedPointMgr},function(t){S=t.default},function(t){y=t.PlatformUtil},function(t){_=t.default},function(t){E=t.default},null,function(t){R=t.IconAseetType},function(t){L=t.SpineSkeleton},function(t){F=t.ConfigGlobal},function(t){B=t.default},function(t){w=t.BagModel},function(t){O=t.default},function(t){x=t.GainBuffDataCache},function(t){b=t.GainBuffEventDefine,G=t.GainBuffType,M=t.GainBuff},function(t){A=t.RoleDataCache},function(t){P=t.PlayerAttr,z=t.RoleEventDefine,N=t.RoleRedPointSystemEnum},function(t){D=t.default},function(t){U=t.PlantDataCache},function(t){V=t.CropState,k=t.PlantEventDefine},function(t){K=t.PlantModel},function(t){H=t.EOpenType},function(t){X=t.ViewEvent,q=t.BaseView},function(t){j=t.EasingMethod}],execute:function(){var W,Z,Y,Q;n._RF.push({},"2630cjkSplOx61uWkWz2LNt","PlantMainView",void 0);var J=[1,2,3],$=F.farm_auto_level,tt=((W={})[V.GROWING]={pbImg:"zy_img_jindutiao_green",outline:"#0F5222"},W[V.COLLECTING]={pbImg:"zy_img_jindutiao_yellow",outline:"#c35c01"},W),it=((Z={})[6011]="baicai",Z[6012]="qiezi",Z[6013]="hulu",Z),et=((Y={})[6011]=999000496,Y[6012]=999000494,Y[6013]=999000495,Y),nt=((Q={})[P.ROLE_SEED_GET]="LV1",Q[P.ROLE_SEED_BUY]="LV2",Q[P.ROLE_SEED_RARE]="LV3",Q);t("default",function(t){function n(){var i;return(i=t.call(this)||this).nodeTopBg=void 0,i.nodeLevelRoot=void 0,i.txtNutrientsCount=void 0,i.pbExp=void 0,i.txtExp=void 0,i.txtLevel=void 0,i.txtBuildingPointCount=void 0,i.txtFertilizerBuyCount=void 0,i.txtFertilizerRecoverCount=void 0,i.txtFertilizerRecoverTime=void 0,i.txtOtherFertilizerCount=void 0,i.nodeBtnFertilizerBuy=void 0,i.nodeBtnFertilizerRecover=void 0,i.nodeBtnFertilizerOther=void 0,i.txtSeedBuyCount=void 0,i.txtSeedRecoverCount=void 0,i.txtSeedRareCount=void 0,i.nodeBtnSeedBuy=void 0,i.nodeBtnSeedRecover=void 0,i.nodeBtnSeedRare=void 0,i.nodeContent=void 0,i.nodeTop=void 0,i.nodeBuildingPoint=void 0,i.nodeName=void 0,i.txtName=void 0,i.nodeLandRoot=void 0,i.nodeThiefItem=void 0,i.nodeBtnTip=void 0,i.nodeTip=void 0,i.nodeFlyRoot=void 0,i.nodeFlyItem=void 0,i.utFlyRoot=void 0,i.landIdToThief=void 0,i.buildingIdToItem=void 0,i.landIdToItem=void 0,i.nodeNutrients=void 0,i.txtTip=void 0,i.nodeIsStealing=void 0,i.txtStealingTime=void 0,i.imgStealingTime=void 0,i.nodeBtnClose=void 0,i.nodeBtnBack=void 0,i.landIdToFlyItems=void 0,i.lastUpdateTime=0,i.visitRoleId=0,i.isOther=!1,i.otherFarmInfo=void 0,i.nextRecoverTime=0,i.time=void 0,i.hasReq=!1,i.stealingStartTime=void 0,i.stealEndTime=void 0,i.curOpenView=void 0,i.openTypeItems=void 0,i.nodeSubRoot=void 0,i.landIdToCollectingSoundTimer=void 0,i.lastPlayMusic="home_mix2",i.watingShowFerDic={},i.waitingDeadEffTheif={},i.waitingShowEffThief={},i.curSpeThiefItem=void 0,i.nodeSpecialBuff=void 0,i.nodeBuff=void 0,i.updatebufftime=void 0,i.utTip=void 0,i.utTipBg=void 0,i.curBuildingSpriteName=void 0,i.speStartTime=void 0,i.speEndTime=void 0,i.nodeBtnOneKeyPick=void 0,i.nodeBtnOneKeyFetch=void 0,i.nodeBtnOneKeyPlant=void 0,i.nodeBtnOneKeyGrow=void 0,i.name="PlantMainView",i.url="ui/module/plant/PlantMainView",i.fullScreen=!0,i}i(n,t);var F=n.prototype;return F.onInit=function(){var t,i=this,e=this.findChild("top/btnGuide");this.addComponentCallbackListener(e,o.EventType.CLICK,(function(){uiMgr.openView("CommonGuideView",2)})),this.curOpenView=null,this.time=0,this.landIdToCollectingSoundTimer={},this.nodeBtnClose=this.findChild("bottom/btnClose"),this.addComponentCallbackListener(this.nodeBtnClose,o.EventType.CLICK,(function(){uiMgr.close("FarmFriendView"),uiMgr.close("PlantLogView"),uiMgr.close("PlantStealView"),uiMgr.close("PlantShopView"),i.close()})),this.nodeBtnBack=this.findChild("bottom/btnBack"),this.addComponentCallbackListener(this.nodeBtnBack,o.EventType.CLICK,(function(){i.watingShowFerDic={},i.waitingShowEffThief={},i.waitingDeadEffTheif={},i.nodeContent.position=new a(-360,1476.873,0),i.visitRoleId=0,i.isOther=!1,i.otherFarmInfo=null,i.clearThiefItem(),i.updateFarmInfo(),i.trySetMusic(),i.onGainBuffUpdate()}));var n=this.findChild("bottom/btnShop");this.addComponentCallbackListener(n,o.EventType.CLICK,(function(){if(i.curOpenView){if("PlantShopView"==i.curOpenView)return void uiMgr.close("PlantShopView");uiMgr.close(i.curOpenView)}uiMgr.openView("PlantShopView",H.Seed)})),this.nodeNutrients=this.findChild("top/btnNutrientsRoot"),this.addComponentCallbackListener(this.nodeNutrients,o.EventType.CLICK,(function(){IS(w).OpenItemTips(P.ROLE_NUTRIENTS,i.nodeNutrients)})),this.nodeTop=this.findChild("top"),this.nodeTop.getComponent(d).scheduleOnce((function(){i.setTopPos()}),0);var f=this.findChildComponent("top/btnNutrientsRoot/imgCoin",s),m=configGoods.getDataByKey(P.ROLE_NUTRIENTS);this.loadIcon(f,m.icon_group,m.icon),this.txtNutrientsCount=this.findChildComponent("top/btnNutrientsRoot/txtCoin",h),this.addComponentCallbackListener(this.nodeNutrients,o.EventType.CLICK,(function(){IS(w).OpenItemTips(P.ROLE_NUTRIENTS,i.txtNutrientsCount.node)})),this.nodeTopBg=this.findChild("top/imgBg"),this.nodeBuildingPoint=this.findChild("top/btnBuildingPoint"),this.addComponentCallbackListener(this.nodeBuildingPoint,o.EventType.CLICK,(function(){IS(w).OpenItemTips(P.ROLE_BUILDING_POINT,i.nodeBuildingPoint)})),this.nodeLevelRoot=this.findChild("top/levelRoot"),this.pbExp=this.findChildComponent("top/levelRoot/pbNum",r),this.txtExp=this.findChildComponent("top/levelRoot/txtNum",h),this.txtLevel=this.findChildComponent("top/levelRoot/txtLevel",h),this.nodeBtnTip=this.findChild("top/levelRoot/btnTip"),this.nodeTip=this.findChild("top/tips");var p=this.findChild("top/tips/mask");this.nodeTip.active=!1,this.addComponentCallbackListener(this.nodeBtnTip,o.EventType.CLICK,(function(){i.nodeTip.active=!i.nodeTip.active})),this.addComponentCallbackListener(p,o.EventType.CLICK,(function(){i.nodeTip.active=!1})),this.txtTip=this.findChildComponent("top/tips/txt",h),this.utTip=this.txtTip.node.getComponent(l),this.utTipBg=this.findChildComponent("top/tips",l),this.txtBuildingPointCount=this.findChildComponent("top/btnBuildingPoint/txtCoin",h),this.addComponentCallbackListener(this.nodeBuildingPoint,o.EventType.CLICK,(function(){IS(w).OpenItemTips(P.ROLE_BUILDING_POINT,i.txtBuildingPointCount.node)})),this.nodeBtnFertilizerBuy=this.findChild("top/btnFertilizerBuy"),this.addComponentCallbackListener(this.nodeBtnFertilizerBuy,o.EventType.CLICK,(function(){uiMgr.openView("PlantShopView",H.Seed)}));var g=this.findChildComponent("top/btnFertilizerBuy/imgCoin",s),I=configGoods.getDataByKey(P.ROLE_FERTILIZER_BUY);this.loadIcon(g,I.icon_group,I.icon),this.txtFertilizerBuyCount=this.findChildComponent("top/btnFertilizerBuy/txtCoin",h),this.nodeBtnFertilizerRecover=this.findChild("top/btnFertilizerGet"),this.addComponentCallbackListener(this.nodeBtnFertilizerRecover,o.EventType.CLICK,(function(){IS(w).OpenItemTips(P.ROLE_FERTILIZER_GET,i.nodeBtnFertilizerRecover)}));var T=this.findChildComponent("top/btnFertilizerGet/imgCoin",s),C=configGoods.getDataByKey(P.ROLE_FERTILIZER_GET);this.loadIcon(T,C.icon_group,C.icon),this.txtFertilizerRecoverCount=this.findChildComponent("top/btnFertilizerGet/txtCoin",h),this.txtFertilizerRecoverTime=this.findChildComponent("top/btnFertilizerGet/txtTime",h),this.addComponentCallbackListener(this.nodeBtnFertilizerRecover,o.EventType.CLICK,(function(){IS(w).OpenItemTips(P.ROLE_FERTILIZER_GET,i.txtFertilizerRecoverCount.node)})),this.nodeBtnFertilizerOther=this.findChild("top/btnFertilizerOther"),this.addComponentCallbackListener(this.nodeBtnFertilizerOther,o.EventType.CLICK,(function(){IS(w).OpenItemTips(P.ROLE_FERTILIZER_HELP,i.nodeBtnFertilizerOther)}));var y=this.findChildComponent("top/btnFertilizerOther/imgCoin",s),_=configGoods.getDataByKey(P.ROLE_FERTILIZER_HELP);this.loadIcon(y,_.icon_group,_.icon),this.txtOtherFertilizerCount=this.findChildComponent("top/btnFertilizerOther/txtCoin",h),this.nodeBtnSeedBuy=this.findChild("top/btnSeedBuy"),this.addComponentCallbackListener(this.nodeBtnSeedBuy,o.EventType.CLICK,(function(){uiMgr.openView("PlantShopView",H.Seed)}));var R=this.findChildComponent("top/btnSeedBuy/imgCoin",s),L=configGoods.getDataByKey(P.ROLE_SEED_BUY);this.loadIcon(R,L.icon_group,L.icon),this.txtSeedBuyCount=this.findChildComponent("top/btnSeedBuy/txtCoin",h),this.nodeBtnSeedRecover=this.findChild("top/btnSeedGet"),this.addComponentCallbackListener(this.nodeBtnSeedRecover,o.EventType.CLICK,(function(){IS(w).OpenItemTips(P.ROLE_SEED_GET,i.nodeBtnSeedRecover)}));var F=this.findChildComponent("top/btnSeedGet/imgCoin",s),B=configGoods.getDataByKey(P.ROLE_SEED_GET);this.loadIcon(F,B.icon_group,B.icon),this.txtSeedRecoverCount=this.findChildComponent("top/btnSeedGet/txtCoin",h),this.nodeBtnSeedRare=this.findChild("top/btnSeedRare"),this.addComponentCallbackListener(this.nodeBtnSeedRare,o.EventType.CLICK,(function(){IS(w).OpenItemTips(P.ROLE_SEED_RARE,i.nodeBtnSeedRare)}));var O=this.findChildComponent("top/btnSeedRare/imgCoin",s),x=configGoods.getDataByKey(P.ROLE_SEED_RARE);this.loadIcon(O,x.icon_group,x.icon),this.txtSeedRareCount=this.findChildComponent("top/btnSeedRare/txtCoin",h),this.initBuildingItems(),this.initLandItems();var b=this.findChild("bottom/btnFriend");this.addComponentCallbackListener(b,o.EventType.CLICK,(function(){if(i.curOpenView){if("FarmFriendView"==i.curOpenView)return void uiMgr.close("FarmFriendView");uiMgr.close(i.curOpenView)}uiMgr.openView("FarmFriendView")}));var G=this.findChild("bottom/btnReport");this.addComponentCallbackListener(G,o.EventType.CLICK,(function(){if(i.curOpenView){if("PlantLogView"==i.curOpenView)return void uiMgr.close("PlantLogView");uiMgr.close(i.curOpenView)}uiMgr.openView("PlantLogView",0,i.openArgs[0])})),this.addRedPoint("PlantMainView/btnReport",G,new u(20,25),v.Dot);var M=this.findChild("bottom/btnSteal");this.addComponentCallbackListener(M,o.EventType.CLICK,(function(){if(i.curOpenView){if("PlantStealView"==i.curOpenView)return void uiMgr.close("PlantStealView");uiMgr.close(i.curOpenView)}uiMgr.openView("PlantStealView")})),this.nodeContent=this.findChild("scrollMiddleShow/view/content"),this.nodeLandRoot=this.findChild("scrollMiddleShow/view/content/landRoot"),this.nodeThiefItem=this.findChild("scrollMiddleShow/view/content/landRoot/thiefItem"),this.nodeThiefItem.active=!1,this.nodeFlyRoot=this.findChild("flyRoot"),this.utFlyRoot=this.nodeFlyRoot.getComponent(l),this.nodeFlyItem=this.findChild("flyRoot/flyItem"),this.nodeFlyItem.active=!1,this.nodeName=this.findChild("top/nameRoot"),this.txtName=this.findChildComponent("top/nameRoot/txtName",h),this.nodeIsStealing=this.findChild("bottom/btnSteal/normal/steal"),this.txtStealingTime=this.findChildComponent("bottom/btnSteal/normal/steal/txtTime",h),this.imgStealingTime=this.findChildComponent("bottom/btnSteal/normal/steal/imgTime",s),this.nodeSpecialBuff=this.findChild("top/SpecialBuff"),this.openTypeItems=((t={}).PlantLogView={normal:S.findChild(G,"normal"),selected:S.findChild(G,"selected")},t.FarmFriendView={normal:S.findChild(b,"normal"),selected:S.findChild(b,"selected")},t.PlantStealView={normal:S.findChild(M,"normal"),selected:S.findChild(M,"selected")},t.PlantShopView={normal:S.findChild(n,"normal"),selected:S.findChild(n,"selected")},t),this.nodeSubRoot=this.findChild("container"),this.landIdToThief={},this.findChildComponent("scrollMiddleShow",d).scheduleOnce((function(){i.nodeContent.position=new a(-360,1476.873,0)}),0),this.speStartTime=E.getLocalTimeToUTC8(2024,6,21,0,0,0),this.speEndTime=E.getLocalTimeToUTC8(2024,7,18,23,59,59),this.loadIcon(this.findChildComponent("bottom/btnReport/normal/icon",s),"farm_main","zy_icon_rizhi"),this.loadIcon(this.findChildComponent("bottom/btnFriend/normal/icon",s),"main","gongneng_ICON_haoyou"),this.loadIcon(this.findChildComponent("bottom/btnSteal/normal/icon",s),"farm_main","zy_icon_toucai"),this.loadIcon(this.findChildComponent("bottom/btnShop/normal/icon",s),"farm_main","zy_icon_shangdian"),this.loadIcon(this.findChildComponent("bottom/btnClose/Sprite",s),"common","common_ICON_tuichuanniu"),this.loadIcon(this.findChildComponent("bottom/btnBack",s),"farm","zy_icon_rukou"),c.uiMirror&&this.findChild("bottom/btnBack/txtName").setScale(1,1,1),this.nodeBtnOneKeyPick=this.findChild("OneKeyOprate/btnOneKeyPick"),this.addComponentCallbackListener(this.nodeBtnOneKeyPick,o.EventType.CLICK,(function(){i.tryOneKeyOprate("pick")})),this.nodeBtnOneKeyFetch=this.findChild("OneKeyOprate/btnOneKeyFetch"),this.addComponentCallbackListener(this.nodeBtnOneKeyFetch,o.EventType.CLICK,(function(){i.tryOneKeyOprate("fetch")})),this.nodeBtnOneKeyPlant=this.findChild("OneKeyOprate/btnOneKeyPlant"),this.addComponentCallbackListener(this.nodeBtnOneKeyPlant,o.EventType.CLICK,(function(){i.tryOneKeyOprate("plant")})),this.nodeBtnOneKeyGrow=this.findChild("OneKeyOprate/btnOneKeyGrow"),this.addComponentCallbackListener(this.nodeBtnOneKeyGrow,o.EventType.CLICK,(function(){i.tryOneKeyOprate("grow")}))},F.setTopPos=function(){if(!GlobalDefine.IPAD){var t=this.nodeTop,i=720/f.windowSize.width*f.windowSize.height,e=y.getMeunButtonTopDelta()*i,n=new a(0,i-e,0),o=t.parent.getComponent(l).convertToNodeSpaceAR(n),d=t.getPosition();t.setPosition(new a(d.x,o.y,d.z))}},F.initBuildingItems=function(){var t=this;this.buildingIdToItem={};for(var i=function(i){var e=t.findChild(m.formatStr("scrollMiddleShow/view/content/buildingRoot/building%s",i+1)),n=J[i];t.addComponentCallbackListener(e,o.EventType.CLICK,(function(){t.onClickBuilding(n)})),t.buildingIdToItem[n]={node:e,txtLevel:S.findChildComponent(e,"txtBuildingLevel",h),nodeUpgrade:S.findChild(e,"upgrade"),txtTime:S.findChildComponent(e,"upgrade/txtTime",h),buildingId:n,pbTime:S.findChildComponent(e,"upgrade/pbTime",r),nodeCanUpgrade:S.findChild(e,"imgFlag"),imgBuilding:S.findChildComponent(e,"imgBuilding",s)}},e=0;e<J.length;e++)i(e);this.setBuilding1Sprite()},F.setBuilding1Sprite=function(){if(this.speStartTime){var t=E.serverTime;t>=this.speStartTime&&t<=this.speEndTime&&(this.loadIcon(this.buildingIdToItem[1].imgBuilding,"farm_main","zy_icon_xiaohuangyadcr"),this.loadIcon(this.buildingIdToItem[2].imgBuilding,"farm_main","zy_icon_xiaohuangyaccj"))}},F.initLandItems=function(){var t=this,i=configFarm_pos.getDatas();this.landIdToItem={};for(var e=function(e){var n=t.findChild(m.formatStr("scrollMiddleShow/view/content/landRoot/land%s",e+1)),a=i[e].id;t.addComponentCallbackListener(n,o.EventType.CLICK,(function(){t.onClickLand(a)})),t.landIdToItem[a]={node:n,imgLand:S.findChildComponent(n,"imgLand",s),imgLock:S.findChildComponent(n,"imgLock",s),nodeTime:S.findChild(n,"time"),txtTimeState:S.findChildComponent(n,"time/txtState/txtState",h),spineTimeState:S.findChildComponent(n,"time/txtState/MX_tx_zhuangyuan_daojishi",L),txtTimeStateOutline:S.findChildComponent(n,"time/txtState/txtState",g),pbTime:S.findChildComponent(n,"time/pbTime",r),imgPbTime:S.findChildComponent(n,"time/pbTime/Bar",s),txtTime:S.findChildComponent(n,"time/txtTime",h),nodeTimeCollect:S.findChild(n,"time/MX_tx_zhuangyuan_caizhai"),nodeTimeGrow:S.findChild(n,"time/MX_tx_zhuangyuan_shalou"),nodeTimeNormal:S.findChild(n,"time/imgTime"),nodeAction:S.findChild(n,"action"),imgAction:S.findChildComponent(n,"action/imgAction",s),txtAction:S.findChildComponent(n,"action/txtAction",h),spineSeed:S.findChildComponent(n,"MX_tx_zhuangyuan_shengzhang",L),spineGrow:S.findChildComponent(n,"MX_tx_zhuangyuan_kaihua",L),spineMature:S.findChildComponent(n,"MX_tx_zhuangyuan_jieguo",L),landId:a},t.dealMirrorLayout(S.findChildComponent(n,"time/txtState",I))},n=0;n<i.length;n++)e(n)},F.registerUpdateHandler=function(){this.addEvent(k.ROLE_LAND_INFO_UPDATE,this.onRoleLandUpdate,this),this.addEvent(k.ROLE_HOME_FARM_INFO_BACK,this.onRoleHomeInfoBack,this),this.addEvent(k.FARM_LAND_HARVEST_FINISH,this.onFarmLandHarvestFinish,this),this.addEvent(k.FARM_BUILDING_UPDATE,this.onFarmBuildingUpdate,this),this.addEvent(k.HOME_FARM_INFO_INIT,this.onHomeFarmInfoInit,this),this.addEvent(z.ROLE_RES_UPDATE,this.onRoleResUpdate,this),this.addEvent(k.FARM_FORCE_CHANGE,this.onFarmForceChange,this),this.addEvent(z.ROLE_GOODS_REFRESH_UPDATE,this.onRoleGoodsRefreshUpdate,this),this.addEvent(k.FARM_STOLEN_INFO_UPDATE,this.onFarmStolenInfoUpdate,this),this.addEvent(z.ROLE_RED_POINT_LIST_UPDATE,this.updateRedPoint,this),this.addEvent(z.ROLE_RED_DETAIL_UPDATE,this.onRoleRedDetailUpdate,this),this.addEvent(k.FARM_BUILDING_UPGRADE_FINISH,this.onFarmBuildingUpgradeFinish,this),this.addEvent(X.ViewOpen,this.onViewOpen,this),this.addEvent(X.ViewClose,this.onViewClose,this),this.addEvent(k.FARM_FERTILIZE_PLANT_ACTION,this.onFarmFertilizePlantAction,this),this.addEvent(k.FARM_BATTLE_REQ_FAIL,this.onFarmBattleReqFail,this),this.addEvent(k.FARM_SEED_PLANT_ACTION,this.onFarmSeedPlantAction,this),this.addEvent(k.FARM_LAND_UNLOCK_ACTION,this.onFarmLandUnlockAction,this),this.addEvent(b.GAINBUFF_INFO_UPDATE,this.onGainBuffUpdate,this)},F.onAfterOpen=function(){this.setBuilding1Sprite(),this.clearSpeItem(),this.watingShowFerDic={},this.waitingShowEffThief={},this.waitingDeadEffTheif={},this.curOpenView=null,this.time=0,this.nodeContent.position=new a(-360,1476.873,0);var t=this.openArgs[0],i=this.openArgs[1]||!1;B.isEmpty(t)||(this.otherFarmInfo=t,this.isOther=!0,this.visitRoleId=t.role_id),this.trySetMusic(),this.tryPlayWatingDeadThief(),this.clearThiefItem(),this.updateFarmInfo(),this.updateRedPoint(),this.updateSelect(),this.onGainBuffUpdate(),this.isOther&&(this.nodeSpecialBuff.active=!1),i&&this.isOther&&IS(D).reqFarmInfo(this.visitRoleId)},F.onGainBuffUpdate=function(){var t={},i=IS(x).gain_buff_info[G.FarmBuff];if(i){this.nodeSpecialBuff.active=!0;for(var n,o=e(i);!(n=o()).done;){var a=n.value;t[a.k]=a.v}this.nodeBuff=new M(this.nodeSpecialBuff,this,G.FarmBuff);var d=configSpecil_buff.getDataByKey(G.FarmBuff);if(this.loadIcon(this.nodeBuff.icon,"icon_buff",d.state_icon),d.time>0){if(this.nodeBuff.nodeTime.active=!0,this.updatebufftime=t[2]-E.serverTime,this.updatebufftime<=0)return void(this.nodeSpecialBuff.active=!1);this.nodeBuff.txtTime.string=E.formatTimeForSecond(t[2]-E.serverTime)}else this.nodeBuff.nodeTime.active=!1;if(d.quantity>0){if(t[1]<=0)return void(this.nodeSpecialBuff.active=!1);this.nodeBuff.txtNum.node.active=!0,this.nodeBuff.txtNum.string=t[1]+"/"+d.quantity}else this.nodeBuff.txtNum.node.active=!1}else this.nodeSpecialBuff.active=!1},F.tryPlayWatingDeadThief=function(){var t=this;if(IS(U).waitShowDeafeatThiefLand){var i=IS(U).waitShowDeafeatThiefLand;this.waitingDeadEffTheif[i]=!0;var e=nodeInstantiate.instantiate(this.nodeThiefItem);e.parent=this.nodeLandRoot;var n=this.landIdToItem[i].node.position;e.position=new a(n.x+120,n.y+120,0),e.active=!0,this.curSpeThiefItem={node:e,nodeTime:S.findChild(e,"steal"),txtTime:S.findChildComponent(e,"steal/txtTime",h),imgTime:S.findChildComponent(e,"steal/imgTime",s),spine:S.findChildComponent(e,"MX_tx_zhuangyuan_xiaotou",L)},this.curSpeThiefItem.nodeTime.active=!1,this.curSpeThiefItem.spine.setAnimation(0,"dead",!1),this.addTimer(2,1,(function(){t.curSpeThiefItem.node.destroy(),t.curSpeThiefItem=null,t.waitingDeadEffTheif[i]=!1,t.waitingShowEffThief[i]&&t.tryShowLandThief(i)})),IS(U).waitShowDeafeatThiefLand=null}},F.trySetMusic=function(){var t=this.getPlayMusic();t!=this.lastPlayMusic&&(T.playMusic(t),this.lastPlayMusic=t)},F.getPlayMusic=function(){if(!this.isOther)return"home_mix2";if(IS(K).checkHasNotStealing())return"home_mix2";for(var t=IS(K).getStealingList(),i=0;i<t.length;i++)if(t[i].id==this.visitRoleId)return"zhuangyuan_toucai";return"home_mix2"},F.updateSelect=function(){for(var t in this.openTypeItems){var i=this.openTypeItems[t];i.normal.active=null==this.curOpenView||t!=this.curOpenView,i.selected.active=this.curOpenView&&t==this.curOpenView}},F.updateRedPoint=function(){IS(C).changeValue("PlantMainView/btnReport",IS(A).getRedNumByModule(N.System_Farm,1)+IS(A).getRedNumByModule(N.System_Farm,2))},F.updateFarmInfo=function(){this.updateFarmLevelInfo(),this.updateNutrientsCount(),this.updateBuildingPointCount(),this.nodeBtnFertilizerBuy.active=!this.isOther,this.nodeBtnFertilizerRecover.active=!this.isOther,this.nodeBtnFertilizerOther.active=this.isOther,this.nodeLevelRoot.active=!this.isOther,this.nodeBtnSeedBuy.active=!this.isOther,this.nodeBtnSeedRecover.active=!this.isOther,this.nodeBtnSeedRare.active=!this.isOther,this.nodeBuildingPoint.active=!this.isOther,this.nodeTopBg.active=!this.isOther,this.nodeBtnClose.active=!this.isOther,this.nodeBtnBack.active=this.isOther,this.nodeNutrients.position=this.isOther?new a(-95.782,-110.009,0):new a(58.352,-166.235,0),this.nodeName.active=this.isOther,this.isOther&&(this.txtName.string=_.formatStrWithMirrorDeal(GetLanguage(200511),this.otherFarmInfo.name)),this.updateFertilizerBuyCount(),this.updateFertilizerRecoverCount(),this.updateFertilizerHelpCount(),this.updateSeedBuyCount(),this.updateSeedRecoverCount(),this.updateSeedRareCount(),this.updateBuildingItems(),this.updateLandItems(),this.updateStealing(),this.tryUpdateOneKeyOprateShow()},F.tryUpdateOneKeyOprateShow=function(){this.nodeBtnOneKeyPick.active=!this.isOther&&IS(K).getFarmLevel()>=$&&IS(K).getMeetConditionLand("pick").length>0,this.nodeBtnOneKeyFetch.active=!this.isOther&&IS(K).getFarmLevel()>=$&&IS(K).getMeetConditionLand("fetch").length>0,this.nodeBtnOneKeyPlant.active=!this.isOther&&IS(K).getFarmLevel()>=$&&IS(K).getMeetConditionLand("plant").length>0,this.nodeBtnOneKeyGrow.active=!this.isOther&&IS(K).getFarmLevel()>=$&&IS(K).getMeetConditionLand("grow").length>0},F.updateFarmLevelInfo=function(){var t=this,i=IS(K).getFarmLevel();this.txtLevel.string=String(i);var e=IS(K).getFarmExp(),n=configFarm_level.getDataByKey(i),o=configFarm_level.getDataByKey(i+1),a=B.isEmpty(o),d=configFarm_level.getDataByKey(i-1),s=null==d?0:d.expend,h=a?n.expend-s:o.expend-n.expend,r=e-n.expend;this.txtExp.string=m.formatStr("%s/%s",r,h),this.pbExp.progress=a?1:Math.min(1,r/h),this.nodeBtnTip.active=!a,a&&(this.nodeTip.active=!1),a||(this.txtTip.string=_.formatStrWithMirrorDeal(GetLanguage(200512),o.effect[0][1]),this.txtTip.schedule((function(){var i=t.utTip.height;t.utTipBg.height=78.8+i})))},F.updateNutrientsCount=function(){this.txtNutrientsCount.string=IS(w).getGoodsCountByGoodsGtid(P.ROLE_NUTRIENTS)},F.updateBuildingPointCount=function(){this.txtBuildingPointCount.string=IS(w).getGoodsCountByGoodsGtid(P.ROLE_BUILDING_POINT)},F.updateFertilizerBuyCount=function(){this.txtFertilizerBuyCount.string=IS(w).getGoodsCountByGoodsGtid(P.ROLE_FERTILIZER_BUY)},F.updateFertilizerRecoverCount=function(){var t=IS(A).getGoodsFrfreshInfo(P.ROLE_FERTILIZER_GET),i=B.isEmpty(t)?0:t.max_num;this.txtFertilizerRecoverTime.node.active=!B.isEmpty(t)&&t.next_time>0,this.nextRecoverTime=B.isEmpty(t)?0:t.next_time,this.txtFertilizerRecoverCount.string=m.formatStr("%s/%s",IS(w).getGoodsCountByGoodsGtid(P.ROLE_FERTILIZER_GET),i),this.updateFertilizerRecoverTime()},F.updateFertilizerHelpCount=function(){var t=IS(A).getGoodsFrfreshInfo(P.ROLE_FERTILIZER_HELP),i=B.isEmpty(t)?0:t.max_num;this.txtOtherFertilizerCount.string=m.formatStr("%s/%s",IS(w).getGoodsCountByGoodsGtid(P.ROLE_FERTILIZER_HELP),i)},F.updateSeedBuyCount=function(){this.txtSeedBuyCount.string=IS(w).getGoodsCountByGoodsGtid(P.ROLE_SEED_BUY)},F.updateSeedRecoverCount=function(){var t=IS(A).getGoodsFrfreshInfo(P.ROLE_SEED_GET),i=B.isEmpty(t)?0:t.max_num;this.txtSeedRecoverCount.string=m.formatStr("%s/%s",IS(w).getGoodsCountByGoodsGtid(P.ROLE_SEED_GET),i)},F.updateSeedRareCount=function(){this.txtSeedRareCount.string=IS(w).getGoodsCountByGoodsGtid(P.ROLE_SEED_RARE)},F.updateBuildingItems=function(){for(var t in this.buildingIdToItem)this.updateBuildingById(Number(t))},F.updateLandItems=function(){for(var t in this.landIdToItem)this.updateLandById(Number(t))},F.updateBuildingById=function(t){this.buildingIdToItem[t].nodeCanUpgrade.active=!this.isOther&&IS(U).checkBuildingCanUpgrade(t);var i=this.isOther?this.otherFarmInfo.buildingIdToinfo[t]:IS(K).getBuildingInfoById(t);this.buildingIdToItem[t].txtLevel.string=m.formatStr("Lv.%s",B.isEmpty(i)?0:i.level),i.end_time>0?this.tryAddBuildingUpgradingEffect(t):this.tryRemoveBuildingUpgradingEffect(t),this.updateBuildingUpgradeTime(t)},F.tryAddBuildingUpgradingEffect=function(t){var i=this.buildingIdToItem[t];i.effectUpgrading||(i.effectUpgrading=this.addUIEffect("prefab/ui-effect/MX_tx_zhuangyuan_jianzao",i.node,-1))},F.tryRemoveBuildingUpgradingEffect=function(t){var i=this.buildingIdToItem[t];i.effectUpgrading&&(this.removeUIEffect(i.effectUpgrading),i.effectUpgrading=null)},F.updateLandById=function(t){if(this.updateLandTime(t),this.tryUpdateOneKeyOprateShow(),!this.watingShowFerDic[t]){var i=this.isOther?this.otherFarmInfo.landIdToInfo[t]:IS(K).getLandInfoById(t),e=this.landIdToItem[t];if(B.isEmpty(i))return e.nodeTime.active=!1,e.imgLock.node.active=!0,e.nodeAction.active=!1,this.setSpineActive(e.spineSeed,e.opacitySeed,!1),this.setSpineActive(e.spineGrow,e.opacityGrow,!1),this.setSpineActive(e.spineMature,e.opacityMature,!1),void this.loadIcon(e.imgLand,"farm_main","zy_img_tiandi02");this.loadIcon(e.imgLand,"farm_main","zy_img_tiandi"),e.imgLock.node.active=!1,e.txtAction.node.active=!1,e.imgAction.node.setPosition(0,e.imgAction.node.position.y,e.imgAction.node.position.z);var n=i.crop;if(B.isEmpty(n))return e.nodeTime.active=!1,e.nodeAction.active=!this.isOther,this.setSpineActive(e.spineSeed,e.opacitySeed,!1),this.setSpineActive(e.spineGrow,e.opacityGrow,!1),this.setSpineActive(e.spineMature,e.opacityMature,!1),this.loadIcon(e.imgAction,"farm","zy_icon_kezhongzhi"),void this.clearLandCollectingTimerByLandId(t);var o=e.state||V.NOT_EXIT,a=n.state;if(o==V.STEALING&&a!=V.STEALING){var d,s=n.robber_list||[];if(e.oriRobberId)for(var h=0;h<s.length;h++){if(s[h].k==e.oriRobberId){d=1==s[h].v?"win":"dead";break}}this.clearLandThief(t,d)}o!=V.STEALING&&a==V.STEALING&&this.tryShowLandThief(t);var r=IS(K).getCropShowByInfo(n);switch(a){case V.GROWING:e.nodeTime.active=!0,e.nodeTimeCollect.active=!1,e.nodeTimeNormal.active=!1,e.nodeTimeGrow.active=!0,e.txtTimeState.string=r.step<=0?GetLanguage(200513):GetLanguage(200514),e.spineTimeState.setAnimation(0,"chixu_lv",!0);var l=new p;p.fromHEX(l,tt[a].outline),e.txtTimeStateOutline.color=l,this.loadIcon(e.imgPbTime,"farm",tt[a].pbImg,null,R.UI_ATLAS,!0),e.nodeAction.active=!1;break;case V.MATURE:e.nodeTime.active=!1,e.nodeAction.active=!this.isOther||this.checkCropCanSteal(n),this.loadIcon(e.imgAction,"farm",this.isOther?"zy_icon_zhaicai":"zy_icon_shouhuo");break;case V.COLLECTING:e.nodeTime.active=!0,e.nodeTimeCollect.active=!0,e.nodeTimeNormal.active=!0,e.nodeTimeGrow.active=!1,e.txtTimeState.string=GetLanguage(200515),e.spineTimeState.setAnimation(0,"chixu_huang",!0);var u=new p;p.fromHEX(u,tt[a].outline),e.txtTimeStateOutline.color=u,this.loadIcon(e.imgPbTime,"farm",tt[a].pbImg,null,R.UI_ATLAS,!0),e.nodeAction.active=!1;break;case V.STEALING:e.nodeTime.active=!1,e.txtTimeState.string=GetLanguage(200516),e.nodeAction.active=!1,e.oriRobberId=n.robber.id;break;case V.WAIT_FETCH:e.nodeTime.active=!1,e.nodeAction.active=!this.isOther,this.loadIcon(e.imgAction,"farm","zy_icon_guoshu"),e.imgAction.node.setPosition(-30,e.imgAction.node.position.y,e.imgAction.node.position.z),e.txtAction.node.active=!0;var c=configGoods.getDataByKey(n.cfg_id).effect[1];e.txtAction.string=m.formatStr("x%s",c*n.real_fruit_count)}if(a==V.COLLECTING?this.tryStartCollectingTimerByLandId(t):this.clearLandCollectingTimerByLandId(t),a==V.WAIT_FETCH)this.setSpineActive(e.spineSeed,e.opacitySeed,!1),this.setSpineActive(e.spineGrow,e.opacityGrow,!1),this.setSpineActive(e.spineMature,e.opacityMature,!1);else if(a>V.GROWING){this.setSpineActive(e.spineSeed,e.opacitySeed,!1),this.setSpineActive(e.spineGrow,e.opacityGrow,!1),this.setSpineActive(e.spineMature,e.opacityMature,!0);var f=it[n.cfg_id];o==V.GROWING?(T.playSound("zhuangyuan_shengzhang"),e.spineMature.setAnimation(0,m.formatStr("MX_tx_%s_kaihua_jieguo",f),!1),e.spineMature.addAnimation(0,m.formatStr("MX_tx_%s_kaihua_chixu",f),!0)):e.spineMature.setAnimation(0,m.formatStr("MX_tx_%s_kaihua_chixu",f),!0)}else{this.setSpineActive(e.spineMature,e.opacityMature,!1);var g=nt[n.seed_id],I=it[n.cfg_id];null!=r&&r.cropShow?2==r.step?(this.setSpineActive(e.spineSeed,e.opacitySeed,!1),this.setSpineActive(e.spineGrow,e.opacityGrow,!0),null!=e.state&&null!=e.cropStep&&e.cropStep>0&&e.cropStep!=r.step?(T.playSound("zhuangyuan_shengzhang"),e.spineGrow.setAnimation(0,m.formatStr("MX_tx_%s_faya_kaihua",I),!1),e.spineGrow.addAnimation(0,m.formatStr("MX_tx_%s_kaihua_chixu",I),!0)):e.spineGrow.setAnimation(0,m.formatStr("MX_tx_%s_kaihua_chixu",I),!0)):(this.setSpineActive(e.spineGrow,e.opacityGrow,!1),this.setSpineActive(e.spineSeed,e.opacitySeed,!0),e.spineSeed.setAnimation(0,m.formatStr("MX_tx_%s_faya_chixu",I),!0)):(this.setSpineActive(e.spineGrow,e.opacityGrow,!1),this.setSpineActive(e.spineSeed,e.opacitySeed,!0),e.spineSeed.setAnimation(0,m.formatStr("MX_tx_%s_zhongzi_chixu",g),!0))}e.cropStep=r.step,e.state=a}},F.setSpineActive=function(t,i,e){0==e&&t.setAnimation(0,"idle",!0)},F.checkCropCanSteal=function(t,i){if(null==t)return!1;var e=t.cfg_id,n=configFarm_greens.getDataByKey(e),o=t.robber_list||[];if(o.length>=n.try_stolen_limit)return i&&O.showFlyTip(GetLanguage(200508)),!1;for(var a=0,d=0;d<o.length;d++){if(o[d].k==IS(A).GetRoleId())return i&&O.showFlyTip(GetLanguage(200509)),!1;0==o[d].v&&(a+=1)}return!(a>=n.stolen_limit)||(i&&O.showFlyTip(GetLanguage(200508)),!1)},F.onUpdate=function(t){this.time=this.time+t,this.time>=1&&(this.time=0,this.tryRefreshTimeShow(),this.setBuilding1Sprite()),this.updatebufftime>0&&(this.updatebufftime=this.updatebufftime-t,this.nodeBuff.txtTime.string=E.formatTimeForSecond(this.updatebufftime)),this.updatebufftime<=0&&(this.updatebufftime=0,this.nodeSpecialBuff.active=!1)},F.tryRefreshTimeShow=function(){for(var t in this.buildingIdToItem)this.updateBuildingUpgradeTime(Number(t));for(var i in this.updateFertilizerRecoverTime(),this.landIdToItem)this.updateLandTime(Number(i));this.updateStealingTime()},F.updateBuildingUpgradeTime=function(t){var i=this.isOther?this.otherFarmInfo.buildingIdToinfo[t]:IS(K).getBuildingInfoById(t),e=B.isEmpty(i)?0:i.end_time,n=this.buildingIdToItem[t];if(n.nodeUpgrade.active=e>0,!(e<=0)){n.txtTime.string=E.formatTimeForSecond(Math.max(0,e-E.serverTime));var o=e-E.serverTime-i.acc_time;this.isOther&&o<0&&!this.hasReq&&(this.hasReq=!0,IS(D).reqFarmInfo(this.visitRoleId)),n.txtTime.string=E.formatTimeForSecond(Math.max(0,o)),n.pbTime.progress=Math.min(1,o/(e-i.start_time))}},F.updateLandTime=function(t){var i=this;if(!this.watingShowFerDic[t]){var e=this.landIdToItem[t],n=this.isOther?this.otherFarmInfo.landIdToInfo[t]:IS(K).getLandInfoById(t);if(e.nodeTime.active=!1,!B.isEmpty(n)){var o=n.crop;if(!B.isEmpty(o)){var a=o.end_time;if(!(a<=0)){e.nodeTime.active=o.state!=V.STEALING,e.nodeTimeCollect.active=o.state==V.COLLECTING,e.nodeTimeGrow.active=o.state==V.GROWING,e.nodeTimeNormal.active=o.state==V.COLLECTING;var d=a-E.serverTime-o.acc_time;this.isOther&&d<0&&!this.hasReq&&(this.hasReq=!0,IS(D).reqFarmInfo(this.visitRoleId));var s=IS(K).getCropShowByInfo(o);if(s.step<=0){var r=configFarm_greens.getDataByKey(o.cfg_id).transformation,l=(a-o.start_time)*(r[0][0]/1e4),u=l+o.start_time-E.serverTime-o.acc_time;e.txtTime.string=E.formatTimeForSecond(Math.max(0,u)),e.pbTime.progress=u/l}else{if(e.cropStep<=0&&null!=e.state){var c=nt[o.seed_id],f=it[o.cfg_id];return T.playSound("zhuangyuan_faya"),this.watingShowFerDic[t]=!0,e.nodeTime.active=!1,e.spineSeed.setAnimation(0,m.formatStr("MX_tx_%s_%s_zhongzi_faya",c,f),!1),this.addUIEffect("prefab/ui-effect/MX_tx_zhuangyuan_zimu_zizhi",this.node,1.5,null,1,(function(t){var i=t.node;S.findChildComponent(i,"MX_tx_zhuangyuan_zimu",L).needAnimation=f,S.findChildComponent(i,"flyLabel",h).string=GetLanguage_UI(et[o.cfg_id])})),e.cropStep=s.step,void this.addTimer(1.5,1,(function(){i.watingShowFerDic[t]=!1,i.updateLandById(t)}))}e.txtTime.string=E.formatTimeForSecond(Math.max(0,d)),e.pbTime.progress=d/(a-o.start_time)}if(null!=e.cropStep&&e.cropStep==s.step||(null!=s&&s.cropShow?(null!=e.state&&e.cropStep&&e.cropStep>0&&(this.watingShowFerDic[t]=!0,T.playSound("zhuangyuan_shengzhang"),this.setSpineActive(e.spineSeed,e.opacitySeed,!1),this.setSpineActive(e.spineGrow,e.opacityGrow,!0),e.spineGrow.setAnimation(0,m.formatStr("MX_tx_%s_faya_kaihua",it[o.cfg_id]),!1),e.spineGrow.addAnimation(0,m.formatStr("MX_tx_%s_kaihua_chixu",it[o.cfg_id]),!0),this.addTimer(1.5,1,(function(){i.watingShowFerDic[t]=!1,i.updateLandById(t)}))),e.txtTimeState.string=GetLanguage(200514),e.spineTimeState.setAnimation(0,"chixu_lv",!0)):(e.spineSeed.setAnimation(0,m.formatStr("MX_tx_%s_zhongzi_chixu",nt[o.seed_id]),!0),e.txtTimeState.string=GetLanguage(200513),e.spineTimeState.setAnimation(0,"chixu_lv",!0))),e.cropStep=s.step,this.landIdToThief[t]){this.landIdToThief[t].txtTime.string=E.formatTimeForSecond(Math.max(0,d));var p=d/(a-o.acc_time-o.start_time);this.landIdToThief[t].imgTime.fillRange=Math.min(0,-p)}}}}}},F.updateFertilizerRecoverTime=function(){if(0!=this.nextRecoverTime){var t=this.nextRecoverTime-E.serverTime;this.txtFertilizerRecoverTime.string=E.formatTimeForSecond(Math.max(0,t))}},F.updateStealing=function(){var t=!IS(K).checkHasNotStealing();this.nodeIsStealing.active=t;var i=IS(K).getStealingInfo();this.stealingStartTime=t?i.start_time:0,this.stealEndTime=t?i.end_time:0,this.updateStealingTime()},F.updateStealingTime=function(){if(null!=this.stealEndTime&&0!=this.stealEndTime){var t=this.stealEndTime-E.serverTime;this.txtStealingTime.string=E.formatTimeForSecond(Math.max(0,t));var i=t/(this.stealEndTime-this.stealingStartTime);this.imgStealingTime.fillRange=Math.min(0,-i)}},F.clearLandThief=function(t,i){var e=this;if(!B.isEmpty(this.landIdToThief[t])&&!this.waitingDeadEffTheif[t]){if(this.waitingShowEffThief[t]=!1,null!=i)return this.waitingDeadEffTheif[t]=!0,this.landIdToThief[t].nodeTime.active=!1,this.landIdToThief[t].spine.setAnimation(0,i,!1),void this.addTimer(2,1,(function(){e.landIdToThief[t]&&(e.landIdToThief[t].node.destroy(),delete e.landIdToThief[t]),e.waitingDeadEffTheif[t]=!1,e.waitingShowEffThief[t]&&e.tryShowLandThief(t)}));this.landIdToThief[t]&&(this.landIdToThief[t].node.destroy(),delete this.landIdToThief[t])}},F.tryShowLandThief=function(t){var i=this;if(this.waitingDeadEffTheif[t])this.waitingShowEffThief[t]=!0;else{this.clearLandThief(t);var e=(this.isOther?this.otherFarmInfo.landIdToInfo[t]:IS(K).getLandInfoById(t)).crop;if(null!=e&&e.state==V.STEALING){var n=nodeInstantiate.instantiate(this.nodeThiefItem);n.parent=this.nodeLandRoot;var d=this.landIdToItem[t].node.position;n.position=new a(d.x+120,d.y+120,0),n.active=!0,this.addComponentCallbackListener(n,o.EventType.CLICK,(function(){uiMgr.openView("PlantThiefView",i.isOther?i.visitRoleId:IS(A).GetRoleId(),i.isOther?i.otherFarmInfo.landIdToInfo[t]:IS(K).getLandInfoById(t),!!i.isOther&&1==i.otherFarmInfo.canHelpBattle)})),this.landIdToThief[t]={node:n,nodeTime:S.findChild(n,"steal"),txtTime:S.findChildComponent(n,"steal/txtTime",h),imgTime:S.findChildComponent(n,"steal/imgTime",s),spine:S.findChildComponent(n,"MX_tx_zhuangyuan_xiaotou",L)},this.landIdToThief[t].nodeTime.active=!0,this.landIdToThief[t].spine.setAnimation(0,"run",!0),this.updateLandTime(t)}else this.waitingShowEffThief[t]=!1}},F.tryOneKeyOprate=function(t){if(!(this.isOther||IS(K).getFarmLevel()<$)){var i=IS(K).getMeetConditionLand(t);if(!(i.length<=0))if("pick"==t)for(var e=0;e<i.length;e++)IS(D).reqHomeFarmPick(0,i[e]);else if("fetch"==t)for(var n=0;n<i.length;n++)IS(D).reqHomeFarmHarvest(i[n]);else"plant"==t?uiMgr.openView("SeedSelectView",null,!0):"grow"==t&&uiMgr.openView("FertilizeSelectView",null,null,0,!0)}},F.onBeforeClose=function(){if(this.curBuildingSpriteName=null,"home_mix2"!=this.lastPlayMusic&&(T.playMusic("home_mix2"),this.lastPlayMusic="home_mix2"),this.tryClearLandCollectingTimers(),this.watingShowFerDic={},this.waitingShowEffThief={},this.waitingDeadEffTheif={},this.curOpenView=null,this.visitRoleId=0,this.isOther=!1,this.otherFarmInfo=null,this.clearThiefItem(),this.clearSpeItem(),this.landIdToFlyItems){for(var t in this.landIdToFlyItems)this.clearFlyRes(Number(t));this.landIdToFlyItems={}}for(var i in this.buildingIdToItem){var e=this.buildingIdToItem[i];e.effectUpgrading&&(this.removeUIEffect(e.effectUpgrading),e.effectUpgrading=null)}this.hasReq=!1},F.clearSpeItem=function(){this.curSpeThiefItem&&(this.curSpeThiefItem.node.destroy(),this.curSpeThiefItem=null)},F.tryClearLandCollectingTimers=function(){for(var t in this.landIdToCollectingSoundTimer)this.clearLandCollectingTimerByLandId(Number(t))},F.clearLandCollectingTimerByLandId=function(t){null!=this.landIdToCollectingSoundTimer[t]&&(this.removeTimer(this.landIdToCollectingSoundTimer[t]),delete this.landIdToCollectingSoundTimer[t])},F.tryStartCollectingTimerByLandId=function(t){null==this.landIdToCollectingSoundTimer[t]&&(this.landIdToCollectingSoundTimer[t]=this.addTimer(1,-1,(function(){T.playSound("zhuangyuan_shoucai")})))},F.clearThiefItem=function(){for(var t in this.landIdToThief)this.clearLandThief(Number(t));for(var i in this.landIdToItem)this.landIdToItem[i].state=null,this.landIdToItem[i].cropStep=null},F.onDestroy=function(){},F.playFlyRes=function(t,i){var e=this;if(null!=t&&!(null==i||i.length<=0)){var n=i[0].gtid,o=i[0].num>1?5:1,a=this.landIdToItem[t].node.worldPosition,d=this.utFlyRoot.convertToNodeSpaceAR(a),s=this.utFlyRoot.convertToNodeSpaceAR(this.nodeNutrients.worldPosition);this.addFlyItem(t,n,d,s,1),o-1>0&&this.addTimer(.2,o-1,(function(){e.addFlyItem(t,n,d,s)})),this.addTimer(1+.2*(o-1),1,(function(){e.updateNutrientsCount(),e.clearFlyRes(t)}))}},F.addFlyItem=function(t,i,e,n,o){var d=nodeInstantiate.instantiate(this.nodeFlyItem);d.parent=this.nodeFlyRoot;var h=d.getComponent(s);this.loadIcon(h,"icon_item","9"),d.active=!0,d.setPosition(e),null==this.landIdToFlyItems&&(this.landIdToFlyItems={}),null==this.landIdToFlyItems[t]&&(this.landIdToFlyItems[t]=new Array);var r={node:d,tween:this.addTween(0,1,1,(function(t,i){var o=new a(0,0,0);a.lerp(o,e,n,i),d.setPosition(o)})).call((function(){d.active=!1})).easing(j.BACK_IN).start()};this.landIdToFlyItems[t].push(r)},F.clearFlyRes=function(t){if(null!=this.landIdToFlyItems&&null!=this.landIdToFlyItems[t]){for(var i=0;i<this.landIdToFlyItems[t].length;i++)this.landIdToFlyItems[t][i].node.destroy(),this.landIdToFlyItems[t][i].tween.stop();delete this.landIdToFlyItems[t]}},F.onRoleLandUpdate=function(t,i){var e=i.id;if(!this.isOther)return B.isEmpty(i.crop)&&(this.lastUpdateTime=c.now()),void this.updateLandById(e);t==this.visitRoleId&&(this.otherFarmInfo.landIdToInfo[e]=i,this.updateLandById(e))},F.onRoleHomeInfoBack=function(t){this.isOther&&this.visitRoleId==t.role_id&&(this.hasReq=!1,this.otherFarmInfo=t,this.updateFarmInfo())},F.onFarmLandHarvestFinish=function(t,i,e){this.isOther||(this.updateLandById(t),this.updateFarmLevelInfo(),T.playSound("zhuangyuan_gongpin"),this.playFlyRes(t,i),this.addUIEffect("prefab/ui-effect/MX_tx_tongyong_jingyanguangxiao",this.pbExp.node,1,new u(180,0)),e&&this.addUIEffect("prefab/ui-effect/MX_tx_zhuangyuan_shengji",this.nodeLevelRoot,1,new u(-95,0)))},F.onFarmBuildingUpdate=function(t){this.isOther||this.updateBuildingById(t)},F.onHomeFarmInfoInit=function(){this.isOther||this.updateFarmInfo()},F.onClickBuilding=function(t){this.isOther?uiMgr.openView("FarmBuildingUpgradeView",t,this.visitRoleId,this.otherFarmInfo.buildingIdToinfo[t]):uiMgr.openView("FarmBuildingUpgradeView",t)},F.onRoleResUpdate=function(t){t==P.ROLE_FERTILIZER_BUY?this.updateFertilizerBuyCount():t==P.ROLE_FERTILIZER_GET?this.updateFertilizerRecoverCount():t==P.ROLE_FERTILIZER_HELP?this.updateFertilizerHelpCount():t==P.ROLE_NUTRIENTS&&c.now()-this.lastUpdateTime>=2?this.updateNutrientsCount():t==P.ROLE_BUILDING_POINT?(this.updateBuildingPointCount(),this.updateBuildingItems()):t==P.ROLE_SEED_BUY?this.updateSeedBuyCount():t==P.ROLE_SEED_GET?this.updateSeedRecoverCount():t==P.ROLE_SEED_RARE&&this.updateSeedRareCount()},F.onFarmForceChange=function(t){this.openArgs=[t],this.onAfterOpen()},F.onRoleGoodsRefreshUpdate=function(){this.updateFertilizerRecoverCount(),this.updateFertilizerHelpCount(),this.updateSeedRecoverCount()},F.onFarmStolenInfoUpdate=function(){this.updateStealing(),this.trySetMusic()},F.onRoleRedDetailUpdate=function(t){t==N.System_Farm&&this.updateRedPoint()},F.onFarmBuildingUpgradeFinish=function(t){if(!this.isOther){var i=this.buildingIdToItem[t];T.playSound("common_reward"),this.addUIEffect("prefab/ui-effect/MX_tx_zhuangyuan_jianzaochenggong",i.node,1.1,new u(0,-110))}},F.onFarmFertilizePlantAction=function(t){var i=this;this.watingShowFerDic[t]=!0;var e=this.landIdToItem[t];this.addUIEffect("prefab/ui-effect/MX_tx_zhuangyuan_shifei",e.node,1),T.playSound("zhuangyuan_shifei"),this.addTimer(1,1,(function(){i.watingShowFerDic[t]=!1,i.updateLandById(t)}))},F.onFarmBattleReqFail=function(){this.isOther&&IS(D).reqFarmInfo(this.visitRoleId)},F.onFarmSeedPlantAction=function(t){var i=this;if(!this.isOther){this.watingShowFerDic[t]=!0;var e=this.landIdToItem[t];this.addUIEffect("prefab/ui-effect/MX_tx_zhuangyuan_bozhong",e.node,1.5),this.addTimer(1.5,1,(function(){i.watingShowFerDic[t]=!1,i.updateLandById(t)}))}},F.onFarmLandUnlockAction=function(t){var i=this;if(!this.isOther&&!(null==t||t.length<=0))for(var e=function(e){var n=t[e];i.watingShowFerDic[n]=!0;var o=i.landIdToItem[n];i.addUIEffect("prefab/ui-effect/MX_tx_zhuangyuan_jsturang",o.node,2.5),i.addTimer(2.5,1,(function(){i.watingShowFerDic[n]=!1,i.updateLandById(n)}))},n=0;n<t.length;n++)e(n)},F.onViewOpen=function(t){for(var i in this.openTypeItems)i==t&&(this.curOpenView=i,this.updateSelect())},F.onViewClose=function(t){null!=this.curOpenView&&t==this.curOpenView&&(this.curOpenView=null,this.updateSelect())},F.onClickLand=function(t){var i=this.isOther?this.otherFarmInfo.landIdToInfo[t]:IS(K).getLandInfoById(t);this.landIdToItem[t];if(B.isEmpty(i)){var e=configFarm_pos.getDataByKey(t);this.isOther||O.showFlyTip(e.desc)}else{var n=i.crop;if(B.isEmpty(n)||n.state==V.NOT_EXIT)this.isOther||uiMgr.openView("SeedSelectView",t);else{var o=n.state;if(o==V.GROWING)return IS(K).getCropShowByInfo(n).step<=0?void O.showFlyTip(GetLanguage(200517)):void uiMgr.openView("PlantDetailView",t,this.visitRoleId,i);o!=V.MATURE?o!=V.COLLECTING?o!=V.STEALING?this.isOther||IS(D).reqHomeFarmHarvest(t):uiMgr.openView("PlantThiefView",this.isOther?this.visitRoleId:IS(A).GetRoleId(),i,!!this.isOther&&1==this.otherFarmInfo.canHelpBattle,this.isOther?this.otherFarmInfo:null):this.isOther&&!this.checkCropCanSteal(n,!0)||uiMgr.openView("PlantDetailView",t,this.visitRoleId,i):this.isOther?this.checkCropCanSteal(n,!0)&&uiMgr.openView("PlantDetailView",t,this.visitRoleId,i):IS(D).reqHomeFarmPick(0,t)}}},n}(q));n._RF.pop()}}}));

