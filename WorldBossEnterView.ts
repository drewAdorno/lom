System.register("chunks:///_virtual/WorldBossEnterView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./ConfigGlobal.ts","./MulLanguageUtil.ts","./ChapterDataCache.ts","./ChapterDefine.ts","./DungeonControl.ts","./CommonModel.ts","./MessageView.ts","./FrameDataCache.ts","./RankControl.ts","./RankDefine.ts","./RoleDataCache.ts","./RoleDefine.ts","./DungeonDefine.ts","./BaseView.ts"],(function(t){"use strict";var e,n,i,o,a,s,r,d,l,f,h,g,u,c,m,C,p,v,_,B,w,I,R,y,b,L,k;return{setters:[function(t){e=t.inheritsLoose},function(t){n=t.cclegacy,i=t.Button,o=t.HorizontalTextAlignment,a=t.sys,s=t.Label,r=t.ProgressBar,d=t.Sprite,l=t.js},function(t){f=t.default},function(t){h=t.default},function(t){g=t.default},null,function(t){u=t.ConfigGlobal},function(t){c=t.default},function(t){m=t.ChapterDataCache},function(t){C=t.DungeonDefine,p=t.ChapterEventDefine},function(t){v=t.default},function(t){_=t.CommonModel},function(t){B=t.default},function(t){w=t.FrameDataCache},function(t){I=t.default},function(t){R=t.RankDefine},function(t){y=t.RoleDataCache},function(t){b=t.PlayerAttr},function(t){L=t.DungeonEvent},function(t){k=t.BaseView}],execute:function(){n._RF.push({},"447c0FX4wJLyqNI0UxwQrUd","WorldBossEnterView",void 0);t("default",function(t){function n(){var e;return(e=t.call(this)||this).data=void 0,e.txtBestname=void 0,e.txtBuff=void 0,e.nodeBestModel=void 0,e.pbDmg=void 0,e.btnGoto=void 0,e.name="WorldBossEnterView",e.url="ui/module/dungeon/WorldBossEnterView",e.poolTime=3e3,e}e(n,t);var k=n.prototype;return k.onInit=function(){var t=this,e=this.findChild("imgMask");this.addComponentCallbackListener(e,i.EventType.CLICK,(function(){t.close()}));var n=this.findChild("content/btnClose");this.addComponentCallbackListener(n,i.EventType.CLICK,(function(){t.close()}));var d=this.findChild("content/imgBg/btnRank");this.addComponentCallbackListener(d,i.EventType.CLICK,(function(){t.showRank()}));var l=this.findChild("content/imgBg/btnReward");this.addComponentCallbackListener(l,i.EventType.CLICK,(function(){t.showRewardPreview()})),this.btnGoto=this.findChild("content/btnGo"),this.addComponentCallbackListener(this.btnGoto,i.EventType.CLICK,(function(){var e=IS(m).worldBossInfo;if(1==(null==e?void 0:e.is_open))if(e.times>0)t.startWar();else{var n=configErrorInfo.getDataByKey(199);B.showFlyTip(n.info)}else{var i=configErrorInfo.getDataByKey(198);B.showFlyTip(i.info)}}));var f=this.findChild("content/btnTips");this.addComponentCallbackListener(f,i.EventType.CLICK,(function(){var t=configChapter_type.getDataByKey(C.CHAPTER_TYPE_WORLDBOSS).desc,e=configChapter_type.getDataByKey(C.CHAPTER_TYPE_WORLDBOSS).name,n=o.LEFT;a.uiMirror&&(n=o.RIGHT),B.showBoxTip({title:e,tip:t,btnCnt:1,horizontalAlign:n})})),this.txtBestname=this.findChildComponent("content/imgBg/nodeBest/txtname",s),this.nodeBestModel=this.findChild("content/imgBg/nodeBest/model"),this.txtBuff=this.findChildComponent("content/imgBg/nodeBuff/txtDesc",s),this.pbDmg=this.findChildComponent("content/nodePb/ProgressBar",r)},k.registerUpdateHandler=function(){this.addEvent(R.RankInfoBack,this.openRankView,this),this.addEvent(L.TYPE_WORLD_BOSS_INFO_CHANGE,this.refreshView,this)},k.refreshView=function(){this.data=IS(m).worldBossInfo,this.data&&(this.updaItemInfo(),this.showMyRank(),this.refreshBestInfo(),this.refreshBuffInfo(),this.refreshPbInfo(),this.refreshReward(),this.refreshStatus())},k.onAfterOpen=function(){IS(v).reqWorldBossInfo(),this.refreshView()},k.refreshStatus=function(){var t=IS(m).worldBossInfo;t&&(t.is_open?this.btnGoto.getComponent(d).grayscale=!1:this.btnGoto.getComponent(d).grayscale=!0)},k.refreshReward=function(){for(var t=0;t<2;t++){var e=this.findChild("content/nodeReward/node"+t),n=f.findChildComponent(e,"txtNum",s),i=u.world_boss_daily_reward;n.string=i[t][1]+"";var o=f.findChildComponent(e,"Sprite",d);this.loadIcon(o,"icon_item",i[t][0]+"")}var a=this.findChild("content/nodeReward"),r=f.findChildComponent(a,"txtname",s);IS(m).worldBossInfo.is_first>0?r.string=l.formatStr("%s%s",GetLanguage_UI(100334),GetLanguage_UI(100335)):r.string=GetLanguage_UI(100334)},k.refreshPbInfo=function(){var t=this,e=g.getServerOpenDay(),n=configWorld_boss_total_dmg.getDataByKey(e);if(!n&&e>0){var o=configWorld_boss_total_dmg.getDatas();n=o[o.length-1]}if(n){for(var a=IS(m).worldBossInfo.total_hurt,r=0,d=function(){f=t.findChildComponent("content/nodePb/node"+(l+1)+"/txtNum",s);var e=t.findChild("content/nodePb/node"+(l+1)),o=n.reward_participate[l];t.addComponentCallbackListener(e,i.EventType.CLICK,(function(t){uiMgr.openView("RewardPreview",{title:GetLanguage(200151),rewardList:o})})),f.string=h.GetNumString(n.total_dmg[l],!1,0),a>=n.total_dmg[l]?(r+=1/n.total_dmg.length,l==n.total_dmg.length-1&&(r=1)):(u=0,0==l?u=a/n.total_dmg[l]/n.total_dmg.length:a-n.total_dmg[l-1]>0&&(u=(a-n.total_dmg[l-1])/(n.total_dmg[l]-n.total_dmg[l-1])/n.total_dmg.length),r+=u)},l=0;l<n.total_dmg.length;l++){var f,u;d()}this.pbDmg.progress=r}},k.refreshBuffInfo=function(){var t=configWorld_boss_bufflist.getDataByKey(this.data.today_buff);this.txtBuff.string=t.buff_desc},k.refreshBestInfo=function(){var t=this.findChild("content/imgBg/nodeBest/img"),e=this.data.figure;if(!e||0==e.job_figure)return this.txtBestname.string=GetLanguage(200038),void(t.active=!0);this.txtBestname.string=this.data.role_name,t.active=!1,this.loadRoleModel(e)},k.loadRoleModel=function(t){for(var e=t.hair_figure>0&&t.hair_figure||6,n=t.equip_list.length>0&&IS(_).GetKvListByK(t.equip_list,0)||0,i=t.equip_list.length>1&&IS(_).GetKvListByK(t.equip_list,1)||0,o=t.equip_list.length>2&&IS(_).GetKvListByK(t.equip_list,2)||0,a=t.mount_figure||0,s=t.skin_list||[],r=0,d=0;d<s.length;d++)2==s[d].k&&(r=s[d].v);var l=t.gender||1,f=t.artifact_figure||0;this.nodeBestModel.removeAllChildren(),this.addUnitModel({job:t.job_figure,parent:this.nodeBestModel,dressId:r,gender:l,color:e,weapon:n,ornaments:i,face:o,mount:a,shenqi:f})},k.showMyRank=function(){var t=this.findChildComponent("content/meRank/imgFrame/frame/imgIcon",d),e=this.findChildComponent("content/meRank/imgFrame/frame/imgHeadFrame",d),n=this.findChildComponent("content/meRank/name",s),i=this.findChildComponent("content/meRank/rank",s),o=this.findChildComponent("content/meRank/score",s),a=this.findChildComponent("content/meRank/no_rank",s),r=this.findChildComponent("content/meRank/power",s),l=IS(y),f=l.GetRoleAttr(b.ROLE_ATTR_HEAD_URL);this.loadRemoteIcon(f,t);var g=IS(w).curFrameId;if(g>0){var u=configAvatar_frame.getDataByKey(g);this.loadIcon(e,"icon_frame",u.icon),e.node.active=!0}else e.node.active=!1;this.data&&(0==this.data.my_rank?(a.node.active=!0,i.node.active=!1):(a.node.active=!1,i.node.active=!0),i.string=this.data.my_rank>0?this.data.my_rank+"":"-",n.string=l.GetRoleName(),o.string="Lv."+l.GetLevel(),r.string=h.GetNumString(this.data.my_hurt))},k.startWar=function(){this.data.times<=0?B.showFlyTip(GetLanguage(200152)):(IS(v).reqDungeonBattleMoreStart(C.CHAPTER_TYPE_WORLDBOSS,1),battleMain.enterChapter(0,!0),normalEvent.emit(p.DUNGEON_ENTER),this.close())},k.showRank=function(){var t=new Array;t.push({type:1020,server:1,page:1}),IS(I).reqRankList(t)},k.openRankView=function(t){if(!uiMgr.getOpenView("CommonRankView")){var e={title:GetLanguage(200153),desType:1};uiMgr.openView("CommonRankView",t,e)}},k.showRewardPreview=function(){var t=c.GetconfigLanguage_Text(104144);a.uiMirror?B.showBoxTip({tip:t.text,title:GetLanguage(200154),btnCnt:1,horizontalAlign:2}):B.showBoxTip({tip:t.text,title:GetLanguage(200154),btnCnt:1,horizontalAlign:0})},k.updaItemInfo=function(){if(this.data){var t=this.data.times,e=this.findChildComponent("content/bgNum/txtNum",s);e.string=t>99?"99+":t+""}},k.onBeforeClose=function(){},k.onDestroy=function(){},n}(k));n._RF.pop()}}}));

