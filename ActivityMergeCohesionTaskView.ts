System.register("chunks:///_virtual/ActivityMergeCohesionTaskView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./TimeUtil.ts","./index57.ts","./ActivityControl.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./BaseView.ts"],(function(t){"use strict";var e,i,s,n,o,a,r,d,h,c,f,l,v,u,m,T,p;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,s=t.Button,n=t.Layout,o=t.Label,a=t.ScrollView,r=t.js,d=t.ProgressBar},function(t){h=t.ItemGrid},function(t){c=t.ListItem},function(t){f=t.default},function(t){l=t.default},null,function(t){v=t.default},function(t){u=t.default},function(t){m=t.ActivityEventDefine,T=t.ActivityTaskState},function(t){p=t.BaseView}],execute:function(){i._RF.push({},"93e0cOv/E9OnrCTqrPiJJ0A","ActivityMergeCohesionTaskView",void 0);t("default",function(t){function i(){var e;return(e=t.call(this)||this).txtLeftTime=void 0,e.taskList=void 0,e.deltaTime=0,e.leftTime=0,e.canUpdate=!1,e.name="ActivityMergeCohesionTaskView",e.url="ui/module/activityMergeServers/ActivityMergeCohesionTaskView",e}e(i,t);var d=i.prototype;return d.onInit=function(){var t=this,e=this.findChild("imgMask");this.addComponentCallbackListener(e,s.EventType.CLICK,(function(){t.close()}));var i=this.findChild("btnClose");this.addComponentCallbackListener(i,s.EventType.CLICK,(function(){t.close()})),this.dealMirrorLayout(this.findChildComponent("view/nodeTime",n)),this.txtLeftTime=this.findChildComponent("view/nodeTime/txtLeftTime",o);var r=this.findChildComponent("view/taskList",a);this.taskList=this.addUIList(r,C)},d.registerUpdateHandler=function(){this.addEvent(m.OnActivityInfoTaskUpdate,this.OnTaskUpdate,this),this.addEvent(m.OnActivityInfoUpdate,this.OnTaskUpdate,this)},d.onAfterOpen=function(){IS(v).send_24_14(this.openArgs[0]),this.canUpdate=!0;var t=l.ServerDate(1e3*(l.serverTime+86400)),e=r.formatStr("%s/%s/%s %s:%s:%s",t.getFullYear(),t.getMonth()+1,t.getDate(),0,0,0),i=l.getServerDateByLocalStr(e).getTime()/1e3;this.leftTime=i-l.serverTime,this.leftTime>=0&&(this.txtLeftTime.string=l.formatTimeStringForSecond(this.leftTime)),this.OnTaskUpdate()},d.onBeforeClose=function(){this.canUpdate=!1},d.onDestroy=function(){},d.onUpdate=function(t){if(this.canUpdate&&(this.deltaTime=this.deltaTime+t,this.deltaTime>=1))if(this.deltaTime=0,this.leftTime=this.leftTime-1,this.leftTime>=0)this.txtLeftTime.string=l.formatTimeStringForSecond(this.leftTime);else{var e=l.ServerDate(1e3*(l.serverTime+86400)),i=r.formatStr("%s/%s/%s %s:%s:%s",e.getFullYear(),e.getMonth()+1,e.getDate(),0,0,0),s=l.getServerDateByLocalStr(i).getTime()/1e3;this.leftTime=s-l.serverTime,this.leftTime>0&&(this.txtLeftTime.string=l.formatTimeStringForSecond(this.leftTime))}},d.OnTaskUpdate=function(){var t=IS(u).GetActivityInfo(this.openArgs[0]),e=[];for(var i in t.task_list)t.task_list.hasOwnProperty(i)&&e.push(t.task_list[i]);e.sort((function(t,e){return t.state==T.CanGet&&e.state!=T.CanGet?-1:t.state!=T.CanGet&&e.state==T.CanGet?1:t.state!=e.state?t.state-e.state:t.task_id-e.task_id})),this.taskList.datas=e},i}(p));var C=function(t){function i(){for(var e,i=arguments.length,s=new Array(i),n=0;n<i;n++)s[n]=arguments[n];return(e=t.call.apply(t,[this].concat(s))||this).txtDesc=void 0,e.btnGet=void 0,e.received=void 0,e.undone=void 0,e.pb=void 0,e.schedule=void 0,e.itemGridNode=void 0,e.itemGrid=void 0,e}e(i,t);var n=i.prototype;return n.onInit=function(){var t=this;this.itemGridNode=f.findChild(this.node,"itemGrid"),this.itemGrid=new h(this.view,this.itemGridNode),this.txtDesc=f.findChildComponent(this.node,"txtDesc",o),this.pb=f.findChildComponent(this.node,"ProgressBar",d),this.schedule=f.findChildComponent(this.node,"ProgressBar/schedule",o),this.received=f.findChild(this.node,"received"),this.undone=f.findChild(this.node,"undone"),this.btnGet=f.findChild(this.node,"btnGet"),this.view.addComponentCallbackListener(this.btnGet,s.EventType.CLICK,(function(){IS(v).send_24_15(t.view.openArgs[0],t.data.task_id,t.data.group_id)}))},n.onRender=function(t,e){this.txtDesc.string=t.cfg.desc,this.itemGrid.SetItemId(t.cfg.reward[0][0],t.cfg.reward[0][1]);var i=t.cfg.condition[2];this.schedule.string=r.formatStr("%s/%s",Math.min(i,t.count),i),this.pb.progress=t.count/t.cfg.condition[2],t.state==T.CanGet?(this.received.active=!1,this.undone.active=!1,this.btnGet.active=!0):t.state==T.HadGet?(this.received.active=!0,this.undone.active=!1,this.btnGet.active=!1):(this.received.active=!1,this.undone.active=!0,this.btnGet.active=!1)},i}(c);i._RF.pop()}}}));

