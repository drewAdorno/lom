System.register("chunks:///_virtual/IOHandler.ts",["cc","./ByteArray.ts"],(function(t){"use strict";var e,i;return{setters:[function(t){e=t.cclegacy},function(t){i=t.ByteArray}],execute:function(){var n;e._RF.push({},"2b043yjwZVDMZJZyVuUmse0","IOHandler",void 0),function(t){t[t.WAIT_NEW_PACKET=0]="WAIT_NEW_PACKET",t[t.WAIT_DATA_SIZE=1]="WAIT_DATA_SIZE",t[t.WAIT_DATA_SIZE_FRAGMENT=2]="WAIT_DATA_SIZE_FRAGMENT",t[t.WAIT_DATA=3]="WAIT_DATA",t[t.INVALID_DATA=4]="INVALID_DATA"}(n||(n={}));var r=new i,s=[153,234,171,122,153,37,54,178,41,143,55,117,108,2,144,122,103,79,15,148,253,85,47,52,9,227,214,212,84,65,207,5,7,13,14,252,144,156,100,171,224,228,203,149,76,184,103,203,19,101,153,173,165,19,69,154,1,240,209,164,106,118,6,157,239,63,246,239,221,68,81,194,149,53,25,35,43,61,235,197,86,70,116,6,150,244,237,81,252,85,153,107,4,30,147,86,7,220,152,169,158,183,214,193,240,242,51,14,204,137,81,139,102,158,158,203,141,17,97,90,221,81,226,85,146,57,198,233,204,36,84,131,71,224,52,233,29,174,213,163,211,25,222,189,45,20,134,25,36,228,86,163,170,148,140,19,47,150,12,176,20,144,97,115,12,124,208,59,225,102,232,64,81,190,17,98,254,14,108,231,105,199,12,56,148,242,123,24,26,82,193,199,154,87,211,92,63,147,90,224,164,243,216,137,19,118,7,31,106,244,41,113,160,17,117,247,126,26,200,86,45,115,199,58,133,235,184,217,245,247,9,198,200,34,71,174,175,125,77,129,35,234,7,143,112,142,138,121,100,149,203,142,137,116,243,225],a=256;t("IOHandler",function(){function t(t){this._sendMsgID=1,this._skipBytes=0,this._buffer=void 0,this._expectedLength=-1,this._readState=n.WAIT_NEW_PACKET,this._client=void 0,this._client=t}var e=t.prototype;return e.handleDataSize=function(t){var e=t.readInt();return e&&-1!=e?(this._expectedLength=e,t=this.resizeByteArray(t,4,t.length-4),this._readState=n.WAIT_DATA,t):(this._readState=n.WAIT_DATA_SIZE_FRAGMENT,this._buffer.writeBytes(t.bytes),t=r)},e.handleDataSizeFragment=function(t){var e=this._buffer,s=4-e.length;if(t.length>=s){e.writeBytes(t.bytes,0,s);var a=new i;a.writeBytes(e.bytes,0,4),a.position=0;var h=a.readInt();return this._expectedLength=h,e=new i,this._buffer=e,this._readState=n.WAIT_DATA,t.length>s?t=this.resizeByteArray(t,s,t.length-s):t=r}return e.writeBytes(t.bytes),t=r},e.handleInvalidData=function(t){if(0==this._skipBytes)return this._readState=n.WAIT_NEW_PACKET,t;var e=Math.min(t.length,this._skipBytes);return t=this.resizeByteArray(t,e,t.length-e),this._skipBytes-=e,t},e.handleNewPacket=function(t){return this._buffer=new i,this._expectedLength=-1,this._readState=n.WAIT_DATA_SIZE,t},e.handlePacketData=function(t){var e=this._buffer,s=this._expectedLength-e.length,a=t.length>s,h=new i(t.bytes);try{if(t.length>=s?(e.writeBytes(t.bytes,0,s),e.position=0,this.dispatchRequest(e),this._readState=n.WAIT_NEW_PACKET):e.writeBytes(t.bytes),a)return t=this.resizeByteArray(t,s,t.length-s);t=r}catch(t){return printLogException(t),this._skipBytes=s,this._readState=n.INVALID_DATA,h}return t},e.dispatchRequest=function(t){for(var e=t.readShort(),n=t.readByte(),r=t.readBytes(this._expectedLength-3),h=e%a,_=0,A=r.length;_<A;_++,h=(h+1)%a)r[_]=255&(r[_]^s[h]);if(1==n){var d=new i(r);d.uncompress(),r=d.bytes}this._client.reciveMsg(e,r)},e.onDataRead=function(t){for(var e=new i(t);e.length>0;)if(this._readState==n.WAIT_NEW_PACKET)e=this.handleNewPacket(e);else{if(this._readState==n.WAIT_DATA_SIZE){e=this.handleDataSize(e);continue}if(this._readState==n.WAIT_DATA_SIZE_FRAGMENT){e=this.handleDataSizeFragment(e);continue}if(this._readState==n.WAIT_DATA){e=this.handlePacketData(e);continue}this._readState==n.INVALID_DATA&&(e=this.handleInvalidData(e))}},e.resizeByteArray=function(t,e,n){return t.position=e,new i(t.readBytes(n))},e._getSendID=function(){return 65535==this._sendMsgID?this._sendMsgID=1:this._sendMsgID++,this._sendMsgID},e.genPacket=function(t,e){var n=new i,r=this._getSendID();n.writeInt(e.length+2+2),n.writeShort(r),n.writeShort(t);for(var h=t%a,_=0,A=e.length;_<A;_++,h=(h+1)%a)e[_]=255&(e[_]^s[h]);return n.writeBytes(e),n},t}());e._RF.pop()}}}));

