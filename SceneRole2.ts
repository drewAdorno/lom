System.register("chunks:///_virtual/SceneRole2.ts",["./rollupPluginModLoBabelHelpers.js","cc","./V2.ts","./NodeUtil.ts","./UIEffectAsset.ts","./PolyNavAgent.ts","./FriendControl.ts","./RoleDataCache.ts","./CrossWarDefine.ts","./SceneUnit8.ts"],(function(t){"use strict";var e,o,i,n,s,a,l,r,c,h,f,d,u,p,m,g,v,I;return{setters:[function(t){e=t.inheritsLoose,o=t.createClass},function(t){i=t.cclegacy,n=t.sys,s=t.ProgressBar,a=t.Sprite,l=t.Label,r=t.HorizontalTextAlignment,c=t.Color,h=t.Vec2},function(t){f=t.V2},function(t){d=t.default},function(t){u=t.UIEffectAsset},function(t){p=t.PolyNavAgent},function(t){m=t.default},function(t){g=t.RoleDataCache},function(t){v=t.SceneObjState},function(t){I=t.SceneUnit}],execute:function(){i._RF.push({},"dc1f4TiFwdEDIRw5LkXXg+E","SceneRole",void 0);t("SceneRole",function(t){function i(e,o){var i;(i=t.call(this)||this).map=void 0,i.agent=void 0,i.model=void 0,i.moveType=0,i.velocity=void 0,i.infoView=void 0,i.battleInfo=void 0,i.pbHp=void 0,i.imgIcon=void 0,i.initState=!1,i.info=o,i.uid=o.obj_id,i.map=e,i.agent=new p(null);var n=new f(o.pos.x,o.pos.y);return i.model=u.alloc("ui/module/crosswar/scene/Player",e.nodeUnit,-1,(function(t){i.onInit(t)})),i.infoView=u.alloc("ui/module/crosswar/scene/PlayerInfo",e.nodeUnitHub,-1,(function(t){i.onInfoInit(t)})),i.agent.pos.set(n.x,n.y),i.agent.maxSpeed=150,i.rect.width=100,i.rect.height=100,i.rect.center=n,i.id="obj:"+o.obj_id,i}e(i,t);var I=i.prototype;return I.onInit=function(t){var e,o=t.node;n.uiMirror&&o.setScale(-1,1,1),this.pbHp=d.findChildComponent(o,"pbHp",s),this.imgIcon=d.findChildComponent(o,"mask/imgIcon",a),this.map.view.loadRemoteIcon(null==(e=this.info.role.head)?void 0:e.url,this.imgIcon)},I.onInfoInit=function(t){var e=t.node,o=d.findChildComponent(e,"txtName",l);o.string="[s"+this.info.role.serv_id+"]\n"+this.info.role.name,n.uiMirror&&(o.node.setScale(-1,1,1),o.horizontalAlign=r.RIGHT),Number(this.info.obj_id)==IS(g).GetRoleId()?o.color=c.WHITE:this.info.role.serv_id==IS(g).GetServerId()?o.color=new c(39,153,22):o.color=new c(255,0,0);var i=d.findChildComponent(e,"imgIcon",a),s=configCross_war_job.getDataByKey(this.info.role.job);if(this.map.view.loadIcon(i,"crosswar_scene",null==s?void 0:s.icon),this.model)for(var h=IS(g).GetPowerInfoByID(0),f=Math.floor(this.info.role.power/h*1e4),u=configCross_war_head_scale.getDatas(),p=u.length-1;p>=0;p--)if(f>=u[p].power_radio){this.model.scale=u[p].big_scale/1e4,t.scale=this.model.scale;break}},I.removeEvent=function(){},I.onShowInfo=function(){IS(m).reqOtherRoleNotice(this.info.obj_id)},I.onUpdate=function(t){this.del||(this.pbHp&&!this.initState&&(this.initState=!0,this.updateState()),this.agent.onUpdate(t),1==this.moveType?this.agent.isMove||(this.moveType=0):2==this.moveType&&this.agent.setDirPos(this.velocity,t),this.rect.center=this.agent.pos,this.model.position=this.agent.pos,this.infoView.position=this.agent.pos,this.battleInfo&&(this.battleInfo.position=this.agent.pos))},I.moveToTarget=function(t){return this.agent.stop(),!(h.distance(this.agent.pos,t)<1)&&(this.agent.activePath.push(t),this.agent.isMove=!0,this.moveType=1,!0)},I.moveToDir=function(t){t.lengthSqr()>1?this.velocity=t:this.velocity=h.ZERO},I.stopMove=function(){this.moveType=0,this.agent.stop(),this.velocity=h.ZERO},I.onDestroy=function(){this.infoView&&(this.removeEvent(),this.infoView.free()),this.battleInfo&&this.battleInfo.free(),this.model&&this.model.free(),this.battleInfo=null,this.infoView=null,this.model=null},I.updateState=function(){var t=this.model;if(t){switch(this.info.state){case v.Battle:null==this.battleInfo&&(this.battleInfo=u.alloc("ui/module/crosswar/scene/BattletInfo",this.map.nodeUnitState,-1),this.battleInfo.position=t.position);break;case v.Dead:this.imgIcon&&(this.imgIcon.grayscale=!0);case v.Normal:this.imgIcon&&this.info.state==v.Normal&&(this.imgIcon.grayscale=!1),null!=this.battleInfo&&(this.battleInfo.free(),this.battleInfo=null)}this.pbHp&&(this.pbHp.progress=this.info.hp/1e4)}},o(i,[{key:"position",get:function(){return this.model.position},set:function(t){this.model.position=t,this.agent.pos.set(t.x,t.y),this.rect.center=t}},{key:"depth",get:function(){return this.model.depth},set:function(t){this.model.depth=t}}]),i}(I));i._RF.pop()}}}));

