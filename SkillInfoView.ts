System.register("chunks:///_virtual/SkillInfoView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./RedPoint.ts","./RedPointMgr.ts","./StringUtil.ts","./index57.ts","./BaseView.ts","./ObjectUtil.ts","./BagControl.ts","./BagDefine.ts","./BagModel.ts","./MessageView.ts","./EquipModel.ts","./MainViewModel.ts","./SkillControl.ts","./SkillDataCache.ts","./SkillDefine.ts","./SkillModel.ts","./UIDefine.ts"],(function(t){"use strict";var i,e,n,o,s,l,a,h,d,c,r,p,u,f,m,C,g,v,k,I,S,y,b,L,x,B,_,D;return{setters:[function(t){i=t.inheritsLoose},function(t){e=t.cclegacy,n=t.math,o=t.Button,s=t.Sprite,l=t.Label,a=t.ProgressBar,h=t.UITransform,d=t.Node,c=t.LabelOutline,r=t.js,p=t.Color},function(t){u=t.RedPointType},function(t){f=t.RedPointMgr},function(t){m=t.default},null,function(t){C=t.BaseView},function(t){g=t.default},function(t){v=t.default},function(t){k=t.BagEventDefine},function(t){I=t.BagModel},function(t){S=t.default},function(t){y=t.EquipModel},function(t){b=t.MainViewModel},function(t){L=t.default},function(t){x=t.SkillDataCache},function(t){B=t.SKILLEventDefine},function(t){_=t.SkillModel},function(t){D=t.PanelTabType}],execute:function(){e._RF.push({},"1edb2QTevdGkIlF3hJz4wI0","SkillInfoView",void 0);n.Vec3;var w=n.Vec2;t("default",function(t){function e(){var i;return(i=t.call(this)||this).imgFrame=void 0,i.imgIcon=void 0,i.txtName=void 0,i.txtLevel=void 0,i.pbNum=void 0,i.txtNum=void 0,i.txtQuality=void 0,i.txtDesc=void 0,i.txtCD=void 0,i.txtSkillHaveDesc=void 0,i.oprate=void 0,i.btnWear=void 0,i.btnUpgrade=void 0,i.btnCompose=void 0,i.btnRemove=void 0,i.btnGoTo=void 0,i.imgBtnUpgrade=void 0,i.outLineBtnUpgrade=void 0,i.imgBtnCompose=void 0,i.outLineBtnCompose=void 0,i.skillId=void 0,i.skillCfg=void 0,i.curSkillInfo=void 0,i.isOther=!1,i.nodeActivity=void 0,i.nodeMax=void 0,i.name="SkillInfoView",i.url="ui/module/skill/SkillInfoView",i}i(e,t);var n=e.prototype;return n.onInit=function(){var t=this,i=this.findChild("imgMask");this.addComponentCallbackListener(i,o.EventType.CLICK,(function(){t.onMaskClick()})),this.imgFrame=this.findChildComponent("content/top/imgFrame",s),this.imgIcon=this.findChildComponent("content/top/imgIcon",s),this.txtName=this.findChildComponent("content/top/name/txtName",l),this.nodeActivity=this.findChild("content/top/name/imgActivity"),this.txtLevel=this.findChildComponent("content/top/level/txtLevel",l),this.pbNum=this.findChildComponent("content/top/level/pbNum",a),this.txtNum=this.findChildComponent("content/top/level/txtNum",l),this.txtQuality=this.findChildComponent("content/top/txtQuality",l),this.txtDesc=this.findChildComponent("content/attr/desc/view/content/txtDesc",l);var e=this.findChildComponent("content/attr/desc/view/content",h);this.addComponentCallbackListener(this.txtDesc.node,d.EventType.SIZE_CHANGED,(function(){e.height=t.txtDesc.node.getComponent(h).height})),this.txtCD=this.findChildComponent("content/attr/txtCD",l),this.txtSkillHaveDesc=this.findChildComponent("content/attr/attrHave/txtDesc",l),this.oprate=this.findChild("content/oprate"),this.btnWear=this.findChild("content/oprate/btnWear"),this.addComponentCallbackListener(this.btnWear,o.EventType.CLICK,(function(){t.onWearClick()})),this.btnUpgrade=this.findChild("content/oprate/btnUpgrade"),this.addComponentCallbackListener(this.btnUpgrade,o.EventType.CLICK,(function(){t.onUpgradeClick()})),this.addRedPoint("SkillInfoView/btnUpgrade",this.btnUpgrade,new w(90,25),u.Dot),this.imgBtnUpgrade=this.btnUpgrade.getComponent(s),this.outLineBtnUpgrade=this.findChildComponent("content/oprate/btnUpgrade/Label",c),this.btnRemove=this.findChild("content/oprate/btnRemove"),this.addComponentCallbackListener(this.btnRemove,o.EventType.CLICK,(function(){t.onRemoveClick()})),this.btnGoTo=this.findChild("content/oprate/btnGoTo"),this.addComponentCallbackListener(this.btnGoTo,o.EventType.CLICK,(function(){t.onGoToClick()})),this.nodeMax=this.findChild("content/top/max"),this.btnCompose=this.findChild("content/oprate/btnCompose"),this.addComponentCallbackListener(this.btnCompose,o.EventType.CLICK,(function(){t.onComposeClick()})),this.imgBtnCompose=this.btnCompose.getComponent(s),this.outLineBtnCompose=this.findChildComponent("content/oprate/btnCompose/Label",c),this.addRedPoint("SkillInfoView/btnCompose",this.btnCompose,new w(90,25),u.Dot)},n.registerUpdateHandler=function(){this.addEvent(B.SYSTEM_SKILL_INFO_UPDATE,this.onSystemSkillInfoUpdate,this),this.addEvent(k.GOODS_LIST_UPDATE,this.onGoodsListUpdate,this)},n.onAfterOpen=function(){"number"==typeof this.openArgs[0]?(this.skillId=this.openArgs[0],this.curSkillInfo=null,this.isOther=!1):(this.curSkillInfo=this.openArgs[0],this.skillId=this.curSkillInfo.skill_id,this.isOther=!0),this.skillCfg=configSkill.getDataByKey(this.skillId),this.pbNum.node.active=!this.isOther,this.txtNum.node.active=!this.isOther;var t=1==this.openArgs[1];this.oprate.active=!t,this.showBaseInfo(),this.updateSkillInfo(),this.updateRedPoint()},n.updateRedPoint=function(){IS(f).changeValue("SkillInfoView/btnCompose",IS(x).getSkillComposeRedPoint(this.skillId)),IS(f).changeValue("SkillInfoView/btnUpgrade",IS(x).getSkillUpgradeRedPoint(this.skillId))},n.showBaseInfo=function(){this.loadIcon(this.imgFrame,"icon_skill",r.formatStr("common_ICON_jinengkuang0%s",this.skillCfg.quality)),this.loadIcon(this.imgIcon,"icon_skill",this.skillCfg.icon),this.txtName.string=this.skillCfg.name,this.nodeActivity.active=1==this.skillCfg.if_activity;var t=IS(y).getEquipQualityNameAndColor(this.skillCfg.quality);this.txtQuality.string=t.nameStr,this.txtQuality.color=t.nameColor,this.txtCD.string=String(Math.ceil(this.skillCfg.maxPower/this.skillCfg.powerRecovery))},n.updateSkillInfo=function(){var t=this.isOther?this.curSkillInfo:IS(_).getSystemSkillInfoBySkillId(this.skillId),i=g.isEmpty(t)||!1;this.btnGoTo.active=i&&1!=this.skillCfg.if_activity||!1,this.btnUpgrade.active=0==i||!1;var e=i?1:t.skill_lv;this.txtLevel.string=i?GetLanguage(200485):r.formatStr("Lv.%s",e);var n=configSkill_level.getDataByKeys("id",this.skillId,"level",e);this.txtDesc.string=m.formatStr.apply(m,[n.desc].concat(n.desc_parm)),this.txtSkillHaveDesc.string=m.formatStr.apply(m,[n.ownDesc].concat(n.ownDesc_parm)),this.isOther?(this.btnWear.active=!1,this.btnRemove.active=!1):(this.btnWear.active=0==i&&0==IS(_).getSkillWearPos(this.skillId)||!1,this.btnRemove.active=0==i&&0!=IS(_).getSkillWearPos(this.skillId)||!1);var o=i?e:e+1,s=configSkill_level.getDataByKeys("id",this.skillId,"level",o),l=g.isEmpty(s)||!1;if(this.nodeMax.active=l,this.txtLevel.node.active=!l,this.btnUpgrade.active=0==i&&!l||!1,this.btnCompose.active=0==i&&l||!1,!this.isOther){var a,h=(l?n:s).expend[0],d=IS(I).getGoodsCountByGoodsGtid(h[0]),c=configMix.getDataByKey(h[0]);if(l){var u=null==c||null==c.cost||0==c.cost;u?(a=0,this.pbNum.progress=1):(a=c.cost,this.pbNum.progress=Math.min(1,d/a));var f=u||d<c.cost||!IS(_).checkHasSkillByQuality(c.quality+1);this.loadIcon(this.imgBtnCompose,"common",f?"common_ICON_zhihuianniu":"common_ICON_luanniu"),this.outLineBtnCompose.color=f?new p(76,76,76):new p(41,65,21)}else{var C=d<(a=h[1]);this.loadIcon(this.imgBtnUpgrade,"common",C?"common_ICON_zhihuianniu":"common_ICON_luanniu"),this.outLineBtnUpgrade.color=C?new p(76,76,76):new p(41,65,21),this.pbNum.progress=Math.min(1,d/a)}this.txtNum.string=r.formatStr("%s/%s",d,a)}},n.onBeforeClose=function(){},n.onDestroy=function(){},n.onSystemSkillInfoUpdate=function(t){this.isOther||t==this.skillId&&(this.updateSkillInfo(),this.updateRedPoint())},n.onGoodsListUpdate=function(){this.updateSkillInfo(),this.updateRedPoint()},n.onWearClick=function(){var t=IS(_).getEmptyPos();if(null!=t)return IS(L).reqWearSkill([{k:t,v:this.skillId}]),void this.close();normalEvent.emit(B.SKILL_INFO_VIEW_SELECT_WEAR,this.skillId),this.close()},n.onUpgradeClick=function(){var t=IS(_).getSystemSkillInfoBySkillId(this.skillId).skill_lv+1,i=configSkill_level.getDataByKeys("id",this.skillId,"level",t);if(g.isEmpty(i))S.showFlyTip(GetLanguage(200604));else{var e=i.expend[0];IS(I).getGoodsCountByGoodsGtid(e[0])<e[1]?S.showFlyTip(GetLanguage(200487)):IS(L).reqSkillLv([this.skillId])}},n.onRemoveClick=function(){var t=IS(_).getSkillWearPos(this.skillId);IS(L).reqWearSkill([{k:t,v:0}]),this.close()},n.onGoToClick=function(){IS(b).TryJumpToMainViewPanel(D.Main_Shop,D.Shop_Draw)&&this.close()},n.onMaskClick=function(){this.close()},n.onComposeClick=function(){var t=this.isOther?this.curSkillInfo:IS(_).getSystemSkillInfoBySkillId(this.skillId),i=g.isEmpty(t)||!1?1:t.skill_lv,e=configSkill_level.getDataByKeys("id",this.skillId,"level",i).expend[0],n=configMix.getDataByKey(e[0]);if(null!=n&&null!=n.cost&&0!=n.cost)if(IS(_).checkHasSkillByQuality(n.quality+1)){var o=n.cost,s=Math.floor(IS(I).getGoodsCountByGoodsGtid(e[0])/o);s<=0?S.showFlyTip(GetLanguage(200487)):IS(v).reqGoodsComposeSkillPet(0,0,[{k:e[0],v:s}])}else S.showFlyTip(GetLanguage(201105));else S.showFlyTip(GetLanguage(201103))},e}(C));e._RF.pop()}}}));

