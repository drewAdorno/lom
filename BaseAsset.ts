System.register("chunks:///_virtual/BaseAsset.ts",["./rollupPluginModLoBabelHelpers.js","cc","./V2.ts","./AssetPool.ts"],(function(t){"use strict";var e,i,s,n,a,o,l;return{setters:[function(t){e=t.createClass},function(t){i=t.cclegacy,s=t.Prefab,n=t.isValid,a=t.Layers},function(t){o=t.V2},function(t){l=t.AssetPoolState}],execute:function(){var h,r;t("LoadState",void 0),i._RF.push({},"869b5dd2cJFwrx+1sX8zf2A","BaseAsset",void 0),function(t){t[t.Not=0]="Not",t[t.Ready=1]="Ready",t[t.Loading=2]="Loading",t[t.Finish=3]="Finish"}(h||(h=t("LoadState",{}))),function(t){t[t.Not=0]="Not",t[t.Scale=1]="Scale",t[t.Visible=2]="Visible",t[t.Dir=4]="Dir",t[t.SetParent=8]="SetParent",t[t.SetPos=16]="SetPos",t[t.SetLayer=32]="SetLayer",t[t.LoadModel=64]="LoadModel",t[t.All=16777215]="All"}(r||(r={}));t("BaseAsset",function(){function t(){this.poolState=void 0,this.freeTime=void 0,this.url=void 0,this.pool=void 0,this.isUI=!1,this._pos=new o,this._scale=1,this._dir=1,this._visible=!0,this._layer=a.Enum.DEFAULT,this._node=void 0,this._parentObj=void 0,this._loadState=h.Not,this._changeValue=r.Not,this._loadCb=void 0}var i=t.prototype;return i.loadSync=function(){return!(this.poolState>l.Useing)&&(null!=this.url&&(this._loadState==h.Not&&(this._loadState=h.Ready,this.resLoad(),!0)))},i.resLoad=function(){var t=this;this._loadState==h.Ready&&(this._loadState=h.Loading,this._loadCb=function(e){t.onModelLoaded(e)},resourceMgr.loadRes(this.url,s,this._loadCb))},i.onModelLoaded=function(t){if(this._loadState=h.Finish,this._loadCb=null,null!=t.item&&null!=t.item.asset){var e=t.item.asset;if(null!=e){var i=nodeInstantiate.instantiate(e);this._node=i,this.onLoadComplete(),this._changeValue=r.All,this.apply(0)}else printLogErr("预制为空，路径：",this.url)}else printLogErr("预制加载错误:",this.url)},i.onLoadComplete=function(){},i.destroy=function(){this.poolState!=l.Destroy&&(this.poolState=l.Destroy,this._loadState!=h.Finish?this._loadState==h.Loading&&resourceMgr.cancelLoadRes(this.url,this._loadCb):(this._loadState==h.Finish&&resourceMgr.releaseResRef(this.url),this._loadState=h.Ready),this._loadCb=null,this._parentObj=null,n(this._node)&&(this._node.destroy(),this._node=null),this.url=null)},i.free=function(){this.poolState==l.Useing&&this.pool.free(this)},i.cacheUse=function(){n(this._node)&&(this._node.active=this._visible,this._node.angle=0,this._node.setScale(this._scale,this._scale,this._scale)),this.isUI?uiMgr.addRender(this):battleMain.renderMgr.addRender(this)},i.cacheReset=function(){this._dir=1,this._scale=1,!this.isUI&&n(this.node)&&(this._node.active=!1)},i.onAfterCacheFree=function(){this._loadState!=h.Finish&&(this._loadState==h.Loading&&resourceMgr.cancelLoadRes(this.url,this._loadCb),this._loadCb=null,this._parentObj=null,this._loadState=h.Not),this.isUI&&n(this._node)&&(this._parentObj=null,this.node.removeFromParent())},i.onApply=function(t){},i.apply=function(t){if(!(this.poolState>l.Useing)&&n(this._node)){var e=this._changeValue;e!=r.Not&&(0!=(e&r.SetParent)&&this.apllyParent(),0!=(e&r.SetLayer)&&this.apllyChildrenLayer(this.node),0==(this._changeValue&r.Scale)&&0==(this._changeValue&r.Dir)||this._node.setScale(this._dir*this._scale,this._scale,this._scale),0!=(e&r.SetPos)&&this._node.setPosition(this._pos.x,this._pos.y),0!=(e&r.Visible)&&(this._node.active=this._visible),this.onApply(t),this._changeValue=r.Not)}},i.onUpdate=function(t){this.apply(t)},i.apllyParent=function(){n(this._parentObj)&&(this._node.parent=this._parentObj)},i.apllyChildrenLayer=function(t){if(t.layer!=this._layer){t.layer=this._layer;for(var e=t.children,i=e.length,s=0;s<i;++s)this.apllyChildrenLayer(e[s])}},e(t,[{key:"parent",get:function(){return this._parentObj},set:function(t){null!=t&&this._parentObj!=t&&(this._parentObj=t,this._changeValue=this._changeValue|r.SetParent)}},{key:"position",get:function(){return this._pos},set:function(t){this._pos!=t&&(this._pos.set(t),this._changeValue=this._changeValue|r.SetPos)}},{key:"node",get:function(){return this._node}},{key:"scale",get:function(){return this._scale},set:function(t){this._scale!=t&&(this._scale=t,this._changeValue=this._changeValue|r.Scale)}},{key:"dir",get:function(){return this._dir},set:function(t){this._dir!=t&&(this._dir=t,this._changeValue=this._changeValue|r.Dir)}},{key:"visible",get:function(){return this._visible},set:function(t){this._visible!=t&&(this._visible=t,this._changeValue=this._changeValue|r.Visible)}},{key:"layer",get:function(){return this._layer},set:function(t){this._layer!=t&&(this._layer=t,this._changeValue=this._changeValue|r.SetLayer)}},{key:"isDestroy",get:function(){return this.poolState>l.Useing}}]),t}());i._RF.pop()}}}));

