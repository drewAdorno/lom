System.register("chunks:///_virtual/ActivityLoopyCardView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./RedPoint.ts","./RedPointMgr.ts","./NodeUtil.ts","./TimeUtil.ts","./index57.ts","./ConfigGlobal.ts","./BagDefine.ts","./BagModel.ts","./FriendControl.ts","./ActivityControl.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./ActivityLoopyDefine.ts","./BaseView.ts"],(function(t){"use strict";var i,e,a,n,o,s,d,r,c,h,l,f,v,m,u,C,p,w,g,I,y,T,k,L,S,_,R;return{setters:[function(t){i=t.inheritsLoose},function(t){e=t.cclegacy,a=t.Button,n=t.Label,o=t.Vec2,s=t.RichText,d=t.Sprite,r=t.ScrollView},function(t){c=t.ItemGrid},function(t){h=t.ListItem},function(t){l=t.RedPointType},function(t){f=t.RedPointMgr},function(t){v=t.default},function(t){m=t.default},null,function(t){u=t.ConfigGlobal},function(t){C=t.BagEventDefine},function(t){p=t.BagModel},function(t){w=t.default},function(t){g=t.default},function(t){I=t.default},function(t){y=t.ActivityType,T=t.ActivityState,k=t.ActivityEventDefine,L=t.ActivityTaskState},function(t){S=t.CardItemList,_=t.CardItemIcon},function(t){R=t.BaseView}],execute:function(){e._RF.push({},"b0816NlMXRLtrmo1XS239/q","ActivityLoopyCardView",void 0);t("default",function(t){function e(){var i;return(i=t.call(this)||this).txtTips=void 0,i.giftImg=void 0,i.giftSelect=void 0,i.rewardNode=void 0,i.itemGrid=void 0,i.cardProgressImg=void 0,i.cardProgressNum=void 0,i.cardItemList=[],i.taskTitle=void 0,i.taskRewardList=void 0,i.taskRewardBtn=void 0,i.taskReward=void 0,i.taskValueNode=void 0,i.taskValue=void 0,i.showTaskItem=void 0,i.timeNode=void 0,i.txtLeftTime=void 0,i.deltaTime=0,i.leftTime=0,i.canUpdate=!1,i.name="ActivityLoopyCardView",i.url="ui/module/activityLoopy/ActivityLoopyCardView",i}i(e,t);var h=e.prototype;return h.onInit=function(){var t=this,i=this.findChild("btnClose");this.addComponentCallbackListener(i,a.EventType.CLICK,(function(){t.close()})),this.timeNode=this.findChild("view/nodeTime"),this.txtLeftTime=this.findChildComponent("view/nodeTime/txtTime",n);var e=this.findChild("view/btnSend");this.addComponentCallbackListener(e,a.EventType.CLICK,(function(){uiMgr.openView("ActivityLoopyCardMsgView")})),this.addRedPoint("ActivityLoopyCardMsgCheck",e,new o(30,33),l.Dot,1),IS(f).updateRed("ActivityLoopyCardMsgCheck");var h=this.findChild("view/haveTip/btn");this.addComponentCallbackListener(h,a.EventType.CLICK,(function(){IS(I).ShowSysTips(y.LoopyCard)})),this.txtTips=this.findChildComponent("view/tips/Label",s),this.txtTips.onclicked=function(t,i){var e=IS(I).getCollectShowInfo(y.LoopyCard);if(e&&e.luck.length>0){var a=e.luck[0];IS(w).reqOtherRoleNotice(a.role_id)}},this.giftImg=this.findChildComponent("view/card/giftImg",d),this.giftSelect=this.findChild("view/card/giftImg/select"),this.addComponentCallbackListener(this.giftImg.node,a.EventType.CLICK,(function(){uiMgr.openView("ActivityLoopyCardPreView")})),this.rewardNode=this.findChild("view/card/reward"),this.itemGrid=new c(this,this.findChild("view/card/reward/itemGrid")),this.cardProgressImg=this.findChildComponent("view/card/cardProgress",d),this.cardProgressNum=this.findChildComponent("view/card/cardProgress/value",n);var v=this.findChild("view/card/cardProgress");this.addComponentCallbackListener(v,a.EventType.CLICK,(function(){var t=u.collect_five_blessing_goods.find((function(t){return t[0]==y.LoopyCard}))[1];if(IS(p).getGoodsCountByGoodsGtid(t)>0){var i=IS(I).GetActivityInfo(y.LoopyCard),e=IS(I).getCollectShowInfo(y.LoopyCard);i&&i.state==T.EndShow&&(e&&0!=e.reward_list.length||IS(g).send_collect_get_reward(y.LoopyCard))}}));for(var m=function(i){var e=t.findChildComponent("view/card/card"+(i+1)+"/icon",d);t.loadIcon(e,"act_loopy_card",_[S[i]]);var o={id:S[i],normalBg:t.findChild("view/card/card"+(i+1)+"/normalBg"),lightBg:t.findChild("view/card/card"+(i+1)+"/lightBg"),mask:t.findChild("view/card/card"+(i+1)+"/mask"),num:t.findChildComponent("view/card/card"+(i+1)+"/value",n)};t.addComponentCallbackListener(t.findChild("view/card/card"+(i+1)),a.EventType.CLICK,(function(){uiMgr.openView("ActivityLoopyCardOperateView",S[i])})),t.cardItemList.push(o)},C=0;C<S.length;C++)m(C);this.taskTitle=this.findChildComponent("view/cardReward/title",n),this.taskRewardBtn=this.findChild("view/cardReward/btnGreen"),this.addComponentCallbackListener(this.taskRewardBtn,a.EventType.CLICK,(function(){IS(g).send_24_15(y.LoopyCard,t.showTaskItem.task_id,t.showTaskItem.group_id)})),this.taskReward=this.findChild("view/cardReward/isReward"),this.taskRewardList=this.addUIList(this.findChildComponent("view/cardReward/rewardScroll",r),G,!1),this.taskValueNode=this.findChild("view/cardReward/value"),this.taskValue=this.findChildComponent("view/cardReward/value/value",n)},h.registerUpdateHandler=function(){this.addEvent(C.GOODS_INFO_UPDATE,this.updateInfo,this),this.addEvent(k.OnActivityInfoUpdate,this.updateTask,this),this.addEvent(k.OnActivityInfoTaskUpdate,this.updateTask,this),this.addEvent(k.OnActivityCollectInfo,this.updateInfo,this)},h.onAfterOpen=function(){var t=IS(I).GetActivityInfo(y.LoopyCard);if(t.state==T.Open){var i=t.state_time[T.Open];this.leftTime=i.end_time-m.serverTime,this.leftTime>0?(this.canUpdate=!0,this.txtLeftTime.string=m.formatTimeStringForSecond(this.leftTime),this.timeNode.active=!0):this.timeNode.active=!1}else this.canUpdate=!1,this.timeNode.active=!1;IS(g).send_24_14(y.LoopyCard),IS(g).send_collect_show(y.LoopyCard),IS(g).send_collect_info(y.LoopyCard),this.updateInfo()},h.onBeforeClose=function(){},h.onDestroy=function(){},h.onUpdate=function(t){this.canUpdate&&(this.deltaTime=this.deltaTime+t,this.deltaTime>=1&&(this.deltaTime=0,this.leftTime=this.leftTime-1,this.leftTime>0?this.txtLeftTime.string=m.formatTimeStringForSecond(this.leftTime):(this.timeNode.active=!1,this.canUpdate=!1)))},h.updateInfo=function(){for(var t=0;t<this.cardItemList.length;t++){var i=this.cardItemList[t],e=IS(p).getGoodsCountByGoodsGtid(i.id);i.num.string=e+"/1",e>0?(i.normalBg.active=!1,i.lightBg.active=!0,i.mask.active=!1):(i.normalBg.active=!0,i.lightBg.active=!1,i.mask.active=!0)}},h.updateTask=function(){var t=IS(I).GetActivityInfo(y.LoopyCard);if(t){if(t.state==T.Open){var i=t.state_time[T.Open];this.leftTime=i.end_time-m.serverTime,this.leftTime>0?(this.canUpdate=!0,this.txtLeftTime.string=m.formatTimeStringForSecond(this.leftTime),this.timeNode.active=!0):this.timeNode.active=!1}else this.canUpdate=!1,this.timeNode.active=!1;var e=[];for(var a in t.task_list)e.push(t.task_list[a]);e.sort((function(t,i){return t.task_id<i.task_id?-1:1})),this.showTaskItem=null;for(var n=0;n<e.length;n++)if(e[n].state!=L.HadGet||n==e.length-1){this.showTaskItem=e[n];break}this.showTaskItem&&(this.taskRewardList.datas=this.showTaskItem.cfg.reward,this.taskTitle.string=this.showTaskItem.cfg.desc,this.taskReward.active=this.showTaskItem.state==L.HadGet,this.showTaskItem.state==L.Normal?(this.taskValueNode.active=!0,this.taskValue.string=this.showTaskItem.count+"/"+this.showTaskItem.cfg.condition[2],this.taskRewardBtn.active=!1):(this.taskValueNode.active=!1,this.taskRewardBtn.active=this.showTaskItem.state==L.CanGet))}},e}(R));var G=function(t){function e(){for(var i,e=arguments.length,a=new Array(e),n=0;n<e;n++)a[n]=arguments[n];return(i=t.call.apply(t,[this].concat(a))||this).itemGridNode=void 0,i.itemGrid=void 0,i}i(e,t);var a=e.prototype;return a.onInit=function(){this.itemGridNode=v.findChild(this.node,"itemGrid"),this.itemGrid=new c(this.view,this.itemGridNode)},a.onRender=function(t,i){this.itemGrid.SetItemId(t[0],t[1])},e}(h);e._RF.pop()}}}));

