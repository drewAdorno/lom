System.register("chunks:///_virtual/MarryFavorDetailView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./RoleDataCache.ts","./MarryControl.ts","./MarryDefine.ts","./MarryDialogDataCache.ts","./BaseView.ts"],(function(t){"use strict";var i,e,r,o,a,s,n,f,l,v,h,d,c,g,u,y,L,_;return{setters:[function(t){i=t.inheritsLoose},function(t){e=t.cclegacy,r=t.Button,o=t.ScrollView,a=t.Label,s=t.RichText,n=t.ProgressBar,f=t.js,l=t.Sprite},function(t){v=t.ListItem},function(t){h=t.default},function(t){d=t.default},function(t){c=t.default},null,function(t){g=t.RoleDataCache},function(t){u=t.default},function(t){y=t.MarryEventDefine},function(t){L=t.default},function(t){_=t.BaseView}],execute:function(){var M;e._RF.push({},"bad35vGaoNH+Y5RZ00RVHmL","MarryFavorDetailView",void 0);var C=((M={})[1]=.18,M[2]=.35,M[3]=.47,M),p=(t("default",function(t){function e(){var i;return(i=t.call(this)||this).attrList=void 0,i.txtFavorTitle=void 0,i.txtTitle=void 0,i.btnLeft=void 0,i.btnRight=void 0,i.giftImg=void 0,i.isMarry=void 0,i.noMarry=void 0,i.favorProgress=void 0,i.txtMarryTime=void 0,i.txtGiftDate=void 0,i.txtMention=void 0,i.player_id=void 0,i.playerInfo=void 0,i.detailInfo=void 0,i.favor_lv=void 0,i.favorcfgs=void 0,i.noMarryLevelList=void 0,i.detail_levelInfo=void 0,i.limitList=void 0,i.allFavorCfgs=void 0,i.choose_lv=void 0,i.name="MarryFavorDetailView",i.url="ui/module/marry/MarryFavorDetailView",i}i(e,t);var v=e.prototype;return v.onInit=function(){var t=this,i=this.findChild("root/btnClose");this.addComponentCallbackListener(i,r.EventType.CLICK,(function(){t.close()})),this.attrList=this.addUIList(this.findChildComponent("root/attrList",o),p),this.txtFavorTitle=this.findChildComponent("root/txtFavorTitle",a),this.txtMarryTime=this.findChildComponent("root/isMarry/txtMarryTime",s),this.txtGiftDate=this.findChildComponent("root/isMarry/txtGiftDate",s),this.txtMention=this.findChildComponent("root/isMarry/txtMention",s),this.txtTitle=this.findChild("root/txtTitle"),this.btnLeft=this.findChild("root/btnLeft"),this.btnRight=this.findChild("root/btnRight"),this.addComponentCallbackListener(this.btnLeft,r.EventType.CLICK,(function(){t.choose_lv!=t.favor_lv&&(t.choose_lv--,t.RefreshData(t.choose_lv))})),this.addComponentCallbackListener(this.btnRight,r.EventType.CLICK,(function(){304!=t.choose_lv&&(t.choose_lv++,t.RefreshData(t.choose_lv))})),this.giftImg=this.findChild("root/isMarry/giftImg"),this.isMarry=this.findChild("root/isMarry"),this.noMarry=this.findChild("root/noMarry"),this.noMarryLevelList=[];for(var e=function(i){t.noMarryLevelList[i]={isDone:h.findChild(t.noMarry,i+"/isDone"),txtTitle:h.findChildComponent(t.noMarry,i+"/txtTitle",a),txtCount:h.findChildComponent(t.noMarry,i+"/txtCount",a),giftLimit:h.findChild(t.noMarry,i+"/gift/limit"),giftLock:h.findChild(t.noMarry,i+"/gift/lock"),giftBtn:h.findChild(t.noMarry,i+"/gift"),giftReceived:h.findChild(t.noMarry,i+"/gift/received")},t.loadIcon(h.findChildComponent(t.noMarry,i+"/gift/received",l),"player","grxx_ui_gouxuan"),t.addComponentCallbackListener(t.noMarryLevelList[i].giftBtn,r.EventType.CLICK,(function(){t.noMarryLevelList[i].giftLock.active||t.noMarryLevelList[i].giftLimit.active||t.noMarryLevelList[i].giftReceived.active?t.favorcfgs&&t.favorcfgs[i]&&uiMgr.openView("RewardPreview",{title:GetLanguage(200151),rewardList:t.favorcfgs[i].reward}):t.getReward(i)}))},f=1;f<4;f++)e(f);this.favorProgress=this.findChildComponent("root/noMarry/ProgressBar",n)},v.getReward=function(t){this.player_id&&this.favorcfgs&&this.favorcfgs[t]&&IS(u).send_favor_reward_fetch_c2s(this.player_id,this.favorcfgs[t].level)},v.registerUpdateHandler=function(){this.addEvent(y.MARRY_FAVOR_FRIEND_INFO_DETAIL_UPDATE,this.updateFriendInfo,this),this.addEvent(y.MARRY_FAVOR_MARK_INFO_UPDATE,this.updateMarryMarkInfo,this)},v.onAfterOpen=function(){this.favor_lv=0,this.player_id=this.openArgs[0],this.playerInfo=this.openArgs[1],this.player_id&&IS(u).send_favor_reward_info_c2s(this.player_id)},v.updateFriendInfo=function(t){for(var i in this.detailInfo=t,this.detail_levelInfo=[],t.list)if(t.list.hasOwnProperty(i)){var e=t.list[i];this.detail_levelInfo[e.k]=e.v}for(var r in this.limitList=[],t.reward_times)if(t.reward_times.hasOwnProperty(r)){var o=t.reward_times[r];this.limitList[o.k]=o.v}this.favor_lv=this.playerInfo.favor_lv,this.allFavorCfgs=configFavorability_level.getDatas(),this.choose_lv=this.favor_lv,this.RefreshData(this.choose_lv)},v.RefreshData=function(t){var i=configFavorability_level.getDataByKey(t),e=IS(L).GetLoverGender(),r=IS(g).GetGender();if(this.noMarry.active=i.level_group<3,this.isMarry.active=3==i.level_group,this.btnLeft.active=3==i.level_group&&t!=this.favor_lv,this.btnRight.active=3==i.level_group&&304!=t,this.txtFavorTitle.string=r!=e?GetLanguage(i.desc1[0]):2==r?GetLanguage(i.desc1[2]):GetLanguage(i.desc1[1]),i&&i.buff_desc&&(this.attrList.datas=i.buff_desc),i.level_group<3){this.favorcfgs=[];for(var o=0;o<this.allFavorCfgs.length;o++)this.allFavorCfgs[o].level_group==i.level_group&&this.favorcfgs.push(this.allFavorCfgs[o]);for(var a=1;a<4;a++){this.noMarryLevelList[a].txtCount.string=this.favorcfgs[a].favorability;var s=void 0;s=r!=e?this.favorcfgs[a].desc[0]:2==r?this.favorcfgs[a].desc[2]:this.favorcfgs[a].desc[1],this.noMarryLevelList[a].txtTitle.string=GetLanguage(s),null!=this.detail_levelInfo[this.favorcfgs[a].level]?0==this.detail_levelInfo[this.favorcfgs[a].level]?(this.noMarryLevelList[a].giftReceived.active=!1,this.noMarryLevelList[a].giftLock.active=this.playerInfo.favor<this.favorcfgs[a].favorability,this.noMarryLevelList[a].giftLimit.active=null!=this.limitList[this.favorcfgs[a].level]&&0==this.limitList[this.favorcfgs[a].level]):1==this.detail_levelInfo[this.favorcfgs[a].level]?(this.noMarryLevelList[a].giftReceived.active=!0,this.noMarryLevelList[a].giftLock.active=!1,this.noMarryLevelList[a].giftLimit.active=!1):(this.noMarryLevelList[a].giftReceived.active=!1,this.noMarryLevelList[a].giftLock.active=!1,this.noMarryLevelList[a].giftLimit.active=!1):(this.noMarryLevelList[a].giftReceived.active=!1,this.noMarryLevelList[a].giftLock.active=!0,this.noMarryLevelList[a].giftLimit.active=!1)}for(var n=this.playerInfo.favor,f=0,l=1;l<4;l++){if(!(this.favorcfgs[l]&&n>this.favorcfgs[l].favorability)){var v=this.favorcfgs[l-1]?this.favorcfgs[l-1].favorability:0;f+=(n-v)/(this.favorcfgs[l].favorability-v)*C[l];break}f+=C[l]}this.favorProgress.progress=Math.min(1,f)}else 3==i.level_group&&(this.txtMarryTime.node.active=t==this.favor_lv,this.txtGiftDate.node.active=t==this.favor_lv,this.giftImg.active=t==this.favor_lv,this.txtTitle.active=t==this.favor_lv,this.txtMention.node.active=t!=this.favor_lv,t==this.favor_lv?(this.txtFavorTitle.node.setPosition(0,150),IS(u).send_marry_mark_info_c2s()):(this.txtFavorTitle.node.setPosition(0,180),this.txtMention.string=d.formatStr(GetLanguage(204616),i.favorability)))},v.updateMarryMarkInfo=function(t){var i=c.ServerDate(1e3*t.start_time);this.txtMarryTime.string=d.formatStr(GetLanguage(204400),f.formatStr("%s/%s/%s",i.getFullYear(),i.getMonth()+1,i.getDate()));var e=t.next_reward_time-c.serverTime,r=Math.ceil(e/86400);this.txtGiftDate.string=d.formatStr(GetLanguage(204401),r)},v.onBeforeClose=function(){var t=uiMgr.getOpenView("MarryFavorView");t&&t.refreshView()},v.onDestroy=function(){},e}(_)),function(t){function e(){for(var i,e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];return(i=t.call.apply(t,[this].concat(r))||this).txtContent=void 0,i.txtCount=void 0,i}i(e,t);var r=e.prototype;return r.onInit=function(){this.txtContent=h.findChildComponent(this.node,"txtContent",a),this.txtCount=h.findChildComponent(this.node,"txtCount",a)},r.onRender=function(t,i){var e=configFavorability_level.getDataByKey(this.view.choose_lv);e.buff&&e.buff[i]&&(this.txtContent.string=GetLanguage(t),this.txtCount.string=d.formatStr("+##1%",e.buff[i][1]/100))},e}(v));e._RF.pop()}}}));

