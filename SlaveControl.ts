System.register("chunks:///_virtual/SlaveControl.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BattleData.ts","./EnumDefine.ts","./index57.ts","./BattleMainServer.ts","./ChapterControl.ts","./ChapterDataCache.ts","./ChapterDefine.ts","./MessageView.ts","./MainViewModel.ts","./PvpControl.ts","./PvpDataCache.ts","./RoleDataCache.ts","./RoleDefine.ts","./SlaveDataCache.ts","./SlaveDefine.ts","./UIDefine.ts"],(function(e){"use strict";var a,t,r,n,s,_,l,i,c,o,u,v,p,d,f,S,h,E,L,y,I;return{setters:[function(e){a=e.createForOfIteratorHelperLoose},function(e){t=e.cclegacy},function(e){r=e.ChapterType,n=e.PlayerData,s=e.BattleData},function(e){_=e.RunMode,l=e.RunState,i=e.RecordSource},null,function(e){c=e.BattleMainServer},function(e){o=e.default},function(e){u=e.ChapterDataCache},function(e){v=e.ChapterEventDefine},function(e){p=e.default},function(e){d=e.MainViewModel},function(e){f=e.default},function(e){S=e.PvpDataCache},function(e){h=e.RoleDataCache},function(e){E=e.PlayerAttr},function(e){L=e.SlaveDataCache},function(e){y=e.SlaveEventDefine},function(e){I=e.PanelTabType}],execute:function(){t._RF.push({},"d6434PmCfRPs5nKm9YbGeWt","SlaveControl",void 0);var m=[];e("default",function(){var e=t.prototype;function t(){netManager.addEventListener("capture_slave.capture_slave_info_s2c",this.on_capture_slave_info_s2c,this),netManager.addEventListener("capture_slave.capture_slave_search_s2c",this.on_capture_slave_search_s2c,this),netManager.addEventListener("capture_slave.capture_slave_video_s2c",this.on_capture_slave_video_s2c,this),netManager.addEventListener("capture_slave.capture_slave_reward_s2c",this.on_capture_slave_reward_s2c,this),netManager.addEventListener("capture_slave.capture_slave_free_s2c",this.on_capture_slave_free_s2c,this),netManager.addEventListener("capture_slave.capture_slave_combat_s2c",this.on_capture_slave_combat_s2c,this),netManager.addEventListener("capture_slave.capture_slave_result_s2c",this.on_capture_slave_result_s2c,this),netManager.addEventListener("capture_slave.capture_slave_reward_get_s2c",this.on_capture_slave_reward_get_s2c,this),netManager.addEventListener("capture_slave.capture_slave_effect_s2c",this.on_capture_slave_effect_s2c,this),netManager.addEventListener("capture_slave.capture_slave_rename_s2c",this.on_capture_slave_rename_s2c,this),netManager.addEventListener("capture_slave.capture_slave_video_play_s2c",this.on_capture_slave_video_play_s2c,this),netManager.addEventListener("capture_slave.capture_slave_refresh_s2c",this.on_capture_slave_refresh_s2c,this),netManager.addEventListener("capture_slave.capture_slave_look_s2c",this.on_capture_slave_look_s2c,this),normalEvent.on(v.CHAPTER_BATTLE_RESUTL,this.onPvpOrRecordVideoEnd,this)}return e.clear=function(){console.log("清理SlaveControl")},e.onPvpOrRecordVideoEnd=function(e,t,n,s,l,i){if(t==r.Slave){if(m.length>0){IS(d).TryJumpToMainViewPanel(I.Main_Mystery);for(var c,o=a(m);!(c=o()).done;){var u,v=c.value,p=v[0],f=v[1];(u=uiMgr).openView.apply(u,[p].concat(f))}m=[]}s!=_.Record&&uiMgr.openView("FarmPvpResultView",t)}},e.reqCaptureSlaveInfo=function(e){null==e&&(e=0),netManager.send("capture_slave.capture_slave_info_c2s",{role_id:e})},e.on_capture_slave_info_s2c=function(e){e.role_info.role_id==IS(h).GetRoleId()&&(IS(L).selfRoleInfo=e.role_info,IS(L).masterInfo=e.master_info,IS(L).slavesInfo=e.slaves_info),normalEvent.emit(y.SLAVE_INFO_BACK,e.role_info.role_id,e)},e.reqCaptureSlaveSearch=function(e){netManager.send("capture_slave.capture_slave_search_c2s",{type:e})},e.on_capture_slave_search_s2c=function(e){normalEvent.emit(y.SLAVE_SEARCH_INFO_BACK,e)},e.reqCaptureSlaveVideo=function(){netManager.send("capture_slave.capture_slave_video_c2s",{})},e.on_capture_slave_video_s2c=function(e){normalEvent.emit(y.SLAVE_VIDEO_BACK,e)},e.reqCaptureSlaveReward=function(e){netManager.send("capture_slave.capture_slave_reward_c2s",{type:e})},e.on_capture_slave_reward_s2c=function(e){0==e.type?(IS(L).outLineSumSecond=e.sum_second,IS(L).outLineReward=e.reward_list):1==e.type&&(IS(L).onLineSumSecond=e.sum_second,IS(L).onLineReward=e.reward_list),IS(L).tryRefreshTimer(),IS(L).updateSlaveRedpoint(),normalEvent.emit(y.SLAVE_REWARD_INFO_BACK,e)},e.reqCaptureSlaveFree=function(e){netManager.send("capture_slave.capture_slave_free_c2s",{role_id:e})},e.on_capture_slave_free_s2c=function(e){if(0==e.code){var a=e.role_id;if(null!=IS(L).slavesInfo){for(var t,r=0;r<IS(L).slavesInfo.length;r++)if(IS(L).slavesInfo[r].role_id==a){t=r;break}null!=t&&IS(L).slavesInfo.splice(t,1)}p.showFlyTip(GetLanguage(201792)),normalEvent.emit(y.SLAVE_INFO_UPDATE)}},e.reqCaptureSlaveCombat=function(e,a){var t=IS(u);0==t.currentLoadType&&(t.chapterType=r.Slave,t.currentLoadType=t.chapterType,t.battleData=null,m=[],1==e&&m.push(["SlaveMainView",[]]),netManager.send("capture_slave.capture_slave_combat_c2s",{type:e,slave_id:a}),battleMain.enterChapter(0),normalEvent.emit(v.BATTLE_STATE,r.Slave,!0))},e.on_capture_slave_combat_s2c=function(e){var a=IS(u);if(a.currentLoadType==r.Slave){if(0!=e.code)return a.currentLoadType=0,m=[],IS(o).reqEnterChapter(0),void normalEvent.emit(v.BATTLE_STATE,r.Slave,!1);a.currentLoadType=0,uiMgr.closeAllView(["MainView","MessageView","GuideView","BattleHubView"]),uiMgr.getOpenView("MainView").setIndex(0);var t=new s;t.chapterId=250001,t.seed=e.seed,t.chapterType=r.Slave,t.playerList[1]=new n(1),t.playerList[2]=new n(2);var _=IS(h).GetRoleId();IS(f).setPlayerList(e.atk_data,t.playerList[1]),IS(f).setPlayerList(e.def_data,t.playerList[2]);var i=new c(e.seed);for(i.start(t);i.runState==l.Running;)i.update(i.frameTime);this.reqCaptureSlaveResult(0==i.result?e.atk_data.id:e.def_data.id),i.stop();var p=new s;p.chapterType=r.Slave,p.chapterId=250001,p.seed=e.seed,p.playerList[1]=new n(1),p.playerList[2]=new n(2),IS(f).setPlayerList(e.atk_data,p.playerList[1]),IS(f).setPlayerList(e.def_data,p.playerList[2]),p.playerImage=e.atk_data.id!=_,IS(u).battleData=p}},e.reqCaptureSlaveResult=function(e){netManager.send("capture_slave.capture_slave_result_c2s",{win_id:e})},e.on_capture_slave_result_s2c=function(e){var a={isWin:1==e.is_win,objs:[{name:IS(h).GetRoleName(),head:IS(h).GetHeadUrl()},{name:e.e_name,head:null!=e.e_head?e.e_head.url:""}]};IS(S).result=a},e.reqCaptureSlaveRewardGet=function(e){netManager.send("capture_slave.capture_slave_reward_get_c2s",{type:e})},e.on_capture_slave_reward_get_s2c=function(e){uiMgr.openView("GoodsGetView",e.reward_list),this.reqCaptureSlaveReward(e.type)},e.reqCaptureSlaveEffect=function(e,a){netManager.send("capture_slave.capture_slave_effect_c2s",{action_id:e,target_id:a})},e.on_capture_slave_effect_s2c=function(e){0==e.code&&normalEvent.emit(y.SLAVE_EFFECT_BACK,e)},e.reqCaptureSlaveRename=function(e,a){netManager.send("capture_slave.capture_slave_rename_c2s",{target_id:e,slave_name:a})},e.on_capture_slave_rename_s2c=function(e){if(0==e.code){var a=e.target_id;if(null!=IS(L).slavesInfo)for(var t=0;t<IS(L).slavesInfo.length;t++){var r=IS(L).slavesInfo[t];if(r.role_id==a){for(var n=r.info_list.ks,s=!1,_=0;_<n.length;_++)if(n[_].k==E.ROLE_ATTR_SLAVE_NAME){n[_].s=e.slave_name,s=!0;break}s||n.push({k:E.ROLE_ATTR_SLAVE_NAME,s:e.slave_name});break}}uiMgr.close("TabRenameView"),p.showFlyTip(GetLanguage(201791)),normalEvent.emit(y.SLAVE_RENAME_SUCCESS,a)}},e.reqCaptureSlaveVideoPlay=function(e,a){var t=IS(u);0==t.currentLoadType&&(t.chapterType=r.Slave,t.currentLoadType=t.chapterType,t.battleData=null,m=[],a==i.default&&(m.push(["SlaveMainView",[]]),m.push(["SlaveLogView",[]])),netManager.send("capture_slave.capture_slave_video_play_c2s",{vid:e,source:a}))},e.on_capture_slave_video_play_s2c=function(e){var a=IS(u);if(a.currentLoadType==r.Slave&&(a.currentLoadType=0,0!=e.vid)){uiMgr.close("ChatView"),battleMain.enterChapter(0);var t=new s;t.chapterId=250001,t.seed=e.seed,t.chapterType=r.Slave,t.recordType=1,t.recordWin=e.winner_id==e.atk_data.id?1:2,t.source=e.source,t.playerList[1]=new n(1),t.playerList[2]=new n(2);var _=IS(h).GetRoleId();_!=e.atk_data.id&&_!=e.def_data.id&&(_=e.atk_data.id),IS(f).setPlayerList(e.atk_data,t.playerList[1]),IS(f).setPlayerList(e.def_data,t.playerList[2]),t.playerImage=e.atk_data.id!=_,a.battleData=t,normalEvent.emit(v.BATTLE_STATE,r.Slave,!0)}},e.reqCaptureSlaveRefresh=function(){netManager.send("capture_slave.capture_slave_refresh_c2s",{})},e.on_capture_slave_refresh_s2c=function(e){normalEvent.emit(y.SLAVE_SEARCH_INFO_REFRESH,e)},e.reqCaptureSalveLook=function(e){netManager.send("capture_slave.capture_slave_look_c2s",{vid_list:e})},e.on_capture_slave_look_s2c=function(e){normalEvent.emit(y.SLAVE_LOG_READ)},t}());t._RF.pop()}}}));

