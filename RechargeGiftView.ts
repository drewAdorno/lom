System.register("chunks:///_virtual/RechargeGiftView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./UIRichText.ts","./NodeUtil.ts","./StorageUtil.ts","./StringUtil.ts","./TimeUtil.ts","./BaseView.ts","./UIDefine.ts","./ConfigGlobal.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./BagDefine.ts","./BattlePassControl.ts","./BattlePassDataCache.ts","./BattlePassDefine.ts","./PayControl.ts","./PayDataCache.ts","./PayDefine.ts","./RoleDataCache.ts","./RoleDefine.ts","./PrivilegeControl.ts","./PrivilegeDataCache.ts","./PrivilegeDefine.ts"],(function(t){"use strict";var i,e,n,o,a,s,r,c,d,h,l,f,u,v,p,g,C,m,I,T,y,E,_,S,D,L,b,P,w,G,x,R,k,B,A,F,U,O,V,N,H,M,X,K;return{setters:[function(t){i=t.inheritsLoose,e=t.createForOfIteratorHelperLoose},function(t){n=t.cclegacy,o=t.Button,a=t.ScrollView,s=t.UITransform,r=t.Vec3,c=t.sys,d=t.Sprite,h=t.Label,l=t.js,f=t.LabelGradient,u=t.LabelOutline,v=t.isValid},function(t){p=t.ItemGrid},function(t){g=t.ListItem},function(t){C=t.UIRichText},function(t){m=t.default},function(t){I=t.default},function(t){T=t.default},function(t){y=t.default},function(t){E=t.BaseView},function(t){_=t.OpenFunction},function(t){S=t.ConfigGlobal},function(t){D=t.default},function(t){L=t.ActivityEventDefine,b=t.ActivityType,P=t.ActivityState},function(t){w=t.BagEventDefine},function(t){G=t.default},function(t){x=t.BattlePassDataCache},function(t){R=t.BattlePassDefine,k=t.BATTLE_PASS_TYPE_DEFINE,B=t.BP_ID_TYPE},function(t){A=t.default},function(t){F=t.default},function(t){U=t.PayEventDefine},function(t){O=t.RoleDataCache},function(t){V=t.RoleEventDefine},function(t){N=t.default},function(t){H=t.PrivilegeDataCache},function(t){M=t.PrivilegeEventDefine,X=t.FundEventDefine,K=t.Privilege}],execute:function(){n._RF.push({},"a2ac6UsXltNUIishyrei7Uq","RechargeGiftView",void 0);var Y=1,q=2,W=3,j=4,z=5,J=6,Q=1,Z=2,$=3,tt=10604,it=(t("default",function(t){function n(){var i;return(i=t.call(this)||this).tabBtns=[],i.curIndex=0,i.itemList=void 0,i.time=0,i.btn=void 0,i.btnRed=void 0,i.nodeEmpty=void 0,i.name="RechargeGiftView",i.url="ui/module/recharge/RechargeGiftView",i}i(n,t);var r=n.prototype;return r.onInit=function(){var t=this,i=this.findChild("root/imgMask");this.addComponentCallbackListener(i,o.EventType.CLICK,(function(){t.onMaskClick()}));var e=this.findChild("root/content/btnClose");this.addComponentCallbackListener(e,o.EventType.CLICK,(function(){t.close()})),this.nodeEmpty=this.findChild("root/content/empty"),this.btn=this.findChild("root/content/btn"),this.btnRed=this.findChild("root/content/btn/red"),this.addComponentCallbackListener(this.btn,o.EventType.CLICK,(function(){var t=IS(F).GetPayGiftInfo(tt),i=!t||2!=t.rewardState;(IS(H).checkAnyPrivilegeCardCanFetch()||i)&&IS(N).reqGetAllReward()}));for(var n=function(i){var e=m.findChild(t.node,l.formatStr("root/content/bottomBtn/item%s",i)),n={itemGo:e,normalGo:m.findChild(e,"normal"),selectedGo:m.findChild(e,"selected"),red:m.findChild(e,"red"),index:i};t.addComponentCallbackListener(e,o.EventType.CLICK,(function(){t.SetIndex(n.index)})),t.tabBtns[i]=n},s=1;s<=3;s++)n(s);var r=this.findChildComponent("root/content/ScrollView",a);this.itemList=this.addUIList(r,it,!0)},r.registerUpdateHandler=function(){this.addEvent(V.ROLE_OPEN_FUNCTION_UPDATE,this.refreshList,this),this.addEvent(R.BATTLE_PASS_INFO_UPDATE,this.refreshList,this),this.addEvent(M.PRIVILEGE_CARD_UPDATE,this.updateList,this),this.addEvent(M.PRIVILEGE_CARD_FETCH,this.updateList,this),this.addEvent(X.FUND_UPDATE_INFO,this.updateList,this),this.addEvent(V.ROLE_INFO_UPDATE,this.updateList,this),this.addEvent(w.GOODS_BOX_UPDATE,this.updateList,this),this.addEvent(M.ROLE_PRIVILEGE_UPDATE,this.updateList,this),this.addEvent(M.ACITVITY_RED_UPDATE,this.updateList,this),this.addEvent(U.PAY_INFO_UPDATE,this.refreshList,this),this.addEvent(L.OnActivityRebateBox,this.refreshList,this)},r.onMaskClick=function(){this.close()},r.onAfterOpen=function(){this.SetIndex(Q)},r.refreshList=function(){var t=[];if(this.itemList.clearData(),this.curIndex==Q){this.nodeEmpty.active=!1;var i=[],e=IS(x).getPassInfoList();for(var n in e)if(e.hasOwnProperty(n)){var o,a,s,r,c=e[n].id;0!=(1==c?null!=(o=null==(a=configBattlepass.getDataByKey(c))?void 0:a.view)?o:0:null!=(s=null==(r=configWartoken.getDataByKey(c))?void 0:r.view)?s:0)&&i.push({type:W,info:e[n]})}i.sort((function(t,i){return t.info.id-i.info.id})),t=t.concat(i);for(var d=configFund.getDatas(),h=0;h<d.length;h++){var l=d[h];l.open_condition&&l.open_condition>0&&!IS(O).CheckFuncOpen(l.open_condition)||t.push({type:q,cfgId:l.id})}}else if(this.curIndex==Z){this.nodeEmpty.active=!1,IS(O).CheckFuncOpen(_.FUNC_MALL)&&t.push({type:j});for(var f=configPrivilege_cardtype.getDatas(),u=0;u<f.length;u++){var v=f[u];v.open_condition&&v.open_condition>0&&!IS(O).CheckFuncOpen(v.open_condition)||t.push({type:Y,cfgId:v.id})}var p=IS(F).GetPayGiftInfo(tt);p&&2==p.rewardState?t.push({type:z}):t.splice(0,0,{type:z})}else if(this.curIndex==$){for(var g=configActicity_sheet.getDatas(),C=[],m=0;m<g.length;m++){var I=g[m];if(1==I.id){if(1==I.open[0]&&!IS(O).CheckFuncOpen(I.open[1]))continue;var T=IS(D).GetActivityInfo(b.PiggyBank);if(!T||T.state==P.Null)continue}if(1!=I.open[0]||IS(O).CheckFuncOpen(I.open[1])){if(2==I.open[0]){var y=IS(D).GetActivityInfo(I.open[1]);if(!y||y.state==P.Null)continue}C.push({type:J,cfgId:I.id,sort:I.view_rank})}}C.sort((function(t,i){return t.sort-i.sort})),this.nodeEmpty.active=C.length<=0,t=t.concat(C)}this.itemList.datas=t,this.updateRed()},r.updateList=function(){this.itemList.updateAll(),this.updateRed()},r.updateRed=function(){var t=G.checkMainRewardRP()+G.checkMainAddRewardRP()+G.checkMainTaskRP();this.tabBtns[Q].red.active=H.checkFund()||t>0;var i=IS(F).GetPayGiftInfo(tt),e=!i||2!=i.rewardState;this.tabBtns[Z].red.active=IS(H).checkAnyPrivilegeCardCanFetch()||e,this.btnRed.active=IS(H).checkAnyPrivilegeCardCanFetch()||e,this.tabBtns[$].red.active=IS(H).checkActivityRed()},r.onBeforeClose=function(){this.curIndex>0&&(this.tabBtns[this.curIndex].normalGo.active=!0,this.tabBtns[this.curIndex].selectedGo.active=!1,this.curIndex=0)},r.onDestroy=function(){},r.onUpdate=function(t){if(this.time=this.time+t,this.time>1){this.time=0;for(var i,n=e(this.itemList.items);!(i=n()).done;){i.value.updateTime()}}},r.SetIndex=function(t){this.curIndex!=t&&(this.curIndex>0&&(this.tabBtns[this.curIndex].selectedGo.active=!1,this.tabBtns[this.curIndex].normalGo.active=!0),this.curIndex=t,this.tabBtns[this.curIndex].normalGo.active=!1,this.tabBtns[this.curIndex].selectedGo.active=!0,this.itemList.node.getComponent(s).height=this.curIndex==Z?580:660,this.btn.active=this.curIndex==Z,this.refreshList())},n}(E)),function(t){function e(){for(var i,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(i=t.call.apply(t,[this].concat(n))||this).state1=void 0,i.state2=void 0,i.bpTitle=void 0,i.pcTitle=void 0,i.acTitle=void 0,i.imgIcon=void 0,i.curType=void 0,i.curCfgId=void 0,i.nodeRemind=void 0,i.state=void 0,i.txtState=void 0,i.mask=void 0,i.btnGet=void 0,i.received=void 0,i.rewardScroll=void 0,i.txtTime=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){var t=this;this.adaptiveSize=!0,this.state1=m.findChild(this.node,"state1"),this.state2=m.findChild(this.node,"state2"),this.bpTitle=m.findChild(this.node,"state1/bpTitle"),this.pcTitle=m.findChild(this.node,"state1/pcTitle"),this.acTitle=m.findChild(this.node,"state1/acTitle"),this.bpTitle.position=new r(c.uiMirror?-31.09:-257.914,-81.566,0),this.pcTitle.position=new r(c.uiMirror?-31.09:-257.914,-81.566,0),this.acTitle.position=new r(c.uiMirror?-31.09:-257.914,-94.087,0),this.imgIcon=m.findChildComponent(this.node,"state1/imgBg",d),this.view.addComponentCallbackListener(this.state1,o.EventType.CLICK,(function(){if(t.curType==Y)uiMgr.openView("PrivilegeCardView",t.curCfgId);else if(t.curType==q)IS(N).reqFundInfo(t.curCfgId),uiMgr.openView("FundView",t.curCfgId);else if(t.curType==W)uiMgr.openView("BattlePassView",t.data.info.id);else if(t.curType==j)uiMgr.openView("PrivilegeADView");else if(t.curType==J){var i=configActicity_sheet.getDataByKey(t.curCfgId);if(1==t.curCfgId){var e="PiggyBankRed"+IS(O).GetRoleId();I.set(e,"2")}uiMgr.openView(i.view)}})),this.nodeRemind=m.findChild(this.node,"state1/point"),this.state=m.findChild(this.node,"state1/state"),this.state.position=new r(c.uiMirror?-131.496:131.496,-154.744,0),this.txtState=m.findChildComponent(this.node,"state1/state/txt",C),this.mask=m.findChild(this.node,"state1/mask"),this.txtTime=m.findChildComponent(this.node,"state2/txtTime",h),this.received=m.findChild(this.node,"state2/received"),this.btnGet=m.findChild(this.node,"state2/btnGet"),this.view.addComponentCallbackListener(this.btnGet,o.EventType.CLICK,(function(){IS(A).send_19_2(tt)}));var i=m.findChildComponent(this.node,"state2/rewardScroll",a);this.rewardScroll=this.view.addUIList(i,et,!1),this.rewardScroll.touchEvent=!1},n.onRender=function(t,i){var e=this;if(this.curType=t.type,this.curCfgId=t.cfgId,this.ut.height=t.type==z?167:193,this.state1.active=t.type!=z,this.state2.active=t.type==z,this.mask.active=t.type==q,t.type==Y){this.state.active=!0;var n=IS(H).getPrivilegeCardInfo(this.curCfgId);if(n)if(0==n.end_time)this.txtState.string=l.formatStr("<b><outline color=#230e07 width=2><color=#3aff1d>%s</color></outline></b>",GetLanguage(201126));else{var o=T.formatStrWithMirrorDeal(GetLanguage(200557),y.getDeltaDays(1e3*y.serverTime,1e3*n.end_time)+1);this.txtState.string=l.formatStr("<b><outline color=#230e07 width=2><color=#3aff1d>%s</color></outline></b>",o)}else this.txtState.string=l.formatStr("<b><outline color=#230e07 width=2><color=#FF4444>%s</color></outline></b>",GetLanguage(201127));this.nodeRemind.active=IS(H).checkPrivilegeCardCanFetch(this.curCfgId);var a=configPrivilege_cardtype.getDataByKey(t.cfgId);this.view.loadIcon(this.imgIcon,"recharge_gift",a.poster_pages),this.bpTitle.active=!1,this.pcTitle.active=!0,this.acTitle.active=!1;var r=m.findChildComponent(this.pcTitle,"txtTitle",f),c=m.findChildComponent(this.pcTitle,"txtTitle",u),d=m.findChildComponent(this.pcTitle,"txtDesc",f),v=m.findChildComponent(this.pcTitle,"txtDesc",u);m.findChildComponent(this.pcTitle,"txtTitle",h).string=GetLanguage(a.name_language_id),r.color1=r.color1.fromHEX(a.gradientColor1),r.color2=r.color2.fromHEX(a.gradientColor2),c.color=c.color.fromHEX(a.outlineColor),m.findChildComponent(this.pcTitle,"txtDesc",h).string=GetLanguage(a.desc_language_id),d.color1=d.color1.fromHEX(a.gradientColor1),d.color2=d.color2.fromHEX(a.gradientColor2),v.color=v.color.fromHEX(a.outlineColor)}else if(t.type==q){this.state.active=!1,this.nodeRemind.active=H.checkRewardRP(this.curCfgId)>=0;var p=configFund.getDataByKey(t.cfgId);this.view.loadIcon(this.imgIcon,"recharge_gift",p.poster_pages),this.mask.active=H.checkGetAllReward(this.curCfgId),this.bpTitle.active=!0,this.pcTitle.active=!1,this.acTitle.active=!1,m.findChildComponent(this.bpTitle,"txtTitle",h).string=GetLanguage(p.language_id)}else if(t.type==W){var g,C;this.state.active=!1,C=(g=1==t.info.id?configBattlepass.getDataByKey(t.info.id):configWartoken.getDataByKey(t.info.id)).view,this.view.loadIcon(this.imgIcon,"recharge_gift",k[B[C]].main_img),this.nodeRemind.active=G.checkRewardRP(t.info.id)>=0||G.checkTaskRP(t.info.id)>=0||G.checkAddRewardRP(t.info.id)>0,this.bpTitle.active=!0,this.pcTitle.active=!1,this.acTitle.active=!1,m.findChildComponent(this.bpTitle,"txtTitle",h).string=GetLanguage(g.language_id)}else if(t.type==j){this.state.active=!0,IS(H).checkPrivilegeUnlock(K.NO_ADS)||0==S.ads_icon_is_show?this.txtState.string=l.formatStr("<b><outline color=#230e07 width=2><color=#3aff1d>%s</color></outline></b>",GetLanguage(201126)):this.txtState.string=l.formatStr("<b><outline color=#230e07 width=2><color=#FF4444>%s</color></outline></b>",GetLanguage(201127)),this.nodeRemind.active=!1,this.view.loadIcon(this.imgIcon,"recharge_gift","czhl_img_mianguagngaoka"),this.bpTitle.active=!1,this.pcTitle.active=!0,this.acTitle.active=!1;var I=m.findChildComponent(this.pcTitle,"txtTitle",f),E=m.findChildComponent(this.pcTitle,"txtTitle",u),_=m.findChildComponent(this.pcTitle,"txtDesc",f),D=m.findChildComponent(this.pcTitle,"txtDesc",u);m.findChildComponent(this.pcTitle,"txtTitle",h).string=GetLanguage(999100072),I.color1=I.color1.fromHEX("FF4518"),I.color2=I.color2.fromHEX("FFFBE2"),E.color=E.color.fromHEX("9D3C1D"),m.findChildComponent(this.pcTitle,"txtDesc",h).string=GetLanguage(999100079),_.color1=_.color1.fromHEX("FF4518"),_.color2=_.color2.fromHEX("FFFBE2"),D.color=D.color.fromHEX("9D3C1D")}else if(t.type==z){var L=configPay_mall.getDataByKey(tt);this.rewardScroll.datas=L.reward;var b=IS(F).GetPayGiftInfo(tt);this.txtTime.string=b?y.formatENTimeStringForSecond(b.end_time-y.serverTime):"",b&&2==b.rewardState?(this.btnGet.active=!1,this.received.active=!0):(this.btnGet.active=!0,this.received.active=!1)}else if(t.type==J){this.state.active=!1,this.bpTitle.active=!1,this.pcTitle.active=!1,this.acTitle.active=!0,this.nodeRemind.active=IS(H).checkActivityRedById(this.curCfgId)>0;var P=configActicity_sheet.getDataByKey(this.curCfgId);this.view.loadIcon(this.imgIcon,"recharge_gift",P.banner),m.findChildComponent(this.acTitle,"txtTitle",h).string=GetLanguage_UI(P.language_ui_id);var w=m.findChildComponent(this.pcTitle,"txtTitle",f),x=m.findChildComponent(this.pcTitle,"txtTitle",u);w.color1=w.color1.fromHEX(P.gradientColor1),w.color2=w.color2.fromHEX(P.gradientColor2),x.color=x.color.fromHEX(P.outlineColor)}m.findChildComponent(this.state1,"state/img",s).scheduleOnce((function(){m.findChildComponent(e.state1,"state/img",s).height=e.txtState.getComponent(s).height}),0)},n.updateTime=function(){if(v(this.txtTime)&&this.data.type==z){var t=IS(F).GetPayGiftInfo(tt);this.txtTime.string=t?y.formatENTimeStringForSecond(t.end_time-y.serverTime):""}},e}(g)),et=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(i=t.call.apply(t,[this].concat(n))||this).itemGridNode=void 0,i.itemGrid=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){this.itemGridNode=m.findChild(this.node,"itemGrid"),this.itemGrid=new p(this.view,this.itemGridNode)},n.onRender=function(t,i){this.itemGrid.SetItemId(t[0],t[1])},e}(g);n._RF.pop()}}}));

