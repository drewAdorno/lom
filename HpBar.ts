System.register("chunks:///_virtual/HpBar.ts",["./rollupPluginModLoBabelHelpers.js","cc","./MetaAttrib.ts","./EnumDefine.ts","./V2.ts","./BaseAsset.ts","./NodeUtil.ts","./FixMath.ts"],(function(t){"use strict";var e,s,i,a,r,n,o,h,l,p,u,c,f,d,g,m;return{setters:[function(t){e=t.inheritsLoose,s=t.createClass},function(t){i=t.cclegacy,a=t.ProgressBar,r=t.Sprite,n=t.Label,o=t.isValid,h=t.math,l=t.Color,p=t.sys},function(t){u=t.AttribDefine},function(t){c=t.BindType},function(t){f=t.V2},function(t){d=t.BaseAsset},function(t){g=t.default},function(t){m=t.FixMath}],execute:function(){i._RF.push({},"20d3csuEHlJnICDC2bnyYQN","HpBar",void 0);var _,b={red:"prefab/bar/red",green:"prefab/bar/green",boss:"prefab/bar/boss",self:"prefab/bar/self",blue:"prefab/bar/blue"},N=new f;!function(t){t[t.Not=0]="Not",t[t.SetProgress=128]="SetProgress",t[t.SynPos=256]="SynPos"}(_||(_={}));t("HpBar",function(t){function i(){for(var e,s=arguments.length,i=new Array(s),a=0;a<s;a++)i[a]=arguments[a];return(e=t.call.apply(t,[this].concat(i))||this).bar=void 0,e.imgBar=void 0,e.txtName=void 0,e._unit=void 0,e._progress=void 0,e._lastTime=0,e._barAni=!1,e._speed=3,e._showName=!1,e}e(i,t),i.alloc=function(t,e,s){void 0===s&&(s=!1);var i=b[e];if(null==i)throw new Error(e+": 数字模板路径未找到!");var a=hpBarPool.alloc(i,30,6e4);return a._progress=t.data.currenHp/t.data.getAttribByInt(u.hp),a._showName=s,a.loadSync(),a._unit=t,a.parent=battleMain.barRoot,o(a.bar)&&(a.bar.progress=a._progress,a.imgBar.fillRange=a._progress),a},i.free=function(t){hpBarPool.free(t)};var f=i.prototype;return f.onLoadComplete=function(){this.bar=g.findComponent(this.node,a),this.imgBar=g.findChildComponent(this.node,"imgBar",r),this.txtName=g.findChildComponent(this.node,"txtName",n)},f.cacheReset=function(){t.prototype.cacheReset.call(this),this._unit=null,this._showName=!1,o(this.txtName)&&(this.txtName.node.active=!1)},f.onUpdate=function(e){if(this.synPos(),t.prototype.onUpdate.call(this,e),o(this.imgBar)){this._showName&&this.updateUnitName();var s=m.round(Math.abs(this.imgBar.fillRange-this._progress));if(this._barAni){if(this._lastTime=0,s<this._speed*e)return this._barAni=!1,void(this.imgBar.fillRange=this._progress);this.imgBar.fillRange=h.lerp(this.imgBar.fillRange,this._progress,this._speed*e),s=m.round(Math.abs(this.imgBar.fillRange-this._progress))}0!=s&&(this._lastTime+=e,this._lastTime>.3&&(this._barAni=!0,this._speed=h.clamp(1/(1-s),1,3)))}},f.updateUnitName=function(){var t=this._unit;null!=t&&this.txtName&&(this.txtName.node.active=!0,battleMain.showMainCtr.player.unitId==t.unitId?this.txtName.color=l.GREEN:this.txtName.color=l.WHITE,this.txtName.string=t.data.name,p.uiMirror&&this.txtName.node.setScale(Math.abs(this.txtName.node.scale.x),this.txtName.node.scale.y),this._showName=!1)},f.onApply=function(t){if(0!=(this._changeValue&_.SetProgress)&&(this.bar.progress=this._progress),this._changeValue&_.SynPos){var e=this._unit;if(null==e)return;N.set(e.getBindPos(c.bp_top)),this._pos.set(N),this._node.setPosition(N.x,N.y+10)}},f.synPos=function(){this._changeValue|=_.SynPos},s(i,[{key:"progress",set:function(t){this._progress!=t&&(this._progress=t,this._changeValue|=_.SetProgress)}}]),i}(d));i._RF.pop()}}}));

