System.register("chunks:///_virtual/SeasonMapSceneView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AudioMgr.ts","./RedPoint.ts","./RedPointMgr.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./ConfigSeason_kv.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./BagDefine.ts","./BagModel.ts","./ChapterControl.ts","./ChatDataCache.ts","./ChatDefine.ts","./MessageView.ts","./PayDataCache.ts","./PayDefine.ts","./RoleDefine.ts","./SeasonControl.ts","./SeasonDataCache.ts","./SeasonDefine.ts","./SeasonSceneControl.ts","./SeasonSceneDataCache.ts","./SeasonMapScene.ts","./BaseView.ts"],(function(t){"use strict";var e,i,n,o,a,s,r,h,d,c,p,l,f,m,C,u,v,S,g,I,b,T,w,_,L,E,y,M,V,A,k,P,R,G,D,N,x,O,B,K,U,H,F,q,W,z,Y;return{setters:[function(t){e=t.inheritsLoose,i=t.createForOfIteratorHelperLoose},function(t){n=t.cclegacy,o=t.Vec2,a=t.Vec3,s=t.Button,r=t.Label,h=t.UITransform,d=t.Sprite,c=t.NodeEventType,p=t.sys,l=t.isValid,f=t.ProgressBar,m=t.LabelGradient,C=t.Color,u=t.LabelOutline},function(t){v=t.audioMgr},function(t){S=t.RedPointType},function(t){g=t.RedPointMgr},function(t){I=t.default},function(t){b=t.default},function(t){T=t.default},null,function(t){w=t.ConfigSeason_kv},function(t){_=t.default},function(t){L=t.ActivityType,E=t.ActivityState},function(t){y=t.BagEventDefine},function(t){M=t.BagModel},function(t){V=t.default},function(t){A=t.ChatDataCache},function(t){k=t.ChatDefine,P=t.ChatEventDefine},function(t){R=t.default},function(t){G=t.default},function(t){D=t.PayEventDefine,N=t.GiftType},function(t){x=t.RoleEventDefine},function(t){O=t.default},function(t){B=t.SeasonDataCache},function(t){K=t.SeasonEventDefine,U=t.SeasonShipEventDefind,H=t.gift_list,F=t.ShipTeamStateColor},function(t){q=t.default},function(t){W=t.SeasonSceneDataCache},function(t){z=t.SeasonMapScene},function(t){Y=t.BaseView}],execute:function(){n._RF.push({},"483e9KAtJBCA4t4b3lgKSC2","SeasonMapSceneView",void 0);new o,new a,t("default",function(t){function n(){var e;return(e=t.call(this)||this).chatRoot=void 0,e.txtName=void 0,e.content=void 0,e.face=void 0,e.faceOriScale=void 0,e.mapScene=void 0,e.myInfoItem=void 0,e.txtDiamond=void 0,e.txtPower=void 0,e.txtPowerTime=void 0,e.powerTimer=0,e.btnAirdrop=void 0,e.btnOutline=void 0,e.btnNight=void 0,e.btnSearch=void 0,e.btnWanted=void 0,e.btnBook=void 0,e.txtAirdrop=void 0,e.airdropTimer=0,e.name="SeasonMapSceneView",e.url="ui/module/season/SeasonMapSceneView",e.fullScreen=!0,e.poolTime=1e4,e}e(n,t);var f=n.prototype;return f.onInit=function(){var t=this,e=this.findChild("bottom/btnClose");this.addComponentCallbackListener(e,s.EventType.CLICK,(function(){v.playMusic("battle"),t.close()}));var i=this.findChild("bottom/btnPort");IS(g).addRedPoint("Season/Port",i,new o(60,30),S.Dot),IS(g).changeValue("Season/Port",IS(B).checkRedPoint()),this.addComponentCallbackListener(i,s.EventType.CLICK,(function(){var t=IS(_).GetActivityInfo(L.Season);t&&t.state==E.Open?uiMgr.openView("SeasonMainView"):R.showFlyTip(GetLanguage(200026))})),this.mapScene=new z(this);var n=this.findChild("top/btnDiamond");this.addComponentCallbackListener(n,s.EventType.CLICK,(function(){uiMgr.openView("SeasonGiftView",L.Season)})),this.txtDiamond=I.findChildComponent(n,"txtDiamond",r);var a=this.findChild("top/btnPower");this.addComponentCallbackListener(a,s.EventType.CLICK,(function(){uiMgr.openView("SeasonUseActionPointView")})),this.txtPower=this.findChildComponent("top/btnPower/txtNum",r),this.txtPowerTime=this.findChildComponent("top/btnPower/txtTime",r);var l=this.findChild("bottom/btnChatRoot");this.addComponentCallbackListener(l,s.EventType.CLICK,(function(){uiMgr.openView("ChatView",k.ViewType.SeasonMapBattle)})),this.chatRoot=l;var f=I.findChild(l,"name/messageContent"),m=I.findChildComponent(l,"name",h);this.txtName=I.findChildComponent(l,"name",r),this.content=I.findChildComponent(l,"name/messageContent/content",r),this.face=I.findChildComponent(l,"name/messageContent/face",d),this.faceOriScale=this.face.node.scale,this.addComponentCallbackListener(this.txtName.node,c.SIZE_CHANGED,(function(){f.setPosition(m.width+7,-1.389)}));var C=this.findChild("bottom/myInfo");this.myInfoItem=new j(this,C);var u=this.findChild("bottom/btnLocate");this.addComponentCallbackListener(u,s.EventType.CLICK,(function(){IS(q).reqLocate()}));var b=this.findChild("bottom/btnRecord");IS(g).addRedPoint("Season/Map/Record",b,new o(30,30),S.Dot),IS(B).checkMapRecordRP(),this.addComponentCallbackListener(b,s.EventType.CLICK,(function(){uiMgr.openView("SeasonSceneRecordView")}));var T=this.findChild("bottom/di/btnBag");this.addComponentCallbackListener(T,s.EventType.CLICK,(function(){uiMgr.openView("SeasonBagView")}));var w=this.findChild("bottom/di/btnFeats");this.addComponentCallbackListener(w,s.EventType.CLICK,(function(){uiMgr.openView("SeasonShopView")})),this.loadIcon(w.getComponent(d),"season_map","dhh_dtt_zhangong");var y=this.findChild("bottom/di/btnSupply");IS(g).addRedPoint("Season/Map/Gift",y,new o(30,30),S.Dot),IS(B).checkMapGiftRP(),this.addComponentCallbackListener(y,s.EventType.CLICK,(function(){uiMgr.openView("SeasonGiftView",L.Season)}));var M=this.findChild("bottom/btnTask");IS(g).addRedPoint("Season/Map/Task",M,new o(30,30),S.Dot),IS(B).checkMapTaskRP(),this.addComponentCallbackListener(M,s.EventType.CLICK,(function(){uiMgr.openView("SeasonTaskView",L.Season)})),this.loadIcon(M.getComponent(d),"season_map","dhh_dtt_renwu");var V=this.findChild("bottom/btnRank");this.addComponentCallbackListener(V,s.EventType.CLICK,(function(){uiMgr.openView("SeasonRankView")}));var A=this.findChild("bottom/btnReward");this.addComponentCallbackListener(A,s.EventType.CLICK,(function(){uiMgr.openView("SeasonRewardView")}));var P=this.findChild("bottom/btnGift");this.addComponentCallbackListener(P,s.EventType.CLICK,(function(){uiMgr.openView("SeasonLimitGiftView")}));var G=this.findChild("bottom/btnGroup");this.addComponentCallbackListener(G,s.EventType.CLICK,(function(){uiMgr.openView("SeasonPreviewGroupView",IS(B).server_list)})),this.btnAirdrop=this.findChild("top/btnAirdrop"),this.addComponentCallbackListener(this.btnAirdrop,s.EventType.CLICK,(function(){uiMgr.openView("SeasonSceneDetailAirdropView")})),this.txtAirdrop=this.findChildComponent("top/btnAirdrop/txtAirdrop",r),this.btnOutline=this.findChild("bottom/btnOutline"),this.addComponentCallbackListener(this.btnOutline,s.EventType.CLICK,(function(){uiMgr.openView("SeasonSceneOutlineView")})),this.btnBook=this.findChild("top/btnBook"),this.addComponentCallbackListener(this.btnBook,s.EventType.CLICK,(function(){uiMgr.openView("SeasonHandBookView")}));var D=this.findChild("top/btnMinimap");this.addComponentCallbackListener(D,s.EventType.CLICK,(function(){uiMgr.openView("SeasonSceneMinimapView",t.mapScene.mapCamera.oriPos)})),this.btnNight=this.findChild("top/btnNight");var N=this.findChild("top/btnNight/nodeHint");this.addComponentCallbackListener(this.btnNight,s.EventType.CLICK,(function(){N.active=!N.active})),this.btnSearch=this.findChild("top/btnSearch"),this.addComponentCallbackListener(this.btnSearch,s.EventType.CLICK,(function(){IS(q).reqSearchInfo()})),this.btnWanted=this.findChild("top/btnWanted"),this.addComponentCallbackListener(this.btnWanted,s.EventType.CLICK,(function(){IS(q).reqWantedInfo(),uiMgr.openView("SeasonWantedView")}));var x=this.findChildComponent("bottom/myInfo/dhh_dtt_bg01/Sprite",d);if(this.loadIcon(x,"season_map","dhh_ui_tbcz"),p.uiMirror){var O=this.findChildComponent("top/btnBook/icon",d),K=this.findChildComponent("bottom/btnTask/icon",d);this.loadIcon(O,"season_map","dhh_ui_huoquguize"),this.loadIcon(K,"season_map","dhh_dtt_renwu")}},f.registerUpdateHandler=function(){var t=this;this.addEvent(P.InsertNewMsg,this.updateMessage,this),this.addEvent(P.UpdateChatMsg,this.updateMessage,this),this.addEvent(K.SEASON_SCENE_TEAM_INFO,this.onTeamInfo,this,!0),this.addEvent(y.GOODS_INFO_UPDATE,(function(){t.txtDiamond.string=String(IS(M).getGoodsCountByGoodsGtid(270009)),IS(g).changeValue("Season/Port",IS(B).checkRedPoint())})),this.addEvent(x.ROLE_RES_UPDATE,(function(){IS(g).changeValue("Season/Port",IS(B).checkRedPoint())})),this.addEvent(K.SEASON_SCENE_REWARD,this.onReward,this),this.addEvent(K.SEASON_SCENE_ROLE_INFO,this.onRoleInfo,this,!0),this.addEvent(K.SEASON_SCENE_AIRDORPS,this.updateAirdropInfo,this,!0),this.addEvent(U.TYPE_OUTLINE_INFO_UPDATE,this.updateOutline,this),this.addEvent(D.PAY_INFO_UPDATE,this.updateLimitGift,this),this.addEvent(D.PAY_REWARD_UPDATE,this.updateLimitGift,this),this.addEvent(D.PAY_RECHARGE_SUCCESS,this.updateLimitGift,this)},f.onAfterOpen=function(){var t=this;IS(O).reqOutlineBoxInfo(),v.playMusic("hanghai_mainbgm"),uiMgr.getView("MainView").visible=!1,this.mapScene.open(),battleMain.stopChapter(),this.txtDiamond.string=String(IS(M).getGoodsCountByGoodsGtid(270009)),this.onRoleInfo(IS(W).roleInfo),this.updateAirdropInfo(),this.onTeamInfo(),this.checkNight(),this.addTimer(30,-1,(function(){t.checkNight()})),this.updateLimitGift()},f.onBeforeClose=function(){uiMgr.getView("MainView").visible=!0,uiMgr.close("SeasonMapLoadView"),this.mapScene.close(),0!=IS(W).currenSceneType&&IS(q).reqQuit(),IS(W).currenSceneType=0,IS(V).reqEnterChapter(0),battleMain.enterChapter(0,!1,!0),IS(B).checkMapAPRP()},f.onUpdate=function(t){var e;null==(e=this.mapScene)||e.onUpdate(t)},f.onDestroy=function(){var t;null==(t=this.mapScene)||t.destroy()},f.updateMessage=function(t){if(void 0===t&&(t=null),(!t||t.channel==k.Channel.SeasonMap||t.channel==k.Channel.SeasonMapBattle)&&l(this.txtName)&&l(this.content)&&l(this.face)){var e=IS(A).GetChatInfo(t.channel,0);if(e&&e.length>0){var i=e[e.length-1];if(this.txtName.string=p.uiMirror?"："+i.name:i.name+"：",i.type==k.ChatContentType.Conetnt||i.type==k.ChatContentType.Share){var n=i.content;this.content.string=n,this.face.node.active=!1}else if(i.type==k.ChatContentType.Face){this.face.node.active=!0,this.content.string="";var o=IS(A).GetFaceIconByContent(i.content),s=o[0],r=o[1],h=this.faceOriScale.y*r.scale;this.face.node.scale=new a(h,h,h),this.loadIcon(this.face,"icon_chat",s)}this.txtName.node.active=!0}else this.txtName.string="",this.content.string=""}},f.updatePowerInfo=function(){var t=this,e=IS(W).roleInfo;if(e){var i=w.SEASON_BATTLE_ACTION_LIMITED;this.txtPower.string=b.formatStr(p.uiMirror?"##2/##1":"##1/##2",e.action_point,i);var n=e.next_time-T.serverTime;e.action_point<i&&n>0?(this.txtPowerTime.node.active=!0,0!=this.powerTimer&&this.removeTimer(this.powerTimer),this.txtPowerTime.string=b.formatStr(GetLanguage(204705),T.getTimeLeft(n)),this.powerTimer=this.addTimer(1,n+1,(function(){t.txtPowerTime.string=b.formatStr(GetLanguage(204705),T.getTimeLeft(e.next_time-T.serverTime))}))):this.txtPowerTime.node.active=!1}},f.updateAirdropInfo=function(){var t=this,e=IS(W).airDrops;if(0!=this.airdropTimer&&this.removeTimer(this.airdropTimer),this.airdropTimer=0,e)if(this.btnAirdrop.active=!0,this.txtAirdrop.string="",0==e.refresh_time){var i=e.start_time-T.serverTime;i>0&&(this.airdropTimer=this.addTimer(1,i,(function(){t.txtAirdrop.string=b.formatStr(GetLanguage(205034),T.getTimeLeft(e.start_time-T.serverTime))})))}else{var n=e.refresh_time-T.serverTime;n>0&&(this.airdropTimer=this.addTimer(1,n,(function(){t.txtAirdrop.string=b.formatStr(GetLanguage(205035),T.getTimeLeft(e.start_time-T.serverTime))})))}else this.btnAirdrop.active=!1},f.updateLimitGift=function(){var t,e,n=IS(_).GetActivityInfo(L.Season);if(n){for(var o,a,s=IS(G).GetAcivityGift(N.Activity,n.type,n.round),r=i(s);!(a=r()).done;){var h=a.value;if(H.includes(h.id)){o=h;break}}o&&0==(null!=(t=null==(e=IS(G).GetPayGiftInfo(o.id))?void 0:e.bought_times)?t:0)?this.findChild("bottom/btnGift").active=!0:this.findChild("bottom/btnGift").active=!1}else this.findChild("bottom/btnGift").active=!1},f.updateOutline=function(){var t=I.findChild(this.btnOutline,"node1"),e=I.findChild(this.btnOutline,"node2"),i=I.findChild(this.btnOutline,"node3");t.active=!1,e.active=!1,i.active=!1;var n=T.serverTime-IS(B).outline_last_time;0==IS(B).outline_reward_list.length?t.active=!0:n>=w.SEASON_BATTLE_ONHOOK_TREASURE_LIMIT?i.active=!0:e.active=!0},f.onReward=function(t,e){uiMgr.openView("SeasonBattleResultView",t,e)},f.onRoleInfo=function(t){t&&this.updatePowerInfo()},f.onTeamInfo=function(){var t;null==(t=this.myInfoItem)||t.updateInfo(),this.mapScene.activeSelfShip()},f.checkNight=function(){var t=T.ServerDate(1e3*T.serverTime).getHours(),e=w.SEASON_BATTLE_NIGHT_TIMELIMIT[0],i=w.SEASON_BATTLE_NIGHT_TIMELIMIT[1];IS(B).isInNight=t>=e&&t<i,this.btnNight.active=IS(B).isInNight},n}(Y));var j=function(){function t(t,e){this.view=void 0,this.node=void 0,this.dead=void 0,this.normal=void 0,this.pbHp=void 0,this.imgIcon=void 0,this.opt=void 0,this.txtReviveTime=void 0,this.reviveTimer=0,this.imgState=void 0,this.view=t,this.node=e,this.onInit(e)}var e=t.prototype;return e.onInit=function(t){var e=this;this.dead=I.findChild(t,"dead"),this.normal=I.findChild(t,"normal"),this.pbHp=I.findChildComponent(t,"normal/hp",f),this.imgIcon=I.findChildComponent(t,"opt/imgIcon",d),this.imgState=I.findChild(t,"normal/imgState"),this.txtReviveTime=I.findChildComponent(this.dead,"txtReviveTime",r),this.opt=I.findChild(t,"opt"),this.view.addComponentCallbackListener(this.imgIcon.node,s.EventType.CLICK,(function(){e.openStateView()})),this.updateInfo()},e.openStateView=function(){var t=IS(W).teamInfo;if(null!=t)switch(t.state){case 2:R.showBoxTip({tip:GetLanguage(204731),func:function(t){"type_yes"==t&&IS(q).reqBack()}});break;case 3:if(IS(M).getGoodsCountByGoodsGtid(270009)<=0)return void R.showFlyTip(GetLanguage(204719));R.showBoxTip({tip:GetLanguage(302172),func:function(t){"type_yes"==t&&IS(q).reqRevive()}});break;case 4:uiMgr.openView("SeasonSceneSpeedView");break;case 5:uiMgr.openView("SeasonSceneAddHpView")}},e.updateInfo=function(){var t=this,e=IS(W).teamInfo;if(null!=e){switch(this.pbHp.progress=e.hp/1e4,e.state){case 1:return this.opt.active=!1,this.dead.active=!1,void(this.imgState.active=!1);case 2:this.opt.active=!1,this.imgState.getComponent(r).string=GetLanguage_UI(F[e.state].lauID),this.imgState.getComponent(m).color1=new C(F[e.state].color1),this.imgState.getComponent(m).color2=new C(F[e.state].color2),this.imgState.getComponent(u).color=new C(F[e.state].color3),this.view.loadIcon(this.imgIcon,"season_map","dhh_icon_chetui");break;case 3:this.opt.active=!0,this.pbHp.progress=0,this.view.loadIcon(this.imgIcon,"season_map","270009");var i=e.state_end_time-T.serverTime;this.txtReviveTime.string=b.formatStr(GetLanguage(204706),T.getTimeLeft(i)),0!=this.reviveTimer&&this.view.removeTimer(this.reviveTimer),this.reviveTimer=this.view.addTimer(1,i+1,(function(){t.txtReviveTime.string=b.formatStr(GetLanguage(204706),T.getTimeLeft(e.state_end_time-T.serverTime))}));break;case 4:this.opt.active=!0,this.imgState.getComponent(r).string=GetLanguage_UI(F[e.state].lauID),this.imgState.getComponent(m).color1=new C(F[e.state].color1),this.imgState.getComponent(m).color2=new C(F[e.state].color2),this.imgState.getComponent(u).color=new C(F[e.state].color3),this.view.loadIcon(this.imgIcon,"season_map","dhh_icon_jiasu");break;case 5:this.opt.active=!0,this.imgState.getComponent(r).string=GetLanguage_UI(F[e.state].lauID),this.imgState.getComponent(m).color1=new C(F[e.state].color1),this.imgState.getComponent(m).color2=new C(F[e.state].color2),this.imgState.getComponent(u).color=new C(F[e.state].color3),this.view.loadIcon(this.imgIcon,"season_map","dhh_icon_zhiliao");break;case 6:this.opt.active=!0,this.imgState.getComponent(r).string=GetLanguage_UI(F[e.state].lauID),this.imgState.getComponent(m).color1=new C(F[e.state].color1),this.imgState.getComponent(m).color2=new C(F[e.state].color2),this.imgState.getComponent(u).color=new C(F[e.state].color3)}this.dead.active=3==e.state,this.normal.active=3!=e.state,this.imgState.active=!0}},t}();n._RF.pop()}}}));

