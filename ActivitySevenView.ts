System.register("chunks:///_virtual/ActivitySevenView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./TimeUtil.ts","./index57.ts","./ConfigGlobal.ts","./BagModel.ts","./ChapterDataCache.ts","./MessageView.ts","./GuildControl.ts","./MainViewModel.ts","./PayControl.ts","./PayDataCache.ts","./PayDefine.ts","./RoleDataCache.ts","./ActivityControl.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./ActivitySevenDataCache.ts","./BaseView.ts"],(function(t){"use strict";var i,e,n,a,s,o,d,r,h,c,v,f,l,u,y,p,I,m,C,G,g,b,w,S,k,L,_,T,x,A,D,B,U;return{setters:[function(t){i=t.inheritsLoose,e=t.createForOfIteratorHelperLoose},function(t){n=t.cclegacy,a=t.Button,s=t.sys,o=t.HorizontalTextAlignment,d=t.Label,r=t.ProgressBar,h=t.ScrollView,c=t.js,v=t.Sprite},function(t){f=t.ItemGrid},function(t){l=t.ListItem},function(t){u=t.default},function(t){y=t.default},null,function(t){p=t.ConfigGlobal},function(t){I=t.BagModel},function(t){m=t.ChapterDataCache},function(t){C=t.default},function(t){G=t.default},function(t){g=t.MainViewModel},function(t){b=t.default},function(t){w=t.default},function(t){S=t.PayEventDefine,k=t.GiftType},function(t){L=t.RoleDataCache},function(t){_=t.default},function(t){T=t.default},function(t){x=t.ActivityEventDefine,A=t.ActivityState,D=t.ActivityTaskState},function(t){B=t.default},function(t){U=t.BaseView}],execute:function(){var P;n._RF.push({},"32cce6WRXpOhKVbmPdmKA4I","ActivitySevenView",void 0);var O=1,R=2,E=((P={})[1]=56,P[2]=57,P[3]=58,P[4]=59,P[5]=60,P[6]=61,P[7]=62,P),V=p.sevendaytask_final_reward[0],M=(t("default",function(t){function n(){var i;return(i=t.call(this)||this).itemGrid=void 0,i.canGet=void 0,i.payRed=void 0,i.taskRed=void 0,i.txtLeftTime=void 0,i.payList=void 0,i.taskList=void 0,i.curIndex=0,i.curDay=0,i.tabBtns=[],i.dayList=[],i.pb=void 0,i.deltaTime=0,i.leftTime=0,i.canUpdate=!1,i.defalutTaskId=void 0,i.name="ActivitySevenView",i.url="ui/module/activity/ActivitySevenView",i}i(n,t);var v=n.prototype;return v.onInit=function(){var t=this,i=this.findChild("imgMask");this.addComponentCallbackListener(i,a.EventType.CLICK,(function(){t.close()}));var e=this.findChild("btnClose");this.addComponentCallbackListener(e,a.EventType.CLICK,(function(){t.close()}));var n=this.findChild("container/topBg/tips");this.addComponentCallbackListener(n,a.EventType.CLICK,(function(){for(var t=p.LIMITED_RANK_SYSTEM_DETAILS,i="",e=0;e<t.length;e++)t[e][0]==E[1]&&(i=GetLanguage(t[e][1]));""!=i&&C.showBoxTip({tip:i,btnCnt:1,horizontalAlign:s.uiMirror?o.RIGHT:o.LEFT})}));var v=this.findChild("container/topBg/itemGrid");this.canGet=this.findChild("container/topBg/canGet"),this.itemGrid=new f(this,v,(function(){IS(B).canGetLastReward()?IS(_).send_24_86(1):IS(I).OpenItemTips(V[0],v)})),this.txtLeftTime=this.findChildComponent("container/topBg/txtLeftTime",d),this.taskRed=this.findChild("tab/scrollTab/view/content/item1/red"),this.payRed=this.findChild("tab/scrollTab/view/content/item2/red");for(var l=function(i){var e=u.findChild(t.node,c.formatStr("tab/scrollTab/view/content/item%s",i)),n={itemGo:e,normalGo:u.findChild(e,"normal"),selectedGo:u.findChild(e,"selected"),index:i};t.addComponentCallbackListener(e,a.EventType.CLICK,(function(){t.SetIndex(n.index)})),t.tabBtns[i]=n},y=1;y<=2;y++)l(y);this.pb=this.findChildComponent("container/day/pb",r);for(var m=1;m<=7;m++){var G=new M;G.init(this.findChild("container/day/dayList/day"+m),this,m),this.dayList.push(G)}var g=this.findChildComponent("container/payList",h);this.payList=this.addUIList(g,N);var b=this.findChildComponent("container/taskList",h);this.taskList=this.addUIList(b,F)},v.registerUpdateHandler=function(){this.addEvent(S.PAY_INFO_UPDATE,this.OnPayGiftInfoUpdate,this),this.addEvent(x.OnActivityInfoTaskUpdate,this.OnTaskUpdate,this),this.addEvent(x.OnActivityInfoUpdate,this.OnActUpdate,this),this.addEvent(x.OnActivitySevenInfoUpdate,this.OnActUpdate,this)},v.onAfterOpen=function(){var t;this.itemGrid.SetItemId(V[0],V[1]);for(var i=!1,n=0,a=1;a<=7;a++){IS(_).send_24_14(E[a]),i=IS(T).GetTaskRedNum(E[a])>0||i,IS(T).GetActivityInfo(E[a])&&(n=a)}this.taskRed.active=i,this.pb.progress=n/7,this.canGet.active=IS(B).canGetLastReward();for(var s=!1,o=1;o<=7;o++){var d=IS(T).GetActivityInfo(E[o]);if(d)for(var r,h=IS(w).GetAcivityGift(k.Activity,d.type,d.round),c=e(h);!(r=c()).done;){var v=r.value;if(0==v.price){var f=IS(w).GetPayGiftInfo(v.id);if(!f||2!=f.rewardState){s=!0;break}}}}this.payRed.active=s;var l=IS(T).GetActivityInfo(E[1]),u=null!=(t=l.state_time[l.state])?t:l.state_time[A.Open];this.leftTime=u.end_time-y.serverTime,this.leftTime>0?(this.canUpdate=!0,this.txtLeftTime.string=y.formatTimeStringForSecond(this.leftTime)):this.txtLeftTime.string=GetLanguage(200026);for(var p,I=e(this.dayList);!(p=I()).done;){p.value.show()}n=this.getDefalutInfo(n),this.SetDay(n),this.SetIndex(O)},v.getDefalutInfo=function(t){for(var i=new Array,e=new Array,n=1;n<=t;n++){var a=IS(T).GetActivityInfo(E[n]).task_list;for(var s in a)a[s].state==D.CanGet&&i.push({taskId:a[s].task_id,day:n}),a[s].state==D.Normal&&e.push({taskId:a[s].task_id,day:n})}return i.length>0?(i.sort((function(t,i){return t.taskId-i.task_id})),this.defalutTaskId=i[0].taskId,i[0].day):e.length>0?(e.sort((function(t,i){return t.day!=i.day?i.day-t.day:t.taskId-i.task_id})),this.defalutTaskId=e[0].taskId,e[0].day):(this.defalutTaskId=null,t)},v.onBeforeClose=function(){this.canUpdate=!1,this.curIndex>0&&(this.tabBtns[this.curIndex].normalGo.active=!0,this.tabBtns[this.curIndex].selectedGo.active=!1,this.curIndex=0),this.curDay=0,this.defalutTaskId=null},v.onUpdate=function(t){this.canUpdate&&(this.deltaTime=this.deltaTime+t,this.deltaTime>=1&&(this.deltaTime=0,this.leftTime=this.leftTime-1,this.leftTime>0?this.txtLeftTime.string=y.formatTimeStringForSecond(this.leftTime):(this.txtLeftTime.string=GetLanguage(200026),this.canUpdate=!1)))},v.onDestroy=function(){},v.SetIndex=function(t){this.curIndex!=t&&(this.curIndex>0&&(this.tabBtns[this.curIndex].selectedGo.active=!1,this.tabBtns[this.curIndex].normalGo.active=!0),this.curIndex=t,this.tabBtns[this.curIndex].normalGo.active=!1,this.tabBtns[this.curIndex].selectedGo.active=!0,this.curIndex==R?(this.payList.node.active=!0,this.taskList.node.active=!1,this.OnPayGiftInfoUpdate()):this.curIndex==O&&(this.payList.node.active=!1,this.taskList.node.active=!0,this.OnTaskUpdate()))},v.SetDay=function(t){if(this.curDay!=t){this.curDay=t,this.curIndex==R?this.OnPayGiftInfoUpdate():this.curIndex==O&&this.OnTaskUpdate();for(var i,n=e(this.dayList);!(i=n()).done;){i.value.show()}}},v.OnActUpdate=function(){for(var t=0,i=1;i<=7;i++){IS(T).GetActivityInfo(E[i])&&(t=i)}this.pb.progress=t/7;for(var n,a=e(this.dayList);!(n=a()).done;){n.value.show()}this.canGet.active=IS(B).canGetLastReward(),this.OnTaskUpdate()},v.OnPayGiftInfoUpdate=function(){if(0!=this.curDay){for(var t=!1,i=1;i<=7;i++){var n=IS(T).GetActivityInfo(E[i]);if(n)for(var a,s=IS(w).GetAcivityGift(k.Activity,n.type,n.round),o=e(s);!(a=o()).done;){var d=a.value;if(0==d.price){var r=IS(w).GetPayGiftInfo(d.id);if(!r||2!=r.rewardState){t=!0;break}}}}this.payRed.active=t;for(var h,c=IS(T).GetActivityInfo(E[this.curDay]),v=IS(w).GetAcivityGift(k.Activity,c.type,c.round),f=e(this.dayList);!(h=f()).done;){h.value.show()}v.sort((function(t,i){var e=IS(w).GetPayGiftInfo(t.id),n=IS(w).GetPayGiftInfo(i.id),a=e&&e.bought_times&&e.bought_times>=e.payCfg.buy_times;return a!=(n&&n.bought_times&&n.bought_times>=n.payCfg.buy_times)?a?1:-1:t.id-i.id})),this.payList.datas=v}},v.OnTaskUpdate=function(t){if(0!=this.curDay){if(t){for(var i=!1,n=1;n<=7;n++)i=IS(T).GetTaskRedNum(E[n])>0||i;this.taskRed.active=i,this.canGet.active=IS(B).canGetLastReward()}for(var a,s=e(this.dayList);!(a=s()).done;){a.value.show()}var o=IS(T).GetActivityInfo(E[this.curDay]),d=[];for(var r in o.task_list)o.task_list.hasOwnProperty(r)&&d.push(o.task_list[r]);for(var h in d.sort((function(t,i){return 1==t.state&&1!=i.state?-1:1!=t.state&&1==i.state?1:t.state!=i.state?t.state-i.state:t.id-i.id})),o.group_task_list)o.group_task_list.hasOwnProperty(h)&&d.unshift(o.group_task_list[h]);if(this.taskList.datas=d,this.defalutTaskId)for(var c=0;c<d.length;c++)if(d[c].task_id==this.defalutTaskId){this.taskList.scrollTo(c,null,1);break}this.defalutTaskId=null}},n}(U)),function(){function t(){this.view=void 0,this.node=void 0,this.index=void 0,this.normal=void 0,this.selected=void 0,this.lock=void 0,this.red=void 0,this.nodeFinish=void 0}var i=t.prototype;return i.init=function(t,i,e){this.view=i,this.node=t,this.index=e,this.onInit()},i.onInit=function(){var t=this;this.normal=u.findChild(this.node,"normal"),this.selected=u.findChild(this.node,"selected"),this.lock=u.findChild(this.node,"lock"),this.red=u.findChild(this.node,"red"),this.view.addComponentCallbackListener(this.node,a.EventType.CLICK,(function(){t.normal.active&&t.view.SetDay(t.index)})),this.nodeFinish=u.findChild(this.node,"finish"),s.uiMirror&&this.view.loadIcon(this.nodeFinish.getComponent(v),"act_seven","qrsl_icon_yiwancheng")},i.show=function(){this.selected.active=this.view.curDay==this.index;var t=IS(T).GetActivityInfo(E[this.index]);if(this.lock.active=!t,this.normal.active=!this.selected.active&&!this.lock.active,this.view.curIndex==R){if(this.red.active=!1,t)for(var i,n=IS(w).GetAcivityGift(k.Activity,t.type,t.round),a=e(n);!(i=a()).done;){var s=i.value;if(0==s.price){var o=IS(w).GetPayGiftInfo(s.id);if(!o||2!=o.rewardState){this.red.active=!0;break}}}this.nodeFinish.active=!1}else if(this.view.curIndex==O){var d;if(this.red.active=t&&IS(T).GetTaskRedNum(t.type)>0,t&&t.group_task_list)for(var r in t.group_task_list)if(t.group_task_list.hasOwnProperty(r)){d=t.group_task_list[r];break}this.nodeFinish.active=d&&d.state==D.HadGet}},t}()),N=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return(i=t.call.apply(t,[this].concat(n))||this).txtName=void 0,i.txtPrice=void 0,i.btnBuy=void 0,i.out=void 0,i.rewardScroll=void 0,i.bg1=void 0,i.bg2=void 0,i.discountNode=void 0,i.txtDiscount=void 0,i.red=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){var t=this;this.bg1=u.findChild(this.node,"imgBg"),this.bg2=u.findChild(this.node,"imgBg2"),this.txtName=u.findChildComponent(this.node,"title/Label",d),this.txtPrice=u.findChildComponent(this.node,"btnBuy/Label",d),this.red=u.findChild(this.node,"btnBuy/red"),this.out=u.findChild(this.node,"out"),this.btnBuy=u.findChild(this.node,"btnBuy"),this.discountNode=u.findChild(this.node,"btnBuy/discount"),this.txtDiscount=u.findChildComponent(this.node,"btnBuy/discount/Label",d),this.view.addComponentCallbackListener(this.btnBuy,a.EventType.CLICK,(function(){0==t.data.price?IS(b).send_19_2(t.data.id):IS(w).Pay(t.data.id)}));var i=u.findChildComponent(this.node,"rewardScroll",h);this.rewardScroll=this.view.addUIList(i,K)},n.onRender=function(t,i){this.txtName.string=t.name,this.rewardScroll.datas=t.reward,this.bg1.active=0!=t.price,this.bg2.active=0==t.price;var e=IS(w).GetPayGiftInfo(t.id);0==t.ratio?this.discountNode.active=!1:(this.discountNode.active=!0,this.txtDiscount.string=100*t.ratio+"%"),0==t.price?(this.txtPrice.string=GetLanguage(200045),e&&2==e.rewardState?(this.out.active=!0,this.btnBuy.active=!1,this.red.active=!1):(this.out.active=!1,this.btnBuy.active=!0,this.red.active=!0)):(this.red.active=!1,this.txtPrice.string=IS(w).GetPriceString(t.cost_level),0==t.buy_times?(this.out.active=!1,this.btnBuy.active=!0):e&&e.bought_times&&e.bought_times>=e.payCfg.buy_times?(this.out.active=!0,this.btnBuy.active=!1):(this.out.active=!1,this.btnBuy.active=!0))},e}(l),F=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return(i=t.call.apply(t,[this].concat(n))||this).txtDesc=void 0,i.btnGet=void 0,i.received=void 0,i.undone=void 0,i.rewardScroll=void 0,i.btnGo=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){var t=this;this.txtDesc=u.findChildComponent(this.node,"txtDesc",d),this.received=u.findChild(this.node,"received"),this.undone=u.findChild(this.node,"undone"),this.btnGet=u.findChild(this.node,"btnGet"),this.view.addComponentCallbackListener(this.btnGet,a.EventType.CLICK,(function(){IS(_).send_24_15(E[t.view.curDay],t.data.task_id,t.data.group_id)}));var i=u.findChildComponent(this.node,"rewardScroll",h);this.rewardScroll=this.view.addUIList(i,K),this.btnGo=u.findChild(this.node,"btnGo"),this.view.addComponentCallbackListener(this.btnGo,a.EventType.CLICK,(function(){var i=t.data.cfg.acces;if(null!=i&&0!=i){var e=configGoods_source.getDataByKey(i),n=!0;if(0==e.newopen_func||IS(L).CheckFuncOpen(e.newopen_func,!0)||(n=!1),n){if(""!=e.view)if("MainView"==e.view)IS(g).TryJumpToMainViewPanel(e.openArgs[0],e.openArgs[1],e.openArgs[2]);else{if(("GuildDonateView"==e.view||"SingleEnterView"==e.view)&&!IS(L).HasGuild())return void C.showFlyTip(GetLanguage(200165));if("SingleEnterView"==e.view)IS(G).send_29_21(1);else{var a,s=e.openArgs.slice(0);(a=uiMgr).openView.apply(a,[e.view].concat(s))}}t.view.close(),uiMgr.close("ActivityOpenListView")}}}))},n.onRender=function(t,i){if(0==t.task_id?this.txtDesc.string=GetLanguage(300055):this.txtDesc.string=t.cfg.desc+c.formatStr("(%s/%s)",t.count,t.cfg.condition[2]),this.rewardScroll.datas=t.cfg.reward,t.state==D.CanGet)this.received.active=!1,this.undone.active=!1,this.btnGet.active=!0,this.btnGo.active=!1;else if(t.state==D.HadGet)this.received.active=!0,this.undone.active=!1,this.btnGet.active=!1,this.btnGo.active=!1;else{this.received.active=!1,this.btnGet.active=!1;var e=this.data.cfg.acces;if(null==e||0==e)this.undone.active=!0,this.btnGo.active=!1;else{var n=configGoods_source.getDataByKey(e);IS(m).curChapterId>n.chapter_id?(this.undone.active=!1,this.btnGo.active=!0):(this.undone.active=!0,this.btnGo.active=!1)}}},e}(l),K=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return(i=t.call.apply(t,[this].concat(n))||this).itemGridNode=void 0,i.itemGrid=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){this.itemGridNode=u.findChild(this.node,"itemGrid"),this.itemGrid=new f(this.view,this.itemGridNode)},n.onRender=function(t,i){this.itemGrid.SetItemId(t[0],t[1])},e}(l);n._RF.pop()}}}));

