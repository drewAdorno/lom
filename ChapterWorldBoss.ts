System.register("chunks:///_virtual/ChapterWorldBoss.ts",["./rollupPluginModLoBabelHelpers.js","cc","./FixMath.ts","./BattleData.ts","./index83.ts","./EnumDefine.ts","./V2.ts","./BaseChapter.ts","./UnitGroupCtr.ts"],(function(t){"use strict";var i,a,s,e,n,r,o,h,f;return{setters:[function(t){i=t.inheritsLoose,a=t.createForOfIteratorHelperLoose},function(t){s=t.cclegacy},function(t){e=t.FixMath},function(t){n=t.ChapterType},null,function(t){r=t.UnityType},function(t){o=t.V2},function(t){h=t.BaseChapter},function(t){f=t.UnitGroupCtr}],execute:function(){s._RF.push({},"de13dG7J8BAJ706Lnwmvo2U","ChapterWorldBoss",void 0);var l=new o;t("ChapterWorldBoss",function(t){function s(){for(var i,a=arguments.length,s=new Array(a),e=0;e<a;e++)s[e]=arguments[e];return(i=t.call.apply(t,[this].concat(s))||this).bossList=[],i.bossUnit=void 0,i}i(s,t);var o=s.prototype;return o.init=function(){this.battleMain.hitThrowDis=!1},o.destroy=function(){},o.getConfig=function(t){return configWorld_boss.getDataByKey(t)},o.loadData=function(t){var i,a=this.battleMain;for(var s in a.data.playerList)this.addPlayer(a.data.playerList[s],t);a.mainCtr=null!=(i=a.mainCtr)?i:a.playerCtrs[0],a.showMainCtr=a.mainCtr,a.mainCtr.player.shamUnit=!1,this.addBuff(a.mainCtr.player,1)},o.addPlayer=function(t,i){var a=configChapter_type.getDataByKey(n.WorldBoss).player_points,s=new f,e=t.pos-1;s.offsetY=a[e][1],s.offsetX=-a[e][0],s.playerData=t;for(var o=t.units,h=0;h<o.length;h++){var l=void 0;o[h].config.type==r.Player&&(l=this.battleMain.unitMgr.addWorldBossPlayer(o[h],0,!0),s.player=l),s.units.push(l)}return s.positionSelected(i,!0),this.battleMain.playerCtrs.push(s),s},o.setChapter=function(i){var a=this;t.prototype.setChapter.call(this,i),configWorld_boss.getDataByList("index",this.config.index).forEach((function(t){a.bossList.push(configUnit.getDataByKey(t.bossID))}))},o.start=function(){var t=this.battleMain;t.hitThrowDis=!1;var i=t.unitMgr.addWorldBoss(this.bossList[0].id,1);i.units=this.bossList;for(var s,e=a(this.mapConfig.points);!(s=e()).done;){var n=s.value;if(1===n[0]){i.position=l.set(n[1],n[2]).add2f(t.mapCamera.offsetX,0);break}}i.direction=-1,this.bossUnit=i,this.addBuff(i,2)},o.addBuff=function(t,i){var s=this.battleMain.data.buffs;if(null!=s)for(var e,n=a(s);!(e=n()).done;){var r=e.value,o=configWorld_boss_bufflist.getDataByKey(r);null==o&&printLogErr("坐骑副本buff:"+r+"不存在!!!"),o.target==i&&t.skillctr.addChapterBuff(o.skill_id)}},o.toResult=function(t,i){this.battleMain},o.onUpdate=function(t){if(!this.over){if(this.battleMain.mainCtr.player.isDead)return this.over=!0,this.toResult(0),!0;if(this.timeModel){if(this.chapterTime<=0)return this.over=!0,void this.toResult(0,!0);this.chapterTime=e.round(this.chapterTime-t),this.chapterTime=Math.max(this.chapterTime,0)}}},o.onUnitHpNumChange=function(t){var i=Math.min(t,this.bossList.length),a=configWorld_boss.getDataByList("index",this.config.index);this.config=a[i-1],this.battleMain.data.chapterId=this.config.id},s}(h));s._RF.pop()}}}));

