System.register("chunks:///_virtual/FateWishView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./NodeUtil.ts","./StringUtil.ts","./index57.ts","./ItemIcon.ts","./ConfigGlobal.ts","./BagModel.ts","./MessageView.ts","./MainViewModel.ts","./FateControl.ts","./FateDataCache.ts","./FateDefine.ts","./UIDefine.ts","./BaseView.ts"],(function(t){"use strict";var e,i,o,n,s,a,r,d,h,c,f,l,u,C,p,g,v,w,m,I;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,o=t.Button,n=t.Label,s=t.ProgressBar,a=t.Sprite,r=t.Color,d=t.js},function(t){h=t.default},function(t){c=t.default},null,function(t){f=t.IconAseetType},function(t){l=t.ConfigGlobal},function(t){u=t.BagModel},function(t){C=t.default},function(t){p=t.MainViewModel},function(t){g=t.default},function(t){v=t.default},function(t){w=t.FateEventDefine},function(t){m=t.PanelTabType},function(t){I=t.BaseView}],execute:function(){i._RF.push({},"b54286WCFJIq6rLbpjdIazf","FateWishView",void 0);var y=[1021,2],L=l.fate_draw_guaranteed,G=l.fate_draw_expend,S=l.fate_draw_weight,_=(t("default",function(t){function i(){var e;return(e=t.call(this)||this).wishGetIcon=void 0,e.tipsGo=void 0,e.tipsTxt=void 0,e.nodeResParent=void 0,e.nodeResItem=void 0,e.lotteryPoint=void 0,e.lotteryProgress=void 0,e.imgCost1=void 0,e.imgCost2=void 0,e.txtCost1=void 0,e.txtCost2=void 0,e.wishpreviewList=[],e.resItems=void 0,e.name="FateWishView",e.url="ui/module/fate/FateWishView",e.fullScreen=!0,e}e(i,t);var f=i.prototype;return f.onInit=function(){var t=this,e=this.findChild("content/btnClose");this.addComponentCallbackListener(e,o.EventType.CLICK,(function(){t.onCloseClick()}));var i=this.findChild("content/btnDetail");this.addComponentCallbackListener(i,o.EventType.CLICK,(function(){uiMgr.openView("FateWishpreView")})),this.tipsGo=this.findChild("content/tips"),this.tipsTxt=h.findChildComponent(this.node,"content/tips/txtDesc",n),this.tipsTxt.string=GetLanguage(103449);var r=this.findChild("content/btnTips");this.addComponentCallbackListener(r,o.EventType.CLICK,(function(){t.tipsGo.active=!0}));var c=this.findChild("content/tips");this.addComponentCallbackListener(c,o.EventType.CLICK,(function(){t.tipsGo.active=!1}));for(var f=function(e){var i=h.findChild(t.node,d.formatStr("content/btnDraw%s",e+1));t.addComponentCallbackListener(i,o.EventType.CLICK,(function(){t.onDrawClick(e)})),h.findChildComponent(t.node,d.formatStr("content/btnDraw%s/txtName",e+1),n).string=GetLanguage(200122)+" "+G[e][0]},l=0;l<2;l++)f(l);for(var u=1;u<=10;u++){var C=new _;C.init(this.findChild("content/wishpreview/"+u),this,u),this.wishpreviewList.push(C)}this.lotteryProgress=h.findChildComponent(this.node,"content/blessProgress",s),this.lotteryPoint=h.findChildComponent(this.node,"content/blessProgress/schedule",n),this.imgCost1=h.findChildComponent(this.node,"content/blessCount/costItem1/imgCost",a),this.imgCost2=h.findChildComponent(this.node,"content/blessCount/costItem2/imgCost",a),this.txtCost1=h.findChildComponent(this.node,"content/blessCount/costItem1/txtCost",n),this.txtCost2=h.findChildComponent(this.node,"content/blessCount/costItem2/txtCost",n),this.nodeResParent=this.findChild("resRoot"),this.nodeResItem=this.findChild("resRoot/resItem"),this.nodeResItem.active=!1,this.initResShow()},f.onCloseClick=function(){this.close()},f.initResShow=function(){var t=this;this.resItems=new Array;for(var e=function(e){var i=nodeInstantiate.instantiate(t.nodeResItem),s=y[e];t.addComponentCallbackListener(i,o.EventType.CLICK,(function(){if(1==s)IS(p).TryJumpToMainViewPanel(m.Main_Shop,m.Shop_Gem,[1]),t.close(),uiMgr.close("FateTabView");else if(2==s)IS(p).TryJumpToMainViewPanel(m.Main_Shop,m.Shop_Gem,[0]),t.close(),uiMgr.close("FateTabView");else{var e=h.findChild(i,"txtNum");IS(u).OpenItemTips(s,e)}})),i.parent=t.nodeResParent,i.active=!0;var r=h.findChildComponent(i,"imgIcon",a),d=configGoods.getDataByKey(s);t.loadIcon(r,d.icon_group,d.icon),h.findChild(i,"imgAdd").active=1==s||2==s,t.resItems.push({node:i,txtNum:h.findChildComponent(i,"txtNum",n),goodsGtid:s})},i=0;i<y.length;i++)e(i)},f.registerUpdateHandler=function(){this.addEvent(w.OnFateLotteryUpdate,this.UpdatelotteryInfo,this),this.addEvent(w.OnFateLotteryUpdate,this.updateResShow,this)},f.onAfterOpen=function(){IS(g).send_35_6(),this.updateResShow(),this.updatepreviewInfo()},f.onBeforeClose=function(){},f.onDestroy=function(){},f.updateResShow=function(){for(var t=0;t<this.resItems.length;t++)this.resItems[t].txtNum.string=c.GetNumString(IS(u).getGoodsCountByGoodsGtid(this.resItems[t].goodsGtid))},f.updatepreviewInfo=function(){for(var t=this,e=configFate_draw.getDataByList("weights",S[0][2]),i=configFate_draw.getDataByList("weights",S[1][2]),n=configFate_draw.getDataByList("weights",S[2][2]),s=configFate_draw.getDataByList("weights",S[3][2]),a=0;a<2;a++){var r=s[a].reward[0],d=configGoods.getDataByKey(r);this.wishpreviewList[a].id=d.effect[0],this.wishpreviewList[a].show()}for(var h=2;h<4;h++){var c=n[h-2].reward[0],f=configGoods.getDataByKey(c);this.wishpreviewList[h].id=f.effect[0],this.wishpreviewList[h].show()}for(var l=4;l<6;l++){var u=i[l-4].reward[0],C=configGoods.getDataByKey(u);this.wishpreviewList[l].id=C.effect[0],this.wishpreviewList[l].show()}for(var p=6;p<10;p++){var g=e[p-6].reward[0],v=configGoods.getDataByKey(g);this.wishpreviewList[p].id=v.effect[0],this.wishpreviewList[p].show()}for(var w=function(e){var i=t.findChild("content/wishpreview/"+e+"/fateIcon");t.addComponentCallbackListener(i,o.EventType.CLICK,(function(){uiMgr.openView("FateInfoView",t.wishpreviewList[e-1].id,1)}))},m=1;m<=10;m++)w(m);var I=configGoods.getDataByKey(1021);this.loadIcon(this.imgCost1,I.icon_group,I.icon),this.loadIcon(this.imgCost2,I.icon_group,I.icon),this.txtCost1.string=G[0][1][1],this.txtCost2.string=G[1][1][1]},f.UpdatelotteryInfo=function(){var t=IS(v).GetLotteryPoint();t?(this.lotteryPoint.string=t.toString()+"/"+L,this.lotteryProgress.progress=t/L):(this.lotteryPoint.string="0/"+L,this.lotteryProgress.progress=0/L);var e=IS(u).getGoodsCountByGoodsGtid(G[0][1][0]);this.txtCost1.color=e>=G[0][1][1]?new r(255,255,255):new r(204,81,68),e=IS(u).getGoodsCountByGoodsGtid(G[1][1][0]),this.txtCost2.color=e>=G[1][1][1]?new r(255,255,255):new r(204,81,68)},f.onDrawClick=function(t){if(IS(v).IsMax())C.showFlyTip(GetLanguage(200278));else{var e=IS(u).getGoodsCountByGoodsGtid(G[0][1][0]);if(e<G[t][1][1]){var i=configGoods.getDataByKey(1021),o=configGoods.getDataByKey(i.price[0]),n=(G[t][1][1]-e)*i.price[1],s=G[t][1][1]-e,a=c.formatStrWithMirrorDeal(GetLanguage(200294),n,o.name,s,i.name);C.showBoxTip({isSpecail:!1,tip:a,title:GetLanguage(200048),todayTog:"Fatepray_"+i.id,func:function(e){if("type_yes"==e){if(n>IS(u).getGoodsCountByGoodsGtid(i.price[0]))return void C.showFlyTip(GetLanguage(200257));IS(g).send_35_7(G[t][0])}}})}else IS(g).send_35_7(G[t][0])}},i}(I)),function(){function t(){this.view=void 0,this.node=void 0,this.index=void 0,this.id=void 0,this.imgIcon=void 0,this.cfg=void 0}var e=t.prototype;return e.init=function(t,e,i){this.view=e,this.node=t,this.index=i,this.onInit()},e.onInit=function(){this.imgIcon=h.findChildComponent(this.node,"fateIcon",a),this.view.addComponentCallbackListener(this.node,o.EventType.CLICK,(function(){})),this.node.active=!1},e.show=function(){this.cfg=configFate.getDataByKey(this.id),this.view.loadIcon(this.imgIcon,"icon_fate",this.cfg.icon,null,f.ICON_SPRITE),this.node.active=!0},t}());i._RF.pop()}}}));

