System.register("chunks:///_virtual/GuideView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AudioMgr.ts","./NodeUtil.ts","./StringUtil.ts","./index57.ts","./RoleControl.ts","./RoleDefine.ts","./NativeToJs.ts","./GuideModel.ts","./UIDefine.ts"],(function(t){"use strict";var i,e,s,n,o,h,c,a,u,d,r,l,k,p,v,f,T,C,g,x,b,w,G;return{setters:[function(t){i=t.regeneratorRuntime,e=t.createClass},function(t){s=t.cclegacy,n=t.Button,o=t.UITransform,h=t.Label,c=t.Node,a=t.isValid,u=t.game,d=t.Prefab,r=t.Vec3,l=t.sys,k=t.Sprite,p=t.Size},function(t){v=t.audioMgr},function(t){f=t.default},function(t){T=t.default},null,function(t){C=t.default},function(t){g=t.ClientData},function(t){x=t.NativeToJs},function(t){b=t.GuideModel},function(t){w=t.ViewEventType,G=t.ViewType}],execute:function(){s._RF.push({},"70a12hVcQRMeqxd1EhWcT/2","GuideView",void 0);var m=1,y=2,M=3,I=4,_=(t("default",function(){function t(){var t=this;this.node=void 0,this.state=0,this.guideId=0,this.guideList=void 0,this.curGuide=void 0,this.curIndex=0,this.btnClick=void 0,this.utClick=void 0,this.btnMask=void 0,this.clickFunc=void 0,this.clickObj=void 0,this.isClick=!1,this.leftTip=void 0,this.rightTip=void 0,this.curTip=void 0,this.levTip=void 0,this.task1=void 0,this.utTask1=void 0,this.txtTask1=void 0,this.task2=void 0,this.utTask2=void 0,this.txtTask2=void 0,this.task3=void 0,this.utTask3=void 0,this.txtTask3=void 0,this.isClickMask=!1,resourceMgr.loadRes("ui/module/common/GuideView",d,(function(i){var e=i.item.asset,s=nodeInstantiate.instantiate(e);s.setPosition(0,0,0),s.name="GuideView",s.parent=uiMgr.pNodes[G.GuideView],t.node=s,s.active=!1,t.onInit()}))}var e=t.prototype;return e.clear=function(){},e.onInit=function(){var t=this,i=f.findChild(this.node,"btnMask");i.on(n.EventType.CLICK,(function(){t.isClickMask&&(t.isClickMask=!1,t.onMaskClick())})),this.btnMask=i;var e=f.findChild(this.node,"btnClick");e.on(n.EventType.CLICK,(function(){t.onMaskClick()})),this.btnClick=e,this.utClick=e.getComponent(o),this.leftTip=new _(this,f.findChild(this.node,"btnClick/leftTip")),this.rightTip=new _(this,f.findChild(this.node,"btnClick/rightTip")),this.levTip=f.findChild(this.node,"btnClick/levTip"),normalEvent.on(w.EventClick,this.onViewClick,this),this.task1=f.findChild(this.node,"task1"),this.utTask1=this.task1.getComponent(o),this.txtTask1=f.findChildComponent(this.task1,"txtTask",h),this.task2=f.findChild(this.node,"task2"),this.utTask2=this.task2.getComponent(o),this.txtTask2=f.findChildComponent(this.task2,"txtTask",h),this.task3=f.findChild(this.node,"task3"),this.utTask3=this.task3.getComponent(o),this.txtTask3=f.findChildComponent(this.task3,"txtTask",h),this.txtTask1.node.on(c.EventType.SIZE_CHANGED,(function(){t.utTask1.height=t.txtTask1.node.getComponent(o).height+120})),this.txtTask2.node.on(c.EventType.SIZE_CHANGED,(function(){t.utTask2.height=t.txtTask2.node.getComponent(o).height+100})),this.txtTask3.node.on(c.EventType.SIZE_CHANGED,(function(){t.utTask3.height=t.txtTask3.node.getComponent(o).height+101}))},e.close=function(){this.state=0,uiMgr.isOpenGuide=!1,a(this.node)&&(this.node.active=!1,coroutine.stopGroup("guide"),this.clearState())},e.open=function(t){if(a(this.node)&&(this.guideId=t),this.guideList=configGuide.getDataByList("id",this.guideId),null==this.guideList||0==this.guideList.length)return this.isClick=!1,void this.close();this.node.active=!0,this.clearState(),this.curIndex=0,this.curGuide=this.guideList[this.curIndex],this.updatePassView(),this.state=1,coroutine.stopGroup("guide"),coroutine.start(this.showGuide(),"guide")},e.clearState=function(){this.btnClick.setPosition(0,99999,0),this.btnClick.active=!1,this.clickFunc=null,this.clickObj=null,this.isClick=!1,this.btnMask.active=!1,this.task1.active=!1,this.task2.active=!1,this.task3.active=!1,v.stopGuideSound()},e.updatePassView=function(){uiMgr.guidePassView=this.curGuide.pop_up_view},e.onViewClick=function(t){var i;this.isClick||(null==(i=this.curGuide)?void 0:i.force)>0||null!=this.clickObj&&null!=uiMgr.lastClickObj&&1==this.state&&uiMgr.lastClickObj!=this.clickObj&&this.close()},e.onMaskClick=function(){if(!this.isClick){this.isClick=!0;var t=this.curGuide;this.state=2,this.clickFunc&&(this.clickFunc(),this.clickFunc=null),2==this.state&&this.nextGuide(t)}},e.nextGuide=function(t){if(1==t.save&&(1==t.force?IS(C).send_3_25(t.id):IS(C).send_3_29(g.Guide,1,t.id,1)),this.task1.active=!1,this.task2.active=!1,this.task3.active=!1,v.stopGuideSound(),coroutine.stopGroup("guide"),t.next>0)this.guideList=configGuide.getDataByList("id",t.next),this.curIndex=0;else if(this.curIndex++,this.curIndex>=this.guideList.length)return void this.closeGuide();this.curGuide=this.guideList[this.curIndex],this.updatePassView(),this.state=1,coroutine.start(this.showGuide(),"guide")},e.closeGuide=function(){null!=this.curTip&&(this.curTip.active=!1),this.curTip=null,this.close()},e.showTask=i().mark((function t(e){var s,n;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=this.curGuide.tw_sound_id,"HK"==x.UseLanguage&&(s=this.curGuide.hk_sound_id),s&&s>0&&null!=(n=configSound.getDataByKey(s))&&v.playGuideSound(n.path),this.isClick=!1,e==y?(this.task1.active=!0,this.txtTask1.string=this.curGuide.text):(this.task3.active=!0,this.txtTask3.string=this.curGuide.text),t.next=7,coroutine.wait(.1);case 7:this.isClickMask=!0;case 8:case"end":return t.stop()}}),t,this)})),e.showGuide=i().mark((function t(){var e,s,n,h,c,a,d;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null!=(e=this.curGuide)){t.next=5;break}return this.close(),t.next=5,"break";case 5:this.btnMask.active=!0,s=uiMgr.getOpenView(e.scene),this.btnClick.active=!1,n=u.totalTime;case 9:if(null!=s){t.next=19;break}if(!(u.totalTime-n>5e3)){t.next=14;break}return this.close(),t.next=14,"break";case 14:return t.next=16,coroutine.wait(.1);case 16:s=uiMgr.getOpenView(e.scene),t.next=9;break;case 19:if(IS(b).guideParam=e.open_param,e.text_type!=y&&e.text_type!=I){t.next=24;break}return coroutine.start(this.showTask(e.text_type),"guide"),t.next=24,"break";case 24:return t.next=26,coroutine.wait(.01);case 26:h=s.findChild(e.clickObj),n=u.totalTime;case 28:if(null!=h){t.next=38;break}if(!(u.totalTime-n>5e3)){t.next=33;break}return this.close(),t.next=33,"break";case 33:return t.next=35,coroutine.wait(.1);case 35:h=s.findChild(e.clickObj),t.next=28;break;case 38:return null!=this.curTip&&(this.curTip.active=!1),this.curTip=null,this.isClick=!1,this.clickFunc=s.getComponentClickCallBack(h),this.btnClick.active=!0,this.clickObj=h,void(t.next=46);case 46:this.btnMask.active=e.force>0,c=h.getComponent(o),this.utClick.width=c.width>100?c.width:100,1017==e.id?(this.leftTip.active=!1,this.rightTip.active=!1,this.levTip.active=!0):this.levTip.active=!1;case 50:if(this.isClick){t.next=60;break}return this.btnClick.setWorldPosition(h.worldPosition),e.offset.length>0&&((a=new r(this.btnClick.position)).add3f(e.offset[0],e.offset[1],0),this.btnClick.position=a),1017==e.id&&(d=s.findChild("top/playerTop/levelRoot"),this.levTip.setWorldPosition(d.worldPosition),this.levTip.position=new r(this.levTip.position.x,this.levTip.position.y)),1017==e.id||e.text_type!=m||T.isEmpty(e.text)||(this.curTip=l.uiMirror?this.rightTip:this.leftTip,this.btnClick.worldPosition.x<360&&(this.leftTip.active=!1,this.curTip=l.uiMirror?this.leftTip:this.rightTip),this.curTip.active=!0,this.curTip.text=e.text),1017==e.id||e.text_type!=M||this.task2.active||(this.task2.active=!0,this.task2.position=new r(0,this.btnClick.position.y-230+this.curGuide.offset_y,0),this.txtTask2.string=e.text),t.next=58,coroutine.wait(.1);case 58:t.next=50;break;case 60:case"end":return t.stop()}}),t,this)})),t}()),function(){function t(t,i){this.view=void 0,this.node=void 0,this.txtTip=void 0,this.view=t,this.node=i;var e=i.getComponent(o),s=i.getComponent(k);this.txtTip=f.findChildComponent(i,"txtTip",h);var n=this.txtTip.node.getComponent(o);this.txtTip.node.on(c.EventType.SIZE_CHANGED,(function(){e.contentSize=new p(n.width+25,e.height),s.updateRenderer()}))}return e(t,[{key:"text",set:function(t){this.txtTip.string=t}},{key:"active",set:function(t){this.node.active=t}}]),t}());s._RF.pop()}}}));

