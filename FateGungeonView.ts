System.register("chunks:///_virtual/FateGungeonView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BattleData.ts","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./MulLanguageUtil.ts","./ChapterDataCache.ts","./ChapterDefine.ts","./DungeonControl.ts","./MessageView.ts","./FateDataCache.ts","./BaseView.ts"],(function(e){"use strict";var t,i,n,a,o,r,l,s,d,u,h,c,f,v,g,p,w,m,C,L,S,T,I;return{setters:[function(e){t=e.inheritsLoose,i=e.createForOfIteratorHelperLoose},function(e){n=e.cclegacy,a=e.Button,o=e.js,r=e.Sprite,l=e.sys,s=e.HorizontalTextAlignment,d=e.Label,u=e.ScrollView},function(e){h=e.ChapterType},function(e){c=e.ItemGrid},function(e){f=e.ListItem},function(e){v=e.default},function(e){g=e.default},function(e){p=e.default},null,function(e){w=e.default},function(e){m=e.ChapterDataCache},function(e){C=e.ChapterEventDefine},function(e){L=e.default},function(e){S=e.default},function(e){T=e.default},function(e){I=e.BaseView}],execute:function(){n._RF.push({},"3fb7emWZSZKS6r7pa/sxGk4","FateGungeonView",void 0);e("default",function(e){function n(){var t;return(t=e.call(this)||this).btnReward=void 0,t.levTips=void 0,t.txtTitle=void 0,t.dungeonScroll=void 0,t.rewardScroll=void 0,t.curLevel=1,t.totalLev=1,t.name="FateGungeonView",t.url="ui/module/fate/FateGungeonView",t.fullScreen=!0,t}t(n,e);var c=n.prototype;return c.onInit=function(){var e=this,t=this.findChild("view/info/btnFight");this.addComponentCallbackListener(t,a.EventType.CLICK,(function(){if(IS(T).IsMax())S.showFlyTip(GetLanguage(200278));else{var t=p.serverOpenTime,n=p.ServerDate(1e3*t),a=o.formatStr("%s/%s/%s %s:%s:%s",n.getFullYear(),n.getMonth()+1,n.getDate(),0,0,0),r=p.getServerDateByLocalStr(a).getTime()/1e3,l=p.serverTime-r,s=Math.floor(l/86400+1),d=e.curLevel,u=configFate_chapter.getDataByKey(d);if(s<u.time_limit)S.showFlyTip(GetLanguage(200279));else{for(var c,f=i(u.difficulty_adjust);!(c=f()).done;){var v=c.value;if(v[0]==s){for(var w,m=v[1],C=void 0,I=i(m);!(w=I()).done;){var y=w.value;1001==y[0]&&(C=y[1])}var b=g.formatStrWithMirrorDeal(GetLanguage(200280),C/100);return void S.showBoxTip({tip:b,title:GetLanguage(200048),ensure:GetLanguage(200053),cancel:GetLanguage(200054),func:function(e){"type_yes"==e&&(uiMgr.closeAllView(["MainView","MessageView","GuideView","BattleHubView"]),IS(L).reqDungeonBattleStart(h.Fate,d),battleMain.enterChapter(u.bossModel))}})}}uiMgr.closeAllView(["MainView","MessageView","GuideView","BattleHubView"]),IS(L).reqDungeonBattleStart(h.Fate,d),battleMain.enterChapter(u.bossModel)}}}));var n=this.findChild("view/btnRank");this.addComponentCallbackListener(n,a.EventType.CLICK,(function(){uiMgr.openView("FateGungeonRankView")})),this.btnReward=this.findChild("view/btnReward"),this.addComponentCallbackListener(this.btnReward,a.EventType.CLICK,(function(){for(var e,t,n=null!=(e=IS(m).getDungeonInfoByID(h.Fate).ext)?e:[],a=i(n);!(t=a()).done;){var o=t.value;if(6==o.k&&0==o.v)return void S.showFlyTip(GetLanguage(200281))}IS(L).reqFateDailyRewrad()})),this.loadIcon(n.getComponent(r),"fate_dungeon","mg_ui_phxq"),this.loadIcon(this.btnReward.getComponent(r),"fate_dungeon","mg_ui_mrjl"),l.uiMirror&&(this.findChild("view/btnRank/txtRank").setScale(1,1,1),this.findChild("view/btnReward/txtReward").setScale(1,1,1));var c=this.findChild("view/info/title/title/tips");this.addComponentCallbackListener(c,a.EventType.CLICK,(function(){var e=w.GetconfigLanguage_Text(103447).text;S.showBoxTip({title:GetLanguage(200282),tip:e,btnCnt:1,horizontalAlign:l.uiMirror?s.RIGHT:s.LEFT})}));var f=this.findChild("view/info/btnClose");this.addComponentCallbackListener(f,a.EventType.CLICK,(function(){e.close()})),this.levTips=this.findChild("view/info/levTips"),this.txtTitle=this.findChildComponent("view/info/title/title/Label",d);var C=this.findChildComponent("view/scroll",u);this.dungeonScroll=this.addUIList(C,y);var I=v.findChildComponent(this.node,"view/info/reward/rewardScroll",u);this.rewardScroll=this.addUIList(I,b),this.rewardScroll.lackCenter=!0},c.registerUpdateHandler=function(){this.addEvent(C.DUNGEON_UPDATE,this.UpdateInfo,this)},c.onAfterOpen=function(){this.curLevel=IS(m).getDungeonInfoByID(h.Fate).max_level;var e=configFate_chapter.getDataByKey(this.curLevel);this.txtTitle.string=g.formatStrWithMirrorDeal(GetLanguage(200283),e.level),this.rewardScroll.datas=e.first_reward;var t=p.serverOpenTime,n=p.ServerDate(1e3*t),a=o.formatStr("%s/%s/%s %s:%s:%s",n.getFullYear(),n.getMonth()+1,n.getDate(),0,0,0),r=p.getServerDateByLocalStr(a).getTime()/1e3,l=p.serverTime-r,s=Math.floor(l/86400+1);this.levTips.active=!1;for(var d,u=i(e.difficulty_adjust);!(d=u()).done;){d.value[0]==s&&(this.levTips.active=!0)}var c=[].concat(configFate_chapter.getDatas());c.sort((function(e,t){return t.index-e.index})),this.totalLev=c.length,this.dungeonScroll.datas=c,this.dungeonScroll.scrollTo(this.totalLev-e.index-1,0),this.UpdateBtnReward()},c.onBeforeClose=function(){},c.onDestroy=function(){},c.UpdateInfo=function(){this.curLevel=IS(m).getDungeonInfoByID(h.Fate).max_level;var e=configFate_chapter.getDataByKey(this.curLevel);this.txtTitle.string=g.formatStrWithMirrorDeal(GetLanguage(200283),e.level),this.rewardScroll.datas=e.first_reward;var t=p.serverOpenTime,n=p.ServerDate(1e3*t),a=o.formatStr("%s/%s/%s %s:%s:%s",n.getFullYear(),n.getMonth()+1,n.getDate(),0,0,0),r=p.getServerDateByLocalStr(a).getTime()/1e3,l=p.serverTime-r,s=Math.floor(l/86400+1);this.levTips.active=!1;for(var d,u=i(e.difficulty_adjust);!(d=u()).done;){d.value[0]==s&&(this.levTips.active=!0)}this.dungeonScroll.updateAll(),this.dungeonScroll.scrollTo(this.totalLev-e.index-1,1),this.UpdateBtnReward()},c.UpdateBtnReward=function(){for(var e,t,n=!1,a=null!=(e=IS(m).getDungeonInfoByID(h.Fate).ext)?e:[],o=i(a);!(t=o()).done;){var r=t.value;if(6==r.k&&0!=r.v){n=!0;break}}this.btnReward.active=n},n}(I));var y=function(e){function i(){for(var t,i=arguments.length,n=new Array(i),a=0;a<i;a++)n[a]=arguments[a];return(t=e.call.apply(e,[this].concat(n))||this).imgTitle=void 0,t.txtTitle=void 0,t.boss=void 0,t.bossModel=void 0,t}t(i,e);var n=i.prototype;return n.onInit=function(){this.boss=v.findChild(this.node,"boss"),this.imgTitle=v.findChildComponent(this.node,"title",r),this.txtTitle=v.findChildComponent(this.node,"title/Label",d),l.uiMirror&&this.txtTitle.node.setScale(1,1,1)},n.onRender=function(e,t){this.txtTitle.string=g.formatStrWithMirrorDeal(GetLanguage(200284),e.level),e.level<this.view.curLevel?this.view.loadIcon(this.imgTitle,"fate_dungeon","mg_ui_csdi"):e.level==this.view.curLevel?this.view.loadIcon(this.imgTitle,"fate_dungeon","mg_ui_csdi02"):this.view.loadIcon(this.imgTitle,"fate_dungeon","mg_ui_csdi01");var i=configUnitModel.getDataByKey(e.bossModel);this.bossModel&&(this.view.removeUIEffect(this.bossModel),this.bossModel=null),this.bossModel=this.view.addUIEffect(i.path,this.boss,-1,null,i.scale/100*1.04,(function(e){l.uiMirror&&(e.dir=-1)}))},i}(f),b=function(e){function i(){for(var t,i=arguments.length,n=new Array(i),a=0;a<i;a++)n[a]=arguments[a];return(t=e.call.apply(e,[this].concat(n))||this).itemGridNode=void 0,t.itemGrid=void 0,t}t(i,e);var n=i.prototype;return n.onInit=function(){this.itemGridNode=v.findChild(this.node,"itemGrid"),this.itemGrid=new c(this.view,this.itemGridNode)},n.onRender=function(e,t){this.itemGrid.SetItemId(e[0],e[1])},i}(f);n._RF.pop()}}}));

