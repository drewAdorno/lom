System.register("chunks:///_virtual/FlyPetUseSelectView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./index57.ts","./ItemIcon.ts","./MessageView.ts","./PrivilegeDataCache.ts","./FlyPetControl.ts","./FlyPetDataCache.ts","./FlyPetDefine.ts","./BaseView.ts"],(function(t){"use strict";var e,i,n,o,s,l,a,d,c,h,r,f,p,u,_,v,y,C,g,m,k;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,n=t.Button,o=t.Sprite,s=t.Label,l=t.Node,a=t.UITransform,d=t.Size,c=t.ScrollView,h=t.Toggle,r=t.js},function(t){f=t.ListItem},function(t){p=t.default},function(t){u=t.default},null,function(t){_=t.IconAseetType},function(t){v=t.default},function(t){y=t.PrivilegeDataCache},function(t){C=t.default},function(t){g=t.default},function(t){m=t.FlyPetQualityRes},function(t){k=t.BaseView}],execute:function(){i._RF.push({},"7f95bTZCxRF4Ktbhr6vy7KV","FlyPetUseSelectView",void 0);t("default",function(t){function i(){var e;return(e=t.call(this)||this).pet_frame=void 0,e.pet_icon=void 0,e.pet_name=void 0,e.pet_lv=void 0,e.pet_age=void 0,e.pet_quality=void 0,e.pet_use_num=void 0,e.quality_list={},e.pet_skill_frame=void 0,e.pet_skill_icon=void 0,e.pet_skill_name=void 0,e.pet_skill_desc=void 0,e.pet_skill_cd=void 0,e.beskill_list=void 0,e.select_pet=void 0,e.select_pet_info=void 0,e.tog=void 0,e.pet_list=void 0,e.empty=void 0,e.notice=void 0,e.nodeSkill=void 0,e.nodeChange=void 0,e.name="FlyPetUseSelectView",e.url="ui/module/flypet/FlyPetUseSelectView",e}e(i,t);var f=i.prototype;return f.onInit=function(){var t,e=this;this.empty=this.findChild("container/empty"),this.notice=this.findChild("container/notice"),this.nodeSkill=this.findChild("container/nodeSkill"),this.nodeChange=this.findChild("container/nodeChange");var i=this.findChild("imgMask");this.addComponentCallbackListener(i,n.EventType.CLICK,(function(){e.onMaskClick()}));var r=this.findChild("container/btnClose");this.addComponentCallbackListener(r,n.EventType.CLICK,(function(){e.onMaskClick()})),this.pet_frame=this.findChildComponent("container/notice/head/frame",o),this.pet_icon=this.findChildComponent("container/notice/head/icon",o),this.pet_name=this.findChildComponent("container/notice/txtName",s),this.pet_lv=this.findChildComponent("container/notice/txtLv",s);var f=this.findChild("container/notice/ageIcon");this.addComponentCallbackListener(f,n.EventType.CLICK,(function(){var t=IS(g).GetUseTimeByAge(e.select_pet_info.info.generation),i=Math.floor(t/3600),n=Math.ceil((t-3600*i)/60);uiMgr.openView("JobSkillTipsView",u.formatStrWithMirrorDeal(GetLanguage(205242),e.select_pet_info.info.generation,i,n),f)})),this.pet_age=this.findChildComponent("container/notice/ageIcon/txtAge",s),this.pet_use_num=this.findChildComponent("container/notice/useNode/num",s);var _=this.findChild("container/notice/useNode/tips");this.addComponentCallbackListener(_,n.EventType.CLICK,(function(){if(e.select_pet&&0!=e.select_pet){var t=0,i=IS(g).GetHaveUseItemById(e.select_pet);i&&(t=i.other_times);for(var n,o=IS(g).GetUseCDCfg(t,1),s=configFly.getDataByKey(e.select_pet_info.info.config_id),l=0;l<o.cd.length;l++)o.cd[l][0]==s.quality&&(n=o.cd[l]);var a=1;IS(y).checkPrivilegeCardHasBuy(6)&&(a=1-configPrivilege_card.getDataByKey(6006).value[2]/1e4);var d=Math.floor(n[1]*a/3600),c=Math.ceil((n[1]*a-3600*d)/60);uiMgr.openView("JobSkillTipsView",u.formatStrWithMirrorDeal(GetLanguage(205154),t,d,c),_)}})),this.pet_quality=this.findChildComponent("container/notice/txtQuality",s),this.pet_skill_frame=this.findChildComponent("container/nodeSkill/Frame",o),this.pet_skill_icon=this.findChildComponent("container/nodeSkill/Icon",o),this.pet_skill_name=this.findChildComponent("container/nodeSkill/txtName",s),this.pet_skill_desc=this.findChildComponent("container/nodeSkill/ScrollView/view/content/item",s),this.pet_skill_desc.node.on(l.EventType.SIZE_CHANGED,(function(){var t=e.findChildComponent("container/nodeSkill/ScrollView/view/content",a),i=e.findChildComponent("container/nodeSkill/ScrollView/view/content/item",a);t.contentSize=new d(t.contentSize.x,i.height+10)})),this.pet_skill_cd=this.findChildComponent("container/nodeSkill/cd/cd",s);var m=this.findChildComponent("container/nodeChange/ScrollView",c);this.beskill_list=this.addUIList(m,I);var k=this.findChildComponent("container/ScrollView",c);this.pet_list=this.addUIList(k,S),this.tog=this.findChildComponent("container/checkDesc",h),this.addComponentCallbackListener(this.tog.node,h.EventType.TOGGLE,(function(){e.tog.isChecked&&v.showFlyTip(GetLanguage(205234))})),this.adjustMirrorNode(this.findChild("container/checkDesc/Checkmark"));var w=this.findChild("container/btnEnsure");this.addComponentCallbackListener(w,n.EventType.CLICK,(function(){var t=0;if(e.tog.isChecked&&(t=1),e.select_pet&&0!=e.select_pet){var i=GetLanguage(205238);v.showBoxTip({tip:i,title:GetLanguage(200048),func:function(i){"type_yes"==i&&(IS(C).send_66_23(e.select_pet,0,t),e.close())}})}else v.showFlyTip(GetLanguage(205170))}));var L=this.findChild("container/btnCancel");this.addComponentCallbackListener(L,n.EventType.CLICK,(function(){e.close()}));for(var q=((t={})[1]=205054,t[2]=205055,t[3]=205056,t),B=1;B<=3;B++){var D=this.findChild("container/notice/quality/quality"+B),F=p.findChildComponent(D,"txtQuality",s);F.string=GetLanguage(q[B]),this.quality_list[B]={node:D,name:F}}},f.updateEntry=function(t){var e,i=null!=t?t:[],n=((e={})[3]=1,e[2]=2,e[5]=3,e[1]=4,e[4]=5,e[6]=6,e);i.sort((function(t,e){var i=configFly_entry.getDataByKeys("id",t.k,"level",t.v),o=configFly_entry.getDataByKeys("id",e.k,"level",e.v);return i.quality==o.quality?t.id-e.id:n[i.quality]-n[o.quality]})),this.beskill_list.datas=i},f.updateSkill=function(t){var e=null!=t?t:[];if(!(e.length<=0)){var i=e[0][0],n=configSkill.getDataByKey(i),o=configSkill_level.getDataByKeys("id",i,"level",e[0][1]);this.loadIcon(this.pet_skill_frame,"icon_skill",r.formatStr("common_ICON_jinengkuang0%s",n.quality)),this.loadIcon(this.pet_skill_icon,"icon_skill",n.icon,null,_.ICON_SPRITE),this.pet_skill_name.string=n.name,this.pet_skill_desc.string=u.formatStr.apply(u,[o.desc].concat(o.desc_parm))}},f.updateEmpty=function(){this.empty.active=!this.select_pet||0==this.select_pet,this.notice.active=this.select_pet&&0!=this.select_pet,this.nodeChange.active=this.select_pet&&0!=this.select_pet,this.nodeSkill.active=this.select_pet&&0!=this.select_pet},f.onMaskClick=function(){this.close()},f.SelectPet=function(t){this.select_pet=t.info.id,this.select_pet_info=t,this.pet_list.updateAll(),this.updateInfo(),this.updateEmpty()},f.updateInfo=function(){this.tog.isChecked=1==this.select_pet_info.is_save;var t=configFly.getDataByKey(this.select_pet_info.info.config_id),e=IS(g).GetPetInfoById(this.select_pet);this.pet_name.string=t.name,1==IS(g).GetIsBianYi(e.entry_list)&&(this.pet_name.string=r.formatStr(GetLanguage(205206),t.name)),""!=e.name&&(this.pet_name.string=e.name),this.pet_lv.string="Lv."+e.level,this.pet_age.string=u.formatStrWithMirrorDeal(GetLanguage(205240),e.generation);var i=0,n=IS(g).GetHaveUseItemById(this.select_pet);n&&(i=n.other_times),this.pet_use_num.string=i+"";for(var o=1;o<=3;o++)o==t.quality?this.quality_list[o].node.active=!0:this.quality_list[o].node.active=!1;this.loadIcon(this.pet_frame,"icon_equip",m[t.quality]),this.loadIcon(this.pet_icon,"icon_flypet",t.icon);var s=configFly_advance.getDataByKeys("id",e.config_id,"advance_level",e.step);this.updateSkill(s.fly_skill),this.updateEntry(e.entry_list)},f.onAfterOpen=function(){this.select_pet=0,this.updateData(),this.updateEmpty()},f.registerUpdateHandler=function(){},f.onBeforeClose=function(){},f.updateData=function(){var t=IS(g).GetShowList();t.sort((function(t,e){var i=configFly.getDataByKey(t.info.config_id),n=configFly.getDataByKey(e.info.config_id),o=IS(g).GetPetInfoById(t.info.id),s=IS(g).GetPetInfoById(e.info.id),l=IS(g).GetExtByKey(o,1),a=IS(g).GetExtByKey(s,1);return l!=a?a-l:t.info.level!=e.info.level?e.info.level-t.info.level:t.info.step!=e.info.step?e.info.step-t.info.step:i.quality!=n.quality?n.quality-i.quality:t.info.config_id-e.info.config_id})),this.pet_list.datas=t,t.length>0&&0==this.select_pet&&this.SelectPet(t[0])},f.onDestroy=function(){},i}(k));var I=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).addIcon=void 0,e.downIcon=void 0,e.txtName=void 0,e.skill_cfg=void 0,e.quality_list={},e}e(i,t);var o=i.prototype;return o.onInit=function(){var t=this;this.txtName=p.findChildComponent(this.node,"txtName",s),this.addIcon=p.findChild(this.node,"add"),this.downIcon=p.findChild(this.node,"down");for(var e=1;e<=6;e++){var i=p.findChild(this.node,"quality/quality"+e),o=p.findChildComponent(i,"txtQuality",s);this.quality_list[e]={node:i,name:o}}this.view.addComponentCallbackListener(this.node,n.EventType.CLICK,(function(){uiMgr.openView("JobSkillTipsView",u.formatStr.apply(u,[t.skill_cfg.desc].concat(t.skill_cfg.desc_parm)),t.txtName.node)}))},o.onRender=function(t,e){var i=configFly_entry.getDataByKeys("id",t.k,"level",t.v);this.skill_cfg=i,this.txtName.string=i.name;for(var n=1;n<=6;n++)n==i.quality?(this.quality_list[n].node.active=!0,this.quality_list[n].name.string=i.name):this.quality_list[n].node.active=!1},o.onItemClick=function(){},i}(f),S=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).imgFrame=void 0,e.imgIcon=void 0,e.add=void 0,e.sel=void 0,e.state=void 0,e.txtState=void 0,e.cdNode=void 0,e.star=void 0,e.p_view=void 0,e}e(i,t);var l=i.prototype;return l.onInit=function(){var t=this;this.state=p.findChild(this.node,"state"),this.txtState=p.findChildComponent(this.node,"nodeUse/label",s),this.imgFrame=p.findChildComponent(this.node,"frame",o),this.imgIcon=p.findChildComponent(this.node,"icon",o),this.star=p.findChild(this.node,"star"),this.add=p.findChild(this.node,"add"),this.cdNode=p.findChild(this.node,"cd"),this.sel=p.findChild(this.node,"sel"),this.p_view=this.view,this.view.addComponentCallbackListener(this.node,n.EventType.CLICK,(function(){t.p_view.SelectPet(t.data)}))},l.onRender=function(t,e){var i=configFly.getDataByKey(t.info.config_id);this.view.loadIcon(this.imgIcon,"icon_flypet",i.icon),this.view.loadIcon(this.imgFrame,"icon_equip",m[i.quality]);var n=t.state,o=IS(g).GetHaveUseItemById(t.info.id);o&&(n=o.other_state),this.state.active=1==n,this.cdNode.active=2==n,this.sel.active=this.p_view.select_pet==this.data.info.id;var s=IS(g).GetPetInfoById(this.data.info.id);this.star.active=1==IS(g).GetExtByKey(s,1)},l.onItemClick=function(){},i}(f);i._RF.pop()}}}));

