System.register("chunks:///_virtual/DoubleChapterEnterView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./ItemIcon.ts","./ObjectUtil.ts","./CommonModel.ts","./MessageView.ts","./ChapterDataCache.ts","./ChapterDefine.ts","./DungeonControl.ts","./UIDefine.ts","./BaseSubView.ts"],(function(t){"use strict";var e,i,o,n,a,d,s,l,r,h,m,u,p,f,c,C,I,v,g,b,_,y,x,S,L,w;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,o=t.Button,n=t.Label,a=t.ProgressBar,d=t.HorizontalTextAlignment,s=t.Sprite,l=t.LabelOutline,r=t.ScrollView,h=t.Layout,m=t.Color,u=t.js},function(t){p=t.SelectedType,f=t.ListItem},function(t){c=t.default},function(t){C=t.default},function(t){I=t.default},null,function(t){v=t.IconAseetType},function(t){g=t.default},function(t){b=t.CommonModel},function(t){_=t.default},function(t){y=t.ChapterDataCache},function(t){x=t.ChapterEventDefine},function(t){S=t.default},function(t){L=t.PanelTabType},function(t){w=t.BaseSubView}],execute:function(){i._RF.push({},"3a1a0eyI01HY5a8sv1ueXcb","DoubleChapterEnterView",void 0);var M=[0,.18,.4,.62,.85,1],R=(t("default",function(t){function i(){var e;return(e=t.call(this)||this).txtCurLevel=void 0,e.txtMaxLevel=void 0,e.pbPart=void 0,e.points=[],e.txtTime=void 0,e.btnGoto=void 0,e.btnSelect=void 0,e.imgGotoBg=void 0,e.outlineGoto=void 0,e.scrollRewardList=void 0,e.teammateItem=void 0,e.myselfItem=void 0,e.nodeScroll=void 0,e.nodeNoReward=void 0,e.time=0,e.modelMySelf=void 0,e.modelTeammate=void 0,e.nodeMax=void 0,e.txtMax=void 0,e.name="DoubleChapterEnterView",e.url="ui/module/dungeon/DoubleChapterEnterView",e}e(i,t);var f=i.prototype;return f.onInit=function(){var t=this,e=this.findChild("btnTip");this.addComponentCallbackListener(e,o.EventType.CLICK,(function(){uiMgr.openView("ParkingRuleTips",[204794])})),this.txtCurLevel=this.findChildComponent("title/Label",n),this.txtMaxLevel=this.findChildComponent("record/Label",n),this.pbPart=c.findChildComponent(this.node,"pbPart",a);for(var i=1;i<=6;++i)this.points[i-1]=new R(c.findChild(this.pbPart.node,"point"+i),i);this.pbPart.progress=0,this.nodeMax=this.findChild("isMax"),this.txtMax=this.nodeMax.getComponent(n);var m=this.findChild("subTitle/btnTip");this.addComponentCallbackListener(m,o.EventType.CLICK,(function(){_.showBoxTip({tip:GetLanguage(204795),btnCnt:1,horizontalAlign:d.LEFT})})),this.txtTime=this.findChildComponent("time/txtTime",n),this.btnGoto=this.findChild("btnGoto"),this.addComponentCallbackListener(this.btnGoto,o.EventType.CLICK,(function(){(IS(y).doubleChapterInfo.now_dc_level||1)>IS(y).getMaxDoubleChapterId()||uiMgr.openView("DoubleChapterLevelMainView")})),this.imgGotoBg=this.btnGoto.getComponent(s),this.outlineGoto=this.findChildComponent("btnGoto/Label",l),this.btnSelect=this.findChild("btnSelect"),this.addComponentCallbackListener(this.btnSelect,o.EventType.CLICK,(function(){t.parentView.setIndex(L.DoubleChapter_Teammate)}));var u=this.findChildComponent("scrollRewardList",r);this.nodeScroll=u.node,this.scrollRewardList=this.addUIList(u,T),this.scrollRewardList.selectedMode=p.SINGLE,this.teammateItem=this.getRoleItem(this.findChild("nodeTeammate")),this.myselfItem=this.getRoleItem(this.findChild("nodeMyself")),this.nodeNoReward=this.findChild("txtNoReward"),this.adjustMirrorNode(this.myselfItem.nodeEmpty,-60),this.adjustMirrorNode(this.teammateItem.nodeEmpty,-60),this.adjustMirrorNode(this.myselfItem.nodeRole,20),this.adjustMirrorNode(this.teammateItem.nodeRole,20),this.dealMirrorLayout(this.findChildComponent("time",h)),this.myselfItem.nodeEmpty.active=!1},f.getRoleItem=function(t){return{node:t,nodeEmpty:c.findChild(t,"empty"),nodeRole:c.findChild(t,"role"),txtName:c.findChildComponent(t,"txtName",n),txtLevel:c.findChildComponent(t,"txtLevel",n),pbHp:c.findChildComponent(t,"pbHp",a),imgBar:c.findChildComponent(t,"pbHp/Bar",s),nodeCantFight:c.findChild(t,"txtCantFight"),txtHp:c.findChildComponent(t,"txtHp",n)}},f.registerUpdateHandler=function(){this.addEvent(x.DOUBLE_CHAPTER_INFO_BACK,this.updateInfo,this),this.addEvent(x.DOUBLE_CHAPTER_INFO_UPDATE,this.updateInfo,this),this.addEvent(x.DOUBLE_CHAPTER_ENTRANCE_INFO_BACK,this.updateReward,this),this.addEvent(x.DOUBLE_CHAPTER_REWARD_UPDATE,this.updateReward,this)},f.onAfterOpen=function(){IS(S).reqDoubleChapterInfo(),this.txtMax.string=GetLanguage(205187),this.updateReward()},f.updateReward=function(){var t=IS(y).doubleChapterEntraceInfo,e=t?t.max_reward_num:0;null==e&&(e=0),this.nodeNoReward.active=e<=0,this.nodeScroll.active=e>0;for(var i=new Array,o=0;o<e;o++)i.push(o);this.scrollRewardList.datas=i},f.updateInfo=function(){if(null!=IS(y).doubleChapterInfo){var t=IS(y).doubleChapterInfo.now_dc_level||1,e=IS(y).doubleChapterInfo.max_dc_level||1,i=t>IS(y).getMaxDoubleChapterId()?configDouble_ladder_chapter.getDataByKey(t-1):configDouble_ladder_chapter.getDataByKey(t);this.txtCurLevel.string=C.formatStrWithMirrorDeal(GetLanguage(201888),i.chapter);var o=configDouble_ladder_chapter.getDataByKey(e);this.txtMaxLevel.string=C.formatStrWithMirrorDeal(GetLanguage(201887),o.chapter);var n=t>IS(y).getMaxDoubleChapterId();this.loadIcon(this.imgGotoBg,"common",n?"common_ICON_zhihuianniu":"common_ICON_luanniu"),this.outlineGoto.color=n?new m(76,76,76):new m(41,65,21),this.nodeMax.active=n,this.pbPart.node.active=!n,this.txtCurLevel.node.active=!n;for(var a=i.index,d=1;d<=6;++d){var s=-1;d<a&&(s=1),d==a&&(s=2),6==d&&(s=3),this.points[d-1].setState(s)}this.pbPart.progress=M[a-1],this.myselfItem.txtName.string=IS(y).doubleChapterInfo.my_name,this.myselfItem.txtLevel.string=u.formatStr("Lv.%s",IS(y).doubleChapterInfo.level);var l=IS(y).doubleChapterInfo.my_hp/IS(y).doubleChapterInfo.my_max_hp,r=IS(y).doubleChapterInfo.my_hp<=0;this.loadIcon(this.myselfItem.imgBar,"double_chapter",this.getHpBarImgByHpRate(l),null,v.UI_ATLAS,!0),this.myselfItem.nodeCantFight.active=r,null!=this.modelMySelf&&(this.removeUnitModel(this.modelMySelf),this.modelMySelf=null);var h,p=g.clone(IS(y).doubleChapterInfo.my_figure);p.artifact_figure=0;for(var f=0;f<p.equip_list.length;f++)if(5==p.equip_list[f].k){h=f;break}h&&p.equip_list.splice(h,1),this.modelMySelf=IS(b).AddRoleModel(this,p,this.myselfItem.nodeRole),this.getUnitModel(this.modelMySelf).mount=0,this.myselfItem.txtHp.string=u.formatStr("%s%",(100*l).toFixed(1)),this.myselfItem.pbHp.progress=l,this.getUnitModel(this.modelMySelf).aniColor=l<=0?new m(0,0,0,122):new m(255,255,255,255);var c=IS(y).doubleChapterInfo.teammate_id||0;if(this.teammateItem.txtName.node.active=0!=c,this.teammateItem.txtLevel.node.active=0!=c,this.teammateItem.nodeRole.active=0!=c,this.teammateItem.nodeEmpty.active=0==c,this.teammateItem.pbHp.node.active=0!=c,this.teammateItem.txtHp.node.active=0!=c,this.btnGoto.active=0!=c,this.btnSelect.active=0==c&&!n,0!=this.modelTeammate&&(this.removeUnitModel(this.modelTeammate),this.modelTeammate=null),0!=c){this.teammateItem.txtName.string=IS(y).doubleChapterInfo.teammate_name,this.teammateItem.txtLevel.string=u.formatStr("Lv.%s",IS(y).doubleChapterInfo.teammate_level);var I=IS(y).doubleChapterInfo.teammate_hp/IS(y).doubleChapterInfo.teammate_max_hp,_=IS(y).doubleChapterInfo.teammate_hp<=0;this.loadIcon(this.teammateItem.imgBar,"double_chapter",this.getHpBarImgByHpRate(I),null,v.UI_ATLAS,!0),this.teammateItem.nodeCantFight.active=_,this.teammateItem.pbHp.progress=I;var x,S=g.clone(IS(y).doubleChapterInfo.teammate_figure);S.artifact_figure=0;for(var L=0;L<S.equip_list.length;L++)if(5==S.equip_list[L].k){x=L;break}x&&S.equip_list.splice(x,1),this.modelTeammate=IS(b).AddRoleModel(this,S,this.teammateItem.nodeRole),this.getUnitModel(this.modelTeammate).mount=0,this.teammateItem.txtHp.string=u.formatStr("%s%",(100*I).toFixed(1)),this.getUnitModel(this.modelTeammate).aniColor=I<=0?new m(0,0,0,122):new m(255,255,255,255)}else this.teammateItem.nodeCantFight.active=!1}},f.getHpBarImgByHpRate=function(t){return t>=.5?"srfb_ui_jdt_g":t>=.2?"srfb_ui_jdt_y":"srfb_ui_jdt_r"},f.onBeforeClose=function(){this.time=0},f.onDestroy=function(){},f.onUpdate=function(t){this.time=this.time+t,this.time>=1&&(this.time=0,this.updateTime())},f.updateTime=function(){var t=IS(y).doubleChapterEntraceInfo?IS(y).doubleChapterEntraceInfo.end_time:0;t||(t=0);var e=Math.max(0,t-I.serverTime);this.txtTime.string=I.formatTimeStringForSecond(e)},i}(w)),function(){function t(t,e){this.node=void 0,this.index=void 0,this.states=[],this.node=t,this.index=e;for(var i=1;i<=2;i++)this.states.push(c.findChild(t,"state"+i))}return t.prototype.setState=function(t){if(-1!=t){this.node.active=!0;for(var e=0;e<this.states.length;e++)this.states[e].active=t==e+1}else this.node.active=!1},t}()),T=function(t){function i(){for(var e,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return(e=t.call.apply(t,[this].concat(o))||this).nodeAdd=void 0,e.nodeRed=void 0,e.imgFrame=void 0,e.imgIcon=void 0,e.txtNum=void 0,e}e(i,t);var o=i.prototype;return o.onInit=function(){this.nodeAdd=c.findChild(this.node,"btnWear"),this.nodeRed=c.findChild(this.node,"point"),this.imgFrame=c.findChildComponent(this.node,"imgFrame",s),this.imgIcon=c.findChildComponent(this.node,"imgIcon",s),this.txtNum=c.findChildComponent(this.node,"num",n)},o.onRender=function(t,e){var i=IS(y).getChooseRewardByIndex(t);if(this.nodeAdd.active=null==i,this.nodeRed.active=null==i,this.imgIcon.node.active=null!=i,this.txtNum.node.active=null!=i,null==i)this.view.loadIcon(this.imgFrame,"icon_equip","zjm_ui_pinzhikuangbai");else{for(var o,n=i.k,a=0;a<configDouble_ladder_chapter.getDatas().length;a++){var d=configDouble_ladder_chapter.getDatas()[a];if(d.chapter==n&&d.final_reward_unlock&&d.final_reward_unlock.length>0){o=d;break}}var s=o.final_reward_unlock[i.v-1],l=s[0],r=configGoods.getDataByKey(l),h=configColor.getDataByKey(r.quality);this.view.loadIcon(this.imgFrame,"icon_equip",h.path),this.view.loadIcon(this.imgIcon,r.icon_group,r.icon),this.txtNum.string=s[1]}},o.onItemClick=function(){uiMgr.openView("DoubleChapterRewardSelectView")},i}(f);i._RF.pop()}}}));

