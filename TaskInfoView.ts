System.register("chunks:///_virtual/TaskInfoView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./V2.ts","./AudioMgr.ts","./index3.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./index57.ts","./ItemIcon.ts","./UIEffectAsset.ts","./ObjectUtil.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./BagModel.ts","./GuideModel.ts","./MessageView.ts","./RoleDataCache.ts","./TaskControl.ts","./TaskDataCache.ts","./TaskDefine.ts","./EaseMethod.ts","./BaseSubView.ts"],(function(t){"use strict";var i,n,e,o,s,a,d,r,c,h,l,f,u,g,m,p,v,y,C,I,x,b,k,P,w,_,D,S,T,B,L,G,F,A;return{setters:[function(t){i=t.inheritsLoose},function(t){n=t.cclegacy,e=t.Label,o=t.ProgressBar,s=t.Sprite,a=t.Button,d=t.ScrollView,r=t.UITransform,c=t.Vec3,h=t.js,l=t.sys},function(t){f=t.V2},function(t){u=t.audioMgr},null,function(t){g=t.ListItem},function(t){m=t.default},function(t){p=t.default},null,function(t){v=t.IconAseetType},function(t){y=t.UIEffectAsset},function(t){C=t.default},function(t){I=t.default},function(t){x=t.ActivityType,b=t.ActivityState},function(t){k=t.BagModel},function(t){P=t.GuideModel},function(t){w=t.default},function(t){_=t.RoleDataCache},function(t){D=t.default},function(t){S=t.TaskDataCache},function(t){T=t.DailyBoxState,B=t.TaskEventDefine,L=t.TaskType,G=t.TaskState},function(t){F=t.EasingMethod},function(t){A=t.BaseSubView}],execute:function(){n._RF.push({},"dae7bPUN3pOybmdDGbi4dMb","TaskInfoView",void 0);t("default",function(t){function n(){var i;return(i=t.call(this)||this).maxPoint=0,i.taskList=void 0,i.txtPoint=void 0,i.txtProgress=void 0,i.pb=void 0,i.pb2=void 0,i.boxList=[],i.nodeFly=void 0,i.utFly=void 0,i.target=void 0,i.imgPig1=void 0,i.imgPig2=void 0,i.btnPiggyBank=void 0,i.name="TaskInfoView",i.url="ui/module/task/TaskInfoView",i}i(n,t);var g=n.prototype;return g.onInit=function(){var t=this;this.txtPoint=this.findChildComponent("view/top/txtPoint",e),this.txtProgress=this.findChildComponent("view/nodePiggyBank/ProgressBar/Label",e),this.pb=this.findChildComponent("view/top/ProgressBar",o),this.pb2=this.findChildComponent("view/nodePiggyBank/ProgressBar",o),this.imgPig1=this.findChildComponent("view/nodePiggyBank/imgPig1",s),this.imgPig2=this.findChildComponent("view/nodePiggyBank/imgPig2",s),this.btnPiggyBank=this.findChild("view/nodePiggyBank"),this.addComponentCallbackListener(this.btnPiggyBank,a.EventType.CLICK,(function(){uiMgr.openView("PiggyBankView")}));var i=IS(_).CheckFuncOpen(configActicity_sheet.getDataByKey(1).open[1]),n=!0,c=IS(I).GetActivityInfo(x.PiggyBank);c&&c.state!=b.Null||(n=!1),this.btnPiggyBank.active=i&&n;for(var f=function(i){var n=m.findChild(t.node,h.formatStr("view/top/ProgressBar/box%s",i+1)),o={imgFrame:m.findChildComponent(n,"imgFrame",s),imgIcon:m.findChildComponent(n,"imgFrame/imgIcon",s),txtPoint:m.findChildComponent(n,"point",e),txtNum:m.findChildComponent(n,"txtNum",e),mask:m.findChild(n,"mask"),received:m.findChild(n,"received"),boxCfg:configDaily_task_reward.getDataByKey(i+1),itemId:0,eff:null};t.addComponentCallbackListener(o.imgFrame.node,a.EventType.CLICK,(function(){t.onClickItemBox(o)})),l.uiMirror&&t.loadIcon(o.received.getComponent(s),"player","grxx_ui_gouxuan"),t.boxList.push(o)},u=0;u<5;u++)f(u);var g=this.findChildComponent("view/taskList",d);this.taskList=this.addUIList(g,N,!0,1,1),this.nodeFly=this.findChild("flyRoot"),this.utFly=this.nodeFly.getComponent(r),this.target=this.findChild("target")},g.onMaskClick=function(){this.close()},g.onCloseClick=function(){this.close()},g.onClickItemBox=function(t){var i=t.boxCfg,n=IS(S).GetDailyBoxList();IS(S).GetDailyPoint()>=i.point&&n[i.box_id]==T.Normal?IS(D).send_10_6():n[i.box_id]==T.Received?w.showFlyTip(GetLanguage(200314)):IS(k).OpenItemTips(t.itemId,t.imgFrame.node)},g.registerUpdateHandler=function(){this.addEvent(B.TASK_INFO_UPDATE,this.updateTaskInfo,this),this.addEvent(B.TASK_DAILY_UPDATE,this.updateBoxInfo,this),this.addEvent(B.Task_FLY_DIAMOND,this.flyDiamo,this)},g.onAfterOpen=function(){var t=configDaily_task_reward.getDatas();this.maxPoint=t[t.length-1].point;for(var i=0;i<5;i++){var n=t[i];this.boxList[i].itemId=n.reward[0][0],this.boxList[i].txtPoint.string=String(n.point),this.boxList[i].txtNum.string=n.reward[0][1];var e=n.reward[0][0],o=configGoods.getDataByKey(e),s=o.quality,a=void 0;a=3==o.type?"icon_skill":4==o.type?"icon_pet":"icon_item";var d=configColor.getDataByKey(s);this.loadIcon(this.boxList[i].imgIcon,a,o.icon,null,v.UI_ATLAS,!0),this.loadIcon(this.boxList[i].imgFrame,"icon_equip",d.path)}this.updateTaskInfo(),this.updateBoxInfo()},g.onBeforeClose=function(){for(var t=0;t<5;t++)this.boxList[t].eff=null},g.onDestroy=function(){},g.updateBoxInfo=function(){var t=IS(S).GetDailyPoint();this.txtPoint.string=String(t),this.pb.progress=t/this.maxPoint,this.pb2.progress=t/this.maxPoint,this.txtProgress.string=t+"/"+this.maxPoint,t<this.maxPoint?(this.imgPig1.node.active=!0,this.imgPig2.node.active=!1):(this.imgPig1.node.active=!1,this.imgPig2.node.active=!0);for(var i=IS(S).GetDailyBoxList(),n=0;n<5;n++){var e=configDaily_task_reward.getDataByKey(n+1),o=i[e.box_id],s=this.boxList[n];s.mask.active=o==T.Received,s.received.active=o==T.Received,t>=e.point&&o==T.Normal?null==s.eff&&(s.eff=this.addUIEffect("prefab/ui-effect/MX_tx_tongyong_daojulingqu",s.imgIcon.node,-1)):null!=s.eff&&this.removeUIEffect(s.eff)}},g.updateTaskInfo=function(){var t=configDaily_task.getDatas();(t=C.copyArray(t)).sort((function(t,i){var n=IS(S).GetTaskItem(L.Daily,t.id),e=IS(S).GetTaskItem(L.Daily,i.id),o=n?n.state:G.Normal,s=e?e.state:G.Normal;return o==G.Complete&&s!=G.Complete?-1:o!=G.Complete&&s==G.Complete?1:o!=s?o<s?-1:1:t.id-i.id})),this.taskList.datas=t},g.flyDiamo=function(t){var i=new c,n=new f;this.utFly.convertToNodeSpaceAR(t,i);var e=this.utFly.convertToNodeSpaceAR(this.target.worldPosition,new c),o=y.alloc("ui/module/common/FlyDiamo",this.nodeFly,1);o.position=n.set(i.x,i.y);var s=new f(i.x,i.y),a=c.subtract(new c,e,i);this.addTween(0,1,.95,(function(t,e){c.multiplyScalar(i,a,e),n.set(s).add2f(i.x,i.y),o.position=n})).easing(F.BACK_IN).call((function(){u.playSound("common_jinbitiao")})).start()},n}(A));var N=function(t){function n(){for(var i,n=arguments.length,e=new Array(n),o=0;o<n;o++)e[o]=arguments[o];return(i=t.call.apply(t,[this].concat(e))||this).txtPoint=void 0,i.txtDesc=void 0,i.pb=void 0,i.txtSchedule=void 0,i.btnGet=void 0,i.btnGoto=void 0,i.imgFrame=void 0,i.imgIcon=void 0,i.txtNum=void 0,i.moveTween=void 0,i.open_func=0,i}i(n,t);var d=n.prototype;return d.onInit=function(){var t=this;this.imgFrame=m.findChildComponent(this.node,"imgFrame",s),this.imgIcon=m.findChildComponent(this.node,"imgFrame/imgIcon",s),this.txtNum=m.findChildComponent(this.node,"txtNum",e),this.txtPoint=m.findChildComponent(this.node,"txtPoint",e),this.txtDesc=m.findChildComponent(this.node,"txtDesc",e),this.pb=m.findChildComponent(this.node,"ProgressBar",o),this.txtSchedule=m.findChildComponent(this.node,"ProgressBar/schedule",e),this.btnGet=m.findChild(this.node,"btnGet"),this.view.addComponentCallbackListener(this.btnGet,a.EventType.CLICK,(function(){normalEvent.emit(B.Task_FLY_DIAMOND,t.imgIcon.node.worldPosition),t.flyOut()})),this.btnGoto=m.findChild(this.node,"btnGoto"),this.view.addComponentCallbackListener(this.btnGoto,a.EventType.CLICK,(function(){t.onBtnGotoClick()})),this.view.addComponentCallbackListener(this.imgFrame.node,a.EventType.CLICK,(function(){IS(k).OpenItemTips(t.data.reward[0][0],t.imgFrame.node)}))},d.flyOut=function(){var t=this;null!=this.moveTween&&this.moveTween.stop();var i=new c,n=this.node.getComponent(r).contentSize,e=this.node.position,o=new c(e.x,e.y);this.moveTween=this.view.addTween(0,1,.15,(function(e,s){i.set(o).add3f(-1.1*n.x*s,0,0),t.node.position=i})).easing(F.LINEAR).call((function(){IS(D).send_10_2(L.Daily,t.data.id)})).start()},d.onBtnGotoClick=function(){!this.open_func||IS(_).CheckFuncOpen(this.open_func)?(IS(P).openGuide(this.data.guide),this.view.parentView.close()):w.showFlyTip(GetLanguage(200114))},d.onRender=function(t,i){this.open_func=t.open_func,this.txtDesc.string=t.desc,this.txtPoint.string=p.formatStrWithMirrorDeal(GetLanguage(200613),t.value),this.txtNum.string=t.reward[0][1];var n,e=t.reward[0][0],o=configGoods.getDataByKey(e),s=o.quality;n=3==o.type?"icon_skill":4==o.type?"icon_pet":"icon_item";var a=configColor.getDataByKey(s);this.view.loadIcon(this.imgIcon,n,o.icon,null,v.UI_ATLAS,!0),this.view.loadIcon(this.imgFrame,"icon_equip",a.path);var d=IS(S).GetTaskItem(L.Daily,t.id);if(null==d)this.pb.progress=0,this.txtSchedule.string=h.formatStr("%s/%s",0,t.condition[2]),this.btnGet.active=!1,this.btnGoto.active=!0;else if(d.state==G.Normal){var r=d.count<=t.condition[2]?d.count:t.condition[2];this.pb.progress=r/t.condition[2],this.txtSchedule.string=h.formatStr("%s/%s",r,t.condition[2]),this.btnGet.active=!1,this.btnGoto.active=!0}else d.state==G.Complete?(this.pb.progress=1,this.txtSchedule.string=h.formatStr("%s/%s",t.condition[2],t.condition[2]),this.btnGet.active=!0,this.btnGoto.active=!1):(this.pb.progress=1,this.txtSchedule.string=h.formatStr("%s/%s",t.condition[2],t.condition[2]),this.btnGet.active=!1,this.btnGoto.active=!1)},n}(g);n._RF.pop()}}}));

