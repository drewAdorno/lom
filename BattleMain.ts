System.register("chunks:///_virtual/BattleMain.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UnitMgr.ts","./index23.ts","./FixMath.ts","./BattleData.ts","./EnumDefine.ts","./FixRandom.ts","./Timer.ts"],(function(t){"use strict";var i,e,r,n,a,o,s,h,u,c,m;return{setters:[function(t){i=t.createForOfIteratorHelperLoose,e=t.createClass},function(t){r=t.cclegacy},function(t){n=t.UnitMgr},null,function(t){a=t.FixMath},function(t){o=t.BattleData},function(t){s=t.RunState,h=t.RunMode,u=t.BattleFlag},function(t){c=t.FixRandom},function(t){m=t.TimerGroup}],execute:function(){r._RF.push({},"39e67IEuxBJi5VFI1ESPBg9","BattleMain",void 0);t("BattleMain",function(){function t(t){this.frameCount=0,this.timeScale=1,this.frameTime=.033,this.runState=s.Stop,this.runMode=h.Main,this._runTime=0,this._logicFrameTime=0,this.frameTimer=void 0,this.playerCtrs=[],this.mainCtr=void 0,this.showMainCtr=void 0,this.roleId=void 0,this.renderMgr=void 0,this.mapCamera=void 0,this.unitMgr=void 0,this.data=void 0,this.chapter=void 0,this.curRecord=void 0,this.collectRecord=0,this.playerAuto=!1,this.runningToPart=!1,this.random=void 0,this.battleFlag=u.NONE,this.injuryReduce=1,this.shieldDecay=1,this.treatDecay=1,this.seasonPveDamAdd=0,this.hitThrowDis=!0,this.effectScale=1,this.skillCd=1,this.hideText=!1,this.printLogFlag=!1,this.logCountMap=void 0,this.openLogCount=!1,this.unitMgr=new n(this),this.data=new o,this.data.chapterId=10001,this.random=new c,this.random.seed=null!=t?t:Math.floor(1e4*Math.random()),this.frameTimer=new m("battle_frame")}var r=t.prototype;return r.start=function(t){},r.resetFactor=function(){this.injuryReduce=1,this.shieldDecay=1,this.treatDecay=1,this.seasonPveDamAdd=0},r.printLogDebug=function(t){function i(i){return t.apply(this,arguments)}return i.toString=function(){return t.toString()},i}((function(t){for(var i=arguments.length,e=new Array(i>1?i-1:0),r=1;r<i;r++)e[r-1]=arguments[r];printLogDebug(t,e)})),r.printLog=function(t){function i(i){return t.apply(this,arguments)}return i.toString=function(){return t.toString()},i}((function(t){for(var i=arguments.length,e=new Array(i>1?i-1:0),r=1;r<i;r++)e[r-1]=arguments[r];printLog(t,e)})),r.printLogErr=function(t){function i(i){return t.apply(this,arguments)}return i.toString=function(){return t.toString()},i}((function(t){for(var i=arguments.length,e=new Array(i>1?i-1:0),r=1;r<i;r++)e[r-1]=arguments[r];printLogErr(t,e)})),r.printLogWarn=function(t){function i(i){return t.apply(this,arguments)}return i.toString=function(){return t.toString()},i}((function(t){for(var i=arguments.length,e=new Array(i>1?i-1:0),r=1;r<i;r++)e[r-1]=arguments[r];printLogWarn(t,e)})),r.stop=function(){var t;this.printLog("stop, runTime "+this.runTime+", frameCount "+this.frameCount+", maxChapterTime "+this.chapter.maxChapterTime+", chapterTime "+this.chapter.chapterTime),this.runState=s.Stop,this.renderMgr.clear(),this.unitMgr.clear(),this.frameTimer.clear(),null==(t=this.chapter)||t.destroy();for(var e,r=i(this.playerCtrs);!(e=r()).done;){e.value.clear()}this.playerCtrs.length=0},r._frameUpdate=function(t){if(this.runState==s.Running){var i,e=this.frameTime;if(this._logicFrameTime>=e)this.frameCount++,this.printLogFlag&&this.printLogDebug("第 "+this.frameCount+" 帧开始"),this.runMode!=h.Check&&this.runMode!=h.Record||null==(i=this.curRecord)||i.updateFrame(this.frameCount),this.frameTimer.update(e),this.chapter.onUpdate(e),this.unitMgr.onUpdate(e),this._logicFrameTime=a.round(this._logicFrameTime-e),t<2&&this._logicFrameTime>=e&&this._frameUpdate(t+1)}},r.gameLogic=function(t){if(!(this.timeScale>2)){t=a.round(t);var i=a.round(t*this.timeScale);this.runState==s.Running&&(this._runTime=a.round(this._runTime+i),this._logicFrameTime=a.round(this._logicFrameTime+i),this.printLogFlag&&0==this.frameCount&&this.printLogDebug('Logic start: {"chapter_type": '+this.data.chapterType+', "chapter_id": '+this.data.chapterId+', "seed": '+this.random.seed+"}"),this._frameUpdate(1)),this.onGameLogicUpdate(i),this.unitMgr.deferredDestroy()}},r.addFrameTimer=function(t,i,e,r){void 0===i&&(i=1),this.frameTimer.start(t,i,e,r)},r.stopFrameTimer=function(t){this.frameTimer.stop(t)},r.onGameLogicUpdate=function(t){},r.reset_runTime=function(){this._runTime=0},r.addLogCount=function(t,i,e,r,n,a,o){var s;if(this.openLogCount){var h=this.unitMgr.getUnit(t);this.logCountMap=null!=(s=this.logCountMap)?s:[],this.logCountMap.push({frame:this.frameCount,attack:null!=h?h.config.id:0,def:i,type:e,value:r,skillId:a,team:n,shieldHp:o})}},r.getLogCountStr=function(){if(this.openLogCount){for(var t,e="",r=i(this.logCountMap);!(t=r()).done;){var n=t.value;e+=n.frame+"\t"+n.attack+"\t"+n.def+"\t"+n.team+"\t"+n.type+"\t"+n.value+"\t"+n.shieldHp+"\t"+n.skillId+"\n"}return e}return""},e(t,[{key:"runTime",get:function(){return this._runTime}}]),t}());r._RF.pop()}}}));

