System.register("chunks:///_virtual/ChatMessageItem.ts",["./rollupPluginModLoBabelHelpers.js","cc","./FlagItem.ts","./RankTitle.ts","./TranslateTips.ts","./UIList.ts","./LabelUtil.ts","./NodeUtil.ts","./PlatformUtil.ts","./StringUtil.ts","./ItemIcon.ts","./FriendControl.ts","./RoleDataCache.ts","./RoleDefine.ts","./SdkControl.ts","./ChatControl.ts","./ChatDataCache.ts","./ChatDefine.ts","./ChatShareMessage.ts"],(function(e){"use strict";var t,i,n,o,s,a,h,d,l,c,r,g,m,f,p,v,C,I,T,u,y,S,w,A,W,N,b,L,_,k,R,P,H,x,D,G,F,B,M,U,E,z,O,V,K,X,Q,j,q,Z,J,Y,$,ee,te,ie,ne,oe,se,ae,he,de,le,ce;return{setters:[function(e){t=e.inheritsLoose},function(e){i=e.cclegacy,n=e.Color,o=e.Size,s=e.Widget,a=e.Label,h=e.NodeEventType,d=e.UITransform,l=e.Button,c=e.Sprite,r=e.math,g=e.Vec3,m=e.HorizontalTextAlignment,f=e.sys},function(e){p=e.FlagItem},function(e){v=e.RankTitle,C=e.TitleType},function(e){I=e.TranslateTips},function(e){T=e.ListItem},function(e){u=e.LabelUtil},function(e){y=e.default},function(e){S=e.PlatformUtil},function(e){w=e.default},function(e){A=e.IconAseetType},function(e){W=e.default},function(e){N=e.RoleDataCache},function(e){b=e.PlayerAttr},function(e){L=e.default},function(e){_=e.default},function(e){k=e.ChatDataCache},function(e){R=e.ChatDefine,P=e.ChatEventDefine},function(e){H=e.PvPShare,x=e.FarmHelpShare,D=e.MakeTeamShare,G=e.MessageShare,F=e.GuildBossNoticeShare,B=e.GuildQuestionTip,M=e.guildQuestionRank,U=e.answerEndShare,E=e.GuildHelpShare,z=e.NewsShareItem,O=e.RedBagShare,V=e.RedBagTipMessageShare,K=e.SkillTabShare,X=e.PetTabShare,Q=e.CrossWarReportView,j=e.ActivityAutumCardShare,q=e.ParkingCallShare,Z=e.ActivityHallowmasShare,J=e.ArtifactGemInfoShare,Y=e.ActivityTangMoleShare,$=e.SlaveShare,ee=e.DateApply,te=e.MarryApply,ie=e.WeddingInvite,ne=e.DivoreApply,oe=e.SeasonMapShare,se=e.ActivityLoopyCardShare,ae=e.FlyPetRoleShare,he=e.FlyPetUseShare,de=e.FlyPetShowShare,le=e.DoubleChapterInvateShare,ce=e.ActivityPoolPartyCardShare}],execute:function(){i._RF.push({},"cc4113OD/pEW7lnhojozjpS","ChatMessageItem",void 0);var re={1:{id:1,goName:"pvpShare",className:H},2:{id:2,goName:"farmHelpShare",className:x},3:{id:3,goName:"makeTeamShare",className:D},4:{id:4,goName:"messageShare",className:G,isHidePlayer:!0,notRecycle:!0,isPreCalc:!0},5:{id:5,goName:"guildBossNoticeShare",className:F,isHidePlayer:!0},6:{id:6,goName:"guildQuestionTip",className:B,isHidePlayer:!0},7:{id:7,goName:"guildQuestionRank",className:M,isHidePlayer:!0},8:{id:8,goName:"answerEndShare",className:U,isHidePlayer:!0,isPreCalc:!0},9:{id:9,goName:"guildHelpShare",className:E},10:{id:10,goName:"newsShareItem",className:z,isHidePlayer:!0,isPreCalc:!0},11:{id:11,goName:"redBagShare",className:O},12:{id:12,goName:"redBagTipMessageShare",className:V,isHidePlayer:!0,isPreCalc:!0},13:{id:13,goName:"SkillTabShare",className:K},14:{id:14,goName:"PetTabShare",className:X},15:{id:15,goName:"crossWarReportShare",className:Q},16:{id:16,goName:"ActivityAutumCardShare",className:j},17:{id:17,goName:"parkingCallShare",className:q},18:{id:18,goName:"ActivityHallowmasShare",className:Z},19:{id:19,goName:"artifactGemInfoShare",className:J},20:{id:20,goName:"ActivityTangMoleShare",className:Y},22:{id:22,goName:"SlaveShare",className:$},25:{id:25,goName:"DateApply",className:ee},26:{id:26,goName:"MarryApply",className:te},27:{id:27,goName:"WeddingInvite",className:ie},28:{id:28,goName:"DivoreApply",className:ne},31:{id:31,goName:"SeasonMapShare",className:oe},33:{id:33,goName:"ActivityLoopyCardShare",className:se},36:{id:36,goName:"FlyPetRoleShare",className:ae},37:{id:37,goName:"FlyPetUseShare",className:he},35:{id:35,goName:"FlyPetShowShare",className:de},38:{id:38,goName:"DoubleChapterInvateShare",className:le},39:{id:39,goName:"ActivityPoolPartyCardShare",className:ce}},ge=(new n).fromHEX("#2D551F"),me=(new n).fromHEX("#544231"),fe=96.327,pe=95,ve=100,Ce=104,Ie=122,Te=30,ue=new o(90,90),ye=new o(446,436);e("ChatMessageItem",function(e){function i(){for(var t,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(t=e.call.apply(e,[this].concat(n))||this).widgeAlign={left:1,right:2},t.poolInfo=void 0,t.timeNode=void 0,t.timeSprite=void 0,t.panelContentWidge=void 0,t.playerInfo=void 0,t.messageContentWidge=void 0,t.contentTrans=void 0,t.bg=void 0,t.bgTrans=void 0,t.bgWidge=void 0,t.name=void 0,t.nameWidge=void 0,t.headWidge=void 0,t.headImg=void 0,t.imgHeadFrame=void 0,t.content=void 0,t.contentWidge=void 0,t.voice=void 0,t.voiceLeftImg=void 0,t.voiceRightImg=void 0,t.voiceLeftWidge=void 0,t.voiceLeftImgTrans=void 0,t.voiceRightImgTrans=void 0,t.voiceLeftTime=void 0,t.voiceRightTime=void 0,t.voiceRightWidge=void 0,t.voiceTxt=void 0,t.voiceTextWidge=void 0,t.face=void 0,t.faceWidget=void 0,t.faceTrans=void 0,t.time=void 0,t.timeTrans=void 0,t.blackTip=void 0,t.answerGou=void 0,t.addOne=void 0,t.translateBtnWidge=void 0,t.translateTips=void 0,t.blackDes=void 0,t.sexWidge=void 0,t.sexNan=void 0,t.sexNv=void 0,t.flagItemWidge=void 0,t.flagItem=void 0,t.nameTrans=void 0,t.shareContentWidge=void 0,t.guildCareer=void 0,t.guildCareerWidge=void 0,t.titleIcon=void 0,t.titleIconWidge=void 0,t.gmIcon=void 0,t.shareList=new Array,t.isTempItem=!1,t.picNode=void 0,t.picDefault=void 0,t.picImg=void 0,t.picUrl="",t.specBg=void 0,t.touchHeadTimer=void 0,t.touchClickTime=0,t.contenOriTop=void 0,t.oriFaceWidgetTop=void 0,t.play_sec=0,t.play_timer=void 0,t.touchTimer=void 0,t}t(i,e);var T=i.prototype;return T.onInit=function(){var e=this;for(var t in this.panelContentWidge=y.findChildComponent(this.node,"content",s),this.playerInfo=y.findChild(this.node,"content/playerInfo"),this.messageContentWidge=y.findChildComponent(this.node,"content/messageContent",s),this.name=y.findChildComponent(this.node,"content/playerInfo/name",a),this.name.node.on(h.SIZE_CHANGED,(function(){e.UpdateNameContentWidth()})),this.nameTrans=y.findChildComponent(this.node,"content/playerInfo/name",d),this.nameWidge=y.findChildComponent(this.node,"content/playerInfo/name",s),this.headWidge=y.findChildComponent(this.node,"content/playerInfo/head",s),this.view.addComponentCallbackListener(this.headWidge.node,l.EventType.CLICK,(function(){})),this.view.addComponentCallbackListener(this.headWidge.node,h.TOUCH_START,(function(){if(e.poolInfo.role_id!=R.VIPGmUid||e.poolInfo.is_my){if(e.poolInfo.channel!=R.Channel.Private){var t=IS(N).GetRoleAttr(b.ROLE_ATTR_ID);e.poolInfo.role_id!=t&&(e.touchHeadTimer=e.view.addTimer(.3,1,(function(){normalEvent.emit(P.UpdateMentionName,{role_id:e.data.role_id,name:e.data.name}),e.touchHeadTimer=null})))}e.touchClickTime=(new Date).getTime()}})),this.view.addComponentCallbackListener(this.headWidge.node,h.TOUCH_CANCEL,(function(){e.touchHeadTimer&&(e.view.removeTimer(e.touchHeadTimer),e.touchHeadTimer=null)})),this.view.addComponentCallbackListener(this.headWidge.node,h.TOUCH_END,(function(){if(e.touchHeadTimer&&(e.view.removeTimer(e.touchHeadTimer),e.touchHeadTimer=null),(new Date).getTime()-e.touchClickTime<250){if(e.poolInfo.role_id==R.VIPGmUid)return;var t=IS(N).GetRoleAttr(b.ROLE_ATTR_ID);e.poolInfo.role_id!=t&&IS(W).reqOtherRoleNotice(e.poolInfo.role_id)}})),this.gmIcon=y.findChild(this.node,"content/playerInfo/head/gmIcon"),this.headImg=y.findChildComponent(this.node,"content/playerInfo/head/image",c),this.imgHeadFrame=y.findChildComponent(this.node,"content/playerInfo/head/imgHeadFrame",c),this.picNode=y.findChild(this.node,"content/messageContent/pic"),this.picDefault=y.findChild(this.node,"content/messageContent/pic/default"),this.picImg=y.findChildComponent(this.node,"content/messageContent/pic/img",c),this.view.addComponentCallbackListener(this.picImg.node,l.EventType.CLICK,(function(){uiMgr.openView("checkPicView",e.picImg.spriteFrame)})),this.content=y.findChildComponent(this.node,"content/messageContent/content",a),this.contentWidge=y.findChildComponent(this.node,"content/messageContent/content",s),this.contentTrans=y.findChildComponent(this.node,"content/messageContent/content",d),this.contenOriTop=this.contentWidge.top,this.voice=y.findChild(this.node,"content/messageContent/voice"),this.voiceLeftWidge=y.findChildComponent(this.node,"content/messageContent/voice/left",s),this.voiceLeftImg=y.findChild(this.node,"content/messageContent/voice/left"),this.view.addComponentCallbackListener(this.voiceLeftImg,l.EventType.CLICK,(function(){e.beginPlayVoice()})),this.voiceLeftImgTrans=y.findChildComponent(this.node,"content/messageContent/voice/left",d),this.voiceLeftTime=y.findChildComponent(this.node,"content/messageContent/voice/left/desc",a),this.voiceRightImg=y.findChild(this.node,"content/messageContent/voice/right"),this.view.addComponentCallbackListener(this.voiceRightImg,l.EventType.CLICK,(function(){e.beginPlayVoice()})),this.voiceRightWidge=y.findChildComponent(this.node,"content/messageContent/voice/right",s),this.voiceRightImgTrans=y.findChildComponent(this.node,"content/messageContent/voice/right",d),this.voiceRightTime=y.findChildComponent(this.node,"content/messageContent/voice/right/desc",a),this.voiceTxt=y.findChildComponent(this.node,"content/messageContent/voice/content",a),this.voiceTextWidge=y.findChildComponent(this.node,"content/messageContent/voice/content",s),this.bg=y.findChildComponent(this.node,"content/messageContent/bg/normalBg",c),this.bgWidge=y.findChildComponent(this.node,"content/messageContent/bg",s),this.specBg=y.findChildComponent(this.node,"content/messageContent/bg/specBg",c),this.view.addComponentCallbackListener(this.bg.node,h.TOUCH_START,(function(){e.poolInfo.type!=R.ChatContentType.Conetnt&&e.poolInfo.type!=R.ChatContentType.Face||(e.touchTimer=e.view.addTimer(.5,1,(function(){uiMgr.openView("ChatTipsView",e.data,e.bg.node)})))})),this.view.addComponentCallbackListener(this.bg.node,h.TOUCH_CANCEL,(function(){e.touchTimer&&(e.view.removeTimer(e.touchTimer),e.touchTimer=null)})),this.view.addComponentCallbackListener(this.bg.node,h.TOUCH_END,(function(){e.touchTimer&&(e.view.removeTimer(e.touchTimer),e.touchTimer=null)})),this.view.addComponentCallbackListener(this.specBg.node,h.TOUCH_START,(function(){e.touchTimer=e.view.addTimer(.5,1,(function(){uiMgr.openView("ChatTipsView",e.data,e.specBg.node)}))})),this.view.addComponentCallbackListener(this.specBg.node,h.TOUCH_CANCEL,(function(){e.touchTimer&&(e.view.removeTimer(e.touchTimer),e.touchTimer=null)})),this.view.addComponentCallbackListener(this.specBg.node,h.TOUCH_END,(function(){e.touchTimer&&(e.view.removeTimer(e.touchTimer),e.touchTimer=null)})),this.bgTrans=y.findChildComponent(this.node,"content/messageContent/bg",d),this.face=y.findChildComponent(this.node,"content/messageContent/face",c),this.faceWidget=y.findChildComponent(this.node,"content/messageContent/face",s),this.faceTrans=y.findChildComponent(this.node,"content/messageContent/face",d),this.oriFaceWidgetTop=this.faceWidget.top,this.timeNode=y.findChildComponent(this.node,"time",d),this.timeSprite=y.findChildComponent(this.node,"time",c),this.time=y.findChildComponent(this.node,"time/lable",a),this.timeTrans=y.findChildComponent(this.node,"time/lable",d),this.time.node.on(h.SIZE_CHANGED,(function(){e.timeNode.width=e.timeTrans.width+55,e.timeSprite.updateRenderer()})),this.blackTip=y.findChildComponent(this.node,"content/messageContent/bg/blackTip",s),this.answerGou=y.findChildComponent(this.node,"content/messageContent/bg/answerGou",s),this.addOne=y.findChildComponent(this.node,"content/messageContent/bg/addOne",s),this.view.addComponentCallbackListener(this.addOne.node,l.EventType.CLICK,(function(){if(e.data.type==R.ChatContentType.Face)normalEvent.emit(P.SendFace,e.data.content,R.ChatContentType.Face);else{var t=e.data,i=t.content;if(t.links[0]&&t.links[0].type==R.ChatLinkType.MentionRole)for(var n=0;n<t.links[0].args_list.length;n++){var o=t.links[0].args_list[n],s=t.links[0].string_list[n];o&&s&&IS(k).SetMentionRole({role_id:o,name:s})}IS(_).reqChatMessage(e.data.channel,e.data.type,i,e.data.friend_id),IS(k).ClearMentionRole()}})),this.translateBtnWidge=y.findChildComponent(this.node,"content/messageContent/bg/translateBtn",s),this.translateTips=new I(this.view,this.translateBtnWidge.node),this.blackDes=y.findChild(this.node,"content/playerInfo/blackDes"),this.sexNan=y.findChild(this.node,"content/playerInfo/sex/nan"),this.sexNv=y.findChild(this.node,"content/playerInfo/sex/nv"),this.sexWidge=y.findChildComponent(this.node,"content/playerInfo/sex",s),this.shareContentWidge=y.findChildComponent(this.node,"content/shareContent",s),re){var i=re[t],n=new i.className(this,y.findChild(this.node,"content/shareContent/"+i.goName),i,this.isTempItem);this.shareList[t]=n}this.guildCareer=y.findChild(this.node,"content/playerInfo/guildCareer"),this.guildCareerWidge=y.findChildComponent(this.node,"content/playerInfo/guildCareer",s),this.titleIcon=y.findChild(this.node,"content/playerInfo/titleIcon"),this.titleIconWidge=y.findChildComponent(this.node,"content/playerInfo/titleIcon",s),this.flagItemWidge=y.findChildComponent(this.node,"content/playerInfo/flag",s),this.flagItem=new p(this.view,y.findChild(this.node,"content/playerInfo/flag/flag"))},T.onRender=function(e,t){var i,s=this;if(this.touchTimer&&(this.view.removeTimer(this.touchTimer),this.touchTimer=null),this.poolInfo=e,this.poolInfo){var a=0,h=!1;if(this.poolInfo.role_id==R.VIPGmUid)this.gmIcon.active=!0,this.headImg.node.active=!1,this.imgHeadFrame.node.active=!1;else{this.gmIcon.active=!1,this.headImg.node.active=!0,this.view.loadRemoteIcon(this.poolInfo.head.url,this.headImg);var d=this.poolInfo.head.frame_id;if(d>0){this.imgHeadFrame.node.active=!0;var l=configAvatar_frame.getDataByKey(d);this.view.loadIcon(this.imgHeadFrame,"icon_frame",l.icon)}else this.imgHeadFrame.node.active=!1}var c=this.GetLinkArgType();if(this.voice.active=!1,!c)for(var p in this.shareList)this.shareList[p].SetActive(!1);if(this.poolInfo.type!=R.ChatContentType.Conetnt||c)if(this.poolInfo.type!=R.ChatContentType.Face||c)if(c)for(var v in this.translateBtnWidge.node.active=!1,this.messageContentWidge.node.active=!1,h=c.isHidePlayer,this.shareList)c.id==v?(this.shareList[v].SetActive(!0),a=this.shareList[v].height):this.shareList[v].SetActive(!1);else if(this.poolInfo.type==R.ChatContentType.Voice){this.translateBtnWidge.node.active=!1,this.messageContentWidge.node.active=!0,this.face.node.active=!1,this.voice.active=!0,this.content.node.active=!1,this.picNode.active=!1;var C=3,I=this.poolInfo.ext_list;if(I&&I.length>0)for(var T=0;T<I.length;T++)4==I[T].field&&(C=I[T].num);this.voiceLeftTime.string=w.formatStrWithMirrorDeal(GetLanguage(200005),C),this.voiceLeftImgTrans.setContentSize(new o(r.absMax(100,C/30*200),28)),this.voiceRightTime.string=w.formatStrWithMirrorDeal(GetLanguage(200005),C),this.voiceRightImgTrans.setContentSize(new o(r.absMax(100,C/30*200),28)),this.voiceTxt.string=this.poolInfo.content,this.voiceTxt.color=e.is_my?ge:me;var y=u.measureSize(this.voiceTxt);""==this.voiceTxt.string&&(y.height=0),this.bgTrans.setContentSize(new o(r.absMax(y.width+28,this.voiceRightImgTrans.width+28),y.height+17+Te)),a=y.height+Te}else this.poolInfo.type==R.ChatContentType.Pic&&(this.translateBtnWidge.node.active=!1,this.messageContentWidge.node.active=!0,this.content.node.active=!1,this.face.node.active=!1,this.picNode.active=!0,this.picDefault.active=!0,this.picImg.node.active=!1,this.bgTrans.setContentSize(ye),a=ye.y,""!=this.poolInfo.content&&(this.picUrl!=this.poolInfo.content?(this.picDefault.active=!0,this.picImg.node.active=!1,this.view.loadRemoteIcon(this.poolInfo.content,this.picImg,(function(e){s.poolInfo.type==R.ChatContentType.Pic&&(s.picDefault.active=!1,s.picUrl=s.poolInfo.content,s.picImg.node.active=!0)}))):(this.picDefault.active=!1,this.picImg.node.active=!0)));else{this.translateBtnWidge.node.active=!1,this.messageContentWidge.node.active=!0,this.content.node.active=!1,this.face.node.active=!0,this.picNode.active=!1;var S=IS(k).GetFaceIconByContent(this.poolInfo.content),W=S[0],N=S[1];this.faceTrans.anchorX=this.data.is_my?1:0,this.faceTrans.setContentSize(N.size),this.view.loadIcon(this.face,"icon_chat",W);var b=ue.x+(N.size.x-60),L=ue.y+(N.size.y-60);this.bgTrans.setContentSize(new o(b,L)),a=L}else{this.translateBtnWidge.node.active=!e.is_my,this.messageContentWidge.node.active=!0;var _=e.content;e.role_id!=R.VIPGmUid&&(this.translateTips.SetTranslateInfo("Chat",e.role_id+"_"+e.time,e.content,{role_id:e.role_id,time:e.time}),_=this.translateTips.GetShowContent()),this.content.string=_,this.content.color=e.is_my?ge:me,this.face.node.active=!1,this.content.node.active=!0,this.picNode.active=!1;var P=this.GetContentSize(e);i=P,this.bgTrans.setContentSize(new o(P.width+28,P.height+Te)),a=P.height+Te}if(h)this.shareContentWidge.top=42,this.playerInfo.active=!1;else{var H=Ce;this.playerInfo.active=!0;var x=this.bg,D=e.is_my?"lt_ui_wenzidi02":"lt_ui_wenzidi01",G=87;if(e.bubble&&e.bubble>1){var F=configChat_bubble.getDataByKey(e.bubble);if(F){this.bg.node.active=!1,this.view.loadIcon(this.specBg,"chat",F.icon,null,A.UI_ATLAS,!0),this.specBg.node.active=!0;var B=this.specBg;D=F.icon,B.node.eulerAngles=e.is_my?new g(0,0,0):new g(0,180,0),G=e.is_my?ve:pe,this.content.color=new n("#"+F.text_color),this.voiceTxt.color=new n("#"+F.text_color),this.voiceLeftWidge.left=Ie,this.voiceRightWidge.right=Ie,this.bgTrans.width=this.bgTrans.width+20;var M=this.bgTrans.width;this.bgTrans.width=Math.max(89,M),this.bgTrans.height=this.bgTrans.height-10,H=M<89?Ie+(89-M)/2:Ie,this.contentWidge.top=10,this.faceWidget.top=10}else this.voiceLeftWidge.left=Ce,this.voiceRightWidge.right=Ce,this.bg.node.active=!0,this.specBg.node.active=!1,this.contentWidge.top=this.contenOriTop,this.faceWidget.top=this.oriFaceWidgetTop}else this.voiceLeftWidge.left=Ce,this.voiceRightWidge.right=Ce,this.bg.node.active=!0,this.specBg.node.active=!1,this.contentWidge.top=this.contenOriTop,this.faceWidget.top=this.oriFaceWidgetTop;this.view.loadIcon(x,"chat",D,null,A.UI_ATLAS,!0),e.is_my?(this.voiceLeftImg.active=!1,this.voiceRightImg.active=!0,this.sexWidge.node.active=!1,this.name.node.active=!0,this.name.string=this.poolInfo.name,this.name.horizontalAlign=m.RIGHT,this.nameTrans.anchorX=1,this.SetAlign(this.nameWidge,this.widgeAlign.right,fe),this.UpdateNameContentWidth(!0,this.widgeAlign.right),this.SetAlign(this.headWidge,this.widgeAlign.right,4.252),this.content.horizontalAlign=(f.uiMirror,m.LEFT),this.voiceTxt.horizontalAlign=(f.uiMirror,m.LEFT),i&&!f.uiMirror&&(this.poolInfo.type!=R.ChatContentType.Conetnt||c||(H-=this.contentTrans.width-i.width)),this.SetAlign(this.contentWidge,this.widgeAlign.right,H),this.SetAlign(this.voiceTextWidge,this.widgeAlign.right,H),this.SetAlign(this.faceWidget,this.widgeAlign.right,H),this.SetAlign(this.bgWidge,this.widgeAlign.right,G),this.messageContentWidge.top=42,this.shareContentWidge.top=42,this.poolInfo.is_block?(this.blackTip.node.active=!0,this.blackDes.active=!0,this.blackDes.position=new g(0,-(42+a-10),0)):(this.blackDes.active=!1,this.blackTip.node.active=!1)):(this.voiceLeftImg.active=!0,this.voiceRightImg.active=!1,this.name.node.active=!0,this.name.horizontalAlign=m.LEFT,this.nameTrans.anchorX=0,this.name.string=this.poolInfo.name,this.SetAlign(this.nameWidge,this.widgeAlign.left,fe),this.UpdateNameContentWidth(!0),this.SetAlign(this.headWidge,this.widgeAlign.left,4.252),this.content.horizontalAlign=f.uiMirror?m.RIGHT:m.LEFT,this.voiceTxt.horizontalAlign=f.uiMirror?m.RIGHT:m.LEFT,this.SetAlign(this.contentWidge,this.widgeAlign.left,H),this.SetAlign(this.voiceTextWidge,this.widgeAlign.left,H),this.SetAlign(this.bgWidge,this.widgeAlign.left,G),this.SetAlign(this.faceWidget,this.widgeAlign.left,H),this.messageContentWidge.top=42,this.shareContentWidge.top=42,this.blackTip.node.active=!1,this.blackDes.active=!1);var U=0;e.is_my?this.SetAlign(this.translateBtnWidge,this.widgeAlign.left,-80):this.SetAlign(this.translateBtnWidge,this.widgeAlign.right,-80),this.translateBtnWidge.node.active&&(U+=-80),this.poolInfo.addOne?(this.addOne.node.active=!0,U+=-45,e.is_my?this.SetAlign(this.addOne,this.widgeAlign.left,U):this.SetAlign(this.addOne,this.widgeAlign.right,U)):this.addOne.node.active=!1,1==this.poolInfo.guildAnswer?(this.answerGou.node.active=!0,U+=-65,e.is_my?this.SetAlign(this.answerGou,this.widgeAlign.left,U):this.SetAlign(this.answerGou,this.widgeAlign.right,U)):this.answerGou.node.active=!1}this.poolInfo.timeStr?(this.timeNode.node.active=!0,this.panelContentWidge.top=46,this.time.string=this.poolInfo.timeStr):(this.timeNode.node.active=!1,this.panelContentWidge.top=0)}},T.GetContentSize=function(e){var t,i=this.view.heightCalcTxtDict,n=e.content;return e.role_id!=R.VIPGmUid&&(this.translateTips.SetTranslateInfo("Chat",e.role_id+"_"+e.time,e.content,{role_id:e.role_id,time:e.time}),n=this.translateTips.GetShowContent()),i[n]?t=i[n]:(this.content.string=n,t=u.measureSize(this.content),i[n]=t),t},T.UpdateNameContentWidth=function(e,t){void 0===e&&(e=!1),void 0===t&&(t=this.widgeAlign.left),this.poolInfo.is_my&&(t=this.widgeAlign.right),this.name.updateRenderer();var i=fe+this.nameTrans.contentSize.x;this.poolInfo.gender>0&&!this.poolInfo.is_my?(this.sexNan.active=1==this.poolInfo.gender,this.sexNv.active=2==this.poolInfo.gender,this.sexWidge.node.active=!0,this.SetAlign(this.sexWidge,this.widgeAlign.left,i+4),i=i+4+34*.8):this.sexWidge.node.active=!1;var n=!1;if(this.poolInfo.guildCareer&&this.poolInfo.guildCareer>0&&this.poolInfo.channel==R.Channel.Guild){if(this.guildCareerWidge.node.active=!0,e)new v(this.view,this.guildCareer).SetRankTitle(this.poolInfo.guildCareer,C.GUILD);this.SetAlign(this.guildCareerWidge,t,i+2),i=i+2+139,n=!0}else this.guildCareer.active=!1;if(this.poolInfo.title&&this.poolInfo.title>0&&!n){if(this.titleIconWidge.node.active=!0,e)new v(this.view,this.titleIcon).SetRankTitle(this.poolInfo.title,C.NORMAL);this.SetAlign(this.titleIconWidge,t,i+2),i=i+2+131}else this.titleIcon.active=!1;this.poolInfo.country&&this.poolInfo.country>0?(this.flagItemWidge.node.active=!0,this.flagItem.SetFlag(this.poolInfo.country),this.SetAlign(this.flagItemWidge,t,i+2),i=i+2+50.5):this.flagItemWidge.node.active=!1},T.SetAlign=function(e,t,i){t==this.widgeAlign.left?(e.isAlignLeft=!0,e.right=0,e.isAlignRight=!1,e.left=i):t==this.widgeAlign.right&&(e.isAlignRight=!0,e.left=0,e.isAlignLeft=!1,e.right=i)},T.GetLinkArgType=function(){if(this.poolInfo.links&&this.poolInfo.type==R.ChatContentType.Share)for(var e in this.poolInfo.links){var t=this.poolInfo.links[e],i=re[t.type];if(i)return i}},T.beginPlayVoice=function(){var e=this;sdkControl.GetIsPlay()?this.stopPlayVoice():(IS(k).SetAutoTimer(this.poolInfo.time,!0),this.play_sec=0,S.GetSoundScope((function(){var t;IS(L).setCallbackPlayVoice();var i=e.poolInfo.ext_list;if(i&&i.length>0)for(var n=0;n<i.length;n++)3==i[n].field&&(t=i[n].string);IS(L).downloadVoice(null,t)})))},T.stopPlayVoice=function(){S.GetSoundScope((function(){IS(L).stopPlayVoice()}))},T.CalcHeight=function(e){this.poolInfo=e;var t=0,i=0,n=42,o=this.GetLinkArgType(),s=0;if(this.poolInfo.timeStr&&(s=46),this.poolInfo.type!=R.ChatContentType.Conetnt||o){if(this.poolInfo.type==R.ChatContentType.Face){var a=IS(k).GetFaceIconByContent(this.poolInfo.content),h=(a[0],a[1]);t=ue.y+(h.size.y-60)}else if(this.poolInfo.type==R.ChatContentType.Voice){this.voiceTxt.string=this.poolInfo.content;var d=u.measureSize(this.voiceTxt);""==this.voiceTxt.string&&(d.height=0),t=17+d.height+Te}else if(this.poolInfo.type==R.ChatContentType.Pic)t=ye.y;else if(o)for(var l in this.shareList)if(o.id==l){if(o.isPreCalc&&this.shareList[l].SetActive(!0),t=this.shareList[l].height,o.isHidePlayer)return t+s;break}}else t=this.GetContentSize(e).height+Te;return e.is_my&&(this.poolInfo.is_block&&(i=10),n+t<80&&(n+=80-(n+t))),s+n+t+i+5},T.cacheReset=function(){for(var t in this.shareList){this.shareList[t].reset()}this.play_timer=null,e.prototype.cacheReset.call(this)},T.destroy=function(){for(var t in this.shareList){this.shareList[t].destroy()}this.play_timer=null,e.prototype.destroy.call(this)},i}(T));i._RF.pop()}}}));

