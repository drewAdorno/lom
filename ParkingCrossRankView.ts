System.register("chunks:///_virtual/ParkingCrossRankView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./V2.ts","./GuildPinItem.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./BaseView.ts","./CommonModel.ts","./FriendControl.ts","./GuildControl.ts","./GuildDataCache.ts","./RankControl.ts","./RankDefine.ts","./RankModel.ts","./RoleDataCache.ts","./RoleDefine.ts","./ParkingDefine.ts"],(function(t){"use strict";var i,n,e,o,s,a,r,h,d,c,l,f,m,v,u,p,g,k,y,C,I,R,S,T,x;return{setters:[function(t){i=t.inheritsLoose},function(t){n=t.cclegacy,e=t.Button,o=t.Sprite,s=t.Label,a=t.ScrollView,r=t.sys,h=t.js},function(t){d=t.V2},function(t){c=t.GuildPinItem},function(t){l=t.ListItem},function(t){f=t.default},function(t){m=t.default},function(t){v=t.BaseView},function(t){u=t.CommonModel},function(t){p=t.default},function(t){g=t.default},function(t){k=t.default},function(t){y=t.default},function(t){C=t.RankDefine},function(t){I=t.RankModel},function(t){R=t.RoleDataCache},function(t){S=t.PlayerAttr},function(t){T=t.tabToRankid,x=t.RankTabType}],execute:function(){var L,w;n._RF.push({},"c88fe3MbHBGSbFckYpDjUbl","ParkingCrossRankView",void 0);var _=1,M=2,N=3,b=((L={})[_]="",L[M]="",L[N]="",L),F=((w={})[1]=new d(0,0),w[2]=new d(0,0),w[3]=new d(0,0),w),G=(t("default",function(t){function n(){var i;return(i=t.call(this)||this).curType=void 0,i.rankList=void 0,i.typeItems=void 0,i.nodeRank=void 0,i.nodeRankBg=void 0,i.nodeGuildTop=void 0,i.nodePlayerTop=void 0,i.myFrame=void 0,i.myIcon=void 0,i.myFlag=void 0,i.txtMyRank=void 0,i.txtMyScore=void 0,i.txtMyName=void 0,i.txtMyServer=void 0,i.guildTopList={},i.playerTopList={},i.imgTitle=void 0,i.rankInfo=void 0,i.typeToRankInfo={},i.isSendToServer=!1,i.page=1,i.canReq=!0,i.name="ParkingCrossRankView",i.url="ui/module/parking/ParkingCrossRankView",i}i(n,t);var d=n.prototype;return d.onInit=function(){var t=this,i=this.findChild("imgMask");this.addComponentCallbackListener(i,e.EventType.CLICK,(function(){t.onMaskClick()}));var n=this.findChild("content/btnClose");this.addComponentCallbackListener(n,e.EventType.CLICK,(function(){t.close()})),this.imgTitle=this.findChildComponent("content/title/imgTitle",o),this.nodeRank=this.findChild("content/nodeRank"),this.nodeRankBg=this.findChild("content/imgBgRank"),this.nodeGuildTop=this.findChild("content/guildTopRank"),this.nodePlayerTop=this.findChild("content/playerTopRank"),this.typeItems=[];for(var d=function(i){var n=t.findChild(h.formatStr("content/bottom/bottomBtn/item%s",i));t.addComponentCallbackListener(n,e.EventType.CLICK,(function(){t.curType!=i&&(t.curType=i,t.updateContent())})),t.typeItems.push({node:n,nodeSelect:f.findChild(n,"selected"),type:i})},l=1;l<=3;l++)d(l);this.txtMyRank=this.findChildComponent("content/nodeRank/myRank/rankNum",s),this.txtMyScore=this.findChildComponent("content/nodeRank/myRank/score",s),this.txtMyName=this.findChildComponent("content/nodeRank/myRank/info/name",s),this.txtMyServer=this.findChildComponent("content/nodeRank/myRank/info/txtServer",s),this.myFrame=this.findChildComponent("content/nodeRank/myRank/imgFrame",o),this.myIcon=this.findChildComponent("content/nodeRank/myRank/imgFrame/imgIcon",o),this.myFlag=new c(this,f.findChild(this.node,"content/nodeRank/myRank/GuildPinItem"));var m=this.findChildComponent("content/nodeRank/rankList",a);this.addComponentCallbackListener(m.node,a.EventType.SCROLL_TO_BOTTOM,(function(){if(!(t.isSendToServer||t.getRankInfo().rank_list.length>=t.getRankInfo().total_num)){t.page+=1;var i=new Array;i.push({type:T[t.curType],server:2,page:t.page}),IS(y).reqRankList(i),t.isSendToServer=!0}})),this.rankList=this.addUIList(m,G);for(var v=1;v<=3;v++){var u=new B;u.init(this.findChild("content/guildTopRank/rank"+v),this,v),this.guildTopList[v]=u,r.uiMirror&&this.loadIcon(this.findChild("content/guildTopRank/rank"+v+"/gg_ui_xinxidi/gg_icon_cheweibi").getComponent(o),"parking","gg_icon_cheweibi")}for(var p=1;p<=3;p++){var g=new P;g.init(this.findChild("content/playerTopRank/rank"+p),this,p),this.playerTopList[p]=g}},d.registerUpdateHandler=function(){this.addEvent(C.RankInfoBack,this.refreshRank,this)},d.onMaskClick=function(){this.close()},d.onAfterOpen=function(){var t;for(var i in this.canReq=!0,this.guildTopList)this.guildTopList.hasOwnProperty(i)&&this.guildTopList[i].show();for(var n in this.playerTopList)this.playerTopList.hasOwnProperty(n)&&this.playerTopList[n].show();var e=configRanktype.getDataByKey(T[x.serverRank]),o=configRanktype.getDataByKey(T[x.captureRank]),s=configRanktype.getDataByKey(T[x.defendRank]);(t={})[_]=e.prefix,t[M]=o.prefix,t[N]=s.prefix,b=t,this.curType=1,this.updateContent()},d.updateContent=function(){var t=this;if(this.canReq){for(var i=0;i<this.typeItems.length;i++){var n=this.typeItems[i];n.nodeSelect.active=n.type==this.curType}if(this.curType==_){if(this.nodeGuildTop.active=!0,this.nodePlayerTop.active=!1,this.myFrame.node.active=!1,IS(R).HasGuild()){var e=IS(k).GetGuildInfo();this.txtMyName.string=e.name,this.myFlag.node.active=!0,this.myFlag.SetItem(e.guild_flag),this.txtMyServer.node.active=!0,this.txtMyServer.string=h.formatStr("[s%s]",IS(R).GetServerId())}else this.txtMyName.string=GetLanguage(200083),this.myFlag.node.active=!1,this.txtMyServer.node.active=!1;this.UpdateRankInfo(),this.rankList.scrollTo(0,0)}else this.curType!=M&&this.curType!=N||(this.nodeGuildTop.active=!1,this.nodePlayerTop.active=!0,this.myFlag.node.active=!1,this.myFrame.node.active=!0,this.txtMyServer.node.active=!0,this.txtMyServer.string=h.formatStr("[s%s]",IS(R).GetServerId()),this.txtMyName.string=IS(R).GetRoleAttr(S.ROLE_ATTR_NAME),this.loadRemoteIcon(IS(R).GetRoleAttr(S.ROLE_ATTR_HEAD_URL),this.myIcon),this.UpdateRankInfo(),this.rankList.scrollTo(0,0));this.isSendToServer=!1,this.page=1,this.canReq=!1;var o=new Array;o.push({type:T[this.curType],server:2,page:this.page}),IS(y).reqRankList(o),this.addTimer(.2,1,(function(){t.canReq=!0}))}},d.onBeforeClose=function(){this.rankList.clearData()},d.onDestroy=function(){},d.UpdateRankInfo=function(){if(this.rankInfo=this.getRankInfo(),this.rankInfo){var t,i={},n=[];this.curType==_?i=this.guildTopList:(this.curType==M||this.curType==N)&&(i=this.playerTopList);for(var e=1;e<=3;e++)this.playerTopList[e].show(null);for(var o=0;o<this.rankInfo.rank_list.length;o++)o<3?this.rankInfo.rank_list.length>=o?i[o+1].show(this.rankInfo.rank_list[o]):i[o+1].show(null):n.push(this.rankInfo.rank_list[o]);n.sort((function(t,i){return t.rank<i.rank?-1:1})),this.rankList.datas=n,this.txtMyRank.string=0!=this.rankInfo.my_info.rank?this.rankInfo.my_info.rank:GetLanguage(200037),this.txtMyScore.string=h.formatStr("%s\n%s",b[this.curType],m.GetNumString(null!=(t=this.rankInfo.my_info.score)?t:0))}else{if(this.curType==_)for(var s=1;s<=3;s++)this.guildTopList[s].show(null);else if(this.curType==M)for(var a=1;a<=3;a++)this.playerTopList[a].show(null);else if(this.curType==N)for(var r=1;r<=3;r++)this.playerTopList[r].show(null);this.txtMyRank.string=GetLanguage(200037),this.txtMyScore.string=h.formatStr("%s\n%s",b[this.curType],0),this.rankList.datas=[]}this.isSendToServer=!1},d.getRankInfo=function(){return IS(I).GetRankInfoByType(T[this.curType])},d.refreshRank=function(t){this.UpdateRankInfo()},n}(v)),function(t){function n(){for(var i,n=arguments.length,e=new Array(n),o=0;o<n;o++)e[o]=arguments[o];return(i=t.call.apply(t,[this].concat(e))||this).imgFrame=void 0,i.imgIcon=void 0,i.flag=void 0,i.txtRank=void 0,i.rankIcon=void 0,i.txtName=void 0,i.txtServer=void 0,i.txtScore=void 0,i}i(n,t);var a=n.prototype;return a.onInit=function(){var t=this;this.imgFrame=f.findChildComponent(this.node,"imgFrame",o),this.imgIcon=f.findChildComponent(this.node,"imgFrame/imgIcon",o),this.flag=new c(this.view,f.findChild(this.node,"GuildPinItem")),this.txtRank=f.findChildComponent(this.node,"rankNum",s),this.rankIcon=f.findChildComponent(this.node,"rankIcon",o),this.txtName=f.findChildComponent(this.node,"info/name",s),this.txtServer=f.findChildComponent(this.node,"info/txtServer",s),this.txtScore=f.findChildComponent(this.node,"score",s),this.view.addComponentCallbackListener(this.imgFrame.node,e.EventType.CLICK,(function(){IS(p).reqOtherRoleNotice(t.data.belong_id,1)}))},a.onRender=function(t,i){var n=this.view;n.curType==_?(this.flag.node.active=!0,this.imgFrame.node.active=!1,this.flag.SetItem(t.guild_flag)):(n.curType==M||n.curType==N)&&(this.flag.node.active=!1,this.imgFrame.node.active=!0,this.view.loadRemoteIcon(t.head.url,this.imgIcon)),this.txtName.string=t.name,this.txtScore.string=h.formatStr("%s\n%s",b[n.curType],m.GetNumString(t.score)),this.txtServer.node.active=!0,this.txtServer.string=h.formatStr("[s%s]",t.serv_id),t.rank<=3?(this.rankIcon.node.active=!0,this.txtRank.node.active=!1,this.view.loadIcon(this.rankIcon,"common","common_ICON_paiming0"+t.rank)):(this.rankIcon.node.active=!1,this.txtRank.node.active=!0,this.txtRank.string=t.rank)},a.onItemClick=function(){var t=this.view;t.curType==_?IS(g).send_29_1(this.data.belong_id):(t.curType==M||t.curType==N)&&IS(p).reqOtherRoleNotice(this.data.info.belong_id,1)},n}(l)),P=function(){function t(){this.view=void 0,this.node=void 0,this.rank=void 0,this.txtName=void 0,this.txtServer=void 0,this.txtScore=void 0,this.imgFrame=void 0,this.imgIcon=void 0,this.rankIcon=void 0,this.job=void 0,this.data=void 0,this.role=void 0}var i=t.prototype;return i.init=function(t,i,n){this.view=i,this.node=t,this.rank=n,this.onInit()},i.onInit=function(){var t=this;this.job=f.findChild(this.node,"role"),this.txtName=f.findChildComponent(this.node,"nameInfo/name",s),this.txtServer=f.findChildComponent(this.node,"nameInfo/txtServer",s),this.txtScore=f.findChildComponent(this.node,"score",s),this.imgFrame=f.findChild(this.node,"imgFrame"),this.imgIcon=f.findChildComponent(this.node,"imgFrame/imgIcon",o),this.view.addComponentCallbackListener(this.imgFrame,e.EventType.CLICK,(function(){t.data&&IS(p).reqOtherRoleNotice(t.data.belong_id,1)}));var i=f.findChild(this.node,"role/click");this.view.addComponentCallbackListener(i,e.EventType.CLICK,(function(){t.data&&IS(p).reqOtherRoleNotice(t.data.belong_id,1)})),this.view.adjustMirrorNode(f.findChild(this.node,"imgFrame/rank_icon"),0,!0)},i.show=function(t){this.data=t,this.txtName.string=GetLanguage(200038);var i=this.view;if(this.txtScore.string=b[i.curType]+"0",this.imgIcon.node.active=!1,this.txtServer.node.active=!1,null!=this.role&&(this.view.removeUnitModel(this.role),this.role=null),t){var n=t.figure;this.role=IS(u).AddRoleModel(this.view,n,this.job,null,.9),this.view.getUnitModel(this.role).mount=n.mount_figure,this.imgIcon.node.active=!0,this.view.loadRemoteIcon(t.head.url,this.imgIcon),n.mount_figure<=0&&(this.view.getUnitModel(this.role).position=F[this.rank]),this.view.loadRemoteIcon(t.head.url,this.imgIcon),this.txtName.string=t.name,this.txtScore.string=b[i.curType]+m.GetNumString(t.score),this.txtServer.node.active=!0,this.txtServer.string=h.formatStr("[s%s]",t.serv_id)}},t}(),B=function(){function t(){this.view=void 0,this.node=void 0,this.rank=void 0,this.flag=void 0,this.txtName=void 0,this.txtServer=void 0,this.txtScore=void 0,this.rankIcon=void 0,this.data=void 0}var i=t.prototype;return i.init=function(t,i,n){this.view=i,this.node=t,this.rank=n,this.onInit()},i.onInit=function(){var t=this;this.txtName=f.findChildComponent(this.node,"info/name/name",s),this.txtServer=f.findChildComponent(this.node,"info/txtServer",s),this.txtScore=f.findChildComponent(this.node,"score",s),this.flag=new c(this.view,f.findChild(this.node,"GuildPinItem")),this.view.addComponentCallbackListener(this.flag.node,e.EventType.CLICK,(function(){t.data&&IS(g).send_29_1(t.data.belong_id)})),this.rankIcon=f.findChildComponent(this.node,"rank_icon",o),this.view.loadIcon(this.rankIcon,"common","common_ICON_paiming0"+this.rank)},i.show=function(t){this.data=t,this.txtName.string=GetLanguage(200038),this.txtScore.string="0",this.flag.node.active=!1,this.txtServer.node.active=!1,t&&(this.flag.node.active=!0,this.flag.SetItem(t.guild_flag),this.txtName.string=h.formatStr("[s%s]",t.serv_id),this.txtScore.string=m.GetNumString(t.score))},t}();n._RF.pop()}}}));

