System.register("chunks:///_virtual/ActivityHalloweenGiftView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./RedPointMgr.ts","./NodeUtil.ts","./StorageUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./MessageView.ts","./PayDataCache.ts","./PayDefine.ts","./RoleDataCache.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./ActivityHalloweenDataCache.ts","./BaseView.ts"],(function(t){"use strict";var i,e,n,a,o,r,s,l,d,u,c,f,h,m,v,y,g,p,I,G,w,b;return{setters:[function(t){i=t.inheritsLoose},function(t){e=t.cclegacy,n=t.Button,a=t.Label,o=t.ScrollView},function(t){r=t.ItemGrid},function(t){s=t.ListItem},function(t){l=t.RedPointMgr},function(t){d=t.default},function(t){u=t.default},function(t){c=t.default},function(t){f=t.default},null,function(t){h=t.default},function(t){m=t.default},function(t){v=t.PayEventDefine,y=t.GiftType},function(t){g=t.RoleDataCache},function(t){p=t.default},function(t){I=t.ActivityType,G=t.ActivityState},function(t){w=t.default},function(t){b=t.BaseView}],execute:function(){e._RF.push({},"6aff9GHmbxMcreNkz6xtpDb","ActivityHalloweenGiftView",void 0);t("default",function(t){function e(){var i;return(i=t.call(this)||this).txtNum=void 0,i.rewardScroll=void 0,i.txtPrice=void 0,i.limit=void 0,i.btn=void 0,i.payId=void 0,i.name="ActivityHalloweenGiftView",i.url="ui/module/halloween/ActivityHalloweenGiftView",i}i(e,t);var r=e.prototype;return r.onInit=function(){var t=this,i=this.findChild("imgMask");this.addComponentCallbackListener(i,n.EventType.CLICK,(function(){t.close()})),this.limit=this.findChildComponent("bg/limit",a),this.txtNum=this.findChildComponent("bg/btn/num/txtNum",a);var e=this.findChildComponent("bg/rewardScroll",o);this.rewardScroll=this.addUIList(e,S),this.rewardScroll.lackCenter=!0,this.txtPrice=this.findChildComponent("bg/btn/Label",a),this.btn=this.findChild("bg/btn"),this.addComponentCallbackListener(this.btn,n.EventType.CLICK,(function(){if(t.payId){var i=IS(m).GetPayGiftInfo(t.payId);if(i.bought_times>=i.payCfg.buy_times)return void h.showFlyTip(GetLanguage(200027));IS(m).Pay(t.payId)}}))},r.registerUpdateHandler=function(){this.addEvent(v.PAY_INFO_UPDATE,this.updateInfo,this)},r.onAfterOpen=function(){var t=IS(p).GetActivityInfo(I.HalloweenGift);if(t){var i,e=String(t.id)+"#"+String(t.round),n="ActivityHalloweenGiftRed"+IS(g).GetRoleId();(null!=(i=u.get(n))?i:"")!=e&&(u.set(n,e),IS(p).UpdateMainRedByActType(t.type),IS(l).changeValue("halloween_gift",IS(w).GetGiftRed()))}this.updateInfo()},r.onBeforeClose=function(){this.payId=null},r.onDestroy=function(){},r.updateInfo=function(){var t=IS(p).GetActivityInfo(I.HalloweenGift);if(t){this.btn.active=t.state==G.Open,this.limit.node.active=t.state==G.Preview;var i=f.formatDate(new Date(1e3*t.state_time[G.Open].start_time),GetLanguage(201234));this.limit.string=i;var e=IS(m).GetAcivityGift(y.Activity,t.type,t.round)[0],n=IS(m).GetPayGiftInfo(e.id);this.rewardScroll.datas=e.reward,this.payId=e.id,n&&n.bought_times?(n.bought_times>=e.buy_times?this.txtPrice.string=GetLanguage(200027):this.txtPrice.string=IS(m).GetPriceString(e.cost_level),this.txtNum.string=c.formatStrWithMirrorDeal(GetLanguage(200727)+"%s/%s",e.buy_times-n.bought_times,e.buy_times)):(this.txtPrice.string=IS(m).GetPriceString(e.cost_level),this.txtNum.string=c.formatStrWithMirrorDeal(GetLanguage(200727)+"%s/%s",e.buy_times,e.buy_times))}},e}(b));var S=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return(i=t.call.apply(t,[this].concat(n))||this).itemGridNode=void 0,i.itemGrid=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){this.itemGridNode=d.findChild(this.node,"itemGrid"),this.itemGrid=new r(this.view,this.itemGridNode)},n.onRender=function(t,i){this.itemGrid.SetItemId(t[0],t[1])},e}(s);e._RF.pop()}}}));

