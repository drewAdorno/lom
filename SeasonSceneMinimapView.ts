System.register("chunks:///_virtual/SeasonSceneMinimapView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./V2.ts","./index57.ts","./UIEffectAsset.ts","./SLGMapData.ts","./SeasonDefine.ts","./SeasonSceneControl.ts","./SeasonMapScene.ts","./BaseView.ts"],(function(n){"use strict";var e,t,i,o,s,a,c,r,l,f,p,u,d,h,m,S,v;return{setters:[function(n){e=n.inheritsLoose},function(n){t=n.cclegacy,i=n.Vec3,o=n.Button,s=n.UITransform,a=n.Node,c=n.Vec2,r=n.sys,l=n.Sprite,f=n.Color},function(n){p=n.V2},null,function(n){u=n.UIEffectAsset},function(n){d=n.SLGMapData},function(n){h=n.SeasonEventDefine},function(n){m=n.default},function(n){S=n._regionColors},function(n){v=n.BaseView}],execute:function(){t._RF.push({},"f092ekvY2dNZ7E78TuNO6ZJ","SeasonSceneMinimapView",void 0);var C=.0361,E=new i,M=new p;n("default",function(n){function t(){var e;return(e=n.call(this)||this).points=[],e.mapPoint=void 0,e.camera=void 0,e.name="SeasonSceneMinimapView",e.url="ui/module/season/scene-view/SeasonSceneMinimapView",e}e(t,n);var p=t.prototype;return p.onInit=function(){var n=this,e=this.findChild("imgMask");this.addComponentCallbackListener(e,o.EventType.CLICK,(function(){n.close()}));var t=this.findChild("content/map"),i=t.getComponent(s);this.addComponentCallbackListener(t,a.EventType.TOUCH_END,(function(e){var t=e.getUILocation();E.set(t.x,t.y);var o=i.convertToNodeSpaceAR(E);o.z=0;var s=new c(Math.floor(o.x/C),Math.floor(o.y/C));normalEvent.emit(h.SEASON_SCENE_VIEW,s),n.close()})),this.mapPoint=this.findChild("content/mapPoint"),this.camera=this.findChild("content/camera"),r.uiMirror&&(this.findChild("content").setScale(-1,1,1),this.findChild("content/title").setScale(-1,1,1),this.findChild("content/rateTxt").setScale(1,1,1))},p.registerUpdateHandler=function(){this.addEvent(h.SEASON_SCENE_MINI_MAP,this.onMinimap,this)},p.onAfterOpen=function(){var n=this.openArgs[0];this.camera.position=new i(n.x*C,n.y*C-50,0),IS(m).reqMinimap()},p.onBeforeClose=function(){this.points.forEach((function(n){n.free()})),this.points.length=0},p.onDestroy=function(){},p.onMinimap=function(n){for(var e=this,t=function(t){var i=n[t];e.points[t]=u.alloc("ui/module/season/scene/MinimapPoint",e.mapPoint,-1,(function(n){n.node.getComponent(l).color=0==i.area_id?f.WHITE:S[i.area_id-1]}));var o=d.getCRToPos(i.pos.x,i.pos.y);M.set(o.x*C,o.y*C),e.points[t].position=M;var s=configSeason_building_plot.getDataByKey(i.base_id);e.points[t].scale=s.minimap_scale/1e4},i=0;i<n.length;i++)t(i)},t}(v));t._RF.pop()}}}));

