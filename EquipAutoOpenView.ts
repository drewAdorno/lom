System.register("chunks:///_virtual/EquipAutoOpenView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./NodeUtil.ts","./PlatformUtil.ts","./StringUtil.ts","./index57.ts","./BaseView.ts","./ConfigGlobal.ts","./BagModel.ts","./MessageView.ts","./EquipDefine.ts","./EquipModel.ts","./PrivilegeDataCache.ts","./PrivilegeDefine.ts","./RoleControl.ts","./RoleDataCache.ts","./RoleDefine.ts","./UIDefine.ts"],(function(t){"use strict";var i,n,e,o,d,s,a,u,c,l,r,C,h,m,p,f,g,I,S,v,y,k,N,U,w,L;return{setters:[function(t){i=t.inheritsLoose},function(t){n=t.cclegacy,e=t.math,o=t.Button,d=t.Sprite,s=t.LabelOutline,a=t.Label,u=t.UITransform,c=t.Color,l=t.js},function(t){r=t.default},function(t){C=t.PlatformUtil},function(t){h=t.default},null,function(t){m=t.BaseView},function(t){p=t.ConfigGlobal},function(t){f=t.BagModel},function(t){g=t.default},function(t){I=t.EquipEventDefine},function(t){S=t.EquipModel},function(t){v=t.PrivilegeDataCache},function(t){y=t.PrivilegeCardEffect},function(t){k=t.default},function(t){N=t.RoleDataCache},function(t){U=t.ClientData,w=t.PlayerAttr},function(t){L=t.OpenFunction}],execute:function(){n._RF.push({},"f2482igoV5Iv6Z8CuZ4PJOA","EquipAutoOpenView",void 0);var _=p.box_goods_id,x=p.pvp_ticket_max,E=(e.Vec3,e.Vec2,[{y:336,height:60,str:200720},{y:260,height:238,str:200721},{y:16,height:56,str:200722}]);t("default",function(t){function n(){var i;return(i=t.call(this)||this).qualityItem=void 0,i.attrConditionItems=void 0,i.imgBtnStart=void 0,i.outLineBtnStart=void 0,i.nodeUsingConditionSelect1=void 0,i.nodeUsingConditionSelect2=void 0,i.nodeStopByTicket=void 0,i.selectNumItem=void 0,i.nodeMask=void 0,i.utMask=void 0,i.txtTip=void 0,i.guideIndex=0,i.name="EquipAutoOpenView",i.url="ui/module/equip/EquipAutoOpenView",i}i(n,t);var e=n.prototype;return e.onInit=function(){var t=this;this.attrConditionItems=[];var i=this.findChild("imgMask");this.addComponentCallbackListener(i,o.EventType.CLICK,(function(){t.onMaskClick()}));var n=this.findChild("content/btnStart");this.addComponentCallbackListener(n,o.EventType.CLICK,(function(){t.onStartClick()})),this.imgBtnStart=n.getComponent(d),this.outLineBtnStart=this.findChildComponent("content/btnStart/Label",s);var e=this.findChild("content/conditions/btnCondition1");this.addComponentCallbackListener(e,o.EventType.CLICK,(function(){t.togUsingConditionClick(0)}));var c=this.findChild("content/conditions/btnCondition2");this.addComponentCallbackListener(c,o.EventType.CLICK,(function(){t.togUsingConditionClick(1)})),this.nodeUsingConditionSelect1=this.findChild("content/conditions/btnCondition1/Checkmark");var C=this.nodeUsingConditionSelect1.getComponent(d);this.loadIcon(C,"common","common_ui_dagou"),this.nodeUsingConditionSelect2=this.findChild("content/conditions/btnCondition2/Checkmark");var h=this.nodeUsingConditionSelect2.getComponent(d);this.loadIcon(h,"common","common_ui_dagou");var m=this.findChild("content/conditions/btnTicketCondition");this.addComponentCallbackListener(m,o.EventType.CLICK,(function(){t.onStopByTicketClick()})),this.nodeStopByTicket=this.findChild("content/conditions/btnTicketCondition/Checkmark");var p=this.nodeStopByTicket.getComponent(d);this.loadIcon(p,"common","common_ui_dagou"),this.qualityItem={node:this.findChild("content/conditions/btnQuality"),txtCondition:this.findChildComponent("content/conditions/btnQuality/txtSelect",a),nodeUp:this.findChild("content/conditions/btnQuality/imgUp"),nodeDown:this.findChild("content/conditions/btnQuality/imgDown")},this.addComponentCallbackListener(this.qualityItem.node,o.EventType.CLICK,(function(){t.onQualityClick()}));for(var f=function(i){t.attrConditionItems[i]=[];for(var n=function(n){var e=t.findChild(l.formatStr("content/conditions/btnCondition%s%s",i+1,n+1));t.addComponentCallbackListener(e,o.EventType.CLICK,(function(){t.onAttrClick(i,n)})),t.attrConditionItems[i][n]={node:e,txtCondition:r.findChildComponent(e,"txtSelect",a),nodeUp:r.findChild(e,"imgUp"),nodeDown:r.findChild(e,"imgDown")}},e=0;e<2;e++)n(e)},g=0;g<2;g++)f(g);this.selectNumItem={node:this.findChild("content/conditions/btnMultiNum"),txtCondition:this.findChildComponent("content/conditions/btnMultiNum/txtSelect",a),nodeUp:this.findChild("content/conditions/btnMultiNum/imgUp"),nodeDown:this.findChild("content/conditions/btnMultiNum/imgDown")},this.addComponentCallbackListener(this.selectNumItem.node,o.EventType.CLICK,(function(){t.onSelectNumClick()})),this.nodeMask=this.findChild("mask"),this.utMask=this.nodeMask.getComponent(u),this.txtTip=this.findChildComponent("mask/txtTip",a);var I=this.findChild("mask/btnNext");this.addComponentCallbackListener(I,o.EventType.CLICK,(function(){t.guideIndex++,t.updateGuide()}))},e.registerUpdateHandler=function(){this.addEvent(I.AUTO_OPEN_CONDITION_CHANGE,this.onConditionChange,this),this.addEvent(I.CONDITION_LIST_VIEW_CLOSE,this.onConditionListViewClose,this)},e.updateGuide=function(){if(this.guideIndex>=E.length)this.nodeMask.active=!1;else{var t=E[this.guideIndex];this.utMask.height=t.height,this.nodeMask.setPosition(0,t.y),this.txtTip.node.setPosition(0,-t.height-5),this.txtTip.string=GetLanguage(t.str)}},e.onAfterOpen=function(){IS(S).tryLoadLocalInfo(),this.nodeUsingConditionSelect1.active=IS(S).getAttrConditionUseFlag(0),this.nodeUsingConditionSelect2.active=IS(S).getAttrConditionUseFlag(1),this.nodeStopByTicket.active=IS(S).checkAutoStopByGetTicket(),this.updateQualityConditionShow(),this.updateAttrConditionShow(),this.updateSelectNumShow(),this.updateStartBtnStatus(),this.qualityItem.nodeDown.active=!0,this.qualityItem.nodeUp.active=!1,this.selectNumItem.nodeUp.active=!0,this.selectNumItem.nodeDown.active=!1;for(var t=0;t<2;t++)for(var i=0;i<2;i++)this.attrConditionItems[t][i].nodeDown.active=!0,this.attrConditionItems[t][i].nodeUp.active=!1;var n=IS(N).getClientDataByNum(U.Equip,"auto_open_guide");n?this.nodeMask.active=!1:(this.guideIndex=0,this.nodeMask.active=!0,this.updateGuide(),n++,IS(k).send_3_29(U.Equip,1,"auto_open_guide",String(n)))},e.updateQualityConditionShow=function(){var t=IS(S).getQualityCondition();t<=0&&(t=1);var i=IS(S).getEquipQualityNameAndColor(t,!0);this.qualityItem.txtCondition.string=h.formatStrWithMirrorDeal(GetLanguage(200262),i.nameStr),this.qualityItem.txtCondition.color=i.nameColor},e.updateAttrConditionShow=function(){for(var t=0;t<2;t++)for(var i=0;i<2;i++)this.updateSingleConditionShow(t,i)},e.updateSelectNumShow=function(){var t=IS(S).getSelectAutoMultiNum()||1;this.selectNumItem.txtCondition.string=IS(S).getMultiNumName(t)},e.updateSingleConditionShow=function(t,i){var n,e=IS(S).getAttrConditionByIdx(t,i);if(0==e)n=GetLanguage(200263);else{var o=configAttribute.getDataByKey(e);n=null==o?void 0:o.name}this.attrConditionItems[t][i].txtCondition.string=n,this.attrConditionItems[t][i].nodeUp.active=!0,this.attrConditionItems[t][i].nodeDown.active=!1},e.updateStartBtnStatus=function(){var t=IS(f).getGoodsCountByGoodsGtid(_)<=0;this.loadIcon(this.imgBtnStart,"common",t?"common_ICON_zhihuianniu":"common_ICON_luanniu"),this.outLineBtnStart.color=t?new c(76,76,76):new c(41,65,21)},e.onBeforeClose=function(){},e.onDestroy=function(){},e.onConditionChange=function(t){"quality"==t.typeStr?(IS(S).setQualityCodition(t.selectValue),this.updateQualityConditionShow()):"attr"==t.typeStr?(IS(S).setAttrConditionDetail(t.listIdx,t.idx,t.selectValue),this.updateSingleConditionShow(t.listIdx,t.idx)):"multiNum"==t.typeStr&&(IS(S).setSelectAutoMultiNum(t.selectValue[1]),this.updateSelectNumShow())},e.onConditionListViewClose=function(t){"quality"==t.typeStr?(this.qualityItem.nodeUp.active=!1,this.qualityItem.nodeDown.active=!0):"attr"==t.typeStr?(this.attrConditionItems[t.listIdx][t.idx].nodeUp.active=!1,this.attrConditionItems[t.listIdx][t.idx].nodeDown.active=!0):"multiNum"==t.typeStr&&(this.selectNumItem.nodeUp.active=!0,this.selectNumItem.nodeDown.active=!1)},e.onMaskClick=function(){this.close()},e.onStartClick=function(){var t=this;IS(f).getGoodsCountByGoodsGtid(_)<=0||(IS(S).checkAutoStopByGetTicket()&&IS(f).getGoodsCountByGoodsGtid(1006)>=x+ +IS(v).getPrivilegeCardValue(y.CHALLENGE)?g.showBoxTip({tip:GetLanguage(300074),func:function(i){if("type_yes"==i){if(!IS(N).CheckFuncOpen(L.FUNC_PVP,!0))return;t.CheckNeedGetUserInfo()?t.GetUserInfo():uiMgr.openView("PvpMainView"),t.close()}}}):(IS(S).setAutoOpen(!0),IS(S).tryAutoMultiOpenBox(),this.close()))},e.CheckNeedGetUserInfo=function(){var t=IS(N).getClientDataByNum(U.WXUSERINFO,"HasGetUserInfo"),i=IS(N).GetRoleName();return!(0!=t||!i.includes(GetLanguage(200449)))},e.GetUserInfo=function(){C.getUserInfo((function(t,i,n){if(1==n){var e=new Array;e.push({k:w.ROLE_ATTR_HEAD_URL,s:t}),e.push({k:w.ROLE_ATTR_NAME,s:i});var o={ks:e};IS(k).send_3_22(o),IS(k).send_3_29(U.WXUSERINFO,1,"HasGetUserInfo",1)}uiMgr.openView("PvpMainView")}))},e.onQualityClick=function(){var t={typeStr:"quality",targetNode:this.qualityItem.node,descStr:GetLanguage(200262),selectValue:IS(S).getQualityCondition()};this.qualityItem.nodeDown.active=!1,this.qualityItem.nodeUp.active=!0,uiMgr.openView("EquipConditionListView",t)},e.onSelectNumClick=function(){var t={typeStr:"multiNum",targetNode:this.selectNumItem.node,descStr:"",selectValue:IS(S).getSelectAutoMultiNum(),onUp:!0};this.selectNumItem.nodeDown.active=!0,this.selectNumItem.nodeUp.active=!1,uiMgr.openView("EquipConditionListView",t)},e.onAttrClick=function(t,i){var n={typeStr:"attr",listIdx:t,idx:i,targetNode:this.attrConditionItems[t][i].node,selectValue:IS(S).getAttrConditionByIdx(t,i)};this.attrConditionItems[t][i].nodeDown.active=!1,this.attrConditionItems[t][i].nodeUp.active=!0,uiMgr.openView("EquipConditionListView",n)},e.togUsingConditionClick=function(t){var i=IS(S).getAttrConditionUseFlag(t);this[l.formatStr("nodeUsingConditionSelect%s",t+1)].active=!i,IS(S).setAttrConditionUseFlag(t,!i)},e.onStopByTicketClick=function(){var t=IS(S).checkAutoStopByGetTicket();this.nodeStopByTicket.active=!t,IS(S).setAutoStopByGetTicket(!t)},n}(m));n._RF.pop()}}}));

