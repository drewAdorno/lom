System.register("chunks:///_virtual/MarryDialogDataCache.ts",["cc","./RedPointMgr.ts","./StringUtil.ts","./TimeUtil.ts","./FixMath.ts","./BagModel.ts","./ChatDataCache.ts","./ChatDefine.ts","./MessageView.ts","./PayDataCache.ts","./RoleDataCache.ts","./TaskDataCache.ts","./TaskDefine.ts","./MarryControl.ts","./MarryDefine.ts"],(function(i){"use strict";var e,t,n,r,a,s,_,o,d,f,g,h,l,c,u,v,m,p,y,w;return{setters:[function(i){e=i.cclegacy,t=i.sys,n=i.HorizontalTextAlignment,r=i.js},function(i){a=i.RedPointMgr},function(i){s=i.default},function(i){_=i.default},function(i){o=i.FixMath},function(i){d=i.BagModel},function(i){f=i.ChatDataCache},function(i){g=i.ChatDefine},function(i){h=i.default},function(i){l=i.default},function(i){c=i.RoleDataCache},function(i){u=i.TaskDataCache},function(i){v=i.TaskType,m=i.TaskState},function(i){p=i.default},function(i){y=i.MarryEventDefine,w=i.MarryInitDialogStage}],execute:function(){e._RF.push({},"c1aefjXsz5OA4NZGYUtUIcQ","MarryDialogDataCache",void 0);i("default",function(){var i=e.prototype;function e(){this.favor_lv=0,this.marryState=0,this.lover_id=0,this.lover_info=null,this.wedding_type=0,this.wedding_time_id=0,this.lover_gender=0,this.isWedding=0,this.weddingDate=0,this.wedding_time_list=[],this.history_wedding=void 0,this.divorce_timeLeft=void 0,this.invite_info=void 0,this.favor_friend_info=void 0,this.ring_info=void 0,this.talk_stage=0,this.talk_options=[],this.choose_wedding_time_id=0}return i.clear=function(){},i.UpdateMarryStatus=function(i){if(this.marryState=i.state,this.lover_id=i.lover_id,this.wedding_type=0,this.wedding_time_id=0,this.choose_wedding_time_id=0,i.ext&&i.ext.length>0)for(var e in i.ext)if(i.ext.hasOwnProperty(e)){var t=i.ext[e];1==t.k?(this.wedding_time_id=t.v,this.choose_wedding_time_id=this.wedding_time_id):2==t.k?this.wedding_type=t.v:3==t.k?this.divorce_timeLeft=t.v:4==t.k?this.lover_gender=t.v:5==t.k?this.isWedding=t.v:6==t.k&&(this.weddingDate=t.v)}this.history_wedding=i.his_party,this.UpdateTalkState(),normalEvent.emit(y.MARRY_STATUS_UPDATE),(0==this.lover_id||this.lover_id&&0!=this.lover_id)&&normalEvent.emit(y.MARRY_DIALOG_STAGE_CHANGE)},i.UpdateTalkState=function(){switch(this.marryState){case 0:this.talk_stage=w.Normal;break;case 1:this.talk_stage=w.Dating;break;case 2:1==this.isWedding?this.talk_stage=w.isWedding:this.wedding_type&&0!=this.wedding_type&&0==this.wedding_time_id?this.talk_stage=w.WeddingDate:this.wedding_time_id&&0!=this.wedding_time_id?this.talk_stage=w.Wedding:this.talk_stage=w.Engaged;break;case 3:1==this.isWedding?this.talk_stage=w.isWedding:this.history_wedding&&this.history_wedding.length>=3?this.talk_stage=w.MarryFinish:this.wedding_type&&0!=this.wedding_type&&0==this.wedding_time_id?this.talk_stage=w.MarryWeddingDate:this.wedding_time_id&&0!=this.wedding_time_id?this.talk_stage=w.MarryWedding:this.divorce_timeLeft&&0!=this.divorce_timeLeft?this.talk_stage=w.Divore:this.talk_stage=w.Marry}this.UpdateTalkOptions()},i.UpdateTalkOptions=function(){if(this.talk_stage&&0!=this.talk_stage){var i=configTalk_stage.getDataByKey(this.talk_stage);this.talk_options=i.options}},i.UpdateLoversInfo=function(i){this.lover_info=i,normalEvent.emit(y.MARRY_DIALOG_STAGE_CHANGE)},i.UpdateInviteFriendInfo=function(i){this.invite_info=null!=i?i:[],normalEvent.emit(y.MARRY_INVITE_FRIEND_LIST_UPDATE)},i.UpdateMarryPartyReserve=function(i){0==i.code&&(this.wedding_time_id=i.cfg_id,this.choose_wedding_time_id=i.cfg_id,normalEvent.emit(y.MARRY_PARTY_RESERVE_UPDATE))},i.UpdateMarryPartyReserveList=function(i){if(i.cfg_id){this.wedding_time_list=[];for(var e=0;e<i.cfg_id.length;e++)this.wedding_time_list[i.cfg_id[e]]=!0}else this.wedding_time_list=[];normalEvent.emit(y.MARRY_PARTY_RESERVE_LIST_UPDATE)},i.UpdateMarryResp=function(i){0==i.code&&(this.lover_id=i.target_id)},i.UpdateFavorFriendInfo=function(i){1!=i.page&&this.favor_friend_info?(this.favor_friend_info.left_times=i.left_times,this.favor_friend_info.page=i.page,this.favor_friend_info.total_num=i.num,this.favor_friend_info.reward_times=i.reward_times,this.favor_friend_info.friend_list=this.favor_friend_info.friend_list.concat(i.friend_list)):this.favor_friend_info={left_times:i.left_times,page:i.page,total_num:i.num,friend_list:i.friend_list,reward_times:i.reward_times},normalEvent.emit(y.MARRY_FAVOR_FRIEND_INFO_UPDATE)},i.UpdateFavorSingleFriendInfo=function(i){if(this.favor_friend_info)for(var e in this.favor_friend_info.friend_list)this.favor_friend_info.friend_list.hasOwnProperty(e)&&this.favor_friend_info.friend_list[e].role_id==i.update_info.role_id&&(this.favor_friend_info.friend_list[e].favor_lv=i.update_info.favor_lv,this.favor_friend_info.friend_list[e].favor=i.update_info.favor);normalEvent.emit(y.MARRY_FAVOR_FRIEND_INFO_UPDATE)},i.UpdateFavorRewardSingleFriendInfo=function(i){if(this.favor_friend_info)for(var e in this.favor_friend_info.friend_list)this.favor_friend_info.friend_list.hasOwnProperty(e)&&this.favor_friend_info.friend_list[e].role_id==i.friend_id&&(this.favor_friend_info.friend_list[e].list=i.list,this.favor_friend_info.friend_list[e].reward_times=i.reward_times);normalEvent.emit(y.MARRY_FAVOR_FRIEND_INFO_UPDATE)},i.UpdateFlowerBuyCount=function(i){this.favor_friend_info.left_times=i.left_times,normalEvent.emit(y.MARRY_FAVOR_FRIEND_INFO_UPDATE)},i.UpdateRingInfo=function(i){this.ring_info={curLevel:i.level,ring_id:i.use,curexp:i.exp,skin_list:i.skin_list,skill_use:i.skill_use,talent_list:i.talent_list},normalEvent.emit(y.MARRY_RING_INFO_UPDATE)},i.UpdateCurRingExp=function(i){if(this.ring_info.curexp=i.exp,i.old_lev!=i.new_lev){var t=0,n=IS(e).GetLoverId();n&&0!=n&&(t=this.favor_lv),uiMgr.openView("MarryRingUpgradeResultView",i.old_lev,i.new_lev,t)}normalEvent.emit(y.MARRY_RING_ADD_EXP)},i.UpdateCurRingUse=function(i){this.ring_info.ring_id=i.use,normalEvent.emit(y.MARRY_RING_USE_CHANGE)},i.UpdateCurRingUseSkill=function(i){this.ring_info.skill_use=i.skill_use,normalEvent.emit(y.MARRY_RING_SKILL_USE_CHANGE)},i.checkUpgradeRP=function(){if(this.ring_info){var i=IS(d).getGoodsCountByGoodsGtid(1114);if(null!=configRing_level.getDataByKey(this.ring_info.curLevel+1)){var e=configRing_level.getDataByKey(this.ring_info.curLevel+1).expend_exp;if(i>=(e-=this.ring_info.curexp))return IS(a).changeValue("marry_ring_upgrade_active",1),1}return IS(a).changeValue("marry_ring_upgrade_active",0),0}return 0},i.StageHasOption=function(i){for(var e=!1,t=0;t<this.talk_options.length;t++)if(this.talk_options[t]==i){e=!0;break}return e},i.ChooseOption=function(i,e){var r=this,a=this.GetLoverGender(),_=IS(c).GetGender();if(this.StageHasOption(i)){var u=configTalk_option.getDataByKey(i);switch(u.type){case 0:e.close();break;case 1:this.talk_stage=u.jump_stage,this.UpdateTalkOptions(),normalEvent.emit(y.MARRY_DIALOG_STAGE_CHANGE);break;case 2:u.jump_view&&uiMgr.openView(u.jump_view);break;case 3:if(this.choose_wedding_time_id&&0!=this.choose_wedding_time_id){var v=u.remind;h.showBoxTip({tip:v,func:function(i){"type_yes"==i&&IS(p).send_marry_party_reserve_c2s(r.choose_wedding_time_id)},horizontalAlign:t.uiMirror?n.RIGHT:n.LEFT})}break;case 4:if(u.marry_type){var m="",w=configMarry.getDataByKey(u.marry_type).spend;if(w&&1==w[0])m=s.formatStr(u.remind,w[1][1]);else if(w&&2==w[0]){var R=configPay_mall.getDataByKey(w[1]);m=s.formatStr(u.remind,o.round(R.price))}h.showBoxTip({tip:m,func:function(i){if("type_yes"==i)if(1==u.marry_type)if(IS(d).getGoodsCountByGoodsGtid(w[1][0])>=w[1][1])IS(p).send_marry_direct_c2s();else{var e=configGoods.getDataByKey(w[1][0]);h.showFlyTip(s.formatStrWithMirrorDeal(GetLanguage(200453),e.name))}else IS(l).Pay(w[1])},horizontalAlign:t.uiMirror?n.RIGHT:n.LEFT})}break;case 5:var k="";k=u.differnece&&u.differnece.length>0?a&&a==_?s.formatStr(u.remind,GetLanguage(u.differnece[1])):s.formatStr(u.remind,GetLanguage(u.differnece[0])):u.remind,h.showBoxTip({tip:k,func:function(i){if("type_yes"==i)switch(u.id){case 5:case 7:IS(p).send_marry_break_up_c2s();break;case 19:IS(p).send_marry_cancel_wedding_c2s();break;case 24:r.lover_id&&IS(f).SendShareData(g.ChatLinkType.DivoreApply,null,g.Channel.Private,r.lover_id);break;case 25:IS(p).send_marry_divorce_force_c2s();break;case 29:IS(p).send_marry_cancel_divorce_c2s()}},horizontalAlign:t.uiMirror?n.RIGHT:n.LEFT})}}},i.GetWeddingTimeID=function(){return this.choose_wedding_time_id},i.GetChooseWeddingTime=function(){if(this.choose_wedding_time_id&&0!=this.choose_wedding_time_id){var i=configWedding_time.getDataByKey(this.choose_wedding_time_id);return _.getFutureDateByDayTime(i.week,i.time)}return GetLanguage(204110)},i.GetWeddingTime=function(){if(this.wedding_time_id&&0!=this.wedding_time_id){var i=configWedding_time.getDataByKey(this.wedding_time_id);return _.getFutureDateByDayTime(i.week,i.time)}return GetLanguage(204110)},i.GetWeddingType=function(){return this.wedding_type},i.IsWeddingTimeDated=function(i){return!!(this.wedding_time_list&&this.wedding_time_list.length>0)&&!!this.wedding_time_list[i]},i.GetTalkOptions=function(){return this.talk_options},i.GetTalkStage=function(){return this.talk_stage},i.GetLoverId=function(){return this.lover_id?this.lover_id:0},i.GetLoverGender=function(){return this.lover_gender},i.changeChooseWeddingId=function(i){this.choose_wedding_time_id=i},i.GetFavorFriendInfo=function(){return this.favor_friend_info},i.GetRingInfo=function(){var i;return null!=(i=this.ring_info)?i:{}},i.GetInviteInfo=function(){return this.invite_info},i.CheckInviteState=function(i){for(var e,t=null!=(e=this.invite_info.guest_list)?e:[],n=0;n<t.length;n++)if(t[n].k==i)return t[n].v;return-1},i.GetWeddingDate=function(){if(this.weddingDate&&0!=this.weddingDate){var i=_.ServerDate(1e3*this.weddingDate);return r.formatStr("%s/%s/%s %s:%s",i.getFullYear(),i.getMonth()+1,i.getDate(),i.getHours(),i.getMinutes())}return""},i.getFavorRedPoint=function(){return IS(c).getRedNumByModule(2e4,1)},i.getFavorWeedRedPoint=function(){var i=0,e=configMarry_task.getDatas();if(e)for(var t=0;t<e.length;t++){var n=e[t];IS(u).GetTaskItem(v.Marry,n.id).state==m.Complete&&i++}return i},e}());e._RF.pop()}}}));

