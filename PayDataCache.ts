System.register("chunks:///_virtual/PayDataCache.ts",["./rollupPluginModLoBabelHelpers.js","cc","./StorageUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./ConfigGlobal.ts","./BagDefine.ts","./BagModel.ts","./ChapterDefine.ts","./CommonDefine.ts","./GameSetting.ts","./MessageView.ts","./LoginDataCache.ts","./RoleDataCache.ts","./RoleDefine.ts","./NativeToJs.ts","./SdkDataCache.ts","./TaskDefine.ts","./PayDefine.ts","./UIDefine.ts","./BaseView.ts"],(function(e){"use strict";var t,i,n,o,r,a,s,f,u,h,p,l,d,c,g,y,_,I,C,m,v,S,P,G,T,D,L,w;return{setters:[function(e){t=e.createForOfIteratorHelperLoose},function(e){i=e.cclegacy,n=e.js},function(e){o=e.default},function(e){r=e.default},function(e){a=e.default},null,function(e){s=e.ConfigGlobal},function(e){f=e.ItemIdDefine},function(e){u=e.BagModel},function(e){h=e.ChapterEventDefine},function(e){p=e.CommonEventDefine},function(e){l=e.default,d=e.GameSettingKey},function(e){c=e.default},function(e){g=e.LoginDataCache},function(e){y=e.RoleDataCache},function(e){_=e.PlayerAttr,I=e.RoleEventDefine},function(e){C=e.NativeToJs},function(e){m=e.SdkDataCache},function(e){v=e.TaskType,S=e.TaskEventDefine},function(e){P=e.PayEventDefine,G=e.GiftType,T=e.CurrencySignPreview,D=e.CurrencySign},function(e){L=e.OpenFunction},function(e){w=e.ViewEvent}],execute:function(){i._RF.push({},"10eb32Pe6NDV4w/1UC3c5R2","PayDataCache",void 0);e("default",function(){var e=i.prototype;function i(){this.payGiftInfo=[],this.groupInfoList=[],this.typeInfoList=[],this.popupGiftInfo=[],this.showIconInfo=[],this.rechargeInfo={total_money:0,daily_money:0},this.popGiftId=0,this.showedPushGift=!1,this.payTime=0,this.payID=0,this.cashRedPoint=0,this.is_need_send_point=!1,this.CurrencyCode="USD",this.requestQRCodeTime=0,this.customInfoList=[],normalEvent.on(I.ROLE_INFO_UPDATE,this.onRoleInfoUpdate,this),normalEvent.on(h.CHAPTER_BATTLE_RESUTL,this.onChapterBattleResult,this),normalEvent.on(S.TASK_COMMIT_UPDATE,this.onTaskCommitUpdate,this),normalEvent.on(P.PAY_OFFICIAL_REWARD_UPDATE,this.onCashRedPointUpdate,this),normalEvent.on(w.ViewClose,this.onViewClose,this)}return e.clear=function(){},e.UpdatePayGiftInfoList=function(e){var t,i={},n=null!=(t=e.pay_mall_list)?t:{};for(var o in this.payGiftInfo)if(this.payGiftInfo.hasOwnProperty(o)){var r=this.payGiftInfo[o];if(r.type==e.type){for(var a=!0,s=0;s<n.length;s++)if(r.id==n[s].bundle_id){a=!1;break}a&&(i[r.id]=!0,this.DeleteGiftInfo(r))}}for(var f=[],u=0;u<n.length;u++){var h=n[u],l=this.UpdatePayGiftInfo(h),d=l.info,c=l.isNew;i[d.id]=!0,c&&f.push(d)}if(f.length>0){f.sort((function(e,t){return e.payCfg.push_level!=t.payCfg.push_level?e.payCfg.push_level-t.payCfg.push_level:e.end_time!=t.end_time?e.end_time-t.end_time:e.id-t.id}));for(var g=0;g<f.length;g++)this.CheckMainIcon(f[g]);this.CheckOpenPushGift()}normalEvent.emit(P.PAY_INFO_UPDATE,i),normalEvent.emit(p.UPDATE_MAIN_SHOP_RED_POINT)},e.UpdatePayGiftInfoSingle=function(e){var t=this.UpdatePayGiftInfo(e.pay_mall),i=t.info,n=(t.isNew,[]);n[i.id]=!0,normalEvent.emit(P.PAY_INFO_UPDATE,n),normalEvent.emit(p.UPDATE_MAIN_SHOP_RED_POINT)},e.UpdatePayGiftInfo=function(e){var t=e.bundle_id,i=this.payGiftInfo[t],n=!1;if(null==this.typeInfoList[e.type]&&(this.typeInfoList[e.type]=[]),null==this.groupInfoList[e.type]&&(this.groupInfoList[e.type]=[]),null==i&&(i={id:t,type:e.type},this.payGiftInfo[t]=i,i.payCfg=configPay_mall.getDataByKey(t),this.typeInfoList[e.type].push(i),n=!0),i.bought_times=e.bought_times,i.end_time=e.end_time,i.rewardState=e.is_reward,!i.payCfg)return printLogErr(e.bundle_id),n=!1,this.DeleteGiftInfo(i),{info:i,isNew:n};if(15!=i.type&&0!=i.payCfg.bundle_group){var o=this.groupInfoList[e.type][i.payCfg.bundle_group];null!=o&&o.id!=i.id&&(this.DeleteGiftInfo(o),this.groupInfoList[e.type][i.payCfg.bundle_group]=i),this.groupInfoList[e.type][i.payCfg.bundle_group]=i}return{info:i,isNew:n}},e.DeleteGiftInfo=function(e){delete this.payGiftInfo[e.id],e.payCfg&&delete this.groupInfoList[e.type][e.payCfg.bundle_group];var t=this.typeInfoList[e.type];t.splice(t.indexOf(e),1);var i=this.popupGiftInfo.indexOf(e);i>=0&&this.popupGiftInfo.splice(i,1);var n=[];n[e.id]=!0,normalEvent.emit(P.PAY_INFO_UPDATE,n)},e.UpdateRewardState=function(e){c.showFlyTip(GetLanguage(200467));var t=e.bundle_id;this.payGiftInfo[t].rewardState=2,normalEvent.emit(P.PAY_REWARD_UPDATE,t),normalEvent.emit(p.UPDATE_MAIN_SHOP_RED_POINT)},e.RechargeSuccess=function(e){c.showFlyTip(GetLanguage(200468)),normalEvent.emit(P.PAY_RECHARGE_SUCCESS),null!=e.order_id&&(e.order_id&&e.order_id<=0||""!=e.order_id&&sdkControl.logPayFinish(undefined,String(e.money||0),String(e.order_id||0)))},e.UpdateRechargeInfo=function(e){if(0==(this.rechargeInfo.total_money||0)&&e.total_money>0){if(!IS(l).isInit)return void(this.is_need_send_point=!0);0==(IS(l).Get(d.FIRST_PURCHASE)||0)&&(this.is_need_send_point=!1,C.hwLogEventApi("First_Purchase"),sdkControl.Hwlog("First_Purchase"),IS(l).set(d.FIRST_PURCHASE,1))}this.rechargeInfo.total_money=e.total_money,this.rechargeInfo.daily_money=e.daily_money,normalEvent.emit(P.PAY_RECHARGE_INFO_UPDATE)},e.UpdateFirstPurcharse=function(){this.is_need_send_point&&(this.is_need_send_point=!1,0==(IS(l).Get(d.FIRST_PURCHASE)||0)&&(C.hwLogEventApi("First_Purchase"),sdkControl.Hwlog("First_Purchase"),IS(l).set(d.FIRST_PURCHASE,1)))},e.UpdatePayCheck=function(e){this.payID==e.bundle_id&&(a.serverTime-e.time>5?c.showFlyTip(GetLanguage(200469)):(1==e.result?this.Pay(e.bundle_id,!0):c.showFlyTip(GetLanguage(200470)),this.payTime=0,this.payID=0))},e.UpdatePayCustomInfo=function(e){for(var t in this.customInfoList=[],e.list)if(e.list.hasOwnProperty(t)){var i=e.list[t];this.customInfoList[i.id]=i.list}normalEvent.emit(P.PAY_CUSTOM_INFO_UPDATE)},e.UpdateSinglePayCustomInfo=function(e){this.customInfoList[e.update_info.id]=e.update_info.list,normalEvent.emit(P.PAY_CUSTOM_INFO_SET)},e.Pay=function(e,t){void 0===t&&(t=!1);var i=configPay_mall.getDataByKey(e);if(null!=i&&(i.type!=G.Push||IS(y).CheckFuncOpen(L.FUNC_BUNDLE_PUSH,!0)))if(i.type!=G.Custom||this.IsCustomFinish(e)){if(!t){var o=IS(u).getGoodsCountByGoodsGtid(f.FakeRechare);if(o>=i.price){r.formatStrWithMirrorDeal(GetLanguage(200472),o,i.price);return void uiMgr.openView("CashTipView",e)}}if(0==GlobalDefine.ENABLE_SDK){var a=r.formatStrWithMirrorDeal(GetLanguage(200473),e);c.showBoxTip({tip:a,title:GetLanguage(200048),func:function(t){if("type_yes"==t){var i=n.formatStr("recharge %s 1",e);netManager.send("system.system_gm_c2s",{content:i})}}})}else{var s=i.pid;2==C.GetBagTag()?s=i.hw_pid:3==C.GetBagTag()?s=i.cata_pid:4==C.GetBagTag()&&(s=i.galaxy_pid),s=i.h5_pid;var h=String(IS(y).GetRoleId())+"_"+String(i.id);sdkControl.pay(String(i.price),String(s),i.name,i.name,"1","10",GetLanguage(200474),h,IS(g).uid,IS(g).loginServer.id,IS(y).GetRoleName(),String(IS(y).GetRoleId()),String(IS(y).GetLevel()))}}else c.showFlyTip(GetLanguage(202017))},e.CheckMainIcon=function(e,t){if(null==t&&(t=!0),t&&e.payCfg.push_level>0){var i=a.serverTime;return e.bought_times<e.payCfg.buy_times&&(0==e.end_time||i<e.end_time)?(this.popupGiftInfo.push(e),!0):(this.DeleteGiftInfo(e),!1)}return!1},e.CheckOpenPushGift=function(){var e=this.popupGiftInfo.shift();if(IS(m).showrechage&&IS(y).CheckFuncOpen(L.FUNC_MALL)){var t=a.serverTime;null==e||e.end_time>0&&e.end_time<=t||(this.showedPushGift||(this.popupGiftInfo=[],this.showedPushGift=!0),e.payCfg.type==G.Push&&uiMgr.addPopView("PayPushView",e))}},e.IsCustomFinish=function(e){for(var i,n,o=null!=(i=this.customInfoList[e])?i:[],r=configCustom_mall.getDataByKey(e),a=0,s=t(o);!(n=s()).done;){0!=n.value.v&&a++}return a>=r.custom_reward.length},e.GetPayGiftInfo=function(e){return this.payGiftInfo[e]},e.GetTypeInfoList=function(e){return this.typeInfoList[e]},e.GetTypeInfoGroup=function(e){return this.groupInfoList[e]},e.GetRechargeInfo=function(){return this.rechargeInfo},e.GetCustomInfoList=function(e){return this.customInfoList[e]},e.IsShowView=function(){return IS(m).showrechage},e.onViewClose=function(e){IS(y).CheckFuncOpen(L.FUNC_MALL)&&IS(m).showrechage&&this.CheckOpenPushGift()},e.onRoleInfoUpdate=function(e){e[_.ROLE_ATTR_LVL]&&this.CheckPop(1)},e.onTaskCommitUpdate=function(e,t){e==v.Main&&this.CheckPop(2,t)},e.onChapterBattleResult=function(e,t,r,a,f){if(0==r)this.CheckPop(3,e);else{if(!IS(m).showrechage)return;if(!IS(y).CheckFuncOpen(L.FUNC_FIRST_CHARGE))return;var u=IS(i).GetPayRechargeGift();if(null==u)return;var h="PayRechargeRewardViewPop"+IS(y).GetRoleId(),p=o.get(h);if(null!=p){var l=p.split("#");if(l[1]==u.id){var d=Number(l[2])+1;s.bundle_pop_gap.includes(d)&&(uiMgr.ViewIsAddPop("PayRechargeRewardView")||uiMgr.addPopView("PayRechargeRewardView")),o.set(h,n.formatStr("#%s#%s",u.id,d))}else o.set(h,n.formatStr("#%s#%s",u.id,1))}else o.set(h,n.formatStr("#%s#%s",u.id,1))}},e.CheckPop=function(e,i){if(IS(y).CheckFuncOpen(L.FUNC_MALL)&&IS(m).showrechage){for(var n,o=[].concat(configPay_mall.getDatas()),r=t(o);!(n=r()).done;){var a=n.value,s=a.pop_up[0];if(null!=s&&s==e){switch(s){case 1:var f=IS(y).GetLevel();if(a.pop_up[1]!=f)continue;break;case 2:case 3:if(a.pop_up[1]!=i)continue}if(this.CheckConditon(a.buy_condition)&&this.CheckConditon(a.conditon)&&!this.CheckSoldOut(a.id)&&0!=a.online){if(0==a.bundle_group&&0==a.next_id){this.popGiftId=a.id;break}null==this.groupInfoList[a.type]&&(this.groupInfoList[a.type]=[]);var u=this.groupInfoList[a.type][a.bundle_group];if(null!=u&&u.id==a.id){this.popGiftId=a.id;break}if(null==u&&1==a.pre_id){this.popGiftId=a.id;break}}}}0!=this.popGiftId&&(10101==this.popGiftId?uiMgr.addPopView("PayRechargeRewardView"):uiMgr.addPopView("PayPopView",this.popGiftId,22),this.popGiftId=0)}},e.GetPayRechargeGift=function(){if(!IS(m).showrechage)return null;var e=this.payGiftInfo[10101];if(null!=e&&!this.CheckSoldOut(e.id)){if(!this.CheckConditon(e.payCfg.conditon))return null;var t=a.ServerDate(1e3*a.serverOpenTime),i=n.formatStr("%s/%s/%s %s:%s:%s",t.getFullYear(),t.getMonth()+1,t.getDate(),0,0,0),o=a.getServerDateByLocalStr(i).getTime()/1e3,r=24*e.payCfg.conditon[2]*60*60+o;return e.end_time=r,e}var s=this.groupInfoList[G.Limit];if(null!=s&&null!=s[10101]){var f=s[10101];if(!this.CheckConditon(f.payCfg.conditon))return null;if(0==f.bought_times||0!=f.payCfg.next_id){t=a.ServerDate(1e3*a.serverOpenTime),i=n.formatStr("%s/%s/%s %s:%s:%s",t.getFullYear(),t.getMonth()+1,t.getDate(),0,0,0);var u=a.getServerDateByLocalStr(i).getTime()/1e3,h=24*f.payCfg.conditon[2]*60*60+u;return f.end_time=h,f}}return null},e.CheckConditon=function(e){if(null==e[0])return!0;if(1==e[0]&&!IS(y).CheckFuncOpen(e[1]))return!1;if("open_day"==e[0]){var t=a.ServerDate(1e3*a.serverOpenTime),i=n.formatStr("%s/%s/%s %s:%s:%s",t.getFullYear(),t.getMonth()+1,t.getDate(),0,0,0),o=a.getServerDateByLocalStr(i).getTime()/1e3,r=a.serverTime-o,s=Math.floor(r/86400+1);if(s<e[1]||s>e[2])return!1}return!0},e.CheckSoldOut=function(e){var t=this.payGiftInfo[e];if(null!=t){if(t.payCfg.buy_times>0&&t.bought_times>=t.payCfg.buy_times)return!0;if(0==t.payCfg.price&&2==t.rewardState)return!0}return!1},e.GetGiftListByTabType=function(e){var i=this;if(!IS(m).showrechage)return[];for(var n,o=[].concat(configPay_mall.getDatas()),r=[],a=[],s=t(o);!(n=s()).done;){var f=n.value;if(f.tab_id==e&&(this.CheckConditon(f.buy_condition)&&this.CheckConditon(f.conditon)&&0!=f.online))if(0==f.bundle_group&&0==f.next_id)r.push(f);else{if(null==a[f.type]&&(a[f.type]=[]),null==this.groupInfoList[f.type]&&(this.groupInfoList[f.type]=[]),null!=a[f.type][f.bundle_group])continue;var u=this.groupInfoList[f.type][f.bundle_group];(null!=u&&u.id==f.id||null==u&&1==f.pre_id)&&(a[f.type][f.bundle_group]=!0,r.push(f))}}return r.sort((function(e,t){var n=i.CheckSoldOut(e.id);return n!=i.CheckSoldOut(t.id)?n?1:-1:e.show!=t.show?e.show-t.show:e.id-t.id})),r},e.GetRechargeGiftRed=function(){var e=this.GetPayRechargeGift();return null!=e&&1==e.rewardState?1:0},e.GetRedByTabType=function(e){for(var i,n=0,o=this.GetGiftListByTabType(e),r=t(o);!(i=r()).done;){var a=i.value;if(0==a.price){var s=this.GetPayGiftInfo(a.id);if(null!=s&&2==s.rewardState)continue;n+=1}}return 4==e&&(n+=this.cashRedPoint),1==e&&(n+=this.GetRechargeGiftRed()),n},e.GetPushGiftList=function(){if(!IS(m).showrechage)return[];var e=[],t=this.typeInfoList[G.Push];for(var i in t)if(t.hasOwnProperty(i)){var n=t[i];n.payCfg.push_level>0&&!this.CheckSoldOut(n.id)&&n.end_time>a.serverTime&&e.push(n)}return e.sort((function(e,t){return e.payCfg.push_level!=t.payCfg.push_level?e.payCfg.push_level-t.payCfg.push_level:e.end_time!=t.end_time?e.end_time-t.end_time:e.id-t.id})),e},e.GetAcivityGift=function(e,t,i){if(!IS(m).showrechage)return[];var n=configPay_mall.getDatas(),o=[];for(var r in n)if(n.hasOwnProperty(r)){var a=n[r];if(0==a.online)continue;a.type==e&&"act_type"==a.conditon[0]&&a.conditon[1]==t&&i>=a.conditon[2][0]&&i<=a.conditon[2][1]&&o.push(a)}return o.sort((function(e,t){return e.id-t.id})),o},e.GetCurrencyCode=function(){},e.GetPriceString=function(e,t){var i,n,o=configCost_level.getDataByKey(e),r=this.CurrencyCode,a=null!=(i=T[r])?i:D.USD;if(a==D.USD?r="USD":a!=D.PLN&&a!=D.FRF&&a!=D.DEM&&a!=D.ESP&&a!=D.PTE&&a!=D.ITL&&a!=D.CHF&&a!=D.ATS||(r="EUR",a=D.EUR),t)n=e;else{var s;if(!o)return"Error"+e;n=null!=(s=o[r])?s:o.USD}return a+String(n)},e.GetPriceNum=function(e){var t,i=configCost_level.getDataByKey(e),n=this.CurrencyCode;return i?null!=(t=i[n])?t:i.USD:0},e.onCashRedPointUpdate=function(e){this.cashRedPoint=e?1:0,IS(y).isHaveHideByType(11)&&(this.cashRedPoint=0)},i}());i._RF.pop()}}}));

