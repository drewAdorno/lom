System.register("chunks:///_virtual/ActivityStrategyRoleInfoView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./RedPoint.ts","./RedPointMgr.ts","./NodeUtil.ts","./StringUtil.ts","./index57.ts","./ItemIcon.ts","./ConfigGlobal.ts","./ObjectUtil.ts","./BagDefine.ts","./ResItems.ts","./ActivityDefine.ts","./ActivityStrategyControl.ts","./ActivityStrategyDataCache.ts","./BaseView.ts"],(function(t){"use strict";var e,i,n,o,a,r,s,c,f,u,d,l,h,p,g,y,I,m,v,C;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,n=t.Button,o=t.Vec2,a=t.js,r=t.Label,s=t.Sprite},function(t){c=t.RedPointType},function(t){f=t.RedPointMgr},function(t){u=t.default},function(t){d=t.default},null,function(t){l=t.IconAseetType},function(t){h=t.ConfigGlobal},function(t){p=t.default},function(t){g=t.BagEventDefine},function(t){y=t.ResItems},function(t){I=t.ActivityEventDefine},function(t){m=t.default},function(t){v=t.default},function(t){C=t.BaseView}],execute:function(){i._RF.push({},"23aaewRzuVO+5LGtxctchtR","ActivityStrategyRoleInfoView",void 0);var S=[1038],A=h.strategy_activity_display_attr;t("default",function(t){function i(){var e;return(e=t.call(this)||this).resItems=void 0,e.attrItems=[],e.equipItems=[],e.name="ActivityStrategyRoleInfoView",e.url="ui/module/ActivityStrategy/ActivityStrategyRoleInfoView",e}e(i,t);var h=i.prototype;return h.onInit=function(){var t=this;this.resItems=new y(this),this.resItems.init(S);var e=this.findChild("imgMask");this.addComponentCallbackListener(e,n.EventType.CLICK,(function(){t.close()}));var i=this.findChild("content/btnClose");this.addComponentCallbackListener(i,n.EventType.CLICK,(function(){t.close()}));var a=this.findChild("content/btnSkill");this.addComponentCallbackListener(a,n.EventType.CLICK,(function(){uiMgr.openView("ActivityStrategySkillMainView")}));var r=this.findChild("content/btnPet");this.addComponentCallbackListener(r,n.EventType.CLICK,(function(){uiMgr.openView("ActivityStrategyPetMainView")}));var s=this.findChild("content/btnJob");this.addComponentCallbackListener(s,n.EventType.CLICK,(function(){uiMgr.openView("ActivityStrategyRoleJobView")})),this.addRedPoint("ActivityStrategy/changeJob",s,new o(90,25),c.Dot),IS(f).updateRed("ActivityStrategy/changeJob");var u=this.findChild("content/attrInfo/btnAttr");this.addComponentCallbackListener(u,n.EventType.CLICK,(function(){uiMgr.openView("ActivityStrategyRoleAttrDetailView")})),this.initAttrItems(),this.initEquipItems()},h.initAttrItems=function(){for(var t,e,i=0;i<A.length;i++){t=a.formatStr("content/attrInfo/attrParent/attrItem%s",i+1);var n=this.findChild(t);e=A[i];var o=configAttribute.getDataByKey(e),s={txtName:u.findChildComponent(n,"txtName",r),txtValue:u.findChildComponent(n,"txtValue",r),attrId:e,config:o};s.txtName.string=o.name,this.attrItems.push(s)}},h.initEquipItems=function(){for(var t=this,e=function(e){var i=e,o=t.findChild(a.formatStr("content/equip/equipParent/equipItem%s",e));o.name=String(e);var c={node:o,imgFrame:u.findChildComponent(o,"imgFrame",s),imgIcon:u.findChildComponent(o,"imgIcon",s),txtLevel:u.findChildComponent(o,"txtLevel",r),equipType:i};t.addComponentCallbackListener(o,n.EventType.CLICK,(function(){t.onEquipClick(i,c.imgIcon.node)})),t.equipItems.push(c)},i=1;i<=10;i++)e(i)},h.registerUpdateHandler=function(){this.addEvent(g.GOODS_INFO_UPDATE,this.onGoodsInfoUpdate,this),this.addEvent(I.OnStrategyInfoBack,this.OnStrategyInfoBack),this.addEvent(I.OnStrategyAttrUpdate,this.OnStrategyAttrUpdate,this),this.addEvent(I.OnStrategyAttrListUpdate,this.OnStrategyAttrListUpdate,this),this.addEvent(I.OnStrategyEquipListUpdate,this.updateEquipShow,this)},h.onAfterOpen=function(){IS(m).reqActStrategyTabInfo(),IS(m).reqActStrategyTotalSpInfo(0),this.refreshInfo(),this.resItems.update()},h.refreshInfo=function(){this.updateAttrInfo(),this.updateEquipShow()},h.updateAttrInfo=function(){for(var t=0;t<this.attrItems.length;t++)this.attrItems[t].txtValue.string=String(this.getAttrValueById(this.attrItems[t].attrId))},h.getAttrValueById=function(t){var e=IS(v).getRoleAttrById(t),i=configAttribute.getDataByKey(t);return 2==i.show_type?a.formatStr("%s%",d.GetNumString(e/100)):3==i.show_type?d.GetNumString(Math.floor(e/100)/100):d.GetNumString(e)},h.updateEquipShow=function(){for(var t=0;t<this.equipItems.length;t++)this.updateSingleEquip(this.equipItems[t])},h.updateSingleEquip=function(t){t.effect&&(this.removeUIEffect(t.effect),t.effect=null);var e=t.equipType,i=IS(v).getEquipByLocation(e);if(!p.isEmpty(i)){var n=configEquipment.getDataByKey(i.config_id);this.loadIcon(t.imgIcon,n.atlas,n.icon,null,l.ICON_SPRITE),this.loadIcon(t.imgFrame,"icon_equip",configColor.getDataByKey(n.quality).path);var r=configColor.getDataByKey(n.quality).effect_path;null!=r&&""!=r&&(t.effect=this.addUIEffect(a.formatStr("prefab/ui-effect/%s",r),t.imgIcon.node,-1,new o(0,0))),t.txtLevel.string=a.formatStr("Lv.%s",i.equip_lv)}},h.OnStrategyAttrUpdate=function(t){for(var e=0;e<this.attrItems.length;e++){var i=this.attrItems[e];i.attrId==t&&(i.txtValue.string=this.getAttrValueById(t))}},h.OnStrategyAttrListUpdate=function(){this.updateAttrInfo()},h.onBeforeClose=function(){},h.onDestroy=function(){},h.onGoodsInfoUpdate=function(t,e){this.resItems.updateGtid(e)},h.OnStrategyInfoBack=function(){this.refreshInfo()},h.onEquipClick=function(t,e){var i=IS(v).getEquipByLocation(t);p.isEmpty(i)||uiMgr.openView("ActivityStrategyEquipDetailView",null==i?void 0:i.location)},i}(C));i._RF.pop()}}}));

