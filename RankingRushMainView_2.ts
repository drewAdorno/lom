System.register("chunks:///_virtual/RankingRushMainView_2.ts",["./rollupPluginModLoBabelHelpers.js","cc","./V2.ts","./GuildPinItem.ts","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./ConfigGlobal.ts","./MulLanguageUtil.ts","./MessageView.ts","./GuildControl.ts","./GuildDataCache.ts","./RankControl.ts","./RankDefine.ts","./RankModel.ts","./RoleDataCache.ts","./ActivityDefine.ts","./RankingRushDataCache.ts","./BaseView.ts"],(function(t){"use strict";var i,n,e,a,o,s,r,d,h,c,l,f,u,m,v,k,I,g,p,C,x,R,L,w,y,T,S,G,_,b;return{setters:[function(t){i=t.inheritsLoose},function(t){n=t.cclegacy,e=t.Button,a=t.sys,o=t.HorizontalTextAlignment,s=t.Sprite,r=t.Label,d=t.ScrollView,h=t.js},function(t){c=t.V2},function(t){l=t.GuildPinItem},function(t){f=t.ItemGrid},function(t){u=t.ListItem},function(t){m=t.default},function(t){v=t.default},function(t){k=t.default},null,function(t){I=t.ConfigGlobal},function(t){g=t.default},function(t){p=t.default},function(t){C=t.default},function(t){x=t.default},function(t){R=t.default},function(t){L=t.RankDefine},function(t){w=t.RankModel},function(t){y=t.RoleDataCache},function(t){T=t.ActivityEventDefine,S=t.ActivityState,G=t.RankRushRes},function(t){_=t.RankingRushDataCache},function(t){b=t.BaseView}],execute:function(){var M;n._RF.push({},"c1c08peuuhGUYeHkLY78ULI","RankingRushMainView_2",void 0);var N=1,B=2,U=3,D="",A=((M={})[1]=new c(0,0),M[2]=new c(0,0),M[3]=new c(0,0),t("default",function(t){function n(){var i;return(i=t.call(this)||this).topBg=void 0,i.txtTitle=void 0,i.nodeReward=void 0,i.nodeRank=void 0,i.rankList=void 0,i.rewardList=void 0,i.myFlag=void 0,i.txtMyRank=void 0,i.txtMyScore=void 0,i.txtMyName=void 0,i.txtLeftTime=void 0,i.deltaTime=0,i.leftTime=0,i.canUpdate=!1,i.tabBtns=[],i.curIndex=0,i.roleList={},i.actInfo=void 0,i.rankId=void 0,i.rankInfo=void 0,i.curRankPage=void 0,i.name="RankingRushMainView_2",i.url="ui/module/activity/RankingRushMainView_2",i.poolTime=3e3,i}i(n,t);var c=n.prototype;return c.onInit=function(){var t=this,i=this.findChild("imgMask");this.addComponentCallbackListener(i,e.EventType.CLICK,(function(){t.close()}));var n=this.findChild("btnClose");this.addComponentCallbackListener(n,e.EventType.CLICK,(function(){t.close()}));var c=this.findChild("root/btnTips");this.addComponentCallbackListener(c,e.EventType.CLICK,(function(){for(var i=I.LIMITED_RANK_SYSTEM_DETAILS,n="",e=0;e<i.length;e++)null!=t.actInfo&&i[e][0]==t.actInfo.type&&(n=g.GetconfigLanguage_Text(i[e][1]).text);""!=n&&p.showBoxTip({tip:n,btnCnt:1,horizontalAlign:a.uiMirror?o.RIGHT:o.LEFT})}));for(var f=function(i){var n=m.findChild(t.node,h.formatStr("root/bg/bottomBtn/item%s",i)),a={itemGo:n,normalGo:m.findChild(n,"normal"),selectedGo:m.findChild(n,"selected"),index:i};t.addComponentCallbackListener(n,e.EventType.CLICK,(function(){t.SetIndex(a.index)})),t.tabBtns[i]=a},u=1;u<=3;u++)f(u);this.nodeReward=this.findChild("root/nodeReward"),this.nodeRank=this.findChild("root/nodeRank"),this.topBg=this.findChildComponent("root/bg/imgBanner",s),this.txtTitle=this.findChildComponent("root/txtTitle",r),this.txtLeftTime=this.findChildComponent("root/txtTime",r),this.txtMyRank=this.findChildComponent("root/myRank/rankNum",r),this.txtMyScore=this.findChildComponent("root/myRank/score",r),this.txtMyName=this.findChildComponent("root/myRank/name",r),this.myFlag=new l(this,m.findChild(this.node,"root/myRank/GuildPinItem"));var v=this.findChildComponent("root/nodeRank/rankList",d);this.rankList=this.addUIList(v,O),this.addComponentCallbackListener(v.node,d.EventType.SCROLL_TO_BOTTOM,(function(){if(t.curRankPage<t.rankInfo.max_page){t.curRankPage++;var i=new Array;i.push({type:t.rankId,server:1,page:t.curRankPage}),IS(R).reqRankList(i)}}));var k=this.findChildComponent("root/nodeReward/rankList",d);this.rewardList=this.addUIList(k,E,!0);for(var C=1;C<=3;C++){var x=new P;x.init(this.findChild("root/nodeTopRank/rank"+C),this,C),this.roleList[C]=x}},c.registerUpdateHandler=function(){this.addEvent(L.RankInfoBack,this.UpdateRankInfo,this),this.addEvent(T.OnActivityInfoUpdate,this.OnViewUpdate,this)},c.onAfterOpen=function(){var t;for(var i in this.roleList)this.roleList.hasOwnProperty(i)&&this.roleList[i].show();if(IS(y).HasGuild()){var n=IS(x).GetGuildInfo();this.txtMyName.string=n.name,this.myFlag.node.active=!0,this.myFlag.SetItem(n.guild_flag)}else this.txtMyName.string=GetLanguage(200083),this.myFlag.node.active=!1;this.actInfo=this.openArgs[0];var e=null!=(t=this.actInfo.state_time[this.actInfo.state])?t:this.actInfo.state_time[S.Open];if(this.leftTime=e.end_time-k.serverTime,this.leftTime>0){this.canUpdate=!0;var a=k.getTimeData(this.leftTime);Math.floor(this.leftTime/86400)>0?this.txtLeftTime.string=v.formatStrWithMirrorDeal(GetLanguage(200080),a[3],a[2]):this.txtLeftTime.string=GetLanguage(200081)+k.formatTimeForSecond(this.leftTime)}else this.txtLeftTime.string=GetLanguage(200026);this.loadIcon(this.topBg,"xscb_icon",G[this.actInfo.type].bg2),this.rankId=this.actInfo.roundCfg.rank_id;var o=configRanktype.getDataByKey(this.rankId);D=o.prefix;var s=new Array;s.push({type:this.rankId,server:1,page:1}),this.curRankPage=1,IS(R).reqRankList(s);var r=IS(_).getRankRewardList(this.actInfo);this.rewardList.datas=r,this.SetIndex(N)},c.onBeforeClose=function(){this.canUpdate=!1,this.rankId=0,this.rankList.clearData(),this.curIndex>0&&(this.tabBtns[this.curIndex].normalGo.active=!0,this.tabBtns[this.curIndex].selectedGo.active=!1,this.curIndex=0)},c.onDestroy=function(){},c.onUpdate=function(t){if(this.canUpdate&&(this.deltaTime=this.deltaTime+t,this.deltaTime>=1))if(this.deltaTime=0,this.leftTime=this.leftTime-1,this.leftTime>0){this.canUpdate=!0;var i=k.getTimeData(this.leftTime);Math.floor(this.leftTime/86400)>0?this.txtLeftTime.string=v.formatStrWithMirrorDeal(GetLanguage(200080),i[3],i[2]):this.txtLeftTime.string=GetLanguage(200081)+k.formatTimeForSecond(this.leftTime)}else this.txtLeftTime.string=GetLanguage(200026),this.canUpdate=!1},c.SetIndex=function(t){this.curIndex!=t&&(this.curIndex>0&&(this.tabBtns[this.curIndex].selectedGo.active=!1,this.tabBtns[this.curIndex].normalGo.active=!0),this.curIndex=t,this.tabBtns[this.curIndex].normalGo.active=!1,this.tabBtns[this.curIndex].selectedGo.active=!0,this.curIndex==N||this.curIndex==B?(this.nodeReward.active=!0,this.nodeRank.active=!1,this.rewardList.updateAll()):this.curIndex==U&&(this.nodeReward.active=!1,this.nodeRank.active=!0))},c.UpdateRankInfo=function(){if(this.rankInfo=IS(w).GetRankInfoByType(this.rankId),this.rankInfo){var t;this.txtMyRank.string=0!=this.rankInfo.my_info.rank?this.rankInfo.my_info.rank:GetLanguage(200037),this.txtMyScore.string=h.formatStr("%s%s",D,v.GetNumString(null!=(t=this.rankInfo.my_info.score)?t:0)),this.rankList.datas=this.rankInfo.rank_list;for(var i=1;i<=3;i++)this.roleList[i].show(this.rankInfo.rank_list[i-1])}},c.OnViewUpdate=function(){this.actInfo.state!=S.Open&&this.close()},n}(b)),function(t){function n(){for(var i,n=arguments.length,e=new Array(n),a=0;a<n;a++)e[a]=arguments[a];return(i=t.call.apply(t,[this].concat(e))||this).itemGridNode=void 0,i.itemGrid=void 0,i}i(n,t);var e=n.prototype;return e.onInit=function(){this.itemGridNode=m.findChild(this.node,"itemGrid"),this.itemGrid=new f(this.view,this.itemGridNode)},e.onRender=function(t,i){this.itemGrid.SetItemId(t[0],t[1])},n}(u)),E=function(t){function n(){for(var i,n=arguments.length,e=new Array(n),a=0;a<n;a++)e[a]=arguments[a];return(i=t.call.apply(t,[this].concat(e))||this).rewardScroll=void 0,i.txtRank=void 0,i.rankIcon=void 0,i}i(n,t);var e=n.prototype;return e.onInit=function(){this.txtRank=m.findChildComponent(this.node,"rankNum",r),this.rankIcon=m.findChildComponent(this.node,"rankIcon",s);var t=m.findChildComponent(this.node,"rewardScroll",d);this.rewardScroll=this.view.addUIList(t,A,!1),this.rewardScroll.touchEvent=!1},e.onRender=function(t,i){this.view.curIndex==N?this.rewardScroll.datas=t.rank_reward_spec:this.rewardScroll.datas=t.rank_reward;var n=t.rank_range[0],e=t.rank_range[1];n==e&&n<=3?(this.rankIcon.node.active=!0,this.txtRank.node.active=!1,this.view.loadIcon(this.rankIcon,"common","common_ICON_paiming0"+n)):(this.rankIcon.node.active=!1,this.txtRank.node.active=!0,t.show&&""!=t.show?this.txtRank.string=t.show:this.txtRank.string=h.formatStr("%s-%s",n,e))},e.onItemClick=function(){},n}(u),O=function(t){function n(){for(var i,n=arguments.length,e=new Array(n),a=0;a<n;a++)e[a]=arguments[a];return(i=t.call.apply(t,[this].concat(e))||this).flag=void 0,i.txtRank=void 0,i.rankIcon=void 0,i.txtName=void 0,i.txtScore=void 0,i}i(n,t);var e=n.prototype;return e.onInit=function(){this.flag=new l(this.view,m.findChild(this.node,"GuildPinItem")),this.txtRank=m.findChildComponent(this.node,"rankNum",r),this.rankIcon=m.findChildComponent(this.node,"rankIcon",s),this.txtName=m.findChildComponent(this.node,"name",r),this.txtScore=m.findChildComponent(this.node,"score",r)},e.onRender=function(t,i){this.flag.SetItem(t.guild_flag),this.txtName.string=t.name,this.txtScore.string=D+v.GetNumString(t.score),t.rank<=3?(this.rankIcon.node.active=!0,this.txtRank.node.active=!1,this.view.loadIcon(this.rankIcon,"common","common_ICON_paiming0"+t.rank)):(this.rankIcon.node.active=!1,this.txtRank.node.active=!0,this.txtRank.string=t.rank)},e.onItemClick=function(){IS(C).send_29_1(this.data.belong_id)},n}(u),P=function(){function t(){this.view=void 0,this.node=void 0,this.rank=void 0,this.flag=void 0,this.txtName=void 0,this.txtScore=void 0,this.rankIcon=void 0,this.data=void 0}var i=t.prototype;return i.init=function(t,i,n){this.view=i,this.node=t,this.rank=n,this.onInit()},i.onInit=function(){var t=this;this.txtName=m.findChildComponent(this.node,"name",r),this.txtScore=m.findChildComponent(this.node,"score",r),this.flag=new l(this.view,m.findChild(this.node,"GuildPinItem")),this.view.addComponentCallbackListener(this.flag.node,e.EventType.CLICK,(function(){t.data&&IS(C).send_29_1(t.data.belong_id)})),this.rankIcon=m.findChildComponent(this.node,"rank_icon",s),this.view.loadIcon(this.rankIcon,"common","common_ICON_paiming0"+this.rank)},i.show=function(t){this.data=t,this.txtName.string=GetLanguage(200038),this.txtScore.string=D+"0",this.flag.node.active=!1,t&&(this.flag.node.active=!0,this.flag.SetItem(t.guild_flag),this.txtName.string=t.name,this.txtScore.string=D+v.GetNumString(t.score))},t}();n._RF.pop()}}}));

