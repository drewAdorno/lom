System.register("chunks:///_virtual/ActivityPoolPartyCardSendView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./BagModel.ts","./MessageView.ts","./FriendControl.ts","./FriendDefine.ts","./FriendModel.ts","./GuildDataCache.ts","./GuildDefine.ts","./RoleDataCache.ts","./RoleDefine.ts","./ActivityControl.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./ActivityPoolPartyDefine.ts","./BaseView.ts"],(function(e){"use strict";var t,i,n,o,a,s,r,d,l,h,c,f,u,m,g,v,p,I,y,C,L,_,T,S,w,G,b,B,P;return{setters:[function(e){t=e.inheritsLoose},function(e){i=e.cclegacy,n=e.Button,o=e.Label,a=e.Sprite,s=e.EditBox,r=e.UITransform,d=e.ScrollView,l=e.sys},function(e){h=e.ListItem},function(e){c=e.default},function(e){f=e.default},function(e){u=e.default},null,function(e){m=e.BagModel},function(e){g=e.default},function(e){v=e.default},function(e){p=e.FriendListType,I=e.FriendDefine},function(e){y=e.FriendModel},function(e){C=e.default},function(e){L=e.GuildEventDefine},function(e){_=e.RoleDataCache},function(e){T=e.PlayerAttr},function(e){S=e.default},function(e){w=e.default},function(e){G=e.ActivityEventDefine,b=e.ActivityType},function(e){B=e.CardPoolPartyItemIcon},function(e){P=e.BaseView}],execute:function(){i._RF.push({},"178c2fWa49BKYSyGTplA7j3","ActivityPoolPartyCardSendView",void 0);e("default",function(e){function i(){var t;return(t=e.call(this)||this).operateType=0,t.curIndex=void 0,t.itemId=void 0,t.page=0,t.isSendToServer=void 0,t.itemIcon=void 0,t.title=void 0,t.searchItem=void 0,t.itemName=void 0,t.editBox=void 0,t.msgTip=void 0,t.tabList=void 0,t.scrollView=void 0,t.scrollViewTrans=void 0,t.cardItemList=[],t.name="ActivityPoolPartyCardSendView",t.url="ui/module/activityPoolParty/ActivityPoolPartyCardSendView",t}t(i,e);var h=i.prototype;return h.onInit=function(){var e=this,t=this.findChild("imgMask");this.addComponentCallbackListener(t,n.EventType.CLICK,(function(){e.close()}));var i=this.findChild("btnClose");this.addComponentCallbackListener(i,n.EventType.CLICK,(function(){e.close()})),this.msgTip=this.findChildComponent("bg/txtTitle",o),this.itemIcon=this.findChildComponent("itemNode/itemIcon",a),this.itemName=this.findChildComponent("itemNode/Label",o),this.searchItem=this.findChild("searchItem"),this.editBox=this.findChildComponent("searchItem/EditBox",s);var l=this.findChild("searchItem/searchBtn");this.addComponentCallbackListener(l,n.EventType.CLICK,(function(){var t=e.editBox.string;""!=t?IS(S).send_gift_search(t):IS(v).reqFriendList(p.FriendRecommend,1)})),this.tabList=[];for(var h=function(t){e.findChild("select/item"+t);var i={itemGo:e.findChild("select/item"+t),select:e.findChild("select/item"+t+"/select")};e.addComponentCallbackListener(i.itemGo,n.EventType.CLICK,(function(){2!=t||IS(_).HasGuild()?e.RefreshSelectItem(t):g.showFlyTip(GetLanguage(200165))})),e.tabList[t]=i},c=0;c<3;c++)h(c);this.scrollViewTrans=this.findChildComponent("ScrollView",r);var f=this.findChildComponent("ScrollView",d);this.scrollView=this.addUIList(f,x),this.addComponentCallbackListener(f.node,d.EventType.SCROLL_TO_BOTTOM,(function(){e.isSendToServer||1!=e.curIndex||(e.page+=1,IS(v).reqFriendList(p.FriendList,e.page),e.isSendToServer=!0)}))},h.registerUpdateHandler=function(){this.addEvent(I.FriendInfoBack,this.RefreshScroll,this),this.addEvent(G.OnActivityGiftSearchBack,this.RefreshScroll,this),this.addEvent(L.GUILD_INFO_UPDATE,this.RefreshScroll,this)},h.RefreshSelectItem=function(e){if(this.curIndex!=e){for(var t=0;t<this.tabList.length;t++)this.tabList[t].select.active=e==t;this.curIndex=e,this.scrollView.scrollTo(0,-1),this.editBox.string="",0==this.curIndex?(this.scrollViewTrans.height=400,this.searchItem.active=!0,IS(v).reqFriendList(p.FriendRecommend,1)):1==this.curIndex?(this.scrollViewTrans.height=455,this.searchItem.active=!1,this.page=1,IS(v).reqFriendList(p.FriendList,this.page)):(this.scrollViewTrans.height=455,this.searchItem.active=!1),this.RefreshScroll()}},h.onAfterOpen=function(){this.curIndex=null,this.itemId=this.openArgs[0],this.operateType=this.openArgs[1],this.editBox.placeholderLabel.string="UID",this.adjustMirrorNode(this.editBox.placeholderLabel.node),l.uiMirror&&this.editBox.placeholderLabel.node.setPosition(-150,13.795);var e=configGoods.getDataByKey(this.itemId);this.loadIcon(this.itemIcon,"act_poolparty_puzzle",B[this.itemId]),1==this.operateType?(this.msgTip.string=GetLanguage_UI(100887),this.itemName.string=f.formatStrWithMirrorDeal(GetLanguage(200778),e.name)):(this.msgTip.string=GetLanguage_UI(700004029),this.itemName.string=f.formatStrWithMirrorDeal(GetLanguage(200779),e.name)),this.RefreshSelectItem(0)},h.onBeforeClose=function(){},h.onDestroy=function(){},h.RefreshScroll=function(e){void 0===e&&(e=null);var t=[];if(0==this.curIndex){var i;if(""==this.editBox.string)t=IS(y).GetListByType(p.FriendRecommend);else t=null!=(i=e)?i:[];this.editBox.string=""}else if(1==this.curIndex)t=IS(y).GetListByType(p.FriendList);else if(2==this.curIndex){var n=[],o=IS(C).GetMemberList();for(var a in o)if(o.hasOwnProperty(a)){var s=o[a];s.role_id!=IS(_).GetRoleAttr(T.ROLE_ATTR_ID)&&n.push(s)}n.sort((function(e,t){return e.donate_week!=t.donate_week?t.donate_week-e.donate_week:e.is_online==t.is_online?0==e.is_online&&e.offline_time!=t.offline_time?t.offline_time-e.offline_time:e.career!=t.career?IS(C).CompareCareer(e.career,t.career):e.role_id-t.role_id:0==e.is_online?1:-1}));for(var r=0;r<n.length;r++){var d=n[r];t.push({role_id:d.role_id,name:d.role_name,head:d.role_head,is_online:d.is_online,offline_time:d.offline_time})}}this.scrollView.datas=t},h.updateTask=function(){},i}(P));var x=function(e){function i(){for(var t,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(t=e.call.apply(e,[this].concat(n))||this).name=void 0,t.time=void 0,t.btn=void 0,t.btnTxt=void 0,t.imgHeadFrame=void 0,t.headImg=void 0,t.operateType=void 0,t}t(i,e);var s=i.prototype;return s.onInit=function(){var e=this;this.name=c.findChildComponent(this.node,"name",o),this.time=c.findChildComponent(this.node,"time",o),this.btnTxt=c.findChildComponent(this.node,"btn/Label",o),this.btn=c.findChild(this.node,"btn"),this.view.addComponentCallbackListener(this.btn,n.EventType.CLICK,(function(){var t=IS(w).getCollectInfo(b.PoolPartyPuzzle),i=e.view.itemId,n=configGoods.getDataByKey(i);if(1==e.operateType){if(IS(m).getGoodsCountByGoodsGtid(i)<=0)return void g.showFlyTip(GetLanguage(201740));var o=configCollect_cards.getDataByKey(b.PoolPartyPuzzle).gift_live_time,a=f.formatStrWithMirrorDeal(GetLanguage(200756),e.data.name,n.name,Math.floor(o/3600));g.showBoxTip({tip:a,title:GetLanguage(200048),func:function(t){var n;"type_yes"==t&&IS(S).send_collect_send(b.PoolPartyPuzzle,i,0,null!=(n=e.data.role_id)?n:e.data.belong_id,0)}})}else{var s;if((null!=(s=t.recv_times)?s:0)<=0)return void g.showFlyTip(GetLanguage(201781));var r=f.formatStrWithMirrorDeal(GetLanguage(200757),e.data.name,n.name);g.showBoxTip({tip:r,title:GetLanguage(200048),func:function(t){var n;"type_yes"==t&&IS(S).send_collect_ask(b.PoolPartyPuzzle,i,1,null!=(n=e.data.role_id)?n:e.data.belong_id)}})}})),this.imgHeadFrame=c.findChildComponent(this.node,"head/imgHeadFrame",a),this.headImg=c.findChildComponent(this.node,"head/image",a)},s.onRender=function(e,t){this.operateType=this.view.operateType,this.name.string=e.name;var i=e.head.frame_id;if(1==this.operateType?this.btnTxt.string=GetLanguage(200795):this.btnTxt.string=GetLanguage(200796),i>0){this.imgHeadFrame.node.active=!0;var n=configAvatar_frame.getDataByKey(i);this.view.loadIcon(this.imgHeadFrame,"icon_frame",n.icon)}else this.imgHeadFrame.node.active=!1;this.view.loadRemoteIcon(e.head.url,this.headImg),this.time.string=0==e.is_online?u.getDateDiff(e.offline_time)+GetLanguage(200171):GetLanguage(200057)},i}(h);i._RF.pop()}}}));

