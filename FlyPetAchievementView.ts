System.register("chunks:///_virtual/FlyPetAchievementView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./V2.ts","./AudioMgr.ts","./index3.ts","./UIList.ts","./RedPointMgr.ts","./NodeUtil.ts","./StringUtil.ts","./index57.ts","./ItemIcon.ts","./UIEffectAsset.ts","./ObjectUtil.ts","./BagModel.ts","./GuideModel.ts","./MessageView.ts","./RoleDataCache.ts","./TaskControl.ts","./TaskDataCache.ts","./TaskDefine.ts","./FlyPetControl.ts","./FlyPetDataCache.ts","./FlyPetDefine.ts","./EaseMethod.ts","./BaseView.ts"],(function(t){"use strict";var i,e,n,o,s,a,d,l,c,h,r,u,f,v,m,p,g,C,y,_,I,T,w,k,b,F,S,G,L,P,D,A,x,N,M;return{setters:[function(t){i=t.inheritsLoose},function(t){e=t.cclegacy,n=t.Button,o=t.Label,s=t.ScrollView,a=t.UITransform,d=t.ProgressBar,l=t.Sprite,c=t.Vec2,h=t.Vec3,r=t.js},function(t){u=t.V2},function(t){f=t.audioMgr},null,function(t){v=t.ListItem},function(t){m=t.RedPointMgr},function(t){p=t.default},function(t){g=t.default},null,function(t){C=t.IconAseetType},function(t){y=t.UIEffectAsset},function(t){_=t.default},function(t){I=t.BagModel},function(t){T=t.GuideModel},function(t){w=t.default},function(t){k=t.RoleDataCache},function(t){b=t.default},function(t){F=t.TaskDataCache},function(t){S=t.TaskEventDefine,G=t.TaskType,L=t.TaskState},function(t){P=t.default},function(t){D=t.default},function(t){A=t.FlyPetEventDefine,x=t.FlyPetQualityRes},function(t){N=t.EasingMethod},function(t){M=t.BaseView}],execute:function(){e._RF.push({},"7734bax+LVGgqMKaTAgv7Dq","FlyPetAchievementView",void 0);t("default",function(t){function e(){var i;return(i=t.call(this)||this).btn_list={},i.achievement_panel=void 0,i.task_panel=void 0,i.have_num=void 0,i.imgGoods=void 0,i.pet_list=void 0,i.taskList=void 0,i.pb=void 0,i.all_reward=void 0,i.task_title=void 0,i.txtSchedule=void 0,i.have_list={},i.nodeFly=void 0,i.utFly=void 0,i.target=void 0,i.select_tab=1,i.name="FlyPetAchievementView",i.url="ui/module/flypet/FlyPetAchievementView",i}i(e,t);var v=e.prototype;return v.onInit=function(){var t=this,i=this.findChild("imgMask");this.addComponentCallbackListener(i,n.EventType.CLICK,(function(){t.onMaskClick()}));var e=this.findChild("closeBtn");this.addComponentCallbackListener(e,n.EventType.CLICK,(function(){t.onMaskClick()})),this.achievement_panel=this.findChild("container/AchievementNode"),this.task_panel=this.findChild("container/TaskNode"),this.have_num=this.findChildComponent("container/AchievementNode/title/title",o);var h=this.findChildComponent("container/AchievementNode/ScrollView",s);this.pet_list=this.addUIList(h,E),this.task_title=this.findChildComponent("container/TaskNode/title/title",o),this.nodeFly=this.findChild("container/TaskNode/flyRoot"),this.utFly=this.nodeFly.getComponent(a),this.target=this.findChild("container/TaskNode/target"),this.pb=this.findChildComponent("container/TaskNode/ProgressBar",d),this.txtSchedule=this.findChildComponent("container/TaskNode/ProgressBar/schedule",o);var r=this.findChild("container/TaskNode/ProgressBar/btnGoods");this.imgGoods=this.findChildComponent("container/TaskNode/ProgressBar/btnGoods",l),this.addComponentCallbackListener(r,n.EventType.CLICK,(function(){IS(D).GetAchievementInfoRedPoint()?IS(P).send_10_11():uiMgr.openView("RewardPreview",{title:GetLanguage(200151),rewardList:t.all_reward})}));var u=this.findChildComponent("container/TaskNode/taskList",s);this.taskList=this.addUIList(u,B);for(var f=function(i){var e=t.findChild("tab/scrollTab/view/content/item"+i),o=p.findChild(e,"selected");t.addComponentCallbackListener(e,n.EventType.CLICK,(function(){t.selectTab(i)}));var s={node:e,select:o};t.btn_list[i]=s},v=1;v<=2;v++)f(v);IS(m).addRedPoint("TaskFlyPetRed",this.btn_list[2].node,new c(45,30)),IS(m).addRedPoint("fly_pet_achievement_red",r,new c(30,24))},v.selectTab=function(t){this.select_tab=t,this.achievement_panel.active=1==this.select_tab,this.task_panel.active=2==this.select_tab;for(var i=1;i<=2;i++)i==this.select_tab?this.btn_list[i].select.active=!0:this.btn_list[i].select.active=!1;1==this.select_tab?this.updateData():(this.all_reward=null,IS(P).send_10_10(),this.updateTask())},v.onMaskClick=function(){this.close()},v.onAfterOpen=function(){this.all_reward=null,IS(P).send_66_32(),this.selectTab(1)},v.registerUpdateHandler=function(){this.addEvent(A.FlyPeCollectionBack,this.updateList),this.addEvent(A.FlyPeAchievementBack,this.updatePro),this.addEvent(S.TASK_INFO_UPDATE,this.updateTask,this),this.addEvent(S.Task_FLY_DIAMOND,this.flyDiamo,this)},v.updateList=function(){this.updateData()},v.flyDiamo=function(t){var i=new h,e=new u;this.utFly.convertToNodeSpaceAR(t,i);var n=this.utFly.convertToNodeSpaceAR(this.target.worldPosition,new h),o=y.alloc("ui/module/common/FlyDiamo",this.nodeFly,1);o.position=e.set(i.x,i.y);var s=new u(i.x,i.y),a=h.subtract(new h,n,i);this.addTween(0,1,.95,(function(t,n){h.multiplyScalar(i,a,n),e.set(s).add2f(i.x,i.y),o.position=e})).easing(N.BACK_IN).call((function(){f.playSound("common_jinbitiao")})).start()},v.onBeforeClose=function(){},v.updatePro=function(){var t=IS(D).GetAchievementInfo(),i=configFly_total_achievement.getDataByKey(t.now_id);this.task_title.string=i.desc;var e=i&&i.num||1;this.txtSchedule.string=r.formatStr("%d/%d",t.progress,e),this.pb.progress=t.progress/e,this.all_reward=i.reward,this.imgGoods.grayscale=0==IS(D).GetAchievementInfoRedPoint()},v.updateTask=function(){var t=configFly_achievement.getDatas();(t=_.copyArray(t)).sort((function(t,i){return t.id-i.id}));for(var i={},e=0;e<t.length;e++){i[t[e].group]||(i[t[e].group]=t[e]),printLogErr(i[t[e].group],IS(F).GetTaskItem(G.FlyPet,i[t[e].group].id)),IS(F).GetTaskItem(G.FlyPet,t[e].id)&&(i[t[e].group]=t[e])}var n=[];for(var o in i)n.push(i[o]);n.sort((function(t,i){var e=IS(F).GetTaskItem(G.FlyPet,t.id),n=IS(F).GetTaskItem(G.FlyPet,i.id),o=e?e.state:L.Normal,s=n?n.state:L.Normal;return o==L.Complete&&s!=L.Complete?-1:o!=L.Complete&&s==L.Complete?1:o!=s?o<s?-1:1:t.id-i.id})),this.taskList.datas=n},v.updateData=function(){var t=IS(D).GetCollectionList(),i={};for(var e in t)t[e]&&(i[t[e]]=t[e]);for(var n=configFly.getDatas(),o=0,s=[],a=0;a<n.length;a++){var d=0;null!=i[n[a].id]&&(d=1,o++);var l={info:n[a],is_have:d};s.push(l)}this.have_num.string=g.formatStrWithMirrorDeal(GetLanguage(205453),o+""),this.pet_list.datas=s},v.onDestroy=function(){},e}(M));var E=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(i=t.call.apply(t,[this].concat(n))||this).imgFrame=void 0,i.imgIcon=void 0,i.grayNode=void 0,i.imgGrayIcon=void 0,i.p_view=void 0,i.pet_cfg=void 0,i}i(e,t);var o=e.prototype;return o.onInit=function(){var t=this;this.imgFrame=p.findChildComponent(this.node,"frame",l),this.imgIcon=p.findChildComponent(this.node,"icon",l),this.grayNode=p.findChild(this.node,"gray"),this.imgGrayIcon=p.findChildComponent(this.node,"gray/icon",l),this.p_view=this.view,this.view.addComponentCallbackListener(this.node,n.EventType.CLICK,(function(){uiMgr.openView("FlyPetAchievementTipsView",t.pet_cfg)}))},o.onRender=function(t,i){this.pet_cfg=t.info,this.view.loadIcon(this.imgIcon,"icon_flypet",t.info.icon),this.view.loadIcon(this.imgFrame,"icon_equip",x[t.info.quality]),this.grayNode.active=0==t.is_have,0==t.is_have&&this.view.loadIcon(this.imgGrayIcon,"icon_flypet",t.info.icon)},o.onItemClick=function(){},e}(v),B=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(i=t.call.apply(t,[this].concat(n))||this).txtTitle=void 0,i.txtDesc=void 0,i.txtSchedule=void 0,i.btnGet=void 0,i.btnGoto=void 0,i.finish=void 0,i.imgFrame=void 0,i.imgIcon=void 0,i.txtNum=void 0,i.moveTween=void 0,i.open_func=0,i}i(e,t);var s=e.prototype;return s.onInit=function(){var t=this;this.imgFrame=p.findChildComponent(this.node,"imgFrame",l),this.imgIcon=p.findChildComponent(this.node,"imgFrame/imgIcon",l),this.txtNum=p.findChildComponent(this.node,"txtNum",o),this.txtTitle=p.findChildComponent(this.node,"txtTitle",o),this.txtDesc=p.findChildComponent(this.node,"txtDesc",o),this.txtSchedule=p.findChildComponent(this.node,"btnGoto/Label",o),this.btnGet=p.findChild(this.node,"btnGet"),this.view.addComponentCallbackListener(this.btnGet,n.EventType.CLICK,(function(){normalEvent.emit(S.Task_FLY_DIAMOND,t.imgIcon.node.worldPosition),t.flyOut()})),this.btnGoto=p.findChild(this.node,"btnGoto"),this.finish=p.findChild(this.node,"finish"),this.view.addComponentCallbackListener(this.imgFrame.node,n.EventType.CLICK,(function(){IS(I).OpenItemTips(t.data.reward[0][0],t.imgFrame.node)}))},s.flyOut=function(){var t=this;null!=this.moveTween&&this.moveTween.stop();var i=new h,e=this.node.getComponent(a).contentSize,n=this.node.position,o=new h(n.x,n.y);this.moveTween=this.view.addTween(0,1,.15,(function(n,s){i.set(o).add3f(-1.1*e.x*s,0,0),t.node.position=i})).easing(N.LINEAR).call((function(){IS(b).send_10_2(G.FlyPet,t.data.id)})).start()},s.onBtnGotoClick=function(){!this.open_func||IS(k).CheckFuncOpen(this.open_func)?(IS(T).openGuide(this.data.guide),this.view.close()):w.showFlyTip(GetLanguage(200114))},s.onRender=function(t,i){this.open_func=t.open_func,this.txtTitle.string=g.formatStr(t.name,t.name_num),this.txtDesc.string=g.formatStr(t.desc,t.desc_num),this.txtNum.string=t.reward[0][1];var e,n=t.reward[0][0],o=configGoods.getDataByKey(n),s=o.quality;e=3==o.type?"icon_skill":4==o.type?"icon_pet":"icon_item";var a=configColor.getDataByKey(s);this.view.loadIcon(this.imgIcon,e,o.icon,null,C.UI_ATLAS,!0),this.view.loadIcon(this.imgFrame,"icon_equip",a.path);var d=IS(F).GetTaskItem(G.FlyPet,t.id);if(null==d)this.txtSchedule.string=r.formatStr("%s/%s",0,t.condition[2]),this.btnGet.active=!1,this.finish.active=!1,this.btnGoto.active=!0;else if(d.state==L.Normal){var l=d.count<=t.condition[2]?d.count:t.condition[2];this.txtSchedule.string=r.formatStr("%s/%s",l,t.condition[2]),this.btnGet.active=!1,this.btnGoto.active=!0,this.finish.active=!1}else d.state==L.Complete?(this.txtSchedule.string=r.formatStr("%s/%s",t.condition[2],t.condition[2]),this.btnGet.active=!0,this.btnGoto.active=!1,this.finish.active=!1):(this.txtSchedule.string=r.formatStr("%s/%s",t.condition[2],t.condition[2]),this.btnGet.active=!1,this.btnGoto.active=!1,this.finish.active=!0)},e}(v);e._RF.pop()}}}));

