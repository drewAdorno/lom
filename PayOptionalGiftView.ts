System.register("chunks:///_virtual/PayOptionalGiftView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./CommonDefine.ts","./MessageView.ts","./PayControl.ts","./PayDataCache.ts","./PayDefine.ts","./BaseView.ts"],(function(t){"use strict";var i,e,n,s,o,a,d,h,r,c,f,u,l,v,m,y,p,C,g,I;return{setters:[function(t){i=t.inheritsLoose},function(t){e=t.cclegacy,n=t.Button,s=t.Label,o=t.ScrollView},function(t){a=t.ItemGrid},function(t){d=t.ListItem},function(t){h=t.default},function(t){r=t.default},function(t){c=t.default},null,function(t){f=t.default},function(t){u=t.ActivityType,l=t.ActivityState},function(t){v=t.CommonEventDefine},function(t){m=t.default},function(t){y=t.default},function(t){p=t.default},function(t){C=t.PayEventDefine,g=t.GiftType},function(t){I=t.BaseView}],execute:function(){e._RF.push({},"1cd80R2GTlK3r7ufu2LCyno","PayOptionalGiftView",void 0);t("default",function(t){function e(){var i;return(i=t.call(this)||this).txtTitle=void 0,i.txtLeftTime=void 0,i.payList=void 0,i.deltaTime=0,i.leftTime=0,i.canUpdate=!1,i.name="PayOptionalGiftView",i.url="ui/module/shop/PayOptionalGiftView",i}i(e,t);var a=e.prototype;return a.onInit=function(){var t=this,i=this.findChild("imgMask");this.addComponentCallbackListener(i,n.EventType.CLICK,(function(){t.close()}));var e=this.findChild("btnClose");this.addComponentCallbackListener(e,n.EventType.CLICK,(function(){t.close()})),this.txtTitle=this.findChildComponent("container/topBg/txtTitle",s),this.txtLeftTime=this.findChildComponent("container/topBg/txtLeftTime",s);var a=this.findChildComponent("container/payList",o);this.payList=this.addUIList(a,G,!0)},a.registerUpdateHandler=function(){this.addEvent(C.PAY_INFO_UPDATE,this.OnPayGiftInfoUpdate,this),this.addEvent(C.PAY_CUSTOM_INFO_UPDATE,this.OnPayGiftInfoUpdate,this),this.addEvent(C.PAY_CUSTOM_INFO_SET,this.OnPayGiftInfoUpdate,this),this.addEvent(v.UPDATE_MAIN_SHOP_RED_POINT,this.UpdateRed,this)},a.onAfterOpen=function(){var t,i=IS(f).GetActivityInfo(u.OptionGift),e=null!=(t=i.state_time[i.state])?t:i.state_time[l.Open];this.leftTime=e.end_time-c.serverTime,this.txtTitle.string=i.activityCfg.name,this.leftTime>0?(this.canUpdate=!0,this.txtLeftTime.string=c.formatTimeStringForSecond(this.leftTime),this.UpdateRed()):this.txtLeftTime.string=GetLanguage(200026),IS(y).send_19_8()},a.UpdateRed=function(){IS(f).UpdateMainRedByActType(u.OptionGift)},a.onBeforeClose=function(){this.canUpdate=!1},a.onDestroy=function(){},a.onUpdate=function(t){this.canUpdate&&(this.deltaTime=this.deltaTime+t,this.deltaTime>=1&&(this.deltaTime=0,this.leftTime=this.leftTime-1,this.leftTime>0?this.txtLeftTime.string=c.formatTimeStringForSecond(this.leftTime):(this.txtLeftTime.string=GetLanguage(200026),this.canUpdate=!1)))},a.OnPayGiftInfoUpdate=function(){var t=IS(f).GetActivityInfo(u.OptionGift);if(t){var i=IS(p).GetAcivityGift(g.Activity,t.type,t.round),e=IS(p).GetAcivityGift(g.Custom,t.type,t.round),n=!1,s=null;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o],d=IS(p).GetPayGiftInfo(a.id);d&&2==d.rewardState?(n=!1,s=a):(n=!0,e.push(a))}e.sort((function(t,i){var e=IS(p).GetPayGiftInfo(t.id),n=IS(p).GetPayGiftInfo(i.id),s=e&&0!=e.payCfg.buy_times&&e.bought_times&&e.bought_times>=e.payCfg.buy_times;return s!=(n&&0!=n.payCfg.buy_times&&n.bought_times&&n.bought_times>=n.payCfg.buy_times)?s?1:-1:t.id-i.id})),0==n&&e.push(s),e.length>0&&(this.payList.datas=e)}},e}(I));var G=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return(i=t.call.apply(t,[this].concat(n))||this).txtName=void 0,i.txtDesc=void 0,i.txtPrice=void 0,i.btnBuy=void 0,i.out=void 0,i.rewardScroll=void 0,i.choose=void 0,i.red=void 0,i.chooseNodeList={},i.chooseItemGridList={},i.chooseList=void 0,i.isFinishChoose=!1,i}i(e,t);var d=e.prototype;return d.onInit=function(){var t=this;this.txtName=h.findChildComponent(this.node,"title/Label",s),this.txtDesc=h.findChildComponent(this.node,"txtDesc",s),this.txtPrice=h.findChildComponent(this.node,"btnBuy/Label",s),this.out=h.findChild(this.node,"out"),this.btnBuy=h.findChild(this.node,"btnBuy"),this.view.addComponentCallbackListener(this.btnBuy,n.EventType.CLICK,(function(){0==t.data.price?(IS(y).send_19_2(t.data.id),IS(f).UpdateMainRedByActType(u.OptionGift)):t.isFinishChoose?IS(p).Pay(t.data.id):m.showFlyTip(GetLanguage(400003))}));var i=h.findChildComponent(this.node,"rewardScroll",o);this.rewardScroll=this.view.addUIList(i,L,!1),this.rewardScroll.touchEvent=!1,this.choose=h.findChild(this.node,"choose"),this.red=h.findChild(this.node,"red");var e=h.findChild(this.node,"choose/1/change/btn");this.view.addComponentCallbackListener(e,n.EventType.CLICK,(function(){var i=IS(p).GetPayGiftInfo(t.data.id);if(0==t.data.price?!i||2!=i.rewardState:0==t.data.buy_times||(!i||!i.bought_times||!(i.bought_times>=i.payCfg.buy_times))){var e=IS(p).GetCustomInfoList(t.data.id);uiMgr.openView("PayOptionalDetailView",t.chooseList,t.data.id,e,1)}}));var d=h.findChild(this.node,"choose/2/change/btn");this.view.addComponentCallbackListener(d,n.EventType.CLICK,(function(){var i=IS(p).GetPayGiftInfo(t.data.id);if(0==t.data.price?!i||2!=i.rewardState:0==t.data.buy_times||(!i||!i.bought_times||!(i.bought_times>=i.payCfg.buy_times))){var e=IS(p).GetCustomInfoList(t.data.id);uiMgr.openView("PayOptionalDetailView",t.chooseList,t.data.id,e,2)}}));for(var r=1;r<3;r++)this.chooseNodeList[r]=h.findChild(this.node,"choose/"+r);for(var c=1;c<3;c++)this.chooseItemGridList[c]={go:h.findChild(this.node,"choose/"+c+"/itemGrid"),itemGrid:new a(this.view,h.findChild(this.node,"choose/"+c+"/itemGrid"))}},d.onRender=function(t,i){this.txtName.string=t.name;var e=IS(p).GetPayGiftInfo(t.id);if(0==t.price)this.txtPrice.string=GetLanguage(200045),e&&2==e.rewardState?(this.out.active=!0,this.red.active=!1,this.btnBuy.active=!1,this.txtDesc.node.active=!1):(this.out.active=!1,this.red.active=!0,this.btnBuy.active=!0,this.txtDesc.node.active=!0,this.txtDesc.string=r.formatStrWithMirrorDeal(GetLanguage(200046),t.buy_times)),this.choose.active=!1,this.rewardScroll.datas=t.reward;else{this.red.active=!1,this.txtPrice.string=IS(p).GetPriceString(t.cost_level),0==t.buy_times?(this.out.active=!1,this.btnBuy.active=!0,this.txtDesc.node.active=!1):e&&e.bought_times?e.bought_times>=e.payCfg.buy_times?(this.out.active=!0,this.btnBuy.active=!1,this.txtDesc.node.active=!1):(this.out.active=!1,this.btnBuy.active=!0,this.txtDesc.node.active=!0,this.txtDesc.string=r.formatStrWithMirrorDeal(GetLanguage(200028),t.buy_times-e.bought_times,t.buy_times)):(this.out.active=!1,this.btnBuy.active=!0,this.txtDesc.node.active=!0,this.txtDesc.string=r.formatStrWithMirrorDeal(GetLanguage(200028),t.buy_times,t.buy_times)),this.choose.active=!0;var n=configCustom_mall.getDataByKey(t.id);this.rewardScroll.datas=n.regular_reward,this.chooseList=n.custom_reward;for(var s=1;s<3;s++)this.chooseNodeList[s].active=!1;for(var o=1;o<=this.chooseList.length;o++)this.chooseNodeList[o].active=!0;for(var a=IS(p).GetCustomInfoList(t.id),d=1;d<3;d++)this.chooseItemGridList[d].go.active=!1;if(null!=a){var h=0;for(var c in a)if(a.hasOwnProperty(c)){h+=1;var f=a[c];this.chooseItemGridList[f.k].go.active=!0;var u=0,l=this.chooseList[f.k-1][1];for(var v in l)if(l.hasOwnProperty(v)){var m=l[v];m[0]==f.v&&(u=m[1])}this.chooseItemGridList[f.k].itemGrid.SetItemId(f.v,u)}this.isFinishChoose=h==this.chooseList.length}else{this.isFinishChoose=!1;for(var y=1;y<3;y++)this.chooseItemGridList[y].go.active=!1}}},e}(d),L=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return(i=t.call.apply(t,[this].concat(n))||this).itemGridNode=void 0,i.itemGrid=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){this.itemGridNode=h.findChild(this.node,"itemGrid"),this.itemGrid=new a(this.view,this.itemGridNode)},n.onRender=function(t,i){this.itemGrid.SetItemId(t[0],t[1])},e}(d);e._RF.pop()}}}));

