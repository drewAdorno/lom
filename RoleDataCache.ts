System.register("chunks:///_virtual/RoleDataCache.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AudioMgr.ts","./RedPointMgr.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./ConfigGlobal.ts","./ObjectUtil.ts","./BagDefine.ts","./BagModel.ts","./CommonDefine.ts","./MessageView.ts","./LoginDataCache.ts","./BubbleDataCache.ts","./CustomeHeadDataCache.ts","./FrameDataCache.ts","./TitleDataCache.ts","./NativeToJs.ts","./RoleDefine.ts","./UIDefine.ts"],(function(e){"use strict";var t,n,i,o,r,a,s,l,u,_,f,R,E,c,h,v,L,d,I,T,O,g,A,D;return{setters:[function(e){t=e.createForOfIteratorHelperLoose},function(e){n=e.cclegacy,i=e.js},function(e){o=e.audioMgr},function(e){r=e.RedPointMgr},function(e){a=e.default},function(e){s=e.default},null,function(e){l=e.ConfigGlobal},function(e){u=e.default},function(e){_=e.BagEventDefine},function(e){f=e.BagModel},function(e){R=e.CommonEventDefine},function(e){E=e.default},function(e){c=e.LoginDataCache},function(e){h=e.BubbleDataCache},function(e){v=e.CustomeHeadDataCache},function(e){L=e.FrameDataCache},function(e){d=e.TitleDataCache},function(e){I=e.NativeToJs},function(e){T=e.PlayerAttr,O=e.RoleEventDefine,g=e.RolePreviewState,A=e.NeedClearData},function(e){D=e.OpenFunction}],execute:function(){var G;n._RF.push({},"26fe4FEv8xKLaOHLk/LNaGz","RoleDataCache",void 0);var k=e("RES_ID_LIST",((G={})[1]=T.ROLE_ATTR_GOLD,G[2]=T.ROLE_ATTR_DIAMOND,G[7]=T.ROLE_RELIC_FRAG,G[9]=T.ROLE_NUTRIENTS,G[10]=T.ROLE_BUILDING_POINT,G[11]=T.ROLE_SKIN_CLIP,G[12]=T.ROLE_HONOR_SCORE,G[14]=T.ROLE_RETURN_COIN,G[101]=T.ROLE_SEED_GET,G[102]=T.ROLE_SEED_BUY,G[103]=T.ROLE_SEED_RARE,G[111]=T.ROLE_FERTILIZER_BUY,G[112]=T.ROLE_FERTILIZER_GET,G[113]=T.ROLE_FERTILIZER_HELP,G[999]=T.ROLE_FAKE_RECHARE,G[201]=T.ROLE_PARKING_COIN,G[202]=T.ROLE_CHANGE_POINT,G[203]=T.ROLE_CHANGE_GUILD,G[400]=T.ROLE_MERGE_ENERGY,G));e("RoleDataCache",function(){function e(){var e;this.hasInit=!1,this.roleInfo=((e={})[T.ROLE_ATTR_GOLD]=0,e[T.ROLE_ATTR_DIAMOND]=0,e[T.ROLE_RELIC_FRAG]=0,e[T.ROLE_RETURN_COIN]=0,e[T.ROLE_NUTRIENTS]=0,e[T.ROLE_BUILDING_POINT]=0,e[T.ROLE_SKIN_CLIP]=0,e[T.ROLE_SEED_GET]=0,e[T.ROLE_SEED_BUY]=0,e[T.ROLE_SEED_RARE]=0,e[T.ROLE_FERTILIZER_BUY]=0,e[T.ROLE_FERTILIZER_GET]=0,e[T.ROLE_FERTILIZER_HELP]=0,e[T.ROLE_PARKING_COIN]=0,e[T.ROLE_CHANGE_POINT]=0,e[T.ROLE_CHANGE_GUILD]=0,e[T.ROLE_MERGE_ENERGY]=0,e[T.ROLE_FAKE_RECHARE]=0,e[T.ROLE_ATTR_LVL]=0,e[T.ROLE_ATTR_EXP]=0,e[T.ROLE_ATTR_ID]=0,e[T.ROLE_ATTR_NAME]="",e[T.ROLE_ATTR_VIP]=0,e[T.ROLE_ATTR_SERVER]=0,e[T.ROLE_ATTR_CUR_POWER]=0,e[T.ROLE_ATTR_CUR_JOB]=0,e[T.ROLE_ATTR_JOB_TIMES]=0,e[T.ROLE_ATTR_STYLE]=0,e[T.ROLE_ATTR_RENAME]=0,e[T.ROLE_ATTR_GENDER]=0,e[T.ROLE_ATTR_SKIN]=0,e[T.ROLE_ATTR_HEAD_ID]=0,e[T.ROLE_HONOR_SCORE]=0,e[T.ROLE_ATTR_HEAD_FRAME_ID]=0,e[T.ROLE_ATTR_HEAD_URL]="",e[T.ROLE_ATTR_GUILD_ID]=0,e[T.ROLE_ATTR_GUILD_NAME]="",e[T.ROLE_ATTR_POWER_INFO]=[],e[T.ROLE_ATTR_MBTI]=0,e[T.ROLE_ATTR_FLAG]=0,e[T.ROLE_ATTR_CREATE_DAY]=0,e),this.functionList=[],this.rolePowerList=[],this.skinList={},this.usedSkinList={},this.rolePreviewInfo={},this.rolePreviewRed={},this.rolePreviewList=[],this.roleAwakeInfo=[],this.guideId=0,this.clentDatas=[],this.hideList=[],this.cacheSubscribeList={},this.goodsCfgIdToRefreshInfo={},this.systemToRedInfos={},this.planIdToInfo={},this.curPlan=0,this.presetList=[],this.curPresetList=[],this.curPreset=1,normalEvent.on(_.GOODS_INFO_UPDATE,this.onBagUpdate,this)}var n=e.prototype;return n.GetRoleAttr=function(e){return this.roleInfo[e]},n.GetGOLD=function(){return this.roleInfo[T.ROLE_ATTR_GOLD]},n.GetDiamond=function(){return this.roleInfo[T.ROLE_ATTR_DIAMOND]},n.GetLevel=function(){return this.roleInfo[T.ROLE_ATTR_LVL]},n.GetExp=function(){return this.roleInfo[T.ROLE_ATTR_EXP]},n.GetRoleId=function(){return this.roleInfo[T.ROLE_ATTR_ID]},n.GetRoleName=function(){return this.roleInfo[T.ROLE_ATTR_NAME]},n.GetGuildId=function(){return this.roleInfo[T.ROLE_ATTR_GUILD_ID]},n.GetGuildName=function(){return this.roleInfo[T.ROLE_ATTR_GUILD_NAME]},n.HasGuild=function(){return 0!=this.roleInfo[T.ROLE_ATTR_GUILD_ID]},n.GetVip=function(){return this.roleInfo[T.ROLE_ATTR_VIP]},n.GetServerId=function(){return this.roleInfo[T.ROLE_ATTR_SERVER]},n.GetPower=function(){return this.roleInfo[T.ROLE_ATTR_CUR_POWER]},n.GetJob=function(){return this.roleInfo[T.ROLE_ATTR_CUR_JOB]},n.GetJobTimes=function(){return this.roleInfo[T.ROLE_ATTR_JOB_TIMES]},n.GetHeadUrl=function(){return this.roleInfo[T.ROLE_ATTR_HEAD_URL]},n.GetSkinList=function(){return this.skinList},n.GetUsedSkinList=function(){return this.usedSkinList},n.GetGender=function(){return this.roleInfo[T.ROLE_ATTR_GENDER]},n.GetTypeUsedSkin=function(e){return 0==e?this.roleInfo[T.ROLE_ATTR_STYLE]:this.usedSkinList[e]},n.GetPowerInfoByID=function(e){for(var n,i=this.roleInfo[T.ROLE_ATTR_POWER_INFO],o=t(i);!(n=o()).done;){var r=n.value,a=r.type,s=r.power;if(a==e)return s}return 0},n.initRoleInfo=function(e){for(var n,i=e.role_info,o=i.info_list.kv,a=i.info_list.ks,s=t(o);!(n=s()).done;){var l=n.value;this.updateRoleAttr(l.k,l.v,!1)}for(var u,_=t(a);!(u=_()).done;){var f=u.value;this.updateRoleAttr(f.k,f.s,!1)}if(null!=i.function_list)for(var E,c=t(i.function_list);!(E=c()).done;){var h=E.value;this.functionList[h]=!0}loginControl.activeServerInfo(),IS(r).changeValue("MainView/tab-1/tab-11/btnJob",this.GetJobRed()),normalEvent.emit(R.UPDATE_MAIN_ROLE_RED_POINT),this.hasInit=!0,normalEvent.emit(O.ROLE_INFO_INIT)},n.updateRoleAttr=function(e,t,n){var i=this.roleInfo[e];if(null!=i)return i=t,this.roleInfo[e]=i,i},n.roleResChange=function(e){for(var n,i=t(e.change_info);!(n=i()).done;){var o=n.value,r=o.gtid,a=k[r];null!=configGoods.getDataByKey(r)&&(null!=a&&(this.roleInfo[a]=o.num,normalEvent.emit(O.ROLE_RES_UPDATE,a)))}},n.rolePowerChange=function(e){var t=this.GetPowerInfoByID(0);this.roleInfo[T.ROLE_ATTR_POWER_INFO]=e;var n=this.GetPowerInfoByID(0)-t;0!=t&&0!=n&&(o.playSound("common_reward"),E.showFightTip(n)),normalEvent.emit(O.ROLE_ATTR_POWER)},n.UpdateChangeInfo=function(e){var n=e.change_list.kv,i=e.change_list.ks,o={};if(null!=n)for(var a,s=t(n);!(a=s()).done;){var l=a.value,u=this.updateRoleAttr(l.k,l.v,!1);o[l.k]=!0,l.k==T.ROLE_ATTR_LVL&&(sdkControl.logRoleLevel(l.v,IS(c).loginServer.id),5==l.v?I.hwLogEventApi("level_5"):10==l.v?I.hwLogEventApi("level_10"):16==l.v?I.hwLogEventApi("level_16"):20==l.v?I.hwLogEventApi("level_20"):25==l.v?I.hwLogEventApi("level_25"):30==l.v&&I.hwLogEventApi("level_30")),null!=u&&(o[l.k]=!0)}if(null!=i)for(var _,f=t(i);!(_=f()).done;){var E=_.value,h=this.updateRoleAttr(E.k,E.s,!1);E.k==T.ROLE_ATTR_HEAD_URL&&normalEvent.emit(O.ROLE_INFO_UPDATE_HEADURL),null!=h&&(o[E.k]=!0)}(o[T.ROLE_ATTR_LVL]||o[T.ROLE_ATTR_CUR_JOB])&&(IS(r).changeValue("MainView/tab-1/tab-11/btnJob",this.GetJobRed()),IS(r).changeValue("MainView/tab-1/tab-16",this.GetAwakeRed()),normalEvent.emit(R.UPDATE_MAIN_ROLE_RED_POINT)),o[T.ROLE_ATTR_GUILD_ID]&&normalEvent.emit(R.UPDATE_MAIN_GUILD_RED_POINT),normalEvent.emit(O.ROLE_INFO_UPDATE,o)},n.UpdateFuncOpenList=function(e){if(null!=e.func_list)for(var n,i=t(e.func_list);!(n=i()).done;){var o=n.value;this.functionList[o]=!0,normalEvent.emit(O.ROLE_OPEN_FUNCTION_UPDATE,o)}},n.UpdateRename=function(e){0==e.code&&(E.showFlyTip(GetLanguage(200577)),this.roleInfo[T.ROLE_ATTR_NAME]=e.name,uiMgr.close("PlayerRenameView"),normalEvent.emit(O.ROLE_RENAME))},n.UpdateGender=function(e){0==e.code&&(E.showFlyTip(GetLanguage(200578)),this.roleInfo[T.ROLE_ATTR_GENDER]=e.gender,uiMgr.close("PlayerGenderView"),normalEvent.emit(O.ROLE_REGENDER))},n.clickSubscribe=function(e){this.cacheSubscribeList[e]=1},n.GetIsClickSubscribe=function(e){return null!=this.cacheSubscribeList[e]},n.UpdateHideList=function(e){this.hideList=e.list,normalEvent.emit(O.HIDE_LIST_UPDATE)},n.isHaveHideByType=function(e){for(var t=0;t<this.hideList.length;t++)if(e==this.hideList[t])return!0;return!1},n.UpdateSkin=function(e){if(null!=e){for(var n,i=t(e);!(n=i()).done;){var o=n.value;null==this.skinList[o.type]&&(this.skinList[o.type]={}),this.skinList[o.type][o.cfg_id]=o}normalEvent.emit(O.ROLE_SKIN_LIST)}},n.UpdateSkinChange=function(e){this.usedSkinList[e.figure.k]=e.figure.v,null==this.skinList[e.figure.k]&&(this.skinList[e.figure.k]={}),null==this.skinList[e.figure.k][e.figure.v]&&(this.skinList[e.figure.k][e.figure.v]={cfg_id:e.figure.v,type:e.figure.k,level:1}),normalEvent.emit(O.ROLE_SKIN_CHANGE)},n.UpdateSkinLevel=function(e){null!=this.skinList[2]&&null!=this.skinList[2][e.skin_id]&&(this.skinList[2][e.skin_id].level=e.skin_lv),normalEvent.emit(O.ROLE_SKIN_LEVEL_UP)},n.UpdateUsedSkin=function(e){if(null!=e)for(var n,i=t(e);!(n=i()).done;){var o=n.value;this.usedSkinList[o.k]=o.v}},n.updateAwakeList=function(e){this.roleAwakeInfo=[];for(var n,i=t(null!=(o=e.list)?o:[]);!(n=i()).done;){var o,a=n.value;this.roleAwakeInfo[a.k]=a.v}normalEvent.emit(O.Awake_Info_Update),IS(r).changeValue("MainView/tab-1/tab-16",this.GetAwakeRed()),normalEvent.emit(R.UPDATE_MAIN_ROLE_RED_POINT)},n.updateAwakeInfo=function(e){this.roleAwakeInfo[e.id]=e.lv,normalEvent.emit(O.Awake_Info_Update),IS(r).changeValue("MainView/tab-1/tab-16",this.GetAwakeRed()),normalEvent.emit(R.UPDATE_MAIN_ROLE_RED_POINT)},n.onBagUpdate=function(e,t){1023!=t&&1024!=t||(IS(r).changeValue("MainView/tab-1/tab-16",this.GetAwakeRed()),normalEvent.emit(R.UPDATE_MAIN_ROLE_RED_POINT))},n.CheckFuncOpen=function(e,t){if(void 0===t&&(t=!1),1==this.functionList[e])return!0;var n="",i=configNewFuncOpen.getDataByKey(e);if(null!=i&&null!=i.openCondition&&(n=i.openCondition),t){var o=""!=n?n:GetLanguage(200114);E.showFlyTip(o)}return!1},n.checkHasInit=function(){return this.hasInit},n.GetJobRed=function(){var e=this.GetJob(),t=this.GetLevel();if(0==e)return 0;if(null==configJobs.getDataByKey(e))return 0;var n=l.transfer_job_level,i=configJobs.getDataByKey(e).change_times;if(i>=5)return 0;var o=n[i];return null!=o&&t>=o?1:0},n.GetAwakeRed=function(){var n=0;if(!IS(e).CheckFuncOpen(D.FUNC_JOBS_WAKEUP))return n;if(IS(e).GetLevel()<l.jobs_wakeup_condition)return n;var i=IS(e).GetJob(),o=configJobs.getDataByKey(i);if(this.awakeAllPos())if(o.change_times<6){IS(e).GetLevel()>=l.transfer_job_level[5]&&n++}else{var r=l.jobs_wakeup_cost[0];IS(f).getGoodsCountByGoodsGtid(r[0])>0&&n++}else{var a=l.jobs_wakeup_cost[0];IS(f).getGoodsCountByGoodsGtid(a[0])>=a[1]&&n++}for(var s,u=this.roleAwakeInfo,_=t(o.passive_imprint);!(s=_()).done;){var R,E=s.value,c=null!=(R=u[E])?R:0;if(0!=c){var h=configJobs_wakeup.getDataByKeys("id",E,"level",c);if(0==h.cost.length)continue;var v=configGoods.getDataByKey(h.cost[0][0]);IS(f).getGoodsCountByGoodsGtid(v.id)>=h.cost[0][1]&&n++}}return n},n.GetShowId=function(e){null==e&&(e=this.roleInfo[T.ROLE_ATTR_ID]);for(var t=(e&=134217727).toString(16),n=t.length;n<5;)t="0"+t,n++;var i=t[2]+t[1]+t[3]+t[0]+t[4];return i=i.toUpperCase()},n.ModifyRolePreviewData=function(t){this.rolePreviewInfo={},this.rolePreviewRed={};var n=!1;for(var i in t.preview_list){var o=t.preview_list[i];this.rolePreviewInfo[o.config_id]=o;var a=this.rolePreviewRed[o.config_id];this.rolePreviewRed[o.config_id]=o.state==g.Reward,a!=this.rolePreviewRed[o.config_id]&&(n=!0)}this.UpdateRolePreviewSort(),n&&IS(r).changeValue("preview_red",IS(e).GetRolePreviewRed()),normalEvent.emit(O.ROLE_PREVIEW_UPDATE)},n.UpdayeRolePreviewData=function(t){var n,i=!1;for(var o in t.preview_info){var a=t.preview_info[o];this.rolePreviewInfo[a.config_id]=a;var s=this.rolePreviewRed[a.config_id];this.rolePreviewRed[a.config_id]=a.state==g.Reward,s!=this.rolePreviewRed[a.config_id]&&(i=!0),a.state==g.Reward&&(n=a)}this.UpdateRolePreviewSort(),i&&IS(r).changeValue("preview_red",IS(e).GetRolePreviewRed()),n&&uiMgr.openView("PreviewNewFuncView",n.config_id),normalEvent.emit(O.ROLE_PREVIEW_UPDATE)},n.GetRolePreviewState=function(e){return this.rolePreviewInfo[e]?this.rolePreviewInfo[e].state:g.NotFinish},n.GetRolePreviewRed=function(){for(var e in this.rolePreviewRed)if(1==this.rolePreviewRed[e])return 1;return 0},n.UpdateRolePreviewSort=function(){var e=this;this.rolePreviewList=[];var t=configPre_func.getDatas();this.rolePreviewList=u.copyArray(t),this.rolePreviewList.sort((function(t,n){var i=0,o=0,r=e.GetRolePreviewState(t.id),a=e.GetRolePreviewState(n.id);return r==g.Reward&&(i+=1e8),a==g.Reward&&(o+=1e8),r==g.NotFinish&&(i+=1e6),a==g.NotFinish&&(o+=1e6),t.id<n.id?i+=1e4:(t.id>n.id||(i+=1e4),o+=1e4),i<o?1:-1}))},n.GetRolePreviewList=function(){return this.rolePreviewList},n.clear=function(){this.rolePreviewInfo={},this.rolePreviewRed={},this.rolePreviewList=[]},n.getClientDataInfo=function(e){var t=this.clentDatas[e];return null!=t?t:null},n.getClientData=function(e,t){var n=this.clentDatas[e];return null!=n?n[t]:null},n.getClientDataByNum=function(e,t){var n,i=this.clentDatas[e];return null!=i?Number(null!=(n=i[t])?n:0):0},n.updateClientData=function(e){for(var n,i={},o=t(e);!(n=o()).done;){var r,a=n.value;if(A[a.sys_id])this.clentDatas[a.sys_id]={};else this.clentDatas[a.sys_id]=null!=(r=this.clentDatas[a.sys_id])?r:{};i[a.sys_id]=!0;for(var s,l=this.clentDatas[a.sys_id],u=t(a.data);!(s=u()).done;){var _=s.value;l[_.k]=_.s}}normalEvent.emit(O.ROLE_CLIENT_DATA,i)},n.UpdateGuideInfo=function(e){this.roleInfo[T.ROLE_ATTR_GUILD_ID]=e.guild_id,this.roleInfo[T.ROLE_ATTR_GUILD_NAME]=e.name},n.getAttrValueShow=function(e,t,n){var o=configAttribute.getDataByKey(e);return 2==o.show_type?i.formatStr("%s%",t/100):3==o.show_type?String(Math.floor(t/100)/100):n?a.GetNumString(t):String(t)},n.updateGoodsFefreshInfo=function(e){if(!(null==e||e.length<=0)){for(var t,n=0;n<e.length;n++){var i=e[n];t=i.cfg_id,this.goodsCfgIdToRefreshInfo[t]=i}normalEvent.emit(O.ROLE_GOODS_REFRESH_UPDATE)}},n.getGoodsFrfreshInfo=function(e){return this.goodsCfgIdToRefreshInfo[e]},n.CanUnLockSkin=function(e){if(this.skinList[2]&&null!=this.skinList[2][e]){var t=this.skinList[2][e].level,n=configFashion_skin.getDataByKeys("skin_id",e,"skin_level",t);if(n&&null!=n.expend&&null!=n.expend[0])if(null!=configFashion_skin.getDataByKeys("skin_id",e,"skin_level",t+1)){var i=n.expend[0][0],o=n.expend[0][1];if(IS(f).getGoodsCountByGoodsGtid(i)>=o)return!0}return!1}var r=configSkin.getDataByKey(e);if(null!=r){for(var a=r.condition,s=!1,l=0;l<a.length;l++){s=!1,IS(f).getGoodsCountByGoodsGtid(a[l][0])>=a[l][1]&&(s=!0)}if(s)return!0}return!1},n.CheckSkinTitleRed=function(){var e=this.GetSkinRed(),t=IS(d).CanUnLockTitle(),n=IS(L).CanUnLockFrame(),i=IS(h).CanUnLockBubble(),o=IS(v).GetIsRed();IS(r).changeValue("skinTitle_red",o+e+t+n+i)},n.CheckSkinRed=function(){var e=this.GetSkinRed();IS(r).changeValue("skin_red",e)},n.GetSkinRed=function(){for(var e=0,t=configSkin.getDatas(),n=0;n<t.length;n++)this.CanUnLockSkin(t[n].id)&&e++;return e},n.checkSkinCanShow=function(e){var t=configSkin.getDataByKey(e);if(null==t)return!1;var n=t.open_time;return!!u.isEmpty(n)||s.checkOpenTime(n)},n.getRedPointBySystem=function(e){return this.systemToRedInfos[e]},n.getRedNumByModule=function(e,t){var n=this.systemToRedInfos[e];return null==n?0:n[t]||0},n.awakeAllPos=function(){for(var n,i=IS(e).GetJob(),o=configJobs.getDataByKey(i),r=t(o.passive_imprint);!(n=r()).done;){var a=n.value,s=this.roleAwakeInfo[a];if(!s||0==s)return!1}return!0},n.getAwakeInfo=function(){return this.roleAwakeInfo},n.checkPlanUnlock=function(e){return null!=this.planIdToInfo[e]},n.getPlanName=function(e){var t=this.planIdToInfo[e];return null==t||""==t.name?a.formatStrWithMirrorDeal(GetLanguage(201061),GetLanguage(200662+e)):t.name},n.judgeIsChanged=function(){for(var e=1;e<=this.presetList.length;e++)if(this.presetList[e]!=this.curPresetList[e])return!0;return!1},n.checkAnyPlanHasFlyPet=function(e){if(null==e)return[!1,!1];var t=!1;for(var n in this.planIdToInfo)if(null!=this.planIdToInfo[n]){var i=this.planIdToInfo[n].detail;if(null!=i){for(var o=!1,r=0;r<i.length;r++)if(10==i[r].k&&i[r].v==e){o=!0;break}if(o){if(0!=Number(n))return[!0,!1];t=!0}}}return t?[!0,!0]:[!1,!1]},n.checkFlyPetInPlan=function(e,t){if(null==e)return!1;var n=this.planIdToInfo[t];if(null==n||null==n.detail)return!1;for(var i=0;i<n.detail.length;i++)if(10==n.detail[i].k&&n.detail[i].v==e)return!0;return!1},n.getFlyPetByPlan=function(e){var t=this.planIdToInfo[e];if(null!=t&&null!=t.detail)for(var n=0;n<t.detail.length;n++)if(10==t.detail[n].k)return t.detail[n].v},e}());n._RF.pop()}}}));

