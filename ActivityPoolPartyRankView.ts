System.register("chunks:///_virtual/ActivityPoolPartyRankView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./V2.ts","./ItemGrid.ts","./RankTitle.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./BagModel.ts","./CommonModel.ts","./MessageView.ts","./FriendControl.ts","./FrameDataCache.ts","./RankControl.ts","./RankDefine.ts","./RankModel.ts","./RoleDataCache.ts","./RoleDefine.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./RankingRushDataCache.ts","./BaseView.ts"],(function(t){"use strict";var i,e,n,o,a,r,s,d,h,c,m,l,f,v,u,g,k,I,C,p,y,R,x,T,L,w,S,_,P,G,F,M;return{setters:[function(t){i=t.inheritsLoose},function(t){e=t.cclegacy,n=t.Button,o=t.sys,a=t.HorizontalTextAlignment,r=t.Label,s=t.Sprite,d=t.ScrollView,h=t.js},function(t){c=t.V2},function(t){m=t.ItemGrid},function(t){l=t.RankTitle,f=t.TitleType},function(t){v=t.ListItem},function(t){u=t.default},function(t){g=t.default},function(t){k=t.default},null,function(t){I=t.BagModel},function(t){C=t.CommonModel},function(t){p=t.default},function(t){y=t.default},function(t){R=t.FrameDataCache},function(t){x=t.default},function(t){T=t.RankDefine},function(t){L=t.RankModel},function(t){w=t.RoleDataCache},function(t){S=t.PlayerAttr},function(t){_=t.default},function(t){P=t.ActivityType,G=t.ActivityState},function(t){F=t.RankingRushDataCache},function(t){M=t.BaseView}],execute:function(){var b,N,A;e._RF.push({},"fb46fc6tL1CcbyHLW6gMnY+","ActivityPoolPartyRankView",void 0);var B=1,E=2,D="",O=((b={})[P.PoolPartyPass]={1:205477,2:205478},b[P.PoolPartyEndPass]={1:205088,2:205089},b),U=((N={})[1]=new c(0,0),N[2]=new c(0,0),N[3]=new c(0,0),N),H={},K=((A={})[P.PoolPartyPass]=!1,A[P.PoolPartyEndPass]=!1,A),V=(t("default",function(t){function e(){var i;return(i=t.call(this)||this).tabBtns=[],i.actType=void 0,i.curIndex=0,i.nodeReward=void 0,i.nodeRank=void 0,i.nodeTopRank=void 0,i.nodeMyRank=void 0,i.rankList=void 0,i.rewardList=void 0,i.txtMyRank=void 0,i.txtMyScore=void 0,i.myFrame=void 0,i.myIcon=void 0,i.txtMyName=void 0,i.txtServer=void 0,i.roleList={},i.actInfo=void 0,i.rankId=void 0,i.rankInfo=void 0,i.curRankPage=void 0,i.txtLeftTime=void 0,i.leftTime=0,i.deltaTime=0,i.canUpdate=!1,i.name="ActivityPoolPartyRankView",i.url="ui/module/activityPoolParty/ActivityPoolPartyRankView",i}i(e,t);var c=e.prototype;return c.onInit=function(){var t=this,i=this.findChild("imgMask");this.addComponentCallbackListener(i,n.EventType.CLICK,(function(){}));var e=this.findChild("root/btnClose");this.addComponentCallbackListener(e,n.EventType.CLICK,(function(){t.close()}));var c=this.findChild("root/servers");this.addComponentCallbackListener(c,n.EventType.CLICK,(function(){uiMgr.openView("RankJoinServerView",t.rankId)}));var m=this.findChild("root/bg/tips");this.addComponentCallbackListener(m,n.EventType.CLICK,(function(){p.showBoxTip({tip:GetLanguage(205479),btnCnt:1,horizontalAlign:o.uiMirror?a.RIGHT:a.LEFT})})),this.txtLeftTime=this.findChildComponent("root/bg/nodeTime/txtTime",r);for(var l=function(i){var e=u.findChild(t.node,h.formatStr("root/bg/bottomBtn/item%s",i)),o={itemGo:e,normalTxt:u.findChildComponent(e,"normal/Label",r),normalGo:u.findChild(e,"normal"),selectedGo:u.findChild(e,"selected"),selectTxt:u.findChildComponent(e,"selected/Label",r),index:i};t.addComponentCallbackListener(e,n.EventType.CLICK,(function(){t.SetIndex(o.index)})),t.tabBtns[i]=o},f=1;f<=2;f++)l(f);this.nodeReward=this.findChild("root/nodeReward"),this.nodeRank=this.findChild("root/nodeRank"),this.nodeTopRank=this.findChild("root/nodeTopRank"),this.nodeMyRank=this.findChild("root/myRank"),this.txtMyRank=this.findChildComponent("root/myRank/rankNum",r),this.txtMyScore=this.findChildComponent("root/myRank/score",r),this.txtMyName=this.findChildComponent("root/myRank/name",r),this.txtServer=this.findChildComponent("root/myRank/txtServer",r),this.myFrame=this.findChildComponent("root/myRank/imgFrame/frame/imgHeadFrame",s),this.myIcon=this.findChildComponent("root/myRank/imgFrame/frame/imgIcon",s);var v=this.findChildComponent("root/nodeRank/rankList",d);this.rankList=this.addUIList(v,q),this.addComponentCallbackListener(v.node,d.EventType.SCROLL_TO_BOTTOM,(function(){if(t.curRankPage<t.rankInfo.max_page){t.curRankPage++;var i=new Array;i.push({type:t.rankId,server:1,page:t.curRankPage}),IS(x).reqRankList(i)}}));var g=this.findChildComponent("root/nodeReward/rankList",d);this.rewardList=this.addUIList(g,V,!0,0);for(var k=1;k<=3;k++){var I=new W;I.init(this.findChild("root/nodeTopRank/rank"+k),this,k),this.roleList[k]=I}},c.registerUpdateHandler=function(){this.addEvent(T.RankInfoBack,this.UpdateRankInfo,this)},c.onAfterOpen=function(){for(var t in this.actType=this.openArgs[0],this.roleList)this.roleList.hasOwnProperty(t)&&this.roleList[t].show();this.txtMyName.string=IS(w).GetRoleAttr(S.ROLE_ATTR_NAME),K[this.actType]?(this.txtMyName.node.setPosition(this.txtMyName.node.getPosition().x,0),this.txtServer.node.active=!1):(this.txtMyName.node.setPosition(this.txtMyName.node.getPosition().x,15),this.txtServer.node.active=!0,this.txtServer.string=g.formatStrWithMirrorDeal(GetLanguage(700030193),IS(w).GetRoleAttr(S.ROLE_ATTR_SERVER))),this.loadRemoteIcon(IS(w).GetRoleAttr(S.ROLE_ATTR_HEAD_URL),this.myIcon);var i=IS(R).curFrameId;if(i>0){var e=configAvatar_frame.getDataByKey(i);this.loadIcon(this.myFrame,"icon_frame",e.icon),this.myFrame.node.active=!0}else this.myFrame.node.active=!1;for(var n=1;n<=2;n++){var o=this.tabBtns[n];o.normalTxt.string=GetLanguage(O[this.actType][n]),o.selectTxt.string=GetLanguage(O[this.actType][n])}this.findChild("root/servers").active=!K[this.actType],this.actInfo=IS(_).GetActivityInfo(this.actType),this.rankId=this.actInfo.roundCfg.rank_id;var a=configRanktype.getDataByKey(this.rankId);D=a.prefix;var r=new Array;r.push({type:this.rankId,server:1,page:1}),this.curRankPage=1,IS(x).reqRankList(r);var s,d=IS(F).getRankRewardList(this.actInfo);this.rewardList.datas=d,this.tabBtns[B].itemGo.active,this.SetIndex(B),this.openArgs[0]==P.PoolPartyPass&&(s=IS(_).GetActivityInfo(P.PoolPartyTurn)),this.openArgs[0]==P.PoolPartyEndPass&&(s=IS(_).GetActivityInfo(P.PoolPartyEndTurn));var h=s;if(h){var c,m=null!=(c=h.state_time[h.state])?c:h.state_time[G.Open];this.leftTime=m.end_time-k.serverTime,this.leftTime>0?(this.canUpdate=!0,this.txtLeftTime.string=k.formatTimeStringForSecond(this.leftTime)):this.txtLeftTime.string=GetLanguage(200026)}else this.txtLeftTime.string=GetLanguage(200026)},c.onBeforeClose=function(){this.canUpdate=!1,this.rankId=0,this.rankList.clearData(),this.curIndex>0&&(this.tabBtns[this.curIndex].normalGo.active=!0,this.tabBtns[this.curIndex].selectedGo.active=!1,this.curIndex=0)},c.onDestroy=function(){},c.onUpdate=function(t){this.canUpdate&&(this.deltaTime=this.deltaTime+t,this.deltaTime>=1&&(this.deltaTime=0,this.leftTime=this.leftTime-1,this.leftTime>0?this.txtLeftTime.string=k.formatTimeStringForSecond(this.leftTime):(this.txtLeftTime.string=GetLanguage(200026),this.canUpdate=!1)))},c.SetIndex=function(t){this.curIndex!=t&&(this.curIndex>0&&(this.tabBtns[this.curIndex].selectedGo.active=!1,this.tabBtns[this.curIndex].normalGo.active=!0),this.curIndex=t,this.tabBtns[this.curIndex].normalGo.active=!1,this.tabBtns[this.curIndex].selectedGo.active=!0,this.curIndex==E?(this.nodeReward.active=!0,this.nodeRank.active=!1,this.nodeTopRank.active=!0,this.nodeMyRank.active=!0,this.rewardList.updateAll()):this.curIndex==B&&(this.nodeReward.active=!1,this.nodeRank.active=!0,this.nodeTopRank.active=!0,this.nodeMyRank.active=!0,this.rankList.updateAll()))},c.UpdateRankInfo=function(){if(this.rankInfo=IS(L).GetRankInfoByType(this.rankId),this.rankInfo){var t;this.txtMyRank.string=0!=this.rankInfo.my_info.rank?this.rankInfo.my_info.rank:GetLanguage(200037),this.txtMyScore.string=g.formatStrWithMirrorDeal(GetLanguage(700030194),D,g.GetNumString(null!=(t=this.rankInfo.my_info.score)?t:0));for(var i=[],e=3;e<this.rankInfo.rank_list.length;e++)i.push(this.rankInfo.rank_list[e]);this.rankList.datas=i;for(var n=1;n<=3;n++)this.roleList[n].show(this.rankInfo.rank_list[n-1])}},e}(M)),function(t){function e(){for(var i,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(i=t.call.apply(t,[this].concat(n))||this).rewardScroll=void 0,i.txtRank=void 0,i.rankIcon=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){this.txtRank=u.findChildComponent(this.node,"rankNum",r),this.rankIcon=u.findChildComponent(this.node,"rankIcon",s);var t=u.findChildComponent(this.node,"rewardScroll",d);this.rewardScroll=this.view.addUIList(t,j,!1,0),this.rewardScroll.touchEvent=!1},n.onRender=function(t,i){this.rewardScroll.datas=t.rank_reward,this.rewardScroll.scrollView.enabled=t.rank_reward.length>=6,this.rewardScroll.touchEvent=t.rank_reward.length>=6;var e=t.rank_range[0],n=t.rank_range[1];e==n&&e<=3?(this.rankIcon.node.active=!0,this.txtRank.node.active=!1,this.view.loadIcon(this.rankIcon,"common","common_ICON_paiming0"+e)):(this.rankIcon.node.active=!1,this.txtRank.node.active=!0,t.show&&""!=t.show?this.txtRank.string=t.show:this.txtRank.string=g.formatStrWithMirrorDeal(GetLanguage(700030195),e,n))},n.onItemClick=function(){},e}(v)),q=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(i=t.call.apply(t,[this].concat(n))||this).imgFrame=void 0,i.imgIcon=void 0,i.txtRank=void 0,i.rankIcon=void 0,i.txtName=void 0,i.txtServer=void 0,i.txtScore=void 0,i.imgHeadFrame=void 0,i}i(e,t);var o=e.prototype;return o.onInit=function(){var t=this;this.imgFrame=u.findChildComponent(this.node,"imgFrame",s),this.imgIcon=u.findChildComponent(this.node,"imgFrame/frame/imgIcon",s),this.txtRank=u.findChildComponent(this.node,"rankNum",r),this.rankIcon=u.findChildComponent(this.node,"rankIcon",s),this.txtName=u.findChildComponent(this.node,"name",r),this.txtServer=u.findChildComponent(this.node,"txtServer",r),this.txtScore=u.findChildComponent(this.node,"score",r),this.imgHeadFrame=u.findChildComponent(this.node,"imgFrame/frame/imgHeadFrame",s),this.view.addComponentCallbackListener(this.imgFrame.node,n.EventType.CLICK,(function(){IS(y).reqOtherRoleNotice(t.data.belong_id)}))},o.onRender=function(t,i){this.view.loadRemoteIcon(t.head.url,this.imgIcon);var e=t.head.frame_id;if(e>0){this.imgHeadFrame.node.active=!0;var n=configAvatar_frame.getDataByKey(e);this.view.loadIcon(this.imgHeadFrame,"icon_frame",n.icon)}else this.imgHeadFrame.node.active=!1;this.txtName.string=t.name,K[this.view.actType]?(this.txtName.node.setPosition(this.txtName.node.getPosition().x,-55),this.txtServer.node.active=!1):(this.txtName.node.setPosition(this.txtName.node.getPosition().x,-40),this.txtServer.node.active=!0,this.txtServer.string=g.formatStrWithMirrorDeal(GetLanguage(700030193),t.serv_id)),this.txtScore.string=D+g.GetNumString(t.score),t.rank<=3?(this.rankIcon.node.active=!0,this.txtRank.node.active=!1,this.view.loadIcon(this.rankIcon,"common","common_ICON_paiming0"+t.rank)):(this.rankIcon.node.active=!1,this.txtRank.node.active=!0,this.txtRank.string=t.rank)},o.onItemClick=function(){IS(y).reqOtherRoleNotice(this.data.info.belong_id)},e}(v),W=function(){function t(){this.view=void 0,this.node=void 0,this.rank=void 0,this.txtName=void 0,this.txtScore=void 0,this.imgFrame=void 0,this.imgIcon=void 0,this.headFrame=void 0,this.rankIcon=void 0,this.job=void 0,this.data=void 0,this.role=void 0}var i=t.prototype;return i.init=function(t,i,e){this.view=i,this.node=t,this.rank=e,this.onInit()},i.onInit=function(){var t=this;this.job=u.findChild(this.node,"role"),this.txtName=u.findChildComponent(this.node,"name",r),this.txtScore=u.findChildComponent(this.node,"score",r),this.imgFrame=u.findChild(this.node,"imgFrame"),this.imgIcon=u.findChildComponent(this.node,"imgFrame/frame/imgIcon",s),this.headFrame=u.findChildComponent(this.node,"imgFrame/frame/imgHeadFrame",s),this.view.addComponentCallbackListener(this.imgFrame,n.EventType.CLICK,(function(){t.data&&IS(y).reqOtherRoleNotice(t.data.belong_id)}));var i=u.findChild(this.node,"role/click");this.view.addComponentCallbackListener(i,n.EventType.CLICK,(function(){t.data&&IS(y).reqOtherRoleNotice(t.data.belong_id)})),this.rankIcon=u.findChildComponent(this.node,"imgFrame/rank_icon",s),this.view.loadIcon(this.rankIcon,"common","common_ICON_paiming0"+this.rank)},i.show=function(t){var i;if(this.data=t,this.txtName.string=GetLanguage(200038),this.txtScore.string=null!=(i=H[this.view.actType])?i:"0",this.imgIcon.node.active=!1,this.headFrame.node.active=!1,null!=this.role&&(this.view.removeUnitModel(this.role),this.role=null),t){var e,n=t.figure;this.role=IS(C).AddRoleModel(this.view,n,this.job,null,.9),this.view.getUnitModel(this.role).mount=n.mount_figure,this.imgIcon.node.active=!0,this.view.loadRemoteIcon(t.head.url,this.imgIcon),n.mount_figure<=0&&(this.view.getUnitModel(this.role).position=U[this.rank]),this.view.loadRemoteIcon(t.head.url,this.imgIcon);var o=t.head.frame_id;if(o>0){this.headFrame.node.active=!0;var a=configAvatar_frame.getDataByKey(o);this.view.loadIcon(this.headFrame,"icon_frame",a.icon)}else this.headFrame.node.active=!1;K[this.view.actType]?this.txtName.string=t.name:this.txtName.string=g.formatStrWithMirrorDeal(GetLanguage(700030193),t.serv_id)+t.name,this.txtScore.string=null!=(e=H[this.view.actType])?e:""+g.GetNumString(t.score,!0)}},t}(),j=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(i=t.call.apply(t,[this].concat(n))||this).itemGridNode=void 0,i.itemGrid=void 0,i.img=void 0,i}i(e,t);var o=e.prototype;return o.onInit=function(){var t=this;this.adaptiveSize=!0,this.img=u.findChild(this.node,"img"),this.itemGridNode=u.findChild(this.node,"itemGrid"),this.itemGrid=new m(this.view,this.itemGridNode),this.view.addComponentCallbackListener(this.node,n.EventType.CLICK,(function(){IS(I).OpenItemTips(t.data[0],t.node)}))},o.onRender=function(t,i){var e=this,n=configGoods.getDataByKey(t[0]);17==n.type?(this.ut.width=187,this.img.active=!0,this.itemGridNode.active=!1,new l(this.view,this.img,(function(){IS(I).OpenItemTips(e.data[0],e.node)})).SetRankTitle(n.effect[0],f.NORMAL)):(this.ut.width=100,this.img.active=!1,this.itemGridNode.active=!0,this.itemGrid.SetItemId(t[0],t[1]))},e}(v);e._RF.pop()}}}));

