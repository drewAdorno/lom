System.register("chunks:///_virtual/DevourGameMapSceneView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./NodeUtil.ts","./TimeUtil.ts","./index57.ts","./MessageView.ts","./DevourGameDefine.ts","./DevourGameMapScene.ts","./BaseView.ts"],(function(e){"use strict";var t,n,o,i,a,s,d,r,c,l,p,h,u,m,v,S;return{setters:[function(e){t=e.inheritsLoose,n=e.assertThisInitialized},function(e){o=e.cclegacy,i=e.Vec2,a=e.Vec3,s=e.ProgressBar,d=e.Label,r=e.UITransform,c=e.Button,l=e.Node},function(e){p=e.default},function(e){h=e.default},null,function(e){u=e.default},function(e){m=e.LimitTime},function(e){v=e.DevourGameMapScene},function(e){S=e.BaseView}],execute:function(){o._RF.push({},"f266bh4V1ZPqog0bDZPzE1k","DevourGameMapSceneView",void 0);var f=new i,T=new a;e("default",function(e){function o(){var t;return(t=e.call(this)||this).mapScene=void 0,t.txtName=void 0,t.content=void 0,t.face=void 0,t.time=0,t.curTime=m,t.pbTime=void 0,t.txtTime=void 0,t.nodeHandle=void 0,t.nodeShow=void 0,t.utShow=void 0,t.utHandle=void 0,t.handleBall=void 0,t.ballPos=new a(0,0,0),t.startTouchPos=new a,t.startTouch=!1,t.name="DevourGameMapSceneView",t.url="ui/module/devourGame/DevourGameMapSceneView",t.fullScreen=!0,t.mapScene=new v(n(t)),t}t(o,e);var S=o.prototype;return S.onInit=function(){var e=this;this.pbTime=p.findChildComponent(this.node,"time/pbTime",s),this.txtTime=p.findChildComponent(this.node,"time/txtTime",d),this.curTime=m,this.nodeHandle=this.findChild("nodeHandle"),this.nodeShow=p.findChild(this.nodeHandle,"nodeShow"),this.utShow=this.nodeShow.getComponent(r),this.utHandle=this.nodeHandle.getComponent(r),this.handleBall=p.findChild(this.nodeHandle,"nodeShow/nodeBall");var t=this.findChild("bottom/btnClose");this.addComponentCallbackListener(t,c.EventType.CLICK,(function(){e.destroy()})),this.addComponentCallbackListener(this.nodeHandle,l.EventType.TOUCH_START,(function(t){var n=t.getUILocation();T.set(n.x,n.y);var o=e.utHandle.convertToNodeSpaceAR(T);o.z=0,e.startTouchPos.set(o),e.startTouch=!0,t.preventSwallow=!0})),this.addComponentCallbackListener(this.nodeHandle,l.EventType.TOUCH_MOVE,(function(t){if(e.startTouch){var n=t.getUILocation();if(T.set(n.x,n.y),e.nodeShow.active){var o=e.utShow.convertToNodeSpaceAR(T);o.z=0,t.propagationStopped=!0,t.propagationImmediateStopped=!0;var i=o;return o.length()>50&&(i=o.normalize().multiplyScalar(50)),e.handleBall.position=i,e.mapScene.moveOwner(f.set(i.x,i.y)),void(e.ballPos=i)}var s=e.utHandle.convertToNodeSpaceAR(T);a.subtract(new a,e.startTouchPos,s).length()>50?(e.nodeShow.active=!0,e.nodeShow.position=e.startTouchPos,e.handleBall.position=a.ZERO,t.propagationStopped=!0,t.propagationImmediateStopped=!0):t.preventSwallow=!0}})),this.addComponentCallbackListener(this.nodeHandle,l.EventType.TOUCH_END,(function(t){if(e.startTouch=!1,e.nodeShow.active)return e.nodeShow.active=!1,t.propagationStopped=!0,t.propagationImmediateStopped=!0,void e.mapScene.moveOwner(i.ZERO);t.preventSwallow=!0}))},S.registerUpdateHandler=function(){},S.onAfterOpen=function(){this.mapScene.open()},S.onBeforeClose=function(){this.mapScene.close()},S.onDestroy=function(){this.mapScene.destroy()},S.onUpdate=function(e){var t=this;this.mapScene.onUpdate(e),this.mapScene.completeGame||(this.time=this.time+e,this.time>=1&&(this.curTime--,this.txtTime.string=h.formatTimeForSecond(this.curTime),this.time--,this.pbTime.progress=this.curTime/m),0==this.curTime&&(this.mapScene.completeGame=!0,u.showBoxTip({tip:"闯关失败！",btnCnt:1,func:function(e){t.destroy(),uiMgr.openView("DevourGameMapSceneView")},ensure:GetLanguage(200129)})))},o}(S));o._RF.pop()}}}));

