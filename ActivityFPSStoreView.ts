System.register("chunks:///_virtual/ActivityFPSStoreView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./RedPointMgr.ts","./NodeUtil.ts","./StorageUtil.ts","./TimeUtil.ts","./index57.ts","./BagDefine.ts","./ResItems.ts","./MessageView.ts","./MallControl.ts","./MallDataCache.ts","./MallDefine.ts","./RoleDataCache.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./ActivityFPSDataCache.ts","./BaseView.ts"],(function(t){"use strict";var i,e,n,o,s,a,d,c,r,l,h,u,f,m,v,p,g,y,C,S,I,T,L,w,x,A,D;return{setters:[function(t){i=t.inheritsLoose},function(t){e=t.cclegacy,n=t.Button,o=t.Label,s=t.ScrollView,a=t.Sprite,d=t.js},function(t){c=t.ItemGrid},function(t){r=t.ListItem},function(t){l=t.RedPointMgr},function(t){h=t.default},function(t){u=t.default},function(t){f=t.default},null,function(t){m=t.BagEventDefine,v=t.ItemIdDefine},function(t){p=t.ResItems},function(t){g=t.default},function(t){y=t.default},function(t){C=t.default},function(t){S=t.MallEventDefine,I=t.MallType},function(t){T=t.RoleDataCache},function(t){L=t.default},function(t){w=t.ActivityType,x=t.ActivityState},function(t){A=t.default},function(t){D=t.BaseView}],execute:function(){e._RF.push({},"4bbe4EJDLNNy7LNVEP14J7y","ActivityFPSStoreView",void 0);var G=[1605,2],b=(t("default",function(t){function e(){var i;return(i=t.call(this)||this).scroll=void 0,i.resItems=void 0,i.txtLeftTime=void 0,i.txtTimeDesc=void 0,i.deltaTime=0,i.leftTime=0,i.canUpdate=!1,i.name="ActivityFPSStoreView",i.url="ui/module/activityFPS/ActivityFPSStoreView",i}i(e,t);var a=e.prototype;return a.onInit=function(){var t=this,i=this.findChild("imgMask");this.addComponentCallbackListener(i,n.EventType.CLICK,(function(){t.close()}));var e=this.findChild("view/btnClose");this.addComponentCallbackListener(e,n.EventType.CLICK,(function(){t.close()})),this.txtTimeDesc=this.findChildComponent("view/bg/nodeTime/txtDesc",o),this.txtLeftTime=this.findChildComponent("view/bg/nodeTime/txtLeftTime",o);var a=this.findChildComponent("view/scroll",s);this.scroll=this.addUIList(a,b),this.resItems=new p(this),this.resItems.init(G)},a.registerUpdateHandler=function(){this.addEvent(S.MAll_INFO_UPDATE,this.updateInfo,this),this.addEvent(m.GOODS_INFO_UPDATE,this.updateResShow,this)},a.onAfterOpen=function(){var t,i,e=IS(L).GetActivityInfo(this.openArgs[0]),n=IS(L).GetActivityInfo(w.FPSTurn),o=IS(L).GetActivityInfo(w.FPSBox),s=String(e.id)+"#"+String(e.round),a="ActivityFPSStoreRed"+IS(T).GetRoleId();(null!=(t=u.get(a))?t:"")!=s&&(u.set(a,s),IS(L).UpdateMainRedByActType(e.type),IS(l).changeValue("fps_store",IS(A).GetStoreRed()));var d=null!=(i=e.state_time[e.state])?i:e.state_time[x.Open];if(this.leftTime=d.end_time-f.serverTime,this.leftTime>0){var c="";e.state==x.Preview?c=GetLanguage(200763):e.state==x.Open?c=GetLanguage(200764):e.state==x.EndShow&&(c=GetLanguage(200765)),this.txtTimeDesc.string=c,this.canUpdate=!0,this.txtLeftTime.string=f.formatTimeStringForSecond(this.leftTime)}else this.txtLeftTime.string=GetLanguage(200026);this.updateResShow(),IS(y).send_27_1(I.Activity);var r=[].concat(configMall.getDataByList("type",I.Activity)),h=[];for(var m in r)if(r.hasOwnProperty(m)){var v=r[m];v.condition.length>0&&"activity_group"==v.condition[0][0]&&v.condition[0][1]==e.type&&v.condition[0][2]==e.roundCfg.group_id&&h.push(v),n&&n.state==x.Open&&v.condition.length>0&&"activity_group"==v.condition[0][0]&&v.condition[0][1]==n.type&&v.condition[0][2]==n.roundCfg.group_id&&h.push(v),!o||o.state!=x.Open&&o.state!=x.EndShow||v.condition.length>0&&"activity_group"==v.condition[0][0]&&v.condition[0][1]==o.type&&v.condition[0][2]==o.roundCfg.group_id&&h.push(v)}h.sort((function(t,i){return t.id-i.id})),this.scroll.datas=h},a.onBeforeClose=function(){},a.onDestroy=function(){},a.onUpdate=function(t){this.canUpdate&&(this.deltaTime=this.deltaTime+t,this.deltaTime>=1&&(this.deltaTime=0,this.leftTime=this.leftTime-1,this.leftTime>0?this.txtLeftTime.string=f.formatTimeStringForSecond(this.leftTime):(this.txtLeftTime.string=GetLanguage(200026),this.canUpdate=!1)))},a.updateResShow=function(){this.resItems.update()},a.updateInfo=function(){this.scroll.updateAll()},e}(D)),function(t){function e(){for(var i,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(i=t.call.apply(t,[this].concat(n))||this).txtName=void 0,i.txtPrice=void 0,i.priceIcon=void 0,i.btnBuy=void 0,i.out=void 0,i.txtLimit=void 0,i.itemGrid=void 0,i.num=void 0,i.red=void 0,i}i(e,t);var s=e.prototype;return s.onInit=function(){var t=this;this.txtPrice=h.findChildComponent(this.node,"btnBuy/Label",o),this.priceIcon=h.findChildComponent(this.node,"btnBuy/Label/icon",a),this.red=h.findChild(this.node,"btnBuy/red"),this.txtName=h.findChildComponent(this.node,"txtName",o),this.num=h.findChildComponent(this.node,"num",o),this.out=h.findChild(this.node,"out"),this.out.active=!1,this.txtLimit=h.findChildComponent(this.node,"limit/Label",o),this.itemGrid=new c(this.view,h.findChild(this.node,"itemGrid")),this.btnBuy=h.findChild(this.node,"btnBuy"),this.view.addComponentCallbackListener(this.btnBuy,n.EventType.CLICK,(function(){t.out.active?g.showFlyTip(GetLanguage(200039)):uiMgr.openView("MallTipsView",t.data)}))},s.onRender=function(t,i){this.txtName.string=t.name;var e=configGoods.getDataByKey(t.price[0]);this.txtPrice.string=t.price[1],this.view.loadIcon(this.priceIcon,"icon_item",e.icon),this.itemGrid.SetItemId(t.goods[0],t.goods[1]),this.out.active=!1;var n=IS(C).GetBuyInfoByType(t.type);if(-1!=t.limit){var o;this.num.node.active=!0;var s=null!=(o=n[t.id])?o:0,a="";switch(t.refresh_way){case 0:a=GetLanguage(200040);break;case 1:a=GetLanguage(200041);break;case 2:a=GetLanguage(200042)}s>=t.limit?(this.out.active=!0,this.num.string=d.formatStr(a+"%s/%s",t.limit-s,t.limit)):(this.out.active=!1,this.num.string=d.formatStr(a+"%s/%s",t.limit-s,t.limit))}else this.num.node.active=!1;this.red.active=e.id==v.Diamond&&!this.out.active},e}(r));e._RF.pop()}}}));

