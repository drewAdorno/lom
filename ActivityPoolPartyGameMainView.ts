System.register("chunks:///_virtual/ActivityPoolPartyGameMainView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./BagModel.ts","./MessageView.ts","./ActivityControl.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./ActivityPoolPartyDataCache.ts","./ActivityPoolPartyDefine.ts","./BaseView.ts"],(function(t){"use strict";var e,i,n,a,s,o,d,r,c,l,h,f,v,m,u,I,p,y,L,g,k,C,P,T;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,n=t.Button,a=t.Label,s=t.ScrollView,o=t.Sprite,d=t.js},function(t){r=t.ItemGrid},function(t){c=t.SelectedType,l=t.ListItem},function(t){h=t.default},function(t){f=t.default},function(t){v=t.default},null,function(t){m=t.BagModel},function(t){u=t.default},function(t){I=t.default},function(t){p=t.default},function(t){y=t.ActivityType,L=t.ActivityEventDefine,g=t.ActivityState,k=t.ActivityTaskState},function(t){C=t.default},function(t){P=t.ActivityPoolPartyEvent},function(t){T=t.BaseView}],execute:function(){i._RF.push({},"9534f2J+65Kkb1R7vs6dJHN","ActivityPoolPartyGameMainView",void 0);t("default",function(t){function i(){var e;return(e=t.call(this)||this).txtTimeDesc=void 0,e.txtLeftTime=void 0,e.txtDesc=void 0,e.leftTime=0,e.deltaTime=0,e.canUpdate=!1,e.actType=void 0,e.levelList=void 0,e.taskItems=[],e.taskIdGroup=[],e.roundCfg=void 0,e.nodeEffect=void 0,e.effectId=-1,e.name="ActivityPoolPartyGameMainView",e.url="ui/module/activityPoolParty/ActivityPoolPartyGameMainView",e.fullScreen=!0,e}e(i,t);var o=i.prototype;return o.onInit=function(){var t=this,e=this.findChild("bottom/btnClose");this.addComponentCallbackListener(e,n.EventType.CLICK,(function(){t.close()}));var i=this.findChild("btnStart");this.addComponentCallbackListener(i,n.EventType.CLICK,(function(){IS(I).send_24_102(y.PoolPartyGame,IS(C).curLevelId),uiMgr.openView("ActivityPoolPartyGamePlayView")})),this.txtTimeDesc=this.findChildComponent("top/nodeTime/txtDesc",a),this.txtLeftTime=this.findChildComponent("top/nodeTime/txtTime",a),this.txtDesc=this.findChildComponent("content/nodeReward/nodeDesc/txtDesc",a);var o=this.findChildComponent("content/nodeLevel/ScrollView",s);this.levelList=this.addUIList(o,S,!0),this.levelList.selectedMode=c.SINGLE,this.taskItems=[];for(var r=function(e){var i=t.findChild(d.formatStr("content/task/task%s",e)),s=h.findChild(i,"btnFetch");t.addComponentCallbackListener(s,n.EventType.CLICK,(function(){var i=t.taskIdGroup[IS(C).curLevelId-1][e-1],n=t.roundCfg.task_list[0];IS(I).send_24_15(y.PoolPartyGame,i,n)}));var o=h.findChild(i,"rewardContent/item");o.active=!1,t.taskItems.push({node:i,index:e,btnFetch:s,nodeHasFetch:h.findChild(i,"hasFetch"),nodeCantFetch:h.findChild(i,"txtCantFetch"),txtDesc:h.findChildComponent(i,"txtDesc",a),nodeRewardItem:o,nodeRewardContent:h.findChild(i,"rewardContent")})},l=1;l<=3;l++)r(l);this.nodeEffect=this.findChild("bg/nodeEffect")},o.registerUpdateHandler=function(){this.addEvent(P.OnActivityPoolPartyGameLevelUpdate,this.UpdateLevelList,this),this.addEvent(P.OnActivityPoolPartyGameLevelUpdate,this.OnTaskUpdate,this),this.addEvent(L.OnActivityGameStart,this.GameStart,this),this.addEvent(L.OnActivityInfoUpdate,this.updateTimeInfo,this),this.addEvent(L.OnActivityInfoUpdate,this.OnTaskUpdate,this),this.addEvent(L.OnActivityInfoTaskUpdate,this.OnTaskUpdate,this),this.addEvent(L.OnActivityInfoTaskUpdate,this.UpdateLevelList,this)},o.onAfterOpen=function(){IS(I).send_24_14(y.PoolPartyGame),IS(I).send_24_101(y.PoolPartyGame),-1==this.effectId&&(this.effectId=this.addUIEffect("prefab/model/MX_boss_kushuyanwang",this.nodeEffect,-1)),this.updateTimeInfo()},o.onBeforeClose=function(){this.canUpdate=!1,-1!=this.effectId&&(this.removeUIEffect(this.effectId),this.effectId=-1)},o.onDestroy=function(){},o.onUpdate=function(t){this.canUpdate&&(this.deltaTime=this.deltaTime+t,this.deltaTime>=1&&(this.deltaTime=0,this.leftTime=this.leftTime-1,this.leftTime>0?this.txtLeftTime.string=v.formatTimeStringForSecond(this.leftTime):(this.txtLeftTime.string=GetLanguage(200026),this.canUpdate=!1)))},o.GameStart=function(){uiMgr.openView("ActivityPoolPartyGamePlayView")},o.updateTimeInfo=function(t){if(t||(t=IS(p).GetActivityInfo(y.PoolPartyGame)),t){var e,i=null!=(e=t.state_time[t.state])?e:t.state_time[g.Open];this.leftTime=i.end_time-v.serverTime,this.leftTime>0?(this.canUpdate=!0,this.txtLeftTime.string=v.formatTimeStringForSecond(this.leftTime)):this.txtLeftTime.string=GetLanguage(200026)}},o.OnTaskUpdate=function(){var t=IS(p).GetActivityInfo(y.PoolPartyGame);if(t&&t.state!=g.Null){this.roundCfg=IS(p).GetRoundCfg(y.PoolPartyGame,t.round);var e=[];for(var i in t.task_list)t.task_list.hasOwnProperty(i)&&e.push(t.task_list[i]);e.sort((function(t,e){return t.task_id-e.task_id})),this.taskIdGroup=[];for(var n=e[0].task_id,a=0;a<configGgbond_chapter.getDatas().length;a++){var s=[];s.push(n+3*a),s.push(n+3*a+1),s.push(n+3*a+2),this.taskIdGroup.push(s)}this.UpdateTaskItems()}},o.UpdateTaskItems=function(){var t=this.taskIdGroup[IS(C).curLevelId-1],e=IS(p).GetActivityInfo(y.PoolPartyGame);if(e)for(var i=e.task_list,n=0;n<3;n++){var a=configActivity_task.getDataByKey(t[n]);this.taskItems[n].txtDesc.string=a.desc;var s=i[t[n]].state;this.taskItems[n].btnFetch.active=s==k.CanGet,this.taskItems[n].nodeHasFetch.active=s==k.HadGet,this.taskItems[n].nodeCantFetch.active=s==k.Normal,null==this.taskItems[n].rewardList&&(this.taskItems[n].rewardList=[]);for(var o=a.reward||[],d=0;d<o.length;d++){var r=this.taskItems[n].rewardList[d]?this.taskItems[n].rewardList[d]:this.newRewardItem(this.taskItems[n]);r.itemId=o[d][0],r.itemGrid.SetItemId(o[d][0],o[d][1]),r.node.active=!0,this.taskItems[n].rewardList[d]=r}for(var c=o.length;c<this.taskItems[n].rewardList.length;c++)this.taskItems[n].rewardList[c].node.active=!1}},o.newRewardItem=function(t){var e=nodeInstantiate.instantiate(t.nodeRewardItem);e.parent=t.nodeRewardContent;var i=h.findChild(e,"itemGrid"),n={node:e,itemGrid:new r(this,i,(function(){IS(m).OpenItemTips(n.itemId,i)})),itemId:0};return n},o.UpdateLevelList=function(t){if(void 0===t&&(t=0),!(t>1&&t!=y.PoolPartyGame)){var e=[],i=configGgbond_chapter,n=IS(p).GetActivityInfo(y.PoolPartyGame);if(n){var a=[],s=[];for(var o in n.task_list)n.task_list.hasOwnProperty(o)&&a.push(n.task_list[o]);for(var d=0;d<i.getDatas().length;d++){s.push(0);for(var r=0;r<3;r++)if(a[3*d+r].state==k.CanGet){s[d]=1;break}}if(1!=t){for(var c=1,l=function(t){return 1==s[t]?(c=t+1,"break"):0==s[t]&&IS(C).openLevelList.some((function(e){return e==t+1}))?(c=t+1,"continue"):void 0},h=0;h<i.getDatas().length;h++){var f=l(h);if("break"===f)break}c>IS(C).act_day&&(c=IS(C).act_day),IS(C).curLevelId=c,this.levelList.scrollTo(c-1)}this.UpdateTaskItems();for(var v=function(t){var i={isLocked:!IS(C).openLevelList.some((function(e){return e==t+1})),isSelected:t==IS(C).curLevelId-1,red:1==s[t]};e.push(i)},m=0;m<i.getDatas().length;m++)v(m);this.levelList.datas=e}}},i}(T));var S=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),a=0;a<i;a++)n[a]=arguments[a];return(e=t.call.apply(t,[this].concat(n))||this).id=void 0,e.imgSelected=void 0,e.imgLock=void 0,e.txtLevel1=void 0,e.txtLevel2=void 0,e.RedPoint=void 0,e}e(i,t);var n=i.prototype;return n.onInit=function(){this.imgSelected=h.findChildComponent(this.node,"imgSelected",o),this.imgLock=h.findChildComponent(this.node,"imgLock",o),this.txtLevel1=h.findChildComponent(this.node,"txtLevel",a),this.txtLevel2=h.findChildComponent(this.node,"imgLock/txtLevel",a),this.RedPoint=h.findChild(this.node,"RedPoint")},n.onRender=function(t,e){this.id=e+1,this.imgSelected.node.active=t.isSelected,this.txtLevel1.string=this.id.toString(),this.txtLevel2.string=this.id.toString(),this.imgLock.node.active=t.isLocked,this.RedPoint.active=t.red},n.onItemClick=function(){this.imgLock.node.active?this.id<=IS(C).act_day?u.showFlyTip(GetLanguage(201214)):u.showFlyTip(f.formatStrWithMirrorDeal(GetLanguage(201212),this.id)):(IS(C).curLevelId=this.id,normalEvent.emit(P.OnActivityPoolPartyGameLevelUpdate,1))},i}(l);i._RF.pop()}}}));

