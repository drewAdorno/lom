System.register("chunks:///_virtual/SceneUnit3.ts",["./rollupPluginModLoBabelHelpers.js","cc","./V2.ts","./RankTitle.ts","./NodeUtil.ts","./UIEffectAsset.ts","./UIUnitModelObj.ts","./ConfigGlobal.ts","./PolyNavAgent.ts","./CommonModel.ts","./MessageView.ts","./FriendControl.ts","./RoleDataCache.ts"],(function(t){"use strict";var e,i,n,o,s,f,c,d,h,r,l,a,u,p,v,g,m,y,C,b,k,I,S,T;return{setters:[function(t){e=t.inheritsLoose,i=t.createClass,n=t.assertThisInitialized},function(t){o=t.cclegacy,s=t.Label,f=t.Color,c=t.Button,d=t.Vec3,h=t.ProgressBar,r=t.Vec2,l=t.isValid,a=t.Rect},function(t){u=t.V2},function(t){p=t.RankTitle,v=t.TitleType},function(t){g=t.default},function(t){m=t.UIEffectAsset},function(t){y=t.UIUnitModelObj},function(t){C=t.ConfigGlobal},function(t){b=t.PolyNavAgent},function(t){k=t.CommonModel},function(t){I=t.default},function(t){S=t.default},function(t){T=t.RoleDataCache}],execute:function(){o._RF.push({},"98502uoichLEYJkOq5n7bp5","SceneUnit",void 0);var w=t("SceneUnit",function(){function t(){this.id=void 0,this.uid=0,this.del=!1,this.isDestroy=!1,this.type=1,this.rect=new a}var e=t.prototype;return e.update=function(t){this.del||this.onUpdate(t)},e.destroy=function(){this.isDestroy||(this.isDestroy=!0,this.del=!0,this.onDestroy())},t}());t("SceneRole",function(t){function n(e,i){var n;(n=t.call(this)||this).map=void 0,n.info=void 0,n.agent=void 0,n.model=void 0,n.moveType=0,n.velocity=void 0,n.infoView=void 0,n.btnBreak=void 0,n.nodeActive=void 0,n.titleicon=void 0,n.nodePb=void 0,n.pbPicking=void 0,n.btnRolemodel=void 0,n.pickingNum=0,n.info=i,n.uid=i.role_id,n.map=e,n.agent=new b(e.polyNav);for(var o=new u(i.pos.x,i.pos.y),s=i.figure.skin_list||[],f=0,c=0;c<s.length;c++)2==s[c].k&&(f=s[c].v);var d=1,h=i.figure.gender||1,r=IS(T).GetTypeUsedSkin(0),l=y.getModelId(r,f,h),a=configUnitModel.getDataByKey(l);return a&&a.skin_scale>0&&(d=.66*a.skin_scale),n.model=IS(k).createRoleModel(i.figure,e.nodeUnit,o,d),n.infoView=m.alloc("ui/module/guild/scene/PlayerInfo",e.nodeUnitHub,-1,(function(t){n.onInit(t)})),n.agent.pos.set(o.x,o.y),n.agent.maxSpeed=150,n.rect.width=50,n.rect.height=50,n.rect.center=o,n.id="role:"+i.role_id,n}e(n,t);var o=n.prototype;return o.onInit=function(t){var e=t.node,i=g.findChildComponent(e,"nodeSelf/node/txtName",s),n=g.findChild(e,"nodeSelf/imgArrow");i.string=this.info.role_name,Number(this.info.role_id)==IS(T).GetRoleId()?(n.active=!0,i.color=new f(39,153,22)):(n.active=!1,i.color=f.WHITE),this.nodeActive=g.findChild(e,"nodeSelf/node/nodeActive"),this.nodeActive.active=1!=this.info.break,this.btnRolemodel=g.findChild(e,"rolemodel"),this.btnRolemodel.on(c.EventType.CLICK,this.onShowInfo,this),g.findChild(e,"nodeSelf").setPosition(0,this.model.modelHeight+50);var o=g.findChild(e,"nodeSelf/imgTitle"),r=this.info.figure.current_title;r>0&&(o.active=!0,new p(this.map.view,o).SetRankTitle(r,v.NORMAL));this.titleicon=o,o.active=r>0&&1!=this.info.break,o.active&&n.active?n.position=new d(0,75):n.position=new d(0,25),this.nodePb=g.findChild(e,"nodeSelf/node/nodePb"),this.pbPicking=this.nodePb.getComponent(h),this.refreshPickingState(this.pickingNum)},o.removeEvent=function(){null!=this.btnBreak&&(this.btnBreak.off(c.EventType.CLICK,this.onBreak,this),this.btnRolemodel.off(c.EventType.CLICK,this.onShowInfo,this))},o.onBreak=function(){I.showBoxTip({title:GetLanguage(200341),tip:GetLanguage(200342),btnCnt:1})},o.onShowInfo=function(){IS(S).reqOtherRoleNotice(this.info.role_id)},o.refreshPickingState=function(t){this.pickingNum=t,this.nodePb&&(this.nodePb.active=t>0,this.pbPicking.progress=t/C.treasure_hunt_pick_time)},o.onUpdate=function(t){if(!this.del){this.agent.onUpdate(t),1==this.moveType?this.agent.isMove?this.model.aniName="run":(this.model.aniName="idle",this.moveType=0):2==this.moveType&&this.agent.setDirPos(this.velocity,t),this.rect.center=this.agent.pos,this.model.position=this.agent.pos,this.infoView.position=this.agent.pos;var e=this.agent.dir;this.model.direction=e}},o.moveToTarget=function(t){return!!this.agent.setDestination(t)&&(this.moveType=1,!0)},o.moveToDir=function(t){this.agent.stop(),t.lengthSqr()>1?(this.moveType=2,this.model.aniName="run",this.velocity=t):(this.moveType=0,this.model.aniName="idle",this.velocity=r.ZERO)},o.onDestroy=function(){this.infoView&&(this.removeEvent(),this.infoView.free()),this.model&&this.model.free()},i(n,[{key:"position",get:function(){return this.model.position},set:function(t){this.model.position=t,this.agent.pos.set(t.x,t.y),this.rect.center=t}},{key:"depth",get:function(){return this.model.depth},set:function(t){this.model.depth=t}}]),n}(w)),t("SceneBox",function(t){function o(e,i){var o;return(o=t.call(this)||this).map=void 0,o.effect=void 0,o.nodeInfo=void 0,o.btnInfo=void 0,o.type=2,o.map=e,o.uid=i.n,o.effect=m.alloc("ui/module/guild/scene/Box",e.nodeUnit,-1,(function(t){o.nodeInfo=g.findChild(t.node,"info"),g.findChildComponent(o.nodeInfo,"txtNum",s).string=i.open_num+"/"+i.open_limit,o.btnInfo=g.findChild(t.node,"btnInfo"),o.btnInfo.on(c.EventType.CLICK,o.onClickBox,n(o))})),o.rect.width=C.treasure_hunt_range,o.rect.height=C.treasure_hunt_range,i.pos.x-=770,i.pos.y-=820,o.rect.center=new r(i.pos.x,i.pos.y),o.effect.position=new u(i.pos.x,i.pos.y),o.id="box:"+i.n,o}e(o,t);var f=o.prototype;return f.onUpdate=function(t){},f.onClickBox=function(){this.map.boxClick(this)},f.onDestroy=function(){l(this.btnInfo)&&this.btnInfo.off(c.EventType.CLICK,this.onClickBox,this),this.effect.free()},i(o,[{key:"position",get:function(){return this.effect.position},set:function(t){this.effect.position=t}},{key:"depth",get:function(){return this.effect.depth},set:function(t){this.effect.depth=t}}]),o}(w)),t("SceneEffect",function(t){function n(e,i){var n;return(n=t.call(this)||this).effect=void 0,n.type=3,n.effect=m.alloc(i,e.nodeUnit,-1),n}e(n,t);var o=n.prototype;return o.onUpdate=function(t){},o.onDestroy=function(){this.effect.free()},i(n,[{key:"position",get:function(){return this.effect.position},set:function(t){this.effect.position=t}},{key:"depth",get:function(){return this.effect.depth},set:function(t){this.effect.depth=t}}]),n}(w));o._RF.pop()}}}));

