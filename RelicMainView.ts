System.register("chunks:///_virtual/RelicMainView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./RedPoint.ts","./NodeUtil.ts","./BaseView.ts","./ItemIcon.ts","./ConfigGlobal.ts","./ObjectUtil.ts","./BagModel.ts","./MessageView.ts","./RoleDefine.ts","./RelicControl.ts","./RelicDataCache.ts","./RelicDefine.ts","./RelicModel.ts"],(function(t){"use strict";var n,e,i,o,d,a,s,c,l,u,h,C,f,r,p,I,m,v,g,R,y,P,S;return{setters:[function(t){n=t.inheritsLoose},function(t){e=t.cclegacy,i=t.Label,o=t.Button,d=t.Sprite,a=t.Vec2,s=t.Color,c=t.js,l=t.LabelOutline},function(t){u=t.RedPointType},function(t){h=t.default},function(t){C=t.BaseView},function(t){f=t.IconAseetType},function(t){r=t.ConfigGlobal},function(t){p=t.default},function(t){I=t.BagModel},function(t){m=t.default},function(t){v=t.PlayerAttr,g=t.RoleEventDefine},function(t){R=t.default},function(t){y=t.RelicDataCache},function(t){P=t.RelicEventDefine},function(t){S=t.RelicModel}],execute:function(){var T;e._RF.push({},"f0df75DK59MPqMit5q+iERB","RelicMainView",void 0);var _=r.relic_tab_num,w=((T={})[1]="yw_ui_yiwukuang01",T[2]="yw_ui_yiwukuang02",T[3]="yw_ui_yiwukuang03",T[4]="yw_ui_yiwukuang06",T[5]="yw_ui_yiwukuang07",T[6]="yw_ui_yiwukuang04",T[7]="yw_ui_yiwukuang05",T);t("default",function(t){function e(){var n;return(n=t.call(this)||this).txtResNum=void 0,n.txtCost=void 0,n.txtFound=void 0,n.txtNum=void 0,n.imgResIcon=void 0,n.imgCostIcon=void 0,n.nodeBtnFind=void 0,n.maxRelicCount=void 0,n.typeToItems=void 0,n.curPlanId=void 0,n.txtCurPlan=void 0,n.nodeSelectPlanMask=void 0,n.nodePlanDown=void 0,n.nodePlanUp=void 0,n.nodeSelectPlan=void 0,n.indexToPlanId={},n.btnSwitch=void 0,n.nodeIsCurTab=void 0,n.selectItems=[],n.isSelect=!1,n.name="RelicMainView",n.url="ui/module/relic/RelicMainView",n.poolTime=3e3,n}n(e,t);var C=e.prototype;return C.onInit=function(){var t=this;this.txtResNum=this.findChildComponent("content/res/txtNum",i),this.txtCost=this.findChildComponent("content/bottomBtns/btnFind/txtCost",i),this.txtFound=this.findChildComponent("content/get/txtNum",i),this.txtNum=this.findChildComponent("content/Node/nodeEffect/num1",i),this.btnSwitch=this.findChild("content/btnSwitch"),this.addComponentCallbackListener(this.btnSwitch,o.EventType.CLICK,(function(){IS(R).reqRelicChooseTab(t.curPlanId)})),this.nodeIsCurTab=this.findChild("content/changeState");var n=this.findChild("content/btnRename");this.addComponentCallbackListener(n,o.EventType.CLICK,(function(){uiMgr.openView("TabRenameView",t.curPlanId,"relic")})),this.loadIcon(n.getComponent(d),"farm_statue","grxx_ui_xiugai");var e=this.findChild("btnCurPlan");this.addComponentCallbackListener(e,o.EventType.CLICK,(function(){t.setSelectPlanActive(!t.isSelect)})),this.txtCurPlan=this.findChildComponent("btnCurPlan/txtPlan",i),this.nodeSelectPlanMask=this.findChild("maskSelectPlan"),this.addComponentCallbackListener(this.nodeSelectPlanMask,o.EventType.CLICK,(function(){t.setSelectPlanActive(!1)})),this.nodePlanDown=this.findChild("btnCurPlan/imgDown"),this.nodePlanUp=this.findChild("btnCurPlan/imgUp"),this.nodeSelectPlan=this.findChild("planSelect");var s=configGoods.getDataByKey(v.ROLE_RELIC_FRAG);this.imgResIcon=this.findChildComponent("content/res/imgIcon",d),this.loadIcon(this.imgResIcon,"icon_item",s.icon),this.imgCostIcon=this.findChildComponent("content/bottomBtns/btnFind/imgCost",d),this.loadIcon(this.imgCostIcon,"icon_item",s.icon);var C=this.findChild("content/res");this.addComponentCallbackListener(C,o.EventType.CLICK,(function(){uiMgr.openView("ItemGetWayView",v.ROLE_RELIC_FRAG)}));var f=this.findChild("content/bottomBtns/btnBook");this.addComponentCallbackListener(f,o.EventType.CLICK,(function(){t.onBookClick()})),this.nodeBtnFind=this.findChild("content/bottomBtns/btnFind"),this.addComponentCallbackListener(this.nodeBtnFind,o.EventType.CLICK,(function(){t.onFindClick()}));var r=this.findChild("imgMask");this.addComponentCallbackListener(r,o.EventType.CLICK,(function(){t.close()}));var p=this.findChild("btnClose");this.addComponentCallbackListener(p,o.EventType.CLICK,(function(){t.close()})),this.addRedPoint("relic_find",this.nodeBtnFind,new a(100,30),u.Dot),IS(y).updateRelicFindRed();for(var I=function(n){var e=t.findChild(c.formatStr("planSelect/selectItem%s",n));if(n>_-1)return e.active=!1,"continue";e.active=!0,t.addComponentCallbackListener(e,o.EventType.CLICK,(function(){t.clickSelectPlan(n)})),t.selectItems.push({node:e,nodeLock:h.findChild(e,"lock"),txtName:h.findChildComponent(e,"txtPlan",i),outlineName:h.findChildComponent(e,"txtPlan",l),imgBg:h.findChildComponent(e,"imgBg",d)})},m=1;m<=4;m++)I(m);this.initTypeItems()},C.initTypeItems=function(){var t=this;this.typeToItems={};for(var n=function(n){var e=t.findChild(c.formatStr("content/relicParent/relicItem%s",n));t.addComponentCallbackListener(e,o.EventType.CLICK,(function(){t.onTypeClick(n)}));var a=h.findChildComponent(e,"imgType",d),s=configRelic_pos.getDataByKey(n);t.loadIcon(a,"icon_relic",s.icon,null,f.ICON_SPRITE),t.typeToItems[n]={node:e,imgBg:h.findChildComponent(e,"imgBg",d),nodeLock:h.findChild(e,"imgLock"),nodeAdd:h.findChild(e,"imgAdd"),imgIcon:h.findChildComponent(e,"imgIcon",d),txtLevel:h.findChildComponent(e,"txtLevel",i),type:n}},e=1;e<=7;e++)n(e)},C.registerUpdateHandler=function(){this.addEvent(g.ROLE_RES_UPDATE,this.onRoleResUpdate,this),this.addEvent(P.RELIC_LIST_UPDATE,this.onRelicListUpdate,this),this.addEvent(P.RELIC_INFO_ADD,this.onRelicInfoAdd,this),this.addEvent(P.RELIC_CUR_TAB_CHANGE,this.updateUsePlan,this),this.addEvent(P.RELIC_TAB_INFO_UPDATE,this.onRelicTabInfoUpdate,this)},C.setSelectPlanActive=function(t){this.nodePlanDown.active=!t,this.nodePlanUp.active=t,this.nodeSelectPlan.active=t,this.nodeSelectPlanMask.active=t,this.isSelect=t},C.onAfterOpen=function(){this.curPlanId=IS(S).getCurTab(),this.setSelectPlanActive(!1),this.maxRelicCount=IS(S).getMaxRelicCount(),this.updateResShow(),this.updateTypeItemsShow(),this.updateBuffInfo(),this.txtFound.string=IS(y).findCount+"/"+this.maxRelicCount,IS(y).updateRelicEquipRed(),this.updateIndexToPlan(),this.updatePlanItems(),this.updateCurName(),this.updateUsePlan()},C.updateIndexToPlan=function(){for(var t=1,n=1;n<=_;n++)n!=this.curPlanId&&(this.indexToPlanId[t]=n,t+=1)},C.updatePlanItems=function(){for(var t=0;t<this.selectItems.length;t++){var n=t+1,e=this.indexToPlanId[n];this.selectItems[t].txtName.string=IS(S).getTabName(e)}},C.updateCurName=function(){this.txtCurPlan.string=IS(S).getTabName(this.curPlanId)},C.updateUsePlan=function(){this.nodeIsCurTab.active=IS(y).curTab==this.curPlanId,this.btnSwitch.active=IS(y).curTab!=this.curPlanId},C.updateBuffInfo=function(){if(0==IS(y).findCount)this.findChild("content/Node/nodeNone").active=!0,this.findChild("content/Node/nodeEffect").active=!1;else{this.findChild("content/Node/nodeNone").active=!1,this.findChild("content/Node/nodeEffect").active=!0;var t=0;for(var n in IS(y).relicIdToInfo){var e=IS(y).relicIdToInfo[n];t+=configRelic.getDataByKeys("id",e.cfg_id,"level",e.lv).own[0][1]}t/=100,this.txtNum.string="+"+t+"%"}},C.updateResShow=function(){this.txtResNum.string=IS(I).getGoodsCountByGoodsGtid(v.ROLE_RELIC_FRAG),this.updateCost()},C.updateCost=function(){var t=IS(S).getFindCount();if(t>=this.maxRelicCount)this.nodeBtnFind.active=!1;else{this.nodeBtnFind.active=!0;var n=configRelic_get.getDataByKey(t+1).cost[0];this.txtCost.string=n[1],this.txtCost.color=IS(I).getGoodsCountByGoodsGtid(n[0])>=n[1]?new s(74,157,62):new s(204,81,68)}},C.updateTypeItemsShow=function(){for(var t in this.typeToItems)this.updateTypeItem(t)},C.updateTypeItem=function(t){var n=this.typeToItems[t];this.addRedPoint("relicequip-"+t,n.node,new a(50,50),u.Dot);var e=IS(S).checkRelicTypeUnlock(n.type),i=IS(S).getRelicInfoByTabAndLocation(this.curPlanId,n.type),o=!p.isEmpty(i);n.nodeLock.active=!e,n.nodeAdd.active=e&&!o,n.imgIcon.node.active=o,n.txtLevel.node.active=o;var d=e?w[n.type]:"yw_ui_yiwukuang08";if(this.loadIcon(n.imgBg,"relic",d),o){n.txtLevel.string=c.formatStr("Lv.%s",i.lv);var s=configRelic.getDataByKeys("id",i.cfg_id,"level",i.lv);this.loadIcon(n.imgIcon,"icon_relic",s.icon,null,f.ICON_SPRITE)}},C.onBeforeClose=function(){this.isSelect=!1},C.onDestroy=function(){},C.onRoleResUpdate=function(t){t==v.ROLE_RELIC_FRAG&&this.updateResShow()},C.onRelicListUpdate=function(){this.updateTypeItemsShow(),this.updateBuffInfo()},C.onRelicInfoAdd=function(t){this.txtFound.string=IS(y).findCount+"/"+this.maxRelicCount,this.updateTypeItem(String(t)),this.updateCost(),this.updateBuffInfo()},C.onRelicTabInfoUpdate=function(t){t==this.curPlanId&&(this.updateTypeItemsShow(),this.updateCurName())},C.onBookClick=function(){uiMgr.openView("RelicBookView")},C.onFindClick=function(){var t=IS(S).getFindCount();if(!(t>=this.maxRelicCount)){var n=configRelic_get.getDataByKey(t+1).cost[0];if(IS(I).getGoodsCountByGoodsGtid(n[0])<n[1])return uiMgr.openView("ItemGetWayView",v.ROLE_RELIC_FRAG),void m.showFlyTip(GetLanguage(200574));IS(R).reqRelicFind()}},C.onTypeClick=function(t){IS(S).checkRelicTypeUnlock(t)?uiMgr.openView("RelicEditView",t,this.curPlanId):m.showFlyTip(GetLanguage(200575))},C.clickSelectPlan=function(t){var n=this.indexToPlanId[t];this.curPlanId=n,this.setSelectPlanActive(!1),this.updateIndexToPlan(),this.updatePlanItems(),this.updateCurName(),this.updateUsePlan(),this.updateTypeItemsShow()},e}(C));e._RF.pop()}}}));

