System.register("chunks:///_virtual/HorseRebuildView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./ConfigGlobal.ts","./MessageView.ts","./index52.ts","./ParkingControl.ts","./ParkingDataCache.ts","./HorseDataChche.ts","./ParkingDefine.ts","./BaseSubView.ts"],(function(t){"use strict";var i,e,n,r,o,a,s,h,d,l,c,u,f,g,v,C,m,_,p,S,y,L,w,I,x;return{setters:[function(t){i=t.inheritsLoose,e=t.createForOfIteratorHelperLoose},function(t){n=t.cclegacy,r=t.sys,o=t.Layout,a=t.ScrollView,s=t.Button,h=t.Label,d=t.RichText,l=t.Sprite,c=t.Vec3,u=t.ProgressBar,f=t.js},function(t){g=t.ItemGrid},function(t){v=t.ListItem},function(t){C=t.default},function(t){m=t.default},function(t){_=t.default},null,function(t){p=t.ConfigGlobal},function(t){S=t.default},null,function(t){y=t.default},function(t){L=t.ParkingDataCache},function(t){w=t.HorseDataCache},function(t){I=t.ParkingEventDefine},function(t){x=t.BaseSubView}],execute:function(){n._RF.push({},"db78bTcYVBM2ITiFUtYUdME","HorseRebuildView",void 0);t("default",function(t){function n(){var i;return(i=t.call(this)||this).scrollAward=void 0,i.attrUIList=void 0,i.attrTopUIList=void 0,i.scrollCar=void 0,i.starUIList=void 0,i.cur_Sel_Car=void 0,i.horseEffectID=void 0,i.btnLeft=void 0,i.btnRight=void 0,i.carList=[],i.txtRate=void 0,i.txtParkTime=void 0,i.btnUse=void 0,i.btnCancel=void 0,i.iconOriPos=void 0,i.name="HorseRebuildView",i.url="ui/module/horse/HorseRebuildView",i.poolTime=3e3,i}i(n,t);var g=n.prototype;return g.onInit=function(){var t=this;this.btnLeft=this.findChild("root/nodeShow/btnLeft"),this.btnRight=this.findChild("root/nodeShow/btnLeft"),r.uiMirror&&(this.dealMirrorLayout(this.findChildComponent("root/nodeChange/common_ui_xiaotidi",o)),this.dealMirrorLayout(this.findChildComponent("root/nodePreview/common_ui_xiaotidi",o)));var i=this.findChildComponent("root/nodePreview/ScrollView",a);this.scrollAward=this.addUIList(i,k);var n=this.findChildComponent("root/nodeChange/ScrollView",a);this.attrUIList=this.addUIList(n,b);var u=this.findChildComponent("root/nodeTop/ScrollView",a);this.attrTopUIList=this.addUIList(u,b);var f=this.findChildComponent("root/ScrollView",a);this.scrollCar=this.addUIList(f,D);var g=this.findChildComponent("root/nodeShow/ScrollView",a);this.starUIList=this.addUIList(g,P),this.btnLeft=this.findChild("root/nodeShow/btnLeft"),this.addComponentCallbackListener(this.btnLeft,s.EventType.CLICK,(function(){for(var i,n=e(t.carList);!(i=n()).done;){var r=i.value;if(r.id==t.cur_Sel_Car){t.cur_Sel_Car=t.carList[t.carList.indexOf(r)-1].id;break}}t.updateData()})),this.btnRight=this.findChild("root/nodeShow/btnRight"),this.addComponentCallbackListener(this.btnRight,s.EventType.CLICK,(function(){for(var i,n=e(t.carList);!(i=n()).done;){var r=i.value;if(r.id==t.cur_Sel_Car){t.cur_Sel_Car=t.carList[t.carList.indexOf(r)+1].id;break}}t.updateData()})),this.btnCancel=this.findChild("root/nodeShow/btnCancel"),this.addComponentCallbackListener(this.btnCancel,s.EventType.CLICK,(function(){IS(y).reqShowCar(0)})),this.btnUse=this.findChild("root/nodeShow/btnUse"),this.addComponentCallbackListener(this.btnUse,s.EventType.CLICK,(function(){IS(y).reqShowCar(t.cur_Sel_Car)}));var v=this.findChild("root/ProgressBar/btnAdd");this.addComponentCallbackListener(v,s.EventType.CLICK,(function(){for(var i,n=!0,r=e(IS(w).skin_list);!(i=r()).done;){var o=i.value;t.cur_Sel_Car==o.k&&(n=!1)}n?S.showFlyTip(GetLanguage(201511)):uiMgr.openView("ParkingHorseExpAddView",203,t.cur_Sel_Car)})),this.txtRate=this.findChildComponent("root/nodeGain/num",h),this.txtParkTime=this.findChildComponent("root/nodeGain/txtParkTime",d);var C=this.findChildComponent("root/nodeGain/gg_icon_cheweibi",l);this.loadIcon(C,"parking","gg_icon_cheweibi");var m=this.findChildComponent("root/ProgressBar/Node/gg_icon_zuoqijingyan",l);this.loadIcon(m,"parking","gg_icon_zuoqijingyan");var _=this.findChild("root/nodeShow/icon");this.iconOriPos=new c(_.position.x,_.position.y,0)},g.registerUpdateHandler=function(){this.addEvent(I.PARKING_CHANGE_CUR_SEL_CAR,this.updateData,this),this.addEvent(I.PARKING_CUR_PARKING_INFO_UPDATE,this.refreshHorseChange,this),this.addEvent(I.PARKING_CAR_LIST_UPDATE,this.updateData,this)},g.onAfterOpen=function(){IS(y).reqCarListInfo(),this.carList=[];for(var t,i=[],n=[],r=configParking_mount.getDataByList("level",1),o=e(r);!(t=o()).done;){var a=t.value;if(IS(w).checkHorseCanShow(a.id))for(var s,h=e(IS(w).skin_list);!(s=h()).done;){var d=s.value;a.id==d.k?n.push(a):i.push(a)}}i=i.filter((function(t,e){return i.indexOf(t)===e})),n=n.filter((function(t,i){return n.indexOf(t)===i})),i.sort((function(t,i){var e=configMount.getDataByKey(t.id),n=configMount.getDataByKey(i.id);return e.quality>n.quality?-1:1})),n.sort((function(t,i){var e=configMount.getDataByKey(t.id),n=configMount.getDataByKey(i.id);return e.quality>n.quality?-1:1}));var l=n.concat(i);this.carList=l.filter((function(t,i){return l.indexOf(t)===i})),this.cur_Sel_Car=this.carList[0].id,this.updateData()},g.onBeforeClose=function(){this.carList=[]},g.onDestroy=function(){},g.refreshHorseChange=function(){var t,i,e,n=this.findChild("root/nodeShow/icon"),o=this.findChildComponent("root/nodeShow/bgName/txtName",h);this.removeUIEffect(this.horseEffectID),this.horseEffectID=this.addUIEffect(configMount.getDataByKey(this.cur_Sel_Car).path,n,-1,null,1,(function(t){r.uiMirror&&(t.dir=-1)}));var a=configMount.getDataByKey(this.cur_Sel_Car);o.string=a.name,n.position=new c(this.iconOriPos.x,0!=a.mount_location_adjust?a.mount_location_adjust:this.iconOriPos.y,0);var s=IS(L).car_list[this.cur_Sel_Car],d=null!=(t=null==(i=configParking_mount.getDataByKeys("id",this.cur_Sel_Car,"level",null!=(e=null==s?void 0:s.car_lev)?e:1))?void 0:i.drop_show)?t:[];this.scrollAward.datas=d,this.checkPageBtn()},g.checkPageBtn=function(){this.btnLeft.active=!0,this.btnRight.active=!0;for(var t,i=e(this.carList);!(t=i()).done;){var n=t.value;n.id==this.cur_Sel_Car&&(0==this.carList.indexOf(n)&&(this.btnLeft.active=!1),this.carList.indexOf(n)==this.carList.length-1&&(this.btnRight.active=!1))}this.btnCancel.active=!1,this.btnCancel.active=!1},g.refreshAttrChange=function(){var t,i,e=this.findChild("root/nodeChange"),n=this.findChild("root/nodeTop"),r=C.findChildComponent(e,"txtLevelBase",h),o=C.findChildComponent(e,"txtLevelNext",h),a=C.findChildComponent(n,"txtLevelBase",h),s=IS(L).car_list[this.cur_Sel_Car],d=configParking_mount.getDataByKeys("id",this.cur_Sel_Car,"level",null!=(t=null==s?void 0:s.car_lev)?t:1),l=configParking_mount.getDataByKeys("id",this.cur_Sel_Car,"level",(null!=(i=null==s?void 0:s.car_lev)?i:1)+1),c=[],u=[];if(null!=d)if(null!=l){r.string=d.level+"",o.string=l.level+"";for(var f=0;f<d.own_attrs.length;f++){var g=configAttribute.getDataByKey(d.own_attrs[f][0]),v={show_type:g.show_type,name:g.desc,base:d.own_attrs[f][1],next:l.own_attrs[f][1]};c.push(v)}this.attrUIList.datas=c,e.active=!0,n.active=!1}else{a.string=d.level+"";for(f=0;f<d.own_attrs.length;f++){var m=configAttribute.getDataByKey(d.own_attrs[f][0]),_={show_type:m.show_type,name:m.desc,base:d.own_attrs[f][1]};u.push(_)}this.attrTopUIList.datas=u,e.active=!1,n.active=!0}},g.refreshProgress=function(){var t,i,e,n=this.findChildComponent("root/ProgressBar",u),r=IS(L).car_list[this.cur_Sel_Car];if(r){n.node.active=!0;var o=configParking_mount.getDataByKeys("id",this.cur_Sel_Car,"level",null!=(t=null==r?void 0:r.car_lev)?t:0);if(null!=o){var a=this.findChildComponent("root/ProgressBar/txtDesc",h),s=o.expend,d=configParking_mount.getDataByKeys("id",this.cur_Sel_Car,"level",(null!=(i=null==r?void 0:r.car_lev)?i:0)+1);if(null==d)return n.progress=1,void(a.string=s+"/"+s);var l=null!=(e=null==r?void 0:r.car_exp)?e:0;l-=s,s=d.expend-o.expend,n.progress=l/s,a.string=l+"/"+s}}else n.node.active=!1},g.refreshStarInfo=function(){for(var t=configParking_mount.getDataByList("id",this.cur_Sel_Car),i=[0,0,0,0,0],e=0;e<t.length;e++){i[e%5]+=1}this.starUIList.datas=i},g.refreshRate=function(){var t,i=IS(L).car_list[this.cur_Sel_Car],e=configParking_mount.getDataByKeys("id",this.cur_Sel_Car,"level",null!=(t=null==i?void 0:i.car_lev)?t:1);this.txtRate.string=e.rate+"/min"},g.refreshParkTime=function(){var t=IS(L).car_list[this.cur_Sel_Car];if(t){var i=0;if(0==t.parking_data.start_time)i=t.minute;else{var e=new Date(1e3*_.serverTime),n=new Date(1e3*t.parking_data.start_time),r=f.formatStr("%s/%s/%s %s:%s:%s",e.getFullYear(),e.getMonth()+1,e.getDate(),0,0,0);i=r==f.formatStr("%s/%s/%s %s:%s:%s",n.getFullYear(),n.getMonth()+1,n.getDate(),0,0,0)?t.minute+Math.min(Math.floor((_.serverTime-t.parking_data.start_time)/60),480):t.minute+Math.min(Math.floor((_.serverTime-Math.floor(new Date(r).getTime()/1e3))/60),480)}this.txtParkTime.string=i<720?m.formatStrWithMirrorDeal(GetLanguage(201450),i):GetLanguage(201451)}else this.txtParkTime.string=m.formatStrWithMirrorDeal(GetLanguage(201450),0)},g.updateData=function(){var t=this;this.scrollCar.datas=this.carList,this.refreshHorseChange(),this.refreshRate(),this.refreshParkTime(),this.refreshAttrChange(),this.refreshProgress(),this.addTimer(1,-1,(function(){var i=IS(L).car_list[t.cur_Sel_Car];i?Math.min(Math.max(_.serverTime-i.parking_data.start_time,0),60*p.park_time_limit)%60==0&&t.refreshParkTime():t.txtParkTime.string=m.formatStrWithMirrorDeal(GetLanguage(201450),0)}))},n}(x));var k=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(i=t.call.apply(t,[this].concat(n))||this).itemGridNode=void 0,i.itemGrid=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){this.itemGridNode=C.findChild(this.node,"itemGrid"),this.itemGrid=new g(this.view,this.itemGridNode)},n.onRender=function(t,i){this.itemGrid.SetItemId(t)},e}(v),b=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(i=t.call.apply(t,[this].concat(n))||this).txtAttrName=void 0,i.txtAttrBase=void 0,i.txtAttrNext=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){this.txtAttrName=C.findChildComponent(this.node,"txtAttrName",h),this.txtAttrBase=C.findChildComponent(this.node,"txtAttrBase",h),this.txtAttrNext=C.findChildComponent(this.node,"txtAttrNext",h)},n.onRender=function(t,i){this.txtAttrName.string=t.name,2==t.show_type?(this.txtAttrBase.string=f.formatStr("%s%",m.GetNumString(t.base/100)),this.txtAttrNext.string=f.formatStr("%s%",m.GetNumString(t.next/100))):3==t.show_type?(this.txtAttrBase.string=m.GetNumString(Math.floor(t.base/100)/100),this.txtAttrNext.string=m.GetNumString(Math.floor(t.next/100)/100)):(this.txtAttrBase.string=m.GetNumString(t.base),this.txtAttrNext.string=m.GetNumString(t.next))},n.onItemClick=function(){},e}(v),D=function(t){function n(){for(var i,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(i=t.call.apply(t,[this].concat(n))||this).imgFrame=void 0,i.imgIcon=void 0,i.imgLock=void 0,i.imgRP=void 0,i.nodeUse=void 0,i.nodeSel=void 0,i}i(n,t);var r=n.prototype;return r.onInit=function(){var t=this;this.imgFrame=C.findChildComponent(this.node,"frame",l),this.imgIcon=C.findChildComponent(this.node,"icon",l),this.imgLock=C.findChild(this.node,"lock"),this.imgRP=C.findChild(this.node,"rp"),this.nodeUse=C.findChild(this.node,"nodeUse"),this.nodeSel=C.findChild(this.node,"sel"),this.view.addComponentCallbackListener(this.node,s.EventType.CLICK,(function(){t.view.cur_Sel_Car=t.data.id,normalEvent.emit(I.PARKING_CHANGE_CUR_SEL_CAR)}))},r.onRender=function(t,i){var e=configMount.getDataByKey(t.id).icon_small,n=configMount.getDataByKey(t.id).quality,r=configColor.getDataByKey(n).path;this.view.loadIcon(this.imgFrame,"icon_equip",r),this.view.loadIcon(this.imgIcon,"icon_item",e);var o=this.view;this.nodeSel.active=o.cur_Sel_Car==t.id,this.checkState()},r.checkState=function(){this.imgLock.active=!1,this.imgRP.active=!1,this.imgFrame.grayscale=!1,this.imgIcon.grayscale=!1,this.nodeUse.active=!1;for(var t,i=!0,n=e(IS(w).skin_list);!(t=n()).done;){var r=t.value;this.data.id==r.k&&(i=!1)}i&&(this.imgLock.active=!0,this.imgFrame.grayscale=!0,this.imgIcon.grayscale=!0)},n}(v),P=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(i=t.call.apply(t,[this].concat(n))||this).imgOne=void 0,i.imgTwo=void 0,i.imgThree=void 0,i.imgDark=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){this.imgOne=C.findChild(this.node,"one"),this.imgTwo=C.findChild(this.node,"two"),this.imgThree=C.findChild(this.node,"three"),this.imgDark=C.findChild(this.node,"dark")},n.onRender=function(t,i){this.imgDark.active=0==t,this.imgOne.active=1==t,this.imgTwo.active=2==t,this.imgThree.active=3==t},e}(v);n._RF.pop()}}}));

