System.register("chunks:///_virtual/ReturnRouletteView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./env","./AudioMgr.ts","./index3.ts","./ItemGrid.ts","./NodeUtil.ts","./StringUtil.ts","./index57.ts","./ReturnControl.ts","./ReturnDataCache.ts","./ReturnDefine.ts","./EaseMethod.ts","./BaseSubView.ts"],(function(t){"use strict";var e,i,n,o,l,s,r,a,h,d,f,u,c,m,v,C,g;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,n=t.RichText,o=t.Button,l=t.Label,s=t.js,r=t.randomRangeInt},function(t){a=t.HTML5},function(t){h=t.audioMgr},null,function(t){d=t.ItemGrid},function(t){f=t.default},function(t){u=t.default},null,function(t){c=t.default},function(t){m=t.ReturnDataCache},function(t){v=t.ReturnEventDefine},function(t){C=t.EasingMethod},function(t){g=t.BaseSubView}],execute:function(){i._RF.push({},"30896ys5HNN+bSAm1QHNnEo","ReturnRouletteView",void 0);t("default",function(t){function i(){var e;return(e=t.call(this)||this).btnRoll=void 0,e.nodeTable=void 0,e.nodeItem=void 0,e.moveTween=void 0,e.rollTips=void 0,e.actionTime=5,e.rollItemList=[],e.openEff=void 0,e.isRolling=!1,e.callFriend=void 0,e.callFriendCode=void 0,e.btnCall=void 0,e.copy=void 0,e.name="ReturnRouletteView",e.url="ui/module/return/ReturnRouletteView",e.poolTime=3e3,e}e(i,t);var g=i.prototype;return g.onInit=function(){var t=this;this.callFriend=this.findChildComponent("root/callFriendNum",n),this.addComponentCallbackListener(this.findChild("root/callFriendNum/tips"),o.EventType.CLICK,(function(){uiMgr.openView("ReturnCallFriendShowView")})),this.callFriendCode=this.findChildComponent("root/callFriendCode",l),this.btnCall=this.findChild("root/btnCall"),this.addComponentCallbackListener(this.btnCall,o.EventType.CLICK,(function(){var t=IS(m).GetWheelInfo();uiMgr.openView("ReturnShareView",t.code)})),this.copy=this.findChild("root/callFriendCode/copy"),this.addComponentCallbackListener(this.copy,o.EventType.CLICK,(function(){var t=IS(m).GetWheelInfo();t&&sdkControl.copyToClipBoard(t.code)})),this.copy.active=a,this.nodeTable=this.findChild("root/turntable"),this.openEff=this.findChild("root/openEff"),this.nodeItem=this.findChild("root/nodeItem"),this.btnRoll=this.findChild("root/openBtn"),this.rollTips=this.findChildComponent("root/times/Label",l),this.addComponentCallbackListener(this.btnRoll,o.EventType.CLICK,(function(){t.isRolling||(h.playSound("common_zhuanpan"),IS(c).send_return_wheel_spin_c2s())})),this.nodeItem.removeAllChildren();for(var e=configRecall_turantable.getDatas(),i=0;i<e.length;i++){var s=this.findChild("root/item"),r=nodeInstantiate.instantiate(s);r.active=!0,r.setParent(this.nodeItem),r.worldPosition=s.worldPosition,r.angle=-360/e.length*i;var u=f.findChild(r,"itemnode");u.angle=-r.angle;var v=new d(this,u),C=e[i].reward[0];v.SetItemId(C[0],C[1]),this.rollItemList.push(r)}},g.onAfterOpen=function(){IS(c).send_return_wheel_info_c2s(),this.refreshShow(),this.nodeTable.angle=0;for(var t=0;t<this.rollItemList.length;t++)f.findChild(this.rollItemList[t],"select").active=!1},g.registerUpdateHandler=function(){this.addEvent(v.RewardWheel,this.refreshRollTips,this),this.addEvent(v.UpdateWheelInfo,this.refreshShow,this),this.addEvent(v.UpdateWheelInfo,this.refreshNum,this)},g.refreshShow=function(){if(!this.isRolling){this.refreshNum();var t=IS(m).GetWheelInfo();if(t){for(var e={},i=0;i<t.conf_list.length;i++)e[t.conf_list[i]-1]=!0;for(var n=0;n<this.rollItemList.length;n++)f.findChild(this.rollItemList[n],"itemnode/mask").active=e[n];this.callFriendCode.string=u.formatStrWithMirrorDeal(GetLanguage(204741),t.code),this.callFriend.string=s.formatStr("<b><color=#6f4d2c>%s<color=#c1531d>%s</color></color></b>",GetLanguage(204742),u.formatStrWithMirrorDeal(GetLanguage(204743),t.back_num))}}},g.refreshRollTips=function(){this.refreshNum(),this.startRoll()},g.startRoll=function(){var t=this;this.isRolling=!0;var e=IS(m).wheelId-1,i=-360/this.rollItemList.length;null!=this.moveTween&&this.moveTween.stop();for(var n=720+i*e+r(-i/2+1,i/2),o=0;o<this.rollItemList.length;o++)f.findChild(this.rollItemList[o],"select").active=!1;this.moveTween=this.addTween(0,1,this.actionTime,(function(e,i){t.nodeTable.angle=n*i})).easing(C.CUBIC_OUT).call((function(){t.isRolling=!1,f.findChild(t.rollItemList[e],"select").active=!0;var i=configRecall_turantable.getDatas()[e].reward[0];t.refreshShow(),uiMgr.openView("GoodsGetView",[{gtid:i[0],num:i[1]}])})).start()},g.refreshNum=function(){var t=IS(m).GetWheelInfo();if(t){var e,i=null!=(e=t.num)?e:0;this.rollTips.string=u.formatStr(GetLanguage(402321),i),this.openEff.active=i>0}else this.openEff.active=!1},g.onBeforeClose=function(){if(null!=this.moveTween&&this.moveTween.stop(),this.isRolling){var t=IS(m).wheelId-1,e=configRecall_turantable.getDatas()[t].reward[0];uiMgr.openView("GoodsGetView",[{gtid:e[0],num:e[1]}]),this.isRolling=!1}},g.onDestroy=function(){},i}(g));i._RF.pop()}}}));

