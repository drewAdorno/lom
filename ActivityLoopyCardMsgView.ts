System.register("chunks:///_virtual/ActivityLoopyCardMsgView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIList.ts","./RedPoint.ts","./RedPointMgr.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./ActivityControl.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./ActivityLoopyDataCache.ts","./ActivityLoopyDefine.ts","./BaseView.ts"],(function(e){"use strict";var t,i,n,s,r,o,a,d,c,m,h,v,l,u,f,g,C,p,y,T,I;return{setters:[function(e){t=e.inheritsLoose},function(e){i=e.cclegacy,n=e.Button,s=e.Label,r=e.ScrollView,o=e.Sprite,a=e.js,d=e.Vec2},function(e){c=e.ListItem},function(e){m=e.RedPointType},function(e){h=e.RedPointMgr},function(e){v=e.default},function(e){l=e.default},function(e){u=e.default},null,function(e){f=e.default},function(e){g=e.default},function(e){C=e.ActivityEventDefine,p=e.ActivityType},function(e){y=e.default},function(e){T=e.CardItemList},function(e){I=e.BaseView}],execute:function(){i._RF.push({},"3aa36QydUZOo4dbcQ6Ovn81","ActivityLoopyCardMsgView",void 0);e("default",function(e){function i(){var t;return(t=e.call(this)||this).imgTitle=void 0,t.scrollView=void 0,t.curIndex=void 0,t.tabList=void 0,t.cardItemList=[],t.name="ActivityLoopyCardMsgView",t.url="ui/module/activityLoopy/ActivityLoopyCardMsgView",t}t(i,e);var o=i.prototype;return o.onInit=function(){var e=this,t=this.findChild("btnClose");this.addComponentCallbackListener(t,n.EventType.CLICK,(function(){e.close()})),this.imgTitle=this.findChildComponent("bg/imgTitle",s),this.tabList=[];for(var i=function(t){e.findChild("container/select/item"+(t+1));var i={itemGo:e.findChild("container/select/item"+(t+1)),select:e.findChild("container/select/item"+(t+1)+"/select")};e.addRedPoint("ActivityLoopyCardMsgCheck_"+t,i.itemGo,new d(45,20),m.Dot),IS(h).updateRed("ActivityLoopyCardMsgCheck_"+t),e.addComponentCallbackListener(i.itemGo,n.EventType.CLICK,(function(){e.RefreshSelectItem(t)})),e.tabList[t]=i},o=0;o<2;o++)i(o);this.scrollView=this.addUIList(this.findChildComponent("container/list",r),L)},o.InitCardList=function(){for(var e=0;e<T.length;e++){var t=configGoods.getDataByKey(T[e]);this.findChildComponent("view/card/card"+(e+1)+"/name",s).string=t.name;var i={id:T[e],num:this.findChildComponent("view/card/card"+(e+1)+"/num",s)};this.cardItemList.push(i)}},o.registerUpdateHandler=function(){this.addEvent(C.OnActivityCollectInfo,this.updateInfo,this)},o.RefreshSelectItem=function(e){if(this.curIndex!=e){for(var t=0;t<this.tabList.length;t++)this.tabList[t].select.active=e==t;this.curIndex=e,this.imgTitle.string=0==e?GetLanguage_UI(100871):GetLanguage_UI(100872),IS(y).CheckNewMsgRed(this.curIndex),this.scrollView.scrollTo(0,.1),this.updateInfo()}},o.onAfterOpen=function(){var e;this.curIndex=null,this.RefreshSelectItem(null!=(e=this.openArgs[0])?e:0)},o.onBeforeClose=function(){IS(y).CheckNewMsgRed(this.curIndex)},o.onDestroy=function(){},o.updateInfo=function(){var e=IS(g).getCollectInfo(p.LoopyCard),t=0==this.curIndex?e.recv_list:e.send_list;t.sort((function(e,t){return e.status,t.status,e.start_time,t.start_time,e.start_time,t.start_time,e.id,t.id,e.id,t.id,e>t?-1:1})),this.scrollView.datas=t},i}(I));var L=function(e){function i(){for(var t,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return(t=e.call.apply(e,[this].concat(n))||this).name=void 0,t.time=void 0,t.des=void 0,t.failed=void 0,t.received=void 0,t.btnGet=void 0,t.imgHeadFrame=void 0,t.headImg=void 0,t.specHead=void 0,t.timeCount=void 0,t.receviveTime=void 0,t.desPre=void 0,t.timer=void 0,t}t(i,e);var r=i.prototype;return r.onInit=function(){var e=this;this.name=v.findChildComponent(this.node,"name",s),this.time=v.findChildComponent(this.node,"time",s),this.desPre=v.findChildComponent(this.node,"des",s),this.des=v.findChildComponent(this.node,"des/num",s),this.received=v.findChild(this.node,"received"),this.btnGet=v.findChild(this.node,"btnGet"),this.view.addComponentCallbackListener(this.btnGet,n.EventType.CLICK,(function(){IS(f).send_collect_recv(p.LoopyCard,e.data.id)})),this.imgHeadFrame=v.findChildComponent(this.node,"head/imgHeadFrame",o),this.specHead=v.findChild(this.node,"head/gmChat"),this.headImg=v.findChildComponent(this.node,"head/image",o),this.timeCount=v.findChildComponent(this.node,"timeCount",s),this.receviveTime=v.findChildComponent(this.node,"receviveTime",s)},r.onRender=function(e,t){var i=this;if(e.role_id>0){this.name.string=e.name,this.specHead.active=!1,this.view.loadRemoteIcon(e.head.url,this.headImg),this.headImg.node.active=!0;var n=e.head.frame_id;if(n>0){this.imgHeadFrame.node.active=!0;var s=configAvatar_frame.getDataByKey(n);this.view.loadIcon(this.imgHeadFrame,"icon_frame",s.icon)}else this.imgHeadFrame.node.active=!1}else this.name.string="",this.specHead.active=!0,this.imgHeadFrame.node.active=!1,this.headImg.node.active=!1;var r=this.view.curIndex,o=u.ServerDate(1e3*e.start_time);this.time.string=a.formatStr("%s.%s.%s %s:%s:%s",o.getFullYear(),o.getMonth()+1,o.getDate(),o.getHours(),o.getMinutes(),o.getSeconds());var d=configGoods.getDataByKey(e.card_id);this.des.string=a.formatStr("【%s】x1",d.name),this.timer&&(this.view.removeTimer(this.timer),this.timer=null),0==r?(this.receviveTime.string="",this.desPre.string=GetLanguage(200782),this.received.active=1==e.status,this.btnGet.active=0==e.status,e.end_time-u.serverTime>0&&0==e.status?(this.timeCount.string=u.formatTimeStringForSecond(e.end_time-u.serverTime),this.timer=this.view.addTimer(1,e.end_time-u.serverTime,(function(){e.end_time-u.serverTime>0?i.timeCount.string=u.formatTimeStringForSecond(e.end_time-u.serverTime):(i.timeCount.string="",i.view.removeTimer(i.timer),i.timer=null)}))):(this.btnGet.active=!1,0==e.status||2==e.status?this.receviveTime.string=GetLanguage(200781):this.receviveTime.string="",this.timeCount.string="")):(this.timeCount.string="",0==e.role_id?this.desPre.string=GetLanguage(200784):this.desPre.string=GetLanguage(200783),this.received.active=1==e.status,this.btnGet.active=!1,e.end_time-u.serverTime>0&&0==e.status?(this.receviveTime.string=l.formatStrWithMirrorDeal(GetLanguage(200785),u.formatTimeStringForSecond(e.end_time-u.serverTime)),this.timer=this.view.addTimer(1,e.end_time-u.serverTime,(function(){e.end_time-u.serverTime>0?i.receviveTime.string=l.formatStrWithMirrorDeal(GetLanguage(200785),u.formatTimeStringForSecond(e.end_time-u.serverTime)):(i.receviveTime.string=GetLanguage(200786),i.view.removeTimer(i.timer),i.timer=null)}))):0==e.status||2==e.status?this.receviveTime.string=GetLanguage(200786):this.receviveTime.string="")},r.destroy=function(){this.timer&&(this.view.removeTimer(this.timer),this.timer=null)},r.cacheReset=function(){this.timer&&(this.view.removeTimer(this.timer),this.timer=null),e.prototype.cacheReset.call(this)},i}(c);i._RF.pop()}}}));

