System.register("chunks:///_virtual/ActivityArtifactView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./V2.ts","./AudioMgr.ts","./index3.ts","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./StorageUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./ConfigGlobal.ts","./BagDefine.ts","./BagModel.ts","./MessageView.ts","./MallDefine.ts","./PayDataCache.ts","./PayDefine.ts","./RoleDefine.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./HorseCarnivalControl.ts","./HorseCarnivalDataCache.ts","./BaseView.ts","./EaseMethod.ts"],(function(t){"use strict";var i,e,n,o,s,r,a,d,c,h,l,f,u,p,m,v,g,w,C,y,T,I,L,_,S,k,G,A,b,R,x,V,M,D,E,B,O,N;return{setters:[function(t){i=t.inheritsLoose,e=t.createForOfIteratorHelperLoose},function(t){n=t.cclegacy,o=t.Button,s=t.sys,r=t.HorizontalTextAlignment,a=t.Label,d=t.ScrollView,c=t.Sprite,h=t.RichText,l=t.Toggle,f=t.Layout,u=t.js},function(t){p=t.V2},function(t){m=t.audioMgr},null,function(t){v=t.ItemGrid},function(t){g=t.ListItem},function(t){w=t.default},function(t){C=t.default},function(t){y=t.default},function(t){T=t.default},null,function(t){I=t.ConfigGlobal},function(t){L=t.BagEventDefine},function(t){_=t.BagModel},function(t){S=t.default},function(t){k=t.MallType},function(t){G=t.default},function(t){A=t.GiftType},function(t){b=t.RoleEventDefine},function(t){R=t.default},function(t){x=t.ActivityEventDefine,V=t.ActivityType,M=t.ActivityState},function(t){D=t.default},function(t){E=t.HorseCarnivalDataCache},function(t){B=t.ViewEvent,O=t.BaseView},function(t){N=t.EasingMethod}],execute:function(){n._RF.push({},"fd791QOoIhK2aJZ2kGS4S1S","ActivityArtifactView",void 0);t("default",function(t){function n(){var i;return(i=t.call(this)||this).actType=void 0,i.nodeResParent=void 0,i.nodeResItem=void 0,i.nodeRolling=void 0,i.resItems=void 0,i.btnTask=void 0,i.btnGift=void 0,i.btnStore=void 0,i.taskRed=void 0,i.togSkip=void 0,i.skipAnim=void 0,i.iconTen=void 0,i.iconOne=void 0,i.txtOne=void 0,i.txtTen=void 0,i.txtNumReward=void 0,i.numScroll=void 0,i.tipsGo=void 0,i.tipsScroll=void 0,i.curTips=0,i.tipsTimer=0,i.txtLeftTime=void 0,i.deltaTime=0,i.leftTime=0,i.canUpdate=!1,i.curIndex=0,i.finalIndex=0,i.reward_list=[],i.waitRewardList=[],i.jackpot=0,i.actionTime=2,i.moveTween=void 0,i.rerwardList=[],i.rewardNum=15,i.name="ActivityArtifactView",i.url="ui/module/activity/ActivityArtifactView",i.poolTime=3e3,i.fullScreen=!0,i.actType=V.Artifact,i}i(n,t);var v=n.prototype;return v.onInit=function(){var t=this;this.initResShow(),this.findChild("root/turn/img/nodeTips").active=!1;var i=this.findChild("root/btnClose");this.addComponentCallbackListener(i,o.EventType.CLICK,(function(){t.close()}));var e=this.findChild("root/top/nodeTime/btnTips");this.addComponentCallbackListener(e,o.EventType.CLICK,(function(){for(var i=I.LIMITED_RANK_SYSTEM_DETAILS,e="",n=0;n<i.length;n++)i[n][0]==t.actType&&(e=GetLanguage(i[n][1]));""!=e&&S.showBoxTip({tip:e,btnCnt:1,horizontalAlign:s.uiMirror?r.RIGHT:r.LEFT})})),this.btnStore=this.findChild("root/bottomBtn/btnStore"),this.addComponentCallbackListener(this.btnStore,o.EventType.CLICK,(function(){uiMgr.openView("HorseCarnivalStoreView",t.actType)})),this.btnTask=this.findChild("root/bottomBtn/btnTask"),this.taskRed=this.findChild("root/bottomBtn/btnTask/red"),this.addComponentCallbackListener(this.btnTask,o.EventType.CLICK,(function(){uiMgr.openView("ActivityArtifactTaskView",t.actType)})),this.btnGift=this.findChild("root/bottomBtn/btnGift"),this.addComponentCallbackListener(this.btnGift,o.EventType.CLICK,(function(){uiMgr.openView("ActivityArtifactGiftView",t.actType)}));var n=this.findChild("root/turn/btnShow/btnShow");this.addComponentCallbackListener(n,o.EventType.CLICK,(function(){uiMgr.openView("HorseCarnivalTipsView",n,t.actType)}));var f=this.findChild("root/turn/img/nodeTips2/tips");this.addComponentCallbackListener(f,o.EventType.CLICK,(function(){uiMgr.openView("CommonPopTipsView",GetLanguage(400204),f)})),this.nodeRolling=this.findChild("root/turn/img/nodeRolling"),this.txtLeftTime=this.findChildComponent("root/top/nodeTime/txtTime",a),this.txtNumReward=this.findChildComponent("root/numReward/num",a);var u=this.findChildComponent("root/numReward/ScrollView",d);this.numScroll=this.addUIList(u,K),this.tipsGo=this.findChild("root/top/tips");var p=this.findChildComponent("root/top/tips/ScrollView",d);this.tipsScroll=this.addUIList(p,U),this.iconOne=this.findChildComponent("root/btnOne/icon",c),this.iconTen=this.findChildComponent("root/btnTen/icon",c),this.txtOne=this.findChildComponent("root/btnOne/num",h),this.txtTen=this.findChildComponent("root/btnTen/num",h);var m=this.findChild("root/btnOne");this.addComponentCallbackListener(m,o.EventType.CLICK,(function(){t.onLottery(1)}));var v=this.findChild("root/btnTen");this.addComponentCallbackListener(v,o.EventType.CLICK,(function(){t.onLottery(2)})),this.togSkip=this.findChildComponent("root/turn/toggleSkip",l),this.addComponentCallbackListener(this.togSkip.node,l.EventType.TOGGLE,(function(){t.togSkip.isChecked?C.set("SkipAAAnim",1):C.set("SkipAAAnim",0)}));var g=this.findChildComponent("root/turn/toggleSkip/Checkmark",c);this.loadIcon(g,"zqkh","zqkh_ui_gouxuan01"),this.skipAnim=this.findChild("skipAnim"),this.addComponentCallbackListener(this.skipAnim,o.EventType.CLICK,(function(){t.SkipAnim()}));for(var y=function(){var i=t.findChild("root/turn/itemRoll/itemGrid"+T),e={node:i,index:T,item_id:0,cfg_id:0,imgFram:w.findChildComponent(i,"imgFrame",c),imgIcon:w.findChildComponent(i,"imgIcon",c),num:w.findChildComponent(i,"num",a),select:w.findChild(i,"select"),light:w.findChild(i,"light"),limit:w.findChild(i,"nodeLimit")};t.addComponentCallbackListener(i,o.EventType.CLICK,(function(){0!=e.item_id&&IS(_).OpenItemTips(e.item_id,i)})),t.rerwardList.push(e)},T=0;T<this.rewardNum;T++)y();this.dealAllLimitLayout(),s.uiMirror&&this.findChild("root/turn/img/spine").setScale(-1,1,1)},v.dealAllLimitLayout=function(){if(s.uiMirror)for(var t=this.node.getComponentsInChildren(f),i=0;i<t.length;i++)1==t[i].type&&"nodeLimit"==t[i].node.name&&this.dealMirrorLayout(t[i])},v.initResShow=function(){this.nodeResParent=this.findChild("resRoot"),this.nodeResItem=this.findChild("resRoot/resItem"),this.nodeResItem.active=!1;var t=[IS(E).GetCost(this.actType)[0]];this.resItems=new Array;for(var i=0;i<t.length;i++){var e=nodeInstantiate.instantiate(this.nodeResItem),n=t[i];this.addComponentCallbackListener(e,o.EventType.CLICK,(function(){})),e.parent=this.nodeResParent,e.active=!0;var s=w.findChildComponent(e,"imgIcon",c),r=configGoods.getDataByKey(n);this.loadIcon(s,"icon_item",r.icon),this.resItems.push({node:e,txtNum:w.findChildComponent(e,"txtNum",a),goodsGtid:n})}},v.registerUpdateHandler=function(){this.addEvent(x.OnHorseCarnivalUpdate,this.updateInfo,this),this.addEvent(x.OnHorseCarnivalReward,this.updateReward,this),this.addEvent(x.OnHorseCarnivalLottery,this.updateLotteryResult,this),this.addEvent(L.GOODS_INFO_UPDATE,this.updateResShow,this),this.addEvent(b.ROLE_RES_UPDATE,this.updateResShow,this),this.addEvent(x.OnActivityInfoTaskUpdate,this.OnTaskUpdate,this),this.addEvent(x.OnActivityInfoUpdate,this.OnTaskUpdate,this),this.addEvent(B.ViewClose,this.onViewClose,this)},v.onAfterOpen=function(){var t,i,e=IS(R).GetActivityInfo(this.actType);e||(this.actType=V.Artifact1,e=IS(R).GetActivityInfo(this.actType)),this.updateResShow(),IS(D).send_24_16(this.actType),this.togSkip.isChecked=1==C.get("SkipAAAnim"),this.skipAnim.active=!1,this.nodeRolling.active=!1,e.roundCfg.task_list.length>0?(this.btnTask.active=!0,this.taskRed.active=IS(R).GetTaskRedNum(e.type)>0):this.btnTask.active=!1,IS(G).GetAcivityGift(A.Activity,e.type,e.round).length>0?this.btnGift.active=!0:this.btnGift.active=!1;var n=null!=(t=configMall.getDataByList("type",k.Activity))?t:[],o=[];for(var s in n)if(n.hasOwnProperty(s)){var r=n[s];r.condition.length>0&&"activity_group"==r.condition[0][0]&&r.condition[0][1]==e.type&&r.condition[0][2]==e.roundCfg.group_id&&o.push(r)}o.length>0?this.btnStore.active=!0:this.btnStore.active=!1;var a=null!=(i=e.state_time[e.state])?i:e.state_time[M.Open];this.leftTime=a.end_time-T.serverTime,this.leftTime>0?(this.canUpdate=!0,this.txtLeftTime.string=T.formatTimeStringForSecond(this.leftTime)):this.txtLeftTime.string=GetLanguage(200026);var d=IS(E).GetCost(this.actType),c=configGoods.getDataByKey(d[0]);this.loadIcon(this.iconOne,c.icon_group,c.icon),this.loadIcon(this.iconTen,c.icon_group,c.icon);var h=configMount_draw_cumulative_times.getDatas(),l=[];for(var f in h)if(h.hasOwnProperty(f)){var u=h[f];u.type==e.type&&u.group_id==e.roundCfg.group_id&&l.push(u)}this.numScroll.datas=l;var m=configMount_draw.getDatas(),v=[];for(var g in m)if(m.hasOwnProperty(g)){var w=m[g];if(w.type==e.type&&w.group_id==e.roundCfg.group_id&&(v.push(w),1==w.is_jackpot)){var y=new p(w.pos[0][0],w.pos[0][1]),I=w.scale;this.addUIEffect(w.show_picture,this.findChild("root/turn/img/spine"),-1,y,I)}}v.sort((function(t,i){return t.id-i.id}));for(var L=0;L<v.length;L++){var _=v[L],S=this.rerwardList[_.order-1];if(S.item_id=_.reward[0],S.num.string=_.reward[1],S.cfg_id=_.id,0!=S.index){var b=configGoods.getDataByKey(S.item_id);this.loadIcon(S.imgIcon,b.icon_group,b.icon);var x=configColor.getDataByKey(b.quality);this.loadIcon(S.imgFram,"icon_equip",x.path)}else{var B=configGoods.getDataByKey(S.item_id),O=configColor.getDataByKey(B.quality);if(this.loadIcon(S.imgFram,"icon_equip",O.big_path),1==_.is_jackpot){var N=new p(_.pos[1][0],_.pos[1][1]),K=.5*_.scale;this.addUIEffect(_.show_picture,S.imgFram.node,-1,N,K)}}S.limit&&(S.limit.active=!1),S.select.active=!1,S.light.active=!1}},v.onBeforeClose=function(){this.canUpdate=!1,this.curIndex=0,this.tipsTimer=0;for(var t=0;t<this.rerwardList.length;t++)this.rerwardList[t].select.active=!1,this.rerwardList[t].light.active=!1;this.jackpot=0,this.waitRewardList=[]},v.onDestroy=function(){for(var t=0;t<this.resItems.length;t++)this.resItems[t].node.destroy();this.resItems={}},v.onUpdate=function(t){this.canUpdate&&(this.deltaTime=this.deltaTime+t,this.deltaTime>=1&&(this.deltaTime=0,this.leftTime=this.leftTime-1,this.leftTime>0?this.txtLeftTime.string=T.formatTimeStringForSecond(this.leftTime):(this.txtLeftTime.string=GetLanguage(200026),this.canUpdate=!1)))},v.updateResShow=function(){for(var t=0;t<this.resItems.length;t++)this.resItems[t].txtNum.string=y.GetNumString(IS(_).getGoodsCountByGoodsGtid(this.resItems[t].goodsGtid));var i,e,n=IS(E).GetCost(this.actType),o=IS(_).getGoodsCountByGoodsGtid(n[0]);o>=n[1]?(e="#5aff42",i="#27720d"):(e="#ff1f1f",i="#891000"),this.txtOne.string=u.formatStr("<b><outline color=%s width=2><color=%s>%s<color></outline></b>",i,e,n[1]),o>=10*n[1]?(e="#5aff42",i="#27720d"):(e="#ff1f1f",i="#891000"),this.txtTen.string=u.formatStr("<b><outline color=%s width=2><color=%s>%s<color></outline></b>",i,e,10*n[1])},v.OnTaskUpdate=function(){this.taskRed.active=IS(R).GetTaskRedNum(this.actType)>0},v.updateInfo=function(){var t=this,i=IS(E).getInfo(this.actType);if(this.tipsGo.active=i.lucky_list.length>0,0!=this.tipsTimer&&this.removeTimer(this.tipsTimer),this.tipsGo.active){var e=i.lucky_list[0],n=i.lucky_list.concat(e);this.tipsScroll.datas=n,this.curTips=0,this.tipsTimer=this.addTimer(2,-1,(function(){t.curTips=t.curTips+1,t.curTips==n.length&&(t.curTips=0);var i=0==t.curTips?0:2;t.tipsScroll.scrollTo(t.curTips,i)}))}this.updateReward()},v.updateReward=function(){var t,i=IS(E).getInfo(this.actType);this.txtNumReward.string=i.count+"",this.numScroll.updateAll();var n=null!=(t=i.guaranteed_list[this.rerwardList[0].cfg_id])?t:0,o=this.findChildComponent("root/turn/img/nodeTips2/jackPotNum",h);if(n>0){o.node.active=!0;var s=u.formatStr("<b><outline color=#5C2E1A width=2><color=#FFF8C6>%s</color></outline></b>",GetLanguage(400202));o.string=y.formatStr(s,u.formatStr("<b><outline color=#943B30 width=2><color=#FFF71E>%s</color></outline></b>",n))}else o.node.active=!1;if(this.findChildComponent("root/turn/img/nodeTips/drawNum",a).string=y.formatStr(GetLanguage_UI(899000013),IS(E).getInfo(this.actType).remain_draw),this.actType==V.Artifact1){this.findChild("root/turn/img/nodeTips").active=!0;for(var r,d=e(this.rerwardList);!(r=d()).done;){var c=r.value,l=configMount_draw.getDataByKey(c.cfg_id);if(l&&c.limit){c.limit.active=!0;var f=IS(E).getInfo(this.actType),p=w.findChildComponent(c.limit,"Node",a);if(p.string=GetLanguage(300160)+""+l.num,f.get_drop.length>0)for(var m,v=e(f.get_drop);!(m=v()).done;){var g=m.value,C=g.k,T=g.v;C==c.cfg_id&&(p.string=GetLanguage(300160)+""+(l.num-T))}}}this.dealAllLimitLayoutLabels()}},v.dealAllLimitLayoutLabels=function(){if(s.uiMirror)for(var t=this.node.getComponentsInChildren(f),i=0;i<t.length;i++)1==t[i].type&&"nodeLimit"==t[i].node.name&&this.refreshTxtMirrorByLayout(t[i])},v.onLottery=function(t){var i=IS(E).GetCost(this.actType),e=i[0],n=i[1];2==t&&(n*=10),IS(_).getGoodsCountByGoodsGtid(e)>=n?IS(D).send_24_17(this.actType,t):this.btnGift.active&&uiMgr.openView("ActivityArtifactGiftView",this.actType)},v.updateLotteryResult=function(t){var i=this;if(t.act_type==this.actType)if(this.nodeRolling.active=!0,this.checkJackpot(t.drop_id_list),this.togSkip.isChecked)0!=this.jackpot?(uiMgr.openView("ArtifactGetView",configGoods.getDataByKey(this.jackpot).effect[0],!0),this.waitRewardList=t.reward_list,this.jackpot=0):uiMgr.openView("GoodsGetView",t.reward_list);else{var e=t.drop_id_list[t.drop_id_list.length-1];this.finalIndex=configMount_draw.getDataByKey(e).order-1,this.reward_list=t.reward_list,this.skipAnim.active=!0,1==t.drop_id_list.length?this.doLotteryTween(this.finalIndex,(function(){for(var e=0;e<i.rerwardList.length;e++)i.rerwardList[e].select.active=!1,i.rerwardList[e].light.active=!1;i.rerwardList[i.finalIndex].select.active=!0,i.rerwardList[i.finalIndex].light.active=!0,i.curIndex=i.finalIndex,0!=i.jackpot?(uiMgr.openView("ArtifactGetView",configGoods.getDataByKey(i.jackpot).effect[0],!0),i.waitRewardList=t.reward_list,i.jackpot=0):uiMgr.openView("GoodsGetView",t.reward_list),i.skipAnim.active=!1,i.nodeRolling.active=!1})):this.lotteryNext(0,t)}},v.lotteryNext=function(t,i){var e,n=this,o=configMount_draw.getDataByKey(i.drop_id_list[t]).order-1;e=t<i.drop_id_list.length-1?function(){n.curIndex=o,n.lotteryNext(t+1,i)}:function(){for(var t=0;t<n.rerwardList.length;t++)n.rerwardList[t].select.active=!1,n.rerwardList[t].light.active=!1;n.rerwardList[o].select.active=!0,n.rerwardList[o].light.active=!0,n.curIndex=o,0!=n.jackpot?(uiMgr.openView("ArtifactGetView",configGoods.getDataByKey(n.jackpot).effect[0],!0),n.waitRewardList=i.reward_list,n.jackpot=0):uiMgr.openView("GoodsGetView",i.reward_list),n.skipAnim.active=!1,n.nodeRolling.active=!1},this.doLotteryTween(o,e)},v.doLotteryTween=function(t,i){var e=this;null!=this.moveTween&&this.moveTween.stop(),m.playSound("common_guguji");var n=4*this.rewardNum+t-this.curIndex;this.moveTween=this.addTween(0,1,this.actionTime,(function(t,i){for(var o=n*i,s=Math.floor((o+e.curIndex)%e.rewardNum),r=0;r<e.rerwardList.length;r++)e.rerwardList[r].select.active=!1,e.rerwardList[r].light.active=!1;e.rerwardList[s].select.active=!0})).easing(N.SINE_OUT).call((function(){i()}),.5).start()},v.SkipAnim=function(){null!=this.moveTween&&this.moveTween.stop();for(var t=0;t<this.rerwardList.length;t++)this.rerwardList[t].select.active=!1,this.rerwardList[t].light.active=!1;this.rerwardList[this.finalIndex].select.active=!0,this.rerwardList[this.finalIndex].light.active=!0,this.curIndex=this.finalIndex,0!=this.jackpot?(uiMgr.openView("ArtifactGetView",configGoods.getDataByKey(this.jackpot).effect[0],!0),this.waitRewardList=this.reward_list,this.jackpot=0):uiMgr.openView("GoodsGetView",this.reward_list),this.skipAnim.active=!1,this.nodeRolling.active=!1},v.checkJackpot=function(t){this.jackpot=0;for(var i,n=e(t);!(i=n()).done;){var o=i.value,s=configMount_draw.getDataByKey(o);if(1==s.is_jackpot)return this.jackpot=s.reward[0],!0}return!1},v.onViewClose=function(t){"ArtifactGetView"==t&&this.waitRewardList.length>0&&(uiMgr.openView("GoodsGetView",this.waitRewardList),this.waitRewardList=[])},n}(O));var K=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(i=t.call.apply(t,[this].concat(n))||this).txtDesc=void 0,i.itemGridNode=void 0,i.itemGrid=void 0,i.isReward=void 0,i.eff=void 0,i.effNode=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){var t=this;this.txtDesc=w.findChildComponent(this.node,"desc",h),this.effNode=w.findChild(this.node,"eff"),this.itemGridNode=w.findChild(this.node,"itemGrid"),this.itemGrid=new v(this.view,this.itemGridNode,(function(){var i=IS(E).getInfo(t.view.actType);!t.isReward&&i.count>=t.data.cumulative_times?IS(D).send_24_18(t.view.actType,t.data.id):IS(_).OpenItemTips(t.data.reward[0],t.itemGridNode)}))},n.onRender=function(t,i){this.itemGrid.SetItemId(t.reward[0],t.reward[1]);var e=IS(E).getInfo(this.view.actType);this.isReward=e.gotReward[t.id],this.view.removeUIEffect(this.eff),this.isReward?this.txtDesc.string=y.formatStrWithMirrorDeal(GetLanguage(200033)):e.count>=t.cumulative_times?(this.txtDesc.string=y.formatStrWithMirrorDeal(GetLanguage(200034)),this.eff=this.view.addUIEffect("prefab/ui-effect/MX_tx_tongyong_daojulingqu",this.effNode,-1)):this.txtDesc.string=u.formatStr("<b><color=#ff1c1c>%s</color><color=#80342e>/%s</color></b>",e.count,t.cumulative_times)},e}(g),U=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(i=t.call.apply(t,[this].concat(n))||this).txt=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){this.txt=w.findChildComponent(this.node,"txt",h),this.adaptiveSize=!0},n.onRender=function(t,i){var e,n=null==(e=configGoods.getDataByKey(t.k))?void 0:e.name;this.txt.string=y.formatStrWithMirrorDeal(GetLanguage(200050),t.s,n)},e}(g);n._RF.pop()}}}));

