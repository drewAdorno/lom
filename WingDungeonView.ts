System.register("chunks:///_virtual/WingDungeonView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./V2.ts","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./ConfigGlobal.ts","./ChapterDataCache.ts","./ChapterDefine.ts","./DungeonControl.ts","./MessageView.ts","./PrivilegeDataCache.ts","./PrivilegeDefine.ts","./BaseView.ts"],(function(t){"use strict";var e,i,n,a,s,r,o,l,d,h,f,c,v,u,g,p,C,m,w,b,L,I,x,_,R,y;return{setters:[function(t){e=t.inheritsLoose,i=t.createForOfIteratorHelperLoose},function(t){n=t.cclegacy,a=t.Button,s=t.HorizontalTextAlignment,r=t.js,o=t.Sprite,l=t.RichText,d=t.Label,h=t.ScrollView,f=t.sys},function(t){c=t.V2},function(t){v=t.ItemGrid},function(t){u=t.ListItem},function(t){g=t.default},function(t){p=t.default},function(t){C=t.default},null,function(t){m=t.ConfigGlobal},function(t){w=t.ChapterDataCache},function(t){b=t.DungeonDefine,L=t.ChapterEventDefine},function(t){I=t.default},function(t){x=t.default},function(t){_=t.PrivilegeDataCache},function(t){R=t.PrivilegeEventDefine},function(t){y=t.BaseView}],execute:function(){var D;n._RF.push({},"ce2ab2HXRpKYohp+uYTEnvL","WingDungeonView",void 0);var G=2,T=3,M=((D={})[1]=b.CHAPTER_TYPE_DARK_TRIAL,D[G]=b.CHAPTER_TYPE_DARK_TRIAL_2,D[T]=b.CHAPTER_TYPE_DARK_TRIAL_3,D),S=(t("default",function(t){function n(){var e;return(e=t.call(this)||this).txtTitle=void 0,e.txtRecord=void 0,e.txtTips=void 0,e.stars=[],e.nodeReward=void 0,e.nodeLimit=void 0,e.firstReward=void 0,e.normalReward=void 0,e.btnFight=void 0,e.btnFast=void 0,e.btnReset=void 0,e.txtReset=void 0,e.extReward=void 0,e.curIndex=0,e.tabBtns=[],e.info=void 0,e.lastMaxLevel=0,e.fastLevel=0,e.nodeModel=void 0,e.model=void 0,e.name="WingDungeonView",e.url="ui/module/wing/WingDungeonView",e}e(n,t);var v=n.prototype;return v.onInit=function(){var t=this,e=this.findChild("btnClose");this.addComponentCallbackListener(e,a.EventType.CLICK,(function(){t.close()}));var n=this.findChild("view/btnAttr");this.addComponentCallbackListener(n,a.EventType.CLICK,(function(){t.info&&uiMgr.openView("WingDungeonBossView",t.info)}));var f=this.findChild("view/tips/btnTips");this.addComponentCallbackListener(f,a.EventType.CLICK,(function(){var t=GetLanguage(201852);x.showBoxTip({tip:t,btnCnt:1,horizontalAlign:s.LEFT})})),this.btnFight=this.findChild("view/btns/btnFight"),this.addComponentCallbackListener(this.btnFight,a.EventType.CLICK,(function(){if(t.info){var e=configDark_trial_chapter.getDatas().find((function(e){return e.part_type==t.info.type&&e.level==t.info.cur_level})),n=C.serverOpenTime,a=C.ServerDate(1e3*n),s=r.formatStr("%s/%s/%s %s:%s:%s",a.getFullYear(),a.getMonth()+1,a.getDate(),0,0,0),o=C.getServerDateByLocalStr(s).getTime()/1e3,l=C.serverTime-o,d=Math.floor(l/86400+1);if(d<e.time_limit)x.showFlyTip(GetLanguage(200279));else{for(var h,f=i(e.difficulty_adjust);!(h=f()).done;){var c=h.value;if(c[0]==d){for(var v,u=c[1],g=void 0,m=i(u);!(v=m()).done;){var w=v.value;1001==w[0]&&(g=w[1])}var b=p.formatStrWithMirrorDeal(GetLanguage(200280),g/100);return void x.showBoxTip({tip:b,title:GetLanguage(200048),ensure:GetLanguage(200053),cancel:GetLanguage(200054),func:function(i){"type_yes"==i&&(uiMgr.closeAllView(["MainView","MessageView","GuideView","BattleHubView"]),IS(I).reqDungeonBattleStart(t.info.type,t.info.cur_level),battleMain.enterChapter(e.bossModel))}})}}uiMgr.closeAllView(["MainView","MessageView","GuideView","BattleHubView"]),IS(I).reqDungeonBattleStart(t.info.type,t.info.cur_level),battleMain.enterChapter(e.bossModel)}}})),this.btnFast=this.findChild("view/btns/btnFast"),this.addComponentCallbackListener(this.btnFast,a.EventType.CLICK,(function(){t.info&&uiMgr.openView("WingDungeonFastView",t.info,t.fastLevel)})),this.btnReset=this.findChildComponent("view/btns/btnReset",o),this.txtReset=this.findChildComponent("view/btns/btnReset/Label",l),this.addComponentCallbackListener(this.btnReset.node,a.EventType.CLICK,(function(){if(t.info){var e=0,n=IS(_).getPrivilegeCardInfo(5);n&&e++,IS(_).getPrivilegeCardInfo(2)&&e++;for(var a,s=0,r=i(t.info.ext);!(a=r()).done;){var o=a.value,l=o.k,d=o.v;11==l&&(s=d)}if((s=e-s)>0)x.showBoxTip({tip:GetLanguage(201965),func:function(e){"type_yes"==e&&IS(I).reqWingReset(t.info.type)}});else{if(!n)return void uiMgr.openView("WingDungeonTipsView");x.showFlyTip(GetLanguage(201966))}}}));for(var c=function(e){var i=t.findChild(r.formatStr("tab/scrollTab/view/content/item%s",e)),n={itemGo:i,normalGo:g.findChild(i,"normal"),selectedGo:g.findChild(i,"selected"),index:e};t.addComponentCallbackListener(i,a.EventType.CLICK,(function(){t.setIndex(n.index)})),t.tabBtns[e]=n},v=1;v<=3;v++)c(v);this.txtTitle=this.findChildComponent("view/title/Label",d),this.txtRecord=this.findChildComponent("view/record/Label",d),this.txtTips=this.findChildComponent("view/tips/Label",d);for(var u=1;u<=5;u++)this.stars[u]=this.findChild("view/stars/star"+u+"/light");this.nodeModel=this.findChild("view/model"),this.nodeReward=this.findChild("view/reward"),this.nodeLimit=this.findChild("view/limit"),this.extReward=this.findChild("view/reward/normal/ext");var m=g.findChildComponent(this.node,"view/reward/first/rewardScroll",h);this.firstReward=this.addUIList(m,S),this.firstReward.lackCenter=!0;var w=g.findChildComponent(this.node,"view/reward/normal/rewardScroll",h);this.normalReward=this.addUIList(w,S),this.normalReward.lackCenter=!0},v.registerUpdateHandler=function(){this.addEvent(L.DUNGEON_UPDATE,this.updateInfo,this),this.addEvent(R.PRIVILEGE_CARD_UPDATE,this.updateBtnReset,this)},v.onAfterOpen=function(){var t=this.openArgs[0];if(t){for(var e=1;e<=3;e++)this.tabBtns[e].itemGo.active=e==t;this.setIndex(t)}},v.onBeforeClose=function(){this.lastMaxLevel=0,this.fastLevel=0,this.curIndex>0&&(this.tabBtns[this.curIndex].normalGo.active=!0,this.tabBtns[this.curIndex].selectedGo.active=!1,this.curIndex=0)},v.onDestroy=function(){},v.setIndex=function(t){this.curIndex!=t&&(this.curIndex>0&&(this.tabBtns[this.curIndex].selectedGo.active=!1,this.tabBtns[this.curIndex].normalGo.active=!0),this.curIndex=t,this.tabBtns[this.curIndex].normalGo.active=!1,this.tabBtns[this.curIndex].selectedGo.active=!0,this.updateInfo())},v.updateInfo=function(){var t=this;if(0!=this.curIndex){var e=M[this.curIndex],n=IS(w).getDungeonInfoByID(e);if(n){this.info=n,this.updateBtnReset();var a=configDark_trial_chapter.getDatas(),s=a.find((function(t){return t.part_type==e&&t.level==n.cur_level})),o=configUnitModel.getDataByKey(s.bossModel);this.model&&this.removeUIEffect(this.model),this.model=this.addUIEffect(o.path,this.nodeModel,-1,new c(0,0),o.scale/100*2,(function(t){f.uiMirror&&(t.dir=-1)})),this.txtTitle.string=p.formatStrWithMirrorDeal(GetLanguage(201888),s.difficulty);for(var l=1;l<this.stars.length;l++){this.stars[l].active=s.star>=l}var d=a.find((function(t){return t.part_type==e&&t.level==n.max_level})),h=0;d&&d.star<5?h=d.difficulty-1:d&&d.star>=5&&(h=d.difficulty);var v,u=0==n.max_level?0:r.formatStr("%s-%s",d.difficulty,d.star);this.txtRecord.string=p.formatStrWithMirrorDeal(GetLanguage(201887),u);for(var g,C=i(n.ext);!(g=C()).done;){var b=g.value,L=b.k,I=b.v;6==L?this.lastMaxLevel=I:10==L&&(v=1==I)}var x=a.find((function(i){return i.part_type==e&&i.level==t.lastMaxLevel})),_=0;if(x&&x.star<5?_=x.difficulty-1:x&&x.star>=5&&(_=x.difficulty),_+=m.back_trial_chapter_difficulty_dailyunlock,_=Math.min(a[a.length-1].difficulty,_),this.txtTips.string=p.formatStrWithMirrorDeal(GetLanguage(201886),_),v)this.nodeLimit.active=!0,this.nodeReward.active=!1,this.btnFight.active=!1,this.btnFast.active=!1;else if(this.nodeLimit.active=!1,this.nodeReward.active=!0,this.firstReward.datas=s.first_reward,this.normalReward.datas=s.daily_reward,h>=3){this.fastLevel=d.level;var R=a.find((function(t){return t.part_type==e&&t.level==d.level+1}));R&&R.difficulty<=_&&(this.fastLevel=R.level),this.btnFight.active=n.cur_level>=this.fastLevel,this.btnFast.active=n.cur_level<this.fastLevel}else this.btnFight.active=!0,this.btnFast.active=!1}}},v.updateBtnReset=function(){this.btnReset.node.active=this.info.cur_level>1;var t=0,e=IS(_).getPrivilegeCardInfo(5),n=IS(_).getPrivilegeCardInfo(2);if(e&&t++,n&&t++,this.extReward.active=e,!(this.info.cur_level<=1)){for(var a,s=0,o=i(this.info.ext);!(a=o()).done;){var l=a.value,d=l.k,h=l.v;11==d&&(s=h)}if(s=t-s,e||n){this.btnReset.grayscale=0==s;var f=p.formatStrWithMirrorDeal(GetLanguage(201964),s,t);this.txtReset.string=r.formatStr("<b><outline color=#21294d width=2><color=#fbfbf9>%s</color></outline></b>",f)}else this.btnReset.grayscale=!0,this.txtReset.string=r.formatStr("<b><outline color=#564948 width=2><color=#fffd59>%s</color></outline></b>",GetLanguage(201963))}},n}(y)),function(t){function i(){for(var e,i=arguments.length,n=new Array(i),a=0;a<i;a++)n[a]=arguments[a];return(e=t.call.apply(t,[this].concat(n))||this).itemGridNode=void 0,e.itemGrid=void 0,e.isGet=void 0,e.mask=void 0,e}e(i,t);var n=i.prototype;return n.onInit=function(){this.itemGridNode=g.findChild(this.node,"itemGrid"),this.itemGrid=new v(this.view,this.itemGridNode),this.isGet=g.findChild(this.node,"isGet"),this.mask=g.findChild(this.node,"mask")},n.onRender=function(t,e){this.itemGrid.SetItemId(t[0],t[1]);var i=this.view.info;this.isGet&&(this.isGet.active=i&&i.max_level>=i.cur_level),this.mask&&(f.uiMirror&&this.view.loadIcon(this.mask.getComponent(o),"player","grxx_ui_gouxuan"),this.mask.active=i&&i.max_level>=i.cur_level)},i}(u));n._RF.pop()}}}));

