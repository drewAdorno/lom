System.register("chunks:///_virtual/ParkingShopView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UILabel.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./ResItems.ts","./MessageView.ts","./MallControl.ts","./MallDataCache.ts","./MallDefine.ts","./RoleDefine.ts","./BaseView.ts"],(function(t){"use strict";var i,e,n,o,s,r,a,h,d,l,u,f,c,m,v,g,p,I,y,L,w,T,C;return{setters:[function(t){i=t.inheritsLoose},function(t){e=t.cclegacy,n=t.ScrollView,o=t.UITransform,s=t.Label,r=t.Vec3,a=t.Button,h=t.sys},function(t){d=t.ItemGrid},function(t){l=t.UILabel},function(t){u=t.ListItem},function(t){f=t.default},function(t){c=t.default},function(t){m=t.default},null,function(t){v=t.ResItems},function(t){g=t.default},function(t){p=t.default},function(t){I=t.default},function(t){y=t.MallEventDefine,L=t.MallType},function(t){w=t.PlayerAttr,T=t.RoleEventDefine},function(t){C=t.BaseView}],execute:function(){var S;t("EOpenType",void 0),e._RF.push({},"cf000y13t5B3bW42u03LY4v","ParkingShopView",void 0),function(t){t[t.Skin=2]="Skin",t[t.Buff=1]="Buff",t[t.Guide=0]="Guide"}(S||(S=t("EOpenType",{})));t("default",function(t){function e(){var i;return(i=t.call(this)||this).itemList=void 0,i.resItems=void 0,i.limitInfo={},i.countTimer=void 0,i.name="ParkingShopView",i.url="ui/module/parking/ParkingShopView",i.poolTime=2e4,i}i(e,t);var o=e.prototype;return o.onInit=function(){this.resItems=new v(this,"content/resRoot"),this.resItems.init([{id:w.ROLE_PARKING_COIN,showAdd:!1}]);var t=this.findChildComponent("content/ScrollView",n);this.adjustMirrorNode(this.findChild("bgBottom"),0,!0),this.itemList=this.addUIList(t,B)},o.registerUpdateHandler=function(){this.addEvent(y.MAll_INFO_UPDATE,this.updateGoodsInfo,this),this.addEvent(y.MAll_LIMIT_INFO_UPDATE,this.updateGoodsLimitInfo,this),this.addEvent(T.ROLE_RES_UPDATE,this.onRoleResUpdate,this)},o.onAfterOpen=function(){this.onRoleResUpdate(),this.trySetParent(),IS(p).send_27_1(L.Parking),IS(p).send_27_3(L.Parking)},o.updateGoodsLimitInfo=function(t){var i,e=this;if(t==L.Parking){this.limitInfo=null!=(i=IS(I).GetLimitInfoByType(L.Parking))?i:{};var n=!1;for(var o in this.limitInfo)if(this.limitInfo.hasOwnProperty(o)){var s=this.limitInfo[o];if(s.et-m.serverTime>0&&s.st<m.serverTime){n=!0;break}}this.countTimer&&this.removeTimer(this.countTimer),n&&(this.countTimer=this.addTimer(1,-1,(function(){e.itemList.updateAll()}))),this.updateGoodsInfo(t)}},o.updateGoodsInfo=function(t){if(t==L.Parking){var i=[].concat(configMall.getDataByList("type",L.Parking)),e=[],n=[],o=[],s=[],r=[],a=[],h=IS(I).GetBuyInfoByType(L.Parking);for(var d in i)if(i.hasOwnProperty(d)){var l,u=i[d],f=null!=(l=h[u.id])?l:0,c=IS(I).getLimitInfoById(L.Parking,u.id);if(c&&(c.et<m.serverTime||c.st>m.serverTime))continue;8==u.goods_type&&(f<u.limit&&u.limit<0?e.push(u):s.push(u)),7==u.goods_type&&(f<u.limit&&u.limit<0?n.push(u):r.push(u)),6==u.goods_type&&(f<u.limit&&u.limit<0?o.push(u):a.push(u))}e.sort((function(t,i){return t.sort-i.sort})),n.sort((function(t,i){return t.sort-i.sort})),o.sort((function(t,i){return t.sort-i.sort})),s.sort((function(t,i){return t.sort-i.sort})),r.sort((function(t,i){return t.sort-i.sort})),a.sort((function(t,i){return t.sort-i.sort}));for(var v=0,g=s;v<g.length;v++){var p=g[v];e.push(p)}for(var y=0,w=r;y<w.length;y++){var T=w[y];n.push(T)}for(var C=0,S=a;C<S.length;C++){var B=S[C];o.push(B)}this.itemList.datas=[o,n,e]}},o.trySetParent=function(){var t=uiMgr.getOpenView("ParkingMainView");t&&t.nodeSubRoot&&this.node.setParent(t.nodeSubRoot)},o.onBeforeClose=function(){},o.onDestroy=function(){},o.onRoleResUpdate=function(){this.resItems.update()},e}(C));var B=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(i=t.call.apply(t,[this].concat(n))||this).titleList=[],i.scroll=void 0,i.utBg=void 0,i.utNode=void 0,i.utView=void 0,i.txtTypeDesc=void 0,i.isInit=!1,i}i(e,t);var a=e.prototype;return a.onInit=function(){this.adaptiveSize=!0;for(var t=0;t<3;t++)this.titleList[t]=f.findChild(this.node,"bg/txtTitle"+t);var i=f.findChildComponent(this.node,"ScrollView",n);this.utBg=f.findChildComponent(this.node,"bg/imgBg",o),this.utNode=this.node.getComponent(o),this.utView=f.findChildComponent(this.node,"ScrollView/view",o),this.scroll=this.view.addUIList(i,P,!1,0),this.scroll.touchEvent=!1,this.txtTypeDesc=f.findChildComponent(this.node,"txtdesc",s)},a.onRender=function(t,i){if(void 0===i&&(i=1),null!=i)for(var e=0;e<3;e++)this.titleList[e].active=e===i;var n;switch(i){case S.Skin:this.txtTypeDesc.node.active=!1;var o=Math.ceil(t.length/2);n=300*o+35*(o-1)+100,this.scroll.height=n,this.utView.height=n,this.utBg.height=n+40,this.scroll.datas=t;break;case S.Buff:this.txtTypeDesc.node.active=!0,this.txtTypeDesc.string=GetLanguage(201205);var s=Math.ceil(t.length/2);n=300*s+35*(s-1)+100+30,this.isInit||(this.utView.node.translate(new r(0,-30,0)),this.isInit=!0),this.scroll.height=n,this.utView.height=n,this.utBg.height=n+40,this.scroll.datas=t;break;case S.Guide:this.txtTypeDesc.node.active=!1;var a=Math.ceil(t.length/2);n=300*a+35*(a-1)+100,this.scroll.height=n,this.utView.height=n,this.utBg.height=n+40,this.scroll.datas=t}this.ut.height=n+80},e}(u),P=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(i=t.call.apply(t,[this].concat(n))||this).txtName=void 0,i.txtBtnLabel=void 0,i.itemGrid=void 0,i.txtLimit=void 0,i.nodeOut=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){var t=this;this.txtName=f.findChildComponent(this.node,"txtName",l);var i=f.findChildComponent(this.node,"btnBuy",a);this.view.adjustMirrorNode(f.findChild(this.node,"btnBuy/Layout/Image"),0,!0),this.nodeOut=f.findChild(this.node,"out"),this.txtBtnLabel=f.findChildComponent(i.node,"Layout/Label",l),this.view.addComponentCallbackListener(i.node,a.EventType.CLICK,(function(){t.data?t.nodeOut.active?g.showFlyTip(GetLanguage(200039)):uiMgr.openView("MallTipsView",t.data,5):g.showFlyTip("参数错误")})),this.itemGrid=new d(this.view,f.findChild(this.node,"itemGrid")),this.txtLimit=f.findChildComponent(this.node,"txtLimit",s)},n.onRender=function(t,i){this.txtName.string=t.name,this.txtBtnLabel.string=IS(I).getFactPrice(this.data.id).toString(),this.itemGrid.SetItemId(t.goods[0],t.goods[1]);var e="";if(this.txtLimit.node.active=!0,-1!=t.limit){var n,o=null!=(n=IS(I).GetBuyInfoByType(L.Parking)[t.id])?n:0,s=t.limit-o;o>=t.limit?this.nodeOut.active=!0:this.nodeOut.active=!1,1==t.refresh_way?e=""+GetLanguage(200041)+s+"/"+t.limit:2==t.refresh_way?e=""+GetLanguage(200042)+s+"/"+t.limit:0==t.refresh_way&&(e=c.formatStrWithMirrorDeal(GetLanguage(200028),s,t.limit))}else this.nodeOut.active=!1;var r=IS(I).getLimitInfoById(L.Parking,t.id);if(r&&r.et>m.serverTime&&r.st<m.serverTime){var a=c.formatStrWithMirrorDeal(GetLanguage(200043),m.getTimeLeft(r.et-m.serverTime))+(""!=e?"\n"+e:"");h.uiMirror&&(a=m.getTimeLeft(r.et-m.serverTime)+(""!=e?"\n"+e:"")),e=a}this.txtLimit.string=e},e}(u);e._RF.pop()}}}));

