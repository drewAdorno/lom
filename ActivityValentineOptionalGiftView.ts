System.register("chunks:///_virtual/ActivityValentineOptionalGiftView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./RedPointMgr.ts","./NodeUtil.ts","./TimeUtil.ts","./index57.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./CommonDefine.ts","./MessageView.ts","./PayControl.ts","./PayDataCache.ts","./PayDefine.ts","./ActivityValentineDataCache.ts","./BaseView.ts"],(function(t){"use strict";var i,e,s,n,o,a,h,d,c,r,f,u,l,v,m,y,g,p,C,G,_,I,b,L,x;return{setters:[function(t){i=t.inheritsLoose},function(t){e=t.cclegacy,s=t.Button,n=t.Label,o=t.ScrollView,a=t.UITransform,h=t.Color,d=t.Vec3,c=t.js},function(t){r=t.ItemGrid},function(t){f=t.ListItem},function(t){u=t.RedPointMgr},function(t){l=t.default},function(t){v=t.default},null,function(t){m=t.default},function(t){y=t.ActivityType,g=t.ActivityState},function(t){p=t.CommonEventDefine},function(t){C=t.default},function(t){G=t.default},function(t){_=t.default},function(t){I=t.PayEventDefine,b=t.GiftType},function(t){L=t.ActivityValentineDataCache},function(t){x=t.BaseView}],execute:function(){e._RF.push({},"a5491c0xylDN6pdW6bceyj1","ActivityValentineOptionalGiftView",void 0);t("default",function(t){function e(){var i;return(i=t.call(this)||this).txtLeftTime=void 0,i.payList=void 0,i.deltaTime=0,i.leftTime=0,i.canUpdate=!1,i.name="ActivityValentineOptionalGiftView",i.url="ui/module/valentine/ActivityValentineOptionalGiftView",i}i(e,t);var a=e.prototype;return a.onInit=function(){var t=this,i=this.findChild("view/btnClose");this.addComponentCallbackListener(i,s.EventType.CLICK,(function(){t.close()})),this.txtLeftTime=this.findChildComponent("view/timeCount/txtTime",n);var e=this.findChildComponent("view/payList",o);this.payList=this.addUIList(e,S)},a.registerUpdateHandler=function(){this.addEvent(I.PAY_INFO_UPDATE,this.OnPayGiftInfoUpdate,this),this.addEvent(I.PAY_CUSTOM_INFO_UPDATE,this.OnPayGiftInfoUpdate,this),this.addEvent(I.PAY_CUSTOM_INFO_SET,this.OnPayGiftInfoUpdate,this),this.addEvent(p.UPDATE_MAIN_SHOP_RED_POINT,this.UpdateRed,this)},a.onAfterOpen=function(){var t=IS(m).GetActivityInfo(y.Qixi);if(t&&t.state==g.Open){var i,e=null!=(i=t.state_time[t.state])?i:t.state_time[g.Open];this.leftTime=e.end_time-v.serverTime,this.leftTime>0?(this.canUpdate=!0,this.txtLeftTime.string=v.formatTimeStringForSecond(this.leftTime),this.UpdateRed()):this.txtLeftTime.string=GetLanguage(200026),IS(G).send_19_8()}},a.UpdateRed=function(){IS(u).changeValue("qixi_gift",IS(L).GetOptionGiftRed()),IS(m).UpdateMainRedByActType(y.Qixi)},a.onBeforeClose=function(){this.canUpdate=!1},a.onDestroy=function(){},a.onUpdate=function(t){this.canUpdate&&(this.deltaTime=this.deltaTime+t,this.deltaTime>=1&&(this.deltaTime=0,this.leftTime=this.leftTime-1,this.leftTime>0?this.txtLeftTime.string=v.formatTimeStringForSecond(this.leftTime):(this.txtLeftTime.string=GetLanguage(200026),this.canUpdate=!1)))},a.OnPayGiftInfoUpdate=function(){var t=IS(m).GetActivityInfo(y.Qixi);if(t){var i=IS(_).GetAcivityGift(b.Activity,t.type,t.round),e=IS(_).GetAcivityGift(b.Custom,t.type,t.round),s=!1,n=null;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o],h=IS(_).GetPayGiftInfo(a.id);h&&2==h.rewardState?(s=!1,n=a):(s=!0,e.push(a))}e.sort((function(t,i){var e=IS(_).GetPayGiftInfo(t.id),s=IS(_).GetPayGiftInfo(i.id),n=e&&0!=e.payCfg.buy_times&&e.bought_times&&e.bought_times>=e.payCfg.buy_times;return n!=(s&&0!=s.payCfg.buy_times&&s.bought_times&&s.bought_times>=s.payCfg.buy_times)?n?1:-1:t.id-i.id})),0==s&&e.push(n),this.payList.datas=e}},e}(x));var S=function(t){function e(){for(var i,e=arguments.length,s=new Array(e),n=0;n<e;n++)s[n]=arguments[n];return(i=t.call.apply(t,[this].concat(s))||this).txtName=void 0,i.nodeDesc=void 0,i.txtDesc=void 0,i.txtNum=void 0,i.txtMax=void 0,i.txtPrice=void 0,i.btnBuy=void 0,i.out=void 0,i.rewardScroll=void 0,i.scrollUt=void 0,i.choose=void 0,i.red=void 0,i.chooseNodeList={},i.chooseItemGridList={},i.chooseList=void 0,i.isFinishChoose=!1,i.btnChoose_1=void 0,i.btnChoose_2=void 0,i.changeGo_1=void 0,i.changeGo_2=void 0,i}i(e,t);var f=e.prototype;return f.onInit=function(){var t=this;this.txtName=l.findChildComponent(this.node,"title/Label",n),this.nodeDesc=l.findChild(this.node,"desc"),this.txtDesc=l.findChildComponent(this.node,"desc/txtDesc",n),this.txtNum=l.findChildComponent(this.node,"desc/txtNum",n),this.txtMax=l.findChildComponent(this.node,"desc/txtMax",n),this.txtPrice=l.findChildComponent(this.node,"btnBuy/Label",n),this.out=l.findChild(this.node,"out"),this.btnBuy=l.findChild(this.node,"btnBuy"),this.view.addComponentCallbackListener(this.btnBuy,s.EventType.CLICK,(function(){0==t.data.price?(IS(G).send_19_2(t.data.id),IS(m).UpdateMainRedByActType(y.Qixi)):t.isFinishChoose?IS(_).Pay(t.data.id):C.showFlyTip(GetLanguage(202017))})),this.scrollUt=l.findChildComponent(this.node,"rewardScroll",a);var i=l.findChildComponent(this.node,"rewardScroll",o);this.rewardScroll=this.view.addUIList(i,w),this.choose=l.findChild(this.node,"choose"),this.red=l.findChild(this.node,"red"),this.btnChoose_1=l.findChild(this.node,"choose/1/change/btn"),this.view.addComponentCallbackListener(this.btnChoose_1,s.EventType.CLICK,(function(){var i=IS(_).GetPayGiftInfo(t.data.id);if(0==t.data.price?!i||2!=i.rewardState:0==t.data.buy_times||(!i||!i.bought_times||!(i.bought_times>=i.payCfg.buy_times))){var e=IS(_).GetCustomInfoList(t.data.id);uiMgr.openView("ActivityValentineOptionalDetailView",t.chooseList,t.data.id,e,1)}})),this.btnChoose_2=l.findChild(this.node,"choose/2/change/btn"),this.view.addComponentCallbackListener(this.btnChoose_2,s.EventType.CLICK,(function(){var i=IS(_).GetPayGiftInfo(t.data.id);if(0==t.data.price?!i||2!=i.rewardState:0==t.data.buy_times||(!i||!i.bought_times||!(i.bought_times>=i.payCfg.buy_times))){var e=IS(_).GetCustomInfoList(t.data.id);uiMgr.openView("ActivityValentineOptionalDetailView",t.chooseList,t.data.id,e,2)}}));for(var e=1;e<3;e++)this.chooseNodeList[e]=l.findChild(this.node,"choose/"+e);for(var h=1;h<3;h++)this.chooseItemGridList[h]={go:l.findChild(this.node,"choose/"+h+"/itemGrid"),itemGrid:new r(this.view,l.findChild(this.node,"choose/"+h+"/itemGrid"))};this.changeGo_1=l.findChild(this.node,"choose/1/change"),this.changeGo_2=l.findChild(this.node,"choose/2/change")},f.onRender=function(t,i){this.txtName.string=t.name,this.txtNum.color=new h(19,140,19);var e=IS(_).GetPayGiftInfo(t.id);if(0==t.price)this.txtPrice.string=GetLanguage(200045),e&&2==e.rewardState?(this.out.active=!0,this.changeGo_1.active=!1,this.changeGo_2.active=!1,this.red.active=!1,this.btnBuy.active=!1,this.nodeDesc.active=!1):(this.out.active=!1,this.changeGo_1.active=!0,this.changeGo_2.active=!0,this.red.active=!0,this.btnBuy.active=!0,this.nodeDesc.active=!1,this.txtDesc.string=GetLanguage(200046),this.txtNum.string=t.buy_times,this.txtMax.string=""),this.choose.active=!1,this.rewardScroll.node.position=new d(-250,-22,0),this.rewardScroll.datas=t.reward;else{this.red.active=!1,this.txtPrice.string=IS(_).GetPriceString(t.cost_level),0==t.buy_times?(this.out.active=!1,this.changeGo_1.active=!0,this.changeGo_2.active=!0,this.btnBuy.active=!0,this.nodeDesc.active=!1):e&&e.bought_times?e.bought_times>=e.payCfg.buy_times?(this.out.active=!1,this.changeGo_1.active=!1,this.changeGo_2.active=!1,this.btnBuy.active=!1,this.nodeDesc.active=!0,this.txtDesc.string=GetLanguage(200040),this.txtNum.string="0",this.txtNum.color=new h(231,22,22),this.txtMax.string=c.formatStr("/%s",t.buy_times)):(this.out.active=!1,this.changeGo_1.active=!0,this.changeGo_2.active=!0,this.btnBuy.active=!0,this.nodeDesc.active=!0,this.txtDesc.string=GetLanguage(200040),this.txtNum.string=""+(t.buy_times-e.bought_times),this.txtMax.string=c.formatStr("/%s",t.buy_times)):(this.out.active=!1,this.changeGo_1.active=!0,this.changeGo_2.active=!0,this.btnBuy.active=!0,this.nodeDesc.active=!0,this.txtDesc.string=GetLanguage(200040),this.txtNum.string=t.buy_times,this.txtMax.string=c.formatStr("/%s",t.buy_times)),this.choose.active=!0,this.rewardScroll.node.position=new d(-88,-22,0);var s=configCustom_mall.getDataByKey(t.id);this.rewardScroll.datas=s.regular_reward,this.chooseList=s.custom_reward;for(var n=1;n<3;n++)this.chooseNodeList[n].active=!1;for(var o=1;o<=this.chooseList.length;o++)this.chooseNodeList[o].active=!0;for(var a=IS(_).GetCustomInfoList(t.id),r=1;r<3;r++)this.chooseItemGridList[r].go.active=!1;if(null!=a){var f=0;for(var u in a)if(a.hasOwnProperty(u)){f+=1;var l=a[u];this.chooseItemGridList[l.k].go.active=!0;var v=0,m=this.chooseList[l.k-1][1];for(var y in m)if(m.hasOwnProperty(y)){var g=m[y];g[0]==l.v&&(v=g[1])}this.chooseItemGridList[l.k].itemGrid.SetItemId(l.v,v)}this.isFinishChoose=f==this.chooseList.length}else{this.isFinishChoose=!1;for(var p=1;p<3;p++)this.chooseItemGridList[p].go.active=!1}}},e}(f),w=function(t){function e(){for(var i,e=arguments.length,s=new Array(e),n=0;n<e;n++)s[n]=arguments[n];return(i=t.call.apply(t,[this].concat(s))||this).itemGridNode=void 0,i.itemGrid=void 0,i}i(e,t);var s=e.prototype;return s.onInit=function(){this.itemGridNode=l.findChild(this.node,"itemGrid"),this.itemGrid=new r(this.view,this.itemGridNode)},s.onRender=function(t,i){this.itemGrid.SetItemId(t[0],t[1])},e}(f);e._RF.pop()}}}));

