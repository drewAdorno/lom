System.register("chunks:///_virtual/RoleJobView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./RedPoint.ts","./RedPointMgr.ts","./NodeUtil.ts","./StringUtil.ts","./index57.ts","./ItemIcon.ts","./ConfigGlobal.ts","./ObjectUtil.ts","./BagModel.ts","./MessageView.ts","./RoleControl.ts","./RoleDataCache.ts","./RoleDefine.ts","./BaseView.ts","./UIDefine.ts","./BaseSubView.ts"],(function(t){"use strict";var i,e,o,n,s,a,l,c,d,r,h,v,f,p,m,u,b,g,C,k,I,L,w,_,S,y,x,J;return{setters:[function(t){i=t.inheritsLoose},function(t){e=t.cclegacy,o=t.RichText,n=t.Vec2,s=t.Button,a=t.Label,l=t.Sprite,c=t.UITransform,d=t.Node,r=t.ProgressBar,h=t.js,v=t.sys},function(t){f=t.RedPointType},function(t){p=t.RedPointMgr},function(t){m=t.default},function(t){u=t.default},null,function(t){b=t.IconAseetType},function(t){g=t.ConfigGlobal},function(t){C=t.default},function(t){k=t.BagModel},function(t){I=t.default},function(t){L=t.default},function(t){w=t.RoleDataCache},function(t){_=t.RoleEventDefine,S=t.PlayerAttr},function(t){y=t.ViewEvent},function(t){x=t.OpenFunction},function(t){J=t.BaseSubView}],execute:function(){e._RF.push({},"7a7b4wkN5lCLqcK7sERgF0w","RoleJobView",void 0);t("default",function(t){function e(){var i;return(i=t.call(this)||this).txtTips=void 0,i.btnJob=void 0,i.btnReset=void 0,i.btnAwake=void 0,i.jobInfo=void 0,i.isJobLimit=!1,i.name="RoleJobView",i.url="ui/module/role/RoleJobView",i}i(e,t);var a=e.prototype;return a.onInit=function(){var t=this;this.txtTips=this.findChildComponent("tips",o),this.jobInfo=new R,this.jobInfo.init(this.findChild("JobInfoPanel"),this),this.btnJob=this.findChild("bottom/btnJob"),this.addRedPoint("MainView/tab-1/tab-11/btnJob",this.btnJob,new n(90,25),f.Dot),IS(p).updateRed("MainView/tab-1/tab-11/btnJob"),this.addComponentCallbackListener(this.btnJob,s.EventType.CLICK,(function(){t.onJobClick()})),this.btnReset=this.findChild("bottom/btnReset"),this.addComponentCallbackListener(this.btnReset,s.EventType.CLICK,(function(){t.onResetClick()})),this.btnAwake=this.findChild("bottom/btnAwake"),this.addComponentCallbackListener(this.btnAwake,s.EventType.CLICK,(function(){t.onAwakeClick()}));var i=this.findChild("btnPreview");this.addComponentCallbackListener(i,s.EventType.CLICK,(function(){t.onPreviewClick()}))},a.registerUpdateHandler=function(){this.addEvent(_.ROLE_INFO_UPDATE,this.updateInfo,this),this.addEvent(_.Awake_Info_Update,this.updateInfo,this)},a.onAfterOpen=function(){normalEvent.emit(y.ViewOpen,this.name),this.updateInfo()},a.onBeforeClose=function(){normalEvent.emit(y.ViewClose,this.name)},a.onDestroy=function(){},a.onJobClick=function(){this.isJobLimit?I.showFlyTip(GetLanguage(200106)):uiMgr.openView("JobSelectView_4")},a.onAwakeClick=function(){this.isJobLimit?I.showFlyTip(GetLanguage(200106)):uiMgr.openView("JobSelectView_3")},a.onResetClick=function(){var t=IS(w).GetJob(),i=configJobs.getDataByKey(t).change_times<5?"":GetLanguage(200585),e=g.reset_job,o=IS(k).getGoodsCountByGoodsGtid(e[0]);if(o>=e[1]){var n=u.formatStrWithMirrorDeal(GetLanguage(200586)+i);I.showBoxTip({tip:n,title:GetLanguage(200048),func:function(t){"type_yes"==t&&IS(L).send_3_6(g.initial_job)}})}else{var s=e[1]-o,a=configGoods.getDataByKey(e[0]),l=a.price[1]*s,c=u.formatStrWithMirrorDeal(GetLanguage(200587)+i,l);I.showBoxTip({tip:c,title:GetLanguage(200048),func:function(t){"type_yes"==t&&(IS(k).getGoodsCountByGoodsGtid(a.price[0])>=l?IS(L).send_3_6(g.initial_job):I.showFlyTip(GetLanguage(200049)))}})}},a.onPreviewClick=function(){uiMgr.openView("JobTreeView")},a.updateInfo=function(){var t=IS(w).GetJob(),i=IS(w).GetLevel(),e=g.transfer_job_level,o=IS(w).GetRoleAttr(S.ROLE_ATTR_GENDER),n=configJobs.getDataByKey(t).change_times;n>=5&&2==o?this.jobInfo.show(t,!0):this.jobInfo.show(t,!1);var s,a=e[n];(null==a||n>=5)&&(a=g.jobs_wakeup_condition,s=!0),this.isJobLimit=i<a;var l=this.isJobLimit?"#e76262":"#5ACF97";n<5?(this.txtTips.node.active=!0,this.txtTips.string=u.formatStrWithMirrorDeal(GetLanguage(200109),a,l,i,a)):s&&this.isJobLimit?(this.txtTips.node.active=IS(w).CheckFuncOpen(x.FUNC_JOBS_WAKEUP),this.txtTips.string=u.formatStrWithMirrorDeal(GetLanguage(200588),a,l,i,a)):this.txtTips.node.active=!1,this.btnJob.active=n<5,this.btnReset.active=n>0,this.btnAwake.active=IS(w).CheckFuncOpen(x.FUNC_JOBS_WAKEUP)&&(!IS(w).awakeAllPos()||5==n)},e}(J));var R=t("JobInfoPanel",function(){function t(){this.view=void 0,this.node=void 0,this.job=void 0,this.txtJobName=void 0,this.txtWeaponName=void 0,this.txtPos=void 0,this.txtJobDesc=void 0,this.activeSkillName=void 0,this.activeSkillDesc=void 0,this.passiveList=[],this.txtLevel=void 0,this.txtExperience=void 0,this.pbExperience=void 0,this.imgFrame=void 0,this.imgIcon=void 0,this.imgJob=void 0}var i=t.prototype;return i.init=function(t,i){this.view=i,this.node=t,this.onInit()},i.onInit=function(){var t=this;this.txtJobName=m.findChildComponent(this.node,"desc/name",a),this.txtWeaponName=m.findChildComponent(this.node,"desc/weapon",a),this.txtPos=m.findChildComponent(this.node,"desc/pos",a),this.txtJobDesc=m.findChildComponent(this.node,"desc/desc",a),this.imgFrame=m.findChildComponent(this.node,"skill/active/frame",l),this.imgIcon=m.findChildComponent(this.node,"skill/active/icon",l),this.activeSkillName=m.findChildComponent(this.node,"skill/active/name",a),this.activeSkillDesc=m.findChildComponent(this.node,"skill/active/desc/view/content/desc",o);var i=m.findChildComponent(this.node,"skill/active/desc/view/content",c);this.view.addComponentCallbackListener(this.activeSkillDesc.node,d.EventType.SIZE_CHANGED,(function(){i.height=t.activeSkillDesc.node.getComponent(c).height})),this.imgJob=m.findChildComponent(this.node,"role/imgJob",l),this.txtLevel=m.findChildComponent(this.node,"role/levelRoot/txtLevel",a),this.txtExperience=m.findChildComponent(this.node,"role/levelRoot/txtProgress",a),this.pbExperience=m.findChildComponent(this.node,"role/levelRoot/pbExperience",r);for(var e=g.job_passive_skill,n=function(i){var o=m.findChild(t.node,h.formatStr("skill/passive/item%s",i+1)),n={node:o,frame:m.findChildComponent(o,"frame",l),icon:m.findChildComponent(o,"icon",l),txtLev:m.findChildComponent(o,"lev",a),mask:m.findChild(o,"mask"),levLimit:0,skillId:0,skillLev:0};t.view.addComponentCallbackListener(o,s.EventType.CLICK,(function(){if(0==n.skillId)I.showFlyTip(u.formatStrWithMirrorDeal(GetLanguage(200110),e[i]));else{var t=configSkill_level.getDataByKeys("id",n.skillId,"level",n.skillLev);uiMgr.openView("JobSkillTipsView",u.formatStr.apply(u,[t.desc].concat(t.desc_parm)),n.node)}})),t.passiveList.push(n)},v=0;v<5;v++)n(v)},i.show=function(t,i){this.job=t;var e=configJobs.getDataByKey(t);this.txtJobName.string=e.name,this.txtWeaponName.string=e.arms_name,this.txtPos.string=e.job_pos,this.txtJobDesc.string=u.formatStrWithMirrorDeal(GetLanguage(200111),e.desc),i?(this.view.loadIcon(this.imgJob,"icon_job",h.formatStr("job_%s_2",this.job),null,b.ICON_SPRITE),this.imgJob.node.setPosition(v.uiMirror?-e.position[2]:e.position[2],e.position[3]-70,0)):(this.view.loadIcon(this.imgJob,"icon_job",h.formatStr("job_%s",this.job),null,b.ICON_SPRITE),this.imgJob.node.setPosition(v.uiMirror?-e.position[0]:e.position[0],e.position[1]-70,0)),this.imgJob.node.setScale(v.uiMirror?-e.scale:e.scale,e.scale,e.scale);var o=configSkill.getDataByKey(e.skill[0][1][0]),n=IS(w).GetLevel(),s=configSkill_level.getDataByKeys("id",o.id,"level",n);this.activeSkillName.string=o.name,this.activeSkillDesc.string=h.formatStr("<b><color=#304231>%s</color></b>",u.formatStr.apply(u,[s.desc].concat(s.desc_parm))),this.view.loadIcon(this.imgFrame,"icon_skill",h.formatStr("common_ICON_jinengkuang0%s",o.quality)),this.view.loadIcon(this.imgIcon,"icon_skill",o.icon);for(var a=0;a<5;a++){var l=this.passiveList[a];if(a<e.passive_skill.length){l.levLimit=e.passive_skill[a][0],l.skillId=e.passive_skill[a][1][0],l.skillLev=e.passive_skill[a][1][1];var c=configSkill.getDataByKey(l.skillId);l.icon.node.active=!0,this.view.loadIcon(l.frame,"icon_skill",h.formatStr("common_ICON_jinengkuang0%s",c.quality)),this.view.loadIcon(l.icon,"icon_skill",c.icon,null,b.ICON_SPRITE),l.txtLev.string=h.formatStr("Lv.%s",l.levLimit),n<l.levLimit?(l.mask.active=!0,l.txtLev.node.active=!0):(l.mask.active=!1,l.txtLev.node.active=!1)}else l.levLimit=0,l.skillId=0,l.skillLev=0,this.view.loadIcon(l.frame,"icon_skill","common_ICON_jinengwenhao"),l.icon.node.active=!1,l.mask.active=!0,l.txtLev.node.active=!1}var d=IS(w).GetLevel(),r=IS(w).GetExp(),f=configLevel.getDataByKey(d),p=f.expend,m=d+1,g=configLevel.getDataByKey(m),k=!1;C.isEmpty(g)&&(k=!0);var I=r-p,L=k?f.expend-configLevel.getDataByKey(d-1).expend:g.expend-p,_=k?1:I/L;this.txtLevel.string=String(d),this.txtExperience.string=h.formatStr("%s/%s",u.GetNumString(I),u.GetNumString(L)),this.pbExperience.progress=Math.min(1,_)},t}());e._RF.pop()}}}));

