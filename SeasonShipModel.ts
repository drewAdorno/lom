System.register("chunks:///_virtual/SeasonShipModel.ts",["./rollupPluginModLoBabelHelpers.js","cc","./StorageUtil.ts","./ConfigSeason_kv.ts","./ObjectUtil.ts","./BagModel.ts","./MessageView.ts","./LoginDefine.ts","./RoleDataCache.ts","./SeasonControl.ts","./SeasonDataCache.ts","./SeasonDefine.ts","./StringUtil.ts"],(function(t){"use strict";var e,n,i,o,a,u,r,s,l,p,c,f,S,h,d,g;return{setters:[function(t){e=t.createForOfIteratorHelperLoose},function(t){n=t.cclegacy,i=t.Color,o=t.js},function(t){a=t.default},function(t){u=t.ConfigSeason_kv},function(t){r=t.default},function(t){s=t.BagModel},function(t){l=t.default},function(t){p=t.LoginEventDefine},function(t){c=t.RoleDataCache},function(t){f=t.default},function(t){S=t.SeasonDataCache},function(t){h=t.SeasonShipEventDefind,d=t.ShipEquipQuality},function(t){g=t.default}],execute:function(){n._RF.push({},"d6e9eIxrSFDwYCA4lRFY1Kv","SeasonShipModel",void 0);var E={BattleHubView:!0,GuideView:!0,MainView:!0,SeasonMapSceneView:!0};t("SeasonShipModel",function(){function t(){this.openCondition=void 0,this.hasLoadInfo=!1,this.isAutoOpen=!1,this.waitTimer=void 0,this.can_Send_server=!0,normalEvent.on(p.RECONNECT_NET_LINK,this.onReConnectNetLink,this),normalEvent.on(h.TYPE_SHIP_EQUIP_BUILD_START,this.onStartBuild,this)}var n=t.prototype;return n.clear=function(){normalEvent.off(p.RECONNECT_NET_LINK,this.onReConnectNetLink,this),normalEvent.off(h.TYPE_SHIP_EQUIP_BUILD_START,this.onStartBuild,this)},n.onReConnectNetLink=function(){IS(t).tryReStartAutoOpen()},n.getEquipList=function(t){if(!t)return IS(S).equip_list;for(var n,i=[],o=e(IS(S).equip_list);!(n=o()).done;){var a=n.value;a.tab==t&&i.push(a)}return i},n.getEquipByLocation=function(t,e){null==e&&(e=IS(S).tabInfo.tab);for(var n=this.getEquipList(e),i=0;i<n.length;i++)if(n[i].location==t)return n[i]},n.getEquipInfoByEquipId=function(t){for(var e=IS(S).equip_list,n=0;n<e.length;n++)if(e[n].equip_id==t)return e[n]},n.getEquipNameShowByEquipConfigId=function(t,e){var n=configSeason_equipment.getDataByKey(t),i=this.getEquipQualityNameAndColor(n.quality);return e?{name:g.formatStr(GetLanguage(200244),i.nameStr,n.name),color:i.nameColor}:{name:g.formatStr(GetLanguage(200245),i.nameStr,n.name),color:i.nameColor}},n.getEquipQualityNameAndColor=function(t,e){var n,o=configColor.getDataByKey(t).name;switch(t){case d.WHITE:n=e?new i(193,189,176):new i(83,62,42);break;case d.GREEN:n=e?new i(89,197,144):new i(36,115,67);break;case d.BLUE:n=e?new i(125,172,248):new i(47,69,130);break;case d.PURPLE:n=e?new i(216,121,255):new i(110,15,139);break;case d.GOLD:n=e?new i(243,207,67):new i(151,107,0);break;case d.ORANGE:n=e?new i(252,140,31):new i(167,76,0);break;case d.RED:n=e?new i(254,70,70):new i(156,9,9);break;case d.PINK:n=e?new i(205,105,137):new i(170,0,104)}return{nameStr:o,nameColor:n}},n.getRoleSaveStr=function(t){return o.formatStr("%s_%s",t,IS(c).GetRoleId())},n.saveLocalOpenConditionData=function(){a.set(this.getRoleSaveStr("SeasonShipAutoOpenCondition_ONE"),JSON.stringify(this.openCondition))},n.loadLocalOpenConditionData=function(){var t=a.get(this.getRoleSaveStr("SeasonShipAutoOpenCondition_ONE"));return!(!t||""==t)&&(this.openCondition=t,!0)},n.tryLoadLocalInfo=function(){IS(t).hasLoadInfo||(0==IS(t).loadLocalOpenConditionData()&&(IS(t).openCondition={quality:1,num:1,attr:[{isUsing:!0,attr:[0,0]}]}),IS(t).hasLoadInfo=!0)},n.setSelectAutoMultiNum=function(e){IS(t).openCondition.num=e,IS(t).saveLocalOpenConditionData()},n.getSelectAutoMultiNum=function(){return IS(t).openCondition.num},n.setQualityCodition=function(e){IS(t).openCondition.quality=e,IS(t).saveLocalOpenConditionData()},n.setAttrConditionUseFlag=function(e,n){IS(t).openCondition.attr[e].isUsing=n,IS(t).saveLocalOpenConditionData()},n.setAttrConditionDetail=function(e,n,i){IS(t).openCondition.attr[e].attr[n]=i,IS(t).saveLocalOpenConditionData()},n.getQualityCondition=function(){return IS(t).openCondition.quality},n.getAttrConditionByIdx=function(e,n){return IS(t).openCondition.attr[e].attr[n]},n.getEmptyEquipIdList=function(t,e){for(var n=new Array,i=this.getEquipList(e),o=0;o<i.length;o++)0==i[o].location&&n.push(i[o].equip_id);return n},n.checkNumUnlock=function(t){for(var e=u.SEASON_FORGING_OPENTIME_LIMIT,n=0;n<e.length;n++)if(t==e[n][1]&&IS(S).equip_box_level>=e[n][0])return!0;return!1},n.tryReStartAutoOpen=function(t){if(this.isAutoOpen&&(t||null==uiMgr.getOpenView("SeasonShipEquipEditView"))){var e=this.getEmptyEquipIdList(!1,0);if(e.length<=0)this.tryAutoMultiOpenBox();else{for(var n=0;n<e.length;n++){var i=e[n];if(this.checkEquipIsConditionOk(i))return}IS(f).reqShipEquipSell(e)}}},n.tryAutoMultiOpenBox=function(){var t=configSeason_ship_level.getDataByKey(IS(S).ship_level),e=IS(s).getGoodsCountByGoodsGtid(270006);if(e<t.cost[1])l.showFlyTip(GetLanguage(200069));else{var n=this.getSelectAutoMultiNum(),i=Math.floor(e/t.cost[1]),o=Math.min(n,i);IS(f).reqShipEquipMultiOpen(o,0)}},n.checkEquipIsConditionOk=function(t){var e=this.getEquipInfoByEquipId(t),n=configSeason_equipment.getDataByKey(null==e?void 0:e.config_id);if((null==n?void 0:n.quality)<this.getQualityCondition())return!1;for(var i=(null==e?void 0:e.rand_attr)||[],o={},a=0;a<i.length;a++)o[i[a].k]=!0;for(var u,r=!1,s=0;s<1;s++){for(var l=!0,p=0;p<2;p++)0!=(u=this.getAttrConditionByIdx(s,p))&&null==o[u]&&(l=!1);1==l&&(r=!0)}return r},n.checkCanPopEquipEditView=function(){return!!uiMgr.getOpenView("SeasonMainView")&&null!=uiMgr.checkOnlyOpenView2("SeasonMainView",E)},n.doAfterOpenBox=function(e){var n=this,i=e[0],o=function(){if(n.checkCanPopEquipEditView()){var e=IS(t).getEmptyEquipIdList().length;1==e?uiMgr.openView("SeasonShipEquipEditView",i):e>1&&uiMgr.openView("SeasonShipEquipTempBagView")}};if(0!=this.isAutoOpen){var a,u=configSeason_ship_level.getDataByKey(IS(S).ship_level);if(IS(s).getGoodsCountByGoodsGtid(270006)<u.cost[1])return this.setAutoOpen(!1),l.showFlyTip(GetLanguage(200069)),void o();for(var r=[],p=[],c=0;c<e.length;c++)a=e[c],this.checkEquipIsConditionOk(a)?p.push(a):r.push(a);if(p.length<=0)return r.length>0&&IS(f).reqShipEquipSell(r),void normalEvent.emit(h.TYPE_SHIP_EQUIP_BUILD_START);l.showFlyTip(GetLanguage(204920)),i=p[0],o()}else o()},n.clearWaitTimer=function(){this.waitTimer&&normalTimer.stop(this.waitTimer),this.waitTimer=null},n.tryOpenEquipEditView=function(e){if(null!=!e&&0!=e){var n=this.getEquipInfoByEquipId(e);if(null!=n){var i=configSeason_equipment.getDataByKey(n.config_id).part,o=IS(t).getEquipByLocation(i);null!=o&&o.equip_id==e||uiMgr.openView("SeasonShipEquipEditView",e)}}},n.checkHasEmptyBetterEquip=function(){var t=this.getEmptyEquipIdList(!1,0);if(t.length<=0)return!1;for(var e=0;e<t.length;e++)if(1==this.checkIsBetterEquip(t[e]))return!0;return!1},n.checkIsBetterEquip=function(t){var e=this.getEquipInfoByEquipId(t),n=configSeason_equipment.getDataByKey(null==e?void 0:e.config_id).part,i=this.getEquipByLocation(n);if(r.isEmpty(i))return!0;for(var o=null==e?void 0:e.base_attr,a=null==i?void 0:i.base_attr,u={},s=0;s<(null==o?void 0:o.length);s++)u[o[s].k]=o[s].v;for(var l=!0,p=0;p<(null==a?void 0:a.length);p++){var c=u[a[p].k]||0;if(a[p].v!=c&&(l=!1),a[p].v>c)return!1}return!l},n.setAutoOpen=function(t){1!=t&&this.clearWaitTimer(),this.isAutoOpen!=t&&(this.isAutoOpen=t,normalEvent.emit(h.TYPE_SHIP_EQUIP_AUTO_OPEN_STATUS_CHANGE))},n.getAutoOpen=function(){return this.isAutoOpen},n.onStartBuild=function(){var e=this,n=configSeason_ship_level.getDataByKey(IS(S).ship_level),i=IS(s).getGoodsCountByGoodsGtid(270006);if(i>=n.cost[1]){if(!this.can_Send_server)return;this.can_Send_server=!1,this.clearWaitTimer(),this.waitTimer=normalTimer.start(1.1,1,(function(){if(e.getAutoOpen()){var t=e.getSelectAutoMultiNum(),o=Math.floor(i/n.cost[1]),a=Math.min(t,o);IS(f).reqShipEquipMultiOpen(a,e.getQualityCondition())}else IS(f).reqShipEquipBoxOpen()}))}else IS(t).setAutoOpen(!1),l.showFlyTip(GetLanguage(200069))},t}());n._RF.pop()}}}));

