System.register("chunks:///_virtual/HorseUpgradeView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./index57.ts","./ItemIcon.ts","./BagModel.ts","./HorseControl.ts","./HorseDataChche.ts","./HorseDefine.ts","./BaseSubView.ts"],(function(t){"use strict";var e,i,n,o,s,r,h,a,l,d,c,f,u,g,v,C,p,I,m,S;return{setters:[function(t){e=t.inheritsLoose,i=t.createForOfIteratorHelperLoose},function(t){n=t.cclegacy,o=t.Button,s=t.ScrollView,r=t.Vec2,h=t.Sprite,a=t.Label,l=t.js,d=t.sys,c=t.ProgressBar},function(t){f=t.ListItem},function(t){u=t.default},function(t){g=t.default},null,function(t){v=t.IconAseetType},function(t){C=t.BagModel},function(t){p=t.default},function(t){I=t.HorseDataCache},function(t){m=t.HorseEvent},function(t){S=t.BaseSubView}],execute:function(){n._RF.push({},"630a1XX/0ZBaogY22/zqw06","HorseUpgradeView",void 0);t("default",function(t){function n(){var e;return(e=t.call(this)||this).nodeRoot=void 0,e.btnOne=void 0,e.btnTen=void 0,e.btnLeft=void 0,e.btnRight=void 0,e.btnUse=void 0,e.btnCancel=void 0,e.attrUIList=void 0,e.attrTopUIList=void 0,e.starUIList=void 0,e.AttrlistItem=[],e.AttrToplistItem=[],e.horseList=[],e.starInfo=[],e.horseEffectID=0,e.showID=IS(I).horse_id,e.showOrder=0,e.useFlag=!1,e.name="HorseUpgradeView",e.url="ui/module/horse/HorseUpgradeView",e.poolTime=3e3,e}e(n,t);var f=n.prototype;return f.onInit=function(){var t=this;this.nodeRoot=this.findChild("root"),this.btnCancel=this.findChild("root/nodeShow/btnCancel"),this.addComponentCallbackListener(this.btnCancel,o.EventType.CLICK,(function(){t.useFlag=!0,IS(p).reqUseHorse(0)})),this.btnUse=this.findChild("root/nodeShow/btnUse"),this.addComponentCallbackListener(this.btnUse,o.EventType.CLICK,(function(){t.useFlag=!0,IS(p).reqUseHorse(t.showID)}));var e=this.findChild("root/nodeItem");this.addComponentCallbackListener(e,o.EventType.CLICK,(function(){uiMgr.openView("ItemGetWayView",1008)})),this.btnOne=this.findChild("root/nodeChange/btnOne"),this.addComponentCallbackListener(this.btnOne,o.EventType.CLICK,(function(){t.onClickOne()})),this.btnTen=this.findChild("root/nodeChange/btnTen"),this.addComponentCallbackListener(this.btnTen,o.EventType.CLICK,(function(){t.onClickTen()})),this.btnLeft=this.findChild("root/nodeShow/btnLeft"),this.addComponentCallbackListener(this.btnLeft,o.EventType.CLICK,(function(){t.showOrder-=1;var e=configMount_level.getDataByKeys("order",t.showOrder,"star",1);t.showID=e.unlock,t.refreshHorseShow()})),this.btnRight=this.findChild("root/nodeShow/btnRight"),this.addComponentCallbackListener(this.btnRight,o.EventType.CLICK,(function(){t.showOrder+=1;var e=configMount_level.getDataByKeys("order",t.showOrder,"star",1);t.showID=e.unlock,t.refreshHorseShow()}));var n=this.findChildComponent("root/nodeChange/ScrollView",s);this.attrUIList=this.addUIList(n,y);var h=this.findChildComponent("root/nodeTop/ScrollView",s);this.attrTopUIList=this.addUIList(h,L);var a=this.findChildComponent("root/nodeProgress/ScrollView",s);this.starUIList=this.addUIList(a,w),configMount_level.getDataByKey(IS(I).curLevel)&&(this.showOrder=configMount_level.getDataByKey(IS(I).curLevel).order);for(var l,d=i(configMount_level.getDataByList("star",1));!(l=d()).done;){var c=l.value;this.horseList.push(c.unlock)}this.addRedPoint("horse_upgrade_active",this.btnTen,new r(100,30)),IS(I).checkUpgradeRP()},f.onAfterOpen=function(){0==this.showID&&(this.showID=Math.ceil(IS(I).curLevel/10)),this.refreshUpgradeShow()},f.registerUpdateHandler=function(){this.addEvent(m.TYPE_HORSE_CHANGE,this.refreshUpgradeShow,this),this.addEvent(m.TYPE_HORSE_ADD_EXP,this.refreshItemNum,this)},f.refreshSkillInfo=function(){var t=u.findChildComponent(this.nodeRoot,"nodeSkill/Frame",h),e=u.findChildComponent(this.nodeRoot,"nodeSkill/Icon",h),i=u.findChildComponent(this.nodeRoot,"nodeSkill/txtName",a),n=u.findChildComponent(this.nodeRoot,"nodeSkill/txtCurDesc",a),o=u.findChildComponent(this.nodeRoot,"nodeSkill/txtNextDesc",a),s=u.findChildComponent(this.nodeRoot,"nodeSkill/txtHint",a),r=u.findChild(this.nodeRoot,"nodeSkill/arrow"),d=configMount_level.getDataByKey(IS(I).curLevel);if(d){var c=configMount_level.getDatas()[configMount_level.getDatas().length-1].level,f=10*d.order+1,C=configSkill.getDataByKey(d.base_skill[0][0]);this.loadIcon(t,"icon_skill",l.formatStr("common_ICON_jinengkuang0%s",C.quality)),this.loadIcon(e,"icon_skill",C.icon,null,v.ICON_SPRITE),i.string=C.name;var p=configSkill_level.getDataByKeys("id",d.base_skill[0][0],"level",d.base_skill[0][1]);if(n.string=g.formatStr.apply(g,[p.desc].concat(p.desc_parm)),f<c){o.node.active=!0,s.node.active=!0,r.active=!0;var m=configMount_level.getDataByKey(f),S=configSkill_level.getDataByKeys("id",m.base_skill[0][0],"level",m.base_skill[0][1]);o.string=g.formatStr.apply(g,[S.desc].concat(S.desc_parm)),s.string=g.formatStr(GetLanguage(100010011),m.order.toString(),m.star.toString())}else o.node.active=!1,s.node.active=!1,r.active=!1}},f.refreshAttrChange=function(){var t=this.findChild("root/nodeChange"),e=this.findChild("root/nodeTop"),i=u.findChildComponent(this.nodeRoot,"nodeChange/txtLevelBase",a),n=u.findChildComponent(this.nodeRoot,"nodeChange/txtLevelNext",a),o=u.findChildComponent(e,"txtLevelBase",a),s=configMount_level.getDataByKey(IS(I).curLevel),r=configMount_level.getDataByKey(IS(I).curLevel+1);if(this.AttrlistItem=[],this.AttrToplistItem=[],null!=s)if(null!=r){i.string=s.name,n.string=r.name;for(var h=0;h<s.attr.length;h++){var l=configAttribute.getDataByKey(s.attr[h][0]),d={show_type:l.show_type,name:l.desc,base:s.attr[h][1],next:r.attr[h][1]};this.AttrlistItem.push(d)}this.attrUIList.datas=this.AttrlistItem,t.active=!0,e.active=!1}else{o.string=s.name;for(h=0;h<s.attr.length;h++){var c=configAttribute.getDataByKey(s.attr[h][0]),f={show_type:c.show_type,name:c.desc,base:s.attr[h][1]};this.AttrToplistItem.push(f)}this.attrTopUIList.datas=this.AttrToplistItem,t.active=!1,e.active=!0}},f.onClickOne=function(){IS(C).getGoodsCountByGoodsGtid(1008)<1?uiMgr.openView("ItemGetWayView",1008):IS(p).reqLevelUp(0)},f.onClickTen=function(){IS(C).getGoodsCountByGoodsGtid(1008)<1?uiMgr.openView("ItemGetWayView",1008):IS(p).reqLevelUp(1)},f.checkOneKeyShow=function(){var t=u.findChild(this.btnTen,"txtNum"),e=u.findChild(this.btnTen,"txtRed"),i=u.findChildComponent(this.btnTen,"txtNum",a),n=u.findChild(this.btnOne,"txtNum"),o=u.findChild(this.btnOne,"txtRed"),s=IS(C).getGoodsCountByGoodsGtid(1008);if(e.active=0==s,t.active=0!=s,o.active=0==s,n.active=0!=s,null!=configMount_level.getDataByKey(IS(I).curLevel+1)){var r=configMount_level.getDataByKey(IS(I).curLevel+1).expend_exp;r-=IS(I).curexp,i.string=s>=r?""+r:""+s}else i.string="1"},f.refreshHorseShow=function(){var t=this.findChild("root/nodeShow/icon"),e=this.findChildComponent("root/nodeShow/bgName/txtName",a),i=this.findChildComponent("root/nodeShow/bgLevel/txtLevel",a),n=configMount.getDataByKey(this.showID);null!=n&&(e.string=n.name,this.removeUIEffect(this.horseEffectID),this.horseEffectID=this.addUIEffect(n.path,t,-1,null,1,(function(t){d.uiMirror&&(t.dir=-1)}))),i.string=g.formatStrWithMirrorDeal(GetLanguage(400013),this.showOrder),this.checkPageBtn()},f.checkPageBtn=function(){this.btnLeft.active=!0,this.btnRight.active=!0,1==this.showOrder&&(this.btnLeft.active=!1);var t=configMount_level.getDataByList("star",1).length;this.showOrder==t&&(this.btnRight.active=!1);var e=configMount_level.getDataByKey(IS(I).curLevel);e&&this.showOrder<=e.order?this.btnUse.active=!0:this.btnUse.active=!1,this.showID==IS(I).horse_id&&this.showOrder<=e.order?this.btnCancel.active=!0:this.btnCancel.active=!1},f.refreshItemNum=function(){this.refreshProgress(),this.checkOneKeyShow(),this.refreshAttrChange();var t=this.findChildComponent("root/nodeItem/Label",a),e=IS(C).getGoodsCountByGoodsGtid(1008);t.string=""+e,IS(I).checkUpgradeRP()},f.refreshProgress=function(){var t=configMount_level.getDataByKey(IS(I).curLevel);if(null!=t){var e=this.findChildComponent("root/nodeProgress/ProgressBar",c),i=this.findChildComponent("root/nodeProgress/ProgressBar/txtDesc",a),n=t.expend_exp,o=configMount_level.getDataByKey(IS(I).curLevel+1);if(null==o)return e.progress=1,void(i.string=n+"/"+n);var s=IS(I).curexp;s-=n,n=o.expend_exp-t.expend_exp,e.progress=s/n,i.string=s+"/"+n}},f.refreshStarInfo=function(){var t=configMount_level.getDataByKey(IS(I).curLevel),e=configMount_level.getDataByList("order",t.order);this.starInfo=[];for(var i=0;i<e.length;i++)i<t.star?this.starInfo.push(1):this.starInfo.push(0);this.starUIList.datas=this.starInfo},f.refreshUpgradeShow=function(){this.horseList.includes(IS(I).horse_id)||0==IS(I).horse_id?this.horseList.includes(IS(I).horse_id)&&(this.useFlag?this.useFlag=!1:(this.showOrder=this.showID<7?this.showID:Math.ceil(IS(I).curLevel/10),this.showID=this.horseList[this.showOrder-1])):this.useFlag?this.useFlag=!1:(this.showID=Math.min(Math.ceil(IS(I).curLevel/10),7),this.showOrder=configMount_level.getDataByKey(IS(I).curLevel).order),this.refreshSkillInfo(),this.refreshAttrChange(),this.refreshHorseShow(),this.refreshItemNum(),this.refreshProgress(),this.refreshStarInfo()},f.onBeforeClose=function(){},f.onDestroy=function(){},n}(S));var y=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).txtAttrName=void 0,e.txtAttrBase=void 0,e.txtAttrNext=void 0,e}e(i,t);var n=i.prototype;return n.onInit=function(){this.txtAttrName=u.findChildComponent(this.node,"txtAttrName",a),this.txtAttrBase=u.findChildComponent(this.node,"txtAttrBase",a),this.txtAttrNext=u.findChildComponent(this.node,"txtAttrNext",a)},n.onRender=function(t,e){this.txtAttrName.string=t.name,2==t.show_type?(this.txtAttrBase.string=l.formatStr("%s%",g.GetNumString(t.base/100)),this.txtAttrNext.string=l.formatStr("%s%",g.GetNumString(t.next/100))):3==t.show_type?(this.txtAttrBase.string=g.GetNumString(Math.floor(t.base/100)/100),this.txtAttrNext.string=g.GetNumString(Math.floor(t.next/100)/100)):(this.txtAttrBase.string=g.GetNumString(t.base),this.txtAttrNext.string=g.GetNumString(t.next))},n.onItemClick=function(){},i}(f),L=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).txtAttrName=void 0,e.txtAttrBase=void 0,e}e(i,t);var n=i.prototype;return n.onInit=function(){this.txtAttrName=u.findChildComponent(this.node,"txtAttrName",a),this.txtAttrBase=u.findChildComponent(this.node,"txtAttrBase",a)},n.onRender=function(t,e){this.txtAttrName.string=t.name,2==t.show_type?this.txtAttrBase.string=l.formatStr("%s%",g.GetNumString(t.base/100)):3==t.show_type?this.txtAttrBase.string=g.GetNumString(Math.floor(t.base/100)/100):this.txtAttrBase.string=g.GetNumString(t.base)},n.onItemClick=function(){},i}(f),w=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).imgLight=void 0,e.imgDark=void 0,e}e(i,t);var n=i.prototype;return n.onInit=function(){this.imgLight=u.findChild(this.node,"light"),this.imgDark=u.findChild(this.node,"dark")},n.onRender=function(t,e){this.imgLight.active=1==t,this.imgDark.active=0==t},n.onItemClick=function(){},i}(f);n._RF.pop()}}}));

