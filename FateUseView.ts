System.register("chunks:///_virtual/FateUseView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./NodeUtil.ts","./index57.ts","./ItemIcon.ts","./ConfigGlobal.ts","./ArtifactDataCache.ts","./EquipModel.ts","./HorseDataChche.ts","./RoleDataCache.ts","./RoleDefine.ts","./WingDataCache.ts","./FateControl.ts","./FateDataCache.ts","./FateDefine.ts","./BaseView.ts"],(function(t){"use strict";var i,e,n,s,o,a,h,d,c,l,r,f,u,v,I,C,p,g,L,b,S;return{setters:[function(t){i=t.inheritsLoose,e=t.createForOfIteratorHelperLoose},function(t){n=t.cclegacy,s=t.Button,o=t.Label,a=t.sys,h=t.Sprite},function(t){d=t.default},null,function(t){c=t.IconAseetType},function(t){l=t.ConfigGlobal},function(t){r=t.ArtifactDataCache},function(t){f=t.EquipModel},function(t){u=t.HorseDataCache},function(t){v=t.RoleDataCache},function(t){I=t.PlayerAttr},function(t){C=t.WingDataCache},function(t){p=t.default},function(t){g=t.default},function(t){L=t.FateEventDefine,b=t.FateDefine},function(t){S=t.BaseView}],execute:function(){n._RF.push({},"9ea48B+PQdDja0YZnyfvXTe","FateUseView",void 0);t("default",function(t){function n(){var i;return(i=t.call(this)||this).nodeRole=void 0,i.txtTitle=void 0,i.fateList=[],i.btnCancel=void 0,i.btnUse=void 0,i.btnLeft=void 0,i.btnRight=void 0,i.model=void 0,i.curIndex=0,i.posList=[],i.name="FateUseView",i.url="ui/module/fate/FateUseView",i}i(n,t);var h=n.prototype;return h.onInit=function(){var t=this,i=this.findChild("btnClose");this.addComponentCallbackListener(i,s.EventType.CLICK,(function(){t.close()})),this.btnLeft=this.findChild("view/btnLeft"),this.addComponentCallbackListener(this.btnLeft,s.EventType.CLICK,(function(){t.switchPage(-1)})),this.btnRight=this.findChild("view/btnRight"),this.addComponentCallbackListener(this.btnRight,s.EventType.CLICK,(function(){t.switchPage(1)})),this.btnUse=this.findChild("view/btnUse"),this.addComponentCallbackListener(this.btnUse,s.EventType.CLICK,(function(){IS(p).send_35_14(0,t.curIndex)})),this.btnCancel=this.findChild("view/btnCancel"),this.addComponentCallbackListener(this.btnCancel,s.EventType.CLICK,(function(){IS(p).send_35_14(1,t.curIndex)})),this.txtTitle=this.findChildComponent("view/title/Label",o),this.nodeRole=this.findChild("view/role");for(var e=1;e<=8;e++){var n=new m;n.init(this.findChild("view/fateList/item"+e),this,e),this.fateList.push(n)}},h.registerUpdateHandler=function(){this.addEvent(L.OnFateInfoUpdate,this.updateInfo,this)},h.onAfterOpen=function(){for(var t=IS(g).GetShowPos(),i=1;i<=8;i++){var n=IS(g).GetPosInfoByPos(i);n&&n.id&&(0==t&&(t=i),this.posList.push(n.pos_id))}if(0==t){this.createModel(),this.txtTitle.string="";for(var s,o=e(this.fateList);!(s=o()).done;){s.value.show()}this.btnUse.active=!1,this.btnCancel.active=!1,this.updateSwitchBtn()}else this.setIndex(t)},h.onBeforeClose=function(){this.curIndex=0,this.posList=[],this.removeUnitModel(this.model)},h.onDestroy=function(){},h.createModel=function(){this.removeUnitModel(this.model);var t=IS(g).GetPosInfoByPos(this.curIndex),i=IS(g).GetFateItem(null==t?void 0:t.id);this.model=this.addUnitModel({parent:this.nodeRole,job:IS(v).GetTypeUsedSkin(0),dressId:IS(v).GetTypeUsedSkin(2)||0,gender:IS(v).GetRoleAttr(I.ROLE_ATTR_GENDER),color:IS(v).GetTypeUsedSkin(1),weapon:IS(f).getShowEquipCfgIdByLocation(1),ornaments:IS(f).getShowEquipCfgIdByLocation(2),face:IS(f).getShowEquipCfgIdByLocation(3),shenqi:IS(r).artifact_id||0,mount:IS(u).horse_id,fate:null==i?void 0:i.cfg_id,wing:IS(C).wing_id}),a.uiMirror&&(this.getUnitModel(this.model).dir=-1)},h.updateInfo=function(){var t=IS(g).GetShowPos();this.btnUse.active=t!=this.curIndex,this.btnCancel.active=t==this.curIndex;for(var i,n=e(this.fateList);!(i=n()).done;){i.value.show()}},h.setIndex=function(t){if(this.curIndex!=t&&0!=this.posList.length){this.curIndex=t,this.updateSwitchBtn(),this.createModel();var i=IS(g).GetShowPos();this.btnUse.active=i!=this.curIndex,this.btnCancel.active=i==this.curIndex;var n=IS(g).GetPosInfoByPos(this.curIndex);if(null!=n&&n.id){var s=configFate.getDataByKey(IS(g).GetFateItem(n.id).cfg_id);this.txtTitle.string=s.name}else this.txtTitle.string="";for(var o,a=e(this.fateList);!(o=a()).done;){o.value.show()}}},h.updateSwitchBtn=function(){if(this.posList.length>1){var t=this.posList.indexOf(this.curIndex);this.btnLeft.active=t>0,this.btnRight.active=t<this.posList.length-1}else this.btnLeft.active=!1,this.btnRight.active=!1},h.switchPage=function(t){var i=this.posList.indexOf(this.curIndex);if(t>0){if(i>=this.posList.length-1)return}else if(i<=0)return;var e=this.posList[i+t];this.setIndex(e)},n}(S));var m=function(){function t(){this.view=void 0,this.node=void 0,this.index=void 0,this.nodeWear=void 0,this.imgBg=void 0,this.imgIcon=void 0,this.txtLevel=void 0,this.nodeLock=void 0,this.btnWear=void 0,this.used=void 0}var i=t.prototype;return i.init=function(t,i,e){this.view=i,this.node=t,this.index=e,this.onInit()},i.onInit=function(){var t=this;this.imgBg=d.findChildComponent(this.node,"imgBg",h),this.nodeLock=d.findChild(this.node,"imgLock"),this.btnWear=d.findChild(this.node,"btnWear"),this.nodeWear=d.findChild(this.node,"nodeWear"),this.used=d.findChild(this.node,"used"),this.imgIcon=d.findChildComponent(this.node,"nodeWear/imgIcon",h),this.txtLevel=d.findChildComponent(this.node,"nodeWear/txtLevel",o),this.view.addComponentCallbackListener(this.node,s.EventType.CLICK,(function(){var i,e=IS(g).GetPosInfoByPos(t.index);(null!=(i=null==e?void 0:e.state)?i:b.PosState.lock)==b.PosState.Equipped&&t.view.setIndex(t.index)}))},i.show=function(){var t;this.used.active=this.view.curIndex==this.index;var i=IS(g).GetPosInfoByPos(this.index),e=null!=(t=null==i?void 0:i.state)?t:b.PosState.lock;if(e==b.PosState.lock)this.nodeLock.active=!0,this.nodeWear.active=!1,this.btnWear.active=!1,this.view.loadIcon(this.imgBg,"fate","mg_ui_hui");else if(e==b.PosState.empty)this.nodeLock.active=!1,this.nodeWear.active=!1,this.btnWear.active=!0,this.view.loadIcon(this.imgBg,"fate","mg_ui_pinzhidi");else if(e==b.PosState.Equipped){this.nodeLock.active=!1,this.nodeWear.active=!0,this.btnWear.active=!1;var n=IS(g).GetFateItem(i.id);n&&(this.txtLevel.string="lv."+n.lv,this.view.loadIcon(this.imgBg,"fate",l.fate_quality_pos[n.cfg.quality-1][1]),this.view.loadIcon(this.imgIcon,"icon_fate",n.cfg.icon,null,c.ICON_SPRITE))}},t}();n._RF.pop()}}}));

