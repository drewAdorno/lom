System.register("chunks:///_virtual/CrossWarShopView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./index57.ts","./BagDefine.ts","./BagModel.ts","./MessageView.ts","./MallControl.ts","./MallDataCache.ts","./MallDefine.ts","./RoleDefine.ts","./BaseSubView.ts"],(function(t){"use strict";var i,e,n,o,s,a,r,d,h,l,u,c,f,m,p,v,g,I,C,y,w,S;return{setters:[function(t){i=t.inheritsLoose},function(t){e=t.cclegacy,n=t.ScrollView,o=t.Label,s=t.Sprite,a=t.Button,r=t.sys,d=t.Widget,h=t.js},function(t){l=t.ItemGrid},function(t){u=t.ListItem},function(t){c=t.default},function(t){f=t.default},null,function(t){m=t.BagEventDefine},function(t){p=t.BagModel},function(t){v=t.default},function(t){g=t.default},function(t){I=t.default},function(t){C=t.MallEventDefine,y=t.MallType},function(t){w=t.RoleEventDefine},function(t){S=t.BaseSubView}],execute:function(){e._RF.push({},"0cc9ejwlDpKkJXLQ5Pa8V8n","CrossWarShopView",void 0);var L=[1052,1053],B=(t("default",function(t){function e(){var i;return(i=t.call(this)||this).scroll=void 0,i.nodeResParent=void 0,i.nodeResItem=void 0,i.resItems=void 0,i.name="CrossWarShopView",i.url="ui/module/crosswar/CrossWarShopView",i.poolTime=3e3,i}i(e,t);var r=e.prototype;return r.onInit=function(){var t=this.findChildComponent("view/scrollList",n);this.scroll=this.addUIList(t,B),this.initResShow()},r.registerUpdateHandler=function(){this.addEvent(C.MAll_INFO_UPDATE,this.updateInfo,this),this.addEvent(m.GOODS_INFO_UPDATE,this.updateResShow,this),this.addEvent(w.ROLE_RES_UPDATE,this.updateResShow,this)},r.initResShow=function(){var t=this;this.nodeResParent=this.findChild("resRoot"),this.nodeResItem=this.findChild("resRoot/resItem"),this.nodeResItem.active=!1,this.resItems=new Array;for(var i=function(i){var e=nodeInstantiate.instantiate(t.nodeResItem),n=L[i];t.addComponentCallbackListener(e,a.EventType.CLICK,(function(){IS(p).OpenItemTips(n,c.findChild(e,"txtNum"))})),e.parent=t.nodeResParent,e.active=!0;var r=c.findChildComponent(e,"imgIcon",s),d=configGoods.getDataByKey(n);t.loadIcon(r,"icon_item",d.icon),t.resItems.push({node:e,txtNum:c.findChildComponent(e,"txtNum",o),goodsGtid:n})},e=0;e<L.length;e++)i(e)},r.onAfterOpen=function(){this.updateResShow(),IS(g).send_27_1(y.CrossWar);var t=[].concat(configMall.getDataByList("type",y.CrossWar)),i=[];for(var e in t)if(t.hasOwnProperty(e)){var n=t[e];i.push(n)}i.sort((function(t,i){return t.id-i.id})),this.scroll.datas=i},r.updateResShow=function(){for(var t=0;t<this.resItems.length;t++)this.resItems[t].txtNum.string=f.GetNumString(IS(p).getGoodsCountByGoodsGtid(this.resItems[t].goodsGtid))},r.updateInfo=function(){this.scroll.updateAll()},r.onBeforeClose=function(){},r.onDestroy=function(){if(this.resItems){for(var t=0;t<this.resItems.length;t++)this.resItems[t].node.destroy();this.resItems={}}},e}(S)),function(t){function e(){for(var i,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(i=t.call.apply(t,[this].concat(n))||this).txtName=void 0,i.txtPrice=void 0,i.priceIcon=void 0,i.btnBuy=void 0,i.out=void 0,i.txtLimit=void 0,i.itemGrid=void 0,i.num=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){var t=this;if(this.txtPrice=c.findChildComponent(this.node,"btnBuy/Label",o),this.priceIcon=c.findChildComponent(this.node,"btnBuy/Label/icon",s),this.txtName=c.findChildComponent(this.node,"txtName",o),this.num=c.findChildComponent(this.node,"num",o),this.out=c.findChild(this.node,"out"),this.out.active=!1,this.txtLimit=c.findChildComponent(this.node,"limit/Label",o),this.itemGrid=new l(this.view,c.findChild(this.node,"itemGrid")),this.btnBuy=c.findChild(this.node,"btnBuy"),this.view.addComponentCallbackListener(this.btnBuy,a.EventType.CLICK,(function(){t.out.active?v.showFlyTip(GetLanguage(200039)):uiMgr.openView("MallTipsView",t.data)})),r.uiMirror){var i=c.findChildComponent(this.node,"btnBuy/Label/icon",d);i.alignFlags=32,i.right=-45}},n.onRender=function(t,i){this.txtName.string=t.name;var e=configGoods.getDataByKey(t.price[0]);this.txtPrice.string=t.price[1],this.view.loadIcon(this.priceIcon,"icon_item",e.icon),this.itemGrid.SetItemId(t.goods[0],t.goods[1]),this.out.active=!1;var n=IS(I).GetBuyInfoByType(t.type);if(-1!=t.limit){var o;this.num.node.active=!0;var s=null!=(o=n[t.id])?o:0,a="";switch(t.refresh_way){case 0:a=GetLanguage(200040);break;case 1:a=GetLanguage(200041);break;case 2:a=GetLanguage(200042)}s>=t.limit?(this.out.active=!0,this.num.string=h.formatStr(a+"\n%s/%s",t.limit-s,t.limit)):(this.out.active=!1,this.num.string=h.formatStr(a+"\n%s/%s",t.limit-s,t.limit))}else this.num.node.active=!1},e}(u));e._RF.pop()}}}));

