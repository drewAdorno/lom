System.register("chunks:///_virtual/ActivityMergeServersDataCache.ts",["./rollupPluginModLoBabelHelpers.js","cc","./RedPointMgr.ts","./BagDefine.ts","./BagModel.ts","./BattlePassControl.ts","./ActivityControl.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./ActivityMergeServersControl.ts","./ActivityMergeServersDefine.ts"],(function(e){"use strict";var t,n,r,o,i,s,a,u,d,c,f,g,v;return{setters:[function(e){t=e.createForOfIteratorHelperLoose},function(e){n=e.cclegacy},function(e){r=e.RedPointMgr},function(e){o=e.BagEventDefine},function(e){i=e.BagModel},function(e){s=e.default},function(e){a=e.default},function(e){u=e.default},function(e){d=e.ActivityState,c=e.ActivityType,f=e.ActivityEventDefine},function(e){g=e.default},function(e){v=e.ActivityMergeServersEvent}],execute:function(){n._RF.push({},"b9fcf7hi/tGzrvoEop2VpDs","ActivityMergeServersDataCache",void 0);e("default",function(){var e=n.prototype;function n(){this.sendProList=[{type:c.MergeServersLottery,send:function(){IS(a).send_act_double_draw_info(c.MergeServersLottery)},redCheck:function(){}},{type:c.MergeCohesion,send:function(){IS(g).send_24_175(c.MergeCohesion)},redCheck:function(){}},{type:c.MergeServersGuild,send:function(){IS(g).send_24_173(c.MergeServersGuild)},redCheck:function(){}}],this.guildInfoInfo={count:0,got_reward:[]},this.cohesionInfo={process:0,got_reward:[]},normalEvent.on(f.OnActivityListUpdate,this.activityChange,this),normalEvent.on(f.OnActivityInfoUpdate,this.activityChange,this),normalEvent.on(o.GOODS_INFO_UPDATE,this.onBagUpdate,this)}return e.clear=function(){},e.activityChange=function(e){void 0===e&&(e=null);for(var t=0;t<this.sendProList.length;t++){var n=this.sendProList[t].type;if(!e||e.type==n){var r=IS(u).GetActivityInfo(n);r&&r.state==d.Open?this.sendProList[t].send():this.sendProList[t].redCheck&&this.sendProList[t].redCheck()}}},e.onBagUpdate=function(e,t){1824==t&&(IS(u).UpdateMainRedByActType(c.MergeServersPass),IS(r).changeValue("merge_servers_pass",this.getPassRedNum())),1826==t&&IS(u).UpdateMainRedByActType(c.MergeCohesion)},e.updateGuildInfo=function(e){var t;this.guildInfoInfo.count=e.count,this.guildInfoInfo.got_reward=null!=(t=e.got_reward)?t:[],normalEvent.emit(v.OnMergeGuildInfoUpdate),IS(u).UpdateMainRedByActType(c.MergeServersGuild)},e.getGuildInfo=function(){return this.guildInfoInfo},e.updateCohesionInfo=function(e){var t;this.cohesionInfo.process=e.process,this.cohesionInfo.got_reward=null!=(t=e.got_reward)?t:[],normalEvent.emit(v.OnCohesionInfoUpdate),IS(u).UpdateMainRedByActType(c.MergeCohesion)},e.getCohesionInfo=function(){return this.cohesionInfo},e.GetRedNum=function(){var e=0;return e+=this.GetLoginRedNum(),e+=this.getPassRedNum(),e+=this.getLotteryRed(),e+=this.GetGuildRed()},e.GetLoginRedNum=function(){var e,n=IS(u).GetActivityInfo(c.MergeServersLogin);if(!n||n.state!=d.Open)return 0;var r=IS(u).GetSignInfo(c.MergeServersLogin);if(!r)return 0;for(var o,i=null!=(e=r.get_day)?e:[],s=configAct_login.getDatas(),a=t(s);!(o=a()).done;){var f=o.value;if(f.act_type==n.type&&f.group_id==n.roundCfg.group_id&&r.day>=f.day&&!i.includes(f.id))return 1}return 0},e.getPassRedNum=function(){var e=IS(u).GetActivityInfo(c.MergeServersPass);if(!e||e.state!=d.Open)return 0;var t=0,n=e.roundCfg.group_id;return t=(t=t+s.checkRewardRP(n)>=0?1:0)+s.checkAddRewardRP(n)>0?1:0,t+=s.checkSpecialRewardRP(n),IS(i).getGoodsCountByGoodsGtid(1824)>0&&t++,t},e.GetCohesionRed=function(){var e=IS(u).GetActivityInfo(c.MergeCohesion);if(!e||e.state!=d.Open)return 0;for(var n,r=0,o=configAct_cohesion_reward.getDatas(),s=t(o);!(n=s()).done;){var a=n.value;a.act_type==e.type&&a.act_group==e.roundCfg.group_id&&this.cohesionInfo.process>=a.limit&&!this.cohesionInfo.got_reward.includes(a.id)&&r++}return IS(i).getGoodsCountByGoodsGtid(1826)>0&&r++,r},e.GetGuildRed=function(){var e=IS(u).GetActivityInfo(c.MergeServersGuild);if(!e||e.state!=d.Open)return 0;for(var n,r=0,o=configAct_guild_pay.getDatas(),i=t(o);!(n=i()).done;){var s=n.value;s.act_type==c.MergeServersGuild&&s.group_id==e.roundCfg.group_id&&this.guildInfoInfo.count>=s.pay_num&&!this.guildInfoInfo.got_reward.includes(s.id)&&r++}return r},e.getLotteryRed=function(){var e=IS(u).GetActivityInfo(c.MergeServersLottery);if(!e||e.state!=d.Open)return 0;var t=0,n=IS(u).getLotteryInfo(c.MergeServersLottery);if(!n)return 0;var r=configDouble_cumulative_reward.getDatas();for(var o in r)if(r.hasOwnProperty(o)){var s=r[o];if(n.count>=s.time&&!n.count_reward_list[s.id]&&s.act_type==e.type&&s.group_id==e.roundCfg.group_id)return t++}var a=IS(u).getLotteryCost(c.MergeServersLottery)[0];return IS(i).getGoodsCountByGoodsGtid(a)>=1&&t++,t},n}());n._RF.pop()}}}));

