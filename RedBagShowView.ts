System.register("chunks:///_virtual/RedBagShowView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./RoleDataCache.ts","./RoleDefine.ts","./BaseView.ts"],(function(i){"use strict";var e,t,n,o,a,d,s,r,h,m,l,f,c,g,u,v,p;return{setters:[function(i){e=i.inheritsLoose},function(i){t=i.cclegacy,n=i.Button,o=i.Sprite,a=i.Label,d=i.ScrollView,s=i.sys,r=i.Widget,h=i.Vec3,m=i.js},function(i){l=i.ListItem},function(i){f=i.default},function(i){c=i.default},function(i){g=i.default},null,function(i){u=i.RoleDataCache},function(i){v=i.PlayerAttr},function(i){p=i.BaseView}],execute:function(){t._RF.push({},"775beH20fBIl4PuJfER/5Mw","RedBagShowView",void 0);i("RedBagShowView",function(i){function t(){var e,t,n;return(n=i.call(this)||this).scroll=void 0,n.senderHead=void 0,n.senderName=void 0,n.imgHeadFrame=void 0,n.desc=void 0,n.endTip=void 0,n.noRedTip=void 0,n.rewardNum=void 0,n.maxRewardNum=void 0,n.maxNum=void 0,n.maxRole=void 0,n.isRewardEnd=void 0,n.redInfo=void 0,n.bg=void 0,n.star=void 0,n.activityWa=void 0,n.activityWaTime={openTime:{year:2024,month:4,day:26,h:0,min:0,s:0},endTime:{year:2024,month:5,day:26,h:23,min:59,s:59}},n.redBagImg=((e={})[1]="redpacket_ui_hb2_3",e[2]="redpacket_ui_hb2_2",e[3]="redpacket_ui_hb2_1",e),n.redBagBgPosY=((t={})[1]=-63,t[2]=-63,t[3]=-82,t),n.name="RedBagShowView",n.url="ui/module/Chat/RedBagShowView",n.poolTime=3e3,n}e(t,i);var l=t.prototype;return l.onInit=function(){var i=this;this.addComponentCallbackListener(this.findChild("imgMask"),n.EventType.CLICK,(function(){i.close()})),this.addComponentCallbackListener(this.findChild("btnClose"),n.EventType.CLICK,(function(){i.close()})),this.star=this.findChild("star"),this.bg=this.findChildComponent("bg",o),this.senderHead=this.findChildComponent("head/image",o),this.imgHeadFrame=this.findChildComponent("head/imgHeadFrame",o),this.senderName=this.findChildComponent("name",a),this.desc=this.findChildComponent("desc",a),this.rewardNum=this.findChildComponent("num",a);var e=this.findChildComponent("ScrollView",d);if(this.scroll=this.addUIList(e,C),this.maxNum=this.findChildComponent("maxNum",a),this.maxRewardNum=this.findChildComponent("maxRewardNum",a),this.endTip=this.findChild("noRedTip"),this.noRedTip=this.findChildComponent("noRedTip/noRedTip",a),this.activityWa=this.findChild("activityWa"),s.uiMirror){var t=this.findChildComponent("num/item",r);t.alignFlags=32,t.right=-65.614;var h=this.findChildComponent("maxRewardNum/item",r);h.alignFlags=32,h.right=-30.975}},l.onAfterOpen=function(){this.redInfo=null,this.redInfo=this.openArgs[0];var i,e=configRed_packet.getDataByKey(this.redInfo.cfg_id);this.loadIcon(this.bg,"red_bag",this.redBagImg[e.quality]),this.bg.node.position=new h(0,this.redBagBgPosY[e.quality],0),this.loadRemoteIcon(this.redInfo.head.url,this.senderHead),this.senderName.string=this.redInfo.name,this.desc.string=e.title;var t=IS(u).GetRoleAttr(v.ROLE_ATTR_ID);this.maxNum.string=c.formatStrWithMirrorDeal(GetLanguage(200193),this.redInfo.roles.length,this.redInfo.red_sum),this.maxRewardNum.string=m.formatStr("%s/%s",this.redInfo.goods_remain,this.redInfo.goods_sum),this.isRewardEnd=this.redInfo.roles.length==this.redInfo.red_sum,this.maxRole=null;for(var n=0;n<this.redInfo.roles.length;n++){var o=this.redInfo.roles[n];o.role_id==t&&(i=o),(!this.maxRole||o.num>this.maxRole.num)&&(this.maxRole=o)}i?(this.rewardNum.node.active=!0,this.rewardNum.string=m.formatStr("X%s",i.num),this.endTip.active=!1):(this.rewardNum.node.active=!1,this.endTip.active=!0,this.isRewardEnd?this.noRedTip.string=GetLanguage(200195):this.noRedTip.string=GetLanguage(200194)),this.scroll.datas=this.redInfo.roles;var a=this.redInfo.head.frame_id;if(a>0){var d=configAvatar_frame.getDataByKey(a);this.loadIcon(this.imgHeadFrame,"icon_frame",d.icon),this.imgHeadFrame.node.active=!0}else this.imgHeadFrame.node.active=!1;var s=!1;if(this.activityWaTime.openTime){var r=this.activityWaTime.openTime,l=g.getLocalTimeToUTC8(r.year,r.month,r.day,r.h,r.min,r.s);s=g.serverTime>=l}if(this.activityWaTime.endTime){var f=this.activityWaTime.endTime,p=g.getLocalTimeToUTC8(f.year,f.month,f.day,f.h,f.min,f.s);s=s&&g.serverTime<p}this.activityWa.active=s},l.registerUpdateHandler=function(){},l.onBeforeClose=function(){},l.onDestroy=function(){},t}(p));var C=function(i){function t(){for(var e,t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return(e=i.call.apply(i,[this].concat(n))||this).name=void 0,e.rewardNum=void 0,e.headImg=void 0,e.imgHeadFrame=void 0,e.goodNode=void 0,e}e(t,i);var n=t.prototype;return n.onInit=function(){if(this.headImg=f.findChildComponent(this.node,"head/image",o),this.imgHeadFrame=f.findChildComponent(this.node,"head/imgHeadFrame",o),this.name=f.findChildComponent(this.node,"name",a),this.rewardNum=f.findChildComponent(this.node,"rewardNum",a),this.goodNode=f.findChild(this.node,"rewardNum/goodIcon"),s.uiMirror){var i=f.findChildComponent(this.node,"rewardNum/goodIcon",r);i.alignFlags=32,i.right=-127.958;var e=f.findChildComponent(this.node,"rewardNum/item",r);e.alignFlags=32,e.right=-61.197}},n.onRender=function(i,e){this.name.string=i.name,this.view.loadRemoteIcon(i.head.url,this.headImg),this.rewardNum.string=m.formatStr("%s",i.num);var t=this.view.maxRole;t&&this.view.isRewardEnd&&t.num==i.num?this.goodNode.active=!0:this.goodNode.active=!1;var n=i.head.frame_id;if(n>0){this.imgHeadFrame.node.active=!0;var o=configAvatar_frame.getDataByKey(n);this.view.loadIcon(this.imgHeadFrame,"icon_frame",o.icon)}else this.imgHeadFrame.node.active=!1},n.destroy=function(){},t}(l);t._RF.pop()}}}));

