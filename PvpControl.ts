System.register("chunks:///_virtual/PvpControl.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BattleData.ts","./BattleDataFill.ts","./EnumDefine.ts","./index57.ts","./ObjectUtil.ts","./BattleMainServer.ts","./ChapterControl.ts","./ChapterDataCache.ts","./ChapterDefine.ts","./MessageView.ts","./ControlMgr.ts","./MainViewModel.ts","./ParkingDataCache.ts","./RoleDataCache.ts","./PvpDataCache.ts","./PvpDefine.ts","./UIDefine.ts"],(function(e){"use strict";var a,t,n,r,s,o,i,_,c,p,l,d,u,v,h,y,f,g,L,P,T,w,S;return{setters:[function(e){a=e.createForOfIteratorHelperLoose},function(e){t=e.cclegacy},function(e){n=e.ChapterType,r=e.PlayerData,s=e.BattleData},function(e){o=e.BattleDataFill},function(e){i=e.RunState,_=e.RunMode,c=e.RecordSource},null,function(e){p=e.default},function(e){l=e.BattleMainServer},function(e){d=e.default},function(e){u=e.ChapterDataCache},function(e){v=e.ChapterEventDefine,h=e.DungeonDefine},function(e){y=e.default},function(e){f=e.controlMgr},function(e){g=e.MainViewModel},function(e){L=e.ParkingDataCache},function(e){P=e.RoleDataCache},function(e){T=e.PvpDataCache},function(e){w=e.PvpEventDefine},function(e){S=e.PanelTabType}],execute:function(){t._RF.push({},"46b62tQrWpJO6zw6TWIwq02","PvpControl",void 0);e("default",function(){var e=t.prototype;function t(){this.reopenViewQueue=[],netManager.addEventListener("arena.arena_info_s2c",this.on_arena_info_s2c,this),netManager.addEventListener("arena.arena_refresh_s2c",this.on_arena_refresh_s2c,this),netManager.addEventListener("arena.arena_rank_list_s2c",this.on_arena_rank_list_s2c,this),netManager.addEventListener("arena.arena_combat_s2c",this.on_arena_combat_s2c,this),netManager.addEventListener("arena.arena_result_s2c",this.on_arena_result_s2c,this),netManager.addEventListener("arena.arena_role_info_s2c",this.on_arena_role_info_s2c,this),netManager.addEventListener("arena.arena_history_s2c",this.on_arena_history_s2c,this),netManager.addEventListener("arena.arena_video_play_s2c",this.on_arena_video_play_s2c,this),netManager.addEventListener("arena.arena_buy_s2c",this.on_arena_buy_s2c,this),netManager.addEventListener("solo.solo_start_s2c",this.on_solo_start_s2c,this),netManager.addEventListener("solo.solo_result_s2c",this.on_solo_result_s2c,this),netManager.addEventListener("solo.solo_video_s2c",this.on_solo_video_s2c,this),netManager.addEventListener("cross_pvp.cross_pvp_info_s2c",this.on_cross_pvp_info_s2c,this),netManager.addEventListener("cross_pvp.cross_pvp_combat_s2c",this.on_cross_pvp_combat_s2c,this),netManager.addEventListener("cross_pvp.cross_pvp_result_s2c",this.on_cross_pvp_result_s2c,this),netManager.addEventListener("cross_pvp.cross_pvp_history_s2c",this.on_cross_pvp_history_s2c,this),netManager.addEventListener("cross_pvp.cross_pvp_video_play_s2c",this.on_cross_pvp_video_play_s2c,this),netManager.addEventListener("cross_pvp.cross_pvp_sign_up_s2c",this.on_cross_pvp_sign_up_s2c,this),netManager.addEventListener("cross_pvp.cross_pvp_rank_change_s2c",this.on_cross_pvp_rank_change_s2c,this),netManager.addEventListener("cross_pvp.cross_pvp_rank_info_s2c",this.on_cross_pvp_rank_info_s2c,this),normalEvent.on(v.CHAPTER_BATTLE_RESUTL,this.signal_show_dialog,this),f.addControl(this)}return e.clear=function(){printLog("PvpControl")},e.onLogin=function(){this.reqCrossPvpInfo()},e.onReconnect=function(){},e.reqArenaInfo=function(){netManager.send("arena.arena_info_c2s",{})},e.reqArenaRefresh=function(){netManager.send("arena.arena_refresh_c2s",{})},e.reqArenaCombat=function(e){var a=IS(u);0==a.currentLoadType&&(a.chapterType=n.Arena,a.currentLoadType=a.chapterType,a.battleData=null,netManager.send("arena.arena_combat_c2s",{eid:e}),normalEvent.emit(v.BATTLE_STATE,n.Arena,!0))},e.reqRankList=function(){netManager.send("arena.arena_rank_list_c2s",{})},e.reqArenaResult=function(e,a){netManager.send("arena.arena_result_c2s",{vid:e,wid:a})},e.reqArenaRoleInfo=function(e){netManager.send("arena.arena_role_info_c2s",{role_id:e})},e.reqRecordList=function(){netManager.send("arena.arena_history_c2s",{})},e.reqRecordInfo=function(e,a){void 0===a&&(a=0);var t=IS(u);0==t.currentLoadType&&(t.chapterType=n.Arena,t.currentLoadType=t.chapterType,t.battleData=null,netManager.send("arena.arena_video_play_c2s",{vid:e,source:a}))},e.reqBuyTicket=function(e,a){netManager.send("arena.arena_buy_c2s",{chapter_type:e,buy_count:a})},e.reqSoloStart=function(e,a){var t=IS(u);0==t.currentLoadType&&(t.chapterType=n.RoleSolo,t.currentLoadType=t.chapterType,t.battleData=null,this.reopenViewQueue.length=0,a&&a.length>0&&(this.reopenViewQueue=p.clone(a)),netManager.send("solo.solo_start_c2s",{target_id:e}),normalEvent.emit(v.BATTLE_STATE,n.RoleSolo,!0))},e.reqSoloResult=function(e,a){netManager.send("solo.solo_result_c2s",{vid:e,winner:a})},e.reqSoloVideo=function(e,a){void 0===a&&(a=0);var t=IS(u);0==t.currentLoadType&&(t.chapterType=n.RoleSolo,t.currentLoadType=t.chapterType,t.battleData=null,netManager.send("solo.solo_video_c2s",{vid:e,source:a}))},e.reqSoloVideoShare=function(e){netManager.send("solo.solo_video_share_c2s",{vid:e})},e.reqCrossPvpInfo=function(){netManager.send("cross_pvp.cross_pvp_info_c2s",{})},e.reqCrossPvpCombat=function(e){var a=IS(u);0==a.currentLoadType&&(a.chapterType=n.CrossPvp,a.currentLoadType=a.chapterType,a.battleData=null,netManager.send("cross_pvp.cross_pvp_combat_c2s",{eid:e}),normalEvent.emit(v.BATTLE_STATE,n.CrossPvp,!0),uiMgr.HideAllView(["MainView","BattleHubView"]),battleMain.enterChapter(0))},e.reqCrossPvpResult=function(e){netManager.send("cross_pvp.cross_pvp_result_c2s",{wid:e})},e.reqCrossPvpHistory=function(){netManager.send("cross_pvp.cross_pvp_history_c2s",{})},e.reqCrossPvpReplay=function(e,a){void 0===a&&(a=0);var t=IS(u);0==t.currentLoadType&&(t.chapterType=n.CrossPvp,t.currentLoadType=t.chapterType,t.battleData=null,netManager.send("cross_pvp.cross_pvp_video_play_c2s",{vid:e,source:a}))},e.reqCrossPvpSignUp=function(){netManager.send("cross_pvp.cross_pvp_sign_up_c2s",{})},e.reqCrossPvpRankInfo=function(e){netManager.send("cross_pvp.cross_pvp_rank_info_c2s",{page:e})},e.on_arena_info_s2c=function(e){IS(T).enemyList=e.enemy_list,IS(T).pvpInfo=e,IS(T).buy_times=e.buy_times,normalEvent.emit(w.PVP_INFO,e)},e.on_arena_refresh_s2c=function(e){0==e.code&&(IS(T).enemyList=e.enemy_list,normalEvent.emit(w.PVP_INFO,e))},e.on_arena_rank_list_s2c=function(e){IS(T).rankList=e,normalEvent.emit(w.PVP_RANK_LIST,e)},e.on_arena_result_s2c=function(e){var a={isWin:e.is_win>0,objs:[{score:e.my_score,scoreChange:e.my_score_change,rank:e.my_rank,name:"",head:""},{score:e.e_score,scoreChange:e.e_score_change,rank:e.e_rank,name:e.e_name,head:e.e_head.url}]};IS(T).result=a},e.on_arena_role_info_s2c=function(e){uiMgr.openView("RoleNoticeView",2,e),normalEvent.emit(w.PVP_ROLE_INFO,e.arena_role)},e.on_arena_history_s2c=function(e){IS(T).recordList=e.history_list,normalEvent.emit(w.PVP_RECORD_LIST)},e.on_arena_combat_s2c=function(e){var a=IS(u);if(a.currentLoadType==n.Arena){if(a.currentLoadType=0,e.code>0||!e.atk_data||!e.def_data)return IS(d).reqEnterChapter(0),void normalEvent.emit(v.BATTLE_STATE,n.Arena,!1);var t=new s;t.chapterId=50001,t.seed=e.seed,t.chapterType=n.Arena,t.playerList[1]=new r(1),t.playerList[2]=new r(2),this.setPlayerList(e.atk_data,t.playerList[1]),this.setPlayerList(e.def_data,t.playerList[2]);var o=new l(e.seed);for(o.start(t);o.runState==i.Running;)o.update(o.frameTime);this.reqArenaResult(e.vid,0==o.result?e.atk_data.id:e.def_data.id),o.stop();var _=new s;_.chapterType=n.Arena,_.chapterId=50001,_.seed=e.seed,_.playerList[1]=new r(1),_.playerList[2]=new r(2),_.battleCheckout=2,this.setPlayerList(e.atk_data,_.playerList[1]),this.setPlayerList(e.def_data,_.playerList[2]),a.battleData=_}},e.on_arena_video_play_s2c=function(e){var a=IS(u);if(a.currentLoadType==n.Arena&&(a.currentLoadType=0,0==e.code)){uiMgr.close("ChatView"),battleMain.enterChapter(0);var t=new s;t.chapterId=50001,t.seed=e.seed,t.chapterType=n.Arena,t.recordType=1,t.recordWin=e.winner_id==e.atk_data.id?1:2,t.source=e.source,t.playerList[1]=new r(1),t.playerList[2]=new r(2),this.setPlayerList(e.atk_data,t.playerList[1]),this.setPlayerList(e.def_data,t.playerList[2]),a.battleData=t,normalEvent.emit(v.BATTLE_STATE,n.Arena,!0)}},e.setPlayerList=function(e,a){o.setPlayerList(e,a,IS(u).chapterType)},e.on_arena_buy_s2c=function(e){e.chapter_type==h.CHAPTER_TYPE_PVP?IS(T).buy_times=e.buy_times:e.chapter_type==h.CHAPTER_TYPE_CROSS_PVP&&(IS(T).buy_times_cross=e.buy_times),normalEvent.emit(w.PVP_BUY_TIME)},e.signal_show_dialog=function(e,t,r,s,o,i){if(t==n.Arena&&(s==_.Record?i==c.default&&(uiMgr.openView("PvpMainView"),uiMgr.openView("PvpRecordView")):uiMgr.openView("PvpResultView",1)),t==n.RoleSolo){if(this.reopenViewQueue.length>0){for(var p,l=a(this.reopenViewQueue);!(p=l()).done;){var d,u=p.value,v=u[0],h=u[1];(d=uiMgr).openView.apply(d,[v].concat(h))}this.reopenViewQueue.length=0}s==_.Record?i==c.default&&uiMgr.openView("FarmPvpResultView",t):uiMgr.openView("FarmPvpResultView",t)}t==n.CrossPvp&&(s==_.Record?i==c.default&&(uiMgr.openView("PvpMainView",2),uiMgr.openView("PvpCompetitionRecordView")):uiMgr.openView("PvpResultView",2)),t==n.HalloweenPvp&&(uiMgr.openView("RobCaseView"),uiMgr.openView("RobCasePvpView")),t==n.ParkPvp&&(s==_.Record?i==c.default&&(IS(g).TryJumpToMainViewPanel(S.Main_Mystery),uiMgr.openView("ParkingMainView",IS(L).type,IS(L).master_id)):(IS(g).TryJumpToMainViewPanel(S.Main_Mystery),uiMgr.openView("ParkingMainView",IS(L).type,IS(L).master_id),uiMgr.openView("ParkingPvpResultView"))),t==n.CrossParkPvp&&(s==_.Record?i==c.default&&(IS(g).TryJumpToMainViewPanel(S.Main_Mystery),uiMgr.openView("ParkingMainView",IS(L).type,IS(L).master_id)):(IS(g).TryJumpToMainViewPanel(S.Main_Mystery),uiMgr.openView("ParkingMainView",IS(L).type,IS(L).master_id),uiMgr.openView("ParkingPvpResultView")))},e.on_solo_start_s2c=function(e){var a=IS(u);if(a.currentLoadType==n.RoleSolo){if(a.currentLoadType=0,0!=e.code&&y.showFlyTip(configErrorInfo.getDataByKey(e.code).info),0!=e.code||!e.atk_data||!e.def_data)return IS(d).reqEnterChapter(0),normalEvent.emit(v.BATTLE_STATE,n.RoleSolo,!1),void(this.reopenViewQueue.length=0);uiMgr.closeAllView(["MainView","MessageView","GuideView","BattleHubView"]),uiMgr.getOpenView("MainView").setIndex(0);var t=new s;t.chapterId=120001,t.seed=e.seed,t.chapterType=n.RoleSolo,t.playerList[1]=new r(1),t.playerList[2]=new r(2),this.setPlayerList(e.atk_data,t.playerList[1]),this.setPlayerList(e.def_data,t.playerList[2]);var o=new l(e.seed);for(o.start(t);o.runState==i.Running;)o.update(o.frameTime);this.reqSoloResult(e.vid,0==o.result?e.atk_data.id:e.def_data.id),o.stop();var _=new s;_.chapterType=n.RoleSolo,_.chapterId=120001,_.seed=e.seed,_.playerList[1]=new r(1),_.playerList[2]=new r(2),this.setPlayerList(e.atk_data,_.playerList[1]),this.setPlayerList(e.def_data,_.playerList[2]),a.battleData=_}},e.on_solo_result_s2c=function(e){var a={isWin:e.winner==IS(P).GetRoleId(),objs:[{name:IS(P).GetRoleName(),head:IS(P).GetHeadUrl()},{name:e.def_data.name,head:null!=e.target_head?e.target_head.url:""}]};IS(T).cacheSoloData={atk_role:e.atk_data,def_role:e.def_data,vid:e.vid,win_id:e.winner},IS(T).result=a},e.on_solo_video_s2c=function(e){var a=IS(u);if(a.currentLoadType==n.RoleSolo&&(a.currentLoadType=0,0==e.code)){uiMgr.close("ChatView"),battleMain.enterChapter(0);var t=new s;t.chapterId=120001,t.seed=e.seed,t.chapterType=n.RoleSolo,t.recordType=1,t.recordWin=e.winner_id==e.atk_data.id?1:2,t.source=e.source,t.playerList[1]=new r(1),t.playerList[2]=new r(2),this.setPlayerList(e.atk_data,t.playerList[1]),this.setPlayerList(e.def_data,t.playerList[2]),a.battleData=t,normalEvent.emit(v.BATTLE_STATE,n.RoleSolo,!0)}},e.on_cross_pvp_info_s2c=function(e){var a=IS(T);if(a.CrossPvpInfo=e,IS(T).buy_times_cross=e.buy_times,0==a.CrossPvpRankList.length&&this.reqCrossPvpRankInfo(1),IS(T).cachePage&&IS(T).cachePage>1)for(var n=2;n<=IS(T).cachePage;n++)IS(t).reqCrossPvpRankInfo(n);normalEvent.emit(w.CROSS_PVP_INFO_UPDATE)},e.on_cross_pvp_combat_s2c=function(e){var a=IS(u);if(a.currentLoadType==n.CrossPvp){if(a.currentLoadType=0,e.code>0||!e.atk_data||!e.def_data)return IS(d).reqEnterChapter(0),void normalEvent.emit(v.BATTLE_STATE,n.CrossPvp,!1);uiMgr.close("ChatView");var t=new s;t.chapterId=150001,t.seed=e.seed,t.chapterType=n.CrossPvp,t.playerList[1]=new r(1),t.playerList[2]=new r(2),this.setPlayerList(e.atk_data,t.playerList[1]),this.setPlayerList(e.def_data,t.playerList[2]);var o=new l(e.seed);for(o.start(t);o.runState==i.Running;)o.update(o.frameTime);this.reqCrossPvpResult(0==o.result?e.atk_data.id:e.def_data.id),o.stop();var _=new s;_.chapterType=n.CrossPvp,_.chapterId=150001,_.seed=e.seed,_.playerList[1]=new r(1),_.playerList[2]=new r(2),_.battleCheckout=2,this.setPlayerList(e.atk_data,_.playerList[1]),this.setPlayerList(e.def_data,_.playerList[2]),a.battleData=_}},e.on_cross_pvp_result_s2c=function(e){var a={isWin:e.is_win>0,objs:[{score:e.my_score,scoreChange:e.my_score_change,rank:e.my_rank,name:"",head:""},{score:e.e_score,scoreChange:e.e_score_change,rank:e.e_rank,name:e.e_name,head:e.e_head.url}]};IS(T).result=a},e.on_cross_pvp_history_s2c=function(e){normalEvent.emit(w.CROSS_PVP_HISTORY,e)},e.on_cross_pvp_video_play_s2c=function(e){var a=IS(u);if(a.currentLoadType==n.CrossPvp&&(a.currentLoadType=0,0==e.code)){uiMgr.close("ChatView"),battleMain.enterChapter(0);var t=new s;t.chapterId=150001,t.seed=e.seed,t.chapterType=n.CrossPvp,t.recordType=1,t.recordWin=e.winner_id==e.atk_data.id?1:2,t.source=e.source,t.playerList[1]=new r(1),t.playerList[2]=new r(2),this.setPlayerList(e.atk_data,t.playerList[1]),this.setPlayerList(e.def_data,t.playerList[2]),a.battleData=t,normalEvent.emit(v.BATTLE_STATE,n.CrossPvp,!0)}},e.on_cross_pvp_sign_up_s2c=function(){normalEvent.emit(w.CROSS_PVP_REFRESH_REQ)},e.on_cross_pvp_rank_change_s2c=function(e){IS(T).updateRankListInfo(e.change_list)},e.on_cross_pvp_rank_info_s2c=function(e){var a=IS(T);a.updateRankList(e.rank_list),a.cur_page=e.page,a.max_page=e.max_page,a.total_num=e.total_num,normalEvent.emit(w.CROSS_PVP_RANK_UPDATE),a.cachePage>1?a.cachePage==e.page&&(a.cachePage=null,normalEvent.emit(w.CROSS_PVP_RANK_UPDATE_RankPos),a.cachePos=null):(a.cachePage=null,a.cachePos=null)},t}());t._RF.pop()}}}));

