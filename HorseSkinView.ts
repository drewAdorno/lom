System.register("chunks:///_virtual/HorseSkinView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./index57.ts","./ItemIcon.ts","./BagModel.ts","./HorseControl.ts","./HorseDataChche.ts","./HorseDefine.ts","./BaseSubView.ts"],(function(t){"use strict";var i,e,n,o,s,h,r,l,a,d,c,f,I,S,k,v,g,u,m,C,p,b,D;return{setters:[function(t){i=t.inheritsLoose,e=t.createForOfIteratorHelperLoose},function(t){n=t.cclegacy,o=t.Button,s=t.sys,h=t.Layout,r=t.ScrollView,l=t.UITransform,a=t.Node,d=t.Label,c=t.Sprite,f=t.js},function(t){I=t.ItemGrid},function(t){S=t.SelectedType,k=t.ListItem},function(t){v=t.default},function(t){g=t.default},null,function(t){u=t.IconAseetType},function(t){m=t.BagModel},function(t){C=t.default},function(t){p=t.HorseDataCache},function(t){b=t.HorseEvent},function(t){D=t.BaseSubView}],execute:function(){n._RF.push({},"8188asXmGRIVYCpFgAosc8D","HorseSkinView",void 0);t("default",function(t){function n(){var i;return(i=t.call(this)||this).nodeRoot=void 0,i.btnUnlock=void 0,i.btnUse=void 0,i.btnCancel=void 0,i.btnLeft=void 0,i.btnRight=void 0,i.btnUseSkill=void 0,i.btnNoUseSkill=void 0,i.btnUpgrade=void 0,i.nodeItem=void 0,i.nodeTop=void 0,i.HorseUIList=void 0,i.starUIList=void 0,i.imgFrame=void 0,i.imgIcon=void 0,i.horseEffectID=0,i.skinIDSel=void 0,i.starInfo=[],i.horseInfo=[],i.name="HorseSkinView",i.url="ui/module/horse/HorseSkinView",i.poolTime=3e3,i}i(n,t);var k=n.prototype;return k.onInit=function(){var t=this;this.nodeRoot=this.findChild("root"),this.btnUnlock=this.findChild("root/btnUnlock"),this.addComponentCallbackListener(this.btnUnlock,o.EventType.CLICK,(function(){IS(C).reqSkinLevelUp(t.skinIDSel)})),s.uiMirror&&(this.dealMirrorLayout(this.findChildComponent("root/nodeChange/common_ui_xiaotidi",h)),this.dealMirrorLayout(this.findChildComponent("root/nodeSkill/common_ui_xiaotidi",h))),this.btnUseSkill=this.findChild("root/nodeSkill/btnUse"),this.addComponentCallbackListener(this.btnUseSkill,o.EventType.CLICK,(function(){IS(C).reqUseSkill(t.skinIDSel)})),this.btnNoUseSkill=this.findChild("root/nodeSkill/btnNoUse"),this.addComponentCallbackListener(this.btnNoUseSkill,o.EventType.CLICK,(function(){IS(C).reqUseSkill(0)})),this.btnCancel=this.findChild("root/nodeShow/btnCancel"),this.addComponentCallbackListener(this.btnCancel,o.EventType.CLICK,(function(){IS(C).reqUseHorse(0)})),this.btnUse=this.findChild("root/nodeShow/btnUse"),this.addComponentCallbackListener(this.btnUse,o.EventType.CLICK,(function(){IS(C).reqUseHorse(t.skinIDSel)})),this.btnLeft=this.findChild("root/nodeShow/btnLeft"),this.addComponentCallbackListener(this.btnLeft,o.EventType.CLICK,(function(){for(var i,n=e(t.horseInfo);!(i=n()).done;){var o=i.value;if(o.skin==t.skinIDSel){t.skinIDSel=t.horseInfo[t.horseInfo.indexOf(o)-1].skin;break}}t.refreshAll()})),this.btnRight=this.findChild("root/nodeShow/btnRight"),this.addComponentCallbackListener(this.btnRight,o.EventType.CLICK,(function(){for(var i,n=e(t.horseInfo);!(i=n()).done;){var o=i.value;if(o.skin==t.skinIDSel){t.skinIDSel=t.horseInfo[t.horseInfo.indexOf(o)+1].skin;break}}t.refreshAll()})),this.btnUpgrade=this.findChild("root/nodeSkill/btnUpgrade"),this.addComponentCallbackListener(this.btnUpgrade,o.EventType.CLICK,(function(){uiMgr.openView("HorseUpgradeInfoView",t.skinIDSel,IS(p).getSkinLevelByID(t.skinIDSel))}));var i=this.findChildComponent("root/ScrollView",r);this.HorseUIList=this.addUIList(i,y),this.HorseUIList.selectedMode=S.SINGLE;var n=this.findChildComponent("root/nodeShow/ScrollView",r);this.starUIList=this.addUIList(n,L),this.nodeItem=this.findChild("root/item"),this.nodeTop=this.findChild("root/nodeTop");var d=this.findChild("root/nodeSkill/ScrollView/view/content/item"),c=this.findChildComponent("root/nodeSkill/ScrollView/view/content",l);d.on(a.EventType.SIZE_CHANGED,(function(){c.height=d.getComponent(l).height}))},k.rebuildHorseList=function(){var t=configMount_skin.getDataByList("skin_level",0),i=0;this.horseInfo=[];for(var n,o=e(t.entries());!(n=o()).done;){var s=n.value,h=(s[0],s[1]);if(IS(p).checkHorseCanShow(h.mount_id)){var r=IS(p).getSkinLevelByID(h.mount_id);this.horseInfo.push({skin:h.mount_id,level:r,state:IS(p).getHorseState(h.mount_id)})}}this.horseInfo.sort((function(t,i){return t.state>i.state?-1:1}));for(var l,a=e(this.horseInfo.entries());!(l=a()).done;){var d=l.value,c=d[0];d[1].skin==this.skinIDSel&&(i=c)}return i},k.onAfterOpen=function(){this.rebuildHorseList(),this.skinIDSel=this.horseInfo[0].skin,this.refreshAll()},k.refreshAll=function(){this.refreshHorseShow(),this.refreshHorseSkill(),this.refreshHorseAttr(),this.refreshHorseChange(),this.refreshItemNum(),this.refreshUseSkillBtn()},k.registerUpdateHandler=function(){this.addEvent(b.TYPE_HORSE_CHANGE,this.onSkinStateChange,this),this.addEvent(b.TYPE_HORSE_SKIN_EFFECT_SEL,this.onRefreshHorseSel,this),this.addEvent(b.TYPE_HORSE_USE_SKILL,this.refreshUseSkillBtn,this)},k.refreshUseSkillBtn=function(){IS(p).getSkinLevelByID(this.skinIDSel)<=0?(this.btnUseSkill.active=!1,this.btnNoUseSkill.active=!1):(this.btnUseSkill.active=IS(p).skill_use!=this.skinIDSel,this.btnNoUseSkill.active=IS(p).skill_use==this.skinIDSel)},k.refreshItemNum=function(){var t=this.findChildComponent("root/nodeItem/Label",d),i=IS(m).getGoodsCountByGoodsGtid(1);t.string=""+i,IS(p).checkSkinRP()},k.onSkinStateChange=function(){IS(p).getSkinLevelByID(this.skinIDSel)?this.btnUse.active=!0:this.btnUse.active=!1,this.skinIDSel==IS(p).horse_id?this.btnCancel.active=!0:this.btnCancel.active=!1,this.refreshHorseShow(),this.refreshHorseSkill(),this.refreshHorseAttr(),this.refreshItemNum(),this.refreshUseSkillBtn(),this.checkPageBtn()},k.refreshHorseSkill=function(){var t=v.findChildComponent(this.nodeRoot,"nodeSkill/Frame",c),i=v.findChildComponent(this.nodeRoot,"nodeSkill/Icon",c),e=v.findChildComponent(this.nodeRoot,"nodeSkill/txtName",d),n=v.findChildComponent(this.nodeRoot,"nodeSkill/ScrollView/view/content/item",d),o=IS(p).getSkinLevelByID(this.skinIDSel);o?o<10&&(this.btnUpgrade.active=!0):this.btnUpgrade.active=!1;var s=configMount_skin.getDataByKeys("mount_id",this.skinIDSel,"skin_level",IS(p).getSkinLevelByID(this.skinIDSel));0==s.skin_skill.length&&(s=configMount_skin.getDataByKeys("mount_id",this.skinIDSel,"skin_level",IS(p).getSkinLevelByID(this.skinIDSel)+1));var h=configSkill.getDataByKey(s.skin_skill[0][0]);this.loadIcon(t,"icon_skill",f.formatStr("common_ICON_jinengkuang0%s",h.quality)),this.loadIcon(i,"icon_skill",h.icon,null,u.ICON_SPRITE),e.string=h.name;var r=configSkill_level.getDataByKeys("id",s.skin_skill[0][0],"level",s.skin_skill[0][1]);n.string=g.formatStr.apply(g,[r.desc].concat(r.desc_parm))},k.refreshHorseShow=function(){var t=this.findChild("root/nodeShow/icon"),i=this.findChildComponent("root/nodeShow/bgName/txtName",d);this.removeUIEffect(this.horseEffectID),this.horseEffectID=this.addUIEffect(configMount.getDataByKey(this.skinIDSel).path,t,-1,null,1,(function(t){s.uiMirror&&(t.dir=-1)}));var e=this.rebuildHorseList();this.HorseUIList.datas=this.horseInfo,this.HorseUIList.scrollTo(e);var n=configMount.getDataByKey(this.skinIDSel);i.string=n.name,this.starInfo=[0,0,0,0,0];for(var o=0;o<IS(p).getSkinLevelByID(this.skinIDSel);o++){var h=o%5;this.starInfo[h]+=1}this.starUIList.datas=this.starInfo},k.onRefreshHorseSel=function(t){this.skinIDSel!=t&&(this.skinIDSel=t,this.refreshAll())},k.refreshHorseAttr=function(){var t=this.findChildComponent("root/nodeChange/txtBase",d),i=this.findChildComponent("root/nodeChange/txtNext",d),e=this.findChildComponent("root/nodeChange/txtEffect",d),n=configMount_skin.getDataByKeys("mount_id",this.skinIDSel,"skin_level",IS(p).getSkinLevelByID(this.skinIDSel)),o=configMount_skin.getDataByKeys("mount_id",this.skinIDSel,"skin_level",IS(p).getSkinLevelByID(this.skinIDSel)+1),s=this.findChild("root/nodeChange/txtNext"),h=this.findChild("root/nodeChange/Sprite"),r=this.findChildComponent("root/btnUnlock/txtLabel",d);if(null==n.expend||0==n.expend.length)r.string=GetLanguage(200127),e.string=configAttribute.getDataByKey(Number(n.attr[0][0])).desc+":",t.string=n.attr[0][1]/100+"%",s.active=!1,h.active=!1,this.nodeItem.active=!1,this.btnUnlock.active=!1,this.btnUpgrade.active=!1,this.nodeTop.active=!0;else{s.active=!0,h.active=!0,this.nodeItem.active=!0,this.btnUnlock.active=!0,this.nodeTop.active=!1,new I(this,this.nodeItem).SetItemId(n.expend[0][0],0);var l=IS(m).getGoodsCountByGoodsGtid(n.expend[0][0]),a=n.expend[0][1];this.findChildComponent("root/item/txtNext",d).string=l+"/"+a,e.string=configAttribute.getDataByKey(Number(o.attr[0][0])).desc+":",null==n.attr||0==n.attr.length?(t.string="0%",i.string=o.attr[0][1]/100+"%",r.string=GetLanguage(200101)):(t.string=n.attr[0][1]/100+"%",i.string=o.attr[0][1]/100+"%",r.string=GetLanguage(200128))}},k.refreshHorseChange=function(){var t=this.findChild("root/nodeShow/icon"),i=this.findChildComponent("root/nodeShow/bgName/txtName",d);this.removeUIEffect(this.horseEffectID),this.horseEffectID=this.addUIEffect(configMount.getDataByKey(this.skinIDSel).path,t,-1,null,1,(function(t){s.uiMirror&&(t.dir=-1)}));var e=configMount.getDataByKey(this.skinIDSel);i.string=e.name,this.checkPageBtn()},k.checkPageBtn=function(){this.btnLeft.active=!0,this.btnRight.active=!0;for(var t,i=e(this.horseInfo);!(t=i()).done;){var n=t.value;n.skin==this.skinIDSel&&(0==this.horseInfo.indexOf(n)&&(this.btnLeft.active=!1),this.horseInfo.indexOf(n)==this.horseInfo.length-1&&(this.btnRight.active=!1))}IS(p).getSkinLevelByID(this.skinIDSel)?this.btnUse.active=!0:this.btnUse.active=!1,this.skinIDSel==IS(p).horse_id?this.btnCancel.active=!0:this.btnCancel.active=!1},k.onBeforeClose=function(){},k.onDestroy=function(){},n}(D));var y=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(i=t.call.apply(t,[this].concat(n))||this).imgFrame=void 0,i.imgIcon=void 0,i.imgLock=void 0,i.imgRP=void 0,i.nodeUse=void 0,i.nodeSel=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){this.imgFrame=v.findChildComponent(this.node,"frame",c),this.imgIcon=v.findChildComponent(this.node,"icon",c),this.imgLock=v.findChild(this.node,"lock"),this.imgRP=v.findChild(this.node,"rp"),this.nodeUse=v.findChild(this.node,"nodeUse"),this.nodeSel=v.findChild(this.node,"sel")},n.onRender=function(t,i){this.data=t;var e=configMount.getDataByKey(this.data.skin).icon_small,n=configMount.getDataByKey(this.data.skin).quality,o=configColor.getDataByKey(n).path;this.view.loadIcon(this.imgFrame,"icon_equip",o),this.view.loadIcon(this.imgIcon,"icon_item",e),this.checkState();var s=this.view;this.nodeSel.active=s.skinIDSel==this.data.skin},n.checkState=function(){this.imgLock.active=!1,this.imgRP.active=!1,this.imgFrame.grayscale=!1,this.imgIcon.grayscale=!1,this.nodeUse.active=!1,1==this.data.state?(this.imgLock.active=!0,this.imgFrame.grayscale=!0,this.imgIcon.grayscale=!0):5==this.data.state&&(this.imgRP.active=!0),this.data.skin==IS(p).horse_id&&(this.nodeUse.active=!0)},n.onItemClick=function(){normalEvent.emit(b.TYPE_HORSE_SKIN_EFFECT_SEL,this.data.skin)},e}(k),L=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(i=t.call.apply(t,[this].concat(n))||this).imgOne=void 0,i.imgTwo=void 0,i.imgThree=void 0,i.imgDark=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){this.imgOne=v.findChild(this.node,"one"),this.imgTwo=v.findChild(this.node,"two"),this.imgThree=v.findChild(this.node,"three"),this.imgDark=v.findChild(this.node,"dark")},n.onRender=function(t,i){this.imgDark.active=0==t,this.imgOne.active=1==t,this.imgTwo.active=2==t,this.imgThree.active=3==t},n.onItemClick=function(){},e}(k);n._RF.pop()}}}));

