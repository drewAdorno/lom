System.register("chunks:///_virtual/ActivityFPSDataCache.ts",["cc","./RedPointMgr.ts","./StorageUtil.ts","./TimeUtil.ts","./BagDefine.ts","./BagModel.ts","./BattlePassControl.ts","./RoleDataCache.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./HorseCarnivalDataCache.ts"],(function(e){"use strict";var t,i,n,s,a,o,r,l,c,h,u,d,v,g,f;return{setters:[function(e){t=e.cclegacy,i=e.js,n=e.Vec2},function(e){s=e.RedPointMgr},function(e){a=e.default},function(e){o=e.default},function(e){r=e.BagEventDefine},function(e){l=e.BagModel},function(e){c=e.default},function(e){h=e.RoleDataCache},function(e){u=e.default},function(e){d=e.ActivityState,v=e.ActivityType,g=e.ActivityEventDefine},function(e){f=e.HorseCarnivalDataCache}],execute:function(){t._RF.push({},"fa106oOBrlJ+6OkSmKXBUrS","ActivityFPSDataCache",void 0);e("default",function(){var e=t.prototype;function t(){this.curMoleLevelId=1,this.challengeLevelId=1,this.curChallengeLevelStage=0,this.challengeLevelStage=1,this.curMoleHammer=1,this.MoleMapCenter=new n(0,0),this.radiusCenter=30,this.radiusSecure=100,this.skillEnergy=100,this.skillDamage=1,this.skillCount=0,this.levelScore=1,this.levelTopScore=[],this.levelResult=1,this.levelKillInfo=void 0,this.leftHP=5,this.openLevelList=[1,2,3,4,5,6],this.openLevelID=1,this.openHammerList=[1,2,3],this.act_day=1,this.mapEdge=void 0,this.levelInfo=void 0,this.hammerInfo=void 0,this.sendProList=[],normalEvent.on(g.OnActivityListUpdate,this.activityChange,this),normalEvent.on(g.OnActivityInfoUpdate,this.activityChange,this),normalEvent.on(r.GOODS_INFO_UPDATE,this.onBagUpdate,this)}return e.clear=function(){},e.activityChange=function(e){void 0===e&&(e=null),this.checkPop();for(var t=0;t<this.sendProList.length;t++){var i=this.sendProList[t].type;if(!e||e.type==i){var n=IS(u).GetActivityInfo(i);n&&n.state==d.Open?this.sendProList[t].send():this.sendProList[t].redCheck&&this.sendProList[t].redCheck()}}},e.checkPop=function(){var e=IS(u).GetActivityInfo(v.FPS);if(e&&e.state==d.Open){var t,n=o.ServerDate(1e3*o.serverTime),s=i.formatStr("#%s#%s#%s",n.getFullYear(),n.getMonth()+1,n.getDate()),r="ActivityFPSPopView"+IS(h).GetRoleId();if((null!=(t=a.get(r))?t:"")==s)return;uiMgr.ViewIsAddPop("ActivityFPSPopView")||(uiMgr.addPopView("ActivityFPSPopView"),a.set(r,s))}},e.onBagUpdate=function(e,t){1602==t&&(IS(u).UpdateMainRedByActType(v.FPSPass),IS(s).changeValue("fps_pass",this.getPassRedNum())),1604==t&&(IS(u).UpdateMainRedByActType(v.FPSBox),IS(s).changeValue("fps_box",this.GetBoxRed()))},e.getRedNum=function(){var e=0;return e+=this.GetStoreRed(),e+=this.getPassRedNum(),e+=this.GetBoxRed(),e=(e+=IS(f).getRedNum(v.FPSTurn))+IS(u).GetTaskRedNum(v.FPSGame)+(1==parseInt(a.get("FPSGame_NewLevel_"+IS(h).GetRoleId()))?1:0)},e.GetStoreRed=function(){var e=IS(u).GetActivityInfo(v.FPS);if(!e||e.state!=d.Open)return 0;if(e){var t,i=String(e.id)+"#"+String(e.round),n="ActivityFPSStoreRed"+IS(h).GetRoleId();return(null!=(t=a.get(n))?t:"")==i?0:1}return 0},e.getPassRedNum=function(){var e=IS(u).GetActivityInfo(v.FPSPass);if(!e||e.state!=d.Open)return 0;var t=0,i=e.roundCfg.group_id;return t=(t=t+c.checkRewardRP(i)>=0?1:0)+c.checkAddRewardRP(i)>0?1:0,t+=c.checkSpecialRewardRP(i),IS(l).getGoodsCountByGoodsGtid(1602)>0&&t++,t},e.GetBoxRed=function(){var e=IS(u).GetActivityInfo(v.FPSBox);return e&&e.state==d.Open&&IS(l).getGoodsCountByGoodsGtid(1604)>0?1:0},e.updateLevelInfo=function(){var e=configMole_level.getDataByKey(this.curMoleLevelId);this.levelInfo={group:e.group,challenge_level:e.challenge_level,time:e.time,monster_id:this.curChallengeLevelStage>0?configMole_level.getDataByKey(this.openLevelID).monster_id:e.monster_id,guard_point:e.guard_point,enemy_refresh:e.enemy_refresh,enemy_nub:e.enemy_nub,boss:e.boss?e.boss:0,boss_id:e.boss_id?e.boss_id:[0,0],boss_time:e.boss_time?e.boss_time:0,hp_score:e.hp_score};var t=configMole_hammer.getDataByKey(this.curMoleHammer);this.hammerInfo={attack:t.attack,attack_range:t.attack_range,energy_multiplier:t.energy_multiplier/1e4,kill_multiplier:t.kill_multiplier/1e4};var i=configMole_main.getDataByKey(1);this.radiusCenter=i.guard_zone[1],this.radiusSecure=i.safety_zone[1],this.skillEnergy=i.special_move,this.skillDamage=i.special_move_damage},e.checkCurLevel=function(){this.curMoleLevelId=this.curMoleLevelId>this.challengeLevelId?this.challengeLevelId:this.curMoleLevelId},t}());t._RF.pop()}}}));

