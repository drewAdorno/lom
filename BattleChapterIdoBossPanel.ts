System.register("chunks:///_virtual/BattleChapterIdoBossPanel.ts",["./rollupPluginModLoBabelHelpers.js","cc","./MetaAttrib.ts","./EventDefine.ts","./index3.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./FixMath.ts","./ChapterDataCache.ts","./ChapterDefine.ts","./DungeonControl.ts","./MessageView.ts","./RoleDataCache.ts","./EaseMethod.ts"],(function(t){"use strict";var e,i,n,s,a,o,h,r,d,l,p,u,c,f,m,v,C,x,g,b,B,T,_;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,n=t.ProgressBar,s=t.Label,a=t.UITransform,o=t.Button,h=t.math,r=t.ScrollView,d=t.Vec3},function(t){l=t.AttribDefine},function(t){p=t.EventDefine},null,function(t){u=t.ListItem},function(t){c=t.default},function(t){f=t.default},function(t){m=t.default},function(t){v=t.FixMath},function(t){C=t.ChapterDataCache},function(t){x=t.ChapterEventDefine},function(t){g=t.default},function(t){b=t.default,B=t.TYPE_YES},function(t){T=t.RoleDataCache},function(t){_=t.EasingMethod}],execute:function(){i._RF.push({},"16fb3IIaNxB6ZVjRME6Bv56","BattleChapterIdoBossPanel",void 0);t("BattleChapterIdoBossPanel",function(){function t(t,e){this.view=void 0,this.node=void 0,this.bottomY=-20,this.nodeTime=void 0,this.pbTime=void 0,this.txtTime=void 0,this.pbBossHP=void 0,this.txtBossHP=void 0,this.chapterTime=0,this._progress=1,this._curPress=1,this._utBar=void 0,this._barAni=!1,this._lastTime=0,this._speed=3,this.txtLevel=void 0,this.rankPanel=void 0,this.txtChapter=void 0,this.node=e,this.view=t,this.onInit()}var e=t.prototype;return e.reset=function(){this.updateTime(),this.pbBossHP.progress=1,this._utBar.width=582,this.txtChapter.string=configMonster_pve_chapter.getDataByKey(battleMain.data.chapterId).name},e.onInit=function(){var t=this;this.nodeTime=c.findChild(this.node,"time"),this.pbTime=c.findChildComponent(this.nodeTime,"pbTime",n),this.txtTime=c.findChildComponent(this.nodeTime,"txtTime",s),this.txtChapter=c.findChildComponent(this.node,"txtChapter",s),this.pbBossHP=c.findChildComponent(this.node,"pbBossHP",n),this.txtBossHP=c.findChildComponent(this.node,"pbBossHP/txtBossHP",s),this._utBar=c.findChildComponent(this.node,"pbBossHP/imgBar",a),this.txtLevel=c.findChildComponent(this.node,"boss/txtLevel",s);var e=c.findChild(this.node,"btnExit");this.view.addComponentCallbackListener(e,o.EventType.CLICK,(function(){b.showBoxTip({tip:configLanguage.getDataByKey(104145).text,ensure:GetLanguage(200129),cancel:GetLanguage(200054),func:function(e){e==B&&t.exitBattle()}})})),this.rankPanel=new S(this,c.findChild(this.node,"rankView"))},e.initBattleEvent=function(){var t=this;battleEvent.on(p.BossHpChange,this.onBossHpChange,this),battleEvent.on(p.UnitHpNumChange,this.onUnitHpNumChange,this),battleEvent.on(p.WorldBossRank,(function(e){t.rankPanel.reset(e)})),this.onUnitHpNumChange(0),this.rankPanel.reset(battleMain.chapter)},e.onBossHpChange=function(t,e){this._progress=t.data.currenHp/t.data.getAttrib(l.hp),this.pbBossHP.progress=this._progress,this.txtBossHP.string=t.data.currenHp+"/"+t.data.getAttrib(l.hp)},e.onUnitHpNumChange=function(t){t++,this.txtLevel.string=t>100?"Lv.âˆž":"Lv."+t,this._curPress=1,this._utBar.width=582*this._curPress},e.updateTime=function(){this.chapterTime!=Math.floor(battleMain.chapter.chapterTime)&&(this.chapterTime=Math.floor(battleMain.chapter.chapterTime),this.txtTime.string=m.formatTimeForSecond(this.chapterTime)),this.pbTime.progress=battleMain.chapter.chapterTime/battleMain.chapter.maxChapterTime},e.updatePart=function(){},e.exitBattle=function(){IS(g).reqDungeonBattleResult(battleMain.data.chapterType,battleMain.data.chapterId,1),battleMain.enterChapter(),normalEvent.emit(x.BATTLE_STATE,battleMain.data.chapterType,!1),this.rankPanel.exit()},e.onUpdate=function(t){battleMain.chapter.timeModel&&this.updateTime();var e=v.round(Math.abs(this._curPress-this._progress));if(this._barAni){if(this._lastTime=0,e<this._speed*t&&this._speed<=1)return this._barAni=!1,this._utBar.width=582*this._progress,void(this._curPress=this._progress);this._curPress=h.lerp(this._curPress,this._progress,this._speed*t),this._utBar.width=582*this._curPress,e=v.round(Math.abs(this._curPress-this._progress))}0!=e&&(this._lastTime+=t,this._lastTime>.3&&(this._barAni=!0,this._speed=h.clamp(1/(1-e),1,3)))},t}());var S=function(){function t(t,e){var i=this;this.panel=void 0,this.node=void 0,this.nodeRank=void 0,this.rankList=void 0,this.txtSelfRank=void 0,this.txtSelfName=void 0,this.txtSelfHurt=void 0,this.nodeOpenState1=void 0,this.nodeOpenState2=void 0,this.moveTween=void 0,this.openState=1,this.panel=t,this.node=e,this.nodeRank=c.findChild(e,"rank");var n=c.findChildComponent(this.nodeRank,"scrollRankList",r);this.rankList=this.panel.view.addUIList(n,P);var a=c.findChildComponent(this.node,"btnOpen",o);this.panel.view.addComponentCallbackListener(a.node,o.EventType.CLICK,(function(){0==i.openState?(i.openState=1,i.resetExitButton(!0)):(i.openState=0,i.resetExitButton(!1))})),this.nodeOpenState1=c.findChild(a.node,"state1"),this.nodeOpenState2=c.findChild(a.node,"state2"),this.txtSelfName=c.findChildComponent(this.node,"self/txtSelfName",s),this.txtSelfHurt=c.findChildComponent(this.node,"self/txtSelfHurt",s),this.txtSelfRank=c.findChildComponent(this.node,"self/txtSelfRank",s)}var e=t.prototype;return e.reset=function(t){this.txtSelfName.string=IS(T).GetRoleName(),this.txtSelfHurt.string=t.bossUnit?f.GetNumString(t.bossUnit.hurtNum):"0",this.txtSelfRank.string=String(t.selfRank+1),IS(C).worldBossRank&&(this.rankList.datas=IS(C).worldBossRank)},e.resetExitButton=function(t){var e=this;void 0===t&&(t=!0),this.nodeOpenState1.active=t,this.nodeOpenState2.active=!t,null!=this.moveTween&&this.moveTween.stop();var i=new d;this.nodeRank.active=t;var n=this.node.position,s=new d(n.x,n.y),a=new d(n.x,t?-294:-156),o=d.subtract(new d,a,n);this.moveTween=normalTween.to(0,1,.5,(function(t,n){i.set(s).add3f(0,o.y*n,0),e.node.position=i})).easing(_.LINEAR).call((function(){e.moveTween=null})).start()},e.exit=function(){this.rankList.clearData()},t}(),P=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))||this).txtName=void 0,e.txtRank=void 0,e.txtHurt=void 0,e}e(i,t);var n=i.prototype;return n.onInit=function(){this.txtName=c.findChildComponent(this.node,"txtName",s),this.txtRank=c.findChildComponent(this.node,"txtRank",s),this.txtHurt=c.findChildComponent(this.node,"txtHurt",s)},n.onRender=function(t,e){this.txtName.string=t.name,this.txtRank.string=e+1+"",this.txtHurt.string=f.GetNumString(t.hurt)},i}(u);i._RF.pop()}}}));

