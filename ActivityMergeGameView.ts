System.register("chunks:///_virtual/ActivityMergeGameView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./V2.ts","./AudioMgr.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./ItemIcon.ts","./BagModel.ts","./BattlePassDefine.ts","./MessageView.ts","./PayDefine.ts","./RoleDefine.ts","./ActivityControl.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./ActivityMergeDataCache.ts","./ActivityMergeDefine.ts","./BaseView.ts"],(function(t){"use strict";var i,e,s,n,o,d,a,h,r,l,c,m,g,f,u,v,p,I,y,C,L,b,x,T,_,w,S,E,M,P,D,k,B,G;return{setters:[function(t){i=t.inheritsLoose,e=t.createForOfIteratorHelperLoose},function(t){s=t.cclegacy,n=t.Vec3,o=t.Label,d=t.Layout,a=t.Button,h=t.Sprite,r=t.ProgressBar,l=t.Node,c=t.ScrollView,m=t.js,g=t.sys,f=t.Animation,u=t.UITransform},function(t){v=t.V2},function(t){p=t.audioMgr},function(t){I=t.ListItem},function(t){y=t.default},function(t){C=t.default},function(t){L=t.default},null,function(t){b=t.IconAseetType},function(t){x=t.BagModel},function(t){T=t.BattlePassDefine},function(t){_=t.default},function(t){w=t.PayEventDefine},function(t){S=t.RoleEventDefine},function(t){E=t.default},function(t){M=t.default},function(t){P=t.ActivityType,D=t.ActivityState},function(t){k=t.default},function(t){B=t.ActivityMergeEvent},function(t){G=t.BaseView}],execute:function(){s._RF.push({},"c3c1bF1GVZPKrPYc4Gtx9/+","ActivityMergeGameView",void 0);var U=[],A=["smbb_ui_bd_dk_d","smbb_ui_dj_dk_d","smbb_ui_gj_dk_d"],R=["smbb_smdlh_hechengk02","smbb_smdlh_hechengk03","smbb_smdlh_hechengk01"],N=new n(1e3,0,0),F=400,K=100,O=4,q=(t("default",function(t){function s(){var i;return(i=t.call(this)||this).sourceInited=!0,i.gridList=void 0,i.orderList=void 0,i.nodeBoxList=void 0,i.boxList=[],i.txtLevel=void 0,i.imgFly=void 0,i.imgFollow=void 0,i.nodeTouch=void 0,i.nodeItemTips=void 0,i.nodeEnergyTips=void 0,i.nodeResult=void 0,i.txtName=void 0,i.txtItemTips=void 0,i.pointPb=void 0,i.energyPb=void 0,i.txtNum1=void 0,i.txtNum2=void 0,i.txtResultPoint=void 0,i.txtDesc=void 0,i.dragGridId=-1,i.targetGridId=-1,i.isDragging=!1,i.isFlying=!1,i.isDrawing=!1,i.isSending=!1,i.selectItem=null,i.levelRow=0,i.levelCol=0,i.levelId=0,i.levelPoint=0,i.curPoint=0,i.curEnergy=0,i.listDatas=[],i.boxNum=[0,0,0],i.btnBox=void 0,i.btnSell=void 0,i.btnTips=void 0,i.txtPrice=void 0,i.imgBoxIcon=void 0,i.nodeBoxRed=void 0,i.txtBoxNum=void 0,i.giftRedPoint=void 0,i.passRedPoint=void 0,i.sameItems=[],i.nodeBoxEffect=void 0,i.boxEffectId=-1,i.nodePbEffect=void 0,i.pbEffectId=-1,i.tempDatas=[],i.flyStartPos=new n(0,0,0),i.flyTargetPos=new n(0,0,0),i.txtLeftTime=void 0,i.leftTime=0,i.deltaTime=0,i.canUpdate=!1,i.name="ActivityMergeGameView",i.url="ui/module/activityMerge/ActivityMergeGameView",i.poolTime=3e3,i.fullScreen=!0,i.banDefeat=!0,i}i(s,t);var f=s.prototype;return f.onInit=function(){var t=this;this.txtLeftTime=this.findChildComponent("nodeTime/txtTime",o),this.dealMirrorLayout(this.findChildComponent("nodeTime",d));var i=this.findChild("top/imgTitle/btnTips");this.addComponentCallbackListener(i,a.EventType.CLICK,(function(){IS(M).ShowSysTips(P.MergeGame)})),K=configGoods_refresh.getDataByKey(F).max;var e=this.findChild("bottom/btnClose");this.addComponentCallbackListener(e,a.EventType.CLICK,(function(){t.destroy()}));var s=this.findChild("nodeItemTips/imgMask");this.addComponentCallbackListener(s,a.EventType.CLICK,(function(){t.nodeItemTips.active=!1,t.selectItem.setSelected(!1),t.selectItem=null}));var n=this.findChild("nodeMid/boxList/imgBoxMask");this.addComponentCallbackListener(n,a.EventType.CLICK,(function(){t.nodeBoxList.active=!1}));var m=this.findChild("nodeMid/btnDraw/ProgressBar/btnEnergy/nodeEnergyTips/imgMask");this.addComponentCallbackListener(m,a.EventType.CLICK,(function(){t.nodeEnergyTips.active=!1}));var g=this.findChild("nodeResult/imgMask");this.addComponentCallbackListener(g,a.EventType.CLICK,(function(){t.nodeResult.active=!1}));var f=this.findChild("nodeMid/btnPreview");this.addComponentCallbackListener(f,a.EventType.CLICK,(function(){uiMgr.openView("ActivityMergePreviewView",t.levelId)}));var u=this.findChild("bottom/btnGuide");this.addComponentCallbackListener(u,a.EventType.CLICK,(function(){uiMgr.openView("ActivityMergeGameGuideView")}));var v=this.findChild("bottom/btnGift");this.addComponentCallbackListener(v,a.EventType.CLICK,(function(){uiMgr.openView("ActivityMergeOptionalGiftView")}));var p=this.findChild("bottom/btnPass");this.addComponentCallbackListener(p,a.EventType.CLICK,(function(){uiMgr.openView("ActivityMergePassView")}));var I=this.findChild("nodeMid/btnDraw");this.addComponentCallbackListener(I,a.EventType.CLICK,(function(){t.isFlying||t.isDrawing||!t.checkAllowDraw()||(t.isDrawing=!0,IS(E).send_24_160(1,0),t.flyStartPos=I.getWorldPosition())}));var y=this.findChild("nodeItemTips/btnUse");this.addComponentCallbackListener(y,a.EventType.CLICK,(function(){IS(E).send_24_163(t.selectItem.loc)})),this.btnSell=this.findChild("nodeItemTips/btnSell"),this.addComponentCallbackListener(this.btnSell,a.EventType.CLICK,(function(){IS(E).send_24_163(t.selectItem.loc)}));var C=this.findChild("nodeMid/btnDraw/ProgressBar/btnEnergy");this.addComponentCallbackListener(C,a.EventType.CLICK,(function(){t.nodeEnergyTips.active=!0})),this.btnTips=this.findChild("nodeItemTips/nodeTitle/btnTips"),this.addComponentCallbackListener(this.btnTips,a.EventType.CLICK,(function(){uiMgr.openView("ActivityMergeGameTipsView",t.selectItem.typeId,O)})),this.nodeBoxList=this.findChild("nodeMid/boxList"),this.btnBox=this.findChild("nodeMid/btnBox"),this.addComponentCallbackListener(this.btnBox,a.EventType.CLICK,(function(){t.nodeBoxList.active=!0;for(var i=0;i<3;i++)0==t.boxNum[i]?t.boxList[i].node.active=!1:t.boxList[i].render(t.boxNum[i])})),this.txtLevel=this.findChildComponent("top/txtLevel",o),this.imgFollow=this.findChildComponent("imgFollow",h),this.imgFly=this.findChildComponent("imgFly",h),this.nodeTouch=this.findChild("nodeMap/nodeTouch"),this.nodeItemTips=this.findChild("nodeItemTips"),this.nodeEnergyTips=this.findChild("nodeMid/btnDraw/ProgressBar/btnEnergy/nodeEnergyTips"),this.nodeResult=this.findChild("nodeResult"),this.txtName=this.findChildComponent("nodeItemTips/nodeTitle/txtName",o),this.txtItemTips=this.findChildComponent("nodeItemTips/txtTips",o),this.txtPrice=this.findChildComponent("nodeItemTips/btnSell/txtPrice",o),this.imgBoxIcon=this.findChildComponent("nodeMid/boxList/view/content/item/imgIcon",h),this.nodeBoxRed=this.findChild("nodeMid/btnBox/red"),this.txtBoxNum=this.findChildComponent("nodeMid/btnBox/red/txtNum",o),this.pointPb=this.findChildComponent("top/ProgressBar",r),this.energyPb=this.findChildComponent("nodeMid/btnDraw/ProgressBar",r),this.txtNum1=this.findChildComponent("top/ProgressBar/txtNum",o),this.txtNum2=this.findChildComponent("nodeMid/btnDraw/ProgressBar/txtNum",o),this.txtResultPoint=this.findChildComponent("nodeResult/content/ProgressBar/txtResultPoint",o),this.txtDesc=this.findChildComponent("top/txtDesc",o),this.nodeBoxEffect=this.findChild("nodeMid/btnDraw/nodeBoxEffect"),this.nodePbEffect=this.findChild("top/nodePbEffect"),this.giftRedPoint=this.findChild("bottom/btnGift/RedPoint"),this.passRedPoint=this.findChild("bottom/btnPass/RedPoint"),this.addComponentCallbackListener(this.nodeTouch,l.EventType.TOUCH_START,(function(i){t.onTouchStart(i)})),this.addComponentCallbackListener(this.nodeTouch,l.EventType.TOUCH_MOVE,(function(i){t.onTouchMove(i)})),this.addComponentCallbackListener(this.nodeTouch,l.EventType.TOUCH_CANCEL,(function(i){t.onTouchEnd(i)})),this.addComponentCallbackListener(this.nodeTouch,l.EventType.TOUCH_END,(function(i){t.onTouchEnd(i)}));var L=this.findChildComponent("nodeOrder/orderList",c);this.orderList=this.addUIList(L,V),this.orderList.virtual=!1,this.boxList=[];for(var b=1;b<=3;b++)this.boxList.push(new W(this.findChild("nodeMid/boxList/content/item"+b),this,b));this.adjustMirrorNode(this.findChild("nodeMap")),this.adjustMirrorNode(this.findChild("imgFly")),this.adjustMirrorNode(this.findChild("imgFollow")),this.adjustMirrorNode(this.findChild("nodeMid/btnBox/imgIcon")),this.adjustMirrorNode(this.findChild("nodeMid/btnDraw/ProgressBar/btnEnergy"))},f.registerUpdateHandler=function(){this.addEvent(B.OnMergeGameInfoUpdate,this.InitLevel,this),this.addEvent(B.OnMergeGameOpenBox,this.onOpenBox,this),this.addEvent(B.OnMergeGameUpdateGrids,this.UpdateGrids,this),this.addEvent(B.OnMergeGameSellGrid,this.onSell,this),this.addEvent(B.OnMergeGameFinishOrder,this.onFinishOrder,this),this.addEvent(S.ROLE_RES_UPDATE,this.UpdateEnergy,this),this.addEvent(B.OnMergeGameEnergyUpdate,this.updateRed,this),this.addEvent(w.PAY_REWARD_UPDATE,this.updateRed,this),this.addEvent(T.BATTLE_PASS_INFO_UPDATE,this.updateRed,this)},f.onAfterOpen=function(){p.playMusic("smdlh_mainbgm");var t=IS(M).GetActivityInfo(P.MergeGame);if(t){var i,e=null!=(i=t.state_time[t.state])?i:t.state_time[D.Open];this.leftTime=e.end_time-L.serverTime,this.leftTime>0?(this.canUpdate=!0,this.txtLeftTime.string=m.formatStr("%s",L.formatTimeStringForSecond(this.leftTime))):this.txtLeftTime.string=GetLanguage(200026)}else this.txtLeftTime.string=GetLanguage(200026);this.updateRed(),-1==this.boxEffectId&&(this.boxEffectId=this.addUIEffect("prefab/ui-effect/MX_tx_cailan",this.nodeBoxEffect,-1,new v(0,0))),this.sourceInited=!0,IS(E).send_24_159(),IS(E).send_24_166()},f.onBeforeClose=function(){this.canUpdate=!1,this.gridList.clearData()},f.onDestroy=function(){p.playMusic("battle"),this.gridList.clearData(),this.removeUIEffect(this.boxEffectId),this.boxEffectId=-1},f.onUpdate=function(t){if(this.canUpdate&&(this.deltaTime=this.deltaTime+t,this.deltaTime>=1&&(this.deltaTime=0,this.leftTime=this.leftTime-1,this.leftTime>0?this.txtLeftTime.string=m.formatStr("%s",L.formatTimeStringForSecond(this.leftTime)):(this.txtLeftTime.string=GetLanguage(200026),this.canUpdate=!1)),!this.sourceInited&&this.gridList&&this.gridList.items.length==U[this.levelId-1]&&(this.sourceInited=!0),this.isFlying&&this.tempDatas)){var i=g.uiMirror?-1:1,e=n.distance(this.flyTargetPos,this.flyStartPos),s=new n((this.flyTargetPos.x-this.flyStartPos.x)/e,(this.flyTargetPos.y-this.flyStartPos.y)/e);this.imgFly.node.translate(new n(s.x*t*800*i,s.y*t*800,0)),n.distance(this.imgFly.node.worldPosition,this.flyTargetPos)<20&&(this.nodeTouch.active=!0,this.nodeBoxList.active=!1,this.UpdateGrid(this.tempDatas.block,1),this.UpdateBox(this.tempDatas.box_list),this.tempDatas=[],this.imgFly.node.setWorldPosition(1e3,0,0))}},f.updateInfo=function(t){if(t.type==P.MergeGame&&t.state!=D.Null){var i,e=null!=(i=t.state_time[t.state])?i:t.state_time[D.Open];this.leftTime=e.end_time-L.serverTime,this.leftTime>0?(this.canUpdate=!0,this.txtLeftTime.string=m.formatStr("%s",L.formatTimeStringForSecond(this.leftTime))):this.txtLeftTime.string=GetLanguage(200026)}},f.InitLevel=function(t){var i=this;if(this.sourceInited=!1,this.levelId!=t.chapter){this.levelId>0&&(this.nodeResult.active=!0,this.txtResultPoint.string=this.curPoint+"/"+this.levelPoint);var e=this.levelId?this.levelId:1;this.levelId=t.chapter,this.txtDesc.string=5!=this.levelId?GetLanguage_UI(301212):GetLanguage_UI(301225),this.UpdateMap(e,t.chapter)}this.curPoint=t.point;var s=configMerge_level.getDataByKey(this.levelId);this.levelRow=s.chess_board[0],this.levelCol=s.chess_board[1],this.levelPoint=s.pass,O=s.highest_stage,this.txtLevel.string=C.formatStrWithMirrorDeal(GetLanguage(200797),this.levelId),this.UpdateEnergy(F),this.UpdatePoint(),this.orderList.clearData(),IS(k).curDemandGoods=[];var n=t.order_list.sort((function(t,i){return t.pos-i.pos}));this.orderList.datas=n,this.listDatas=[];for(var o=0;o<t.block_list.length;o++){var d={id:o,loc:t.block_list[o].pos,mask:t.block_list[o].cover,typeId:t.block_list[o].goods,isBox:1==t.block_list[o].is_box};this.listDatas.push(d)}this.gridList.datas=this.listDatas,this.addTimer(.25,1,(function(){i.orderList.clearData(),IS(k).curDemandGoods=[];var e=t.order_list.sort((function(t,i){return t.pos-i.pos}));i.orderList.datas=e})),this.UpdateBox(t.box_list)},f.UpdateMap=function(t,i){var e=configMerge_level.getDataByKey(t),s=configMerge_level.getDataByKey(i);if(!this.gridList||t==i||e.chess_board[1]!=s.chess_board[1]){U[this.levelId-1]=s.chess_board[0]*s.chess_board[1];var n=s.chess_board[1]-3;this.gridList&&(this.gridList.clearData(),this.gridList.destroy());for(var o=1;o<4;o++){this.findChild("nodeMap/map"+o).active=n==o}var d=this.findChildComponent("nodeMap/map"+n+"/gridList",c);this.gridList=this.addUIList(d,q)}},f.checkCanGet=function(t){for(var i,s=e(this.gridList.items);!(i=s()).done;){var n=i.value;if(t==n.typeId&&0==n.mask&&!n.isBox)return!0}return!1},f.setItemAnim=function(t){if(t)for(var i,s=this.gridList.items[this.dragGridId].typeId,n=e(this.gridList.items);!(i=n()).done;){var o=i.value;0!=o.mask||o.typeId!=s||o.isDragged||o.isShow||o.isBox||(o.setAnim(!0),o.isShow=!0,this.sameItems.push(o))}else{for(var d,a=e(this.sameItems);!(d=a()).done;){var h=d.value;h.setAnim(!1),h.isShow=!1}this.sameItems=[]}},f.showTips=function(t,i){this.nodeItemTips.setWorldPosition(new n(this.nodeItemTips.worldPosition.x,this.selectItem.pos.y-150,0)),this.nodeItemTips.active=!0;var e=configMerge_box.getDataByKey(t),s=configMerge_element.getDataByKey(t);this.txtName.string=i?e.name:s.element_name,i?this.txtItemTips.string=GetLanguage(302461):(s.element_stage<O?this.txtItemTips.string=GetLanguage(302459):this.txtItemTips.string=GetLanguage(302460),this.txtPrice.string=s.value.toString()),this.btnSell.active=!i,this.btnTips.active=!i},f.onOpenBox=function(t){p.playSound("smdlh_daoju"),this.isFlying=!0,this.isDrawing=!1,this.nodeTouch.active=!1,this.tempDatas=t,1!=t.block.is_box?(this.loadIcon(this.imgFly,"act_merge_main",configMerge_element.getDataByKey(t.block.goods).image,null,b.UI_ATLAS,!0),this.getUIEffect(this.boxEffectId).aniNames=["skill1","idle_2"]):this.loadIcon(this.imgFly,"act_merge_main",configMerge_box.getDataByKey(t.block.goods).image,null,b.UI_ATLAS,!0),this.imgFly.node.setWorldPosition(this.flyStartPos),this.flyTargetPos=this.gridList.items[(t.block.pos.x-1)*this.levelCol+(t.block.pos.y-1)].pos},f.onSell=function(t){this.nodeItemTips.active=!1,this.selectItem.setSelected(!1),this.selectItem=null,this.curPoint=t.point,this.UpdatePoint(),this.UpdateGrid(t.block)},f.onFinishOrder=function(t){var i=this;IS(k).updateOrderPos=-1,p.playSound("smdlh_tijiao"),this.curPoint=t.point,this.pbEffectId=this.addUIEffect("prefab/ui-effect/MX_tx_shumadalianhuan_jindutiao",this.nodePbEffect,-1,new v(0,0)),this.addTimer(1,1,(function(){i.removeUIEffect(i.pbEffectId)})),IS(k).curDemandGoods=[];var e=t.order_list.sort((function(t,i){return t.pos-i.pos}));this.orderList.datas=e,this.gridList.updateAll(),this.UpdatePoint(),this.UpdateGrids(t.block),this.UpdateBox(t.box_list),this.addTimer(.5,1,(function(){i.isSending=!1}))},f.updateRed=function(){this.passRedPoint.active=IS(k).getPassRedNum()>0,this.giftRedPoint.active=IS(k).GetOptionGiftRed()>0},f.UpdateBox=function(t){for(var i,s=-1,n=e(t);!(i=n()).done;){var o=i.value;o.k-1>s&&(s=o.k),this.boxNum[o.k-1]=o.v}var d=this.boxNum[0]+this.boxNum[1]+this.boxNum[2];this.btnBox.active=d>0,this.loadIcon(this.imgBoxIcon,"act_merge_main",A[s],null,b.UI_ATLAS,!0),this.nodeBoxRed.active=d>0,this.txtBoxNum.string=d.toString()},f.UpdateEnergy=function(t){t==F&&(this.curEnergy=IS(x).getGoodsCountByGoodsGtid(F),this.energyPb.progress=this.curEnergy/K>1?1:this.curEnergy/K,this.txtNum2.string=this.curEnergy+"/"+K,-1!=this.boxEffectId&&(this.curEnergy>0?this.getUIEffect(this.boxEffectId).aniName="idle_2":this.getUIEffect(this.boxEffectId).aniName="idle"))},f.UpdatePoint=function(){0!=this.levelPoint?(this.pointPb.progress=this.curPoint/this.levelPoint,this.txtNum1.string=this.curPoint+"/"+this.levelPoint):(this.pointPb.progress=1,this.txtNum1.string=this.curPoint.toString())},f.UpdateGrid=function(t,i){var e=this;void 0===i&&(i=0);var s=(t.pos.x-1)*this.levelCol+(t.pos.y-1),n={id:s,loc:t.pos,mask:t.cover,typeId:t.goods,isBox:1==t.is_box};this.listDatas[s]=n,this.gridList.datas=this.listDatas,this.addTimer(.25,1,(function(){IS(k).curDemandGoods=[],e.orderList.updateAll(),1==i&&(e.isFlying=!1)}))},f.UpdateGrids=function(t){for(var i,s=this,n=e(t);!(i=n()).done;){var o=i.value,d=(o.pos.x-1)*this.levelCol+(o.pos.y-1),a={id:d,loc:o.pos,mask:o.cover,typeId:o.goods,isBox:1==o.is_box};if(this.listDatas[d]=a,-1!=IS(k).targetMergeLevel&&o.goods==IS(k).targetMergeLevel){var h=configMerge_element.getDataByKey(o.goods);p.playSound("smdlh_hecheng0"+(h.element_stage-1)),this.gridList.items[d].showLight(),IS(k).targetMergeLevel=-1}}this.gridList.datas=this.listDatas,this.addTimer(.25,1,(function(){IS(k).curDemandGoods=[],s.orderList.updateAll()}))},f.onTouchStart=function(t){var i=t.getUILocation(),e=new n(i.x,i.y,0);this.dragGridId=-1,this.isDragging=!1;for(var s=0;s<this.gridList.items.length;s++){var o=this.gridList.getItemByListId(s);if(o.checkInRange(e)&&0==o.mask&&0!=o.typeId){this.dragGridId=s,this.isDragging=!0;break}}},f.onTouchMove=function(t){if(-1!=this.dragGridId){var i=this.gridList.getItemByListId(this.dragGridId);i.isBox||this.setItemAnim(!0),i.isDragged||(i.isDragged=!0,i.setEmpty(),this.loadIcon(this.imgFollow,"act_merge_main",i.iconStr,null,b.UI_ATLAS,!0));var e=t.getUILocation(),s=new n(e.x,e.y,0);this.imgFollow.node.setWorldPosition(s)}},f.onTouchEnd=function(t){if(this.isDragging){this.setItemAnim(!1);var i=t.getUILocation(),e=new n(i.x,i.y,0);this.isDragging=!1,this.targetGridId=-1;for(var s=0;s<this.gridList.items.length;s++){if(this.gridList.getItemByListId(s).checkInRange(e)){this.targetGridId=s;break}}var o=this.gridList.getItemByListId(this.dragGridId),d=this.gridList.getItemByListId(this.targetGridId);o.isDragged=!1,-1!=this.targetGridId&&this.targetGridId!=this.dragGridId&&2!=d.mask?1==d.mask&&o.typeId!=d.typeId?(_.showFlyTip(GetLanguage(303035)),o.setType(o.data),o.setSelected(!0),0!=o.typeId&&(this.selectItem&&this.selectItem.setSelected(!1),this.selectItem=o,this.showTips(o.typeId,o.isBox))):(o.typeId==d.typeId&&o.stage<O&&(IS(k).targetMergeLevel=o.typeId+1),IS(E).send_24_161(o.loc,d.loc)):(o.setType(o.data),o.setSelected(!0),0!=o.typeId&&(this.selectItem&&this.selectItem.setSelected(!1),this.selectItem=o,this.showTips(o.typeId,o.isBox))),this.imgFollow.node.setPosition(N)}},f.checkAllowDraw=function(t){if(void 0===t&&(t=1),0==this.curEnergy&&1==t)return!1;for(var i,s=e(this.gridList.items);!(i=s()).done;){if(0==i.value.typeId)return!0}return!1},s}(G)),function(t){function e(){for(var i,e=arguments.length,s=new Array(e),o=0;o<e;o++)s[o]=arguments[o];return(i=t.call.apply(t,[this].concat(s))||this).id=0,i.typeId=0,i.mask=0,i.stage=0,i.isBox=!1,i.pos=new n(0,0,0),i.loc={row:0,col:0},i.lightEffectId=-1,i.isShowAnim=!1,i.anim=void 0,i.imgInfo1=void 0,i.imgInfo2=void 0,i.imgIcon=void 0,i.imgMax=void 0,i.imgSelected=void 0,i.imgHalfMask=void 0,i.imgMask=void 0,i.iconStr=null,i.isDragged=!1,i.isSelected=!1,i.isShow=!1,i}i(e,t);var s=e.prototype;return s.onInit=function(){this.imgInfo1=y.findChild(this.node,"imgInfo1"),this.imgInfo2=y.findChild(this.node,"imgInfo2"),this.imgMax=y.findChild(this.node,"imgMax"),this.imgSelected=y.findChild(this.node,"imgSelected"),this.imgHalfMask=y.findChild(this.node,"imgHalfMask"),this.imgMask=y.findChild(this.node,"imgMask"),this.imgIcon=y.findChildComponent(this.node,"imgIcon",h),this.anim=y.findChildComponent(this.node,"imgIcon",f)},s.onRender=function(t,i){this.id=t.id,this.pos=this.node.worldPosition,this.loc=t.loc,this.setType(t)},s.setSelected=function(t){this.isSelected=t,this.imgSelected.active=t},s.setShowInfo=function(t){this.isShow=t,this.imgInfo1.active=t,this.imgInfo2.active=t},s.setEmpty=function(){this.imgInfo1.active=!1,this.imgInfo2.active=!1,this.imgMax.active=!1,this.imgSelected.active=!1,this.imgHalfMask.active=!1,this.imgMask.active=!1,this.imgIcon.node.active=!1,this.stage=0},s.setType=function(t){this.setEmpty(),this.typeId=t.typeId,this.mask=t.mask,this.isBox=t.isBox,this.setShowInfo(IS(k).checkInDemand(this.typeId)&&0==this.mask&&!this.isBox);var i=configMerge_element.getDataByKey(this.typeId);if(0!=this.typeId)if(this.isBox){var e=configMerge_box.getDataByKey(this.typeId);this.imgIcon.node.active=!0,this.iconStr=e.image,this.view.loadIcon(this.imgIcon,"act_merge_main",e.image,null,b.UI_ATLAS,!0)}else this.imgIcon.node.active=!0,this.iconStr=i.image,this.stage=i.element_stage,this.view.loadIcon(this.imgIcon,"act_merge_main",i.image,null,b.UI_ATLAS,!0);this.imgHalfMask.active=1==t.mask,this.imgMask.active=2==t.mask,this.imgMax.active=this.stage==O&&!this.imgInfo2.active},s.checkInRange=function(t){var i=this.node.getComponent(u).contentSize.height,e=this.node.getComponent(u).contentSize.width;return t.x<this.pos.x+e/2&&t.x>this.pos.x-e/2&&t.y>this.pos.y-i/2&&t.y<this.pos.y+i/2},s.showLight=function(){var t=this;this.lightEffectId=this.view.addUIEffect("prefab/ui-effect/MX_tx_shumadalianhuan_shanguang",this.node,2,new v(0,0)),this.view.addTimer(.25,1,(function(){t.view.removeUIEffect(t.lightEffectId)}))},s.setAnim=function(t){t?this.anim.play():(this.anim.stop(),this.imgIcon.node.setScale(1,1))},e}(I)),V=function(t){function e(){for(var i,e=arguments.length,s=new Array(e),n=0;n<e;n++)s[n]=arguments[n];return(i=t.call.apply(t,[this].concat(s))||this).pos=0,i.orderStatus=0,i.nodeEffect=void 0,i.modelEffectId=-1,i.nodeOrderEffect=void 0,i.orderEffectId=-1,i.btnSend=void 0,i.imgRequestList=void 0,i.nodeRewardList=void 0,i.nodeRequestList=void 0,i.rewardList=[],i.requestList=[],i.rewardItem1=void 0,i.rewardItem2=void 0,i.requestItem1=void 0,i.requestItem2=void 0,i}i(e,t);var s=e.prototype;return s.onInit=function(){var t=this;this.btnSend=y.findChild(this.node,"btnSend"),this.view.addComponentCallbackListener(this.btnSend,a.EventType.CLICK,(function(){t.view.isSending||(t.view.isSending=!0,t.finishOrder(),IS(k).updateOrderPos=t.pos)})),this.imgRequestList=y.findChildComponent(this.node,"requestList",h),this.nodeRewardList=y.findChild(this.node,"rewardList"),this.nodeRequestList=y.findChild(this.node,"requestList"),this.rewardItem1=y.findChild(this.node,"rewardList/item1"),this.rewardItem2=y.findChild(this.node,"rewardList/item2"),this.requestItem1=y.findChild(this.node,"requestList/item1"),this.requestItem2=y.findChild(this.node,"requestList/item2"),this.requestList=[],this.rewardList=[],this.rewardList.push(new H(this.rewardItem1,this.view)),this.rewardList.push(new H(this.rewardItem2,this.view)),this.requestList.push(new j(this.requestItem1,this.view)),this.requestList.push(new j(this.requestItem2,this.view)),this.nodeEffect=y.findChild(this.node,"nodeEffect"),this.nodeOrderEffect=y.findChild(this.node,"nodeOrderEffect"),this.view.adjustMirrorNode(this.nodeRequestList)},s.onRender=function(t,i){if(-1!=this.orderStatus){var e=this.orderStatus;this.orderStatus=0;var s=configMerge_pet.getDatas().length,n=t.cfg_id%s+1;this.nodeRewardList.active=!0,this.nodeRequestList.active=!0,-1==this.modelEffectId&&(this.modelEffectId=this.view.addUIEffect(m.formatStr("prefab/model/%s",configMerge_pet.getDataByKey(n).model),this.nodeEffect,-1,new v(0,-30),.8,(function(t){t.aniName="idle"}))),this.pos=t.pos;var o={icon:"smbb_smdlh_naicha",num:t.point_num};this.rewardList[0].render(o),t.box_id>0?(this.rewardItem2.active=!0,o={icon:configMerge_box.getDataByKey(t.box_id).image,num:1},this.rewardList[1].render(o),this.orderStatus=1):this.rewardItem2.active=!1;var d=!1,a=configMerge_order.getDataByKey(t.cfg_id);this.requestList[0].render(a.order_demand[0]),d=this.requestList[0].isCanGet,IS(k).curDemandGoods.push(a.order_demand[0]),a.order_demand[1]?(IS(k).curDemandGoods.push(a.order_demand[1]),this.requestList[1].node.active=!0,this.requestList[1].render(a.order_demand[1]),d&&(d=this.requestList[1].isCanGet)):this.requestList[1].node.active=!1,this.orderStatus=d?2:this.orderStatus,e<2&&2==this.orderStatus&&p.playSound("smdlh_ketijiao"),this.btnSend.active=2==this.orderStatus,this.view.loadIcon(this.imgRequestList,"act_merge_main",R[this.orderStatus],null,b.UI_ATLAS,!0)}},s.finishOrder=function(){var t=this;this.nodeRewardList.active=!1,this.nodeRequestList.active=!1,this.btnSend.active=!1,this.orderStatus=-1,this.view.getUIEffect(this.modelEffectId).aniNames=["skill2","idle"],this.view.addTimer(1.5,1,(function(){t.view.removeUIEffect(t.modelEffectId),t.modelEffectId=-1,t.orderStatus=0,IS(E).send_24_162(t.pos)}))},e}(I),j=function(){function t(t,i){var e=this;this.node=void 0,this.isCanGet=!1,this.view=void 0,this.typeId=void 0,this.imgIcon=void 0,this.imgGet=void 0,this.node=t,this.view=i,this.imgIcon=y.findChildComponent(this.node,"imgIcon",h),this.imgGet=y.findChild(this.node,"imgGet"),this.view.addComponentCallbackListener(this.node,a.EventType.CLICK,(function(){uiMgr.openView("ActivityMergeGameTipsView",e.typeId,O)}))}return t.prototype.render=function(t){this.typeId=t;var i=configMerge_element.getDataByKey(t);this.view.loadIcon(this.imgIcon,"act_merge_main",i.image,null,b.UI_ATLAS,!0),this.imgGet.active=this.view.checkCanGet(this.typeId),this.isCanGet=this.imgGet.active},t}(),H=function(){function t(t,i){this.node=void 0,this.view=void 0,this.imgIcon=void 0,this.txtNum=void 0,this.node=t,this.view=i,this.imgIcon=y.findChildComponent(this.node,"imgIcon",h),this.txtNum=y.findChildComponent(this.node,"txtNum",o)}return t.prototype.render=function(t){this.view.loadIcon(this.imgIcon,"act_merge_main",t.icon,null,b.UI_ATLAS,!0),this.txtNum.string=t.num.toString()},t}(),W=function(){function t(t,i,e){var s=this;this.node=void 0,this.view=void 0,this.imgIcon=void 0,this.txtNum=void 0,this.type=0,this.node=t,this.type=e,this.view=i,this.imgIcon=y.findChildComponent(this.node,"imgIcon",h),this.txtNum=y.findChildComponent(this.node,"red/txtNum",o),this.view.addComponentCallbackListener(this.node,a.EventType.CLICK,(function(){s.view.isFlying||s.view.isDrawing||!s.view.checkAllowDraw(2)||(s.view.isDrawing=!0,p.playSound("smdlh_daoju"),IS(E).send_24_160(2,s.type),s.view.flyStartPos=s.node.getWorldPosition())})),this.view.adjustMirrorNode(this.imgIcon.node)}return t.prototype.render=function(t){this.txtNum.string=t.toString()},t}();s._RF.pop()}}}));

