System.register("chunks:///_virtual/GuildDataCache.ts",["./rollupPluginModLoBabelHelpers.js","cc","./RedPointMgr.ts","./TimeUtil.ts","./ConfigGlobal.ts","./BagDefine.ts","./BagModel.ts","./CommonDefine.ts","./MessageView.ts","./GuildWarDataCache.ts","./RoleDataCache.ts","./GuildDefine.ts"],(function(e){"use strict";var i,t,n,l,o,u,a,r,s,_,d,m,f,h,g,c;return{setters:[function(e){i=e.createForOfIteratorHelperLoose},function(e){t=e.cclegacy,n=e.Vec3,l=e.randomRangeInt},function(e){o=e.RedPointMgr},function(e){u=e.default},function(e){a=e.ConfigGlobal},function(e){r=e.ItemIdDefine},function(e){s=e.BagModel},function(e){_=e.CommonEventDefine},function(e){d=e.default},function(e){m=e.GuildWarDataCache},function(e){f=e.RoleDataCache},function(e){h=e.GuildEventDefine,g=e.PermissionType,c=e.RoleUpdateFlag}],execute:function(){t._RF.push({},"cf0e9CYBnhNr7OpoKGSMixm","GuildDataCache",void 0);e("default",function(){var e=t.prototype;function t(){this.enterPos=new n(l(-120,120),l(-590,82)),this.mapPos=new n(-350,-50,0),this.boxMap={},this.boxInfo=void 0,this.act_list={},this.roleMap={},this.roleUpdateFlag=c.Not,this.roleActions={},this.guildInfo={guild_id:0,create_time:0,name:"",notice:"",leader_id:0,is_auto_join:0,join_limit_lv:0,level:0,exp:0,member_num:0,guild_flag:null,country:0,gvg_notice:""},this.memberInfo={role_id:0,role_name:"",role_head:null,career:0,is_online:0,offline_time:0,donate_sum:0,donate_week:0,donate_count:0},this.memberList=[],this.guild_list_info={},this.guild_rank_list={},this.apply_list=[],this.self_apply_list={},this.guildRes={},this.myHelpList=[],this.myHelpState=[],this.guildHelpList=[],this.dailyHelpCount=0,this.guildQuestion=void 0,this.guildDiceTime=0,this.guildLog=[],this.roleActions[c.Add]=new Set,this.roleActions[c.Del]=new Set,this.roleActions[c.Move]=new Set,this.roleActions[c.Break]=new Set}return e.clear=function(){},e.UpdateGuildInfo=function(e){this.guildInfo={guild_id:e.guild_id,create_time:e.create_time,name:e.name,notice:e.notice,leader_id:e.leader_id,is_auto_join:e.is_auto_join,join_limit_lv:e.join_limit_lv,level:e.level,exp:e.exp,member_num:e.member_num,guild_flag:e.guild_flag,country:e.country,gvg_notice:e.gvg_notice},this.memberList=[];for(var n,l=i(e.member_list);!(n=l()).done;){var u,a,r,s,d,m=n.value;if(this.memberList[m.role_id]=m,m.role_id==IS(f).GetRoleId())this.memberInfo={role_id:m.role_id,role_name:m.role_name,role_head:m.role_head,career:m.career,is_online:null!=(u=m.is_online)?u:0,offline_time:null!=(a=m.offline_time)?a:0,donate_sum:null!=(r=m.donate_sum)?r:0,donate_week:null!=(s=m.donate_week)?s:0,donate_count:null!=(d=m.donate_count)?d:0}}IS(f).UpdateGuideInfo(e),normalEvent.emit(h.GUILD_INFO_UPDATE),IS(o).changeValue("GuildMainView/btnInfo",IS(t).GetGuildRedNum()),normalEvent.emit(_.UPDATE_MAIN_GUILD_RED_POINT)},e.UpdateGuildInfoAdd=function(e){if(e.update_list.id==this.guildInfo.guild_id)for(var t,n=i(e.update_list.up_list);!(t=n()).done;){var l,o,u,a=t.value;"number"==typeof this.guildInfo[a.name]?this.guildInfo[a.name]=null!=(l=a.val)?l:this.guildInfo[a.name]:"string"==typeof this.guildInfo[a.name]?this.guildInfo[a.name]=null!=(o=a.str)?o:this.guildInfo[a.name]:"guild_flag"==a.name&&(this.guildInfo[a.name]=null!=(u=a.list)?u:this.guildInfo[a.name])}normalEvent.emit(h.GUILD_INFO_UPDATE)},e.UpdateMemberInfo=function(e){if(1==e.change_type||3==e.change_type)for(var n,l=i(e.member_list);!(n=l()).done;){var u,a,r,s,d,m=n.value;if(this.memberList[m.role_id]=m,m.role_id==IS(f).GetRoleId())this.memberInfo={role_id:m.role_id,role_name:m.role_name,role_head:m.role_head,career:m.career,is_online:null!=(u=m.is_online)?u:0,offline_time:null!=(a=m.offline_time)?a:0,donate_sum:null!=(r=m.donate_sum)?r:0,donate_week:null!=(s=m.donate_week)?s:0,donate_count:null!=(d=m.donate_count)?d:0},IS(o).changeValue("GuildMainView/btnInfo",IS(t).GetGuildRedNum()),normalEvent.emit(_.UPDATE_MAIN_GUILD_RED_POINT)}else for(var g,c=i(e.member_list);!(g=c()).done;){var p=g.value;delete this.memberList[p.role_id]}normalEvent.emit(h.GUILD_INFO_UPDATE)},e.QuitGuild=function(){this.guildInfo={guild_id:0,create_time:0,name:"",notice:"",leader_id:0,is_auto_join:0,join_limit_lv:0,level:0,exp:0,member_num:0,guild_flag:null,country:0,gvg_notice:""},this.memberInfo={role_id:0,role_name:"",role_head:null,career:0,is_online:0,offline_time:0,donate_sum:0,donate_week:0,donate_count:0},this.memberList=[],this.apply_list=[],this.guildLog=[],IS(o).changeValue("GuildMainView/btnInfo",IS(t).GetGuildRedNum()),normalEvent.emit(_.UPDATE_MAIN_GUILD_RED_POINT)},e.RemoveGuildMember=function(e){delete this.memberList[e.role_id],normalEvent.emit(h.GUILD_INFO_UPDATE)},e.SetGuildList=function(e){if(1!=e.type||0!=e.guild_list.length)if(3==e.type){if(1==e.page)this.guild_list_info={guild_list:e.guild_list};else{if(null==this.guild_list_info.page||this.guild_list_info.page==e.page)return;for(var i=0;i<e.guild_list.length;i++)this.guild_list_info.guild_list.push(e.guild_list[i])}this.guild_list_info.page=e.page,this.guild_list_info.page_num=e.page_num,this.guild_list_info.isMax=e.page==e.page_num,normalEvent.emit(h.GUILD_LIST_UPDATE)}else normalEvent.emit(h.GUILD_SEARCH_UPDATE,e.guild_list);else d.showFlyTip(GetLanguage(200325))},e.SetGuildRankList=function(e){if(1==e.page)this.guild_rank_list[e.rank_type]={rank_list:e.rank_list};else{if(null==this.guild_rank_list[e.rank_type].page||this.guild_rank_list[e.rank_type].page==e.page)return;for(var i=0;i<e.rank_list.length;i++)this.guild_rank_list[e.rank_type].rank_list.push(e.rank_list[i])}this.guild_rank_list[e.rank_type].my_rank=e.my_rank,this.guild_rank_list[e.rank_type].page=e.page,this.guild_rank_list[e.rank_type].max_page=e.max_page,this.guild_rank_list[e.rank_type].isMax=e.page==e.max_page,normalEvent.emit(h.GUILD_RANK_LIST_UPDATE)},e.SetGuildApplyList=function(e){var i;this.apply_list=null!=(i=e.apply_list)?i:[],normalEvent.emit(h.GUILD_APPLY_UPDATE),IS(o).changeValue("GuildMainView/btnInfo",IS(t).GetGuildRedNum()),normalEvent.emit(_.UPDATE_MAIN_GUILD_RED_POINT)},e.UpdateApprove=function(e){for(var i=0;i<this.apply_list.length;i++)if(this.apply_list[i].apply_uid==e.apply_uid){this.apply_list.splice(i,1);break}normalEvent.emit(h.GUILD_APPLY_UPDATE),IS(o).changeValue("GuildMainView/btnInfo",IS(t).GetGuildRedNum()),normalEvent.emit(_.UPDATE_MAIN_GUILD_RED_POINT)},e.UpdateSelfApplyList=function(e){this.self_apply_list={};for(var t,n=i(e.guild_ids);!(t=n()).done;){var l=t.value;this.self_apply_list[l]=!0}normalEvent.emit(h.GUILD_SELF_APPLY_UPDATE)},e.UpdateJoin=function(e){this.self_apply_list[e.guild_id]=!0,normalEvent.emit(h.GUILD_SELF_APPLY_UPDATE)},e.UpdateGuildRes=function(e){for(var i=0;i<e.change_info.length;i++){var t=e.change_info[i];0!=t.gtid&&(null==this.guildRes[t.gtid]&&(this.guildRes[t.gtid]={}),this.guildRes[t.gtid]=t.num,t.gtid==r.GuildExp&&(this.guildInfo.exp=t.num,normalEvent.emit(h.GUILD_INFO_UPDATE)))}},e.UpdateDonate=function(e){this.memberInfo.donate_sum=e.donate_sum,this.memberInfo.donate_week=e.donate_week,this.memberInfo.donate_count=e.donate_count,IS(o).changeValue("GuildMainView/btnInfo",IS(t).GetGuildRedNum()),normalEvent.emit(_.UPDATE_MAIN_GUILD_RED_POINT),normalEvent.emit(h.GUILD_INFO_UPDATE)},e.UpdateGuildHelpList=function(e){var n;if(this.dailyHelpCount=null!=(n=e.daily_count)?n:0,1==e.type){this.guildHelpList=[],this.myHelpList=[];for(var l,u=IS(f).GetRoleId(),a=i(null!=(r=e.help_list)?r:[]);!(l=a()).done;){var r,s=l.value;this.guildHelpList[s.id]=s,s.role_id==u&&(this.myHelpList[s.id]=s)}}else{this.myHelpList=[];for(var d,m=i(null!=(g=e.help_list)?g:[]);!(d=m()).done;){var g,c=d.value;this.guildHelpList[c.id]=c,this.myHelpList[c.id]=c}}normalEvent.emit(h.GUILD_HELP_UPDATE),IS(o).changeValue("GuildMainView/btnInfo",IS(t).GetGuildRedNum()),normalEvent.emit(_.UPDATE_MAIN_GUILD_RED_POINT)},e.UpdateGuildHelp=function(e){for(var n,l=IS(f).GetRoleId(),u=i(null!=(a=e.update_list)?a:[]);!(n=u()).done;){var a,r=n.value;this.guildHelpList[r.id]=r,r.role_id==l&&(this.myHelpList[r.id]=r)}normalEvent.emit(h.GUILD_HELP_UPDATE),IS(o).changeValue("GuildMainView/btnInfo",IS(t).GetGuildRedNum()),normalEvent.emit(_.UPDATE_MAIN_GUILD_RED_POINT)},e.UpdateGuildHelpState=function(e){var i;this.myHelpState=null!=(i=e.status)?i:[],normalEvent.emit(h.GUILD_HELP_UPDATE),IS(o).changeValue("GuildMainView/btnInfo",IS(t).GetGuildRedNum()),normalEvent.emit(_.UPDATE_MAIN_GUILD_RED_POINT)},e.UpdateDailyHelp=function(e){var i;this.dailyHelpCount=null!=(i=e.new_daily_count)?i:0,normalEvent.emit(h.GUILD_HELP_UPDATE),IS(o).changeValue("GuildMainView/btnInfo",IS(t).GetGuildRedNum()),normalEvent.emit(_.UPDATE_MAIN_GUILD_RED_POINT)},e.UpdateGuildLog=function(e){for(var t,n=i(e.log_list);!(t=n()).done;){var l=t.value;this.guildLog.push(l)}this.guildLog.sort((function(e,i){return e.log_time!=i.log_time?i.log_time-e.log_time:i.guild_log_id-e.guild_log_id})),normalEvent.emit(h.GUILD_LOG_UPDATE)},e.GetGuildInfo=function(){return this.guildInfo},e.GetMemberInfo=function(){return this.memberInfo},e.GetMemberList=function(){return this.memberList},e.GetGuildList=function(){var e;return null!=(e=this.guild_list_info)?e:{}},e.GetGuildRankList=function(){var e;return null!=(e=this.guild_rank_list)?e:{}},e.GetGuildRankListByType=function(e){var i;return null!=(i=this.guild_rank_list[e])?i:{}},e.GetApplyList=function(){return this.apply_list},e.GetSelfApplyList=function(){return this.self_apply_list},e.GetLog=function(){return this.guildLog},e.IsGuildMember=function(e){return!!IS(t).GetMemberList().hasOwnProperty(e)},e.IsAskHelp=function(e,i){for(var t in this.myHelpState)if(this.myHelpState.hasOwnProperty(t)){var n=this.myHelpState[t];if(n.type==e&&n.sub_type==i)return 1==n.status}return!1},e.isHelp=function(e){var i=this.guildHelpList[e];return i?i.helpers.includes(IS(f).GetRoleId()):null},e.getHelpList=function(){var e;return null!=(e=this.guildHelpList)?e:[]},e.GetMainRedNum=function(){var e=0;return e+=this.GetGuildBossRedNum(),e+=this.GetGuildRedNum(),this.IsHelpMaxReward()&&this.GetGuildHelpRed()>0&&e--,e},e.GetGuildRedNum=function(){var e=0;return e+=this.HasApplyList()?1:0,e+=IS(f).HasGuild()&&0==this.memberInfo.donate_count?1:0,e+=IS(t).CheckPermissioByType(g.Flag)&&(!this.guildInfo.guild_flag||this.guildInfo.guild_flag.length<8)?1:0,e+=this.GetGuildHelpRed()},e.GetGuildBossRedNum=function(){var e=0;return e+=this.GetGuildBossKeyRed(),e+=this.GetGuildBossBoxRed()},e.GetGuildBossKeyRed=function(){return IS(s).getGoodsCountByGoodsGtid(7002)>=a.league_solo_chapter_recover[1]?1:0},e.GetGuildBossBoxRed=function(){return IS(m).getBoxRedPoint()},e.GetGuildHelpRed=function(){var e=IS(f).GetRoleId(),i=this.guildHelpList,n=u.serverTime,l=configGuild_level.getDataByKey(this.guildInfo.level);if(!l)return 0;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];if(a.role_id!=e&&a.help_num<l.help_limit&&n<a.end_time&&!IS(t).isHelp(a.id))return 1}return 0},e.IsHelpMaxReward=function(){return this.dailyHelpCount>=a.guild_help_reward_limit},e.HasApplyList=function(){return!!(IS(t).CheckPermissioByType(g.Apply)&&this.apply_list.length>0)},e.CheckPermissioByType=function(e){var t,n=null!=(t=this.memberInfo.career)?t:0;if(0!=n){var l=configGuild_career.getDataByKey(n);if(l)for(var o,u=i(l.permissions);!(o=u()).done;){if(o.value==e)return!0}}return!1},e.CompareCareer=function(e,t){if(e==t)return 0;if(0!=e){var n=configGuild_career.getDataByKey(e);if(n)for(var l,o=i(n.low_job);!(l=o()).done;){if(l.value==t)return-1}}return 1},e.CheckLowerSelfCareer=function(e){var t,n=null!=(t=this.memberInfo.career)?t:0;if(0!=n){var l=configGuild_career.getDataByKey(n);if(l)for(var o,u=i(l.low_job);!(o=u()).done;){if(o.value==e)return!0}}return!1},e.CheckCanExpelCareer=function(e){var t,n=null!=(t=this.memberInfo.career)?t:0;if(0!=n){var l=configGuild_career.getDataByKey(n);if(l)for(var o,u=i(l.expel);!(o=u()).done;){if(o.value==e)return!0}}return!1},e.CheckCanChangeCareer=function(e){var t,n=null!=(t=this.memberInfo.career)?t:0;if(0!=n){var l=configGuild_career.getDataByKey(n);if(l)for(var o,u=i(l.recall);!(o=u()).done;){if(o.value==e)return!0}}return!1},e.GetDonateNum=function(){var e;return null!=(e=this.memberInfo.donate_count)?e:0},e.SetGuildQuestion=function(e){this.guildQuestion={question:e.question,number:e.number,is_show:e.is_show,countdown:e.countdown,rank_list:e.rank_list},normalEvent.emit(h.GUIDE_UPDATE_QUESTION)},e.SetGuildQuestionRank=function(e){this.guildQuestion&&e.rank_list&&(this.guildQuestion.rankList=e.rank_list,normalEvent.emit(h.GUIDE_UPDATE_QUESTION_RANK))},e.GetGuildQuestion=function(){return this.guildQuestion},e.UpdateGuildDiceTime=function(e){e.countdown-a.quiz_dice_time>this.guildDiceTime&&(this.guildDiceTime=e.countdown,normalEvent.emit(h.GUILD_DICE_START_UPDATE))},e.GetGuildDiceTime=function(){return this.guildDiceTime},e.UpdateGuildDiceResult=function(e){this.guildDiceTime=u.serverTime,normalEvent.emit(h.GUILD_DICE_RESULT_UPDATE,e)},e.checkTreasureMapping=function(){return!(!this.boxInfo||0==this.boxInfo.round)},e.clearRoleActions=function(){this.roleActions[c.Add].clear(),this.roleActions[c.Del].clear(),this.roleActions[c.Move].clear(),this.roleActions[c.Break].clear()},t}());t._RF.pop()}}}));

