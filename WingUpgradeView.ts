System.register("chunks:///_virtual/WingUpgradeView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIList.ts","./RedPoint.ts","./RedPointMgr.ts","./NodeUtil.ts","./StringUtil.ts","./index57.ts","./ConfigGlobal.ts","./BagModel.ts","./MessageView.ts","./WingControl.ts","./WingDataCache.ts","./WingDefine.ts","./BaseSubView.ts"],(function(t){"use strict";var e,i,n,o,s,r,h,a,d,l,c,f,u,g,v,C,p,b,m,w,I,_,k,y,S,B;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,n=t.Button,o=t.Sprite,s=t.Vec2,r=t.sys,h=t.Label,a=t.ProgressBar,d=t.Widget,l=t.ScrollView,c=t.RichText,f=t.Layout,u=t.js,g=t.Color},function(t){v=t.ListItem},function(t){C=t.RedPointType},function(t){p=t.RedPointNode},function(t){b=t.default},function(t){m=t.default},null,function(t){w=t.ConfigGlobal},function(t){I=t.BagModel},function(t){_=t.default},function(t){k=t.default},function(t){y=t.WingDataCache},function(t){S=t.WingEvent},function(t){B=t.BaseSubView}],execute:function(){i._RF.push({},"eb663OjJXpCyak8GI5V9fo6","WingUpgradeView",void 0);t("default",function(t){function i(){var e;return(e=t.call(this)||this).nodeRoot=void 0,e.btnOne=void 0,e.btnTen=void 0,e.btnUse=void 0,e.btnCancel=void 0,e.pbExp=void 0,e.pbText=void 0,e.nodeUnlock=void 0,e.nodeUnlockDes=void 0,e.featureList=void 0,e.featureLevel=void 0,e.showRoot=void 0,e.showName=void 0,e.artifactEffectID=0,e.attrName=void 0,e.attrBase=void 0,e.attrNextArrow=void 0,e.attrNext=void 0,e.btnOneNum=void 0,e.btnTenNum=void 0,e.tenRedPoint=void 0,e.btnLeft=void 0,e.btnRight=void 0,e.showID=void 0,e.showEffId=void 0,e.showOrder=0,e.txtLevel=void 0,e.selectedFeature=0,e.bookRed=void 0,e.btnTop=void 0,e.name="WingUpgradeView",e.url="ui/module/wing/WingUpgradeView",e.poolTime=3e3,e}e(i,t);var v=i.prototype;return v.onInit=function(){this.nodeRoot=this.findChild("root");var t=this.findChild("root/nodeItem");this.addComponentCallbackListener(t,n.EventType.CLICK,(function(){IS(I).OpenItemTips(1084,t)}));var e=this.findChildComponent("root/nodeItem/Sprite",o);this.loadIcon(e,"back","bs_icon_yumao1");var i=this.findChild("root/bookBtn");this.bookRed=new p,this.bookRed.addRedPoint(i,new s(23,30),C.Dot),this.addComponentCallbackListener(i,n.EventType.CLICK,(function(){uiMgr.openView("WingBookView")})),this.loadIcon(i.getComponent(o),"back","bs_icon_tujian"),r.uiMirror&&this.findChild("root/bookBtn/Label").setScale(1,1,1),this.InitWingInfo()},v.InitWingInfo=function(){var t=this;if(this.showRoot=this.findChild("root/nodeShow/icon"),this.showName=this.findChildComponent("root/nodeShow/bgName/txtName",h),this.btnLeft=this.findChild("root/nodeShow/btnLeft"),this.addComponentCallbackListener(this.btnLeft,n.EventType.CLICK,(function(){t.showOrder--;var e=w.back_decoration_unlock[t.showOrder][0];t.showID=e,t.refreshWingShow(),t.checkPageBtn()})),this.btnRight=this.findChild("root/nodeShow/btnRight"),this.addComponentCallbackListener(this.btnRight,n.EventType.CLICK,(function(){t.showOrder++;var e=w.back_decoration_unlock[t.showOrder][0];t.showID=e,t.refreshWingShow(),t.checkPageBtn()})),this.nodeUnlock=this.findChild("root/nodeShow/nodeUnlock"),this.nodeUnlockDes=this.findChildComponent("root/nodeShow/nodeUnlock/level",h),this.txtLevel=this.findChildComponent("root/nodeProgress/ProgressBar/Node",h),this.pbExp=this.findChildComponent("root/nodeProgress/ProgressBar",a),this.pbText=this.findChildComponent("root/nodeProgress/ProgressBar/txtDesc",h),this.btnCancel=this.findChild("root/nodeShow/btnCancel"),this.addComponentCallbackListener(this.btnCancel,n.EventType.CLICK,(function(){IS(k).send_wing_use_c2s(0)})),this.btnUse=this.findChild("root/nodeShow/btnUse"),this.addComponentCallbackListener(this.btnUse,n.EventType.CLICK,(function(){IS(k).send_wing_use_c2s(t.showID)})),this.btnOne=this.findChild("root/nodeChange/btnOne"),this.addComponentCallbackListener(this.btnOne,n.EventType.CLICK,(function(){t.onClickOne()})),this.btnTop=this.findChild("root/nodeChange/btnTop"),this.btnOneNum=this.findChildComponent("root/nodeChange/btnOne/txtNum",h),this.btnTen=this.findChild("root/nodeChange/btnTen"),this.addComponentCallbackListener(this.btnTen,n.EventType.CLICK,(function(){t.onClickTen()})),this.tenRedPoint=new p,this.tenRedPoint.addRedPoint(this.btnTen,new s(100,30),C.Dot),this.btnTenNum=this.findChildComponent("root/nodeChange/btnTen/txtNum",h),r.uiMirror){var e=this.findChildComponent("root/nodeChange/btnOne/txtNum/common_ui_jinggao",d);e.alignFlags=32,e.right=-67.287;var i=this.findChildComponent("root/nodeChange/btnTen/txtNum/common_ui_jinggao",d);i.alignFlags=32,i.right=-67.287}this.featureList=this.addUIList(this.findChildComponent("root/nodeFeather/ScrollView",l),L),this.featureList.lackCenter=!0,this.featureLevel=this.findChildComponent("root/nodeFeather/level",c),this.attrName=this.findChildComponent("root/nodeChange/item/txtAttrName",h),this.attrBase=this.findChildComponent("root/nodeChange/item/txtAttrBase",h),this.attrNextArrow=this.findChild("root/nodeChange/item/arrow"),this.attrNext=this.findChildComponent("root/nodeChange/item/txtAttrNext",h),r.uiMirror&&this.dealMirrorLayout(this.findChildComponent("root/nodeChange/item/title",f))},v.onAfterOpen=function(){this.showEffId=null,this.selectedFeature=null,this.showOrder=0,this.showID=w.back_decoration_unlock[this.showOrder][0],this.SelectFeature(1001),this.refreshUpgradeShow(),this.RefreshBookRed()},v.registerUpdateHandler=function(){this.addEvent(S.TYPE_WING_CHANGE,this.refreshUpgradeShow,this),this.addEvent(S.TYPE_WING_CHANGE,this.UpdateFeatureInfo,this),this.addEvent(S.TYPE_WING_BOOK_RED_CHANGE,this.RefreshBookRed,this)},v.RefreshBookRed=function(){this.bookRed.notifyNum=IS(y).GetCollectionRed()},v.refreshFeature=function(){var t=configBack_level.getDataListByMainKey("id"),e=[];for(var i in t)e.push(t[i][0]);this.featureList.datas=e},v.SelectFeature=function(t){this.selectedFeature!=t&&(this.selectedFeature=t,this.featureList.updateAll(),this.UpdateFeatureInfo())},v.UpdateFeatureInfo=function(){for(var t=this.selectedFeature,e=IS(y).GetFeatureInfo(t),i=configBack_level.getDataListByKey(t),n=0,o=0;o<i.length;o++)0==i[o].era_level&&(n+=1);var s=configBack_level.getDataByKeys("id",t,"level",1),r=configAttribute.getDataByKey(s.attr[0][0]),h=s,a=0;e.level>0&&(h=configBack_level.getDataByKeys("id",t,"level",e.level),a=configBack_level.getDataByKeys("id",t,"level",e.level+IS(y).GetBookAddLev()).attr[0][1]);var d=configBack_level.getDataByKeys("id",t,"level",e.level+1);if(this.attrName.string=r.name,2==r.show_type?this.attrBase.string=u.formatStr("%s%",m.GetNumString(a/100)):3==r.show_type?this.attrBase.string=m.GetNumString(Math.floor(a/100)/100):this.attrBase.string=m.GetNumString(a),d&&1!=d.era_level){this.btnTop.active=!1,this.btnOne.active=!0,this.btnTen.active=!0,this.attrNextArrow.active=!0,2==r.show_type?this.attrNext.string=u.formatStr("%s%",m.GetNumString(d.attr[0][1]/100)):3==r.show_type?this.attrNext.string=m.GetNumString(Math.floor(d.attr[0][1]/100)/100):this.attrNext.string=m.GetNumString(d.attr[0][1]);var l=e.exp-h.expend_exp,c=d.expend_exp-h.expend_exp;this.pbExp.progress=l/c,this.pbText.string=l+"/"+c}else this.btnTop.active=!0,this.btnOne.active=!1,this.btnTen.active=!1,this.attrNextArrow.active=!1,this.attrNext.string="",this.pbExp.progress=1,this.pbText.string=h.expend_exp+"/"+h.expend_exp;var f=e.level;IS(y).GetBookAddLev()>0&&(f=u.formatStr("%s<color=#00a100>(+%s)</color>",f,IS(y).GetBookAddLev())),this.featureLevel.string=u.formatStr("<b><color=#544231>%s</color></b>",m.formatStr(GetLanguage(201816),f,n)),this.refreshItemNum()},v.onClickOne=function(){IS(I).getGoodsCountByGoodsGtid(1084)<1?(_.showFlyTip(GetLanguage(200069)),uiMgr.openView("ItemGetWayView",1084)):IS(k).send_wing_feather_level_up_c2s(this.selectedFeature,1)},v.onClickTen=function(){IS(I).getGoodsCountByGoodsGtid(1084)<1?(_.showFlyTip(GetLanguage(200069)),uiMgr.openView("ItemGetWayView",1084)):IS(k).send_wing_feather_level_up_c2s(this.selectedFeature,2)},v.checkOneKeyShow=function(){var t=this.selectedFeature,e=IS(I).getGoodsCountByGoodsGtid(1084),i=IS(y).GetFeatureInfo(t);this.btnTenNum.color=new g(0==e?"#F33F28":"#67E355"),this.btnOneNum.color=new g(0==e?"#F33F28":"#67E355");var n=configBack_level.getDataByKeys("id",t,"level",i.level+1);if(null!=n){var o=n.expend_exp;o-=i.exp,this.btnTenNum.string=e>=o?"X"+o:"X"+e,this.tenRedPoint.notifyNum=IS(y).GetWingRedById(this.selectedFeature)}else this.btnTenNum.string="X1"},v.refreshWingShow=function(){if(this.checkPageBtn(),this.showEffId!=this.showID){this.showEffId=this.showID;var t=configBack_decoration.getDataByKey(this.showID);this.showName.string=t.name,this.removeUIEffect(this.artifactEffectID),this.artifactEffectID=this.addUIEffect(configBack_decoration.getDataByKey(this.showID).path,this.showRoot,-1,null,1,(function(t){r.uiMirror&&(t.dir=-1)}))}},v.checkPageBtn=function(){this.btnLeft.active=this.showOrder>0,this.btnRight.active=this.showOrder<w.back_decoration_unlock.length-1;var t=IS(y).GetWingIsOpen(this.showID),e=t[0],i=t[1];if(!e)return this.btnUse.active=!1,this.btnCancel.active=!1,this.nodeUnlock.active=!0,void(this.nodeUnlockDes.string=m.formatStr(GetLanguage(201817),i));this.nodeUnlock.active=!1,this.showID==IS(y).wing_id?(this.btnCancel.active=!0,this.btnUse.active=!1):(this.btnCancel.active=!1,this.btnUse.active=!0)},v.refreshItemNum=function(){this.checkOneKeyShow();var t=this.findChildComponent("root/nodeItem/Label",h),e=IS(I).getGoodsCountByGoodsGtid(1084);t.string=""+e},v.refreshUpgradeShow=function(){this.refreshFeature(),this.refreshWingShow()},v.onBeforeClose=function(){this.removeUIEffect(this.artifactEffectID),this.artifactEffectID=null},v.onDestroy=function(){},i}(B));var L=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).level=void 0,e.icon=void 0,e.select=void 0,e.redPoint=void 0,e}e(i,t);var r=i.prototype;return r.onInit=function(){var t=this;this.redPoint=new p,this.redPoint.addRedPoint(this.node,new s(90,-50),C.Dot),this.view.addComponentCallbackListener(this.node,n.EventType.CLICK,(function(){t.view.SelectFeature(t.data.id)})),this.level=b.findChildComponent(this.node,"level",h),this.icon=b.findChildComponent(this.node,"icon",o),this.select=b.findChild(this.node,"select")},r.onRender=function(t,e){this.view.loadIcon(this.icon,"back",t.icon_show),this.redPoint.notifyNum=IS(y).GetWingRedById(t.id);var i=IS(y).GetFeatureInfo(t.id);this.level.string=i.level,this.select.active=this.view.selectedFeature==t.id},r.onItemClick=function(){},i}(v);i._RF.pop()}}}));

