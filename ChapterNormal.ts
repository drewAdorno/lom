System.register("chunks:///_virtual/ChapterNormal.ts",["./rollupPluginModLoBabelHelpers.js","cc","./FixMath.ts","./Target.ts","./EnumDefine.ts","./V2.ts","./BaseChapter.ts"],(function(t){"use strict";var e,i,r,a,n,s,o,h;return{setters:[function(t){e=t.inheritsLoose,i=t.createForOfIteratorHelperLoose},function(t){r=t.cclegacy},function(t){a=t.FixMath},function(t){n=t.TargetUnit},function(t){s=t.TargetFilter},function(t){o=t.V2},function(t){h=t.BaseChapter}],execute:function(){r._RF.push({},"c1750bjVkdCH5xfxYOKv3Q3","ChapterNormal",void 0);var u=new o;t("ChapterNormal",function(t){function r(){for(var e,i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))||this).maxWave=0,e._curWave=0,e._curIndex=0,e._curMonster=void 0,e._waitNextWave=void 0,e._curTime=0,e.nextConfig=void 0,e}e(r,t);var h=r.prototype;return h.init=function(){},h.destroy=function(){},h.start=function(){this.start_wave()},h.toResult=function(t,e){},h.nextPart=function(t){this.setChapter(t),this.start_wave(),this.over=!1},h.toNextPart=function(t){var e=this,r=this.battleMain;r.runningToPart=!0,r.mapCamera.nextPart(t.part-1),r.mapCamera.startPartMove(5);for(var a,s=i(r.playerCtrs);!(a=s()).done;){a.value.positionSelected(r.mapCamera.offsetX)}for(var h,u=i(r.unitMgr.entityList);!(h=u()).done;){var c=h.value;c.isCallType&&(c.wantTarget=n.toPos(new o(r.mapCamera.offsetX+300,c.position.y),n.TP_ManualPoint))}r.addFrameTimer(3,1,(function(){e.nextPartState=2})),this.nextConfig=t,this.nextPartState=1},h.checkNextPart=function(){if(2==this.nextPartState){for(var t,e=this.battleMain,r=0,a=i(e.playerCtrs);!(t=a()).done;){r+=t.value.isIdle()?1:0}if(r<e.playerCtrs.length)return!1;this.nextPartState=3,e.mapCamera.stopMove(),this.nextPart(this.nextConfig.id),e.runningToPart=!1}},h.start_wave=function(){this._curWave=0,this._curMonster=this.config["monster_refresh"+(this._curWave+1)],this.maxWave=this.config.interval.length,this._curTime=0,this._waitNextWave=!1},h.checkPlayerDead=function(){return!!this.battleMain.mainCtr.player.isDead},h.onUpdate=function(t){if(this.checkNextPart(),!this.over){var e=this.battleMain;if(this.checkPlayerDead())return this.over=!0,void this.toResult(1);if(!this.updateTime(t))if(this._waitNextWave){if(0==e.unitMgr.findTarget(e.mainCtr.player,s.Enemy).length){if(this._curWave>=this.maxWave-1)return this.over=!0,void this.toResult(0);this._waitNextWave=!1,this._curWave++,this._curMonster=this.config["monster_refresh"+(this._curWave+1)],null==this._curMonster&&(printLogErr(this.config.id,"->关卡缺少刷怪配置！！！波数：",this._curWave+1),this.over=!0,this.toResult(0))}}else{if(this._curTime<=0){for(var r,n=this._curMonster[this._curIndex],o=n[0],h=this.addUnit(o,1),c=i(this.mapConfig.points);!(r=c()).done;){var f=r.value;if(f[0]===n[1]){h.position=u.set(f[1],f[2]).add2f(e.mapCamera.offsetX,0);break}}h.direction=-1,this.onAddMonster(h),this._curIndex++,this._curTime=this.config.interval[this._curWave],this._curIndex>=this._curMonster.length&&(this._waitNextWave=!0,this._curIndex=0)}this._curTime=a.round(this._curTime-t)}}},h.addUnit=function(t,e){return void 0===e&&(e=0),this.battleMain.unitMgr.addUnit(t,e)},h.onAddMonster=function(t){},r}(h));r._RF.pop()}}}));

