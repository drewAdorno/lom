System.register("chunks:///_virtual/ParkingDataCache.ts",["./rollupPluginModLoBabelHelpers.js","cc","./RedPointMgr.ts","./TimeUtil.ts","./index57.ts","./ConfigGlobal.ts","./ObjectUtil.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./BagModel.ts","./CommonDefine.ts","./MessageView.ts","./RoleDataCache.ts","./RoleDefine.ts","./ParkingDefine.ts","./UIDefine.ts"],(function(t){"use strict";var i,e,n,r,o,s,a,c,l,u,f,h,d,v,_,p,g,k,P,m;return{setters:[function(t){i=t.createForOfIteratorHelperLoose},function(t){e=t.cclegacy,n=t.js},function(t){r=t.RedPointMgr},function(t){o=t.default},null,function(t){s=t.ConfigGlobal},function(t){a=t.default},function(t){c=t.default},function(t){l=t.ActivityType,u=t.ActivityState},function(t){f=t.BagModel},function(t){h=t.CommonEventDefine},function(t){d=t.default},function(t){v=t.RoleDataCache},function(t){_=t.RoleRedPointSystemEnum,p=t.PlayerAttr},function(t){g=t.ParkingEventDefine,k=t.DEC_TYPE},function(t){P=t.PanelTabType,m=t.OpenFunction}],execute:function(){e._RF.push({},"3a559RxfwpKS4ecF6AluLV0","ParkingDataCache",void 0);t("ParkingDataCache",function(){function t(){this.lastReqTime=void 0,this.spaceSearchList=void 0,this.spaceCollectList=void 0,this.publicSpaceInfo=void 0,this.is_focus=void 0,this.CrossRankInfo={},this.merge_time=0,this.robCache=void 0,this.type=void 0,this.master_id=void 0,this.ceng=void 0,this.serv_id=void 0,this.name=void 0,this.show_car=void 0,this.space_num=void 0,this.space_list=[],this.skin_list=void 0,this.protect={is_open:0,protect_ratio:0,protect_type:0},this.info_list=void 0,this.is_collect=void 0,this.extInfo=void 0,this.car_list={},this.defPlayerInfo=void 0,this.taxInfo=void 0,this.skinRedPointList={},this.record_list=void 0,this.history_list=void 0,this.null_space=void 0,this.collect_space=void 0,this.crossParkPreviewInfo=[],this.crossParkInfo=void 0,this.roleState={},this.crossParkRank=void 0,this.nextStamp=0,this.lastReqTime=0}var e=t.prototype;return e.clear=function(){},e.initCarList=function(t){for(var e,n=i(t);!(e=n()).done;){var r=e.value;r&&(this.car_list[r.mount_id]=r)}normalEvent.emit(g.PARKING_CAR_LIST_UPDATE),this.updateMineRedPoint()},e.updateCarList=function(t){this.car_list[t.mount_id]=t,normalEvent.emit(g.PARKING_CAR_LIST_UPDATE),this.updateMineRedPoint()},e.getParkingCarList=function(){var t=this,i=[];for(var e in this.car_list){if(this.car_list.hasOwnProperty(e))0!=this.car_list[e].parking_data.start_time&&i.push(Number(e))}return i.sort((function(i,e){return t.car_list[e].parking_data.type-t.car_list[i].parking_data.type})),i},e.getDecUsingInfo=function(){for(var t,e,n=configParking_design.getDatas(),r=((t={})[k.TYPE_DOOR]=0,t[k.TYPE_FLOOR]=0,t[k.TYPE_FANCE]=0,t[k.TYPE_LIGHT]=0,t),o=i(n);!(e=o()).done;){var s=e.value;1==s.if_initial&&(r[s.position]=s.id)}for(var a,c=i(null!=(l=this.skin_list)?l:[]);!(a=c()).done;){var l,u=a.value;0!=u.pos&&u.pos!=k.TYPE_DEC&&(r[u.pos]=u.skin_id)}return r},e.getUsingFreeDec=function(){for(var t,e=[],n=i(null!=(r=this.skin_list)?r:[]);!(t=n()).done;){var r,o=t.value;o.pos==k.TYPE_DEC&&e.push(o)}return e.sort((function(t,i){return i.y-t.y})),e},e.getDecGainBuffInfo=function(){for(var t,e={},n=i(null!=(r=this.skin_list)?r:[]);!(t=n()).done;){var r,o=t.value,s=configParking_design.getDataByKeys("id",o.skin_id,"level",o.skin_lev);if(s)for(var a,c=i(null!=(l=s.effect)?l:[]);!(a=c()).done;){var l,u=a.value;e.hasOwnProperty(u[0])?e[u[0]]=e[u[0]]+u[1]:e[u[0]]=u[1]}}return e},e.getDecGainBattleBuffInfo=function(){for(var t,e={},n=i(null!=(r=this.skin_list)?r:[]);!(t=n()).done;){var r,o=t.value,s=configParking_design.getDataByKeys("id",o.skin_id,"level",o.skin_lev);if(s)for(var a,c=i(null!=(l=s.pvp_effect)?l:[]);!(a=c()).done;){var l,u=a.value;e.hasOwnProperty(u[0])?e[u[0]]=e[u[0]]+u[1]:e[u[0]]=u[1]}}return e},e.checkOpenRobView=function(){if(this.robCache){if(this.robCache.role_id==IS(v).GetRoleId())return this.robCache=null,void d.showFlyTip(GetLanguage(201159));if(this.type==this.robCache.type&&this.master_id==this.robCache.master_id)for(var t,e=i(this.space_list);!(t=e()).done;){var n=t.value;if(n.pos==this.robCache.pos&&n.role_id==this.robCache.role_id)return uiMgr.openView("ParkingRobView",this.robCache.pos,this.robCache.type,this.robCache.master_id,1),void(this.robCache=null)}this.robCache=null,d.showFlyTip(GetLanguage(200754))}},e.updateMineRedPoint=function(){IS(r).changeValue(n.formatStr("MainView/tab-%s/parking",P.Main_Mystery),this.getParkingRedPoint()),normalEvent.emit(h.UPDATE_MAIN_MYSTERY_RED_POINT)},e.getParkingRedPoint=function(){if(!IS(v).CheckFuncOpen(m.FUNC_PARKING))return 0;var t=0;if(IS(v).getRedNumByModule(_.System_Parking,2)>0)return 1;for(var e,n=this.getParkingCarList(),r=i(n);!(e=r()).done;){var a=e.value,c=this.car_list[a];if(o.serverTime-c.parking_data.start_time>=60*s.park_time_limit)return 1}return t+=this.checkDecRP()},e.checkDecRP=function(){for(var e,n,r=null!=(e=IS(t).skin_list)?e:[],o={},s=i(r);!(n=s()).done;){var c=n.value;o[c.skin_id]=c.skin_lev}if(a.isEmpty(o))return 0;if(IS(t).master_id!=IS(v).GetRoleId())return 0;this.skinRedPointList={};for(var l,u=configParking_design.getDataByList("level",0),h=i(u);!(l=h()).done;){var d,_=l.value,p=configParking_design.getDataByKeys("id",_.id,"level",null!=(d=o[_.id])?d:0);if(p.expend&&p.expend.length>0)IS(f).getGoodsCountByGoodsGtid(_.expend[0][0])>=p.expend[0][1]&&(this.skinRedPointList[p.position]=1)}for(var g=1;g<6;g++)if(this.skinRedPointList[g])return 1;return 0},e.getCrossSpotInfoByID=function(t){for(var e,n=[],r=i(this.crossParkPreviewInfo);!(e=r()).done;){var o=e.value;o.server_id==t&&n.push({info:o,park_type:3})}return n.sort((function(t,i){return t.info.id%100-i.info.id%100})),n},e.getCrossParkRankInfo=function(){return this.crossParkRank},e.checkCrossOpen=function(){if(this.checkMergeLock())return printLogErr("checkCrossOpen==>MergeLock1"),!1;var i=IS(v).GetRoleAttr(p.ROLE_ATTR_CREATE_DAY);if(Math.floor((o.serverTime-i)/86400)<s.park_cross_creat_limit)return printLogErr("checkCrossOpen==>open3"),!1;var e=IS(c).GetActivityInfo(l.CrossParking);return!e||e.state!=u.Open&&e.state!=u.EndShow?o.ServerDate(1e3*IS(t).nextStamp).getTime()-1e3*o.lastServerTime<0&&(printLogErr("checkCrossOpen==>open2"),!0):(printLogErr("checkCrossOpen==>open1"),!0)},e.checkMergeLock=function(){var i=IS(t).merge_time,e=i+604800;return o.serverTime>i&&o.serverTime<e},t}());e._RF.pop()}}}));

