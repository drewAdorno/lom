System.register("chunks:///_virtual/ChapterTeam20CC.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BattleData.ts","./index94.ts","./MetaAttrib.ts","./Target.ts","./EnumDefine.ts","./EventDefine.ts","./CameraMgr.ts","./TimeUtil.ts","./BattleDefine.ts","./ChapterDefine.ts","./GuildWarControl.ts","./GuildWarDataCache.ts","./RoleDataCache.ts","./ChapterTeam20.ts"],(function(t){"use strict";var e,a,i,n,s,r,o,l,u,h,c,b,p,d,f,m,v,C,T,M;return{setters:[function(t){e=t.inheritsLoose,a=t.createForOfIteratorHelperLoose,i=t.regeneratorRuntime},function(t){n=t.cclegacy},function(t){s=t.ChapterType},null,function(t){r=t.AttribDefine},function(t){o=t.TargetSkill},function(t){l=t.BattleFlag,u=t.RunState,h=t.UnityType,c=t.HealthType},function(t){b=t.EventDefine},function(t){p=t.cameraMgr},function(t){d=t.default},function(t){f=t.BattleEventDefine},function(t){m=t.ChapterEventDefine},function(t){v=t.default},function(t){C=t.GuildWarDataCache},function(t){T=t.RoleDataCache},function(t){M=t.ChapterTeam20}],execute:function(){n._RF.push({},"a7037K808VDD7fuaEpmN1yd","ChapterTeam20CC",void 0);t("ChapterTeam20CC",function(t){function n(){for(var e,a=arguments.length,i=new Array(a),n=0;n<a;n++)i[n]=arguments[n];return(e=t.call.apply(t,[this].concat(i))||this).combatList=[],e}e(n,t);var M=n.prototype;return M.init=function(){t.prototype.init.call(this),GlobalDefine.BOSS_CLIENT_MODEL||(battleEvent.on(b.T20CombatList,this.onCombatList,this),battleEvent.on(b.T20HpState,this.onCombatHpList,this),battleEvent.on(b.T20BossSkill,this.onBossSkill,this),battleMain.battleFlag=l.LIMIT_SKILL|l.NOT_HURT|l.OPEN_GRAPHIC)},M.loadData=function(e){var i=this.battleMain;t.prototype.loadData.call(this,e);for(var n,s=a(i.playerCtrs);!(n=s()).done;){var r=n.value;if(r.playerData.id==IS(T).GetRoleId()){i.mainCtr=r,i.showMainCtr=i.mainCtr;break}}},M.addBoss=function(){var t=IS(C).bossIndex,e=this.config.bossID;t>0&&(e=this.bossList[t].id);var a=battleMain.unitMgr.addT20Boss(e,1);return IS(C).bossCurHp>0?a.data.currenHp=IS(C).bossCurHp:a.data.currenHp=a.data.getAttribByInt(r.hp),a},M.setChapter=function(e){t.prototype.setChapter.call(this,e),this.timeModel=!1},M.start=function(){t.prototype.start.call(this),battleMain.timeScale=1,p.battleCamera.enabled=!0,this.chapterTime=IS(C).endBattleTime-d.serverTime,this.chapterTime=Math.max(0,this.chapterTime),IS(C).collectCombat=!1,battleMain.data.combatList&&this.execCombatList(battleMain.data.combatList,!1),battleMain.data.hpSateList&&this.onCombatHpList(battleMain.data.hpSateList);var e=IS(C).sratBattleTime-d.serverTime;e>0&&(battleMain.runState=u.Wait,battleMain.hub.showPvpTimer(),battleMain.battleTimer.start(e,1,(function(){battleMain.runState=u.Running})))},M.onCombatList=function(t){var e=this;t.forEach((function(t){e.combatList.push(t)}))},M.onCombatHpList=function(t){for(var e,i=0,n=a(t);!(e=n()).done;){var s=e.value;if(s.unit_type==h.Boss){if(this.bossUnit.hpNum!=s.unit_index){for(var r,o=s.unit_index,l=this.bossUnit.units[o],u=configAttribute.getDataByList("module",1),c=a(u);!(r=c()).done;){var p=r.value;this.bossUnit.data.attribs[p.id].baseValue=l[p.key]}this.bossUnit.data.currenHp=s.hp,this.bossUnit.hpNum=s.unit_index,this.battleMain.emit(b.UnitHpNumChange,this.bossUnit.hpNum)}else this.bossUnit.data.currenHp=s.hp;this.battleMain.emit(b.BossHpChange,this.bossUnit,0)}else{var d=battleMain.data.playerList[s.role_id];if(null==d)continue;i=d.units[0].unitId;var f=battleMain.unitMgr.getUnit(i);if(null==f||f.isDead||f.isDestroy)continue;f.data.currenHp=s.hp,this.battleMain.emit(b.UnitHpChange,f,0)}}},M.onBossSkill=function(t,e){if(0==t&&this.bossUnit){var a=this.bossUnit.data.getSkill(e);if(null==a)return;a.state=0,this.bossUnit.wantSkill=o.toSkill(a,o.TP_Forced)}else if(t>0){var i=battleMain.data.playerList[t];if(null==i)return;var n=battleMain.unitMgr.getUnit(i.units[0].unitId);if(null==n||n.isDead||n.isDestroy)return;var s=n.data.getSkill(e);if(null==s)return;s.state=0,n.wantSkill=o.toSkill(s,o.TP_Forced)}},M.execCombatList=function(t,e){if(void 0===e&&(e=!0),null!=t&&0!=t.length&&!GlobalDefine.BOSS_CLIENT_MODEL)for(var i,n=0,s=a(t);!(i=s()).done;){var r=i.value;if(r.def_type==h.Player){var o=battleMain.data.playerList[r.def_id];if(null==o)continue;n=o.units[0].unitId}else n=this.bossUnit.unitId;var l=battleMain.unitMgr.getUnit(n);null==l||l.isDead||l.isDestroy||(1!=r.is_kill?e&&battleEvent.emit(b.FlyNum,l,r.hurt,1==r.type?c.Hurt:c.Treat):(l.dead(),l.data.roleId==battleMain.roleId&&normalEvent.emit(f.HIDE_SKILL_PANEL)))}},M.endResult=i().mark((function t(e,a,n){return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,coroutine.wait(1);case 2:battleMain.enterChapter(),IS(v).reqGuildBossExit(),normalEvent.emit(m.BATTLE_STATE,s.Team20,!1),battleMain.toResult(e,s.Team20,a,n);case 6:case"end":return t.stop()}}),t)})),M.toResult=function(t,e){void 0===e&&(e=!1);this.battleMain;var a=this.config;coroutine.start(this.endResult(a.id,t,e),"battle")},M.onUpdate=function(e){t.prototype.onUpdate.call(this,e);var a=IS(C).endBattleTime-d.serverTime;if(this.chapterTime=a,a<=0)return this.over=!0,void this.toResult(this.bossUnit.hpNum>0?0:1,!0);this.over||(this.execCombatList(this.combatList),null!=this.combatList&&(this.combatList.length=0))},n}(M));n._RF.pop()}}}));

