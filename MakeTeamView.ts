System.register("chunks:///_virtual/MakeTeamView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./RankTitle.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./UIUnitModelObj.ts","./ConfigGlobal.ts","./AdModel.ts","./BagDefine.ts","./BagModel.ts","./ChapterDataCache.ts","./ChapterDefine.ts","./DungeonControl.ts","./ChatDefine.ts","./CommonModel.ts","./MessageView.ts","./FriendControl.ts","./RoleDataCache.ts","./RoleDefine.ts","./TeamControl.ts","./TeamDataCache.ts","./TeamDefine.ts","./BaseView.ts"],(function(e){"use strict";var t,i,n,a,o,s,r,h,d,l,c,f,g,u,C,m,v,p,L,b,T,_,I,y,S,D,M,w,R,k,A;return{setters:[function(e){t=e.inheritsLoose,i=e.createForOfIteratorHelperLoose},function(e){n=e.cclegacy,a=e.Label,o=e.Sprite,s=e.Button,r=e.js,h=e.sys},function(e){d=e.RankTitle,l=e.TitleType},function(e){c=e.default},function(e){f=e.default},function(e){g=e.default},null,function(e){u=e.UIUnitModelObj},function(e){C=e.ConfigGlobal},function(e){m=e.AdModel},function(e){v=e.BagEventDefine},function(e){p=e.BagModel},function(e){L=e.ChapterDataCache},function(e){b=e.DungeonDefine},function(e){T=e.default},function(e){_=e.ChatDefine},function(e){I=e.CommonModel},function(e){y=e.default},function(e){S=e.default},function(e){D=e.RoleDataCache},function(e){M=e.PlayerAttr},function(e){w=e.default},function(e){R=e.TeamDataCache},function(e){k=e.TeamEvent},function(e){A=e.BaseView}],execute:function(){n._RF.push({},"ac75fe/jVxKY7RC9ksOVTvd","MakeTeamView",void 0);e("default",function(e){function n(){var t;return(t=e.call(this)||this).btnLeft=void 0,t.btnRight=void 0,t.btnShare=void 0,t.sweepLan=void 0,t.btnMatch=void 0,t.btnFriend=void 0,t.btnReady=void 0,t.btnSweep=void 0,t.nodeTips=void 0,t.txtTips=void 0,t.txtPreview=void 0,t.curLevel=void 0,t.imgReward=void 0,t.imgKey=void 0,t.modelList=[],t.effectList=[],t.matchTime=0,t.MatchTimer=0,t.matching=!1,t.data=void 0,t.ready=void 0,t.shareCD=10,t.can_share=!0,t.btnAd=void 0,t.txtAdDesc=void 0,t.txtAdCount=void 0,t.adId=void 0,t.name="MakeTeamView",t.url="ui/module/team/MakeTeamView",t.poolTime=3e3,t}t(n,e);var A=n.prototype;return A.onInit=function(){var e=this;this.txtPreview=this.findChildComponent("root/nodeBtn/node1/btnMatch/next",a),this.nodeTips=this.findChild("root/nodeDesc/nodeTips"),this.txtTips=this.findChildComponent("root/nodeDesc/nodeTips/txtTips",a),this.imgReward=this.findChildComponent("root/nodeDesc/7",o),this.imgKey=this.findChildComponent("root/nodeDesc/1005",o),this.btnLeft=this.findChild("root/nodeDesc/btnLeft"),this.addComponentCallbackListener(this.btnLeft,s.EventType.CLICK,(function(){e.curLevel-=1,IS(w).reqChooseDiff(e.curLevel),e.refreshDesc()})),this.btnRight=this.findChild("root/nodeDesc/btnRight"),this.addComponentCallbackListener(this.btnRight,s.EventType.CLICK,(function(){e.curLevel+=1,IS(w).reqChooseDiff(e.curLevel),e.refreshDesc()})),this.btnMatch=this.findChild("root/nodeBtn/node1/btnMatch"),this.addComponentCallbackListener(this.btnMatch,s.EventType.CLICK,(function(){IS(D).GetRoleId()==IS(R).leader_id&&(e.matching?(IS(w).reqTeamMatch(0),e.matching=!1,e.refreshMatch()):(IS(w).reqTeamMatch(e.curLevel),e.matching=!0,e.refreshMatch()))})),this.btnFriend=this.findChild("root/nodeBtn/node1/btnFriend"),this.addComponentCallbackListener(this.btnFriend,s.EventType.CLICK,(function(){IS(w).reqTeamApply()})),this.btnShare=this.findChild("root/bg/btnShare"),this.addComponentCallbackListener(this.btnShare,s.EventType.CLICK,(function(){e.matching?y.showFlyTip(GetLanguage(200615)):IS(R).member_list.length>=3?y.showFlyTip(GetLanguage(200616)):e.can_share?(e.shareCD=10,e.can_share=!1,uiMgr.openView("ChatView",null,null,{contentType:_.ChatContentType.Share,linkType:_.ChatLinkType.MakeTeam,cacheData:{teamID:IS(R).team_id,level:e.curLevel},showString:GetLanguage(200160)}),e.addTimer(1,10,(function(){e.shareCD-=1,e.shareCD<=0&&(e.can_share=!0)}))):y.showFlyTip(f.formatStrWithMirrorDeal(GetLanguage(300106),e.shareCD))})),this.btnReady=this.findChild("root/nodeBtn/node/btnReady"),this.addComponentCallbackListener(this.btnReady,s.EventType.CLICK,(function(){e.ready?IS(w).reqTeamReady(0):IS(w).reqTeamReady(1)})),this.btnSweep=this.findChild("root/nodeBtn/node/btnSweep"),this.addComponentCallbackListener(this.btnSweep,s.EventType.CLICK,(function(){e.sweepLan?y.showFlyTip(GetLanguage(e.sweepLan)):IS(T).reqSweep(b.CHAPTER_TYPE_LEGACY_TEAM,e.curLevel,1)})),this.btnAd=this.findChild("root/nodeBtn/node/btnAd"),this.txtAdDesc=c.findChildComponent(this.btnAd,"txtDesc",a),this.txtAdCount=c.findChildComponent(this.btnAd,"txtCount",a),this.btnAd.active=!1,this.addComponentCallbackListener(this.btnAd,s.EventType.CLICK,(function(){IS(m).tryWatchAd(e.adId)}));var t=this.findChild("root/bg/btnClose");this.addComponentCallbackListener(t,s.EventType.CLICK,(function(){var t=GetLanguage(200617);y.showBoxTip({tip:t,ensure:GetLanguage(200129),cancel:GetLanguage(200054),btnCnt:2,func:function(t){"type_yes"==t&&(IS(w).reqTeamExit(),e.close())}})}))},A.registerUpdateHandler=function(){this.addEvent(k.TEAM_INFO_CHANGE,this.afterRefreshShow,this),this.addEvent(v.GOODS_INFO_UPDATE,this.afterRefreshShow,this),this.addEvent(k.TEAM_CLOSE,this.onTeamClose,this)},A.onTeamClose=function(){this.close()},A.onAfterOpen=function(){var e=configChapter_type.getDataByKey(b.CHAPTER_TYPE_LEGACY_TEAM);this.adId=e.ad,uiMgr.close("ChatView");var t=C.max_match_time;this.txtPreview.string=f.formatStrWithMirrorDeal(GetLanguage(300101),t),c.findChildComponent(this.btnMatch,"Label",a).string=GetLanguage(300076),0==IS(R).member_list.length&&IS(w).reqTeamCreate(8),this.afterRefreshShow()},A.afterRefreshShow=function(){this.curLevel=0==IS(R).teamDiff?1:IS(R).teamDiff,this.refreshChooseDiff(),this.refreshDesc(),this.refreshTeamMember()},A.refreshDesc=function(){var e=this.findChildComponent("root/nodeDesc/Label",a),t=this.findChildComponent("root/nodeDesc/txtReward",a),i=this.findChildComponent("root/nodeDesc/txtKey",a),n=IS(p).getGoodsCountByGoodsGtid(1009);i.string=GetLanguage(300078)+":"+n;var o=configLegacy_team_chapter.getDataByList("level",this.curLevel,"diff",1);e.string=""+this.curLevel,t.string=GetLanguage(300077)+":"+o[o.length-1].reward[0][1],this.refreshChooseDiff(),this.refreshADInfo(),this.checkSweepBtn()},A.refreshChooseDiff=function(){if(1!=IS(R).member_list.length||this.matching)return this.btnLeft.active=!1,void(this.btnRight.active=!1);var e=IS(L).getDungeonInfoByID(b.CHAPTER_TYPE_LEGACY_TEAM);this.nodeTips.active=!1,this.btnLeft.active=!0,this.btnRight.active=!0,1==this.curLevel&&(this.btnLeft.active=!1),(this.curLevel>=IS(R).max_diff||this.curLevel>=e.max_level)&&(this.btnRight.active=!1);var t=configLegacy_team_chapter.getDatas(),i=t[t.length-1].level;if(this.curLevel<i&&this.curLevel==IS(R).max_diff){var n=configLegacy_team_chapter.getDataByList("level",this.curLevel+1,"diff",1);this.nodeTips.active=!0;var a=g.serverOpenTime,o=new Date(1e3*a),s=r.formatStr("%s/%s/%s %s:%s:%s",o.getFullYear(),o.getMonth()+1,o.getDate(),0,0,0),h=new Date(s).getTime()/1e3,d=g.serverTime-h,l=Math.floor(d/86400+1),c=n[n.length-1].unlock_day;this.txtTips.string=l<c?f.formatStrWithMirrorDeal(GetLanguage(300105),c-l):GetLanguage(200618)}},A.refreshTeamMember=function(){var e=this;if(0!=this.modelList.length)for(var t,n=i(this.modelList);!(t=n()).done;){var r=t.value;this.removeUnitModel(r)}if(0!=this.effectList.length)for(var f,g=i(this.effectList);!(f=g()).done;){r=f.value;this.removeUIEffect(r)}for(var C=function(){var t=IS(R).member_list[m];if(v=e.findChild("root/nodeTeamShow/NodeMember"+m),e.addComponentCallbackListener(v,s.EventType.CLICK,(function(){t&&IS(S).reqOtherRoleNotice(t.role_id)})),e.addComponentCallbackListener(c.findChild(v,"pet"),s.EventType.CLICK,(function(){t&&t.role_id==Number(IS(D).GetRoleId())&&uiMgr.openView("PetSelectView")})),p=c.findChildComponent(v,"pet",o),L=c.findChild(v,"title"),b=c.findChild(v,"img"),T=c.findChild(v,"nodeReady"),_=c.findChildComponent(v,"bgID/txtID",a),y=c.findChildComponent(v,"bgLevel/txtLevel",a),(w=c.findChild(v,"imgSelf")).active=!1,m>IS(R).member_list.length-1)return e.loadIcon(b.getComponent(o),"team","yw_bg_kong"),b.active=!0,T.active=!1,p.enabled=!0,e.loadIcon(p,"main","zjm_ICON_tongban"),_.string=GetLanguage(300104),y.string=GetLanguage(300103),L.active=!1,"continue";b.active=!1,w.active=t.role_id==Number(IS(D).GetRoleId());for(var n,r=i(t.ext);!(n=r()).done;){var f=n.value,g=f.k,C=f.v;1==g&&(T.active=1==C,t.role_id==IS(D).GetRoleId()&&(e.ready=1==C))}var A=c.findChild(v,"pet");if(e.loadIcon(p,"main","zjm_ICON_tongban"),0!=t.pet_list.length)for(var G,E=i(t.pet_list);!(G=E()).done;){var B=G.value;if(1==B.pet_pos){var x=configUnitModel.getDataByKey(B.pet_id);p.enabled=!1,k=e.addUIEffect(x.path,A,-1,null,x.scale/100*1.5),e.effectList.push(k)}}else p.enabled=!0;for(var K,q=i(t.info_list.ks);!(K=q()).done;){var F=K.value,U=F.k,O=F.s;U==M.ROLE_ATTR_NAME&&(_.string=""+O)}for(var P,V=i(t.info_list.kv);!(P=V()).done;){var N=P.value,Y=N.k,j=N.v;Y==M.ROLE_ATTR_LVL&&(y.string="Lv."+j)}for(var H=t.figure,W=H.hair_figure>0&&H.hair_figure||6,z=H.equip_list.length>0&&IS(I).GetKvListByK(H.equip_list,0)||0,J=H.equip_list.length>1&&IS(I).GetKvListByK(H.equip_list,1)||0,Q=H.equip_list.length>2&&IS(I).GetKvListByK(H.equip_list,2)||0,X=H.equip_list.length>2&&IS(I).GetKvListByK(H.equip_list,4)||0,Z=c.findChild(v,"role"),$=H.skin_list||[],ee=0,te=0;te<$.length;te++)2==$[te].k&&(ee=$[te].v);var ie=1,ne=H.gender||1,ae=IS(D).GetTypeUsedSkin(0),oe=u.getModelId(ae,ee,ne),se=configUnitModel.getDataByKey(oe);se&&se.skin_scale>0&&(ie=.66*se.skin_scale);var re=e.addUnitModel({job:H.job_figure,parent:Z,dressId:ee,gender:ne,color:W,weapon:z,ornaments:J,face:Q,shenqi:0,wing:X},null,ie);h.uiMirror&&(e.getUnitModel(re).dir=-1),e.modelList.push(re);var he=H.current_title;if(he>0){var de=1.3*e.getUnitModel(re).modelHeight;L.setPosition(0,de+45),L.active=!0,new d(e,L).SetRankTitle(he,l.NORMAL)}else L.active=!1},m=0;m<3;m++){var v,p,L,b,T,_,y,w,k;C()}this.matching=1==IS(R).state,this.checkBtnState()},A.checkBtnState=function(){this.refreshChooseDiff(),this.btnReady.getComponent(s).enabled=!0,this.btnReady.getComponent(o).grayscale=!1,this.btnMatch.getComponent(s).enabled=!0,this.btnMatch.getComponent(o).grayscale=!1,IS(R).member_list.length<3?(this.btnReady.getComponent(s).enabled=!1,this.btnReady.getComponent(o).grayscale=!0):(this.btnMatch.getComponent(s).enabled=!1,this.btnMatch.getComponent(o).grayscale=!0),c.findChildComponent(this.btnReady,"txtID",a).string=this.ready?GetLanguage(200619):GetLanguage(200620),IS(D).GetRoleId()!=IS(R).leader_id&&(this.btnMatch.getComponent(s).enabled=!1,this.btnMatch.getComponent(o).grayscale=!0),this.checkSweepBtn(),this.refreshMatch()},A.refreshMatch=function(){var e=this;this.refreshChooseDiff(),this.matching?(this.btnFriend.getComponent(s).enabled=!0,this.btnFriend.getComponent(o).grayscale=!1,0!=this.MatchTimer&&this.removeTimer(this.MatchTimer),this.refreshMatchTip(),this.MatchTimer=this.addTimer(1,-1,(function(){e.refreshMatchTip()}))):(this.btnFriend.getComponent(s).enabled=!0,this.btnFriend.getComponent(o).grayscale=!1,0!=this.MatchTimer&&this.removeTimer(this.MatchTimer),this.matchTime=0,c.findChildComponent(this.btnMatch,"Label",a).string=GetLanguage_UI(100825))},A.refreshMatchTip=function(){this.matchTime+=1,c.findChildComponent(this.btnMatch,"Label",a).string=f.formatStrWithMirrorDeal(GetLanguage(300120),this.matchTime)},A.checkSweepBtn=function(){for(var e,t=IS(L).getDungeonInfoByID(b.CHAPTER_TYPE_LEGACY_TEAM),n=t.ext,a=0,s=(t.max_level,0),r=i(n);!(e=r()).done;){var h=e.value;5==h.k&&(a=h.v),9==h.k&&h.v,14==h.k&&(s=h.v)}if(a>=configLegacy_team_chapter.getDataByList("level",this.curLevel,"diff",1)[0].unlock_day+3&&s>=this.curLevel&&s>=C.mopping_unlock_lvl){this.sweepLan=null,this.btnSweep.getComponent(o).grayscale=!1;var d=IS(p).getGoodsCountByGoodsGtid(1009);this.btnAd.active=d<=0,this.btnSweep.active=d>0}else{var l=configLegacy_team_chapter.getDataByList("level",t.max_level,"diff",1)[0],c=t.max_level;a<l.unlock_day&&(c-=1),c==this.curLevel?this.sweepLan=203872:this.sweepLan=203873,this.btnSweep.getComponent(o).grayscale=!0}},A.refreshADInfo=function(){var e=configAds.getDataByKey(this.adId);e&&(this.txtAdDesc.string=r.formatStr(e.desc,IS(m).getAdRewardValue(this.adId)),this.txtAdCount.string=r.formatStr("(%s/%s)",e.times-IS(m).getAdWatchCount(this.adId),e.times))},A.onBeforeClose=function(){},A.onDestroy=function(){},n}(A));n._RF.pop()}}}));

