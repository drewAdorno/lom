System.register("chunks:///_virtual/SeasonShipBuildUpgradeView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./V2.ts","./AudioMgr.ts","./RedPoint.ts","./RedPointMgr.ts","./NodeUtil.ts","./StringUtil.ts","./BaseView.ts","./BagDefine.ts","./BagModel.ts","./RoleDefine.ts","./SeasonControl.ts","./SeasonDataCache.ts","./SeasonDefine.ts"],(function(e){"use strict";var t,n,i,o,s,a,d,r,h,l,u,f,c,g,p,v,x,C,I,m,S,L,_,B,P;return{setters:[function(e){t=e.inheritsLoose},function(e){n=e.cclegacy,i=e.math,o=e.Button,s=e.Label,a=e.UITransform,d=e.LabelOutline,r=e.sys,h=e.Sprite,l=e.js,u=e.Color},function(e){f=e.V2},function(e){c=e.audioMgr},function(e){g=e.RedPointType},function(e){p=e.RedPointMgr},function(e){v=e.default},function(e){x=e.default},function(e){C=e.BaseView},function(e){I=e.BagEventDefine},function(e){m=e.BagModel},function(e){S=e.RoleEventDefine},function(e){L=e.default},function(e){_=e.SeasonDataCache},function(e){B=e.SeasonShipEventDefind,P=e.ShipEquipBoxChangeType}],execute:function(){n._RF.push({},"3ed7eJ/x9ZLDarCkaZ+6xgT","SeasonShipBuildUpgradeView",void 0);var b=270007,y=(i.Vec3,i.Vec2);e("default",function(e){function n(){var t;return(t=e.call(this)||this).txtCoinCount=void 0,t.curLevelItem=void 0,t.nextLevelItem=void 0,t.maxLevelItem=void 0,t.nodeCurLevel=void 0,t.nodeNextLevel=void 0,t.nodeMaxLevel=void 0,t.nodeLevelEffParent=void 0,t.nodeOprate=void 0,t.nodeUpgrade=void 0,t.nodeProgressParent=void 0,t.utProgressParent=void 0,t.nodeProgressItem=void 0,t.nodeProgressEffParent=void 0,t.nodeBtnBuy=void 0,t.txtCost=void 0,t.outLineCost=void 0,t.nodeMax=void 0,t.expItems=void 0,t.name="SeasonShipBuildUpgradeView",t.url="ui/module/season/SeasonShipBuildUpgradeView",t.poolTime=3e3,t}t(n,e);var i=n.prototype;return i.onInit=function(){var e=this;this.expItems=[];var t=this.findChild("imgMask");this.addComponentCallbackListener(t,o.EventType.CLICK,(function(){e.onMaskClick()}));var n=this.findChild("content/btnClose");this.addComponentCallbackListener(n,o.EventType.CLICK,(function(){e.onCloseClick()}));var i=this.findChild("content/coinItem");this.addComponentCallbackListener(i,o.EventType.CLICK,(function(){IS(m).OpenItemTips(b,i)})),this.nodeBtnBuy=this.findChild("content/box/detail/oprate/btnBuy"),IS(p).addRedPoint("Season/Equip/equip/level/Buy",this.nodeBtnBuy,new y(85,35),g.Dot),this.addComponentCallbackListener(this.nodeBtnBuy,o.EventType.CLICK,(function(){e.onBuyClick()})),this.txtCoinCount=this.findChildComponent("content/coinItem/txtCount",s),this.nodeCurLevel=this.findChild("content/box/detail/levelInfo/curLevel"),this.nodeNextLevel=this.findChild("content/box/detail/levelInfo/nextLevel"),this.nodeMaxLevel=this.findChild("content/box/detail/levelInfo/maxLevel"),this.nodeLevelEffParent=this.findChild("content/box/detail/levelInfo/effParent"),this.curLevelItem=this.initLevelInfo(this.nodeCurLevel),this.nextLevelItem=this.initLevelInfo(this.nodeNextLevel),this.maxLevelItem=this.initLevelInfo(this.nodeMaxLevel),this.nodeUpgrade=this.findChild("content/box/detail/upgrade/progress"),this.nodeProgressParent=this.findChild("content/box/detail/upgrade/progress/progressParent"),this.utProgressParent=this.nodeProgressParent.getComponent(a),this.nodeProgressItem=this.findChild("content/box/detail/upgrade/progress/progressParent/progressItem"),this.nodeProgressItem.active=!1,this.nodeProgressEffParent=this.findChild("content/box/detail/upgrade/progress/effParent"),this.nodeOprate=this.findChild("content/box/detail/oprate"),this.txtCost=this.findChildComponent("content/box/detail/oprate/btnBuy/cost/txtCost",s),this.outLineCost=this.txtCost.node.getComponent(d),this.nodeMax=this.findChild("content/box/detail/upgrade/txtMax"),r.uiMirror&&(this.loadIcon(this.findChildComponent("content/box/detail/oprate/btnBuy/cost/imgCoin",h),"icon_item","270007"),this.loadIcon(this.findChildComponent("content/coinItem/imgItem",h),"icon_item","270007"))},i.initLevelInfo=function(e){for(var t=[],n=1;n<=8;n++)t.push(v.findChildComponent(e,l.formatStr("probabilityParent/probabilityItem%s/txtProbability",n),s));return{txtLevel:v.findChildComponent(e,"title/txtLevel",s),txtProbability:t}},i.registerUpdateHandler=function(){this.addEvent(B.SHIP_EQUIP_BOX_INFO_UPDATE,this.onBoxInfoUpdate,this),this.addEvent(S.ROLE_RES_UPDATE,this.onRoleResUpdate,this),this.addEvent(I.GOODS_INFO_UPDATE,this.onRoleResUpdate,this)},i.onAfterOpen=function(){this.refreshShow()},i.updateUpgradeRedPoint=function(){IS(p).changeValue("boxUpgradeBtnUpgradeShow",this.getBoxUpgradeRedPoint()),IS(p).changeValue("boxBuyBtnUpgradeShow",this.getBoxBuyRedPoint())},i.refreshShow=function(){this.updateCoinItemNum(),this.updateUpgradeRedPoint(),IS(p).changeValue("Season/Equip/equip/level/Buy",IS(_).checkShipEquipLevelRP());var e=configSeason_treasure_level.getDatas().length,t=IS(_).equip_box_exp,n=IS(_).equip_box_level;this.showLevelInfo(n,e),n<e?(this.showUpgradeInfo(n,t),this.nodeUpgrade.active=!0,this.nodeMax.active=!1,this.nodeOprate.active=!0):(this.nodeUpgrade.active=!1,this.nodeMax.active=!0,this.nodeOprate.active=!1)},i.updateCoinItemNum=function(){this.txtCoinCount.string=x.GetNumString(IS(m).getGoodsCountByGoodsGtid(b))},i.showLevelInfo=function(e,t){this.nodeMaxLevel.active=e>=t||!1,this.nodeCurLevel.active=e<t||!1,this.nodeNextLevel.active=e<t||!1,e>=t?this.showSingleLevelInfo(this.maxLevelItem,e,!0):(this.showSingleLevelInfo(this.curLevelItem,e,!0),this.showSingleLevelInfo(this.nextLevelItem,e+1,!1))},i.showSingleLevelInfo=function(e,t,n){var i=1==n?GetLanguage(200253):GetLanguage(200254);e.txtLevel.string=x.formatStr(r.uiMirror?"##2##1":"##1##2",i,t);for(var o,s=configSeason_treasure_level.getDataByKey(t).pro_quality||[],a={},d=0,h=0;h<s.length;h++)a[s[h][0]]=s[h][1],d+=s[h][1];for(var u=1;u<=8;u++)o=a[u]||0,e.txtProbability[u-1].string=l.formatStr("%s%",(o/d*100).toFixed(3))},i.showUpgradeInfo=function(e,t){for(var n=configSeason_treasure_level.getDataByKey(e).expend,i=this.utProgressParent.width/n.length,o=0;o<this.expItems.length;o++)this.expItems[o].node.active=!1;for(var s=0;s<n.length;s++){var d=this.expItems[s];if(null==d){var r=nodeInstantiate.instantiate(this.nodeProgressItem);r.parent=this.nodeProgressParent,d={node:r,imgBg:v.findChildComponent(r,"imgBg",h),imgFinish:v.findChildComponent(r,"imgFinish",h),ut:r.getComponent(a)}}d.ut.width=i,d.node.active=!0;var l=void 0,f=void 0;0==s?(l="zb_ui_shengjijindu00",f="zb_ui_shengjijindu02"):s<n.length-1?(l="zb_ui_shengjijindu01",f="zb_ui_shengjijindu03"):(l="zb_ui_shengjijindu04",f="zb_ui_shengjijindu05"),this.loadIcon(d.imgBg,"equip",l),this.loadIcon(d.imgFinish,"equip",f),d.imgFinish.node.active=s+1<=t||!1,this.expItems[s]=d}if(t<n.length){this.nodeBtnBuy.active=!0;var c=n[t][1],g=IS(m).getGoodsCountByGoodsGtid(n[t][0]);this.txtCost.string=x.GetNumString(c);var p=g>=c;this.txtCost.color=p?new u(255,193,74):new u(231,98,98),this.outLineCost.color=p?new u(41,65,21):new u(86,42,27),this.txtCost.fontSize=p?26:28}else this.nodeBtnBuy.active=!1},i.onBeforeClose=function(){for(var e=0;e<this.expItems.length;e++)this.expItems[e].node.active=!1},i.onDestroy=function(){for(var e=0;e<this.expItems.length;e++)this.expItems[e].node.destroy();this.expItems=[]},i.onBoxInfoUpdate=function(e){e?e==P.lvUp?(c.playSound("common_shendengshengji"),this.showLvChangeEffect()):e==P.expAdd&&this.showExpChangeEffect():this.refreshShow()},i.showLvChangeEffect=function(){var e=this;this.addUIEffect("prefab/ui-effect/MX_tx_baoxiang_saoguang",this.nodeLevelEffParent,1.5,new f(0,22),1,(function(e){r.uiMirror&&(e.dir=-1)})),this.addTimer(1.5,1,(function(){e.refreshShow()}))},i.showExpChangeEffect=function(){var e=this;this.addUIEffect("prefab/ui-effect/MX_tx_tongyong_exp",this.nodeProgressEffParent,1,new f(0,0),1,(function(e){r.uiMirror&&(e.dir=-1)})),this.addTimer(1,1,(function(){e.refreshShow()}))},i.onRoleResUpdate=function(e,t){t==b&&this.refreshShow()},i.onMaskClick=function(){IS(_).checkShipEquipLevelRP(),this.close()},i.onCloseClick=function(){IS(_).checkShipEquipLevelRP(),this.close()},i.onBuyClick=function(){var e=IS(_).equip_box_exp,t=IS(_).equip_box_level,n=configSeason_treasure_level.getDataByKey(t);if(!(e>=n.expend.length)){var i=n.expend[e];IS(m).getGoodsCountByGoodsGtid(i[0])<i[1]?uiMgr.openView("ItemGetWayView",i[0]):IS(L).reqShipEquipBoxLevelUp()}},i.getBoxBuyRedPoint=function(){var e=IS(_).equip_box_level,t=IS(_).equip_box_exp;if(e>=configSeason_treasure_level.getDatas().length)return 0;var n=configSeason_treasure_level.getDataByKey(e).expend;if(t>=n.length)return 0;var i=n[t];return IS(m).getGoodsCountByGoodsGtid(i[0])>=i[1]?1:0},i.getBoxUpgradeRedPoint=function(){var e=IS(_).equip_box_level,t=IS(_).equip_box_exp;return e>=configSeason_treasure_level.getDatas().length?0:t>=configTreasure_level.getDataByKey(e).expend.length?1:0},n}(C));n._RF.pop()}}}));

