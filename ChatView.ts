System.register("chunks:///_virtual/ChatView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIList.ts","./RedPoint.ts","./RedPointMgr.ts","./NodeUtil.ts","./PlatformUtil.ts","./BaseView.ts","./ChapterDefine.ts","./GameSetting.ts","./MessageView.ts","./LoginDefine.ts","./PlantDefine.ts","./RoleDefine.ts","./SdkControl.ts","./SlaveControl.ts","./SlaveDefine.ts","./SlaveModel.ts","./ChatDataCache.ts","./ChatDefine.ts"],(function(t){"use strict";var e,i,n,a,o,s,h,l,d,r,u,c,p,f,C,v,w,g,I,y,T,S,V,m,_,A,L,P,b,B,E,R,D,F,G;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,n=t.UITransform,a=t.Button,o=t.Sprite,s=t.sys,h=t.ScrollView,l=t.Widget,d=t.Vec2,r=t.Label},function(t){u=t.ListItem},function(t){c=t.RedPointType},function(t){p=t.RedPointMgr},function(t){f=t.default},function(t){C=t.PlatformUtil},function(t){v=t.BaseView},function(t){w=t.ChapterEventDefine},function(t){g=t.default},function(t){I=t.default},function(t){y=t.LoginEventDefine},function(t){T=t.PlantEventDefine,S=t.CropState},function(t){V=t.RoleEventDefine,m=t.PlayerAttr},function(t){_=t.default},function(t){A=t.default},function(t){L=t.SlaveEventDefine},function(t){P=t.SlaveModel},function(t){b=t.ChatDataCache},function(t){B=t.ChatEventDefine,E=t.ToggleToChannel,R=t.ChatDefine,D=t.ChannelToToggle,F=t.RedBagType,G=t.ChannelName}],execute:function(){i._RF.push({},"e2ff9dL01ZPiagiFJefJgoa","ChatView",void 0);t("default",function(t){function i(){var e;return(e=t.call(this)||this).isActive=!1,e.widge=void 0,e.containerTrans=void 0,e.contentType=void 0,e.curType=void 0,e.privateType=1,e.closeBtn=void 0,e.inputView=void 0,e.chatContentView=void 0,e.privateChatView=void 0,e.friendView=void 0,e.faceView=void 0,e.isHeightChange=void 0,e.waitingFarmInfoRoleId=void 0,e.waitingFarmInfoLandId=void 0,e.lastEndTime=void 0,e.autoPlayGo=void 0,e.autoToggle=void 0,e.auto_tiemr=void 0,e.auto_play_sec=0,e.redBagBtn=void 0,e.facePanelMask=void 0,e.trySlaveHelpInfo=void 0,e.changeWidgeList=[],e.waitCheckDoubleChapterInvateResultId=void 0,e.ChannelTab=void 0,e.name="ChatView",e.url="ui/module/Chat/ChatView",e}e(i,t);var r=i.prototype;return r.registerUpdateHandler=function(){this.addEvent(T.ROLE_HOME_FARM_INFO_BACK,this.onRoleHomeFarmInfoBack,this),this.addEvent(V.ROLE_INFO_UPDATE,this.GuildChange,this),this.addEvent(y.PLAYSOUNDBACK,this.updateVoiceStatus,this),this.addEvent(B.ShowRedBagInChat,this.showChatByRedBag,this),this.addEvent(B.UpdateAutoPlay,this.UpdateAutoPlay,this),this.addEvent(B.ChannelListUpdate,this.updateChannelStatus,this),this.addEvent(B.UpdateChatRed,this.UpdateTab,this),this.addEvent("CHANGE_SEL_CHANNEL",this.changeSelected,this),this.addEvent(L.SLAVE_INFO_BACK,this.onSlaveInfoBack,this),this.addEvent(w.DOUBLE_CHAPTER_CHECK_IN_INVATE_BACK,this.onDoubleChapterCheckInInvateBack,this)},r.onInit=function(){var t=this;(this.initSubView(),this.containerTrans=this.findChildComponent("container",n),this.containerTrans=this.findChildComponent("container",n),this.closeBtn=this.findChild("container/closeBtn"),this.addComponentCallbackListener(this.closeBtn,a.EventType.CLICK,(function(){t.close()})),this.redBagBtn=this.findChild("container/tab/redBagBtn"),this.addComponentCallbackListener(this.redBagBtn,a.EventType.CLICK,(function(){uiMgr.openView("RedBagListView")})),this.loadIcon(this.redBagBtn.getComponent(o),"red_bag","redpacket_ICON_redpacket"),s.uiMirror)&&this.findChild("container/tab/redBagBtn/Label").setScale(1,1,1);this.addComponentCallbackListener(this.closeBtn,a.EventType.CLICK,(function(){t.close()}));var e=this.findChildComponent("container/tab/scrollTab",h);this.ChannelTab=this.addUIList(e,k),this.autoPlayGo=this.findChild("container/tab/autoPlay"),this.autoToggle=this.findChild("container/tab/autoPlay"),1==GlobalDefine.IS_APP&&"mailiang2"!=GlobalDefine.PLAT_TAG&&(this.autoPlayGo.active=!1),this.addComponentCallbackListener(this.autoToggle,a.EventType.CLICK,(function(){uiMgr.openView("ChatSettingView")})),this.widge=this.findChildComponent("",l)},r.initSubView=function(){var t=this;this.chatContentView=this.addSubView("ChatContentView",this.findChild("container/content/chatContentView")),this.privateChatView=this.addSubView("ChatPrivateChatView",this.findChild("container/content/privateChatView")),this.friendView=this.addSubView("ChatFriendSubView",this.findChild("container/content/friendView")),this.inputView=this.addSubView("ChatInputSubView",this.findChild("container/input")),this.faceView=this.addSubView("ChatFaceSubView",this.findChild("container/facePanel")),this.facePanelMask=this.findChild("container/facePanelMask"),this.addComponentCallbackListener(this.facePanelMask,a.EventType.CLICK,(function(){t.faceView.setActive(!1)}))},r.changeSelected=function(t,e){var i=IS(b).ChannelIsShow(E[t]),n=i[0],a=i[1];n?this.refreshViewType(t):I.showFlyTip(a)},r.UpdateTab=function(){this.ChannelTab.updateAll()},r.refreshViewType=function(t,e,i){if(void 0===e&&(e=null),void 0===i&&(i=null),this.curType!=t){this.curType=t;var n,a=E[this.curType];if(a==R.Channel.Private)if(e)this.showPrivateChatConetnt(e);else this.showPrivateChatType(null!=(n=i)?n:1);else this.showPrivateChatType(0,a);IS(b).SetNeedUpdateVoice(!1),IS(b).SetAutoTimer(0),this.chatContentView.updateAutoList(),this.UpdateAutoPlay(),this.UpdateTab()}},r.UpdateAutoPlay=function(){var t=E[this.curType],e=IS(g).Get(10+t);e&&1==e?IS(b).SetAutoPlay(!0):IS(b).SetAutoPlay(!1)},r.StopAutoPlay=function(){IS(b).SetAutoPlay(!1),null!=this.auto_tiemr&&(this.removeTimer(this.auto_tiemr),this.auto_tiemr=null)},r.updateVoiceStatus=function(t){},r.updateChannelStatus=function(t){var e;t=null!=(e=t)?e:this.curType,IS(b).isOpenSeasonMap=t==R.ViewType.SeasonMap||t==R.ViewType.SeasonMapBattle;var i=IS(b).getChannelList();i.includes(this.curType)||this.refreshViewType(D[R.Channel.World]),this.ChannelTab.datas=i},r.AutoPlayVoice=function(){var t=this;null!=this.auto_tiemr&&(this.removeTimer(this.auto_tiemr),this.auto_tiemr=null),this.auto_play_sec=0,null==this.auto_tiemr&&(this.auto_tiemr=this.addTimer(1,-1,(function(){if(IS(b).IsInNeedUpdateVoice()&&t.chatContentView.updateAutoList(),IS(b).SetNeedUpdateVoice(!1),IS(b).IsInAutoPlay()){if(t.auto_play_sec++,!sdkControl.GetIsPlay()&&!sdkControl.GetIsRecord()){var e=t.chatContentView.GetAutoPlayList();if(e.length>0){t.auto_play_sec=0;var i,n=e.pop();IS(b).SetAutoTimer(n.info.time);var a=n.info.ext_list;if(a&&a.length>0)for(var o=0;o<a.length;o++)3==a[o].field&&(i=a[o].string),4==a[o].field&&a[o].num;e.length>0&&t.chatContentView.ScrollToChatItem(n.list_index),C.GetSoundScope((function(){IS(_).setCallbackPlayVoice(),IS(_).downloadVoice(null,i)}))}}}else t.auto_play_sec=0})))},r.showPrivateChatType=function(t,e){void 0===e&&(e=R.Channel.World),this.privateType=null!=t?t:1,this.privateChatView.setActive(1==this.privateType),this.friendView.setActive(2==this.privateType);var i=0==this.privateType?e:R.Channel.Private;this.chatContentView.setActive(0==this.privateType),0==this.privateType&&this.chatContentView.setViewType(i,null,this.isHeightChange),this.inputView.setActive(0==this.privateType);var n=this.openArgs[2];0==this.privateType&&this.setCacheInfo(n),this.inputView.setViewType(i)},r.showPrivateChatConetnt=function(t){if(t){this.chatContentView.setActive(!0),this.chatContentView.setViewType(R.Channel.Private,t,this.isHeightChange),this.inputView.setActive(!0);var e=this.openArgs[2];this.setCacheInfo(e),this.inputView.setViewType(R.Channel.Private,t),this.privateChatView.setActive(!1),this.friendView.setActive(!1)}else this.chatContentView.setActive(!1),this.showPrivateChatType(this.privateType,E[this.curType])},r.setCacheInfo=function(t){t&&2!=this.inputView.is_set_cache&&this.inputView.setCacheShareInfo(t.contentType,t.linkType,t.cacheData,t.showString)},r.showFaceView=function(t){this.faceView.setActive(t)},r.updateConetntHeight=function(t){this.contentType=t||(1==this.contentType?2:1),this.containerTrans.height=1==this.contentType?551:965,this.chatContentView.updateArrowRoate(this.contentType);for(var e=0;e<this.changeWidgeList.length;e++)this.changeWidgeList[e].updateAlignment()},r.getContentType=function(){return this.contentType},r.onAfterOpen=function(){var t=this.openArgs[0];this.updateChannelStatus(t),IS(p).changeValue("private_red",IS(b).GetPrivateRed()),this.addRedPoint("red_bag",this.redBagBtn,new d(23,25),c.Dot,1),IS(p).changeValue("red_bag",IS(b).GetRedBagRed()),this.isHeightChange=this.contentType&&1!=this.contentType,this.updateConetntHeight(2),this.curType=null;var e=this.openArgs[1],i=this.openArgs[3],n=this.openArgs[2],a=this.openArgs[4],o=this.openArgs[5];this.widge.bottom=o||3,this.chatContentView.setBlockLinkJump(a),null==t&&(t=R.ViewType.World),this.showFaceView(!1),this.refreshViewType(t,e,i);var s=[R.ViewType.SeasonMap,R.ViewType.SeasonMapBattle,R.ViewType.SeasonMapFOUR];this.redBagBtn.active=!s.includes(t),s.includes(t)&&this.updateConetntHeight(1),this.inputView.is_set_cache=0,this.setCacheInfo(n),this.isHeightChange=null,this.AutoPlayVoice()},r.onBeforeClose=function(){this.waitingFarmInfoRoleId=null,this.waitingFarmInfoLandId=null,this.lastEndTime=null,sdkControl.GetIsPlay()&&C.GetSoundScope((function(){IS(_).stopPlayVoice()})),IS(b).SetAutoPlay(!1),null!=this.auto_tiemr&&(this.removeTimer(this.auto_tiemr),this.auto_tiemr=null)},r.onDestroy=function(){},r.showChatByRedBag=function(t){t&&(configRed_packet.getDataByKey(t.red.cfg_id).type==F.Guild?this.refreshViewType(D[R.Channel.Guild]):this.refreshViewType(D[R.Channel.News]))},r.onRoleHomeFarmInfoBack=function(t){if(null!=this.waitingFarmInfoRoleId&&null!=this.waitingFarmInfoLandId&&t.role_id==this.waitingFarmInfoRoleId){var e=t.landIdToInfo[this.waitingFarmInfoLandId];if(null==e.crop)return I.showFlyTip(GetLanguage(200190)),this.waitingFarmInfoRoleId=null,this.waitingFarmInfoLandId=null,void(this.lastEndTime=null);if(e.crop.state!=S.STEALING)return I.showFlyTip(GetLanguage(200190)),this.waitingFarmInfoRoleId=null,this.waitingFarmInfoLandId=null,void(this.lastEndTime=null);if(e.crop.end_time!=this.lastEndTime)return I.showFlyTip(GetLanguage(200190)),this.waitingFarmInfoRoleId=null,this.waitingFarmInfoLandId=null,void(this.lastEndTime=null);uiMgr.openView("FarmHelpShareDetailView",this.waitingFarmInfoLandId,t),this.waitingFarmInfoRoleId=null,this.waitingFarmInfoLandId=null,this.lastEndTime=null}},r.GuildChange=function(t){1==t[m.ROLE_ATTR_GUILD_ID]&&(IS(b).ChannelIsShow(R.Channel.Guild)||E[this.curType]!=R.Channel.Guild||this.refreshViewType(E[R.Channel.World]))},r.onSlaveInfoBack=function(t,e){if(null!=this.trySlaveHelpInfo){var i=this.trySlaveHelpInfo.slaveId;if(t==i){var n=this.trySlaveHelpInfo.targetId,a=this.trySlaveHelpInfo.endTime;if(this.trySlaveHelpInfo=null,(e.master_info?e.master_info.role_id:0)==n)IS(P).getExtValue(e.role_info,2)==a?IS(A).reqCaptureSlaveCombat(2,i):I.showFlyTip(GetLanguage(201789));else I.showFlyTip(GetLanguage(201789))}}},r.onDoubleChapterCheckInInvateBack=function(t){if(null!=this.waitCheckDoubleChapterInvateResultId&&this.waitCheckDoubleChapterInvateResultId==t.check_id){if(0==t.code)return this.waitCheckDoubleChapterInvateResultId=null,void I.showFlyTip(GetLanguage(204927));uiMgr.openView("DoubleChapterInvateDealView",t.inviter_info),this.waitCheckDoubleChapterInvateResultId=null}},i}(v));var k=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),a=0;a<i;a++)n[a]=arguments[a];return(e=t.call.apply(t,[this].concat(n))||this).itemGo=void 0,e.normalSelect=void 0,e.select=void 0,e.red=void 0,e.txt1=void 0,e.txt2=void 0,e.mention=void 0,e.btnID=void 0,e}e(i,t);var n=i.prototype;return n.onInit=function(){var t=this;this.itemGo=f.findChild(this.node,""),this.red=f.findChild(this.node,"red"),this.mention=f.findChild(this.node,"mention"),this.view.addComponentCallbackListener(this.itemGo,a.EventType.CLICK,(function(){normalEvent.emit("CHANGE_SEL_CHANNEL",t.btnID,t.index)})),this.normalSelect=f.findChild(this.node,"normal"),this.select=f.findChild(this.node,"selected"),this.txt1=f.findChildComponent(this.node,"normal/label",r),this.txt2=f.findChildComponent(this.node,"selected/label",r)},n.onRender=function(t,e){this.btnID=t;var i=this.view;this.normalSelect.active=i.curType!=this.btnID,this.select.active=i.curType==this.btnID;var n=E[this.btnID];this.mention.active=IS(b).GetMentionRed(n)>0,n==R.Channel.Private?this.red.active=IS(b).GetPrivateRed()>0:this.red.active=!1;var a=G[n];this.txt1.string=GetLanguage(a),this.txt2.string=GetLanguage(a)},i}(u);i._RF.pop()}}}));

