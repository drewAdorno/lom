System.register("chunks:///_virtual/PlayerServerView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIList.ts","./NodeUtil.ts","./PlatformUtil.ts","./StorageUtil.ts","./TimeUtil.ts","./index57.ts","./ObjectUtil.ts","./MessageView.ts","./LoginControl.ts","./LoginDataCache.ts","./RoleDataCache.ts","./ConfigGlobal.ts","./BaseView.ts"],(function(t){"use strict";var e,i,s,r,o,n,l,a,h,d,c,v,u,f,L,g,m,p,C,S,I,y,R;return{setters:[function(t){e=t.inheritsLoose,i=t.createForOfIteratorHelperLoose},function(t){s=t.cclegacy,r=t.Button,o=t.ScrollView,n=t.Label,l=t.UITransform,a=t.sys,h=t.Widget,d=t.js},function(t){c=t.SelectedType,v=t.ListItem},function(t){u=t.default},function(t){f=t.PlatformUtil},function(t){L=t.default},function(t){g=t.default},null,function(t){m=t.default},function(t){p=t.default},function(t){C=t.default},function(t){S=t.LoginDataCache},function(t){I=t.RoleDataCache},function(t){y=t.ConfigGlobal},function(t){R=t.BaseView}],execute:function(){var w;s._RF.push({},"413598nCSZFAKECZMNCD1mU","PlayerServerView",void 0);var _=((w={})[1]="mix_us",w[2]="mix_us2",w),x=(t("default",function(t){function s(){var e;return(e=t.call(this)||this).curId=0,e.curTab=0,e.curPlat=1,e.tabList=void 0,e.roleScroll=void 0,e.serverList=void 0,e.roleList=void 0,e.platBtns=[],e.name="PlayerServerView",e.url="ui/module/player/PlayerServerView",e}e(s,t);var n=s.prototype;return n.onInit=function(){var t=this,e=this.findChild("imgMask");this.addComponentCallbackListener(e,r.EventType.CLICK,(function(){t.onCloseClick()}));var i=this.findChildComponent("scrollTab",o);this.tabList=this.addUIList(i,x),this.tabList.selectedMode=c.SINGLE;var s=this.findChildComponent("container/scroll",o);this.roleScroll=this.addUIList(s,N);for(var n=function(e){var i=u.findChild(t.node,d.formatStr("container/tab/tab%s",e)),s={itemGo:i,normalGo:u.findChild(i,"normal"),selectedGo:u.findChild(i,"selected"),index:e};t.addComponentCallbackListener(i,r.EventType.CLICK,(function(){t.setPlat(s.index)})),t.platBtns[e]=s},l=1;l<=2;l++)n(l)},n.onCloseClick=function(){this.close()},n.registerUpdateHandler=function(){},n.onAfterOpen=function(){var t=this;for(var e in this.curTab=0,this.curId=0,this.curPlat=1,this.platBtns)if(this.platBtns.hasOwnProperty(e)){var i=this.platBtns[e];i.normalGo.active=this.curPlat!=i.index,i.selectedGo.active=this.curPlat==i.index}var s=IS(S);this.serverList=s.serverList,null==s.serverList||0==s.serverList.length?IS(C).requestServerList((function(e){e&&(t.serverList=s.serverList,IS(C).use2LoginServer()?(console.error("使用双登录服，请求第二个登录服"),IS(C).requestServer2ListUrl((function(e){e&&IS(C).requestServerList2((function(e){e&&(t.serverList=t.serverList.concat(s.serverList2),t.RequestRoleList())}))}))):t.RequestRoleList())})):(console.error("服务器列表不为空"),console.error(JSON.stringify(this.serverList)),console.error(JSON.stringify(s.serverList2)),IS(C).use2LoginServer()?null==s.serverList2||0==s.serverList2.length?IS(C).requestServer2ListUrl((function(e){e&&IS(C).requestServerList2((function(e){e&&(t.serverList=t.serverList.concat(s.serverList2),t.RequestRoleList())}))})):(this.serverList=this.serverList.concat(s.serverList2),this.RequestRoleList()):this.RequestRoleList())},n.RequestRoleList2=function(){var t=this,e=IS(S),i=IS(S).roleList2;null==i||0==i.length?loginControl.RequestRoleList2(e.plat,e.uid,(function(e,i){e&&(t.roleList=t.roleList.concat(IS(S).roleList2),t.updateRoleList())})):(this.roleList=this.roleList.concat(i),this.updateRoleList())},n.RequestRoleList=function(){var t=this,e=IS(S);this.roleList=IS(S).roleList,null==this.roleList||0==this.roleList.length?loginControl.RequestRoleList(e.plat,e.uid,(function(e,i){e&&(t.roleList=IS(S).roleList,loginControl.use2LoginServer()?t.RequestRoleList2():t.updateRoleList())})):(console.error("角色列表不为空"),loginControl.use2LoginServer()?null!=IS(S).roleList2&&IS(S).roleList2.length>0?(this.roleList=this.roleList.concat(IS(S).roleList2),this.updateRoleList()):this.RequestRoleList2():this.updateRoleList())},n.updateRoleList=function(){var t=[];(t=1==this.curPlat?m.copyArray(y.server_us_type):m.copyArray(y.server_us2_type)).unshift(0),this.tabList.datas=t,this.setTab(0)},n.onBeforeClose=function(){},n.onDestroy=function(){},n.setId=function(t){this.curId=t;var e=configSever_list.getDataByKey(t),i=this.getRoleList(e);this.roleScroll.datas=i},n.setTab=function(t){if(this.curTab=t,this.tabList.updateAll(),0==t){this.curId=0;var e=this.getRoleList();this.roleScroll.datas=e}},n.setPlat=function(t){for(var e in this.curPlat=t,this.platBtns)if(this.platBtns.hasOwnProperty(e)){var i=this.platBtns[e];i.normalGo.active=this.curPlat!=i.index,i.selectedGo.active=this.curPlat==i.index}this.setId(this.curId),this.updateRoleList()},n.getRoleList=function(t,e){var s=[];if(null==t){var r=configSever_list.getDatas();if(null!=this.roleList)for(var o,n=i(this.roleList);!(o=n()).done;)for(var l,a=o.value,h=i(r);!(l=h()).done;){var d=l.value;(e||d.plat==_[this.curPlat])&&a.server_id>=d.sever_id[0]&&a.server_id<=d.sever_id[1]&&s.push(a)}s.sort((function(t,e){return e.last_login_time-t.last_login_time}))}else{for(var c in this.serverList)if(this.serverList.hasOwnProperty(c)){var v=this.serverList[c],u=Number(v.id);(e||t.plat==_[this.curPlat])&&u>=t.sever_id[0]&&u<=t.sever_id[1]&&s.push(v)}s.sort((function(t,e){return e.id-t.id}))}return s},s}(R)),function(t){function s(){for(var e,i=arguments.length,s=new Array(i),r=0;r<i;r++)s[r]=arguments[r];return(e=t.call.apply(t,[this].concat(s))||this).normalGo=void 0,e.selectedGo=void 0,e.arrNormal=void 0,e.arrSelected=void 0,e.txtNormal=void 0,e.txtSelected=void 0,e.scroll=void 0,e.scrollUt=void 0,e}e(s,t);var r=s.prototype;return r.onInit=function(){this.adaptiveSize=!0,this.normalGo=u.findChild(this.node,"normal"),this.selectedGo=u.findChild(this.node,"selected"),this.txtNormal=u.findChildComponent(this.node,"normal/txtName",n),this.txtSelected=u.findChildComponent(this.node,"selected/txtName",n),this.arrNormal=u.findChild(this.node,"normal/arr"),this.arrSelected=u.findChild(this.node,"selected/arr"),this.scrollUt=u.findChildComponent(this.node,"list",l);var t=u.findChildComponent(this.node,"list",o);this.scroll=this.view.addUIList(t,G),this.scroll.selectedMode=c.SINGLE},r.onRender=function(t,e){this.index=e,0==e?(this.txtNormal.string=GetLanguage(200542),this.txtSelected.string=GetLanguage(200542),this.txtNormal.node.setPosition(0,0),this.txtSelected.node.setPosition(0,0),this.arrNormal.active=!1,this.arrSelected.active=!1):(this.txtNormal.string=t[1],this.txtSelected.string=t[1],this.txtNormal.node.setPosition(-15,0),this.txtSelected.node.setPosition(-15,0),this.arrNormal.active=!0,this.arrSelected.active=!0),this.SetSelected()},r.onItemClick=function(){this.view.curTab!=this.index&&this.view.setTab(this.index)},r.SetSelected=function(){var t=this.view.curTab==this.index;if(this.normalGo.active=!t,this.selectedGo.active=t,0!=this.index&&t){this.scroll.node.active=!0;for(var e,s=[],r=configSever_list.getDatas(),o=i(r);!(e=o()).done;){var n=e.value;n.type==this.data[0]&&s.push(n)}s.sort((function(t,e){return e.id-t.id}));for(var l=[],a=0,h=s;a<h.length;a++){var d=h[a];(!isNaN(d)||this.view.getRoleList(d,!0).length>0)&&l.push(d)}if(0!=l.length){var c=5+55*l.length+8*(l.length-1);this.scrollUt.height=c,this.ut.height=72+c,this.scroll.datas=l}else this.scroll.node.active=!1,this.ut.height=72}else this.scroll.node.active=!1,this.ut.height=72},s}(v)),G=function(t){function i(){for(var e,i=arguments.length,s=new Array(i),r=0;r<i;r++)s[r]=arguments[r];return(e=t.call.apply(t,[this].concat(s))||this).txtName=void 0,e}e(i,t);var s=i.prototype;return s.onInit=function(){this.txtName=u.findChildComponent(this.node,"txtName",n)},s.onRender=function(t,e){this.txtName.string=t.name},s.onItemClick=function(){this.view.curId!=this.data.id&&this.view.setId(this.data.id)},s.SetSelected=function(){},i}(v),N=function(t){function i(){for(var e,i=arguments.length,s=new Array(i),r=0;r<i;r++)s[r]=arguments[r];return(e=t.call.apply(t,[this].concat(s))||this).serverName=void 0,e.recentTime=void 0,e.lev=void 0,e.hot=void 0,e.isCur=void 0,e.serverId=void 0,e.roleId=void 0,e.maintain=void 0,e.isHot=void 0,e}e(i,t);var s=i.prototype;return s.onInit=function(){var t=this;if(this.serverName=u.findChildComponent(this.node,"serverName",n),this.recentTime=u.findChildComponent(this.node,"recentTime",n),this.lev=u.findChildComponent(this.node,"Label/lev",n),a.uiMirror){var e=u.findChildComponent(this.node,"Label/lev",h);e.alignFlags=8,e.left=-122.837,this.lev.node.setScale(1,1,1)}this.hot=u.findChild(this.node,"hot"),this.maintain=u.findChild(this.node,"maintain"),this.isCur=u.findChild(this.node,"isCur");var i=u.findChild(this.node,"");this.view.addComponentCallbackListener(i,r.EventType.CLICK,(function(){t.onItemClick()}))},s.onRender=function(t,e){if(0==this.view.curTab){for(var i in this.serverName.string=t.serv_name,this.serverId=t.server_id,this.roleId=t.role_id,this.lev.string=t.level,this.isCur.active=t.role_id==IS(I).GetRoleId(),this.recentTime.string=d.formatStr(g.getDateDiff(t.last_login_time)),this.isHot=!1,this.view.serverList)if(this.view.serverList.hasOwnProperty(i)){var s=this.view.serverList[i];if(s.id==t.server_id){this.hot.active=2==s.state,this.maintain.active=4==s.state;break}}}else{var r;for(var o in this.serverName.string=t.name,this.hot.active=2==t.state,this.maintain.active=4==t.state,this.view.roleList)if(this.view.roleList.hasOwnProperty(o)){var n=this.view.roleList[o];if(n.server_id==t.id){r=n;break}}if(this.serverId=t.id,null==r)this.isHot=2==t.state,this.lev.string=GetLanguage(200543),this.recentTime.string="",this.isCur.active=!1,this.roleId="0";else{this.isHot=!1,this.lev.string=r.level,this.isCur.active=r.role_id==IS(I).GetRoleId(),this.roleId=r.role_id;var l=Math.ceil(g.serverTime-r.last_login_time),a="";l<3600?(a=GetLanguage(200544),l=Math.ceil(l/60)):l<86400?(a=GetLanguage(200545),l=Math.ceil(l/3600)):l<604800?(a=GetLanguage(200546),l=Math.ceil(l/86400)):(a=GetLanguage(200546),l=7),this.recentTime.string=d.formatStr(a,l)}}},s.onItemClick=function(){var t=this;1!=IS(S).isWhiteIp&&this.maintain.active?p.showFlyTip(GetLanguage(200421)):this.isHot?p.showFlyTip(GetLanguage(200547)):p.showBoxTip({tip:GetLanguage(200548),func:function(e){"type_yes"==e&&(L.set("chooseServerId",String(t.serverId)),L.set("chooseRoleId",t.roleId),console.error("choose plat "+_[t.view.curPlat]),L.set("choosePlatName",_[t.view.curPlat]),f.restartGame())},ensure:GetLanguage(200129)})},i}(v);s._RF.pop()}}}));

