System.register("chunks:///_virtual/WingTalentView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./RedPoint.ts","./RedPointMgr.ts","./NodeUtil.ts","./index57.ts","./ConfigGlobal.ts","./BagModel.ts","./MessageView.ts","./RoleDataCache.ts","./WingControl.ts","./WingDataCache.ts","./WingDefine.ts","./BaseSubView.ts"],(function(t){"use strict";var i,e,n,o,a,s,l,d,h,c,r,u,f,C,v,p,b,m,T,g;return{setters:[function(t){i=t.inheritsLoose},function(t){e=t.cclegacy,n=t.Sprite,o=t.Button,a=t.Label,s=t.Vec2,l=t.UITransform,d=t.Color},function(t){h=t.RedPointType},function(t){c=t.RedPointNode},function(t){r=t.default},null,function(t){u=t.ConfigGlobal},function(t){f=t.BagModel},function(t){C=t.default},function(t){v=t.RoleDataCache},function(t){p=t.default},function(t){b=t.WingDataCache},function(t){m=t.WingEvent,T=t.WingColorIcon},function(t){g=t.BaseSubView}],execute:function(){e._RF.push({},"e6eb17Eh+1LpJBUsMlu9GpL","WingTalentView",void 0);t("default",function(t){function e(){var i;return(i=t.call(this)||this).tabList={},i.talentList={},i.num=void 0,i.selectedType=void 0,i.nodePlanDown=void 0,i.nodePlanUp=void 0,i.nodeSelectPlan=void 0,i.nodeSelectPlanMask=void 0,i.planItemList=[],i.btnCurPlan=void 0,i.txtCurPlan=void 0,i.isSelect=!1,i.btnChange=void 0,i.curTab=void 0,i.name="WingTalentView",i.url="ui/module/wing/WingTalentView",i.poolTime=3e3,i}i(e,t);var l=e.prototype;return l.onInit=function(){for(var t=this,i=function(i){var e={item:t.findChild("root/tabContain/item"+i),selected:t.findChild("root/tabContain/item"+i+"/selected"),redPoint:null};t.addComponentCallbackListener(t.findChild("root/tabContain/item"+i),o.EventType.CLICK,(function(){t.selectType(i)})),e.redPoint=new c,e.redPoint.addRedPoint(e.item,new s(64,17),h.Dot),t.tabList[i]=e},e=1;e<=3;e++)i(e);this.loadIcon(this.findChildComponent("root/tabContain/item1/icon",n),"back","bs_icon_gongji1"),this.loadIcon(this.findChildComponent("root/tabContain/item1/selected/icon",n),"back","bs_icon_gongji2"),this.loadIcon(this.findChildComponent("root/tabContain/item2/icon",n),"back","bs_icon_gongjian1"),this.loadIcon(this.findChildComponent("root/tabContain/item2/selected/icon",n),"back","bs_icon_gongjian2"),this.loadIcon(this.findChildComponent("root/tabContain/item3/icon",n),"back","bs_icon_fashu1"),this.loadIcon(this.findChildComponent("root/tabContain/item3/selected/icon",n),"back","bs_icon_fashu2");for(var l=1;l<=30;l++)this.talentList[l]=new I(this,this.findChild("root/ScrollView/view/content/SkillItem/"+l),this.findChild("root/ScrollView/view/content/lineItem/"+l));this.addComponentCallbackListener(this.findChild("root/resetBtn"),o.EventType.CLICK,(function(){C.showBoxTip({tip:GetLanguage(201811),title:GetLanguage(200048),func:function(i){"type_yes"==i&&IS(p).send_wing_talent_reset_c2s(t.selectedType,t.curTab)}})})),this.num=this.findChildComponent("root/nodeItem/Label",a);var d=this.findChild("root/nodeItem");this.addComponentCallbackListener(d,o.EventType.CLICK,(function(){IS(f).OpenItemTips(1085,d)}));var r=this.findChildComponent("root/nodeItem/Sprite",n);this.loadIcon(r,"back","bs_icon_yumao2"),this.nodeSelectPlanMask=this.findChild("root/maskSelectPlan"),this.addComponentCallbackListener(this.nodeSelectPlanMask,o.EventType.CLICK,(function(){t.setSelectPlanActive(!1)})),this.nodePlanDown=this.findChild("root/btnCurPlan/imgDown"),this.nodePlanUp=this.findChild("root/btnCurPlan/imgUp"),this.nodeSelectPlan=this.findChild("root/planSelect"),this.txtCurPlan=this.findChildComponent("root/btnCurPlan/txtPlan",a),this.btnCurPlan=this.findChild("root/btnCurPlan"),this.addComponentCallbackListener(this.btnCurPlan,o.EventType.CLICK,(function(){t.setSelectPlanActive(!t.isSelect)})),this.btnChange=this.findChild("root/changeBtn"),this.addComponentCallbackListener(this.btnChange,o.EventType.CLICK,(function(){IS(p).send_wing_talent_choose_tab_c2s(t.curTab)}));for(var u=0;u<4;u++)this.planItemList[u]=new L(this.findChild("root/planSelect/selectItem"+(u+1)),this,u+1);var v=this.findChild("root/btnRename");this.addComponentCallbackListener(v,o.EventType.CLICK,(function(){uiMgr.openView("WingTalentPlanRenameView",t.curTab)}))},l.onAfterOpen=function(){this.selectedType=null;var t=IS(v).GetJob(),i=configJobs.getDataByKey(t);this.curTab=null,this.setSelectPlanActive(!1),this.refreshShow(IS(b).curTalentTab,{1:1,2:1,5:1,3:2,6:2,4:3,7:3}[i.type]),this.UpdateTabRed()},l.registerUpdateHandler=function(){this.addEvent(m.TYPE_WING_TALENT_CHANGE,this.updateTalenet),this.addEvent(m.TYPE_WING_TALENT_RED_CHANGE,this.UpdateTabRed),this.addEvent(m.TYPE_WING_TALENT_TAB_NAME_CHANGE,this.UpdateName)},l.selectType=function(t,i){if(t!=this.selectedType||i){for(var e in this.selectedType=t,this.tabList)this.tabList[e].selected.active=this.selectedType==Number(e);this.updateTalenet()}},l.UpdateTabRed=function(){for(var t in this.tabList)this.tabList[t].redPoint.notifyNum=IS(b).GetTalenTypeRed(Number(t),this.curTab)},l.updateTalenet=function(){var t=configBack_talent.getDataListByMainKey("id");for(var i in t){var e=t[i][0],n=e.id-1e3*Math.floor(e.id/1e3);e.job_type==this.selectedType&&this.talentList[n]&&this.talentList[n].onRender({color_type:e.color_type,connect_id:e.connect_id,id:e.id,icon:e.icon,maxLevel:t[i].length})}var o=IS(b).GetTalentTabItemCount(this.curTab);this.num.string=o.toString(),this.btnChange.active=IS(b).curTalentTab!=this.curTab},l.setSelectPlanActive=function(t){this.nodePlanDown.active=!t,this.nodePlanUp.active=t,this.nodeSelectPlan.active=t,this.nodeSelectPlanMask.active=t,this.isSelect=t,t&&this.refreshPlanList()},l.refreshPlanList=function(){for(var t=0,i=0;i<u.statue_tab_limit.length;i++)if(i!=this.curTab-1){if(!this.planItemList[t])continue;this.planItemList[t].txtName.string=IS(b).GetPlanName(i+1),this.planItemList[t].planId=i+1,t++}},l.refreshShow=function(t,i){this.curTab!=t&&(this.curTab=t,this.btnChange.active=IS(b).curTalentTab!=this.curTab,this.UpdateName(),IS(b).UpdateTalentRed(this.curTab),this.selectType(null!=i?i:this.selectedType,!0))},l.UpdateName=function(){this.txtCurPlan.string=IS(b).GetPlanName(this.curTab)},l.onBeforeClose=function(){},l.onDestroy=function(){},e}(g));var I=function(){function t(t,i,e){this.lineItem=void 0,this.talentItem=void 0,this.view=void 0,this.colorBg=void 0,this.icon=void 0,this.level=void 0,this.redPoint=void 0,this.lineList=[],this.data=void 0,this.view=t,this.talentItem=i,this.lineItem=e,this.onInit()}var i=t.prototype;return i.onInit=function(){var t=this;this.redPoint=new c;var i=r.findChildComponent(this.talentItem,"",l).contentSize;if(this.redPoint.addRedPoint(this.talentItem,new s(.28*i.width,.28*i.height),h.Dot),this.view.addComponentCallbackListener(this.talentItem,o.EventType.CLICK,(function(){uiMgr.openView("WingTalentUpgradeView",t.data.id,t.view.curTab)})),this.colorBg=r.findChildComponent(this.talentItem,"colorBg",n),this.icon=r.findChildComponent(this.talentItem,"icon",n),this.level=r.findChildComponent(this.talentItem,"Label",a),this.lineItem)for(var e=0;e<this.lineItem.children.length;e++){var d=this.lineItem.children[e];this.lineList.push({id:Number(d.name),highlight:r.findChild(d,"icon")})}},i.onRender=function(t){this.data=t,this.view.loadIcon(this.icon,"back",t.icon),this.view.loadIcon(this.colorBg,"back",T[t.color_type]),this.UpdateTalent()},i.UpdateTalent=function(){var t=IS(b).GetTalentInfo(this.data.id,this.view.curTab);this.redPoint.notifyNum=IS(b).GetTalenRedById(this.data.id,this.view.curTab);var i=IS(b).GetTalentIsActive(this.data.id,this.view.curTab);this.level.string=i?t+"/"+this.data.maxLevel:"",this.colorBg.node.active=i,this.icon.color=new d(255,255,255,i?255:128);for(var e={},n=configBack_talent.getDataListByMainKey("id"),o=0;o<this.data.connect_id.length;o++)for(var a=this.data.connect_id[o],s=1;s<=2;s++){var l=n[a][0];if(l["condition_"+s].length>0)for(var h=0;h<l["condition_"+s].length;h++){var c=l["condition_"+s][h][0];if(c==this.data.id){var r=l["condition_"+s][h][1];IS(b).GetTalentInfo(c,this.view.curTab)>=r&&(e[a-1e3*Math.floor(a/1e3)]=!0)}}}for(var u=0;u<this.lineList.length;u++){var f=this.lineList[u].id;this.lineList[u].highlight.active=e[f]}},t}(),L=function(t,i,e){var n=this;this.node=void 0,this.view=void 0,this.txtName=void 0,this.planId=void 0,this.node=t,this.view=i,this.txtName=r.findChildComponent(this.node,"txtPlan",a),this.planId=e,this.view.addComponentCallbackListener(this.node,o.EventType.CLICK,(function(){var t=n.view;t.refreshShow(n.planId),t.setSelectPlanActive(!1)}))};e._RF.pop()}}}));

