System.register("chunks:///_virtual/ActivityHalloweenDataCache.ts",["./rollupPluginModLoBabelHelpers.js","cc","./RedPointMgr.ts","./StorageUtil.ts","./StringUtil.ts","./TimeUtil.ts","./BagDefine.ts","./BagModel.ts","./BattlePassControl.ts","./MessageView.ts","./RoleDataCache.ts","./ActivityControl.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./HorseCarnivalDataCache.ts"],(function(t){"use strict";var e,n,i,o,a,r,u,f,l,c,s,d,p,v,h,I,y,g;return{setters:[function(t){e=t.createForOfIteratorHelperLoose},function(t){n=t.cclegacy,i=t.js},function(t){o=t.RedPointMgr},function(t){a=t.default},function(t){r=t.default},function(t){u=t.default},function(t){f=t.BagEventDefine},function(t){l=t.BagModel},function(t){c=t.default},function(t){s=t.default},function(t){d=t.RoleDataCache},function(t){p=t.default},function(t){v=t.default},function(t){h=t.ActivityEventDefine,I=t.ActivityType,y=t.ActivityState},function(t){g=t.HorseCarnivalDataCache}],execute:function(){n._RF.push({},"730faj2PkBD4oU4EuiZn/VW","ActivityHalloweenDataCache",void 0);t("default",function(){var t=n.prototype;function n(){this.buyInfo={act_day:0,end_time:0,bundle_list:{}},this.ggBondChaperIdList=[],this.pvpInfo={chapter:0,can_candy:0,def_data:null,choose_buff:[],buff_list:[]},this.chatGroupInfo={},this.isReqChatGroupInfo=!1,this.pvpResult=void 0,normalEvent.on(h.OnActivityListUpdate,this.checkPop,this),normalEvent.on(h.OnActivityInfoUpdate,this.checkPop,this),normalEvent.on(f.GOODS_INFO_UPDATE,this.onBagUpdate,this)}return t.clear=function(){},t.updateBuyList=function(t){this.buyInfo.act_day=t.act_day,this.buyInfo.end_time=t.end_time,this.buyInfo.bundle_list={};for(var n,i=e(t.bundle_list);!(n=i()).done;){var o=n.value;this.buyInfo.bundle_list[o.cfg_id]=o}normalEvent.emit(h.OnHalloweenBuyInfo)},t.updateBuyInfo=function(t){this.buyInfo.bundle_list[t.cfg_id]=t,normalEvent.emit(h.OnHalloweenBuyInfo)},t.updatePvpInfo=function(t){this.pvpInfo.chapter=t.chapter,this.pvpInfo.can_candy=t.can_candy,this.pvpInfo.def_data=t.def_data,this.pvpInfo.choose_buff=t.choose_buff,this.pvpInfo.buff_list=t.buff_list,normalEvent.emit(h.OnHalloweenPvpInfo),IS(v).UpdateMainRedByActType(I.HalloweenPvp)},t.updateResult=function(t){var e;IS(n).pvpResult={chapter:t.chapter,result:t.result,reward:t.reward},this.pvpInfo.choose_buff=null!=(e=t.choose_buff)?e:[]},t.updatePvpCandy=function(t){this.pvpInfo.can_candy=t.can_candy,normalEvent.emit(h.OnHalloweenPvpCandy,t),IS(v).UpdateMainRedByActType(I.HalloweenPvp)},t.updatePvpBuff=function(t){this.pvpInfo.buff_list=t.buff_list},t.checkPop=function(){var t=IS(v).GetActivityInfo(I.Halloween);if(t&&t.state==y.Open){var e,n=new Date(1e3*u.serverTime),o=i.formatStr("#%s#%s#%s",n.getFullYear(),n.getMonth()+1,n.getDate()),r="ActivityHalloweenPopView"+IS(d).GetRoleId();if((null!=(e=a.get(r))?e:"")==o)return;uiMgr.ViewIsAddPop("ActivityHalloweenPopView")||(uiMgr.addPopView("ActivityHalloweenPopView"),a.set(r,o))}},t.onBagUpdate=function(t,e){1060==e&&(IS(v).UpdateMainRedByActType(I.HalloweenPass),IS(o).changeValue("halloween_pass",this.getPassRedNum()))},t.getBuyInfo=function(){return this.buyInfo},t.getPvpInfo=function(){return this.pvpInfo},t.getPvpRed=function(){var t=IS(v).GetActivityInfo(I.HalloweenPvp);return t&&t.state==y.Open?this.pvpInfo.def_data&&this.pvpInfo.can_candy:0},t.GetGiftRed=function(){var t,e=IS(v).GetActivityInfo(I.HalloweenGift);if(!e||e.state!=y.Open)return 0;var n=String(e.id)+"#"+String(e.round),i="ActivityHalloweenGiftRed"+IS(d).GetRoleId();return(null!=(t=a.get(i))?t:"")==n?0:1},t.getPassRedNum=function(){var t=IS(v).GetActivityInfo(I.HalloweenPass);if(!t||t.state!=y.Open)return 0;var e=0,n=t.roundCfg.group_id;return e=(e=e+c.checkRewardRP(n)>=0?1:0)+c.checkAddRewardRP(n)>0?1:0,e+=c.checkSpecialRewardRP(n),IS(l).getGoodsCountByGoodsGtid(1060)>0&&e++,e},t.GetStoreRed=function(){var t=IS(v).GetActivityInfo(I.Halloween);if(!t||t.state!=y.Open)return 0;if(t){var e,n=String(t.id)+"#"+String(t.round),i="ActivityHalloweenStoreRed"+IS(d).GetRoleId();return(null!=(e=a.get(i))?e:"")==n?0:1}return 0},t.GetTurnRed=function(){var t=IS(v).GetActivityInfo(I.HalloweenTurn);if(!t||t.state!=y.Open)return 0;var e=0;return e+=IS(g).getRedNum(I.HalloweenTurn),e+=this.GetTurnSelectRed()},t.GetTurnSelectRed=function(){var t=IS(v).GetActivityInfo(I.HalloweenTurn);if(t){var e,n=String(t.id)+"#"+String(t.round),i="ActivityHalloweenSelectRed"+IS(d).GetRoleId();return(null!=(e=a.get(i))?e:"")==n?0:IS(g).canSelectReward(I.HalloweenTurn)?1:0}return 0},t.checkChapterUnlock=function(t){for(var e=0;e<this.ggBondChaperIdList.length;e++)if(this.ggBondChaperIdList[e]==t)return!0;return!1},t.UpdateGroupChatInfo=function(t,e){if(void 0===e&&(e=0),0==e){for(var n=0;n<t.id_num_list.length;n++){var i=t.id_num_list[n];this.chatGroupInfo[i.k]=i.v}normalEvent.emit(h.OnHalloweenGroupChatInfo)}else{if(1==t.type)if(0==t.code){var o=configHalloween_group_buy.getDataByKey(t.cfg_id);if(o){var a=configGoods.getDataByKey(o.expend[0]);s.showBoxTip({tip:r.formatStrWithMirrorDeal(GetLanguage(201187),o.expend[1],a.name),title:GetLanguage(200048),func:function(e){"type_yes"==e&&IS(p).send_24_77(2,t.group_buy_id)}})}}else s.showFlyTip(configErrorInfo.getDataByKey(t.code).info);var u=this.chatGroupInfo[t.group_buy_id];this.chatGroupInfo[t.group_buy_id]=t.num,u!=t.num&&normalEvent.emit(h.OnHalloweenGroupChatInfo)}},t.GetGroupChatInfo=function(t){return this.chatGroupInfo[t]},n}());n._RF.pop()}}}));

