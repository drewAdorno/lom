System.register("chunks:///_virtual/MarryFavorView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./index57.ts","./ItemIcon.ts","./ConfigGlobal.ts","./BagModel.ts","./MessageView.ts","./FriendControl.ts","./RoleDataCache.ts","./MarryControl.ts","./MarryDefine.ts","./MarryDialogDataCache.ts","./BaseView.ts"],(function(i){"use strict";var e,t,n,o,r,s,a,d,l,h,f,v,c,u,_,g,C,m,I,p,w,F,y;return{setters:[function(i){e=i.inheritsLoose},function(i){t=i.cclegacy,n=i.Button,o=i.ScrollView,r=i.Label,s=i.Sprite,a=i.sys,d=i.HorizontalTextAlignment,l=i.LabelOutline,h=i.Color},function(i){f=i.ListItem},function(i){v=i.default},function(i){c=i.default},null,function(i){u=i.IconAseetType},function(i){_=i.ConfigGlobal},function(i){g=i.BagModel},function(i){C=i.default},function(i){m=i.default},function(i){I=i.RoleDataCache},function(i){p=i.default},function(i){w=i.MarryEventDefine},function(i){F=i.default},function(i){y=i.BaseView}],execute:function(){t._RF.push({},"d2d21sn6qxNV4rkmJiLOsYZ","MarryFavorView",void 0);var L=1106,S=(i("default",function(i){function t(){var e;return(e=i.call(this)||this).flowerCount=void 0,e.flowerImg=void 0,e.friendList=void 0,e.noFriend=void 0,e.friend_info_list=void 0,e.friendInfo=void 0,e.favor_reward_list=void 0,e.list_content=void 0,e.item_height=109,e.screen_height=682,e.is_send_server=!1,e.send_num=0,e.page=1,e.utScrollView=void 0,e.selfGender=void 0,e.isSendToServer=!1,e.name="MarryFavorView",e.url="ui/module/marry/MarryFavorView",e}e(t,i);var l=t.prototype;return l.onInit=function(){var i=this,e=this.findChild("root/btnClose");this.addComponentCallbackListener(e,n.EventType.CLICK,(function(){i.close()})),this.noFriend=this.findChild("root/noFriend"),this.friendList=this.addUIList(this.findChildComponent("root/friendList",o),S),this.addComponentCallbackListener(this.friendList.node,o.EventType.SCROLL_TO_BOTTOM,(function(){i.is_send_server||i.checkNeedSend()})),this.list_content=this.findChild("root/friendList/view/content"),this.flowerCount=this.findChildComponent("root/flowerCount/txtCount",r),this.flowerImg=this.findChildComponent("root/flowerCount/bg/img",s);var t=this.findChild("root/flowerCount/btnBuyFlower");this.addComponentCallbackListener(t,n.EventType.CLICK,(function(){IS(F).GetFavorFriendInfo()&&IS(F).GetFavorFriendInfo().left_times>0?uiMgr.openView("MarryFlowerBuyView",L,IS(F).GetFavorFriendInfo().left_times):C.showFlyTip(GetLanguage(204576))}));var l=this.findChild("root/tips"),h=null;a.uiMirror&&(h=d.RIGHT),this.addComponentCallbackListener(l,n.EventType.CLICK,(function(){C.showBoxTip({tip:""+GetLanguage(204586),ensure:GetLanguage(200129),btnCnt:1,title:GetLanguage(200143),horizontalAlign:h})}))},l.registerUpdateHandler=function(){this.addEvent(w.MARRY_FAVOR_FRIEND_INFO_UPDATE,this.updateFriendInfo,this),this.addEvent(w.MARRY_FAVOR_FRIEND_SEND_FLOWER,this.refreshPage,this),this.addEvent(w.MARRY_FAVOR_FRIEND_BUY_FLOWER,this.refreshFlowerCount,this)},l.refreshPage=function(){this.send_num=1,this.page=1,this.isSendToServer=!1,this.is_send_server=!1,this.noFriend.active=!0,this.friendList.node.active=!1,this.refreshFlowerCount()},l.refreshView=function(){this.friend_info_list=[],IS(p).send_favor_friend_info_c2s(1),this.send_num=1,this.page=1,this.isSendToServer=!1,this.is_send_server=!1,this.noFriend.active=!0,this.friendList.node.active=!1,this.selfGender=IS(I).GetGender();var i=configGoods.getDataByKey(L);i?this.loadIcon(this.flowerImg,i.icon_group,i.icon):printLogErr("道具id无配置 = 1106"),this.refreshFlowerCount()},l.refreshFlowerCount=function(){this.flowerCount.string=IS(g).getGoodsCountByGoodsGtid(L)+"/"+_.familiarity_gift_buy_limit},l.GetDetailHeight=function(){return 90*this.friend_info_list.length},l.checkNeedSend=function(){!this.friendInfo||this.friend_info_list.length>=this.friendInfo.total_num||(this.page+=1,IS(p).send_favor_friend_info_c2s(this.page),this.is_send_server=!0)},l.onAfterOpen=function(){this.friend_info_list=[],IS(p).send_favor_friend_info_c2s(1),this.send_num=1,this.page=1,this.isSendToServer=!1,this.is_send_server=!1,this.noFriend.active=!0,this.friendList.node.active=!1,this.selfGender=IS(I).GetGender();var i=configGoods.getDataByKey(L);i?this.loadIcon(this.flowerImg,i.icon_group,i.icon):printLogErr("道具id无配置 = 1106"),this.refreshFlowerCount()},l.updateFriendInfo=function(){var i=IS(F).GetFavorFriendInfo();if(i&&i.friend_list&&i.friend_list.length>0){for(var e in this.noFriend.active=!1,this.friendList.node.active=!0,this.friendList.datas=i.friend_list,this.friendInfo=i,this.favor_reward_list=[],i.reward_times)if(i.reward_times.hasOwnProperty(e)){var t=i.reward_times[e];this.favor_reward_list[t.k]=t.v}this.friend_info_list=i.friend_list}else this.noFriend.active=!0,this.friendList.node.active=!1;this.isSendToServer=!1,this.is_send_server=!1,this.refreshFlowerCount()},l.onBeforeClose=function(){},l.onDestroy=function(){},t}(y)),function(i){function t(){for(var e,t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return(e=i.call.apply(i,[this].concat(n))||this).imgFrame=void 0,e.imgIcon=void 0,e.imgHeadFrame=void 0,e.rank=void 0,e.rankIcon=void 0,e.btnSendDate=void 0,e.favorRed=void 0,e.favorIcon=void 0,e.friendFavorTitle=void 0,e.titleOutline=void 0,e.friendFavorCount=void 0,e.name=void 0,e.power=void 0,e.player_id=void 0,e}e(t,i);var o=t.prototype;return o.onInit=function(){var i=this;this.imgFrame=v.findChildComponent(this.node,"imgFrame",s),this.imgIcon=v.findChildComponent(this.node,"imgFrame/imgIcon",s),this.imgHeadFrame=v.findChildComponent(this.node,"imgFrame/imgHeadFrame",s),this.rank=v.findChildComponent(this.node,"rank",r),this.rankIcon=v.findChildComponent(this.node,"rankIcon",s),this.btnSendDate=v.findChild(this.node,"btnSendFlower"),this.view.addComponentCallbackListener(this.btnSendDate,n.EventType.CLICK,(function(){i.onSendClick()})),this.favorRed=v.findChild(this.node,"favorIcon/red"),this.favorIcon=v.findChildComponent(this.node,"favorIcon",s),this.friendFavorTitle=v.findChildComponent(this.node,"favorIcon/favorTitle",r),this.titleOutline=v.findChildComponent(this.node,"favorIcon/favorTitle",l),this.friendFavorCount=v.findChildComponent(this.node,"favorCount",r),this.name=v.findChildComponent(this.node,"Node/name",r),this.power=v.findChildComponent(this.node,"Node/power",r),this.view.addComponentCallbackListener(this.imgFrame.node,n.EventType.CLICK,(function(){i.player_id&&IS(m).reqOtherRoleNotice(i.player_id)})),this.view.addComponentCallbackListener(this.favorIcon.node,n.EventType.CLICK,(function(){i.player_id&&uiMgr.openView("MarryFavorDetailView",i.player_id,i.data)}))},o.onRender=function(i,e){var t;this.data=i,e<3?(this.rankIcon.node.active=!0,this.rank.node.active=!1,this.view.loadIcon(this.rankIcon,"common","common_ICON_paiming0"+(e+1))):(this.rankIcon.node.active=!1,this.rank.node.active=!0,this.rank.string=(e+1).toString()),this.view.loadRemoteIcon(i.head.url,this.imgIcon);var n=i.head.frame_id;if(n>0){this.imgHeadFrame.node.active=!0;var o=configAvatar_frame.getDataByKey(n);this.view.loadIcon(this.imgHeadFrame,"icon_frame",o.icon)}else this.imgHeadFrame.node.active=!1;this.player_id=i.role_id,this.name.string=i.name,a.uiMirror?this.power.string=c.GetNumString(i.cur_power)+GetLanguage(200295):this.power.string=GetLanguage(200295)+c.GetNumString(i.cur_power),this.friendFavorCount.string=null!=(t=i.favor)?t:0;var r=configFavorability_level.getDataByKey(i.favor_lv);r.level_group<3?(this.titleOutline.color=(new h).fromHEX(r.color),1==r.level_group?this.friendFavorTitle.node.setPosition(1,-15):this.friendFavorTitle.node.setPosition(20,-15),i.gender!=this.view.selfGender?(this.friendFavorTitle.string=GetLanguage(r.desc[0]),this.view.loadIcon(this.favorIcon,"icon_marry",r.icon[0],null,u.ICON_SPRITE)):2==this.view.selfGender?(this.friendFavorTitle.string=GetLanguage(r.desc[2]),this.view.loadIcon(this.favorIcon,"icon_marry",r.icon[2],null,u.ICON_SPRITE)):(this.friendFavorTitle.string=GetLanguage(r.desc[1]),this.view.loadIcon(this.favorIcon,"icon_marry",r.icon[1],null,u.ICON_SPRITE))):(this.titleOutline.color=(new h).fromHEX(r.color),this.friendFavorTitle.node.setPosition(1,-20),i.gender!=this.view.selfGender?(this.friendFavorTitle.string=GetLanguage(r.desc[0]),this.view.loadIcon(this.favorIcon,"icon_marry",r.title[0],null,u.ICON_SPRITE)):2==this.view.selfGender?(this.friendFavorTitle.string=GetLanguage(r.desc[2]),this.view.loadIcon(this.favorIcon,"icon_marry",r.title[2],null,u.ICON_SPRITE)):(this.friendFavorTitle.string=GetLanguage(r.desc[1]),this.view.loadIcon(this.favorIcon,"icon_marry",r.title[1],null,u.ICON_SPRITE)));var s=!1;for(var d in i.list)if(i.list.hasOwnProperty(d)){var l=i.list[d],f=configFavorability_level.getDataByKey(l.k);r.level_group==f.level_group&&i.favor>=f.favorability&&0==l.v&&this.view.favor_reward_list[f.level]&&this.view.favor_reward_list[f.level]>0&&(s=!0)}this.favorRed.active=s},o.onSendClick=function(){uiMgr.openView("MarrySendFlowerView",this.player_id)},t}(f));t._RF.pop()}}}));

