System.register("chunks:///_virtual/ActivityMergeServersFriendView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./TimeUtil.ts","./index57.ts","./BagModel.ts","./ActivityControl.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./BaseView.ts"],(function(t){"use strict";var e,i,n,s,a,r,d,o,c,h,l,f,v,u,m,p,T,g,C;return{setters:[function(t){e=t.inheritsLoose,i=t.createForOfIteratorHelperLoose},function(t){n=t.cclegacy,s=t.Button,a=t.Label,r=t.ScrollView,d=t.js},function(t){o=t.ItemGrid},function(t){c=t.ListItem},function(t){h=t.default},function(t){l=t.default},null,function(t){f=t.BagModel},function(t){v=t.default},function(t){u=t.default},function(t){m=t.ActivityEventDefine,p=t.ActivityType,T=t.ActivityState,g=t.ActivityTaskState},function(t){C=t.BaseView}],execute:function(){n._RF.push({},"bda37TF7VRDTrze9/wykuUW","ActivityMergeServersFriendView",void 0);t("default",function(t){function i(){var e;return(e=t.call(this)||this).txtLeftTime=void 0,e.taskList=void 0,e.deltaTime=0,e.leftTime=0,e.canUpdate=!1,e.name="ActivityMergeServersFriendView",e.url="ui/module/activityMergeServers/ActivityMergeServersFriendView",e}e(i,t);var n=i.prototype;return n.onInit=function(){var t=this,e=this.findChild("imgMask");this.addComponentCallbackListener(e,s.EventType.CLICK,(function(){t.close()}));var i=this.findChild("btnClose");this.addComponentCallbackListener(i,s.EventType.CLICK,(function(){t.close()})),this.txtLeftTime=this.findChildComponent("view/nodeTime/txtLeftTime",a);var n=this.findChildComponent("view/taskList",r);this.taskList=this.addUIList(n,y)},n.registerUpdateHandler=function(){this.addEvent(m.OnActivityInfoTaskUpdate,this.OnTaskUpdate,this),this.addEvent(m.OnActivityInfoUpdate,this.OnTaskUpdate,this)},n.onAfterOpen=function(){IS(v).send_24_14(p.MergeServersFriend);var t=IS(u).GetActivityInfo(p.MergeServersFriend);if(t){var e,i=null!=(e=t.state_time[t.state])?e:t.state_time[T.Open];this.leftTime=i.end_time-l.serverTime,this.leftTime>0?(this.canUpdate=!0,this.txtLeftTime.string=l.formatTimeStringForSecond(this.leftTime)):this.txtLeftTime.string=GetLanguage(200026)}else this.txtLeftTime.string=GetLanguage(200026);this.OnTaskUpdate()},n.onBeforeClose=function(){this.canUpdate=!1},n.onDestroy=function(){},n.onUpdate=function(t){this.canUpdate&&(this.deltaTime=this.deltaTime+t,this.deltaTime>=1&&(this.deltaTime=0,this.leftTime=this.leftTime-1,this.leftTime>0?this.txtLeftTime.string=l.formatTimeStringForSecond(this.leftTime):(this.txtLeftTime.string=GetLanguage(200026),this.canUpdate=!1)))},n.OnTaskUpdate=function(){var t=IS(u).GetActivityInfo(p.MergeServersFriend),e=[];for(var i in t.task_list)t.task_list.hasOwnProperty(i)&&e.push(t.task_list[i]);e.sort((function(t,e){return t.state==g.CanGet&&e.state!=g.CanGet?-1:t.state!=g.CanGet&&e.state==g.CanGet?1:t.state!=e.state?t.state-e.state:t.task_id-e.task_id})),this.taskList.datas=e},i}(C));var y=function(t){function n(){for(var e,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))||this).txtTitle=void 0,e.txtDesc=void 0,e.rewardScroll=void 0,e}e(n,t);var s=n.prototype;return s.onInit=function(){this.txtTitle=h.findChildComponent(this.node,"title/Label",a),this.txtDesc=h.findChildComponent(this.node,"txtDesc",a),this.rewardScroll=this.view.addUIList(h.findChildComponent(this.node,"rewardScroll",r),G)},s.onRender=function(t,e){this.txtTitle.string=d.formatStr(GetLanguage(303641),e+1);var n=t.cfg.condition[2];this.txtDesc.string=t.cfg.desc+d.formatStr("(%s/%s)",Math.min(n,t.count),n);for(var s,a=[],r=i(t.cfg.reward);!(s=r()).done;){var o=s.value;a.push({task:t,reward:o})}this.rewardScroll.datas=a},n}(c),G=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))||this).itemGridNode=void 0,e.itemGrid=void 0,e.received=void 0,e.canGet=void 0,e}e(i,t);var n=i.prototype;return n.onInit=function(){var t=this;this.received=h.findChild(this.node,"received"),this.canGet=h.findChild(this.node,"canGet"),this.itemGridNode=h.findChild(this.node,"itemGrid"),this.itemGrid=new o(this.view,this.itemGridNode,(function(){t.canGet.active?IS(v).send_24_15(p.MergeServersFriend,t.data.task.task_id,t.data.task.group_id):IS(f).OpenItemTips(t.data.reward[0],t.itemGrid.node)}))},n.onRender=function(t,e){this.itemGrid.SetItemId(t.reward[0],t.reward[1]),t.task.state==g.CanGet?(this.received.active=!1,this.canGet.active=!0):t.task.state==g.HadGet?(this.received.active=!0,this.canGet.active=!1):(this.received.active=!1,this.canGet.active=!1)},i}(c);n._RF.pop()}}}));

