System.register("chunks:///_virtual/CircleOfFriendsMainSubView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./RedPoint.ts","./RedPointMgr.ts","./index57.ts","./CommonDefine.ts","./RoleDataCache.ts","./CircleOfFriendsControl.ts","./CircleOfFriendsDataCache.ts","./CircleOfFriendsDefine.ts","./CircleOfFriendsDynamicMessageItem.ts","./BaseSubView.ts"],(function(t){"use strict";var e,i,n,a,o,s,l,r,h,d,p,c,f,m,b,S,u,C,g,T,y,I;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,n=t.Button,a=t.Label,o=t.Sprite,s=t.ScrollView,l=t.Widget,r=t.UITransform,h=t.Node,d=t.instantiate,p=t.Vec3,c=t.Vec2},function(t){f=t.RedPointType},function(t){m=t.RedPointMgr},null,function(t){b=t.CommonEventDefine},function(t){S=t.RoleDataCache},function(t){u=t.default},function(t){C=t.CircleOfFriendsDataCache},function(t){g=t.CircleOfFriendsEvent,T=t.CircleOfFriendsDefine},function(t){y=t.CircleOfFriendsDynamicMessageItem},function(t){I=t.BaseSubView}],execute:function(){i._RF.push({},"d3442+CpqxDk61VbCdH1AhP","CircleOfFriendsMainSubView",void 0);t("default",function(t){function i(){var e;return(e=t.call(this)||this).ScrollType=[196,267],e.tabSubNode=void 0,e.blockListBtn=void 0,e.topSubTab=void 0,e.tabSubList=[],e.topTabContentList=[],e.myPlayerInfo=void 0,e.ScrollView=void 0,e.ScrollWidge=void 0,e.ScrollTrans=void 0,e.addBtn=void 0,e.tabContent=void 0,e.topSelectNode=void 0,e.tabContentList=[],e.empty=void 0,e.tempMessageItem=void 0,e.imgHeadFrame=void 0,e.specHead=void 0,e.headImg=void 0,e.playerName=void 0,e.gender=void 0,e.fansNum=void 0,e.attentionNum=void 0,e.posName=void 0,e.tagName=void 0,e.bottomTab=void 0,e.toptab=void 0,e.isSendToServer=void 0,e.page=void 0,e.fansBtn=void 0,e.isTopRefresh=!1,e.emptyDes=void 0,e.name="CircleOfFriendsMainSubView",e.fullScreen=!1,e}e(i,t);var I=i.prototype;return I.registerUpdateHandler=function(){this.addEvent(g.UpdateRoleInfo,this.RefreshMyInfo,this),this.addEvent(g.UpdateDynamicInfo,this.RefreshContent,this),this.addEvent(g.DeleteDynamic,this.RefreshContent,this),this.addEvent(g.DeleteDynamicDiscuss,this.RefreshContent,this),this.addEvent(g.UpdateDynamicDiscuss,this.RefreshContent,this),this.addEvent(g.InsertDynamic,this.InsertDynamic,this),this.addEvent(g.InsertDiscusses,this.RefreshContent,this),this.addEvent(g.UpdateAttentionInfo,this.updateAll,this),this.addEvent(b.UpdateTranslateResult,this.updateTranslate,this)},I.updateTranslate=function(t){var e=[];if((e=this.bottomTab==T.MainPanelTabType.My?IS(C).GetDynamicPlayerList():IS(C).GetSquareDynamicList(this.toptab,this.topSubTab))&&e.length>0)for(var i=0;i<e.length;i++){var n=e[i];if("CircleOfFriend"==t.key1&&n.id==Number(t.key2)){delete n.height;var a=this.CalcHeightByIndex(n);this.ScrollView.setCustomItemSize(i,a),this.ScrollView.updateAll();break}}},I.onInit=function(){var t=this;this.InitTempItem(),this.InitTopContent(),this.InitMyPlayerInfo(),this.InitBottomContent(),this.InitScroll(),this.addBtn=this.findChild("addBtn"),this.addComponentCallbackListener(this.addBtn,n.EventType.CLICK,(function(){uiMgr.openView("CircleOfFriendsEditView")})),this.addComponentCallbackListener(this.findChild("bottom/btnClose"),n.EventType.CLICK,(function(){t.parentView.close()})),this.blockListBtn=this.findChild("blockListBtn"),this.addComponentCallbackListener(this.blockListBtn,n.EventType.CLICK,(function(){var e=IS(S).GetRoleId();normalEvent.emit(g.OpenChildView,T.ViewType.AttentionPanel,[3,e,t.playerName.string])})),this.findChildComponent("blockListBtn/Label",a).string=GetLanguage(999300167),this.empty=this.findChild("empty"),this.emptyDes=this.findChildComponent("empty/di/Label",a)},I.InitTopContent=function(){var t=this;this.topSelectNode=this.findChild("top/topSelectNode");for(var e=function(e){var i={node:t.findChild("top/topSelectNode/tabContent/tab"+(e+1)),normal:t.findChild("top/topSelectNode/tabContent/tab"+(e+1)+"/normal"),select:t.findChild("top/topSelectNode/tabContent/tab"+(e+1)+"/select")};t.addComponentCallbackListener(i.node,n.EventType.CLICK,(function(){t.SelectTopTab(e)})),t.topTabContentList.push(i)},i=0;i<4;i++)e(i);this.tabSubNode=this.findChild("top/topSelectNode/tabList");for(var a=function(e){var i=T.MainPanelSquareTabSubTypeList[e],a={type:i,node:t.findChild("top/topSelectNode/tabList/item"+(e+1)),select:t.findChild("top/topSelectNode/tabList/item"+(e+1)+"/selected")};t.addComponentCallbackListener(a.node,n.EventType.CLICK,(function(){t.SelectTopSubTab(i)})),t.tabSubList.push(a)},o=0;o<2;o++)a(o)},I.InitMyPlayerInfo=function(){var t=this;this.myPlayerInfo=this.findChild("top/myPlayerInfo"),this.imgHeadFrame=this.findChildComponent("top/myPlayerInfo/playerInfo/head/imgHeadFrame",o),this.specHead=this.findChild("top/myPlayerInfo/playerInfo/head/gmIcon"),this.headImg=this.findChildComponent("top/myPlayerInfo/playerInfo/head/image",o),this.playerName=this.findChildComponent("top/myPlayerInfo/playerInfo/name",a),this.gender=this.findChildComponent("top/myPlayerInfo/playerInfo/name/gender",o),this.fansBtn=this.findChild("top/myPlayerInfo/fansBtn"),this.fansNum=this.findChildComponent("top/myPlayerInfo/fansBtn/num",a),this.addComponentCallbackListener(this.fansBtn,n.EventType.CLICK,(function(){var e=IS(S).GetRoleId();normalEvent.emit(g.OpenChildView,T.ViewType.AttentionPanel,[2,e,t.playerName.string])})),this.attentionNum=this.findChildComponent("top/myPlayerInfo/attentionBtn/num",a),this.addComponentCallbackListener(this.findChild("top/myPlayerInfo/attentionBtn"),n.EventType.CLICK,(function(){var e=IS(S).GetRoleId();normalEvent.emit(g.OpenChildView,T.ViewType.AttentionPanel,[1,e,t.playerName.string])})),this.posName=this.findChildComponent("top/myPlayerInfo/posSettingBtn/name",a),this.tagName=this.findChildComponent("top/myPlayerInfo/tagSettingBtn/name",a),this.loadIcon(this.findChildComponent("top/myPlayerInfo/posSettingBtn/icon",o),"parking","gg_btn_bianji"),this.addComponentCallbackListener(this.findChild("top/myPlayerInfo/posSettingBtn"),n.EventType.CLICK,(function(){var t=IS(C).GetMyRoleInfo();t&&uiMgr.openView("CircleOfFriendsPosView",t.area1,t.area2)})),this.loadIcon(this.findChildComponent("top/myPlayerInfo/tagSettingBtn/icon",o),"parking","gg_btn_bianji"),this.addComponentCallbackListener(this.findChild("top/myPlayerInfo/tagSettingBtn"),n.EventType.CLICK,(function(){var t=IS(C).GetMyRoleInfo();t&&uiMgr.openView("CircleOfFriendsTagView",t.label)}))},I.InitBottomContent=function(){var t=this;this.tabContent=this.findChild("bottom/tabContent");for(var e=function(e){var i={node:t.findChild("bottom/tabContent/tab"+(e+1)),normal:t.findChild("bottom/tabContent/tab"+(e+1)+"/normal"),select:t.findChild("bottom/tabContent/tab"+(e+1)+"/select")};t.addComponentCallbackListener(i.node,n.EventType.CLICK,(function(){t.SelectBottomTab(e)})),t.tabContentList.push(i)},i=0;i<2;i++)e(i)},I.InitScroll=function(){var t=this,e=this.findChildComponent("ScrollView",s);this.ScrollView=this.addUIList(e,y),this.ScrollWidge=this.findChildComponent("ScrollView",l),this.ScrollTrans=this.findChildComponent("ScrollView",r),this.ScrollView.lackSlide=!0,this.addComponentCallbackListener(e.node,s.EventType.SCROLL_TO_BOTTOM,(function(){if(!t.isSendToServer)if(t.page+=1,t.isSendToServer=!0,t.bottomTab==T.MainPanelTabType.My){var e=IS(C).GetPlayerDynamicInfo();if(e.isMaxPage||!e.page)return;t.page=e.page+1,IS(u).sendToGetMoment(IS(S).GetRoleId(),t.page,T.PageSize)}else{var i=IS(C).GetSqureaInfo();if(i.isMaxPage||!i.page)return;t.page=i.page+1,t.toptab==T.MainPanelSquareTabType.Hot?IS(u).sendToGetHotMoment(t.page,T.PageSize,t.topSubTab):t.toptab==T.MainPanelSquareTabType.Local?IS(u).sendToGetAreaMoment(t.page,T.PageSize,t.topSubTab):t.toptab==T.MainPanelSquareTabType.Offical?IS(u).sendToGetOfficialMoment(t.page,T.PageSize):IS(u).sendToGetSubscribeMoment(t.page,T.PageSize)}})),this.addComponentCallbackListener(e.node,s.EventType.BOUNCE_TOP,(function(){t.isTopRefresh&&(t.isTopRefresh=!1,t.bottomTab==T.MainPanelTabType.My?(t.page=1,IS(u).sendToGetMoment(IS(S).GetRoleId(),t.page,T.PageSize)):(t.page=1,t.toptab==T.MainPanelSquareTabType.Hot?IS(u).sendToGetHotMoment(t.page,T.PageSize,t.topSubTab):t.toptab==T.MainPanelSquareTabType.Local?IS(u).sendToGetAreaMoment(t.page,T.PageSize,t.topSubTab):t.toptab==T.MainPanelSquareTabType.Offical?IS(u).sendToGetOfficialMoment(t.page,T.PageSize):IS(u).sendToGetSubscribeMoment(t.page,T.PageSize)))}));var i=this.findChild("ScrollView/view/content");this.addComponentCallbackListener(i,h.EventType.TRANSFORM_CHANGED,(function(e){e&h.TransformBit.POSITION&&i.position.y<T.ContentRefeshPos&&(t.isTopRefresh=!0)}))},I.InitTempItem=function(){this.tempMessageItem=new y;var t=this.findChild("ScrollView/view/content/item"),e=d(t);e.setParent(this.node),e.active=!0,e.position=new p(99999,99999,99999),this.tempMessageItem.isTempItem=!0,this.tempMessageItem.init(null,e,this)},I.onAfterOpen=function(){var t,e,i=null!=(t=null!=(e=this.openArgs[0])?e:this.bottomTab)?t:T.MainPanelTabType.Square;this.openArgs[0]||null==this.bottomTab?(this.bottomTab=null,this.SelectBottomTab(i)):(this.RefreshContent(),this.bottomTab==T.MainPanelTabType.My&&IS(u).sendToGetRole(IS(S).GetRoleId()))},I.SelectBottomTab=function(t){if(t!=this.bottomTab){this.bottomTab=t;for(var e=0;e<this.tabContentList.length;e++){var i=this.tabContentList[e];i.normal.active=this.bottomTab!=e,i.select.active=this.bottomTab==e}t==T.MainPanelTabType.Square?(this.toptab=null,IS(C).ClearPlayerInfo(),this.myPlayerInfo.active=!1,this.blockListBtn.active=!1,this.topSelectNode.active=!0,this.SelectTopTab(T.MainPanelSquareTabType.Hot),this.emptyDes.string=GetLanguage(300154)):(this.ScrollWidge.top=this.ScrollType[0],this.emptyDes.string=GetLanguage(300155),IS(C).ClearSquareInfo(),this.myPlayerInfo.active=!0,this.blockListBtn.active=!0,this.topSelectNode.active=!1,IS(u).sendToGetRole(IS(S).GetRoleId()),this.page=1,IS(u).sendToGetMoment(IS(S).GetRoleId(),this.page,T.PageSize),this.RefreshMyInfo())}},I.SelectTopTab=function(t){if(this.toptab!=t){this.toptab=t;for(var e=0;e<this.topTabContentList.length;e++){var i=this.topTabContentList[e];i.normal.active=this.toptab!=e,i.select.active=this.toptab==e}this.page=1,this.topSubTab=null,this.toptab==T.MainPanelSquareTabType.Hot||this.toptab==T.MainPanelSquareTabType.Local?(this.ScrollWidge.top=this.ScrollType[1],this.tabSubNode.active=!0,this.SelectTopSubTab(T.MainPanelSquareTabSubType.Recommend)):this.toptab==T.MainPanelSquareTabType.Offical?(this.ScrollWidge.top=this.ScrollType[0],this.tabSubNode.active=!1,IS(u).sendToGetOfficialMoment(this.page,T.PageSize)):(this.ScrollWidge.top=this.ScrollType[0],this.tabSubNode.active=!1,IS(u).sendToGetSubscribeMoment(this.page,T.PageSize)),this.RefreshContent()}},I.SelectTopSubTab=function(t){if(this.topSubTab!=t){this.topSubTab=t;for(var e=0;e<this.tabSubList.length;e++){var i=this.tabSubList[e];i.select.active=this.topSubTab==i.type}this.page=1,this.toptab==T.MainPanelSquareTabType.Hot?IS(u).sendToGetHotMoment(this.page,T.PageSize,this.topSubTab):this.toptab==T.MainPanelSquareTabType.Local&&IS(u).sendToGetAreaMoment(this.page,T.PageSize,this.topSubTab)}},I.RefreshMyInfo=function(){var t=IS(C).GetMyRoleInfo();if(t){this.playerName.string=t.name,this.loadRemoteIcon(t.head_url,this.headImg);var e=t.head.frame_id;if(e>0){this.imgHeadFrame.node.active=!0;var i=configAvatar_frame.getDataByKey(e);this.loadIcon(this.imgHeadFrame,"icon_frame",i.icon)}else this.imgHeadFrame.node.active=!1;if(this.specHead.active=!1,t.gender>0?(this.gender.node.active=!0,this.loadIcon(this.gender,"player",1==t.gender?"grxx_ui_nan":"grxx_ui_nv")):this.gender.node.active=!1,this.fansNum.string=t.fan_num,this.attentionNum.string=t.subscrib_num,t.area1&&t.area1>0){var n=configCircle_location.getDataByKey(t.area1);this.posName.string=n.name}else this.posName.string=GetLanguage(300130);t.label&&t.label>0?this.tagName.string=configCircle_label.getDataByKey(t.label).name:this.tagName.string=GetLanguage(300130),this.UpdateFansRed()}},I.RefreshContent=function(){var t=this,e=[];e=this.bottomTab==T.MainPanelTabType.My?IS(C).GetDynamicPlayerList():IS(C).GetSquareDynamicList(this.toptab,this.topSubTab),this.ScrollView.setCustomItemsSize(e,(function(i){return t.CalcHeightByIndex(e[i])}),!0),this.ScrollView.clearData(),this.ScrollView.datas=e,this.empty.active=0==e.length,this.isSendToServer=!1},I.InsertDynamic=function(){this.bottomTab==T.MainPanelTabType.My?(this.page=1,this.ScrollView.scrollView.scrollToTop(),IS(u).sendToGetMoment(IS(S).GetRoleId(),this.page,T.PageSize)):this.toptab==T.MainPanelSquareTabType.Local&&(this.page=1,this.ScrollView.scrollView.scrollToTop(),IS(u).sendToGetAreaMoment(this.page,T.PageSize,this.topSubTab))},I.CalcHeightByIndex=function(t){if(t){var e=this.tempMessageItem.GetShowContent(t);if(t.height&&t.height.discussLen==t.discusses.length&&e==t.height.content)return t.height.height;var i=this.tempMessageItem.CalcHeight(t);return t.height={discussLen:t.discusses.length,height:i,content:e},i}},I.UpdateFansRed=function(){var t=IS(C).GetMyRoleInfo();this.addRedPoint("fans_red",this.fansBtn,new c(73,24),f.Num,1.2),IS(m).changeValue("fans_red",t.new_fan_num>99?99:t.new_fan_num)},I.updateAll=function(){this.ScrollView.updateAll()},I.onBeforeClose=function(){},I.onDestroy=function(){},i}(I));i._RF.pop()}}}));

