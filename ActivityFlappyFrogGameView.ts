System.register("chunks:///_virtual/ActivityFlappyFrogGameView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AudioMgr.ts","./NodeUtil.ts","./index57.ts","./UIEffectAsset.ts","./ConfigGlobal.ts","./ActivityFrogControl.ts","./BaseView.ts"],(function(t){"use strict";var e,i,o,s,n,l,h,a,r,c,d,f,p,v,u,g,m,_,b,L,y;return{setters:[function(t){e=t.inheritsLoose,i=t.createForOfIteratorHelperLoose},function(t){o=t.cclegacy,s=t.Label,n=t.Button,l=t.CircleCollider2D,h=t.Contact2DType,a=t.RigidBody2D,r=t.Node,c=t.UITransform,d=t.Vec2,f=t.Vec3,p=t.Widget,v=t.BoxCollider2D,u=t.Size},function(t){g=t.audioMgr},function(t){m=t.default},null,function(t){_=t.UIEffectAsset},function(t){b=t.ConfigGlobal},function(t){L=t.default},function(t){y=t.BaseView}],execute:function(){o._RF.push({},"859dbVIgpJIeqt1AISPBKve","ActivityFlappyFrogGameView",void 0);var C=b.space_frog_get_score,k=b.space_frog_origin_location,S=b.space_frog_g,w=b.space_frog_click_speed,B=b.space_frog_incline_limit,P=b.space_frog_speed_limit,M=(t("default",function(t){function o(){var e;return(e=t.call(this)||this).nodeBottom=void 0,e.nodeBlock=void 0,e.itemBlock=void 0,e.imgBottom1=void 0,e.imgBottom2=void 0,e.nodePlayer=void 0,e.nodeEffect=void 0,e.nodeBtnEffect=void 0,e.nodeStart=void 0,e.txtScore=void 0,e.model=null,e.startModel=null,e.playerRig=void 0,e.isPlaying=!1,e.isStart=!1,e.totalDistance=0,e.imgDistance=0,e.levelDistance=0,e.mapSpeed=20,e.curSpeed=0,e.curLevel=0,e.curScore=0,e.blockHeight=900,e.curGap=100,e.mapAry=[],e.levelList=[],e.blockList=[],e.name="ActivityFlappyFrogGameView",e.url="ui/module/activityFrog/ActivityFlappyFrogGameView",e.banDefeat=!0,e}e(o,t);var v=o.prototype;return v.onInit=function(){var t=this;this.nodeBottom=this.findChild("content/nodeBottom");var e=this.findChild("content/nodeBottom/img1"),i=this.findChild("content/nodeBottom/img2");this.mapAry.push(e),this.mapAry.push(i),this.nodeBlock=this.findChild("content/nodeBlock"),this.itemBlock=this.findChild("content/nodeBlock/itemBlock"),this.nodePlayer=this.findChild("content/nodePlayer"),this.nodeStart=this.findChild("start"),this.nodeBtnEffect=this.findChild("start/nodeBtnEffect"),this.nodeEffect=this.findChild("content/nodePlayer/nodeEffect"),this.imgBottom1=this.findChild("content/nodeBottom/imgBottom1"),this.imgBottom2=this.findChild("content/nodeBottom/imgBottom2"),this.txtScore=this.findChildComponent("txtScore",s);var o=this.findChild("bottom/btnClose");this.addComponentCallbackListener(o,n.EventType.CLICK,(function(){t.destroy()}));var l=this.findChild("bottom/btnGuide");this.addComponentCallbackListener(l,n.EventType.CLICK,(function(){uiMgr.openView("ActivityFrogGameGuideView",2)}));var h=this.findChild("btnJump");this.addComponentCallbackListener(h,n.EventType.CLICK,(function(){t.isPlaying&&(g.playSound("bsw_tiaoyue"),t.curSpeed=w)}))},v.registerUpdateHandler=function(){},v.onAfterOpen=function(){var t=this;this.SetPlayerPosition(k[0],k[1]),this.model=_.alloc("prefab/ui-effect/MX_tx_bsw_taikonglixian_frog",this.nodeEffect,-1,(function(e){e.node.getComponent(l).on(h.BEGIN_CONTACT,t.onBeginContact,t),t.playerRig=e.node.getComponent(a),t.addTimer(.2,0,(function(){e.node.setPosition(0,0)}))})),this.startModel=_.alloc("prefab/ui-effect/MX_tx_bsw_taikonganniu_frog",this.nodeBtnEffect,-1,(function(e){var i=m.findChild(e.node,"Label");i&&(i.active=!0);var o=e.node;e.aniName="idle1",t.addComponentCallbackListener(o,r.EventType.TOUCH_START,(function(i){t.isStart||(e.aniName="idle2",g.playSound("common_tap"))})),t.addComponentCallbackListener(o,r.EventType.TOUCH_END,(function(i){if(e.node){var o=m.findChild(e.node,"Label");o&&(o.active=!1)}e.aniName="idle3",t.isStart=!0,t.addTimer(.2,0,(function(){if(!t.isPlaying){t.isPlaying=!0,e.node.setPosition(0,0),e.free(),t.nodeStart.active=!1,t.blockHeight=t.nodeBlock.getComponent(c).height;var i=t.levelList[t.curLevel].lower_half_length[0]+Math.floor(Math.random()*(t.levelList[t.curLevel].lower_half_length[1]-t.levelList[t.curLevel].lower_half_length[0]));t.CreateBlock(0,i),IS(L).send_24_131()}}))}))})),this.initLevel()},v.onBeforeClose=function(){},v.onDestroy=function(){this.isPlaying=!1;for(var t,e=i(this.blockList);!(t=e()).done;){t.value.destroy()}this.blockList=[],this.playerRig.linearVelocity=new d(0,0),this.model.node.setPosition(0,0),this.model.node&&this.model.free()},v.onUpdate=function(t){this.isPlaying&&(this.MoveMap(t),this.MovePlayer(t))},v.initLevel=function(){this.curLevel=0,this.totalDistance=0,this.imgDistance=0,this.curScore=0,this.isStart=!1,this.isPlaying=!1,this.levelList=[],this.blockList=[],this.txtScore.string=this.curScore.toString();for(var t,e=i(configFlappy_bird.getDatas());!(t=e()).done;){var o=t.value;this.levelList.push(o)}this.UpdateLevel()},v.MoveMap=function(t){this.totalDistance+=t*this.mapSpeed,this.imgDistance+=t*this.mapSpeed,this.levelDistance+=t*this.mapSpeed,this.nodeBlock.translate(new f(-t*this.mapSpeed,0,0));for(var e,o=i(this.blockList);!(e=o()).done;){e.value.resetPos()}if(this.nodeBottom.translate(new f(-t*this.mapSpeed,0,0)),this.imgDistance>993){for(var s=0;s<2;s++)if(this.mapAry[s].worldPosition.x<0){this.mapAry[s].setPosition(this.mapAry[s].position.x+1986,0);break}this.imgDistance-=993}this.levelDistance>this.curGap&&(this.levelDistance-=this.curGap,this.UpdateLevel(),this.CreateBlock(this.totalDistance,this.blockList[this.blockList.length-1].b_length))},v.MovePlayer=function(t){this.curSpeed=this.curSpeed-t*S>P[0]?this.curSpeed-t*S:P[0],this.playerRig.linearVelocity=new d(0,this.curSpeed);var e=0;this.curSpeed>0?e=Math.abs(this.curSpeed)/Math.abs(P[1])*B[1]:this.curSpeed<0&&(e=Math.abs(this.curSpeed)/Math.abs(P[0])*B[0]),this.model.node.angle=e,this.CheckPass()},v.SetPlayerPosition=function(t,e){this.nodePlayer.getComponent(p).left=t,this.nodePlayer.getComponent(p).bottom=e},v.CheckPass=function(){for(var t=this.blockList.length-1;t>=0;t--)this.blockList[t].isPassed||this.model.node.worldPosition.x-120>this.blockList[t].node.worldPosition.x&&(g.playSound("common_reward"),this.blockList[t].isPassed=!0,this.curScore+=C,this.txtScore.string=this.curScore.toString(),this.UpdateLevel()),this.blockList[t].checkIsOutRange(this.totalDistance)&&(this.blockList[t].destroy(),this.blockList.splice(t,1))},v.CreateBlock=function(t,e){var i=nodeInstantiate.instantiate(this.itemBlock);this.nodeBlock.addChild(i),this.blockList.push(new M(i,this,this.curLevel,t,e))},v.UpdateLevel=function(){this.curLevel=-1;for(var t,e=i(this.levelList);!(t=e()).done;){var o=t.value;this.curScore>=o.score&&this.curLevel++}this.mapSpeed=this.levelList[this.curLevel].scene_speed,this.curGap=this.levelList[this.curLevel].barrier_interval[0]+Math.floor(Math.random()*(this.levelList[this.curLevel].barrier_interval[1]-this.levelList[this.curLevel].barrier_interval[0]))},v.onBeginContact=function(t,e){var i=this;g.playSound("bsw_zhuiji"),this.isPlaying=!1,this.playerRig.linearVelocity=new d(0,0),this.addTimer(.2,0,(function(){uiMgr.openView("ActivityFlappyFrogGameResultView",i.curScore)}))},o}(y)),function(){function t(t,e,i,o,s){this.node=void 0,this.view=void 0,this.block_bottom=void 0,this.block_top=void 0,this.widget_bottom=void 0,this.widget_top=void 0,this.collider_bottom=void 0,this.collider_top=void 0,this.startX=void 0,this.b_length=void 0,this.isPassed=!1,this.view=e,this.node=t,this.startX=o,this.node.setPosition(o,0),this.block_bottom=m.findChild(this.node,"block1"),this.block_top=m.findChild(this.node,"block2"),this.widget_bottom=m.findChildComponent(this.node,"block1",p),this.widget_top=m.findChildComponent(this.node,"block2",p),this.collider_bottom=m.findChildComponent(this.node,"block1",v),this.collider_top=m.findChildComponent(this.node,"block2",v);var n=this.view,l=n.levelList[n.curLevel].length_offset[0]+Math.floor(Math.random()*(n.levelList[n.curLevel].length_offset[1]-n.levelList[n.curLevel].length_offset[0])),h=n.levelList[n.curLevel].safe_length[0]+Math.floor(Math.random()*(n.levelList[n.curLevel].safe_length[1]-n.levelList[n.curLevel].safe_length[0]));this.b_length=s+l,this.b_length>n.levelList[n.curLevel].lower_half_length[1]&&(this.b_length=n.levelList[n.curLevel].lower_half_length[1]),this.b_length<n.levelList[n.curLevel].lower_half_length[0]&&(this.b_length=n.levelList[n.curLevel].lower_half_length[0]),this.widget_bottom.top=n.blockHeight-this.b_length,this.widget_bottom.bottom=0,this.widget_top.bottom=this.b_length+h,this.widget_top.top=0,this.collider_bottom.size=new u(87,this.b_length),this.collider_bottom.offset.y=this.b_length/2,this.collider_top.size=new u(87,n.blockHeight-h-this.b_length),this.collider_top.offset.y=(h+this.b_length-n.blockHeight)/2,this.collider_bottom.apply(),this.collider_top.apply()}var e=t.prototype;return e.checkIsOutRange=function(t){return t-this.startX>800},e.resetPos=function(){this.block_bottom.setPosition(0,this.block_bottom.position.y),this.block_top.setPosition(0,this.block_top.position.y)},e.destroy=function(){this.block_bottom&&this.block_bottom.destroy(),this.block_top&&this.block_top.destroy(),this.node&&this.node.destroy()},t}());o._RF.pop()}}}));

