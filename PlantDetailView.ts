System.register("chunks:///_virtual/PlantDetailView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./TimeUtil.ts","./index57.ts","./BagModel.ts","./MessageView.ts","./RoleDataCache.ts","./PlantControl.ts","./PlantDefine.ts","./PlantModel.ts","./BaseView.ts"],(function(t){"use strict";var i,e,n,s,o,h,a,l,d,r,c,u,C,f,g,m;return{setters:[function(t){i=t.inheritsLoose},function(t){e=t.cclegacy,n=t.Button,s=t.Label,o=t.Sprite,h=t.Layout,a=t.UITransform},function(t){l=t.default},null,function(t){d=t.BagModel},function(t){r=t.default},function(t){c=t.RoleDataCache},function(t){u=t.default},function(t){C=t.PlantEventDefine,f=t.CropState},function(t){g=t.PlantModel},function(t){m=t.BaseView}],execute:function(){e._RF.push({},"2d58cFZtHVA4Z80hF1+VM5O","PlantDetailView",void 0);var v={2:26,3:8};t("default",function(t){function e(){var i;return(i=t.call(this)||this).txtName=void 0,i.txtGetCount=void 0,i.txtGetAddition=void 0,i.txtCollectTime=void 0,i.nodeGrow=void 0,i.txtGrowTime=void 0,i.nodeBtnUse=void 0,i.nodeCollecting=void 0,i.nodeBtnHelp=void 0,i.nodeBtnSteal=void 0,i.nodeGet=void 0,i.nodeCollect=void 0,i.nodeStealGet=void 0,i.nodeStealTime=void 0,i.txtStealGet=void 0,i.txtStealTime=void 0,i.imgPlant=void 0,i.imgFrame=void 0,i.txtDesc=void 0,i.landId=void 0,i.roleId=void 0,i.landInfo=void 0,i.isOther=void 0,i.MatureTime=void 0,i.waitFetchTime=void 0,i.curState=void 0,i.needWaitChange=void 0,i.time=void 0,i.hasReq=!1,i.listVLayout=void 0,i.isWatingForClose=void 0,i.utDescBg=void 0,i.utDesc=void 0,i.name="PlantDetailView",i.url="ui/module/plant/PlantDetailView",i}i(e,t);var m=e.prototype;return m.onInit=function(){var t=this;this.time=0;var i=this.findChild("imgMask");this.addComponentCallbackListener(i,n.EventType.CLICK,(function(){t.close()})),this.txtName=this.findChildComponent("view/top/txtName",s),this.imgPlant=this.findChildComponent("view/top/item/imgIcon",o),this.imgFrame=this.findChildComponent("view/top/item/imgFrame",o),this.addComponentCallbackListener(this.imgPlant.node,n.EventType.CLICK,(function(){t.onPlantClick()})),this.txtGetCount=this.findChildComponent("view/list/get/value/txtValue",s),this.txtGetAddition=this.findChildComponent("view/list/get/value/txtAddition",s),this.txtCollectTime=this.findChildComponent("view/list/collect/txtValue",s),this.nodeGrow=this.findChild("view/list/grow"),this.txtGrowTime=this.findChildComponent("view/list/grow/txtValue",s),this.nodeBtnUse=this.findChild("view/btnUse"),this.addComponentCallbackListener(this.nodeBtnUse,n.EventType.CLICK,(function(){t.onClickUse()})),this.nodeCollecting=this.findChild("view/collecting"),this.nodeBtnHelp=this.findChild("view/btnHelp"),this.addComponentCallbackListener(this.nodeBtnHelp,n.EventType.CLICK,(function(){t.onClickUse()})),this.nodeBtnSteal=this.findChild("view/btnSteal"),this.addComponentCallbackListener(this.nodeBtnSteal,n.EventType.CLICK,(function(){t.onClickSteal()})),this.nodeCollect=this.findChild("view/list/collect"),this.nodeGet=this.findChild("view/list/get"),this.nodeStealGet=this.findChild("view/list/stealGet"),this.nodeStealTime=this.findChild("view/list/stealTime"),this.txtStealGet=this.findChildComponent("view/list/stealGet/txtValue",s),this.txtStealTime=this.findChildComponent("view/list/stealTime/txtValue",s),this.listVLayout=this.findChildComponent("view/list",h),this.txtDesc=this.findChildComponent("view/top/desc/descParent/txtDesc",s),this.utDesc=this.txtDesc.node.getComponent(a),this.utDescBg=this.findChildComponent("view/top/desc",a)},m.registerUpdateHandler=function(){this.addEvent(C.ROLE_LAND_INFO_UPDATE,this.onRoleLandUpdate,this),this.addEvent(C.ROLE_HOME_FARM_INFO_BACK,this.onRoleHomeInfoBack,this)},m.onAfterOpen=function(){this.time=0,this.landId=this.openArgs[0],this.roleId=this.openArgs[1],this.landInfo=this.openArgs[2],this.isOther=this.roleId&&this.roleId!=IS(c).GetRoleId(),this.updatePlantInfo()},m.updatePlantInfo=function(){var t=this,i=this.isOther?this.landInfo.crop:IS(g).getLandCropInfo(this.landId);if(null!=i)if(this.curState=i.state,this.curState!=f.MATURE||this.isOther)if(this.curState!=f.WAIT_FETCH){if(this.curState!=f.STEALING){var e=configGoods.getDataByKey(i.cfg_id);this.nodeCollect.active=!(this.isOther&&(this.curState==f.MATURE||this.curState==f.GROWING)),this.nodeGet.active=!(this.isOther&&(this.curState==f.MATURE||this.curState==f.COLLECTING)),this.nodeCollecting.active=!this.isOther&&this.curState==f.COLLECTING,this.nodeBtnSteal.active=this.isOther&&(this.curState==f.COLLECTING||this.curState==f.MATURE),this.nodeStealGet.active=this.isOther&&(this.curState==f.MATURE||this.curState==f.COLLECTING),this.nodeStealTime.active=this.isOther&&(this.curState==f.MATURE||this.curState==f.GROWING),this.nodeGrow.active=this.curState==f.GROWING,this.txtGetAddition.node.active=this.curState==f.GROWING;var n=[this.nodeGet,this.nodeCollect,this.nodeGrow,this.nodeStealGet,this.nodeStealTime].filter((function(t){return t.active})).length;this.listVLayout.spacingY=v[n];var s=i.real_fruit_count,o=configFarm_greens.getDataByKey(i.cfg_id);this.txtDesc.string=o.desc,this.txtDesc.schedule((function(){t.utDescBg.height=t.utDesc.height+10.28})),this.txtName.string=e.name;var h=configColor.getDataByKey(e.quality);if(this.loadIcon(this.imgFrame,"icon_equip",h.path),this.loadIcon(this.imgPlant,e.icon_group,e.icon),this.imgPlant.node.active=!0,this.curState==f.MATURE)return this.MatureTime=0,this.waitFetchTime=0,this.nodeBtnUse.active=!1,this.nodeBtnHelp.active=!1,this.txtStealGet.string=String(Math.floor(i.fruit_count*(o.stolen_ratio/1e4))),this.txtStealTime.string=l.formatTimeForSecond(o.stolen_time),this.updateTimeShow(),void(this.needWaitChange=!1);if(this.curState==f.COLLECTING)return this.isOther?this.txtStealGet.string=String(Math.floor(i.fruit_count*(o.stolen_ratio/1e4))):this.txtGetCount.string=s,this.MatureTime=0,this.waitFetchTime=i.end_time,this.nodeBtnUse.active=!1,this.nodeBtnHelp.active=!1,this.updateTimeShow(),void(this.needWaitChange=!1);var a=IS(g).getCropShowByInfo(i).step;this.needWaitChange=a<=0,this.imgPlant.node.active=!this.needWaitChange,this.txtStealTime.string=this.needWaitChange?"???":l.formatTimeForSecond(o.stolen_time);var d=o.reward[1];this.txtGetCount.string=this.needWaitChange?"???":d;var u=s-d;this.txtGetAddition.string="+"+u,this.txtGetAddition.node.active=!this.needWaitChange&&u>0,this.txtName.string=this.needWaitChange?"???":e.name,this.txtCollectTime.string=this.needWaitChange?"???":l.formatTimeForSecond(o.harvest_time),this.MatureTime=i.end_time-i.acc_time,this.waitFetchTime=0,this.nodeBtnUse.active=!this.isOther&&this.curState==f.GROWING&&!this.needWaitChange,this.nodeBtnHelp.active=this.isOther&&this.curState==f.GROWING&&!this.needWaitChange,this.updateTimeShow()}else if(!this.isWatingForClose){var C=i.robber;this.isOther&&C.id==IS(c).GetRoleId()||r.showFlyTip(GetLanguage(200505)),this.isWatingForClose=!0,this.close()}}else this.isWatingForClose||(r.showFlyTip(GetLanguage(200504)),this.isWatingForClose=!0,this.close());else this.isWatingForClose||(r.showFlyTip(GetLanguage(200503)),this.isWatingForClose=!0,this.close());else this.isWatingForClose||(this.isWatingForClose=!0,this.close())},m.onUpdate=function(t){this.time=this.time+t,this.time>=1&&(this.time=0,this.updateTimeShow())},m.updateTimeShow=function(){if(this.curState==f.COLLECTING){var t=this.waitFetchTime-l.serverTime;this.isOther&&t<0&&!this.hasReq&&IS(u).reqFarmInfo(this.roleId),this.txtCollectTime.string=l.formatTimeForSecond(Math.max(0,t))}else if(this.curState==f.GROWING){var i=this.MatureTime-l.serverTime;if(this.isOther&&i<0&&!this.hasReq&&IS(u).reqFarmInfo(this.roleId),this.txtGrowTime.string=this.needWaitChange?"???":l.formatTimeForSecond(Math.max(0,i)),this.needWaitChange)IS(g).getCropShowByInfo(this.isOther?this.landInfo.crop:IS(g).getLandCropInfo(this.landId)).step>0&&this.updatePlantInfo()}},m.onBeforeClose=function(){this.landId=null,this.roleId=null,this.landInfo=null,this.needWaitChange=!1,this.hasReq=!1,this.isWatingForClose=!1},m.onDestroy=function(){},m.onRoleLandUpdate=function(t,i){i.id==this.landId&&(this.isOther&&t==this.roleId&&(this.landInfo=i),this.updatePlantInfo())},m.onRoleHomeInfoBack=function(t){this.isOther&&(t.role_id==this.roleId&&(this.hasReq=!1,this.landInfo=t.landIdToInfo[this.landId],this.updatePlantInfo()))},m.onClickUse=function(){if(this.isOther){var t=this.landInfo.crop,i=t.cfg_id,e=configFarm_greens.getDataByKey(i);if((t.help_times||0)>=e.help_limit)return void r.showFlyTip(GetLanguage(200506))}var n=this.MatureTime-l.serverTime;n<=0?r.showFlyTip(GetLanguage(200507)):uiMgr.openView("FertilizeSelectView",this.landId,this.roleId,n)},m.onClickSteal=function(){if(this.isOther){var t=this.landInfo.crop,i=t.cfg_id,e=configFarm_greens.getDataByKey(i),n=t.robber_list||[];if(n.length>=e.try_stolen_limit)r.showFlyTip(GetLanguage(200508));else{for(var s=0,o=0;o<n.length;o++){if(n[o].k==IS(c).GetRoleId())return void r.showFlyTip(GetLanguage(200509));0==n[o].v&&(s+=1)}s>=e.stolen_limit?r.showFlyTip(GetLanguage(200508)):IS(g).checkCanStealByStealingCount()?IS(u).reqHomeFarmPick(this.roleId,this.landId):r.showFlyTip(GetLanguage(200510))}}},m.onPlantClick=function(){var t=this.isOther?this.landInfo.crop:IS(g).getLandCropInfo(this.landId);IS(d).OpenItemTips(t.cfg_id,this.imgPlant.node)},e}(m));e._RF.pop()}}}));

