System.register("chunks:///_virtual/FlyNum.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AssetPool.ts","./BaseAsset.ts","./NodeUtil.ts","./ObjectPool.ts"],(function(t){"use strict";var i,e,s,n,o,r,l,a,u,h,c;return{setters:[function(t){i=t.inheritsLoose,e=t.createForOfIteratorHelperLoose},function(t){s=t.cclegacy,n=t.Color,o=t.Label,r=t.isValid,l=t.Node},function(t){a=t.AssetPoolState},function(t){u=t.BaseAsset},function(t){h=t.default},function(t){c=t.ObjectPool}],execute:function(){s._RF.push({},"f1ab4mDUo5OmZsbhMqVEk1Q","FlyNum",void 0);var f={crit:"prefab/fly/crit",normal:"prefab/fly/normal",recover:"prefab/fly/recover",miss:"prefab/fly/miss",double:"prefab/fly/double",counter:"prefab/fly/counter"},p=(new n(255,255,255,255),{}),m=t("FlyNum",function(t){function e(){for(var i,e=arguments.length,s=new Array(e),n=0;n<e;n++)s[n]=arguments[n];return(i=t.call.apply(t,[this].concat(s))||this).txtNum=void 0,i._maxTime=void 0,i._currenTime=void 0,i._text=void 0,i._isPlay=void 0,i._size=void 0,i}i(e,t),e.alloc=function(t,i,e,s){void 0===s&&(s=1);var n=flyNumPool.alloc(i,30,2e4);n.loadSync(),n._maxTime=1,n._currenTime=0,n._text=t;var o=p[i];return null==o&&((o=new l(i)).parent=battleMain.flyNumRoot,p[i]=o),n.parent=o,n.position=e,n._isPlay=!1,n._size=s,n.play(),n};var s=e.prototype;return s.onLoadComplete=function(){this.txtNum=h.findChildComponent(this.node,"Text",o)},s.play=function(){!this._isPlay&&r(this.txtNum)&&(this._text&&(this.txtNum.string=this._text,this.txtNum.fontSize=40*this._size),this.txtNum.node.setPosition(0,-40,0),this.txtNum.node.setScale(.5,.5,.5),this._isPlay=!0,this.node.setPosition(this._pos.x,this._pos.y))},s.onUpdate=function(i){if(t.prototype.onUpdate.call(this,i),!(this.poolState>a.Useing)&&(this.play(),-1!=this._maxTime)){if(r(this.txtNum)){var e=0;if(this._currenTime<=.2){e=Math.min(this._currenTime/.2,1),this.txtNum.node.setPosition(0,50*e,0);var s=.5+.75*e;this.txtNum.node.setScale(s,s,s)}else if(this._currenTime<=.5){e=Math.min((this._currenTime-.2)/.3,1),this.txtNum.node.setPosition(0,40+24*e,0);var n=1.25-.25*e;this.txtNum.node.setScale(n,n,n)}}this._currenTime>this._maxTime&&flyNumPool.free(this),this._currenTime+=i}},e}(u)),d=function(){function t(){this.text="",this.bindType=0,this.path="",this.size=1}return t.prototype.cacheReset=function(){this.text="",this.bindType=0,this.path="",this.size=1},t}(),y=function(){function t(){this.passTime=0,this.unitId=0,this.list=[]}var i=t.prototype;return i.addQueue=function(t,i,e,s){void 0===s&&(s=1);var n=N.alloc();n.text=t,n.path=i,n.bindType=e,n.size=s,this.list.push(n)},i.cacheReset=function(){this.passTime=0,this.unitId=0,this.list.length=0},t}(),v=[],_=t("FlyNumMgr",function(){function t(){this._flyDict={}}var i=t.prototype;return i.showFly=function(t,i,e,s,n){var o;void 0===n&&(n=1);var r=f[e];if(null==r)throw new Error(e+": 数字模板路径未找到!");var l=this._flyDict;l[t]=null!=(o=l[t])?o:x.alloc(),l[t].unitId=t,l[t].addQueue(i,r,s,n)},i.update=function(t){for(var i in this._flyDict){var s=this._flyDict[i];if(s.passTime-=t,0==s.list.length&&s.passTime<0)v.push(s);else if(0!=s.list.length){var n=battleMain.unitMgr.getUnit(s.unitId);if(null!=n){if(s.passTime<=0){var o=s.list.shift(),r=n.getBindPos(o.bindType);m.alloc(o.text,o.path,r,o.size),N.free(o),s.passTime=0}}else v.push(s)}}for(var l,a=e(v);!(l=a()).done;){var u=l.value;delete this._flyDict[u.unitId],x.free(u)}v.length=0},i.clear=function(){this._flyDict={}},i.clearPool=function(){flyNumPool.clearPool()},t}()),x=new c(y,100),N=new c(d,100);t("flyNumMgr",new _);s._RF.pop()}}}));

