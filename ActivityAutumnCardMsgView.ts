System.register("chunks:///_virtual/ActivityAutumnCardMsgView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIList.ts","./RedPoint.ts","./RedPointMgr.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./ActivityControl.ts","./ActivityAutumnDataCache.ts","./ActivityAutumnDefine.ts","./BaseView.ts"],(function(t){"use strict";var e,i,n,s,r,o,a,d,m,c,h,u,v,l,f,g,C,p,T;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,n=t.Button,s=t.Sprite,r=t.ScrollView,o=t.Label,a=t.js,d=t.Vec2},function(t){m=t.ListItem},function(t){c=t.RedPointType},function(t){h=t.RedPointMgr},function(t){u=t.default},function(t){v=t.default},function(t){l=t.default},null,function(t){f=t.default},function(t){g=t.default},function(t){C=t.CardItemList,p=t.ActivityAutumnEventDefine},function(t){T=t.BaseView}],execute:function(){i._RF.push({},"84139Zys35AZK/GJDcX9Oj7","ActivityAutumnCardMsgView",void 0);t("default",function(t){function i(){var e;return(e=t.call(this)||this).scrollView=void 0,e.curIndex=void 0,e.tabList=void 0,e.msgTip=void 0,e.msgTipIcon={0:"zq_ui_biaoti_lqxx",1:"zq_ui_biaoti_zsxx"},e.cardItemList=[],e.name="ActivityAutumnCardMsgView",e.url="ui/module/autumn/ActivityAutumnCardMsgView",e}e(i,t);var a=i.prototype;return a.onInit=function(){var t=this,e=this.findChild("imgMask");this.addComponentCallbackListener(e,n.EventType.CLICK,(function(){t.close()}));var i=this.findChild("container/bg/btnClose");this.addComponentCallbackListener(i,n.EventType.CLICK,(function(){t.close()})),this.msgTip=this.findChildComponent("container/bg/title/msgTip",s),this.tabList=[];for(var o=function(e){t.findChild("container/select/item"+e);var i={itemGo:t.findChild("container/select/item"+e),select:t.findChild("container/select/item"+e+"/select")};t.addRedPoint("ActivityAutumnCardMsgCheck_"+e,i.itemGo,new d(45,20),c.Dot),IS(h).updateRed("ActivityAutumnCardMsgCheck_"+e),t.addComponentCallbackListener(i.itemGo,n.EventType.CLICK,(function(){t.RefreshSelectItem(e)})),t.tabList[e]=i},a=0;a<2;a++)o(a);this.scrollView=this.addUIList(this.findChildComponent("container/taskList",r),I)},a.InitCardList=function(){for(var t=0;t<C.length;t++){var e=configGoods.getDataByKey(C[t]);this.findChildComponent("view/card/card"+(t+1)+"/name",o).string=e.name;var i={id:C[t],num:this.findChildComponent("view/card/card"+(t+1)+"/num",o)};this.cardItemList.push(i)}},a.registerUpdateHandler=function(){this.addEvent(p.UpdateActCardInfo,this.updateInfo,this)},a.RefreshSelectItem=function(t){if(this.curIndex!=t){for(var e=0;e<this.tabList.length;e++)this.tabList[e].select.active=t==e;this.curIndex=t,IS(g).CheckNewMsgRed(this.curIndex),this.loadIcon(this.msgTip,"autumn2",this.msgTipIcon[t]),this.scrollView.scrollTo(0,.1),this.updateInfo()}},a.onAfterOpen=function(){var t;this.curIndex=null,this.RefreshSelectItem(null!=(t=this.openArgs[0])?t:0)},a.onBeforeClose=function(){IS(g).CheckNewMsgRed(this.curIndex)},a.onDestroy=function(){},a.updateInfo=function(){var t=IS(g).GetCardMsgList(this.curIndex);t.sort((function(t,e){return t.status,e.status,t.start_time,e.start_time,t.start_time,e.start_time,t.id,e.id,t.id,e.id,t>e?-1:1})),this.scrollView.datas=t},a.updateTask=function(){},i}(T));var I=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))||this).name=void 0,e.time=void 0,e.des=void 0,e.failed=void 0,e.received=void 0,e.btnGet=void 0,e.imgHeadFrame=void 0,e.headImg=void 0,e.specHead=void 0,e.timeCount=void 0,e.receviveTime=void 0,e.desPre=void 0,e.timer=void 0,e}e(i,t);var r=i.prototype;return r.onInit=function(){var t=this;this.name=u.findChildComponent(this.node,"name",o),this.time=u.findChildComponent(this.node,"time",o),this.desPre=u.findChildComponent(this.node,"des",o),this.des=u.findChildComponent(this.node,"des/num",o),this.received=u.findChild(this.node,"received"),this.btnGet=u.findChild(this.node,"btnGet"),this.view.addComponentCallbackListener(this.btnGet,n.EventType.CLICK,(function(){IS(f).send_24_61(t.data.id)})),this.imgHeadFrame=u.findChildComponent(this.node,"head/imgHeadFrame",s),this.specHead=u.findChild(this.node,"head/gmChat"),this.headImg=u.findChildComponent(this.node,"head/image",s),this.timeCount=u.findChildComponent(this.node,"timeCount",o),this.receviveTime=u.findChildComponent(this.node,"receviveTime",o)},r.onRender=function(t,e){var i=this;if(t.role_id>0){this.name.string=t.name,this.specHead.active=!1,this.view.loadRemoteIcon(t.head.url,this.headImg),this.headImg.node.active=!0;var n=t.head.frame_id;if(n>0){this.imgHeadFrame.node.active=!0;var s=configAvatar_frame.getDataByKey(n);this.view.loadIcon(this.imgHeadFrame,"icon_frame",s.icon)}else this.imgHeadFrame.node.active=!1}else this.name.string="",this.specHead.active=!0,this.imgHeadFrame.node.active=!1,this.headImg.node.active=!1;var r=this.view.curIndex,o=new Date(1e3*t.start_time);this.time.string=a.formatStr("%s.%s.%s %s:%s:%s",o.getFullYear(),o.getMonth()+1,o.getDate(),o.getHours(),o.getMinutes(),o.getSeconds());var d=configGoods.getDataByKey(t.card_id);this.des.string=a.formatStr("【%s】x1",d.name),this.timer&&(this.view.removeTimer(this.timer),this.timer=null),0==r?(this.receviveTime.string="",this.desPre.string=GetLanguage(200782),this.received.active=1==t.status,this.btnGet.active=0==t.status,t.end_time-l.serverTime>0&&0==t.status?(this.timeCount.string=l.formatTimeStringForSecond(t.end_time-l.serverTime),this.timer=this.view.addTimer(1,t.end_time-l.serverTime,(function(){t.end_time-l.serverTime>0?i.timeCount.string=l.formatTimeStringForSecond(t.end_time-l.serverTime):(i.timeCount.string="",i.view.removeTimer(i.timer),i.timer=null)}))):(this.btnGet.active=!1,0==t.status||2==t.status?this.receviveTime.string=GetLanguage(200781):this.receviveTime.string="",this.timeCount.string="")):(this.timeCount.string="",0==t.role_id?this.desPre.string=GetLanguage(200784):this.desPre.string=GetLanguage(200783),this.received.active=1==t.status,this.btnGet.active=!1,t.end_time-l.serverTime>0&&0==t.status?(this.receviveTime.string=v.formatStrWithMirrorDeal(GetLanguage(200785),l.formatTimeStringForSecond(t.end_time-l.serverTime)),this.timer=this.view.addTimer(1,t.end_time-l.serverTime,(function(){t.end_time-l.serverTime>0?i.receviveTime.string=v.formatStrWithMirrorDeal(GetLanguage(200785),l.formatTimeStringForSecond(t.end_time-l.serverTime)):(i.receviveTime.string=GetLanguage(200786),i.view.removeTimer(i.timer),i.timer=null)}))):0==t.status||2==t.status?this.receviveTime.string=GetLanguage(200786):this.receviveTime.string="")},r.destroy=function(){this.timer&&(this.view.removeTimer(this.timer),this.timer=null)},r.cacheReset=function(){this.timer&&(this.view.removeTimer(this.timer),this.timer=null),t.prototype.cacheReset.call(this)},i}(m);i._RF.pop()}}}));

