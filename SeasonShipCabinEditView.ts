System.register("chunks:///_virtual/SeasonShipCabinEditView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./index57.ts","./ConfigGlobal.ts","./ObjectUtil.ts","./MessageView.ts","./PetDataCache.ts","./PetModel.ts","./SkillModel.ts","./SeasonControl.ts","./SeasonDataCache.ts","./SeasonDefine.ts","./BaseView.ts"],(function(e){"use strict";var t,i,o,n,s,l,a,d,r,h,c,m,v,p,f,I,u,k,C,g,S,y,L,P,_;return{setters:[function(e){t=e.inheritsLoose,i=e.createForOfIteratorHelperLoose},function(e){o=e.cclegacy,n=e.Button,s=e.ScrollView,l=e.Label,a=e.js,d=e.sys,r=e.Sprite,h=e.Layout,c=e.ProgressBar},function(e){m=e.SelectedType,v=e.ListItem},function(e){p=e.default},function(e){f=e.default},null,function(e){I=e.ConfigGlobal},function(e){u=e.default},function(e){k=e.default},function(e){C=e.PetDataCache},function(e){g=e.PetModel},function(e){S=e.SkillModel},function(e){y=e.default},function(e){L=e.SeasonDataCache},function(e){P=e.SeasonShipEventDefind},function(e){_=e.BaseView}],execute:function(){o._RF.push({},"e2073L1aYpM8rxZO9slkaAa","SeasonShipCabinEditView",void 0);e("default",function(e){function o(){var t;return(t=e.call(this)||this).posItemList1=void 0,t.posItemList2=void 0,t.skillList=void 0,t.scrollSkillList=void 0,t.petList=void 0,t.scrollPetList=void 0,t.txtUnlockNum=void 0,t.petMask=void 0,t.skillMask=void 0,t.curChoosePetId=void 0,t.curChooseSkillId=void 0,t.name="SeasonShipCabinEditView",t.url="ui/module/season/SeasonShipCabinEditView",t}t(o,e);var h=o.prototype;return h.onInit=function(){var e=this,t=this.findChild("content/btnClose");this.addComponentCallbackListener(t,n.EventType.CLICK,(function(){e.close()})),this.posItemList1=[];for(var i=function(t){var i=e.findChild("content/nodeSkill/wearParent/item"+t),o={node:i,nodeWear:p.findChild(i,"nodeWear"),imgFrame:i.getComponent(r),imgIcon:p.findChildComponent(i,"nodeWear/imgIcon",r),txtLevel:p.findChildComponent(i,"nodeWear/txtLevel",l),pbNum:p.findChildComponent(i,"nodeWear/pbNum",c),txtNum:p.findChildComponent(i,"nodeWear/txtNum",l),btnRemove:p.findChild(i,"nodeWear/btnRemove"),nodeEmpty:p.findChild(i,"btnWear"),nodeLock:p.findChild(i,"imgLock"),pos:t};e.addComponentCallbackListener(o.node,n.EventType.CLICK,(function(){e.onPosItemClick(t)})),e.addComponentCallbackListener(o.btnRemove,n.EventType.CLICK,(function(){e.onPosRemoveClick(t)})),e.posItemList1.push(o)},o=1;o<6;o++)i(o);var a=this.findChildComponent("content/nodeSkill/scrollSkillList",s);this.scrollSkillList=this.addUIList(a,b),this.scrollSkillList.selectedMode=m.SINGLE,this.posItemList2=[];for(var d=function(t){var i=e.findChild("content/nodePet/wearParent/item"+t),o={node:i,nodeWear:p.findChild(i,"nodeWear"),imgFrame:i.getComponent(r),imgIcon:p.findChildComponent(i,"nodeWear/imgIcon",r),txtLevel:p.findChildComponent(i,"nodeWear/txtLevel",l),pbNum:p.findChildComponent(i,"nodeWear/pbNum",c),txtNum:p.findChildComponent(i,"nodeWear/txtNum",l),btnRemove:p.findChild(i,"nodeWear/btnRemove"),nodeEmpty:p.findChild(i,"btnWear"),nodeLock:p.findChild(i,"imgLock"),pos:t};e.addComponentCallbackListener(o.node,n.EventType.CLICK,(function(){e.onPetPosItemClick(t)})),e.addComponentCallbackListener(o.btnRemove,n.EventType.CLICK,(function(){e.onPetPosRemoveClick(t)})),e.posItemList2.push(o)},h=1;h<4;h++)d(h);var v=this.findChildComponent("content/nodePet/scrollPetList",s);this.scrollPetList=this.addUIList(v,W),this.scrollPetList.selectedMode=m.SINGLE,this.txtUnlockNum=this.findChildComponent("content/nodeTips/num",l),this.petMask=this.findChild("content/petmask"),this.petMask.active=!1;var f=this.findChild("content/petmask/mask");this.addComponentCallbackListener(f,n.EventType.CLICK,(function(){e.onWearPetMaskClick()})),this.skillMask=this.findChild("content/skillmask"),this.skillMask.active=!1;var I=this.findChild("content/skillmask/mask");this.addComponentCallbackListener(I,n.EventType.CLICK,(function(){e.onWearSkillMaskClick()}))},h.registerUpdateHandler=function(){this.addEvent(P.TYPE_SHIP_ROOM_INFO_UPDATE,this.refreshAll,this)},h.onAfterOpen=function(){this.curChoosePetId=0,this.curChooseSkillId=0,this.refreshAll()},h.refreshAll=function(){IS(L).checkShipRoomRP(),this.refreshUnlockNum(),this.showSkillPanel(),this.showPetPanel()},h.refreshUnlockNum=function(){for(var e,t,o,n=null!=(e=null==(t=IS(L).shipRoominfo)?void 0:t.room_list)?e:[],s=0,l=i(n);!(o=l()).done;){1==o.value.state&&(s+=1)}this.txtUnlockNum.string=s+"/5"},h.showSkillPanel=function(){this.updateSkillPosItems();var e=I.skill_system;this.skillList=[];for(var t=0;t<e.length;t++)IS(S).checkSkillCanShow(e[t])&&this.skillList.push(e[t]);this.skillList=this.skillList.filter((function(e){return!u.isEmpty(IS(S).getSystemSkillInfoBySkillId(e))})),this.skillList.sort((function(e,t){var i=configSkill.getDataByKey(e),o=configSkill.getDataByKey(t),n=IS(S).getSystemSkillInfoBySkillId(e),s=u.isEmpty(n)?0:n.skill_lv,l=IS(S).getSystemSkillInfoBySkillId(t),a=u.isEmpty(l)?0:l.skill_lv;return i.quality==o.quality?s==a?t-e:a-s:o.quality-i.quality})),this.scrollSkillList.datas=this.skillList},h.showPetPanel=function(){this.updatePetPosItems(),this.petList=IS(C).getSortAllPetList(),this.petList=this.petList.filter((function(e){return!u.isEmpty(IS(g).getPetInfoByPetId(e))})),this.petList.sort((function(e,t){var i=configPet.getDataByKey(e),o=configPet.getDataByKey(t),n=IS(g).getPetInfoByPetId(e),s=u.isEmpty(n)?0:n.level,l=IS(g).getPetInfoByPetId(t),a=u.isEmpty(l)?0:l.level;return i.quality==o.quality?s==a?t-e:a-s:o.quality-i.quality})),this.scrollPetList.datas=this.petList},h.updateSkillPosItems=function(){for(var e=0;e<this.posItemList1.length;e++)this.updateSinglePosItem(this.posItemList1[e])},h.updateSinglePosItem=function(e){e.nodeLock.active=!1,e.nodeEmpty.active=!1,e.nodeWear.active=!1;var t=e.pos;if(1!=IS(L).checkPosUnlock(t))return e.nodeLock.active=!0,this.loadIcon(e.imgFrame,"icon_skill","common_ICON_jinengkuang01"),void(e.imgFrame.grayscale=!0);e.imgFrame.grayscale=!1;var i=IS(L).getActiveInfoByPos(t);if(u.isEmpty(i)||0==i.equip_skill.length)return this.loadIcon(e.imgFrame,"icon_skill","common_ICON_jinengkuang01"),void(e.nodeEmpty.active=!0);var o=i.equip_skill[0].skill_id,n=configSkill.getDataByKey(o);this.loadIcon(e.imgFrame,"icon_skill",a.formatStr("common_ICON_jinengkuang0%s",n.quality)),this.loadIcon(e.imgIcon,"icon_skill",n.icon),e.nodeWear.active=!0;var s=i.equip_skill[0].skill_lv;e.txtLevel.string=f.formatStr("Lv.##1",s),e.txtLevel.node.setScale(1,1,1)},h.setChooseskillId=function(e){this.curChooseSkillId=e,this.skillMask.active=0!=e||!1,this.updateSkillPosItems()},h.onWearSkillMaskClick=function(){this.setChooseskillId(0)},h.onPosItemClick=function(e){if(1==IS(L).checkPosUnlock(e)){var t=IS(L).getActiveInfoByPos(e);if(!u.isEmpty(t)&&0!=t.equip_skill.length){var i=t.equip_skill[0].skill_id;if(0!=i)return 0!=this.curChooseSkillId?(IS(y).reqShipRoomInfoUpdate(e,2,this.curChooseSkillId),void this.setChooseskillId(0)):void uiMgr.openView("SkillInfoView",i,!0)}}else{var o=configSeason_cabin.getDataByKey(e);k.showFlyTip((d.uiMirror?f:a).formatStr(GetLanguage(204103),o.condition))}},h.onPosRemoveClick=function(e){var t=IS(L).getActiveInfoByPos(e);u.isEmpty(t)||0==t.equip_skill[0].length||0!=t.equip_skill[0].skill_id&&0==this.curChooseSkillId&&IS(y).reqShipRoomInfoUpdate(e,2,0)},h.updatePetPosItems=function(){for(var e=0;e<this.posItemList2.length;e++)this.updateSinglePetPosItem(this.posItemList2[e])},h.updateSinglePetPosItem=function(e){e.nodeLock.active=!1,e.nodeEmpty.active=!1,e.nodeWear.active=!1;var t=e.pos;if(1!=IS(L).checkPosUnlock(t))return e.nodeLock.active=!0,this.loadIcon(e.imgFrame,"icon_pet","zjm_ui_pinzhikuangbai"),void(e.imgFrame.grayscale=!0);e.imgFrame.grayscale=!1;var i=IS(L).getActiveInfoByPos(t);if(u.isEmpty(i)||0==i.equip_pet.length)return this.loadIcon(e.imgFrame,"icon_pet","zjm_ui_pinzhikuangbai"),void(e.nodeEmpty.active=!0);var o=i.equip_pet[0].pet_id,n=configPet.getDataByKey(o);this.loadIcon(e.imgFrame,"icon_pet",configColor.getDataByKey(n.quality).path),this.loadIcon(e.imgIcon,"icon_pet",n.icon),e.nodeWear.active=!0;var s=i.equip_pet[0].level;e.txtLevel.string=f.formatStr("Lv.##1",s),e.txtLevel.node.setScale(1,1,1)},h.setChoosePetId=function(e){this.curChoosePetId=e,this.petMask.active=0!=e||!1,this.updatePetPosItems()},h.onWearPetMaskClick=function(){this.setChoosePetId(0)},h.onPetPosItemClick=function(e){if(1==IS(L).checkPosUnlock(e)){var t=IS(L).getActiveInfoByPos(e);if(!u.isEmpty(t)&&0!=t.equip_pet.length)return 0!=this.curChoosePetId?(IS(y).reqShipRoomInfoUpdate(e,1,this.curChoosePetId),void this.setChoosePetId(0)):void uiMgr.openView("PetInfoView",t.equip_pet[0].pet_id,!0)}else{var i=configSeason_cabin.getDataByKey(e);k.showFlyTip((d.uiMirror?f:a).formatStr(GetLanguage(204103),i.condition))}},h.onPetPosRemoveClick=function(e){var t=IS(L).getActiveInfoByPos(e);u.isEmpty(t)||0==t.equip_pet.length||0==this.curChoosePetId&&IS(y).reqShipRoomInfoUpdate(e,1,0)},h.onBeforeClose=function(){},h.onDestroy=function(){},o}(_));var b=function(e){function i(){for(var t,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return(t=e.call.apply(e,[this].concat(o))||this).imgFrame=void 0,t.imgIcon=void 0,t.txtLevel=void 0,t.nodeRecommend=void 0,t.btnWear=void 0,t.nodeCanUpgrade=void 0,t.nodeMask=void 0,t.btnRemove=void 0,t.nodeLock=void 0,t.nodeHasWear=void 0,t.skillId=void 0,t.nodeMax=void 0,t}t(i,e);var o=i.prototype;return o.onInit=function(){var e=this;this.imgFrame=p.findChildComponent(this.node,"imgFrame",r),this.imgIcon=p.findChildComponent(this.node,"imgIcon",r),this.nodeMask=p.findChild(this.node,"imgMask"),this.txtLevel=p.findChildComponent(this.node,"txtLevel",l),this.nodeRecommend=p.findChild(this.node,"imgRecommend"),this.btnWear=p.findChild(this.node,"btnWear"),this.view.addComponentCallbackListener(this.btnWear,n.EventType.CLICK,(function(){e.onWearClick()})),this.btnRemove=p.findChild(this.node,"btnRemove"),this.view.addComponentCallbackListener(this.btnRemove,n.EventType.CLICK,(function(){e.onRemoveClick()})),this.nodeLock=p.findChild(this.node,"imgLock"),this.nodeCanUpgrade=p.findChild(this.node,"imgCanUpgrade"),this.nodeHasWear=p.findChild(this.node,"imgHasWear"),this.nodeMax=p.findChild(this.node,"max");var t=p.findChildComponent(this.node,"max",h);this.view.dealMirrorLayout(t),t.horizontalDirection=d.uiMirror?0:1},o.onRender=function(e,t){this.skillId=e;var i=configSkill.getDataByKey(this.skillId);this.view.loadIcon(this.imgFrame,"icon_skill",a.formatStr("common_ICON_jinengkuang0%s",i.quality)),this.view.loadIcon(this.imgIcon,"icon_skill",i.icon);var o=IS(S).getSystemSkillInfoBySkillId(this.skillId),n=u.isEmpty(o)||!1;this.nodeMask.active=n,this.nodeLock.active=n||!1,this.txtLevel.string=n?"":f.formatStr("Lv.##1",o.skill_lv);var s=(n?0:o.skill_lv)+1,l=configSkill_level.getDataByKeys("id",this.skillId,"level",s),d=u.isEmpty(l)||!1;this.nodeMax.active=d,this.txtLevel.node.active=!d,this.nodeCanUpgrade.active=!1,this.nodeRecommend.active=!1,this.btnWear.active=0==n&&0==IS(L).getSkillWearPos(this.skillId)||!1,this.btnRemove.active=0==n&&0!=IS(L).getSkillWearPos(this.skillId)||!1,this.nodeHasWear.active=0==n&&0!=IS(L).getSkillWearPos(this.skillId)||!1},o.onItemClick=function(){uiMgr.openView("SkillInfoView",this.skillId,!0)},o.onWearClick=function(){var e=IS(L).getEmptyPos();null==e?this.view.setChooseskillId(this.skillId):IS(y).reqShipRoomInfoUpdate(e,2,this.skillId)},o.onRemoveClick=function(){var e=IS(L).getSkillWearPos(this.skillId);IS(y).reqShipRoomInfoUpdate(e,2,0)},i}(v),W=function(e){function i(){for(var t,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return(t=e.call.apply(e,[this].concat(o))||this).imgFrame=void 0,t.imgIcon=void 0,t.txtLevel=void 0,t.nodeRecommend=void 0,t.btnWear=void 0,t.btnRemove=void 0,t.nodeHasWear=void 0,t.nodeLock=void 0,t.nodeCanUpgrade=void 0,t.nodeMask=void 0,t.petId=void 0,t.nodeMax=void 0,t}t(i,e);var o=i.prototype;return o.onInit=function(){var e=this;this.imgFrame=p.findChildComponent(this.node,"imgFrame",r),this.imgIcon=p.findChildComponent(this.node,"imgIcon",r),this.nodeMask=p.findChild(this.node,"imgMask"),this.txtLevel=p.findChildComponent(this.node,"txtLevel",l),this.btnWear=p.findChild(this.node,"btnWear"),this.nodeRecommend=p.findChild(this.node,"imgRecommend"),this.view.addComponentCallbackListener(this.btnWear,n.EventType.CLICK,(function(){e.onWearClick()})),this.btnRemove=p.findChild(this.node,"btnRemove"),this.view.addComponentCallbackListener(this.btnRemove,n.EventType.CLICK,(function(){e.onRemoveClick()})),this.nodeLock=p.findChild(this.node,"imgLock"),this.nodeCanUpgrade=p.findChild(this.node,"imgCanUpgrade"),this.nodeHasWear=p.findChild(this.node,"imgHasWear"),this.nodeMax=p.findChild(this.node,"max");var t=p.findChildComponent(this.node,"max",h);this.view.dealMirrorLayout(t),t.horizontalDirection=d.uiMirror?0:1},o.onRender=function(e,t){this.petId=e;var i=configPet.getDataByKey(this.petId);this.view.loadIcon(this.imgFrame,"icon_pet",configColor.getDataByKey(i.quality).path),this.view.loadIcon(this.imgIcon,"icon_pet",i.icon);var o=IS(g).getPetInfoByPetId(this.petId),n=u.isEmpty(o)||!1;this.nodeMask.active=n,this.nodeLock.active=n||!1,this.txtLevel.string=n?"":f.formatStr("Lv.##1",o.level);var s=(n?0:o.level)+1,l=configPetlevel.getDataByKeys("id",this.petId,"level",s),a=u.isEmpty(l)||!1;this.nodeMax.active=a,this.txtLevel.node.active=!a,this.nodeCanUpgrade.active=!1,this.nodeRecommend.active=!1,this.btnWear.active=0==n&&0==IS(L).getPetWearPos(this.petId)||!1,this.btnRemove.active=0==n&&0!=IS(L).getPetWearPos(this.petId)||!1,this.nodeHasWear.active=0==n&&0!=IS(L).getPetWearPos(this.petId)||!1},o.onItemClick=function(){uiMgr.openView("PetInfoView",this.petId,!0)},o.onWearClick=function(){var e=IS(L).getPetEmptyPos();null==e?this.view.setChoosePetId(this.petId):IS(y).reqShipRoomInfoUpdate(e,1,this.petId)},o.onRemoveClick=function(){var e=IS(L).getPetWearPos(this.petId);IS(y).reqShipRoomInfoUpdate(e,1,0)},i}(v);o._RF.pop()}}}));

