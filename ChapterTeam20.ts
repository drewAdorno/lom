System.register("chunks:///_virtual/ChapterTeam20.ts",["./rollupPluginModLoBabelHelpers.js","cc","./FixMath.ts","./BattleData.ts","./index83.ts","./MetaAttrib.ts","./EnumDefine.ts","./EventDefine.ts","./V2.ts","./BaseChapter.ts","./UnitGroupCtr.ts"],(function(t){"use strict";var e,i,a,n,r,s,o,h,l,u,f;return{setters:[function(t){e=t.inheritsLoose,i=t.createForOfIteratorHelperLoose},function(t){a=t.cclegacy},function(t){n=t.FixMath},function(t){r=t.ChapterType},null,function(t){s=t.AttribDefine},function(t){o=t.UnityType},function(t){h=t.EventDefine},function(t){l=t.V2},function(t){u=t.BaseChapter},function(t){f=t.UnitGroupCtr}],execute:function(){a._RF.push({},"32f18mU/G9KVIv3anwRle8M","ChapterTeam20",void 0);var p=new l;t("ChapterTeam20",function(t){function a(){for(var e,i=arguments.length,a=new Array(i),n=0;n<i;n++)a[n]=arguments[n];return(e=t.call.apply(t,[this].concat(a))||this).playerDeadNum=0,e.bossList=[],e.bossUnit=void 0,e}e(a,t);var l=a.prototype;return l.init=function(){this.battleMain.on(h.UnitDead,this.onUnitDead,this),this.battleMain.on(h.T20AddPlayer,this.onAddPlayer,this)},l.setChapter=function(e){var i=this;t.prototype.setChapter.call(this,e),configLeague_gve_chapter.getDataByList("index",this.config.index).forEach((function(t){t.id>=e&&i.bossList.push(configUnit.getDataByKey(t.bossID))}))},l.destroy=function(){},l.getConfig=function(t){return configLeague_gve_chapter.getDataByKey(t)},l.loadData=function(t){var e,i=this.battleMain;for(var a in i.data.playerList)this.addPlayer(i.data.playerList[a],t);i.mainCtr=null!=(e=i.mainCtr)?e:i.playerCtrs[0],i.showMainCtr=i.mainCtr},l.addPlayer=function(t,e){var i=configChapter_type.getDataByKey(r.Team20).player_points,a=new f;null!=i[t.pos]?(a.offsetY=i[t.pos][1],a.offsetX=-i[t.pos][0]):(this.battleMain.printLogErr("ChapterTeam20.addPlayer error, playerData "+JSON.stringify(t)+", points "+JSON.stringify(i)),a.offsetY=i[0][1],a.offsetX=-i[0][0]),a.playerData=t;for(var n=t.units,s=0;s<n.length;s++){var h=void 0;n[s].config.type==o.Player&&(h=this.battleMain.unitMgr.addT20Player(n[s]),a.player=h),a.units.push(h)}return a.positionSelected(e,!0),this.battleMain.playerCtrs.push(a),a},l.onAddPlayer=function(t){var e=this.battleMain;e.data.playerList[t.id]=t,this.addPlayer(t,e.mapCamera.offsetX)},l.onUnitDead=function(t){var e=this.battleMain;if(!t.isCallType&&t.config.type==o.Player){this.playerDeadNum++;for(var a,n=i(e.playerCtrs);!(a=n()).done;){if(a.value.playerData.id==t.data.roleId){e.unitMgr.playerGroupDead(t.data.roleId);break}}}},l.addBoss=function(){var t=this.config,e=this.battleMain.unitMgr.addT20Boss(t.bossID,1);return e.data.currenHp=e.data.getAttrib(s.hp),e},l.start=function(){var t=this.battleMain,e=this.addBoss();e.units=this.bossList;for(var a,n=i(this.mapConfig.points);!(a=n()).done;){var r=a.value;if(1===r[0]){e.position=p.set(r[1],r[2]).add2f(t.mapCamera.offsetX,0);break}}e.direction=-1,this.bossUnit=e,t.emit(h.BossHpChange,e,0)},l.toResult=function(t,e){},l.checkPlayerDead=function(){if(GlobalDefine.CLIENT_TYPE){var t=this.battleMain.playerCtrs;return this.playerDeadNum>=t.length}return!1},l.onUpdate=function(t){if(!this.over){if(this.checkPlayerDead())return this.over=!0,void this.toResult(1);if(this.bossUnit.isDead)return this.over=!0,void this.toResult(0);if(this.timeModel){if(this.chapterTime<=0)return this.over=!0,void this.toResult(this.bossUnit.hpNum>0?0:1,!0);this.chapterTime=n.round(this.chapterTime-t),this.chapterTime=Math.max(this.chapterTime,0)}}},a}(u));a._RF.pop()}}}));

