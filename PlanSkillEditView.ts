System.register("chunks:///_virtual/PlanSkillEditView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./NodeUtil.ts","./index57.ts","./ConfigGlobal.ts","./MainViewModel.ts","./SkillModel.ts","./RoleControl.ts","./RoleDataCache.ts","./RoleDefine.ts","./UIDefine.ts","./BaseView.ts"],(function(n){"use strict";var t,e,i,o,a,l,s,d,c,r,f,u,h,m,I,C,v;return{setters:[function(n){t=n.inheritsLoose},function(n){e=n.cclegacy,i=n.Button,o=n.UITransform,a=n.Vec3,l=n.js,s=n.Sprite,d=n.Label},function(n){c=n.default},null,function(n){r=n.ConfigGlobal},function(n){f=n.MainViewModel},function(n){u=n.SkillModel},function(n){h=n.default},function(n){m=n.RoleDataCache},function(n){I=n.RoleEventDefine},function(n){C=n.PanelTabType},function(n){v=n.BaseView}],execute:function(){e._RF.push({},"5c9cahPiKFMTqFttSy5emsa","PlanSkillEditView",void 0);var p=r.skill_tab_num;n("default",function(n){function e(){var t;return(t=n.call(this)||this).infoItems=[],t.curPlanId=void 0,t.nodeItem=void 0,t.nodeContent=void 0,t.utContent=void 0,t.name="PlanSkillEditView",t.url="ui/module/role/PlanSkillEditView",t}t(e,n);var r=e.prototype;return r.onInit=function(){var n=this,t=this.findChild("imgMask");this.addComponentCallbackListener(t,i.EventType.CLICK,(function(){n.close()}));var e=this.findChild("content/btnGoTo");this.addComponentCallbackListener(e,i.EventType.CLICK,(function(){IS(f).TryJumpToMainViewPanel(C.Main_Role,C.Role_Skill),n.close(),uiMgr.close("RolePlanView"),uiMgr.close("DoubleChapterMainView")})),this.nodeContent=this.findChild("content/scroll/view/content"),this.utContent=this.nodeContent.getComponent(o),this.nodeItem=this.findChild("content/scroll/view/content/skillRoot"),this.nodeItem.active=!1;for(var a=function(t){var e=nodeInstantiate.instantiate(n.nodeItem);e.parent=n.nodeContent,e.active=!0;var o=c.findChild(e,"btnSwitch");n.addComponentCallbackListener(o,i.EventType.CLICK,(function(){IS(h).send_role_update_plan_c2s(n.curPlanId,[{k:2,v:t}])}));for(var a=[],r=1;r<=5;r++){var f=c.findChild(e,l.formatStr("wearParent/item%s",r+1));a.push({node:f,pos:r+1,nodeLock:c.findChild(f,"imgLock"),nodeEmpty:c.findChild(f,"btnWear"),nodeWear:c.findChild(f,"nodeWear"),imgFrame:f.getComponent(s),imgIcon:c.findChildComponent(f,"nodeWear/imgIcon",s),txtLevel:c.findChildComponent(f,"nodeWear/txtLevel",d)})}n.infoItems.push({nodeSkillRoot:e,txtName:c.findChildComponent(e,"name/txtName",d),nodeCur:c.findChild(e,"nodeCur"),btnSwitch:o,tabId:t,skillItems:a})},r=1;r<=p;r++)a(r);this.utContent.height=8+160.96*p+20*(p-1)},r.registerUpdateHandler=function(){this.addEvent(I.PLAN_INFO_BACK,this.OnPlanInfoBack,this),this.addEvent(I.PLAN_INFO_UPDATE,this.onPlanInfoUpdate,this)},r.onAfterOpen=function(){this.nodeContent.setPosition(new a(0,0,0)),this.curPlanId=this.openArgs[0],this.updateContent()},r.updateContent=function(){for(var n=0;n<this.infoItems.length;n++)this.updateSingleInfo(this.infoItems[n]),this.updateSelect(this.infoItems[n])},r.updateSingleInfo=function(n){n.txtName.string=IS(u).getTabName(n.tabId);for(var t=IS(u).getTabInfo(n.tabId),e=t?t.pos_info:[],i={},o=0;o<e.length;o++)i[e[o].k]=e[o].v;for(var a=0;a<n.skillItems.length;a++){var s=n.skillItems[a],d=s.pos;if(s.nodeLock.active=!1,s.nodeEmpty.active=!1,s.nodeWear.active=!1,1==IS(u).checkPosUnlock(d)){s.imgFrame.grayscale=!1;var c=i[d];if(c&&0!=c){var r=IS(u).getSystemSkillInfoBySkillId(c),f=configSkill.getDataByKey(c);this.loadIcon(s.imgFrame,"icon_skill",l.formatStr("common_ICON_jinengkuang0%s",f.quality)),this.loadIcon(s.imgIcon,"icon_skill",f.icon),s.nodeWear.active=!0;var h=r.skill_lv;s.txtLevel.string=l.formatStr("Lv.%s",h)}else this.loadIcon(s.imgFrame,"icon_skill","common_ICON_jinengkuang01"),s.nodeEmpty.active=!0}else s.nodeLock.active=!0,this.loadIcon(s.imgFrame,"icon_skill","common_ICON_jinengkuang01"),s.imgFrame.grayscale=!0}},r.updateSelect=function(n){for(var t,e=IS(m).planIdToInfo[this.curPlanId].detail,i=0;i<e.length;i++)if(2==e[i].k){t=e[i].v;break}n.nodeCur.active=n.tabId==t,n.btnSwitch.active=n.tabId!=t},r.OnPlanInfoBack=function(){for(var n=0;n<this.infoItems.length;n++)this.updateSelect(this.infoItems[n])},r.onPlanInfoUpdate=function(n){if(n==this.curPlanId)for(var t=0;t<this.infoItems.length;t++)this.updateSelect(this.infoItems[t])},r.onBeforeClose=function(){},r.onDestroy=function(){},e}(v));e._RF.pop()}}}));

