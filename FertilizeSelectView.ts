System.register("chunks:///_virtual/FertilizeSelectView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./ConfigGlobal.ts","./AdDefine.ts","./AdModel.ts","./BagModel.ts","./MessageView.ts","./MarryControl.ts","./MarryDefine.ts","./RoleDataCache.ts","./RoleDefine.ts","./PlantControl.ts","./PlantDefine.ts","./PlantModel.ts","./BaseView.ts"],(function(e){"use strict";var t,i,n,s,o,d,l,h,r,a,u,I,m,F,c,f,E,v,R,L,z,_,C,T,g,B,p,y,A;return{setters:[function(e){t=e.inheritsLoose},function(e){i=e.cclegacy,n=e.Button,s=e.Sprite,o=e.LabelOutline,d=e.Label,l=e.Vec3,h=e.EditBox,r=e.js,a=e.Color},function(e){u=e.ItemGrid,I=e.ItemGridAutoNum},function(e){m=e.default},function(e){F=e.default},null,function(e){c=e.ConfigGlobal},function(e){f=e.ADS_TYPE,E=e.AdEventDefine},function(e){v=e.AdModel},function(e){R=e.BagModel},function(e){L=e.default},function(e){z=e.default},function(e){_=e.MarryEventDefine},function(e){C=e.RoleDataCache},function(e){T=e.PlayerAttr,g=e.RoleEventDefine},function(e){B=e.default},function(e){p=e.PlantEventDefine},function(e){y=e.PlantModel},function(e){A=e.BaseView}],execute:function(){i._RF.push({},"e10a7lLa0RF6ousRI2F/exi","FertilizeSelectView",void 0);e("default",function(e){function i(){var t;return(t=e.call(this)||this).nodeBtnFertilizeGet=void 0,t.nodeBtnFertilizeBuy=void 0,t.nodeBtnFertilizeHelp=void 0,t.nodeBtnAd=void 0,t.txtAdDesc=void 0,t.txtAdCount=void 0,t.nodeAdIcon=void 0,t.nodeFertilizeGetSelect=void 0,t.nodeFertilizeBuySelect=void 0,t.nodeFertilizeHelpSelect=void 0,t.imgBtnFertilize=void 0,t.outLineTxtFertilize=void 0,t.txtFertilize=void 0,t.nodeEdit=void 0,t.editBox=void 0,t.txtTime=void 0,t.useFertilizeItemId=void 0,t.roleId=void 0,t.isOther=void 0,t.useNum=void 0,t.minNum=void 0,t.maxNum=void 0,t.remainTime=void 0,t.landId=void 0,t.itemFertilizeGet=void 0,t.itemFertilizeBuy=void 0,t.itemFertilizeHelp=void 0,t.isOneKey=!1,t.buffNum=0,t.favorLevel=0,t.name="FertilizeSelectView",t.url="ui/module/plant/FertilizeSelectView",t}t(i,e);var A=i.prototype;return A.onInit=function(){var e=this,t=this.findChild("imgMask");this.addComponentCallbackListener(t,n.EventType.CLICK,(function(){e.close()}));var i=this.findChild("view/btnUse");this.addComponentCallbackListener(i,n.EventType.CLICK,(function(){e.onFertilizeClick()})),this.imgBtnFertilize=i.getComponent(s),this.outLineTxtFertilize=this.findChildComponent("view/btnUse/Label",o),this.txtFertilize=this.outLineTxtFertilize.node.getComponent(d),this.nodeBtnFertilizeGet=this.findChild("view/btnFertilizeGet"),this.itemFertilizeGet=new u(this,this.nodeBtnFertilizeGet.getChildByName("itemGrid"),(function(){e.useFertilizeItemId=T.ROLE_FERTILIZER_GET,e.updateSelect()})),this.itemFertilizeGet.SetItemId(T.ROLE_FERTILIZER_GET),this.nodeFertilizeGetSelect=this.findChild("view/btnFertilizeGet/imgSelect"),this.nodeBtnAd=this.findChild("view/btnFertilizeAd"),this.addComponentCallbackListener(this.nodeBtnAd,n.EventType.CLICK,(function(){IS(v).tryWatchAd(f.AD_FARM_FERTILE)})),this.txtAdDesc=this.findChildComponent("view/btnFertilizeAd/txtDesc",d),this.txtAdCount=this.findChildComponent("view/btnFertilizeAd/txtCount",d),this.nodeAdIcon=this.findChild("view/btnFertilizeAd/imgAd"),this.nodeAdIcon.active=1==c.ads_icon_is_show,this.txtAdCount.node.position=1==c.ads_icon_is_show?new l(16,-13,0):new l(0,-13,0),this.nodeBtnFertilizeBuy=this.findChild("view/btnFertilizeBuy"),this.itemFertilizeBuy=new u(this,this.nodeBtnFertilizeBuy.getChildByName("itemGrid"),(function(){e.useFertilizeItemId=T.ROLE_FERTILIZER_BUY,e.updateSelect()})),this.itemFertilizeBuy.SetItemId(T.ROLE_FERTILIZER_BUY),this.nodeFertilizeBuySelect=this.findChild("view/btnFertilizeBuy/imgSelect"),this.nodeBtnFertilizeHelp=this.findChild("view/btnFertilizeHelp"),this.itemFertilizeHelp=new u(this,this.nodeBtnFertilizeHelp.getChildByName("itemGrid"),(function(){e.useFertilizeItemId=T.ROLE_FERTILIZER_HELP,e.updateSelect()})),this.itemFertilizeHelp.SetItemId(T.ROLE_FERTILIZER_HELP),this.nodeFertilizeHelpSelect=this.findChild("view/btnFertilizeHelp/imgSelect"),this.nodeEdit=this.findChild("view/edit");var r=this.findChild("view/edit/btnAdd");this.addComponentCallbackListener(r,n.EventType.CLICK,(function(){e.changeNum(1)}));var a=this.findChild("view/edit/btnMinus");this.addComponentCallbackListener(a,n.EventType.CLICK,(function(){e.changeNum(-1)}));var I=this.findChild("view/edit/btnAddTen");this.addComponentCallbackListener(I,n.EventType.CLICK,(function(){e.changeNum(10)}));var m=this.findChild("view/edit/btnMinusTen");this.addComponentCallbackListener(m,n.EventType.CLICK,(function(){e.changeNum(-10)})),this.editBox=this.findChildComponent("view/edit/EditBox",h),this.addComponentCallbackListener(this.editBox.node,h.EventType.EDITING_DID_ENDED,(function(){var t=Number(e.editBox.string);(isNaN(t)||t<=e.minNum)&&(t=e.minNum),e.useNum=Math.floor(t),e.changeNum()})),this.txtTime=this.findChildComponent("view/edit/time/txtTime",d)},A.registerUpdateHandler=function(){this.addEvent(E.AD_INFO_UPDATE,this.onAdInfoUpdate,this),this.addEvent(g.ROLE_RES_UPDATE,this.onRoleResUpdate,this),this.addEvent(_.MARRY_FAVOR_FRIEND_LV_BACK,this.onMarryFavorFriendLvBack,this)},A.onAfterOpen=function(){this.landId=this.openArgs[0],this.roleId=this.openArgs[1],this.remainTime=this.openArgs[2],this.isOneKey=this.openArgs[3]||!1,this.txtFertilize.string=this.isOneKey?GetLanguage(203826):GetLanguage(203827),this.isOther=this.roleId&&this.roleId!=IS(C).GetRoleId(),this.isOther&&(this.useFertilizeItemId=T.ROLE_FERTILIZER_HELP,IS(z).send_favor_friend_lv_c2s(this.roleId));var e=this.itemFertilizeGet.SetItemNum(I,!0),t=this.itemFertilizeBuy.SetItemNum(I,!0);this.isOther||(e>0?this.useFertilizeItemId=T.ROLE_FERTILIZER_GET:t>0&&(this.useFertilizeItemId=T.ROLE_FERTILIZER_BUY)),this.updateAdInfo(),this.updateSelect(),this.itemFertilizeHelp.SetItemNum(I,!0),this.nodeBtnAd.active=!this.isOther&&e<=0,this.nodeBtnFertilizeGet.active=!this.isOther&&e>0,this.nodeBtnFertilizeBuy.active=!this.isOther,this.nodeBtnFertilizeHelp.active=this.isOther},A.updateAdInfo=function(){var e=configAds.getDataByKey(f.AD_FARM_FERTILE),t=IS(v).getAdRewardValue(f.AD_FARM_FERTILE);this.txtAdDesc.string=m.formatStrWithMirrorDeal(e.desc,t);var i=IS(v).getAdWatchCount(f.AD_FARM_FERTILE);this.txtAdCount.string=r.formatStr("(%s/%s)",e.times-i,e.times)},A.updateSelect=function(){this.nodeFertilizeGetSelect.active=this.useFertilizeItemId&&this.useFertilizeItemId==T.ROLE_FERTILIZER_GET,this.nodeFertilizeBuySelect.active=this.useFertilizeItemId&&this.useFertilizeItemId==T.ROLE_FERTILIZER_BUY,this.nodeFertilizeHelpSelect.active=this.useFertilizeItemId&&this.useFertilizeItemId==T.ROLE_FERTILIZER_HELP,this.imgBtnFertilize.grayscale=null==this.useFertilizeItemId,this.outLineTxtFertilize.color=null==this.useFertilizeItemId?new a(76,76,76):new a(41,65,21);var e=0;if(0!=this.favorLevel){var t=configFavorability_level.getDataByKey(this.favorLevel).buff;if(t)for(var i=0;i<t.length;i++)if("fertile"==t[i][0]){e=t[i][1];break}}if(this.useFertilizeItemId&&this.useFertilizeItemId==T.ROLE_FERTILIZER_GET){var n=configGoods.getDataByKey(T.ROLE_FERTILIZER_GET);this.maxNum=Math.min(IS(R).getGoodsCountByGoodsGtid(T.ROLE_FERTILIZER_GET),Math.ceil(this.remainTime/n.effect[1]))}if(this.useFertilizeItemId&&this.useFertilizeItemId==T.ROLE_FERTILIZER_BUY){var s=configGoods.getDataByKey(T.ROLE_FERTILIZER_BUY);this.maxNum=Math.min(IS(R).getGoodsCountByGoodsGtid(T.ROLE_FERTILIZER_BUY),Math.ceil(this.remainTime/s.effect[1]))}if(this.useFertilizeItemId&&this.useFertilizeItemId==T.ROLE_FERTILIZER_HELP){var o=configGoods.getDataByKey(T.ROLE_FERTILIZER_HELP);this.maxNum=Math.min(IS(R).getGoodsCountByGoodsGtid(T.ROLE_FERTILIZER_HELP),Math.ceil(this.remainTime/(o.effect[1]*(1+e/1e4))))}this.buffNum=e,this.minNum=this.maxNum<=0?0:1,this.useNum=this.maxNum,this.nodeEdit.active=null!=this.useFertilizeItemId&&!this.isOneKey,this.changeNum()},A.onBeforeClose=function(){this.useFertilizeItemId=null,this.roleId=null,this.remainTime=null,this.buffNum=0,this.favorLevel=0},A.onDestroy=function(){},A.onAdInfoUpdate=function(e){e==f.AD_FARM_FERTILE&&this.updateAdInfo()},A.onRoleResUpdate=function(e){if(e==T.ROLE_FERTILIZER_GET){var t=this.itemFertilizeGet.SetItemNum(I,!0);this.nodeBtnAd.active=t<=0,this.nodeBtnFertilizeGet.active=t>0,t>0&&null==this.useFertilizeItemId&&!this.isOther&&(this.useFertilizeItemId=T.ROLE_FERTILIZER_GET,this.updateSelect())}else e==T.ROLE_FERTILIZER_BUY?this.itemFertilizeBuy.SetItemNum(I,!0):e==T.ROLE_FERTILIZER_HELP&&this.itemFertilizeHelp.SetItemNum(I,!0)},A.onMarryFavorFriendLvBack=function(e){this.isOther&&e.role_id==this.roleId&&(this.favorLevel=e.favor_lv,this.updateSelect())},A.onFertilizeClick=function(){if(null!=this.useFertilizeItemId){var e=IS(R).getGoodsCountByGoodsGtid(this.useFertilizeItemId);if(e<=0)L.showFlyTip(GetLanguage(200502));else{if(this.isOneKey){var t=0,i=IS(y).getMeetConditionLand("grow");if(i.length<=0)L.showFlyTip(GetLanguage(203828));else for(var n=0;n<i.length&&!(e-t<=0);n++){var s=IS(y).getLandCropInfo(i[n]),o=s.end_time-s.acc_time-F.serverTime,d=configGoods.getDataByKey(this.useFertilizeItemId),l=void 0;l=this.useFertilizeItemId==T.ROLE_FERTILIZER_HELP?Math.min(e-t,Math.ceil(o/(d.effect[1]*(1+this.buffNum/1e4)))):Math.min(e-t,Math.ceil(o/d.effect[1])),IS(B).reqHomeFarmFertilize(0,i[n],this.useFertilizeItemId,l),normalEvent.emit(p.FARM_FERTILIZE_PLANT_ACTION,i[n]),t+=l}}else IS(B).reqHomeFarmFertilize(this.isOther?this.roleId:0,this.landId,this.useFertilizeItemId,this.useNum),normalEvent.emit(p.FARM_FERTILIZE_PLANT_ACTION,this.landId);this.close(),uiMgr.close("PlantDetailView")}}else L.showFlyTip(GetLanguage(200501))},A.changeNum=function(e){null!=this.useFertilizeItemId&&(null!=e&&(this.useNum=this.useNum+e),this.useNum=Math.min(this.maxNum,Math.max(this.useNum,this.minNum)),this.editBox.string=String(this.useNum),this.trySetTime())},A.trySetTime=function(){if(null!=this.useFertilizeItemId){var e=configGoods.getDataByKey(this.useFertilizeItemId);this.useFertilizeItemId==T.ROLE_FERTILIZER_HELP?this.txtTime.string=F.formatTimeForSecond(this.useNum*(e.effect[1]*(1+this.buffNum/1e4))):this.txtTime.string=F.formatTimeForSecond(this.useNum*e.effect[1])}},i}(A));i._RF.pop()}}}));

