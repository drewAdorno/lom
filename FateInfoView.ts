System.register("chunks:///_virtual/FateInfoView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./NodeUtil.ts","./StringUtil.ts","./index57.ts","./ItemIcon.ts","./ConfigGlobal.ts","./BagModel.ts","./MessageView.ts","./RoleDataCache.ts","./FateControl.ts","./FateDataCache.ts","./FateDefine.ts","./BaseView.ts"],(function(t){"use strict";var e,i,o,n,s,a,l,r,d,c,h,f,v,u,p,g,m,C,I,y;return{setters:[function(t){e=t.inheritsLoose,i=t.createForOfIteratorHelperLoose},function(t){o=t.cclegacy,n=t.Button,s=t.Sprite,a=t.Label,l=t.sys,r=t.RichText,d=t.js},function(t){c=t.default},function(t){h=t.default},null,function(t){f=t.IconAseetType},function(t){v=t.ConfigGlobal},function(t){u=t.BagModel},function(t){p=t.default},function(t){g=t.RoleDataCache},function(t){m=t.default},function(t){C=t.default},function(t){I=t.FateEventDefine},function(t){y=t.BaseView}],execute:function(){o._RF.push({},"58844WMiu9FLYkShDDr/0c2","FateInfoView",void 0);t("default",function(t){function o(){var e;return(e=t.call(this)||this).imgIcon=void 0,e.txtName=void 0,e.txtLev=void 0,e.skillNode=void 0,e.skillName=void 0,e.skillDesc=void 0,e.skillQuality=void 0,e.costNode=void 0,e.txtCost=void 0,e.iconCost=void 0,e.oprateNode=void 0,e.oprateNode2=void 0,e.btnWear=void 0,e.btnUpgrade=void 0,e.btnRemove=void 0,e.btnCancel=void 0,e.btnSet=void 0,e.btnRemove2=void 0,e.redNode=void 0,e.btnReset=void 0,e.attrItems=[],e.fateInfo=void 0,e.name="FateInfoView",e.url="ui/module/fate/FateInfoView",e}e(o,t);var c=o.prototype;return c.onInit=function(){var t=this,e=this.findChild("imgMask");this.addComponentCallbackListener(e,n.EventType.CLICK,(function(){t.close()})),this.imgIcon=this.findChildComponent("content/top/imgIcon",s),this.txtName=this.findChildComponent("content/top/imgIcon/txtName",a),this.txtLev=this.findChildComponent("content/top/imgIcon/txtLev",a),l.uiMirror&&(this.txtName.node.setScale(1,1,1),this.txtLev.node.setScale(1,1,1)),this.skillNode=this.findChild("content/top/skill"),this.skillName=this.findChildComponent("content/top/skill/txtName",a),this.skillDesc=this.findChildComponent("content/top/skill/txtDesc",r),this.skillQuality=this.findChildComponent("content/top/skill/txtQuality",r),this.costNode=this.findChild("content/cost"),this.txtCost=this.findChildComponent("content/cost/txtCost",r),this.iconCost=this.findChildComponent("content/cost/icon",s);for(var i=1;i<=4;i++){var o=new x;o.init(this.findChild("content/attr/attr"+i),this),this.attrItems.push(o)}this.btnReset=this.findChild("content/top/imgIcon/btnReset"),this.addComponentCallbackListener(this.btnReset,n.EventType.CLICK,(function(){var e=v.fate_reset_expend,i=h.formatStrWithMirrorDeal(GetLanguage(202021),e[1]);p.showBoxTip({tip:i,title:GetLanguage(200048),func:function(i){if("type_yes"==i){if(IS(u).getGoodsCountByGoodsGtid(e[0])<e[1])return void p.showFlyTip(GetLanguage(200069));IS(m).send_35_16(t.fateInfo.id)}}})})),this.oprateNode=this.findChild("content/oprate"),this.oprateNode2=this.findChild("content/oprate2"),this.btnWear=this.findChild("content/oprate/btnWear"),this.addComponentCallbackListener(this.btnWear,n.EventType.CLICK,(function(){t.onWearClick()})),this.btnUpgrade=this.findChild("content/oprate/btnUpgrade"),this.redNode=this.findChild("content/oprate/btnUpgrade/red"),this.addComponentCallbackListener(this.btnUpgrade,n.EventType.CLICK,(function(){t.onUpgradeClick()})),this.btnRemove=this.findChild("content/oprate/btnRemove"),this.addComponentCallbackListener(this.btnRemove,n.EventType.CLICK,(function(){t.onRemoveClick()})),this.btnSet=this.findChild("content/oprate2/btnSet"),this.addComponentCallbackListener(this.btnSet,n.EventType.CLICK,(function(){normalEvent.emit(I.FateMergeSet,t.fateInfo.id,1),t.close()})),this.btnCancel=this.findChild("content/oprate2/btnCancel"),this.addComponentCallbackListener(this.btnCancel,n.EventType.CLICK,(function(){normalEvent.emit(I.FateMergeSet,t.fateInfo.id,2),t.close()})),this.btnRemove2=this.findChild("content/oprate2/btnRemove"),this.addComponentCallbackListener(this.btnRemove2,n.EventType.CLICK,(function(){t.onRemoveClick()}))},c.registerUpdateHandler=function(){this.addEvent(I.OnFateInfoUpdate,this.onAfterOpen,this)},c.onAfterOpen=function(){this.fateInfo=this.openArgs[0];var t=this.openArgs[1];if("number"!=typeof this.fateInfo){if(this.loadIcon(this.imgIcon,"icon_fate",this.fateInfo.cfg.icon,null,f.ICON_SPRITE),this.txtName.string=this.fateInfo.cfg.name,this.txtLev.string="Lv."+this.fateInfo.lv,this.btnReset.active=this.fateInfo.cfg.quality>=v.fate_reset_quality&&this.fateInfo.lv>1,this.fateInfo.skill){this.skillNode.active=!0,this.imgIcon.node.setPosition(-190,25);var e=configSkill.getDataByKey(this.fateInfo.skill.skill_id),o=configSkill_level.getDataByKeys("id",e.id,"level",this.fateInfo.skill.skill_lv),n=configColor.getDataByKey(e.quality),s=n.color2,a=h.formatStr.apply(h,[o.desc].concat(o.desc_parm)).replace(/%s/g,s);this.skillName.string=e.name,this.skillQuality.string=d.formatStr("<b><color=%s>%s</color></b>",s,n.name),this.skillDesc.string=d.formatStr("<b><color=#544231>%s</color></b>",a)}else this.skillNode.active=!1,this.imgIcon.node.setPosition(0,25);for(var l,r=[],c=i(this.fateInfo.lv_cfg.attr);!(l=c()).done;){var p=l.value;r.push({type:1,info:p})}for(var g,m=i(this.fateInfo.lv_cfg.skill);!(g=m()).done;){var I=g.value;r.push({type:2,info:I})}var y=configFate_level.getDataByKeys("fate_id",this.fateInfo.cfg_id,"level",this.fateInfo.lv+1);if(y){this.costNode.active=!0,this.btnUpgrade.active=!0;var x=IS(u).getGoodsCountByGoodsGtid(this.fateInfo.lv_cfg.expend[0][0]),b=this.fateInfo.lv_cfg.expend[0][1],k=configGoods.getDataByKey(this.fateInfo.lv_cfg.expend[0][0]);this.loadIcon(this.iconCost,k.icon_group,k.icon),this.txtCost.string=x>=b?d.formatStr("<b><color=#544231>%s/%s</color></b>",x,b):d.formatStr("<b><color=#c74a4a>%s</color><color=#544231>/%s</color></b>",x,b),this.redNode.active=x>=b}else this.btnUpgrade.active=!1,this.costNode.active=!1;var S=[];if(y){for(var V,_=i(y.attr);!(V=_()).done;){var N=V.value;S.push({type:1,info:N})}for(var L,G=i(y.skill);!(L=G()).done;){var D=L.value;S.push({type:2,info:D})}}for(var R=0;R<this.attrItems.length;R++)0==R?this.attrItems[R].show({isLev:!0,curValue:this.fateInfo.lv,isMax:null==y}):this.attrItems[R].show({isLev:!1,curValue:r[R-1],nextValue:S[R-1],isMax:null==y});var B=!1,M=IS(C).GetPosInfo();for(var w in M){if(M.hasOwnProperty(w))if(M[w].id==this.fateInfo.id){B=!0;break}}if(t)return this.costNode.active=!1,this.oprateNode.active=!1,this.oprateNode2.active=!0,this.btnSet.active=1==t,this.btnCancel.active=2==t,void(this.btnRemove2.active=B);this.oprateNode.active=!0,this.oprateNode2.active=!1,this.btnRemove.active=B,this.btnWear.active=!B}else{var K=this.openArgs[1];this.oprateNode.active=!1,this.oprateNode2.active=!1,this.costNode.active=!1,this.skillNode.active=!1,this.btnReset.active=!1,this.imgIcon.node.setPosition(0,25);var F=configFate.getDataByKey(this.fateInfo),E=configFate_level.getDataByKeys("fate_id",F.fate_id,"level",K);this.loadIcon(this.imgIcon,"icon_fate",F.icon,null,f.ICON_SPRITE),this.txtName.string=F.name,this.txtLev.string="Lv."+E.level;for(var T,U=[],A=i(E.attr);!(T=A()).done;){var W=T.value;U.push({type:1,info:W})}for(var P,O=i(E.skill);!(P=O()).done;){var Q=P.value;U.push({type:2,info:Q})}for(var q=0;q<this.attrItems.length;q++)0==q?this.attrItems[q].show({isLev:!0,curValue:K,isGoods:!0}):this.attrItems[q].show({isLev:!1,curValue:U[q-1],isGoods:!0})}},c.onBeforeClose=function(){},c.onDestroy=function(){},c.onUpgradeClick=function(){IS(u).getGoodsCountByGoodsGtid(this.fateInfo.lv_cfg.expend[0][0])>=this.fateInfo.lv_cfg.expend[0][1]?IS(m).send_35_3(this.fateInfo.id):uiMgr.openView("ItemGetWayView",this.fateInfo.lv_cfg.expend[0][0])},c.onWearClick=function(){var t=IS(C).CheckSameUseType(this.fateInfo.id);if(t)return IS(m).send_35_2(0,t,this.fateInfo.id),void this.close();var e=IS(C).GetEmptyPos();if(e)return IS(m).send_35_2(0,e,this.fateInfo.id),void this.close();normalEvent.emit(I.FateSelectWear,this.fateInfo.id),this.close()},c.onRemoveClick=function(){var t=IS(C).GetWearPos(this.fateInfo.id);t&&IS(m).send_35_2(1,t,this.fateInfo.id),this.close()},o}(y));var x=function(){function t(){this.view=void 0,this.node=void 0,this.txtName=void 0,this.curValue=void 0,this.nextValue=void 0,this.maxValue=void 0,this.img=void 0}var e=t.prototype;return e.init=function(t,e){this.view=e,this.node=t,this.onInit()},e.onInit=function(){this.txtName=c.findChildComponent(this.node,"txtName",a),this.curValue=c.findChildComponent(this.node,"curValue",a),this.nextValue=c.findChildComponent(this.node,"nextValue",a),this.maxValue=c.findChildComponent(this.node,"maxValue",a),this.img=c.findChild(this.node,"img")},e.show=function(t){if(t.isLev)this.curValue.node.active=!t.isMax&&!t.isGoods,this.nextValue.node.active=!t.isMax&&!t.isGoods,this.img.active=!t.isMax&&!t.isGoods,this.maxValue.node.active=t.isMax||t.isGoods,t.isMax?this.maxValue.string="MAX":t.isGoods?this.maxValue.string=t.curValue:(this.curValue.string=t.curValue,this.nextValue.string=t.curValue+1);else{var e=t.curValue,i=t.nextValue;if(e)if(this.node.active=!0,this.curValue.node.active=!t.isMax&&!t.isGoods,this.nextValue.node.active=!t.isMax&&!t.isGoods,this.img.active=!t.isMax&&!t.isGoods,this.maxValue.node.active=t.isMax||t.isGoods,t.isMax||t.isGoods)if(1==e.type){var o=e.info[0],n=configAttribute.getDataByKey(o);this.txtName.string=n.desc,this.maxValue.string=IS(g).getAttrValueShow(o,e.info[1])}else{var s=configSkill.getDataByKey(e.info[0]),a=configSkill_level.getDataByKeys("id",s.id,"level",e.info[1]);this.txtName.string=s.name,this.maxValue.string=h.formatStr.apply(h,[a.desc].concat(a.desc_parm))}else if(1==e.type){var l=e.info[0],r=configAttribute.getDataByKey(l);this.txtName.string=r.desc,this.curValue.string=IS(g).getAttrValueShow(l,e.info[1]),this.nextValue.string=IS(g).getAttrValueShow(l,i.info[1])}else{var d=configSkill.getDataByKey(e.info[0]),c=configSkill_level.getDataByKeys("id",d.id,"level",e.info[1]);this.txtName.string=d.name,this.curValue.string=h.formatStr.apply(h,[c.desc].concat(c.desc_parm));var f=configSkill_level.getDataByKeys("id",d.id,"level",i.info[1]);this.nextValue.string=h.formatStr.apply(h,[f.desc].concat(f.desc_parm))}else this.node.active=!1}},t}();o._RF.pop()}}}));

