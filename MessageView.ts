System.register("chunks:///_virtual/MessageView.ts",["cc","./EaseMethod.ts","./NodeUtil.ts","./StorageUtil.ts","./StringUtil.ts","./TimeUtil.ts","./UIDefine.ts","./SpineSkeleton.ts","./UIEffectAsset.ts","./ConfigGlobal.ts"],(function(t){"use strict";var i,n,o,e,s,l,h,a,p,r,d,c,x,T,g,u,f,C,v,m,b,S;return{setters:[function(t){i=t.cclegacy,n=t.math,o=t.Button,e=t.Label,s=t.sys,l=t.Toggle,h=t.RichText,a=t.UITransform,p=t.Node,r=t.js,d=t.Prefab,c=t.HorizontalTextAlignment,x=t.Animation},function(t){T=t.EasingMethod},function(t){g=t.default},function(t){u=t.default},function(t){f=t.default},function(t){C=t.default},function(t){v=t.ViewType},function(t){m=t.SpineSkeleton},function(t){b=t.UIEffectAsset},function(t){S=t.ConfigGlobal}],execute:function(){i._RF.push({},"b532fneJllFJajrkVRe+hiC","MessageView",void 0);var B=n.Vec3,y=n.Vec2,A=t("TYPE_CLOSE","type_close"),w=t("TYPE_YES","type_yes"),I=t("TYPE_CANCEL","type_cancel"),L=(t("TYPE_THIRD","type_third"),t("default",function(){function t(){var t=this;this.node=void 0,this.isInited=void 0,this.flyTipDict=void 0,this.lastFlyTipPosY=void 0,this.curFlyTipCount=void 0,this.boxtipArgs=void 0,this.fightTipArgs=void 0,this.nextTipArgs=void 0,this.isDispose=void 0,this.scrollTipsArray=void 0,this.scrollTweenerList=void 0,this.scrollLabelList=void 0,this.rollPixelPerFrame=void 0,this.nodeFlyTips=void 0,this.nodeFlyParent=void 0,this.nodeFlyItem=void 0,this.nodeFightTips=void 0,this.fightItem=void 0,this.nodeBoxTips=void 0,this.btnBoxTipsMask=void 0,this.txtBoxTipsTitle=void 0,this.nodeBoxTipsContent=void 0,this.txtBoxTipsContent=void 0,this.txtBoxTipsContentSmall=void 0,this.txtBoxTipsContentBig=void 0,this.txtBoxTipsContentContent=void 0,this.txtBoxTipsTog=void 0,this.nodeBoxTipsButtons=void 0,this.btnBoxTipsEnsure=void 0,this.txtBoxTipsEnsure=void 0,this.btnBoxTipsCancel=void 0,this.txtBoxTipsCancel=void 0,this.nodeSpecail=void 0,this.txtSpecailContent1=void 0,this.nodeSpecailIcon2=void 0,this.txtSpecailContent2=void 0,this.nodeSpecailIcon3=void 0,this.txtSpecailContent3=void 0,this.txtSpecailContent4=void 0,this.nodeSpecail_2=void 0,this.txtSpecailContent2_2=void 0,this.nodeRollTips=void 0,this.txtScrollText=void 0,this.nodeScrollView=void 0,this.txtScrollDesc=void 0,resourceMgr.loadRes("ui/module/common/MessageView",d,(function(i){t.node=nodeInstantiate.instantiate(i.item.asset),t.onInit()})),this.isInited=!1,this.flyTipDict=new Array,this.lastFlyTipPosY=0,this.curFlyTipCount=0,this.scrollTipsArray=new Array,this.scrollTweenerList=new Array,this.scrollLabelList=new Array,this.rollPixelPerFrame=80}var i=t.prototype;return i.onInit=function(){var t=this,i=this.node;this.isDispose=!1,this.nodeFlyTips=g.findChild(i,"flyTips"),this.nodeFlyParent=g.findChild(i,"flyTips/parent"),this.nodeFlyItem=g.findChild(i,"flyTips/flyItem"),this.nodeBoxTips=g.findChild(i,"boxTips"),this.btnBoxTipsMask=g.findChild(i,"boxTips/imgMask"),this.btnBoxTipsMask.on(o.EventType.CLICK,(function(){t.onBoxTipsMaskClick()})),this.nodeBoxTipsContent=g.findChild(i,"boxTips/dialog"),this.txtBoxTipsContentBig=g.findChild(i,"boxTips/dialog/content/ScrollView"),this.txtBoxTipsTitle=g.findChildComponent(i,"boxTips/dialog/title/txtTitle",e),this.txtBoxTipsContentSmall=g.findChildComponent(i,"boxTips/dialog/content/txtContent",e),this.txtBoxTipsContent=g.findChildComponent(i,"boxTips/dialog/content/ScrollView/view/content/item",e),s.uiMirror?this.txtBoxTipsContent.isBold=!1:this.txtBoxTipsContent.isBold=!0,this.txtBoxTipsContentContent=g.findChild(i,"boxTips/dialog/content/ScrollView/view/content"),this.txtBoxTipsTog=g.findChildComponent(i,"boxTips/dialog/content/todayTog",l);var n=g.findChild(i,"boxTips/dialog/content/todayTog/Checkmark");s.uiMirror&&n.setScale(-1,1,1),this.nodeBoxTipsButtons=g.findChild(i,"boxTips/dialog/content/buttons"),this.btnBoxTipsEnsure=g.findChild(i,"boxTips/dialog/content/buttons/btnEnsure"),this.btnBoxTipsEnsure.on(o.EventType.CLICK,(function(){t.onBoxTipsEnsureClick()})),this.txtBoxTipsEnsure=g.findChildComponent(i,"boxTips/dialog/content/buttons/btnEnsure/Label",e),this.btnBoxTipsCancel=g.findChild(i,"boxTips/dialog/content/buttons/btnCancel"),this.btnBoxTipsCancel.on(o.EventType.CLICK,(function(){t.onBoxTipsCancelClick()})),this.txtBoxTipsCancel=g.findChildComponent(i,"boxTips/dialog/content/buttons/btnCancel/Label",e),this.nodeSpecail=g.findChild(i,"boxTips/dialog/content/specailContent1"),this.txtSpecailContent1=g.findChildComponent(i,"boxTips/dialog/content/specailContent1/txtContent1",e),this.txtSpecailContent2=g.findChildComponent(i,"boxTips/dialog/content/specailContent1/txtContent2",e),this.nodeSpecailIcon2=g.findChild(i,"boxTips/dialog/content/specailContent1/imgCoin2"),this.nodeSpecailIcon3=g.findChild(i,"boxTips/dialog/content/specailContent1/imgCoin3"),this.txtSpecailContent3=g.findChildComponent(i,"boxTips/dialog/content/specailContent1/txtContent3",e),this.txtSpecailContent4=g.findChildComponent(i,"boxTips/dialog/content/specailContent1/txtContent4",e),this.nodeSpecail_2=g.findChild(i,"boxTips/dialog/content/specailContent2"),this.txtSpecailContent2_2=g.findChildComponent(i,"boxTips/dialog/content/specailContent2/txtContent2",e),this.nodeFlyTips.active=!0,this.isInited=!0,null!=this.boxtipArgs&&this.tryShowBoxTip(this.boxtipArgs),this.node.parent=uiMgr.pNodes[v.TopView],this.nodeRollTips=g.findChild(i,"rollTips"),this.txtScrollText=g.findChild(i,"rollTips/txtTitle"),this.txtScrollDesc=g.findChild(i,"rollTips/txtDesc"),this.nodeScrollView=g.findChild(i,"rollTips/nodeView"),this.nodeFightTips=g.findChild(i,"fightTips"),this.nodeFightTips.active=!0,this.fightItem=new L,this.fightItem.init(g.findChild(i,"fightTips/fightItem"),this),null!=this.fightTipArgs&&this.tryShowFight(this.fightTipArgs)},i.clear=function(){this.isDispose=!0},i.GetEnsureNode=function(){return this.btnBoxTipsEnsure},t.showFlyTip=function(i,n,o){void 0===n&&(n=!1);var e=IS(t);if(1!=e.isDispose){e.flyTipDict.length>=10&&e.flyTipDict.shift();var s={tip:i,play_sound:n,otherArg:o};e.flyTipDict.push(s)}},t.update=function(i){var n=IS(t,!1);null!=n&&(n.doShowFlyTip(),n.doScrollTips())},i.doShowFlyTip=function(){if(0==this.isInited)return!1;var t,i=this.flyTipDict.length,n=.2,o=.15;if(!(i>0))return!1;var e=this.flyTipDict.shift();t=e.tip,1==e.play_sound&&e.play_sound,n=null!=e.otherArg?e.otherArg.time1:.2,o=null!=e.otherArg?e.otherArg.time2:.15;var s=-1*this.lastFlyTipPosY,l=nodeInstantiate.instantiate(this.nodeFlyItem);this.curFlyTipCount=this.curFlyTipCount+1,l.parent=this.nodeFlyParent,l.setScale(new B(.2,.2,.2)),l.setPosition(new B(0,s,0)),l.active=!0;var p=g.findChildComponent(l,"imgBg/txtContent",h);p.string=t;var r=g.findChildComponent(l,"imgBg",a);return r.scheduleOnce((function(){r.height=p.getComponent(a).height}),0),normalTween.to(0,1,n,(function(t,i){l.setScale(i,i,i)})).easing(T.BACK_OUT).call((function(){normalTween.to(1,0,o,(function(t,i){l.setScale(i,i,i)})).easing(T.QUAD_IN).call((function(){l.destroy()}),.1).start()}),.5).start(),!0},t.showBoxTip=function(i,n){var o,e,s,l,h,a,p,r,d,x=IS(t);if(1!=x.isDispose&&null!=x.node){var T={tip:i.tip,func:i.func,ensure:null!=(o=i.ensure)?o:GetLanguage(200129),cancel:null!=(e=i.cancel)?e:GetLanguage(200054),btnCnt:null!=(s=i.btnCnt)?s:2,checkFunc:i.checkFunc,title:"",exchange:null!=(l=i.exchange)&&l,todayTog:null!=(h=i.todayTog)?h:"",isSpecail:null!=(a=i.isSpecail)&&a,specialType:null!=(p=i.specialType)?p:null,specailInfo:i.specailInfo,horizontalAlign:null!=(r=i.horizontalAlign)?r:c.CENTER,notMaskClick:null!=(d=i.notMaskClick)&&d};null!=i.title&&""!=i.title?T.title=i.title:T.title=GetLanguage(200048),x.tryShowBoxTip(T),x.node.parent=null==n?uiMgr.pNodes[v.TopView]:n}},i.tryShowBoxTip=function(t){var i=this;null==this.boxtipArgs||t.tip==this.boxtipArgs.tip?(this.boxtipArgs=t,1!=this.isDispose&&(this.txtBoxTipsContent.node.on(p.EventType.SIZE_CHANGED,(function(){var t=i.txtBoxTipsContent.getComponent(a).height;i.txtBoxTipsContentContent.getComponent(a).height=t,i.boxtipArgs.isSpecail||i.boxtipArgs.specialType?normalTimer.start(.01,1,(function(){i.txtBoxTipsContentSmall.node.active=!1,i.txtBoxTipsContentBig.active=!1})):t<=200?normalTimer.start(.01,1,(function(){i.txtBoxTipsContentSmall.node.active=!0,i.txtBoxTipsContentBig.active=!1})):normalTimer.start(.01,1,(function(){i.txtBoxTipsContentBig.active=!0,i.txtBoxTipsContentSmall.node.active=!1}))})),this.doShowBoxTip())):this.nextTipArgs=t},i.doShowBoxTip=function(){var t=this;if(0!=this.isInited&&null!=this.nodeBoxTips&&0!=this.nodeBoxTips.isValid){var i,n=this.boxtipArgs.todayTog;if(""!=n){if(this.txtBoxTipsTog.node.active=!0,this.txtBoxTipsTog.isChecked=!1,(null!=(i=u.get(n))?i:"")==C.formatDate(new Date(1e3*C.serverTime),"MMdd"))return void this.onBoxTipsEnsureClick()}else this.txtBoxTipsTog.node.active=!1;this.nodeBoxTips.active=!0,this.txtBoxTipsTitle.string=this.boxtipArgs.title;var o=this.boxtipArgs.tip||"";if(this.txtBoxTipsContentSmall.string=o,this.txtBoxTipsContentSmall.horizontalAlign=this.boxtipArgs.horizontalAlign,this.txtBoxTipsContent.string=o,this.txtBoxTipsContent.horizontalAlign=this.boxtipArgs.horizontalAlign,this.txtBoxTipsContentContent.getComponent(a).height>200&&(this.txtBoxTipsContentSmall.node.active=!1),this.txtBoxTipsContentSmall.updateRenderer(),this.txtBoxTipsContent.updateRenderer(),(this.boxtipArgs.isSpecail||this.boxtipArgs.specialType)&&normalTimer.start(.01,1,(function(){t.txtBoxTipsContentSmall.node.active=!1,t.txtBoxTipsContentBig.active=!1})),this.nodeSpecail.active=this.boxtipArgs.isSpecail,this.boxtipArgs.isSpecail){var e=this.boxtipArgs.specailInfo;this.txtSpecailContent1.string=e.content1,this.txtSpecailContent2.string=e.content2,this.txtSpecailContent3.string=e.content3,this.txtSpecailContent4.string=e.content4,this.nodeSpecailIcon2.active=1012==e.goodsGtid,this.nodeSpecailIcon3.active=1013==e.goodsGtid}if(this.boxtipArgs.specialType){this.nodeSpecail_2.active=!0;var s=this.boxtipArgs.specailInfo;this.txtSpecailContent2_2.string=s.content2}else this.nodeSpecail_2.active=!1;var l=this.boxtipArgs.btnCnt;this.btnBoxTipsEnsure.active=l>=1,this.btnBoxTipsCancel.active=2==l,this.txtBoxTipsEnsure.string=this.boxtipArgs.ensure,this.txtBoxTipsCancel.string=this.boxtipArgs.cancel}},i.closeBoxTip=function(t){if(this.txtBoxTipsContent.string="",this.txtBoxTipsContentSmall.node.active=!0,null==this.boxtipArgs.func||null!=this.boxtipArgs.checkFunc&&!this.boxtipArgs.checkFunc(t))this.nodeBoxTips.active=!1,this.boxtipArgs=null;else if(null==this.nextTipArgs){this.nodeBoxTips.active=!1;var i=this.boxtipArgs.func;if(i(t),t==w&&this.txtBoxTipsTog.isChecked&&""!=this.boxtipArgs.todayTog){var n=C.formatDate(new Date(1e3*C.serverTime),"MMdd");u.set(this.boxtipArgs.todayTog,n)}this.boxtipArgs=null,i=null}else{var o=this.boxtipArgs.func;if(this.boxtipArgs=this.nextTipArgs,o(t),t==w&&this.txtBoxTipsTog.isChecked&&""!=this.boxtipArgs.todayTog){var e=C.formatDate(new Date(1e3*C.serverTime),"MMdd");u.set(this.boxtipArgs.todayTog,e)}this.nextTipArgs=null,o=null,this.doShowBoxTip()}},i.onBoxTipsMaskClick=function(){if(0==this.isDispose){if(this.boxtipArgs.notMaskClick)return;this.closeBoxTip(A)}},i.onBoxTipsEnsureClick=function(){0==this.isDispose&&this.closeBoxTip(this.boxtipArgs.exchange?I:w)},i.onBoxTipsCancelClick=function(){0==this.isDispose&&this.closeBoxTip(this.boxtipArgs.exchange?w:I)},t.showRollTip=function(i){var n=IS(t);if(1!=n.isDispose){var o={tip:i};n.scrollTipsArray.push(o)}},i.doScrollTips=function(){var t=this;if(0==this.isInited)return!1;if(!(this.scrollTipsArray.length<=0||this.scrollLabelList.length>1)){this.nodeRollTips.active=!0;var i=nodeInstantiate.instantiate(this.txtScrollDesc),n=this.scrollTipsArray.shift(),o=this.nodeScrollView.getComponent(a).contentSize;i.getComponent(e).string=n.tip,i.getComponent(e).updateRenderer();var s=i.getComponent(a).contentSize;if(i.setParent(this.nodeScrollView),0==this.scrollLabelList.length)var l=new B(o.width,0);else{var h=this.scrollLabelList[0].getComponent(a).contentSize,p=this.scrollLabelList[0].getPosition();l=new B(p.x+h.width+100,0)}var r=new B(Math.max(l.x,o.width)),d=new B;i.setPosition(Math.max(l.x,o.width),0);var c=(l.x+s.width)/this.rollPixelPerFrame,x=normalTween.to(1,0,c,(function(t,n){d.set(r).add3f(-(r.x+s.width+20)*(1-n),0,0),i.position=d})).call((function(){t.scrollLabelList.shift(),t.scrollTweenerList.shift(),0==t.scrollLabelList.length&&(t.nodeRollTips.active=!1)})).start();return this.scrollTweenerList.push(x),this.scrollLabelList.push(i),!0}},t.showFightTip=function(i){var n=IS(t);1!=n.isDispose&&n.tryShowFight(i)},i.tryShowFight=function(t){this.fightTipArgs=t,1!=this.isDispose&&this.showFight(this.fightTipArgs)},i.showFight=function(t){if(0==this.isInited)return!1;null!=t&&this.fightItem.show(t)},i.showEquipBoxShowEffect=function(t,i,n){var o=b.alloc("prefab/ui-effect/MX_tx_zhuangyuan_zimu_zizhi_2",this.node,1.5,(function(o){var s=o.node;g.findChildComponent(s,"MX_tx_zhuangyuan_zimu",m).needAnimation="hulu";var l=g.findChildComponent(s,"flyLabel/flyLabelDesc",e),h=configColor.getDataByKey(t);l.string=f.formatStrWithMirrorDeal(GetLanguage_UI(899000001),h.name);var a=g.findChildComponent(s,"flyLabel/flyOriNum",e),p=g.findChildComponent(s,"flyLabel/flyNowNum",e);a.string=r.formatStr("%s%",i/100),p.string=r.formatStr("%s%",n/100)}));o.position=new y(0,350),o.scale=1,o.depth=20},t.onEquipBoxShowEffect=function(i,n,o){var e=IS(t);1!=e.isDispose&&e.showEquipBoxShowEffect(i,n,o)},i.showLevelUpShowEffect=function(t,i){var n=b.alloc("prefab/ui-effect/MX_tx_zhuangyuan_zimu_zizhi_2",this.node,1.5,(function(n){var o=n.node;g.findChildComponent(o,"MX_tx_zhuangyuan_zimu",m).needAnimation="hulu",g.findChildComponent(o,"flyLabel/flyLabelDesc",e).string=GetLanguage_UI(899000002);var s=g.findChildComponent(o,"flyLabel/flyOriNum",e),l=g.findChildComponent(o,"flyLabel/flyNowNum",e);s.string=String(t),l.string=String(i)}));n.position=new y(0,350),n.scale=1,n.depth=20},t.onLevelUpShowEffect=function(i,n){var o=IS(t);1!=o.isDispose&&o.showLevelUpShowEffect(i,n)},t}()),function(){function t(){this.view=void 0,this.node=void 0,this.txtAdd=void 0,this.txtMinus=void 0,this.curTimer=void 0,this.anim=void 0}var i=t.prototype;return i.init=function(t,i){this.view=i,this.node=t,this.node.active=!1,this.onInit()},i.onInit=function(){this.txtAdd=g.findChildComponent(this.node,"txtAdd",e),this.txtMinus=g.findChildComponent(this.node,"txtMinus",e),this.anim=this.node.getComponent(x)},i.show=function(t){var i=this;null!=this.curTimer&&(this.node.active=!1,normalTimer.stop(this.curTimer),this.curTimer=null),this.node.active=!0,this.anim.play("MessageView_fightltem"),t>=0?(this.txtAdd.node.active=!0,this.txtMinus.node.active=!1,this.txtAdd.string="+"+f.GetNumString(t)):(this.txtAdd.node.active=!1,this.txtMinus.node.active=!0,this.txtMinus.string="-"+f.GetNumString(Math.abs(t)));var n=S.word_stay_time/1e3;this.curTimer=normalTimer.start(n,1,(function(){i.node.active=!1,normalTimer.stop(i.curTimer),i.curTimer=null}))},t}());i._RF.pop()}}}));

