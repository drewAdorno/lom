System.register("chunks:///_virtual/ReturnTaskView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./ChapterDataCache.ts","./MessageView.ts","./GuildControl.ts","./MainViewModel.ts","./RoleDataCache.ts","./ActivityDefine.ts","./ReturnControl.ts","./ReturnDataCache.ts","./ReturnDefine.ts","./BaseSubView.ts"],(function(t){"use strict";var e,i,n,s,o,r,a,d,c,u,h,f,l,m,v,g,p,T,C,G,k,w,I,S;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,n=t.Label,s=t.ScrollView,o=t.sys,r=t.ProgressBar,a=t.Button,d=t.js},function(t){c=t.ItemGrid},function(t){u=t.ListItem},function(t){h=t.default},function(t){f=t.default},function(t){l=t.default},null,function(t){m=t.ChapterDataCache},function(t){v=t.default},function(t){g=t.default},function(t){p=t.MainViewModel},function(t){T=t.RoleDataCache},function(t){C=t.ActivityTaskState},function(t){G=t.default},function(t){k=t.ReturnDataCache},function(t){w=t.ReturnEventDefine,I=t.ReturnTaskType},function(t){S=t.BaseSubView}],execute:function(){i._RF.push({},"0d484ecMN1PHb5onc5Wkhdc","ReturnTaskView",void 0);t("default",function(t){function i(){var e;return(e=t.call(this)||this).taskList=void 0,e.txtLeftTime=void 0,e.timer=void 0,e.name="ReturnTaskView",e.url="ui/module/return/ReturnTaskView",e}e(i,t);var r=i.prototype;return r.onInit=function(){this.txtLeftTime=this.findChildComponent("root/banner/time",n);var t=this.findChildComponent("root/taskList",s);this.taskList=this.addUIList(t,L)},r.registerUpdateHandler=function(){this.addEvent(w.UpdatReturnTaskInfo,this.OnTaskUpdate,this)},r.onAfterOpen=function(){IS(G).send_return_task_c2s(I.ReturnTask),this.OnTaskUpdate(),this.UpdateTime()},r.UpdateTime=function(){var t=this;this.timer&&(this.removeTimer(this.timer),this.timer=null);var e=IS(k).GetReturnInfo();if(e&&e.end_time-l.serverTime>0){var i=f.formatStrWithMirrorDeal(GetLanguage(200043),l.formatTimeStringForSecond(Math.max(0,e.end_time-l.serverTime)));o.uiMirror&&(i=l.formatTimeStringForSecond(Math.max(0,e.end_time-l.serverTime))),this.txtLeftTime.string=i,this.timer=this.addTimer(1,e.end_time-l.serverTime,(function(){if(e.end_time-l.serverTime>0){var i=f.formatStrWithMirrorDeal(GetLanguage(200043),l.formatTimeStringForSecond(Math.max(0,e.end_time-l.serverTime)));o.uiMirror&&(i=l.formatTimeStringForSecond(Math.max(0,e.end_time-l.serverTime))),t.txtLeftTime.string=i}else t.removeTimer(t.timer),t.timer=null,t.txtLeftTime.string=GetLanguage(200026)}))}else this.txtLeftTime.string=GetLanguage(200026)},r.onBeforeClose=function(){this.timer&&(this.removeTimer(this.timer),this.timer=null)},r.onDestroy=function(){},r.OnTaskUpdate=function(){for(var t=[],e=configBack_task.getDatas(),i=[],n=IS(k).GetReturnDay(),s=0;s<e.length;s++){var o=IS(k).GetReturnTaskInfo(I.ReturnTask,e[s].id);if(o)t.push({cfg:e[s],state:o.state,count:o.count});else IS(k).checkReturnDay(n,e[s])&&i.push({cfg:e[s],state:C.Normal,count:0,isLock:!0})}t.sort((function(t,e){return t.state==C.CanGet&&e.state!=C.CanGet?-1:t.state!=C.CanGet&&e.state==C.CanGet?1:t.state!=e.state?t.state-e.state:t.id-e.id}));for(var r=0;r<i.length;r++)t.push(i[r]);this.taskList.datas=t},i}(S));var L=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))||this).txtDesc=void 0,e.btnGet=void 0,e.received=void 0,e.undone=void 0,e.pb=void 0,e.schedule=void 0,e.itemGridNode=void 0,e.itemGrid=void 0,e.lockItem=void 0,e.infoItem=void 0,e.lockTime=void 0,e.btnGo=void 0,e}e(i,t);var s=i.prototype;return s.onInit=function(){var t=this;this.lockItem=h.findChild(this.node,"lock"),this.lockTime=h.findChildComponent(this.node,"lock/unlockTime",n),this.infoItem=h.findChild(this.node,"info"),this.itemGridNode=h.findChild(this.node,"info/itemGrid"),this.itemGrid=new c(this.view,this.itemGridNode),this.txtDesc=h.findChildComponent(this.node,"info/txtDesc",n),this.pb=h.findChildComponent(this.node,"info/ProgressBar",r),this.schedule=h.findChildComponent(this.node,"info/ProgressBar/schedule",n),this.received=h.findChild(this.node,"info/received"),this.undone=h.findChild(this.node,"info/undone"),this.btnGet=h.findChild(this.node,"info/btnGet"),this.view.addComponentCallbackListener(this.btnGet,a.EventType.CLICK,(function(){IS(G).send_return_task_reward_c2s(I.ReturnTask,t.data.cfg.id)})),this.btnGo=h.findChild(this.node,"info/btnGoto"),this.view.addComponentCallbackListener(this.btnGo,a.EventType.CLICK,(function(){if(!(t.data.cfg.day>IS(k).returnTaskDay)){var e=t.data.cfg.access;if(null!=e&&0!=e){var i=configGoods_source.getDataByKey(e);if(IS(m).curChapterId>i.chapter_id){if(""!=i.view)if("MainView"==i.view)IS(p).TryJumpToMainViewPanel(i.openArgs[0],i.openArgs[1],i.openArgs[2]);else{if(("GuildDonateView"==i.view||"SingleEnterView"==i.view)&&!IS(T).HasGuild())return void v.showFlyTip(GetLanguage(200165));if("SingleEnterView"==i.view)IS(g).send_29_21(1);else{var n,s=i.openArgs.slice(0);(n=uiMgr).openView.apply(n,[i.view].concat(s))}}t.view.parentView.close()}}}}))},s.onRender=function(t,e){this.txtDesc.string=t.cfg.type,this.itemGrid.SetItemId(t.cfg.reward[0][0],t.cfg.reward[0][1]),this.schedule.string=d.formatStr("%s/%s",t.count,t.cfg.condition[2]),this.pb.progress=t.count/t.cfg.condition[2],t.state==C.CanGet?(this.received.active=!1,this.undone.active=!1,this.btnGet.active=!0,this.btnGo.active=!1):t.state==C.HadGet?(this.received.active=!0,this.undone.active=!1,this.btnGet.active=!1,this.btnGo.active=!1):(this.received.active=!1,this.undone.active=!1,this.btnGo.active=!0,this.btnGet.active=!1),t.isLock?(this.lockItem.active=!0,this.lockTime.string=f.formatStrWithMirrorDeal(GetLanguage(204671),t.cfg.day-IS(k).returnTaskDay)):this.lockItem.active=!1},i}(u);i._RF.pop()}}}));

