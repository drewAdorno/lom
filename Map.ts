System.register("chunks:///_virtual/Map.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AssetPool.ts","./BaseAsset.ts","./MapData.ts","./MapTileMgr.ts"],(function(t){"use strict";var e,i,o,s,a,n,r,h,l,d,u,c;return{setters:[function(t){e=t.createClass},function(t){i=t.cclegacy,o=t.Vec2,s=t.BufferAsset,a=t.Node,n=t.isValid,r=t.Rect,h=t.screen},function(t){l=t.AssetPoolState},function(t){d=t.LoadState},function(t){u=t.MapData},function(t){c=t.MapTileMgr}],execute:function(){i._RF.push({},"57177wOyutLda1xR1BvtxLM","Map",void 0);var _=new o;t("Map",function(){function t(){this.freeTime=void 0,this.url=void 0,this.poolState=void 0,this.pool=void 0,this._loadState=d.Not,this._loadCb=void 0,this._root=void 0,this._parent=void 0,this.name=void 0,this.data=void 0,this.mapTileMgr=void 0,this.showBossId=new Set,this._viewCenter=new o,this._size=new r,this.data=new u;var t=800/h.windowSize.height*h.windowSize.width;_.set(1.5*t*2,2400),this._size.width=25e3,this._size.height=1e4,this._size.center=new o(0,0)}var i=t.prototype;return i.loadSync=function(){return!(this.poolState>l.Useing)&&(null!=this.url&&(this._loadState==d.Not&&(this._loadState=d.Ready,this.resLoad(),!0)))},i.resLoad=function(){var t=this;this._loadState==d.Ready&&(this._loadState=d.Loading,this._loadCb=function(e){if(t._loadState=d.Finish,t._loadCb=null,!e.error&&null!=e.item&&null!=e.item.asset){var i=e.item.asset;t.data.loadData(i),t.onLoadDataComplete()}},resourceMgr.loadRes(this.url,s,this._loadCb))},i.onLoadDataComplete=function(){this.mapTileMgr=new c(this),this.initRoot(),this.updateViewCenter(this._viewCenter.x,this._viewCenter.y)},i.initRoot=function(){this._root=new a("map-"+this.name),null!=this._parent&&(this._root.parent=this._parent)},i.updateViewCenter=function(t,e,i){void 0===i&&(i=!1),this._viewCenter.set(t,e),this.mapTileMgr&&this.mapTileMgr.updateTileCenter(this._viewCenter,_,i)},i.destroy=function(){this.poolState!=l.Destroy&&(this.poolState=l.Destroy,this._loadState!=d.Finish?(this._loadState==d.Loading&&resourceMgr.cancelLoadRes(this.url,this._loadCb),this._loadCb=null):(this._loadState==d.Finish&&resourceMgr.releaseResRef(this.url),this._loadState=d.Ready),n(this._root)&&(this._root.destroy(),this._root=null),this.url=null)},i.free=function(){this.poolState==l.Useing&&this.pool.free(this)},i.cacheUse=function(){n(this._root)&&(this._root.active=!0)},i.onAfterCacheFree=function(){this._loadState!=d.Finish&&(this._loadState==d.Loading&&resourceMgr.cancelLoadRes(this.url,this._loadCb),this._loadCb=null,this._loadState=d.Not)},i.cacheReset=function(){this.showBossId.clear(),n(this._root)&&(this._root.active=!1)},i.update=function(){this.mapTileMgr&&this.mapTileMgr.update()},i.getData=function(){return this.data},e(t,[{key:"root",get:function(){return this._root}},{key:"parent",set:function(t){this._parent=t,this._root&&(this._root.parent=t)}},{key:"box",get:function(){return this._size}}]),t}());i._RF.pop()}}}));

