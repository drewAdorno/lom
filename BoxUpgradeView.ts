System.register("chunks:///_virtual/BoxUpgradeView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./V2.ts","./AudioMgr.ts","./RedPoint.ts","./RedPointMgr.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./BaseView.ts","./ConfigGlobal.ts","./AdDefine.ts","./AdModel.ts","./BagDefine.ts","./BagModel.ts","./GuideModel.ts","./MessageView.ts","./EquipControl.ts","./EquipDefine.ts","./EquipModel.ts","./GuildControl.ts","./GuildDataCache.ts","./GuildDefine.ts","./MainViewModel.ts","./RoleControl.ts","./RoleDataCache.ts","./RoleDefine.ts","./SdkControl.ts","./EquipDataCache.ts","./UIDefine.ts"],(function(t){"use strict";var e,n,i,o,d,s,a,h,r,l,c,u,g,p,f,m,v,C,I,x,L,b,_,B,S,y,T,A,E,U,w,M,k,G,P,D,N,R,V,F,O,q,H,j,K,z;return{setters:[function(t){e=t.inheritsLoose},function(t){n=t.cclegacy,i=t.math,o=t.UITransform,d=t.Button,s=t.Sprite,a=t.Label,h=t.LabelOutline,r=t.sys,l=t.Layout,c=t.js,u=t.Color,g=t.Widget},function(t){p=t.V2},function(t){f=t.audioMgr},function(t){m=t.RedPointType},function(t){v=t.RedPointMgr},function(t){C=t.default},function(t){I=t.default},function(t){x=t.default},null,function(t){L=t.BaseView},function(t){b=t.ConfigGlobal},function(t){_=t.AdEventDefine,B=t.ADS_TYPE},function(t){S=t.AdModel},function(t){y=t.BagEventDefine},function(t){T=t.BagModel},function(t){A=t.GuideModel},function(t){E=t.default},function(t){U=t.default},function(t){w=t.EquipEventDefine,M=t.BoxChangeType},function(t){k=t.EquipModel},function(t){G=t.default},function(t){P=t.default},function(t){D=t.HelpType,N=t.GuildEventDefine},function(t){R=t.MainViewModel},function(t){V=t.default},function(t){F=t.RoleDataCache},function(t){O=t.RoleEventDefine,q=t.PlayerAttr,H=t.ClientData},function(t){j=t.default},function(t){K=t.EquipDataCache},function(t){z=t.PanelTabType}],execute:function(){var W;n._RF.push({},"3e482oZjZ9OTJwF2HNKzRYk","BoxUpgradeView",void 0);var Q=i.Vec3,J=i.Vec2,X=b.accelerate_goods_effect[0][0],Y=b.accelerate_goods_effect[0][1],Z=b.accelerate_goods_effect[1][0],$=b.accelerate_goods_effect[1][1],tt=b.equip_unlock_condition[0],et=tt[1],nt=tt[2],it=tt[3],ot=b.equip_unlock_condition[1],dt=ot[1],st=ot[2],at=ot[3],ht=b.equip_unlock_condition_show,rt=b.equip_unlock_condition_show2;(W={})[1]=-83.5,W[2]=-120.5,W[3]=-157.5,W[4]=-194.5,W[5]=-231.5,W[6]=-268.5,W[7]=-305.5,W[8]=-342.5,W[9]=-379.5,t("default",function(t){function n(){var e;return(e=t.call(this)||this).utContent=void 0,e.txtAccItemCount=void 0,e.txtGoldCount=void 0,e.curLevelItem=void 0,e.nextLevelItem=void 0,e.maxLevelItem=void 0,e.nodeCurLevel=void 0,e.nodeNextLevel=void 0,e.nodeMaxLevel=void 0,e.nodeLevelRoot=void 0,e.nodeUpgrade=void 0,e.nodeUpgrading=void 0,e.nodeProgressParent=void 0,e.utProgressParent=void 0,e.nodeProgressItem=void 0,e.nodeBtnBuy=void 0,e.txtCost=void 0,e.outLineCost=void 0,e.txtTime=void 0,e.txtNeedTime=void 0,e.nodeTimeIcon=void 0,e.btnHelpImg=void 0,e.nodeBtnUpgrade=void 0,e.imgBtnUpgrade=void 0,e.outLineUpgrade=void 0,e.nodeBtnAcc=void 0,e.nodeBtnAd=void 0,e.nodeMax=void 0,e.txtAdDesc=void 0,e.txtAdCount=void 0,e.nodeAdIcon=void 0,e.expItems=void 0,e.nodeAccItem=void 0,e.boxEtime=void 0,e.time=void 0,e.nodeCondition=void 0,e.nodeLock=void 0,e.nodeLock1=void 0,e.utBox=void 0,e.nodeMask=void 0,e.nodeCondition2=void 0,e.name="BoxUpgradeView",e.url="ui/module/equip/BoxUpgradeView",e}e(n,t);var i=n.prototype;return i.onInit=function(){var t=this;this.time=0,this.boxEtime=0,this.expItems=[];var e=this.findChild("content");this.utContent=e.getComponent(o);var n=this.findChild("imgMask");this.addComponentCallbackListener(n,d.EventType.CLICK,(function(){t.onMaskClick()}));var i=this.findChild("content/btnClose");this.addComponentCallbackListener(i,d.EventType.CLICK,(function(){t.onCloseClick()})),this.nodeAccItem=this.findChild("content/accItem"),this.addComponentCallbackListener(this.nodeAccItem,d.EventType.CLICK,(function(){IS(R).TryJumpToMainViewPanel(z.Main_Shop,z.Shop_Gem,[1]),t.close()}));var c=this.findChildComponent("content/accItem/imgItem",s);this.loadIcon(c,"icon_item","1002");var u=this.findChild("content/goldItem");this.addComponentCallbackListener(u,d.EventType.CLICK,(function(){IS(R).TryJumpToMainViewPanel(z.Main_Shop,z.Shop_Gem,[4]),t.close()}));var g=this.findChildComponent("content/goldItem/imgItem",s);this.loadIcon(g,"main","zjm_ICON_jingbi"),this.txtAccItemCount=this.findChildComponent("content/accItem/txtCount",a),this.txtGoldCount=this.findChildComponent("content/goldItem/txtCount",a),this.nodeCurLevel=this.findChild("content/box/detail/levelInfo/curLevel"),this.nodeNextLevel=this.findChild("content/box/detail/levelInfo/nextLevel"),this.nodeMaxLevel=this.findChild("content/box/detail/levelInfo/maxLevel"),this.nodeLevelRoot=this.findChild("content/box/detail/levelInfo"),this.curLevelItem=this.initLevelInfo(this.nodeCurLevel),this.nextLevelItem=this.initLevelInfo(this.nodeNextLevel),this.maxLevelItem=this.initLevelInfo(this.nodeMaxLevel),this.nodeUpgrade=this.findChild("content/box/detail/upgrade/progress"),this.nodeProgressParent=this.findChild("content/box/detail/upgrade/progress/progressParent"),this.utProgressParent=this.nodeProgressParent.getComponent(o),this.nodeProgressItem=this.findChild("content/box/detail/upgrade/progress/progressParent/progressItem"),this.nodeProgressItem.active=!1,this.nodeUpgrading=this.findChild("content/box/detail/upgrade/upgrading"),this.nodeBtnBuy=this.findChild("content/box/detail/upgrade/progress/btnBuy"),this.addComponentCallbackListener(this.nodeBtnBuy,d.EventType.CLICK,(function(){t.onBuyClick()})),this.addRedPoint("btnBox/btnBuy",this.nodeBtnBuy,new J(85,35),m.Dot),this.txtCost=this.findChildComponent("content/box/detail/upgrade/progress/btnBuy/cost/txtCost",a),this.outLineCost=this.txtCost.node.getComponent(h),r.uiMirror&&(this.dealMirrorLayout(this.findChildComponent("content/box/detail/upgrade/progress/btnBuy/cost",l)),this.dealMirrorLayout(this.findChildComponent("content/box/detail/upgrade/progress/progressParent",l)));var p=this.findChild("content/box/detail/upgrade/upgrading/btnHelp");this.btnHelpImg=this.findChildComponent("content/box/detail/upgrade/upgrading/btnHelp",s),this.addComponentCallbackListener(p,d.EventType.CLICK,(function(){IS(F).HasGuild()?IS(P).IsAskHelp(D.Box,0)?E.showFlyTip(GetLanguage(200252)):IS(G).send_29_29(D.Box,0):E.showFlyTip(GetLanguage(200251))})),this.txtTime=this.findChildComponent("content/box/detail/upgrade/upgrading/time/txtTime",a),this.txtNeedTime=this.findChildComponent("content/box/detail/upgrade/progress/txtTime",a),this.nodeTimeIcon=this.findChild("content/box/detail/upgrade/progress/imgTime"),this.nodeBtnUpgrade=this.findChild("content/box/detail/oprate/btnUpgrade"),this.addComponentCallbackListener(this.nodeBtnUpgrade,d.EventType.CLICK,(function(){t.onUpgradeClick()})),this.addRedPoint("boxUpgradeBtnUpgradeShow",this.nodeBtnUpgrade,new J(95,25),m.Dot),this.imgBtnUpgrade=this.nodeBtnUpgrade.getComponent(s),this.outLineUpgrade=this.findChildComponent("content/box/detail/oprate/btnUpgrade/Label",h),this.nodeBtnAcc=this.findChild("content/box/detail/oprate/btnAcc"),this.addComponentCallbackListener(this.nodeBtnAcc,d.EventType.CLICK,(function(){t.onAccClick()})),this.nodeBtnAd=this.findChild("content/box/detail/oprate/btnAd"),this.addComponentCallbackListener(this.nodeBtnAd,d.EventType.CLICK,(function(){t.onAdClick()})),this.txtAdDesc=this.findChildComponent("content/box/detail/oprate/btnAd/txtAdDesc",a),this.txtAdCount=this.findChildComponent("content/box/detail/oprate/btnAd/txtAdNum",a),this.nodeAdIcon=this.findChild("content/box/detail/oprate/btnAd/imgAd"),this.nodeAdIcon.active=1==b.ads_icon_is_show,this.txtAdCount.node.position=1==b.ads_icon_is_show?new Q(19.7,-48,0):new Q(0,-48,0),this.nodeMax=this.findChild("content/box/detail/upgrade/txtMax"),this.nodeCondition=this.findChild("content/box/detail/condition"),this.nodeLock=this.findChild("content/box/detail/levelInfo/imgLock"),this.nodeLock1=this.findChild("content/box/detail/levelInfo/imgLock1"),this.utBox=this.findChildComponent("content/box",o),this.nodeCondition2=this.findChild("content/box/detail/condition1"),this.nodeMask=this.findChild("mask");var f=this.findChild("mask/btnNext");this.addComponentCallbackListener(f,d.EventType.CLICK,(function(){t.nodeMask.active=!1}));var v=this.findChild("content/btnSkin");this.addComponentCallbackListener(v,d.EventType.CLICK,(function(){IS(k).isAutoOpen?E.showFlyTip(GetLanguage(204528)):IS(k).getEmptyEquipIdList(!1,0).length>0?E.showFlyTip(GetLanguage(204529)):uiMgr.openView("BoxSkinSelectView")}))},i.initLevelInfo=function(t){for(var e=[],n=1;n<=11;n++)e.push(C.findChildComponent(t,c.formatStr("probabilityParent/probabilityItem%s/txtProbability",n),a));return{txtLevel:C.findChildComponent(t,"title/txtLevel",a),txtProbability:e}},i.registerUpdateHandler=function(){this.addEvent(w.BOX_INFO_UPDATE,this.onBoxInfoUpdate,this),this.addEvent(y.GOODS_INFO_UPDATE,this.onGoodsInfoUpdate,this),this.addEvent(_.AD_INFO_UPDATE,this.onAdInfoUpdate,this),this.addEvent(O.ROLE_RES_UPDATE,this.onRoleResUpdate,this),this.addEvent(N.GUILD_HELP_UPDATE,this.updateBtnHelp,this),this.addEvent(O.ROLE_INFO_UPDATE,this.updateLockInfo,this)},i.onAfterOpen=function(){IS(G).send_29_28(2),IS(G).send_29_32(),this.refreshShow(),this.updateAdInfo(),this.updateLockInfo(),IS(v).changeValue("btnBox/btnBuy",IS(K).getBoxProgressRedPoint()),uiMgr.isOpenGuide&&"mask"==IS(A).guideParam&&(this.nodeMask.active=!0)},i.updateLockInfo=function(){var t,e=x.getServerOpenDay(),n=IS(k).getBoxInfo().lv,i=e>=et&&IS(F).GetLevel()>=nt&&n>=it,o=e>=dt&&IS(F).GetLevel()>=st&&n>=at,d=!i&&n>=ht,s=!o&&n>=rt;this.nodeLock.active=!i,this.nodeLock1.active=!o,this.nodeCondition.active=d,this.nodeCondition2.active=s,t=d&&s?723.4:d||s?695.337:667.274,this.utBox.height=t},i.updateUpgradeRedPoint=function(){IS(v).changeValue("boxUpgradeBtnUpgradeShow",IS(K).getBoxUpgradeRedPoint())},i.refreshShow=function(){this.updateAccItemNum(),this.updateGoldItemNum(),this.updateUpgradeRedPoint(),this.updateBtnHelp();var t=configTreasure_level.getDatas().length,e=IS(k).getBoxInfo(),n=e.lv;this.showLevelInfo(n,t),this.nodeUpgrade.active=n<t&&0==e.etime||!1,n<t&&this.showUpgradeInfo(n,e.exp,e.etime),this.nodeMax.active=n==t||!1,this.nodeBtnAcc.active=n<t&&0!=e.etime||!1,this.nodeBtnAd.active=n<t&&0!=e.etime||!1,this.nodeBtnUpgrade.active=n<t&&0==e.etime||!1,this.nodeUpgrading.active=n<t&&0!=e.etime||!1;var i=configTreasure_level.getDataByKey(n).expend.length;this.loadIcon(this.imgBtnUpgrade,"common",e.exp<i?"common_ICON_zhihuianniu":"common_ICON_luanniu"),this.outLineUpgrade.color=e.exp<i?new u(76,76,76):new u(41,65,21)},i.updateAdInfo=function(){var t=configAds.getDataByKey(B.AD_EQUIPMENT),e=IS(S).getAdRewardValue(B.AD_EQUIPMENT);this.txtAdDesc.string=I.formatStrWithMirrorDeal(t.desc,e/60);var n=IS(S).getAdWatchCount(B.AD_EQUIPMENT);this.txtAdCount.string=c.formatStr("(%s/%s)",t.times-n,t.times)},i.updateBtnHelp=function(){!IS(F).HasGuild()||IS(P).IsAskHelp(D.Box,0)?this.btnHelpImg.color=new u(128,128,128):this.btnHelpImg.color=new u(255,255,255)},i.updateAccItemNum=function(){this.txtAccItemCount.string=IS(T).getGoodsCountByGoodsGtid(X)},i.updateGoldItemNum=function(){this.txtGoldCount.string=I.GetNumString(IS(T).getGoodsCountByGoodsGtid(q.ROLE_ATTR_GOLD))},i.showLevelInfo=function(t,e){this.nodeMaxLevel.active=t>=e||!1,this.nodeCurLevel.active=t<e||!1,this.nodeNextLevel.active=t<e||!1,t>=e?this.showSingleLevelInfo(this.maxLevelItem,t,!0):(this.showSingleLevelInfo(this.curLevelItem,t,!0),this.showSingleLevelInfo(this.nextLevelItem,t+1,!1))},i.showSingleLevelInfo=function(t,e,n){var i=1==n?GetLanguage(200253):GetLanguage(200254);t.txtLevel.string=c.formatStr("%s%s",i,e);for(var o,d=configTreasure_level.getDataByKey(e).pro_quality||[],s={},a=0,h=0;h<d.length;h++)s[d[h][0]]=d[h][1],a+=d[h][1];for(var r=1;r<=11;r++){o=s[r]||0;var l=Number((o/a*100).toFixed(3));t.txtProbability[r-1].string=c.formatStr("%s%",l.toString())}},i.showUpgradeInfo=function(t,e,n){for(var i=configTreasure_level.getDataByKey(t),d=i.expend,a=this.utProgressParent.width/d.length,h=0;h<this.expItems.length;h++)this.expItems[h].node.active=!1;for(var l=0;l<d.length;l++){var c=this.expItems[l];if(null==c){var p=nodeInstantiate.instantiate(this.nodeProgressItem);p.parent=this.nodeProgressParent,c={node:p,imgBg:C.findChildComponent(p,"imgBg",s),imgFinish:C.findChildComponent(p,"imgFinish",s),ut:p.getComponent(o)}}c.ut.width=a,r.uiMirror&&(c.imgBg.node.getComponent(g).right=0,c.imgBg.node.getComponent(g).left=-.068,c.imgFinish.node.getComponent(g).right=1.723,c.imgFinish.node.getComponent(g).left=2.461),c.node.active=!0;var f=void 0,m=void 0;0==l?(f="zb_ui_shengjijindu00",m="zb_ui_shengjijindu02"):l<d.length-1?(f="zb_ui_shengjijindu01",m="zb_ui_shengjijindu03"):(f="zb_ui_shengjijindu04",m="zb_ui_shengjijindu05"),this.loadIcon(c.imgBg,"equip",f),this.loadIcon(c.imgFinish,"equip",m),c.imgFinish.node.active=l+1<=e||!1,this.expItems[l]=c}if(this.nodeBtnBuy.active=e<d.length||!1,this.txtNeedTime.node.active=e>=d.length||!1,this.nodeTimeIcon.active=e>=d.length||!1,this.boxEtime=0,e<d.length){var v=d[e][1],L=IS(T).getGoodsCountByGoodsGtid(d[e][0]);this.txtCost.string=I.GetNumString(v);var b=L>=v;this.txtCost.color=b?new u(255,193,74):new u(231,98,98),this.outLineCost.color=b?new u(41,65,21):new u(86,42,27),this.txtCost.fontSize=b?26:28}else{if(0==n)return void(this.txtNeedTime.string=x.formatTimeForSecond(i.time));this.boxEtime=n,this.refreshTime()}},i.onUpdate=function(t){0!=this.boxEtime&&(this.time=this.time+t,this.time<1||(this.time=0,this.refreshTime()))},i.refreshTime=function(){this.txtTime.string=x.formatTimeForSecond(Math.max(0,this.boxEtime-x.serverTime))},i.onBeforeClose=function(){this.nodeMask.active=!1;for(var t=0;t<this.expItems.length;t++)this.expItems[t].node.active=!1},i.onDestroy=function(){for(var t=0;t<this.expItems.length;t++)this.expItems[t].node.destroy();this.expItems=[]},i.onBoxInfoUpdate=function(t){t?t==M.lvUp?(f.playSound("common_shendengshengji"),this.showLvChangeEffect(),this.updateLockInfo()):t==M.expAdd&&this.showExpChangeEffect():this.refreshShow()},i.showLvChangeEffect=function(){this.addUIEffect("prefab/ui-effect/MX_tx_baoxiang_saoguang",this.nodeLevelRoot,1.5,new p(-1,-336)),this.refreshShow()},i.showExpChangeEffect=function(){var t=this;this.addUIEffect("prefab/ui-effect/MX_tx_tongyong_exp",this.nodeUpgrade,1,new p(-100,-39)),this.addTimer(1,1,(function(){t.refreshShow()}))},i.onGoodsInfoUpdate=function(t,e){e==X&&this.updateAccItemNum()},i.onAdInfoUpdate=function(t){t==B.AD_EQUIPMENT&&this.updateAdInfo()},i.onRoleResUpdate=function(t){t==q.ROLE_ATTR_GOLD&&this.refreshShow()},i.onMaskClick=function(){this.close()},i.onCloseClick=function(){this.close()},i.onBuyClick=function(){var t=IS(k).getBoxInfo(),e=configTreasure_level.getDataByKey(t.lv),n=e.expend.length;if(!(t.exp>=n)){var i=e.expend[t.exp];IS(T).getGoodsCountByGoodsGtid(i[0])<i[1]?uiMgr.openView("ItemGetWayView",i[0]):IS(U).reqUpBoxLv()}},i.onUpgradeClick=function(){var t=IS(k).getBoxInfo(),e=configTreasure_level.getDataByKey(t.lv).expend.length;t.exp<e?E.showFlyTip(GetLanguage(200255)):(0==IS(F).getClientDataByNum(H.Equip,"up_box_lv")&&(IS(V).send_3_29(H.Equip,1,"up_box_lv",1),IS(A).openGuide(1016)),IS(F).isHaveHideByType(1)||IS(F).GetIsClickSubscribe(2)||(IS(j).requestSubscribeMessage([2]),IS(F).clickSubscribe(2)),IS(U).reqUpBoxLv())},i.onAccClick=function(){var t=IS(T).getGoodsCountByGoodsGtid(X),e=this.boxEtime-x.serverTime;if(t<=0){var n=Math.ceil(e/$),i=I.formatStrWithMirrorDeal(GetLanguage(200256),n);E.showBoxTip({tip:i,title:GetLanguage(200048),todayTog:"acc_diamond_box",func:function(t){if("type_yes"==t){if(n>IS(T).getGoodsCountByGoodsGtid(Z))return void E.showFlyTip(GetLanguage(200257));IS(V).send_3_19(1,Z,n)}}})}else{var o=Math.ceil(e/Y);uiMgr.openView("ItemUseView",X,Math.min(o,t),(function(t,e){IS(V).send_3_19(1,t,e)}),Math.min(o,t))}},i.onAdClick=function(){IS(S).tryWatchAd(B.AD_EQUIPMENT)},n}(L));n._RF.pop()}}}));

