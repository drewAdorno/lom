System.register("chunks:///_virtual/GvGRankRewardView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./V2.ts","./GuildPinItem.ts","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./BaseView.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./CommonModel.ts","./FriendControl.ts","./GuildControl.ts","./GuildDataCache.ts","./RoleDataCache.ts","./RoleDefine.ts","./GvGControl.ts","./GvGDataCache.ts","./GvGDefine.ts"],(function(t){"use strict";var i,n,e,o,r,a,s,d,h,c,l,f,v,u,m,p,y,g,k,C,I,w,R,S,T,_;return{setters:[function(t){i=t.inheritsLoose},function(t){n=t.cclegacy,e=t.Button,o=t.Label,r=t.Sprite,a=t.ScrollView,s=t.js},function(t){d=t.V2},function(t){h=t.GuildPinItem},function(t){c=t.ItemGrid},function(t){l=t.ListItem},function(t){f=t.default},function(t){v=t.default},function(t){u=t.BaseView},function(t){m=t.default},function(t){p=t.ActivityType},function(t){y=t.CommonModel},function(t){g=t.default},function(t){k=t.default},function(t){C=t.default},function(t){I=t.RoleDataCache},function(t){w=t.PlayerAttr},function(t){R=t.default},function(t){S=t.GvGDataCache},function(t){T=t.GvGEventDefine,_=t.GvGRoleRankToRankIcon}],execute:function(){var G,x,L;n._RF.push({},"863e3SLrfpNiYrXk+JA9w3U","GvGRankRewardView",void 0);var M=1,N=2,F=3,b=((G={})[M]="",G[N]="",G),B=((x={})[1]=new d(0,0),x[2]=new d(0,0),x[3]=new d(0,0),x),U=((L={})[0]=999000219,L[1]=999000221,L[2]=999000217,L[3]=999000215,L[4]=999000213,L),A=(t("default",function(t){function n(){var i;return(i=t.call(this)||this).curType=void 0,i.typeItems=void 0,i.txtTitle=void 0,i.nodeReward=void 0,i.nodeRewardBg=void 0,i.nodeGuildTop=void 0,i.nodePlayerTop=void 0,i.myFrame=void 0,i.myIcon=void 0,i.myFlag=void 0,i.txtMyRank=void 0,i.txtMyScore=void 0,i.txtMyName=void 0,i.txtMyServer=void 0,i.guildTopList={},i.playerTopList={},i.rewardList=void 0,i.typeToRankInfo={},i.nodeResult=void 0,i.reward_v=void 0,i.reward_d=void 0,i.rankInfo=void 0,i.name="GvGRankRewardView",i.url="ui/module/gvg/GvGRankRewardView",i}i(n,t);var d=n.prototype;return d.onInit=function(){var t=this,i=this.findChild("imgMask");this.addComponentCallbackListener(i,e.EventType.CLICK,(function(){t.onMaskClick()}));var n=this.findChild("content/btnClose");this.addComponentCallbackListener(n,e.EventType.CLICK,(function(){t.close()})),this.txtTitle=this.findChildComponent("content/title/txtTitle",o),this.nodeReward=this.findChild("content/nodeReward"),this.nodeRewardBg=this.findChild("content/imgBgReward"),this.nodeGuildTop=this.findChild("content/guildTopRank"),this.nodePlayerTop=this.findChild("content/playerTopRank"),this.nodeResult=this.findChild("content/nodeResult"),this.typeItems=[];for(var d=function(i){var n=t.findChild(s.formatStr("content/bottomBtns/btnRanking%s",i));t.addComponentCallbackListener(n,e.EventType.CLICK,(function(){t.curType!=i&&(t.curType=i,t.updateContent())})),t.typeItems.push({node:n,nodeSelect:f.findChild(n,"imgSelect"),type:i})},c=1;c<=3;c++)d(c);this.txtMyRank=this.findChildComponent("content/nodeReward/myRank/rankNum",o),this.txtMyScore=this.findChildComponent("content/nodeReward/myRank/score",o),this.txtMyName=this.findChildComponent("content/nodeReward/myRank/info/name",o),this.txtMyServer=this.findChildComponent("content/nodeReward/myRank/info/txtServer",o),this.myFrame=this.findChildComponent("content/nodeReward/myRank/imgFrame",r),this.myIcon=this.findChildComponent("content/nodeReward/myRank/imgFrame/imgIcon",r),this.myFlag=new h(this,f.findChild(this.node,"content/nodeReward/myRank/GuildPinItem"));var l=this.findChildComponent("content/nodeReward/rankList",a);this.rewardList=this.addUIList(l,A,!0);var v=this.findChildComponent("content/nodeResult/reward_v/rewardScroll",a);this.reward_v=this.addUIList(v,D);var u=this.findChildComponent("content/nodeResult/reward_d/rewardScroll",a);this.reward_d=this.addUIList(u,D),this.reward_v.lackCenter=!0,this.reward_d.lackCenter=!0;for(var m=1;m<=3;m++){var p=new K;p.init(this.findChild("content/guildTopRank/rank"+m),this,m),this.guildTopList[m]=p}for(var y=1;y<=3;y++){var g=new E;g.init(this.findChild("content/playerTopRank/rank"+y),this,y),this.playerTopList[y]=g}},d.registerUpdateHandler=function(){this.addEvent(T.GVG_WEEK_RANK_BACK,this.onGvGWeekRankBack,this)},d.onMaskClick=function(){this.close()},d.onAfterOpen=function(){var t;for(var i in this.guildTopList)this.guildTopList.hasOwnProperty(i)&&this.guildTopList[i].show();for(var n in this.playerTopList)this.playerTopList.hasOwnProperty(n)&&this.playerTopList[n].show();var e=IS(m).GetActivityInfo(p.GvG),o=configFamiliybrawl.getDataByKey(e.roundCfg.group_id),r=configRanktype.getDataByKey(o.family_rank_cross_id),a=configRanktype.getDataByKey(o.self_rank_cross_id);(t={})[M]=r.prefix,t[N]=a.prefix,b=t,this.reward_v.datas=o.win_reward,this.reward_d.datas=o.lose_reward,IS(R).reqGvGWeekRank(1),IS(R).reqGvGWeekRank(2),this.curType=1,this.updateContent()},d.updateContent=function(){for(var t=0;t<this.typeItems.length;t++){var i=this.typeItems[t];i.nodeSelect.active=i.type==this.curType}this.txtTitle.string=this.curType==F?GetLanguage_UI(999000193):GetLanguage_UI(U[IS(S).curRanking]),this.nodeResult.active=this.curType==F,this.nodeReward.active=this.curType==M||this.curType==N,this.nodeRewardBg.active=this.curType==M||this.curType==N;var n=configFamiliybrawl_rank.getDataByKey(IS(S).curRanking);if(this.curType==M){if(this.nodeGuildTop.active=!0,this.nodePlayerTop.active=!1,this.myFrame.node.active=!1,IS(I).HasGuild()){var e=IS(C).GetGuildInfo();this.txtMyName.string=e.name,this.myFlag.node.active=!0,this.myFlag.SetItem(e.guild_flag),this.txtMyServer.node.active=1==IS(S).ifCross,1==IS(S).ifCross&&(this.txtMyServer.string=s.formatStr("[s%s]",IS(I).GetServerId()))}else this.txtMyName.string=GetLanguage(200083),this.myFlag.node.active=!1,this.txtMyServer.node.active=!1;var o=[].concat(configFamiliybrawl_rank_reward.getDataByList("group",n.family_rank_reward));o.sort((function(t,i){return t.rank_range[0]-i.rank_range[0]})),this.rewardList.datas=o,this.rewardList.scrollTo(0,0),this.UpdateRankInfo()}else if(this.curType==N){this.nodeGuildTop.active=!1,this.nodePlayerTop.active=!0,this.myFlag.node.active=!1,this.myFrame.node.active=!0,this.txtMyServer.node.active=1==IS(S).ifCross,1==IS(S).ifCross&&(this.txtMyServer.string=s.formatStr("[s%s]",IS(I).GetServerId())),this.txtMyName.string=IS(I).GetRoleAttr(w.ROLE_ATTR_NAME),this.loadRemoteIcon(IS(I).GetRoleAttr(w.ROLE_ATTR_HEAD_URL),this.myIcon);var r=[].concat(configFamiliybrawl_rank_reward.getDataByList("group",n.self_rank_reward));r.sort((function(t,i){return t.rank_range[0]-i.rank_range[0]})),this.rewardList.datas=r,this.rewardList.scrollTo(0,0),this.UpdateRankInfo()}else this.curType==F&&(this.nodeGuildTop.active=!1,this.nodePlayerTop.active=!1)},d.onBeforeClose=function(){this.typeToRankInfo={}},d.onDestroy=function(){},d.UpdateRankInfo=function(){if(this.rankInfo=this.getRankInfo(),this.rankInfo){var t,i={};this.curType==M?i=this.guildTopList:this.curType==N&&(i=this.playerTopList);for(var n=0;n<3;n++)this.rankInfo.rank_info.length>=n?i[n+1].show(this.rankInfo.rank_info[n]):i[n+1].show(null);if(this.curType!=F)this.txtMyRank.string=0!=this.rankInfo.my_rank_info.rank?this.rankInfo.my_rank_info.rank:GetLanguage(200037),this.txtMyScore.string=s.formatStr("%s%s",b[this.curType],v.GetNumString(null!=(t=this.rankInfo.my_rank_info.score)?t:0))}else{if(this.curType==M)for(var e=1;e<=3;e++)this.guildTopList[e].show(null);else if(this.curType==N)for(var o=1;o<=3;o++)this.playerTopList[o].show(null);this.curType!=F&&(this.txtMyRank.string=GetLanguage(200037),this.txtMyScore.string=s.formatStr("%s%s",b[this.curType],0))}},d.getRankInfo=function(){return this.typeToRankInfo[this.curType]},d.onGvGWeekRankBack=function(t){this.typeToRankInfo[t.type]=t,this.UpdateRankInfo()},n}(u)),function(t){function n(){for(var i,n=arguments.length,e=new Array(n),o=0;o<n;o++)e[o]=arguments[o];return(i=t.call.apply(t,[this].concat(e))||this).rewardScroll=void 0,i.txtRank=void 0,i.rankIcon=void 0,i}i(n,t);var e=n.prototype;return e.onInit=function(){this.txtRank=f.findChildComponent(this.node,"rankNum",o),this.rankIcon=f.findChildComponent(this.node,"rankIcon",r);var t=f.findChildComponent(this.node,"rewardScroll",a);this.rewardScroll=this.view.addUIList(t,D,!1),this.rewardScroll.touchEvent=!1},e.onRender=function(t,i){this.rewardScroll.datas=t.rank_reward;var n=t.rank_range[0],e=t.rank_range[1];n==e&&n<=3?(this.rankIcon.node.active=!0,this.txtRank.node.active=!1,this.view.loadIcon(this.rankIcon,"common","common_ICON_paiming0"+n)):(this.rankIcon.node.active=!1,this.txtRank.node.active=!0,t.show&&""!=t.show?this.txtRank.string=t.show:this.txtRank.string=s.formatStr("%s-%s",n,e))},n}(l)),D=function(t){function n(){for(var i,n=arguments.length,e=new Array(n),o=0;o<n;o++)e[o]=arguments[o];return(i=t.call.apply(t,[this].concat(e))||this).itemGridNode=void 0,i.itemGrid=void 0,i}i(n,t);var e=n.prototype;return e.onInit=function(){this.itemGridNode=f.findChild(this.node,"itemGrid"),this.itemGrid=new c(this.view,this.itemGridNode)},e.onRender=function(t,i){this.itemGrid.SetItemId(t[0],t[1])},n}(l),E=function(){function t(){this.view=void 0,this.node=void 0,this.rank=void 0,this.txtName=void 0,this.txtServer=void 0,this.txtScore=void 0,this.imgFrame=void 0,this.imgIcon=void 0,this.rankIcon=void 0,this.job=void 0,this.data=void 0,this.role=void 0}var i=t.prototype;return i.init=function(t,i,n){this.view=i,this.node=t,this.rank=n,this.onInit()},i.onInit=function(){var t=this;this.job=f.findChild(this.node,"role"),this.txtName=f.findChildComponent(this.node,"nameInfo/name",o),this.txtServer=f.findChildComponent(this.node,"nameInfo/txtServer",o),this.txtScore=f.findChildComponent(this.node,"score",o),this.imgFrame=f.findChild(this.node,"imgFrame"),this.imgIcon=f.findChildComponent(this.node,"imgFrame/imgIcon",r),this.view.addComponentCallbackListener(this.imgFrame,e.EventType.CLICK,(function(){t.data&&IS(g).reqOtherRoleNotice(t.data.belong_id)}));var i=f.findChild(this.node,"role/click");this.view.addComponentCallbackListener(i,e.EventType.CLICK,(function(){t.data&&IS(g).reqOtherRoleNotice(t.data.belong_id)})),this.rankIcon=f.findChildComponent(this.node,"imgFrame/rank_icon",r),this.view.loadIcon(this.rankIcon,"rank",_[this.rank])},i.show=function(t){if(this.data=t,this.txtName.string=GetLanguage(200038),this.txtScore.string=b[N]+"0",this.imgIcon.node.active=!1,this.txtServer.node.active=!1,null!=this.role&&(this.view.removeUnitModel(this.role),this.role=null),t){var i=t.figure;this.role=IS(y).AddRoleModel(this.view,i,this.job,null,.9),this.view.getUnitModel(this.role).mount=i.mount_figure,this.imgIcon.node.active=!0,this.view.loadRemoteIcon(t.head.url,this.imgIcon),i.mount_figure<=0&&(this.view.getUnitModel(this.role).position=B[this.rank]),this.view.loadRemoteIcon(t.head.url,this.imgIcon),this.txtName.string=t.name,this.txtScore.string=b[N]+v.GetNumString(t.score),this.txtServer.node.active=1==IS(S).ifCross,1==IS(S).ifCross&&(this.txtServer.string=s.formatStr("[s%s]",t.serv_id))}},t}(),K=function(){function t(){this.view=void 0,this.node=void 0,this.rank=void 0,this.flag=void 0,this.txtName=void 0,this.txtServer=void 0,this.txtScore=void 0,this.rankIcon=void 0,this.data=void 0}var i=t.prototype;return i.init=function(t,i,n){this.view=i,this.node=t,this.rank=n,this.onInit()},i.onInit=function(){var t=this;this.txtName=f.findChildComponent(this.node,"info/name/name",o),this.txtServer=f.findChildComponent(this.node,"info/txtServer",o),this.txtScore=f.findChildComponent(this.node,"score",o),this.flag=new h(this.view,f.findChild(this.node,"GuildPinItem")),this.view.addComponentCallbackListener(this.flag.node,e.EventType.CLICK,(function(){t.data&&IS(k).send_29_1(t.data.belong_id)})),this.rankIcon=f.findChildComponent(this.node,"rank_icon",r),this.view.loadIcon(this.rankIcon,"common","common_ICON_paiming0"+this.rank)},i.show=function(t){this.data=t,this.txtName.string=GetLanguage(200038),this.txtScore.string=b[M]+"0",this.flag.node.active=!1,this.txtServer.node.active=!1,t&&(this.flag.node.active=!0,this.flag.SetItem(t.guild_flag),this.txtName.string=t.name,this.txtScore.string=b[M]+v.GetNumString(t.score),this.txtServer.node.active=1==IS(S).ifCross,1==IS(S).ifCross&&(this.txtServer.string=s.formatStr("[s%s]",t.serv_id)))},t}();n._RF.pop()}}}));

