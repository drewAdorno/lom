System.register("chunks:///_virtual/SingleEnterView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./ConfigGlobal.ts","./BagDefine.ts","./BagModel.ts","./ChapterDataCache.ts","./ChapterDefine.ts","./DungeonControl.ts","./MessageView.ts","./GuildControl.ts","./FrameDataCache.ts","./RoleDataCache.ts","./RoleDefine.ts","./GuildWarControl.ts","./GuildWarDataCache.ts","./BaseView.ts"],(function(t){"use strict";var e,n,i,o,a,s,r,c,d,l,h,f,u,m,C,g,p,v,I,T,_,y,R,L;return{setters:[function(t){e=t.inheritsLoose,n=t.createForOfIteratorHelperLoose},function(t){i=t.cclegacy,o=t.Button,a=t.Vec2,s=t.Label,r=t.Sprite},function(t){c=t.default},function(t){d=t.default},null,function(t){l=t.ConfigGlobal},function(t){h=t.BagEventDefine},function(t){f=t.BagModel},function(t){u=t.ChapterDataCache},function(t){m=t.DungeonDefine,C=t.ChapterEventDefine},function(t){g=t.default},function(t){p=t.default},function(t){v=t.default},function(t){I=t.FrameDataCache},function(t){T=t.RoleDataCache},function(t){_=t.PlayerAttr},function(t){y=t.default},function(t){R=t.GuildWarDataCache},function(t){L=t.BaseView}],execute:function(){i._RF.push({},"accc21Qor5Kw78tWBWwhRGZ","SingleEnterView",void 0);t("default",function(t){function i(){var e;return(e=t.call(this)||this).data=void 0,e.curLevel=void 0,e.txtTime=void 0,e.myRankInfo=void 0,e.nextGetTime=0,e.name="SingleEnterView",e.url="ui/module/guildwar/SingleEnterView",e.poolTime=3e3,e}e(i,t);var L=i.prototype;return L.onInit=function(){var t=this,e=this.findChild("imgMask");this.addComponentCallbackListener(e,o.EventType.CLICK,(function(){t.close()}));var n=this.findChild("content/btnClose");this.addComponentCallbackListener(n,o.EventType.CLICK,(function(){t.close()}));var i=this.findChild("content/btnRank");this.addComponentCallbackListener(i,o.EventType.CLICK,(function(){t.showRank()}));var r=this.findChild("content/btnBox");this.addRedPoint("guild_single_boss_box",r,new a(30,30)),this.addComponentCallbackListener(r,o.EventType.CLICK,(function(){t.showBox()}));var c=this.findChild("content/btnGo");this.addComponentCallbackListener(c,o.EventType.CLICK,(function(){t.startWar()}));var d=this.findChild("content/btnTips");this.addComponentCallbackListener(d,o.EventType.CLICK,(function(){var t=configChapter_type.getDataByKey(m.CHAPTER_TYPE_LEAGUE_SOLO).desc,e=configChapter_type.getDataByKey(m.CHAPTER_TYPE_LEAGUE_SOLO).name;p.showBoxTip({title:e,tip:t,btnCnt:1})})),this.txtTime=this.findChildComponent("content/txtTime",s)},L.registerUpdateHandler=function(){this.addEvent(h.GOODS_INFO_UPDATE,this.updaItemInfo,this)},L.onAfterOpen=function(){this.data=IS(u).getDungeonInfoByID(m.CHAPTER_TYPE_LEAGUE_SOLO),this.curLevel=this.data.max_level||1,this.updaItemInfo(),this.myRankInfo=this.openArgs[0].my_rank,this.showMyRank(),this.refreshCountDown(),IS(R).getBoxRedPoint()},L.showMyRank=function(){var t=this.findChildComponent("content/meRank/imgFrame/frame/imgIcon",r),e=this.findChildComponent("content/meRank/name",s),n=this.findChildComponent("content/meRank/rank",s),i=this.findChildComponent("content/meRank/score",s),o=this.findChildComponent("content/meRank/no_rank",s),a=this.findChildComponent("content/meRank/power",s),d=IS(T),l=d.GetRoleAttr(_.ROLE_ATTR_HEAD_URL);this.loadRemoteIcon(l,t);var h=this.findChildComponent("content/meRank/imgFrame/frame/imgHeadFrame",r),f=IS(I).curFrameId;if(f>0){var u=configAvatar_frame.getDataByKey(f);this.loadIcon(h,"icon_frame",u.icon),h.node.active=!0}else h.node.active=!1;0==this.myRankInfo.rank?(o.node.active=!0,n.node.active=!1):(o.node.active=!1,n.node.active=!0),n.string=this.myRankInfo.rank,e.string=this.myRankInfo.role_name,i.string="Lv."+d.GetLevel(),a.string=c.GetNumString(this.myRankInfo.value)},L.startWar=function(){var t=this.data;if(IS(f).getGoodsCountByGoodsGtid(7002)<=0)p.showFlyTip(GetLanguage(200384));else{IS(g).reqDungeonBattleStart(t.type,this.curLevel);var e=IS(u).getConfig(t.type).getDataByList("index",this.curLevel||1);battleMain.enterChapter(e[0].bossModel),normalEvent.emit(C.DUNGEON_ENTER),this.close()}},L.showRank=function(){IS(v).send_29_20(1,1)},L.showBox=function(){IS(y).reqSoloBossInfo(),uiMgr.openView("SingleBoxView")},L.refreshCountDown=function(){var t=this;if(this.txtTime.node.active=!1,!(IS(f).getGoodsCountByGoodsGtid(7002)>=l.league_solo_chapter_recover[1])&&this.data.ext){for(var e,i=n(this.data.ext);!(e=i()).done;){var o=e.value,a=o.k,s=o.v;1==a&&(this.nextGetTime=s)}this.nextGetTime<=0||(this.txtTime.node.active=!0,this.updateTime(),this.addTimer(1,-1,(function(){t.updateTime()})))}},L.updateTime=function(){var t=this.nextGetTime-d.serverTime,e=c.formatStrWithMirrorDeal(GetLanguage(200385),d.formatTimeForSecond(t));this.txtTime.string=e},L.updaItemInfo=function(){var t=IS(f).getGoodsCountByGoodsGtid(7002),e=this.findChildComponent("content/bgNum/txtNum",s);e.string=t>99?"99+":t,t>=l.league_solo_chapter_recover[1]?this.txtTime.node.active=!1:this.refreshCountDown()},L.onBeforeClose=function(){},L.onDestroy=function(){},i}(L));i._RF.pop()}}}));

