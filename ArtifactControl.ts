System.register("chunks:///_virtual/ArtifactControl.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BattleData.ts","./UnitMgr.ts","./BagDefine.ts","./ChapterDataCache.ts","./ChapterDefine.ts","./ControlMgr.ts","./ArtifactDataCache.ts","./ArtifactDefine.ts"],(function(t){"use strict";var e,i,a,n,r,_,c,s,o,f,l;return{setters:[function(t){e=t.createForOfIteratorHelperLoose},function(t){i=t.cclegacy},function(t){a=t.ChapterType},function(t){n=t.UnitMgr},function(t){r=t.GoodsType,_=t.BagEventDefine},function(t){c=t.ChapterDataCache},function(t){s=t.ChapterEventDefine},function(t){o=t.controlMgr},function(t){f=t.ArtifactDataCache},function(t){l=t.ArtifactEvent}],execute:function(){i._RF.push({},"c9065OH5JlIvajg2DBZ6379","ArtifactControl",void 0);t("default",function(){var t=i.prototype;function i(){netManager.addEventListener("artifact.artifact_info_s2c",this.onArtifactInfo,this),netManager.addEventListener("artifact.artifact_levup_s2c",this.onArtifactLevelUp,this),netManager.addEventListener("artifact.artifact_use_s2c",this.onArtifactUse,this),netManager.addEventListener("artifact.artifact_up_skin_s2c",this.onSkinLevelUp,this),netManager.addEventListener("artifact.artifact_use_skill_s2c",this.onUseSkill,this),netManager.addEventListener("artifact_gem.artifact_gem_info_s2c",this.on_artifact_gem_info_s2c,this),netManager.addEventListener("artifact_gem.artifact_gem_wear_s2c",this.on_artifact_gem_wear_s2c,this),netManager.addEventListener("artifact_gem.artifact_gem_up_s2c",this.on_artifact_gem_up_s2c,this),netManager.addEventListener("artifact_gem.artifact_gem_add_s2c",this.on_artifact_gem_add_s2c,this),netManager.addEventListener("artifact_gem.artifact_gem_red_read_s2c",this.on_artifact_gem_red_read_s2c,this),netManager.addEventListener("artifact_gem.artifact_gem_lock_s2c",this.on_artifact_gem_lock_s2c,this),normalEvent.on(_.GOODS_INFO_UPDATE,this.updateItemCheck),o.addControl(this)}return t.clear=function(){printLog("ArtifactControl")},t.onLogin=function(){this.reqArtifactInfo(),this.reqGemInfo()},t.onReconnect=function(){this.reqArtifactInfo(),this.reqGemInfo()},t.updateItemCheck=function(){IS(f).checkSkinRP(),IS(f).checkUpgradeRP()},t.reqArtifactInfo=function(){netManager.send("artifact.artifact_info_c2s",{})},t.reqLevelUp=function(t){netManager.send("artifact.artifact_levup_c2s",{type:t})},t.reqUseArtifact=function(t){netManager.send("artifact.artifact_use_c2s",{use:t})},t.reqSkinLevelUp=function(t){netManager.send("artifact.artifact_up_skin_c2s",{artifact_id:t})},t.reqUseSkill=function(t){netManager.send("artifact.artifact_use_skill_c2s",{skill_use:t})},t.previewBattle=function(t){IS(f).prviewId=t;var e=IS(c);e.currentLoadType=0,e.chapterType=a.ShenQi,e.battleData=e.createBattleData(a.ShenQi,50001,0,!0);var i=e.battleData.playerList[1].units[0];i.skin.weapon=t;var r=configArtifact_skin.getDataByKeys("artifact_id",t,"skin_level",1),_=configSkill.getDataByKey(r.skin_skill[0][0]);n.addSkill(i,_.id,1),e.curDungeonId=50001,battleMain.enterChapter(configArtifact_preview_chapter.getDataByKey(50001).bossModel),uiMgr.HideAllView(["MainView","BattleHubView"]),normalEvent.emit(s.BATTLE_STATE,a.ShenQi,!0)},t.onArtifactInfo=function(t){t.level!=IS(f).curLevel&&1!=t.level&&0!=IS(f).curLevel&&uiMgr.openView("ArtifactUpgradeResultView"),null!=IS(f).skin_list&&IS(f).skin_list.length+1==t.skin_list.length&&uiMgr.openView("ArtifactGetView",t.use),IS(f).artifact_id=t.use,IS(f).skin_list=t.skin_list,IS(f).curexp=t.exp,IS(f).curLevel=t.level,IS(f).skill_use=t.skill_use,normalEvent.emit(l.TYPE_ARTIFACT_CHANGE,t.use),IS(f).checkSkinRP(),IS(f).checkUpgradeRP()},t.onArtifactLevelUp=function(t){IS(f).curexp=t.exp,normalEvent.emit(l.TYPE_ARTIFACT_ADD_EXP)},t.onArtifactUse=function(t){IS(f).artifact_id=t.use,normalEvent.emit(l.TYPE_ARTIFACT_CHANGE,t.use)},t.onSkinLevelUp=function(t){console.log(t)},t.onUseSkill=function(t){IS(f).skill_use=t.skill_use,normalEvent.emit(l.TYPE_ARTIFACT_USE_SKILL)},t.reqGemInfo=function(){netManager.send("artifact_gem.artifact_gem_info_c2s",{})},t.reqGemWearInfo=function(t,e){netManager.send("artifact_gem.artifact_gem_wear_c2s",{pos_id:t,gem_id:e})},t.reqGemUpInfo=function(t,e,i){netManager.send("artifact_gem.artifact_gem_up_c2s",{gem_id:t,use_list:e,item_list:i})},t.reqRedRead=function(t){netManager.send("artifact_gem.artifact_gem_red_read_c2s",{gem_id:t})},t.reqGemLock=function(t){netManager.send("artifact_gem.artifact_gem_lock_c2s",{gem_id:t})},t.on_artifact_gem_info_s2c=function(t){var e=IS(f);e.initPosList(t.pos_list),e.gem_list=t.gem_list,normalEvent.emit(l.TYPE_ARTIFACT_GEM_INFO_UPDATE),e.checkGemRP()},t.on_artifact_gem_wear_s2c=function(t){IS(f).pos_list[t.pos_id]=t.gem_id,normalEvent.emit(l.TYPE_ARTIFACT_GEM_INFO_UPDATE)},t.on_artifact_gem_up_s2c=function(t){var i=[],a=IS(f);normalEvent.emit(l.TYPE_ARTIFACT_GEM_INFO_UPDATE_UP,{ori:a.getStoneInfoByID(t.gem_info.id),new:t.gem_info});for(var n,r=e(a.gem_list);!(n=r()).done;){var _=n.value;_.id==t.gem_info.id?i.push(t.gem_info):i.push(_)}a.gem_list=i.filter((function(e){return!t.cost_list.includes(e.id)})),normalEvent.emit(l.TYPE_ARTIFACT_GEM_INFO_UPDATE)},t.on_artifact_gem_add_s2c=function(t){var i=IS(f);i.gem_list=i.gem_list.concat(t.gem_list);for(var a,n=[],_=e(t.gem_list);!(a=_()).done;){var c=a.value;n.push({gtid:c.id,num:"",type:r.Artifact})}uiMgr.openView("GoodsGetView",n),normalEvent.emit(l.TYPE_ARTIFACT_GEM_INFO_UPDATE)},t.on_artifact_gem_red_read_s2c=function(t){for(var i,a=[],n=IS(f),r=e(n.gem_list);!(i=r()).done;){var _=i.value;_.id==t.gem.id?a.push(t.gem):a.push(_)}n.gem_list=a,normalEvent.emit(l.TYPE_ARTIFACT_GEM_INFO_UPDATE_RED)},t.on_artifact_gem_lock_s2c=function(t){for(var i,a=[],n=IS(f),r=e(n.gem_list);!(i=r()).done;){var _=i.value;_.id==t.gem.id?a.push(t.gem):a.push(_)}n.gem_list=a,normalEvent.emit(l.TYPE_ARTIFACT_GEM_INFO_UPDATE)},i}());i._RF.pop()}}}));

