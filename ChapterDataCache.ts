System.register("chunks:///_virtual/ChapterDataCache.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BattleData.ts","./EnumDefine.ts","./MetaAttrib.ts","./UnitData.ts","./UnitMgr.ts","./ConfigGlobal.ts","./FixMath.ts","./ObjectUtil.ts","./ArtifactDataCache.ts","./MessageView.ts","./EquipModel.ts","./FateDataCache.ts","./FlyPetDataCache.ts","./HorseDataChche.ts","./PetModel.ts","./RoleAttrDataCache.ts","./RoleDataCache.ts","./RoleDefine.ts","./SkillModel.ts","./WingDataCache.ts","./ChapterDefine.ts"],(function(e){"use strict";var t,a,i,r,n,l,o,s,u,c,h,f,d,p,g,v,y,_,D,C,b,S,k,I,P,L,m,w;return{setters:[function(e){t=e.createForOfIteratorHelperLoose},function(e){a=e.cclegacy,i=e.sys},function(e){r=e.ChapterType,n=e.PlayerData,l=e.BattleData},function(e){o=e.UnityType},function(e){s=e.MetaAttrib,u=e.AttribDefine},function(e){c=e.UnitData},function(e){h=e.UnitMgr},function(e){f=e.ConfigGlobal},function(e){d=e.FixMath},function(e){p=e.default},function(e){g=e.ArtifactDataCache},function(e){v=e.default},function(e){y=e.EquipModel},function(e){_=e.default},function(e){D=e.default},function(e){C=e.HorseDataCache},function(e){b=e.PetModel},function(e){S=e.RoleAttrDataCache},function(e){k=e.RoleDataCache},function(e){I=e.PlayerAttr},function(e){P=e.SkillModel},function(e){L=e.WingDataCache},function(e){m=e.ChapterEventDefine,w=e.DungeonDefine}],execute:function(){a._RF.push({},"79eb7CSpV5Pcqsib38SW2Sa","ChapterDataCache",void 0);e("ChapterDataCache",function(){var e=a.prototype;function a(){this.currentLoadType=0,this.chapterType=r.Main,this.curChapterId=void 0,this.chapterMode=void 0,this.battleData=void 0,this.curDungeonId=void 0,this.curDungeonLevel={},this.cacheFailResult=void 0,this.dungeonList=Array.from({length:2},(function(e,t){return Object.create({type:t+2,max_level:1,cur_level:0,day_times:0})})),this.lastKillRewardTime=0,this.testModel=!1,this.speed_scale=1,this.simpModel=!1,this.openSimpModel=!1,this.autoStartSimpTime=0,this.closeSimpNum=0,this.worldBossInfo=void 0,this.worldBossRank=void 0,this.hasFetchPop=!1,this.doubleChapterEntraceInfo=void 0,this.doubleChapterInfo=void 0,_G("chapterDataCache",this)}return e.clear=function(){},e.updateDungeon=function(e){var t,a=!0;this.dungeonList=null!=(t=this.dungeonList)?t:[];for(var i=0;i<this.dungeonList.length;i++){if(this.dungeonList[i].type==e.type){this.dungeonList[i]=e,a=!1;break}}a&&this.dungeonList.push(e)},e.updateSpeedScale=function(e){this.speed_scale=e,normalEvent.emit(m.BATTLE_SEED)},e.getLimit=function(e){for(var a,i=t(f.res_chapter);!(a=i()).done;){var r=a.value;if(r[0]==e)return r}},e.getConfig=function(e){var t;switch(e=null!=(t=e)?t:this.chapterType){case r.Coin:return configCoin_chapter;case r.Diamond:return configDiamond_chapter;case r.Arena:return configPvp_chapter;case r.Solo:return configLeague_solo_chapter;case r.Team3:return configLegacy_team_chapter;case r.Team20:return configLeague_gve_chapter;case r.Mount:return configMount_chapter;case r.Fate:return configFate_chapter;case r.WorldBoss:return configWorld_boss;case r.CrossPvp:return configCross_pvp_chapter;case r.StrategyActivity:return configStrategy_activity_chapter;case r.ParkPvp:return configPark_pvp_chapter;case r.Seven:return configSeven_trial_chapter;case r.Slave:return configCapture_slave;case r.ArtifactGem:return configArtifact_gem_chapter;case r.CrossParkPvp:return configPark_cross_pvp_chapter}return null},e.createBattleData=function(e,t,a,r){void 0===r&&(r=!1);var o=new l;o.seed=i.now(),o.chapterType=e,o.chapterId=t,o.chapterMode=a,o.playerList[1]=new n(1);var s=new c;s.attribs={},s.roleId=o.playerList[1].id;var u=IS(k).GetRoleAttr(I.ROLE_ATTR_GENDER),h=IS(k).GetTypeUsedSkin(0),f=configJobs.getDataByKey(h).model,d=configUnit.getDataByKey(f);return s.config=d,s.setDress(h,IS(k).GetTypeUsedSkin(2),u),this.setPlayerAttrib(s),this.setPlayerSkill(o,s),r||this.setPlayerPassiveSkill(o,s),this.setPlayerSkillAttr(s),s.idleIndex=1,this.setPlayerEquip(s),o.playerList[1].units.push(s),r||this.setPlayerPets(o.playerList[1]),r||this.setPlayerFlyPet(o.playerList[1]),this.setPlayerMount(s),o},e.setPlayerSkill=function(e,a,i){var r;void 0===i&&(i=!1),a.skillList=null!=(r=a.skillList)?r:[];var n=null;if(this.testModel){a.skillList.length=0,n=[];for(var l=0;l<a.config.skills.length;l++){var o=a.config.skills[l];n.push({pos_id:l+1,skill_id:o,skill_lv:1})}a.ativeSkills=n;for(var s=0;s<n.length;s++){var u=n[s];u.skill_id<=0||h.addSkill(a,u.skill_id,u.skill_lv)}}else{var c=function(e){for(var a,i=t(f);!(a=i()).done;){var r=a.value;if(r.config.id==e)return r}},f=p.copyArray(a.skillList);a.skillList.length=0,n=IS(P).getActiveSkillList(),a.ativeSkills=n;for(var g=0;g<n.length;g++){var v,y=n[g];if(!(y.skill_id<=0)){var _=h.addSkill(a,y.skill_id,y.skill_lv);if(_.useDelay=null!=(v=y.delay_time)?v:0,_.useDelay=d.round(_.useDelay/1e3),i){var D=c(y.skill_id);if(!D){_.currenPower=0,_.state=2;continue}_.currenPower=D.currenPower,_.state=D.state,_.checkState()}}}}},e.setPlayerPassiveSkill=function(e,t){var a=null;if(this.testModel){a=[];for(var i=0;i<t.config.passiveSkills.length;i++){var n=t.config.passiveSkills[i];a.push({skill_id:n,skill_lv:1})}}else a=IS(P).getPassiveSkillList();null!=t.passiveSkillList&&(t.passiveSkillList.length=0);var l=null;l=this.chapterType==r.Main?this.getChapterConfig(e.chapterId):this.getConfig().getDataByKey(e.chapterId);for(var o=0;o<a.length;o++){var s=a[o];if(!(s.skill_id<=0)){var u=configSkill.getDataByKey(s.skill_id);this.checkChapterTypeOk(u.chapter_type,l.part_type)&&h.addSkill(t,s.skill_id,s.skill_lv)}}},e.checkChapterTypeOk=function(e,t){if(null==e||e.length<=0)return!0;for(var a=0;a<e.length;a++)if(e[a][0]==this.chapterType&&(null==t||t==e[a][1]))return!0;return!1},e.setPlayerEquip=function(e){var t,a=IS(y).getShowEquipCfgIdByLocation(1),i=IS(y).getShowEquipCfgIdByLocation(2),r=IS(y).getShowEquipCfgIdByLocation(3),n=IS(k).GetTypeUsedSkin(1),l=IS(_).GetShowFate(),o=IS(g).artifact_id,s=null!=(t=IS(L).wing_id)?t:0;o>0&&(a=o),e.skin={color:n,weapon:a,ornaments:i,face:r,fate:l?l.cfg_id:0,wing:s}},e.setPlayerMount=function(e){e.mount=IS(C).horse_id},e.setPlayerAttrib=function(e){for(var a,i=IS(S),r=configAttribute.getDataByList("module",1),n=t(r);!(a=n()).done;){var l=a.value,o=new s(l),u=o.config.id;this.testModel?o.baseValue=e.config[o.config.key]:o.baseValue=i.getRoleAttrById(u),e.attribs[l.id]=o}},e.setPetAttrib=function(e,a){for(var i,r=configAttribute.getDataByList("module",1),n=t(a);!(i=n()).done;){var l=i.value;if(l.config.type==o.Partner){var c=configPetlevel.getDataByKeys("id",l.data.petId,"level",l.data.level);if(null==c){printLogErr("找不到配置！！！同伴Id:",l.data.petId," 等级：",l.data.level);continue}for(var h,f=t(r);!(h=f()).done;){var d=h.value,p=new s(d);p.baseValue=IS(b).getPetFactAttrValue(c[d.key],l.data.petId,d.id),l.data.attribs[d.id]=p}l.data.attribs[u.att].baseValue=e.units[0].attribs[u.att].baseValue,l.data.attribs[u.partner_dam_extra].baseValue=e.units[0].attribs[u.partner_dam_extra].baseValue}}},e.setPlayerPets=function(e){for(var a,i=IS(b).getWearPetList(),r=configAttribute.getDataByList("module",1),n=t(i);!(a=n()).done;){var l=a.value,o=configPet.getDataByKey(l.pet_id),h=configPetlevel.getDataByKeys("id",l.pet_id,"level",l.level),f=new c;f.attribs={},f.petId=l.pet_id,f.level=l.level,f.roleId=e.id;var d=configUnit.getDataByKey(o.unitId);f.config=d;for(var p,g=t(r);!(p=g()).done;){var v=p.value,y=new s(v);y.baseValue=IS(b).getPetFactAttrValue(h[v.key],l.pet_id,v.id),f.attribs[v.id]=y}f.attribs[u.att].baseValue=e.units[0].attribs[u.att].baseValue,f.attribs[u.partner_dam_extra].baseValue=e.units[0].attribs[u.partner_dam_extra].baseValue,f.idleIndex=l.pos+1,e.units.push(f)}},e.setPlayerFlyPet=function(e){var a=IS(D).now_use_pet;if(0!=a){var i=configFly.getDataByKey(a),r=configUnit.getDataByKey(i.unitid),n=new c;n.attribs={},n.roleId=e.id,n.config=r;for(var l,o=configAttribute.getDataByList("module",1),u=t(o);!(l=u()).done;){var h=l.value,f=new s(h);f.baseValue=r[h.key],n.attribs[h.id]=f}n.idleIndex=7,e.units.push(n)}},e.setPlayerSkillAttr=function(e){e.skillAttrInfo=IS(P).getSkillAttrs()},e.getDungeonInfoByID=function(e){for(var a,i=t(this.dungeonList);!(a=i()).done;){var r=a.value;if(r.type==e)return r}return{type:e,max_level:1,cur_level:0,day_times:0}},e.getChapterConfig=function(e){var t=Math.floor((e-1)/500)+1;return getConfig("configChapter",t).getDataByKey(e)},e.getChapterConfigInfo=function(e){var t=Math.floor((e-1)/500)+1;return getConfig("configChapter",t)},e.getDoubleChapterRewardRedNum=function(){if(p.isEmpty(this.doubleChapterEntraceInfo))return 0;if(0==this.doubleChapterEntraceInfo.is_open)return 0;var e=this.doubleChapterEntraceInfo.max_reward_num||0;return(this.doubleChapterEntraceInfo.choose_reward_list||[]).length<e?1:0},e.checkDounleChapterOpen=function(){var e=configChapter_type.getDataByKey(w.CHAPTER_TYPE_DOUBLE_LADDER);return!!IS(k).CheckFuncOpen(e.open_id)&&(!p.isEmpty(this.doubleChapterEntraceInfo)&&0!=this.doubleChapterEntraceInfo.is_open)},e.getChooseRewardByIndex=function(e){if(!p.isEmpty(this.doubleChapterEntraceInfo)){var t=this.doubleChapterEntraceInfo.choose_reward_list||[];return e<=t.length-1?t[e]:null}},e.tryCloseChapterViews=function(e){e&&v.showFlyTip(GetLanguage(204935)),uiMgr.close("DoubleChapterMainView"),uiMgr.close("DoubleChapterHelpManageView"),uiMgr.close("DoubleChapterInvateDealView"),uiMgr.close("DoubleChapterInvateSettingView"),uiMgr.close("DoubleChapterLevelDetailView"),uiMgr.close("DoubleChapterRewardSelectView"),uiMgr.close("DoubleChapterSkillDelayView")},e.getMaxDoubleChapterId=function(){for(var e=configDouble_ladder_chapter.getDatas(),t=1,a=0;a<e.length;a++)e[a].id>t&&(t=e[a].id);return t},e.getMaxDoubleChapterLevel=function(){for(var e=configDouble_ladder_chapter.getDatas(),t=1,a=0;a<e.length;a++)e[a].chapter>t&&(t=e[a].chapter);return t},a}());a._RF.pop()}}}));

