System.register("chunks:///_virtual/HatredCtr.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ObjectPool.ts","./FixMath.ts","./EnumDefine.ts"],(function(t){"use strict";var e,i,n,r,a,s,h;return{setters:[function(t){e=t.createClass},function(t){i=t.cclegacy},function(t){n=t.ObjectPool},function(t){r=t.FixMath},function(t){a=t.StateType,s=t.UnitConfig,h=t.TargetFilter}],execute:function(){i._RF.push({},"18456mN7z9IWZOPweU/tbl6","HatredCtr",void 0);var u=function(){function t(){this.unit=void 0,this._hatredValue=0}return t.prototype.Hatred=function(t,e){this.unit=t,this._hatredValue=e},t.alloc=function(t,e){var i=d.alloc();return i.unit=t,i._hatredValue=e,i},t.free=function(t){null!=t&&(t.actor=null,t._hatredValue=0,d.free(t))},e(t,[{key:"hatredValue",get:function(){return r.roundInt(this._hatredValue+this.unit.tauntValue)},set:function(t){this._hatredValue=t}}]),t}(),d=new n(u,30);t("HatredCtr",function(){function t(){this._owner=null,this._hatredList=void 0,this._hatredList=[]}var i=t.prototype;return i.init=function(t){this._owner=t},i.reset=function(){this.clearHatredList()},i.onUpdate=function(t){var e=this._owner;if(e.statectr.currentStateType!=a.Born){if(0!=(e.config.hatred_type&s.HATE_WARRING_CAST))for(var i=e.battleMain.unitMgr.findTarget(e,h.Enemy,e.data.warningRange,e.position),n=0;n<i.length;++n){var r=i[n];if(!r.isDead){if(0==(r.config.hatred_type&s.HATE_WARRING_TARGET))continue;this.insertWarningRange(r)}}for(var d=0;d<this._hatredList.length;++d){this._hatredList[d].unit.isDead&&(u.free(this._hatredList[d]),this._hatredList.splice(d,1),d--)}}},i.insertWarningRange=function(t){this._owner.isDead||this.findIndex(t)>=0||this._hatredList.push(u.alloc(t,1))},i.addSkillHatred=function(t,e){var i=this._owner;t!=i&&(i.isDead||e<=0||0!=(i.config.hatred_type&s.HATE_SKILL_CAST)&&0!=(t.config.hatred_type&s.HATE_SKILL_TARGET)&&this.addHatred(t,e))},i.addHurtHatred=function(t,e){var i=this._owner;t!=i&&(i.isDead||0!=(i.config.hatred_type&s.HATE_HURT_CAST)&&0!=(t.config.hatred_type&s.HATE_HURT_TARGET)&&this.addSkillHatred(t,Math.max(e,1)))},i.addHatred=function(t,e){var i=this._hatredList,n=this.findIndex(t);if(-1==n)i.push(u.alloc(t,e));else{var a=i[n];a.hatredValue=r.roundInt(a.hatredValue+e)}},i.clearHatredList=function(t){for(var e=0;e<this._hatredList.length;++e){var i=this._hatredList[e];u.free(i)}this._hatredList.length=0},i.findIndex=function(t){for(var e=0;e<this._hatredList.length;++e)if(this._hatredList[e].unit==t)return e;return-1},i.getMaxHatredUnit=function(){var t=this._hatredList;if(t.length<=0)return null;for(var e=t[0],i=this._owner,n=1;n<t.length;++n){var a=t[n];a.unit.isDead||(e.unit.isDead?e=a:a.hatredValue==e.hatredValue?r.distanceX(i.position,a.unit.position)<r.distanceX(i.position,e.unit.position)&&(e=a):a.hatredValue>e.hatredValue&&(e=a))}return e.unit},i.getHatredList=function(){return this._hatredList},e(t,[{key:"length",get:function(){return this._hatredList.length}}]),t}());i._RF.pop()}}}));

