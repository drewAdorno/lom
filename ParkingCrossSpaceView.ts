System.register("chunks:///_virtual/ParkingCrossSpaceView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GuildPinItem.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./ConfigGlobal.ts","./MessageView.ts","./RoleDataCache.ts","./RoleDefine.ts","./ParkingControl.ts","./ParkingDataCache.ts","./ParkingDefine.ts","./BaseSubView.ts"],(function(t){"use strict";var i,e,n,o,s,r,a,d,h,l,c,u,f,C,v,m,p,g,S,k,T,b;return{setters:[function(t){i=t.inheritsLoose,e=t.createForOfIteratorHelperLoose},function(t){n=t.cclegacy,o=t.ScrollView,s=t.Label,r=t.Button,a=t.RichText,d=t.Color,h=t.Sprite},function(t){l=t.GuildPinItem},function(t){c=t.ListItem},function(t){u=t.default},function(t){f=t.default},function(t){C=t.default},null,function(t){v=t.ConfigGlobal},function(t){m=t.default},function(t){p=t.RoleDataCache},function(t){g=t.PlayerAttr},function(t){S=t.default},function(t){k=t.ParkingDataCache},function(t){T=t.ParkingEventDefine},function(t){b=t.BaseSubView}],execute:function(){n._RF.push({},"7d7c5rLrehBkrsklYZECsMY","ParkingCrossSpaceView",void 0);t("default",function(t){function n(){var i;return(i=t.call(this)||this).scrollList=void 0,i.scrollItemList=void 0,i.txtServerRank=void 0,i.txtDefRank=void 0,i.txtAtkRank=void 0,i.txtTitle=void 0,i.nodeStatus1=void 0,i.nodeStatus2=void 0,i.nodeStatus3=void 0,i.btnList={},i.curType=0,i.closeState=void 0,i.countTime=void 0,i.countTimeNode=void 0,i.nodeNote=void 0,i.countTimer=void 0,i.timeCount=0,i.nodeBuff1=void 0,i.nodeBuff2=void 0,i.nodeTip=void 0,i.txtTips=void 0,i.leftTime=0,i.name="ParkingCrossSpaceView",i.url="ui/module/parking/sub/ParkingCrossSpaceView",i}i(n,t);var h=n.prototype;return h.onInit=function(){var t=this,i=this.findChildComponent("root/scroll",o);this.scrollList=this.addUIList(i,_);var e=this.findChildComponent("root/item/ScrollView",o);this.scrollItemList=this.addUIList(e,I),this.txtTitle=this.findChildComponent("root/item/title/txtFilter",s);var n=this.findChild("root/bg/status1/btnReward");this.addComponentCallbackListener(n,r.EventType.CLICK,(function(){uiMgr.openView("ParkingCrossRewardView")}));var a=this.findChild("root/bg/status1/btnRank");this.addComponentCallbackListener(a,r.EventType.CLICK,(function(){uiMgr.openView("ParkingCrossRankView")})),this.txtServerRank=this.findChildComponent("root/bg/status1/server",s),this.txtDefRank=this.findChildComponent("root/bg/status1/def",s),this.txtAtkRank=this.findChildComponent("root/bg/status1/atk",s),this.nodeStatus1=this.findChild("root/bg/status1"),this.nodeStatus2=this.findChild("root/bg/status2"),this.nodeStatus3=this.findChild("root/bg/status3");for(var d=function(i){var e=t.findChild("root/bg/btn"+i);t.btnList[i]={normal:u.findChild(e,"normal"),select:u.findChild(e,"select"),index:i},t.addComponentCallbackListener(e,r.EventType.CLICK,(function(){t.switchNodeShow(i)}))},h=1;h<4;h++)d(h);var l=this.findChild("root/item/title/btnBack");this.addComponentCallbackListener(l,r.EventType.CLICK,(function(){t.findChild("root/item").active=!1}));var c=this.findChild("imgTitle/btnRule");this.addComponentCallbackListener(c,r.EventType.CLICK,(function(){uiMgr.openView("ParkingRuleTips",[201897,2018971,2018972,2018973])})),this.closeState=this.findChild("root/none"),this.countTime=this.findChildComponent("root/none/nodeTime/txtTime",s),this.countTimeNode=this.findChild("root/none/nodeTime"),this.nodeNote=this.findChild("root/note"),this.addComponentCallbackListener(this.nodeNote,r.EventType.CLICK,(function(){uiMgr.openView("ParkingCrossNoteView")})),this.nodeBuff1=this.findChild("root/bg/status2/gg_ui_debuff"),this.nodeBuff2=this.findChild("root/bg/status3/gg_ui_debuff"),this.nodeTip=this.findChild("root/tips");var f=this.findChild("root/tips/mask");this.nodeTip.active=!1,this.addComponentCallbackListener(this.nodeBuff1,r.EventType.CLICK,(function(){t.nodeTip.active=t.txtTips.string.length>0})),this.addComponentCallbackListener(this.nodeBuff2,r.EventType.CLICK,(function(){t.nodeTip.active=t.txtTips.string.length>0})),this.addComponentCallbackListener(f,r.EventType.CLICK,(function(){t.nodeTip.active=!1})),this.txtTips=this.findChildComponent("root/tips/txt",s)},h.registerUpdateHandler=function(){this.addEvent(T.PARKING_SPACE_UPDATE,this.onUpdateLogList,this),this.addEvent(T.PARKING_CROSS_REFRESH_RANK_INFO,this.onUpdateReport,this),this.addEvent(T.PARKING_CROSS_SHOW_PUBLIC_SPOT,this.showCrossSpotInfo,this),this.addEvent(T.PARKING_CROSS_STATUS_INFO,this.onUpdateStatus,this)},h.onAfterOpen=function(){var t=this;this.curType=0,this.findChild("root/item").active=!1,this.nodeNote.active=!1,this.trySetParent(),IS(k).checkCrossOpen()&&(IS(S).reqCrossParkPreview(),IS(S).reqCrossParkRank(),this.addTimer(1,-1,(function(){t.timeCount+=1,t.onUpdateStatus()}))),this.onUpdateLogList(null),this.switchNodeShow(1)},h.onBeforeClose=function(){},h.onDestroy=function(){},h.showCrossSpotInfo=function(t){this.txtTitle.string="[s"+t+"]"+GetLanguage(201731),this.findChild("root/item").active=!0,this.scrollItemList.datas=IS(k).getCrossSpotInfoByID(t)},h.switchNodeShow=function(t){if(t!=this.curType){for(var i in this.curType=t,this.nodeStatus1.active=!1,this.nodeStatus2.active=!1,this.nodeStatus3.active=!1,this.btnList){var e=this.btnList[i];e&&(e.select.active=t==e.index)}1==t?this.nodeStatus1.active=!0:2==t?(this.nodeStatus2.active=!0,IS(S).reqCrossParkRoleState(0)):3==t&&(this.nodeStatus3.active=!0,IS(S).reqCrossParkRoleState(1))}},h.onUpdateReport=function(t){var i,n,o,s,r,d,h;this.scrollList.datas=null!=(i=t.rank_list)?i:[],this.txtServerRank.string="-";for(var l,c=e(null!=(C=t.rank_list)?C:[]);!(l=c()).done;){var C,v=l.value;v.server_id==IS(p).GetServerId()&&(this.txtServerRank.string=v.rank+"")}if(this.txtDefRank.string=(null!=(n=t.def_kill)?n:0)+this.getRankTxt(Number(null!=(o=t.def_rank)?o:0)),this.txtAtkRank.string=(null!=(s=t.atk_kill)?s:0)+this.getRankTxt(Number(null!=(r=t.atk_rank)?r:0)),(null!=(d=null==(h=t.log_list)?void 0:h.length)?d:0)>0){this.nodeNote.active=!0;var m=Math.round(this.timeCount/15);m>t.log_list.length-1&&(m=0,this.timeCount=0);var g=t.log_list[m],S=f.formatStr(GetLanguage(203830),g.new_server,g.old_server,g.park_id%100);u.findChildComponent(this.nodeNote,"Label",a).string=S}else this.nodeNote.active=!1},h.getRankTxt=function(t){switch(t){case 0:return"";case 1:return"(1st)";case 2:return"(2nd)";case 3:return"(3rd)"}return"("+t+"th)"},h.onUpdateStatus=function(){var t,i=this;if(this.timeCount%15==0&&this.onUpdateReport(IS(k).CrossRankInfo),1!=this.curType){var n=IS(k).roleState[2==this.curType?0:1],o=null;0==n.type?o=this.nodeStatus2:1==n.type&&(o=this.nodeStatus3);for(var a,h=0,l=0,c=0,m=e(n.data_list);!(a=m()).done;){var p=a.value;1==p.k?h=p.v:2==p.k?l=p.v:3==p.k&&(c=p.v)}var g=u.findChildComponent(o,"num1",s),T=u.findChildComponent(o,"num2",s),b=u.findChildComponent(o,"num3",s),_=u.findChildComponent(o,"lv",s),I=u.findChildComponent(o,"num4",s),P=u.findChildComponent(o,"num5",s);_.string=l>0?l+"":"",I.string=C.formatTimeForSecond(c-C.serverTime),I.color=c-C.serverTime>0?new d(255,231,95):new d(186,186,186),P.string=C.formatTimeForSecond(n.freeze_time-C.serverTime),P.color=n.freeze_time-C.serverTime>0?new d(255,231,95):new d(186,186,186),g.string=h/100+"%",g.color=this.getColorByNum(h/100);var L=configPark_pvp_debuff.getDataByKeys("num",l,"type",1==n.type?4:3),w=100-(null!=(t=null==L?void 0:L.desc_parm[0])?t:0);T.string=w+"%",T.color=this.getColorByNum(w),b.string=w+"%",b.color=this.getColorByNum(w),this.txtTips.string=f.formatStr.apply(f,[L.debuff_desc].concat(L.desc_parm));var x=u.findChild(o,"cd"),N=u.findChild(o,"not"),R=u.findChild(o,"can"),y=u.findChild(o,"ing"),D=u.findChild(o,"ing/btnGo");this.addComponentCallbackListener(D,r.EventType.CLICK,(function(){IS(S).reqCrossParkDetail(n.park_id),i.parentView.close()}));var B=v.park_cross_open_time[2==this.curType?2:1],E=C.checkInTimeRange(B[1],B[2]);if(1==n.type){var M=C.ServerDate(1e3*C.serverTime).getHours();M>=0&&M<8&&(E=!1)}x.active=!1,R.active=!1,y.active=!1,N.active=!1,IS(k).checkCrossOpen()&&E?0!=n.park_id?y.active=!0:n.freeze_time>C.serverTime?x.active=!0:R.active=!0:N.active=!0}},h.getColorByNum=function(t){return 100==t?new d(35,153,16):t<100&&t>=30?new d(198,109,5):new d(215,66,66)},h.onUpdateLogList=function(t){var i=this;if(IS(k).checkCrossOpen()){this.scrollItemList.node.active=!0,this.scrollList.node.active=!0,this.closeState.active=!1;var e=IS(k).getCrossParkRankInfo();this.scrollList.datas=e}else{this.scrollItemList.node.active=!1,this.scrollList.node.active=!1,this.closeState.active=!0,this.countTimer&&this.removeTimer(this.countTimer),this.leftTime=0;var n=C.getLocalTimeToUTC8(2024,4,29,0,0,0)-C.lastServerTime,o=IS(p).GetRoleAttr(g.ROLE_ATTR_CREATE_DAY)+86400*v.park_cross_creat_limit-C.serverTime,s=C.ServerDate(1e3*IS(k).nextStamp).getTime()/1e3-C.lastServerTime;this.leftTime=Math.max(s,o,n),this.updateCountDown(),this.countTimer=this.addTimer(1,-1,(function(){i.updateCountDown()}))}},h.updateCountDown=function(){this.leftTime-=1,this.leftTime<0&&(this.countTimer&&this.removeTimer(this.countTimer),IS(S).reqCrossParkPreview(),IS(S).reqCrossParkRank()),this.countTime.string=C.getTimeLeft(this.leftTime)},h.onGotoOtherParkingSpace=function(t){uiMgr.openView("ParkingMainView",t),this.parentView.close()},h.trySetParent=function(){var t=uiMgr.getOpenView("ParkingSpaceView");t&&t.nodeSubRoot&&this.node.setParent(t.nodeSubRoot)},n}(b));var _=t("ParkingCrossItemMaker",function(t){function e(){for(var i,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(i=t.call.apply(t,[this].concat(n))||this).txtName=void 0,i.txtCoin=void 0,i.txtSpot=void 0,i.icon=void 0,i.nodeFlag=void 0,i.btnParkingSpace=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){var t=this;this.txtName=u.findChildComponent(this.node,"txtName",s),this.txtCoin=u.findChildComponent(this.node,"numCoin/num",s),this.txtSpot=u.findChildComponent(this.node,"numSpace/num",s),this.icon=u.findChildComponent(this.node,"icon",h),this.view.adjustMirrorNode(u.findChild(this.node,"numCoin/gg_icon_cheweibi"),0,!0),this.view.adjustMirrorNode(u.findChild(this.node,"numSpace/gg_icon_cheweibi"),0,!0),this.nodeFlag=new l(this.view,u.findChild(this.node,"GuildPinItem")),this.btnParkingSpace=u.findChild(this.node,"btnParkingSpace"),this.view.adjustMirrorNode(u.findChild(this.node,"btnParkingSpace"),0,!0),this.view.addComponentCallbackListener(this.btnParkingSpace,r.EventType.CLICK,(function(){normalEvent.emit(T.PARKING_CROSS_SHOW_PUBLIC_SPOT,t.data.server_id)}))},n.onRender=function(t,i){var e;null!=t&&(this.txtName.string="[s"+t.server_id+"]"+f.formatStrWithMirrorDeal(GetLanguage(201712),""),this.txtSpot.string=null!=(e=IS(k).getCrossSpotInfoByID(t.server_id).length+"")?e:"0",this.txtCoin.string=f.GetNumString(t.coin_value),this.view.loadIcon(this.icon,"common","common_ICON_paiming0"+(i+1)),this.nodeFlag.SetItem(t.guild_flag))},e}(c)),I=t("ParkingCrossDetailItemMaker",function(t){function n(){for(var i,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(i=t.call.apply(t,[this].concat(n))||this).nodeFull=void 0,i.txtName=void 0,i.txtNameCross=void 0,i.txtAtkNum=void 0,i.txtDefNum=void 0,i.nodeCD=void 0,i.nodePublic=void 0,i.nodeCross=void 0,i.nodeProtect=void 0,i.buffList=[],i.btnParkingSpace=void 0,i.sel1=void 0,i.sel2=void 0,i.protectTimer=void 0,i}i(n,t);var o=n.prototype;return o.onInit=function(){var t=this;this.nodePublic=u.findChild(this.node,"node1"),this.nodeCross=u.findChild(this.node,"node2"),this.nodeCD=u.findChild(this.node,"node1/nodecd"),this.nodeProtect=u.findChild(this.node,"node2/nodecd"),this.view.addComponentCallbackListener(this.nodeProtect,r.EventType.CLICK,(function(){m.showFlyTip(f.formatStrWithMirrorDeal(GetLanguage(203829),C.formatDate(C.ServerDate(1e3*t.data.info.protect_end),"yyyy-MM-dd hh:mm:ss")))})),this.txtName=u.findChildComponent(this.node,"node1/txtName",s),this.txtAtkNum=u.findChildComponent(this.node,"node2/atkNum",s),this.txtDefNum=u.findChildComponent(this.node,"node2/defNum",s),this.view.adjustMirrorNode(u.findChild(this.node,"imgFrame/imgIcon"),0,!0),this.view.adjustMirrorNode(u.findChild(this.node,"btnParkingSpace/node1"),0,!0),this.view.adjustMirrorNode(u.findChild(this.node,"btnParkingSpace/node"),0,!0),this.nodeFull=u.findChild(this.node,"imgFrame/nodeFull"),this.txtName=u.findChildComponent(this.node,"node1/txtName",s),this.txtNameCross=u.findChildComponent(this.node,"node2/txtName",s);for(var i=u.findChild(this.node,"nodeBuff"),e=1;e<=3;e++){var n={node:u.findChild(i,"buff"+e),icon:u.findChildComponent(i,"buff"+e+"/icon",h),txtBuff:u.findChildComponent(i,"buff"+e+"/buff/txtBuff",s)};this.view.adjustMirrorNode(n.icon.node,0,!0),this.buffList[e]=n}this.btnParkingSpace=u.findChild(this.node,"btnParkingSpace"),this.view.addComponentCallbackListener(this.btnParkingSpace,r.EventType.CLICK,(function(){t.view.parentView.close(),IS(S).reqCrossParkDetail(t.data.info.id)})),this.sel1=u.findChild(this.node,"node2/state/sel1"),this.sel2=u.findChild(this.node,"node2/state/sel2")},o.onRender=function(t,i){var n=this;this.checkBuffShow();var o=t.info.id%100;this.txtNameCross.string=f.formatStrWithMirrorDeal(GetLanguage(201712),o),this.nodePublic.active=!1,this.nodeCross.active=!0,this.checkProtectShow(),this.protectTimer&&this.view.removeTimer(this.protectTimer),this.protectTimer=this.view.addTimer(1,-1,(function(){n.checkProtectShow()})),this.nodeFull.active=!1,this.txtAtkNum.string=this.data.info.atk_num,this.txtDefNum.string=this.data.info.def_num;for(var s,r=-1,a=0,d=e(t.info.ext);!(s=d()).done;){var h=s.value;1==h.k&&(r=h.v),2==h.k&&(a=h.v)}this.nodeFull.active=0==r,this.sel1.active=1==a,this.sel2.active=2==a,u.findChild(this.btnParkingSpace,"node1").active=!1,u.findChild(this.btnParkingSpace,"node").active=!0;for(var l,c=e(IS(k).getParkingCarList());!(l=c()).done;){var C=l.value;if(IS(k).car_list[C].parking_data.master_id==t.info.id){u.findChild(this.btnParkingSpace,"node1").active=!0,u.findChild(this.btnParkingSpace,"node").active=!1;break}}},o.checkBuffShow=function(){for(var t,i=v.park_cross_buff,n=e(i);!(t=n()).done;){var o=t.value;"coin"==o[0]?this.buffList[1].txtBuff.string="+"+o[1]/100+"%":"exp"==o[0]?this.buffList[2].txtBuff.string="+"+o[1]/100+"%":"spec"==o[0]&&(this.buffList[3].txtBuff.string="+"+o[1]/100+"%")}},o.checkProtectShow=function(){var t=this.data.info.protect_end;this.nodeProtect.active=t-C.serverTime>0,this.nodeProtect.getComponent(s).string=GetLanguage_UI(999000110)+" "+C.getTimeLeft(t-C.serverTime)},n}(c));n._RF.pop()}}}));

