System.register("chunks:///_virtual/ActivitySevenTaskView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./TimeUtil.ts","./index57.ts","./ConfigGlobal.ts","./BagModel.ts","./ChapterDataCache.ts","./MessageView.ts","./GuildControl.ts","./MainViewModel.ts","./PayControl.ts","./PayDataCache.ts","./PayDefine.ts","./RoleDataCache.ts","./ActivityControl.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./ActivitySevenDataCache.ts","./ActivitySevenView2.ts","./BaseSubView.ts"],(function(t){"use strict";var i,e,n,s,a,o,d,r,h,c,f,u,v,l,p,y,I,g,m,C,G,w,S,b,k,_,L,T,x,A,D;return{setters:[function(t){i=t.inheritsLoose,e=t.createForOfIteratorHelperLoose},function(t){n=t.cclegacy,s=t.Button,a=t.Label,o=t.ProgressBar,d=t.ScrollView,r=t.js},function(t){h=t.ItemGrid},function(t){c=t.ListItem},function(t){f=t.default},function(t){u=t.default},null,function(t){v=t.ConfigGlobal},function(t){l=t.BagModel},function(t){p=t.ChapterDataCache},function(t){y=t.default},function(t){I=t.default},function(t){g=t.MainViewModel},function(t){m=t.default},function(t){C=t.default},function(t){G=t.PayEventDefine,w=t.GiftType},function(t){S=t.RoleDataCache},function(t){b=t.default},function(t){k=t.default},function(t){_=t.ActivityEventDefine,L=t.ActivityState,T=t.ActivityTaskState},function(t){x=t.default},function(t){A=t.tabType},function(t){D=t.BaseSubView}],execute:function(){var B;n._RF.push({},"1b1b2pTASlAL51qwxXuO4eF","ActivitySevenTaskView",void 0);var U=((B={})[1]=84,B[2]=85,B[3]=86,B[4]=87,B[5]=88,B[6]=89,B[7]=90,B),P=v.seven_trial_reward,O=(t("default",function(t){function n(){var i;return(i=t.call(this)||this).itemGrid=void 0,i.canGet=void 0,i.txtTitle=void 0,i.payList=void 0,i.taskList=void 0,i.curIndex=0,i.curDay=0,i.dayList=[],i.pb=void 0,i.txtLeftTime=void 0,i.deltaTime=0,i.leftTime=0,i.canUpdate=!1,i.defalutTaskId=void 0,i.name="ActivitySevenTaskView",i}i(n,t);var r=n.prototype;return r.setActive=function(t){for(var i=arguments.length,e=new Array(i>1?i-1:0),n=1;n<i;n++)e[n-1]=arguments[n];this.isActive!=t?(this.isActive=t,t?this.open.apply(this,e):this.close()):1==t&&this.SetIndex(e[0])},r.onInit=function(){var t=this.findChild("topBg/tips");this.addComponentCallbackListener(t,s.EventType.CLICK,(function(){IS(k).ShowSysTips(U[1])}));var i=this.findChild("topBg/reward/itemGrid");this.canGet=this.findChild("topBg/reward/canGet"),this.itemGrid=new h(this,i,(function(){IS(x).canGetLastReward2()?IS(b).send_24_86(2):IS(l).OpenItemTips(P[0],i)})),this.txtTitle=this.findChildComponent("topBg/txtTitle",a),this.txtLeftTime=this.findChildComponent("topBg/txtLeftTime",a),this.pb=this.findChildComponent("day/pb",o);for(var e=1;e<=7;e++){var n=new O;n.init(this.findChild("day/dayList/day"+e),this,e),this.dayList.push(n)}var r=this.findChildComponent("payList",d);this.payList=this.addUIList(r,V);var c=this.findChildComponent("taskList",d);this.taskList=this.addUIList(c,E)},r.registerUpdateHandler=function(){this.addEvent(G.PAY_INFO_UPDATE,this.OnPayGiftInfoUpdate,this),this.addEvent(_.OnActivityInfoTaskUpdate,this.OnTaskUpdate,this),this.addEvent(_.OnActivityInfoUpdate,this.OnActUpdate,this),this.addEvent(_.OnActivitySevenInfoUpdate,this.OnActUpdate,this)},r.onAfterOpen=function(){var t;this.itemGrid.SetItemId(P[0],P[1]);for(var i=0,n=1;n<=7;n++){IS(b).send_24_14(U[n]),IS(k).GetActivityInfo(U[n])&&(i=n)}this.pb.progress=i/7,this.canGet.active=IS(x).canGetLastReward2();var s=IS(k).GetActivityInfo(U[1]),a=null!=(t=s.state_time[s.state])?t:s.state_time[L.Open];this.leftTime=a.end_time-u.serverTime,this.leftTime>0?(this.canUpdate=!0,this.txtLeftTime.string=u.formatTimeStringForSecond(this.leftTime)):this.txtLeftTime.string=GetLanguage(200026);for(var o,d=e(this.dayList);!(o=d()).done;){o.value.show()}i=this.getDefalutInfo(i),this.SetDay(i,!0),this.SetIndex(this.openArgs)},r.getDefalutInfo=function(t){for(var i=new Array,e=new Array,n=1;n<=t;n++){var s=IS(k).GetActivityInfo(U[n]).task_list;for(var a in s)s[a].state==T.CanGet&&i.push({taskId:s[a].task_id,day:n}),s[a].state==T.Normal&&e.push({taskId:s[a].task_id,day:n})}return i.length>0?(i.sort((function(t,i){return t.taskId-i.task_id})),this.defalutTaskId=i[0].taskId,i[0].day):e.length>0?(e.sort((function(t,i){return t.day!=i.day?i.day-t.day:t.taskId-i.task_id})),this.defalutTaskId=e[0].taskId,e[0].day):(this.defalutTaskId=null,t)},r.onBeforeClose=function(){this.canUpdate=!1,this.curIndex=0,this.curDay=0,this.defalutTaskId=null},r.onDestroy=function(){},r.onUpdate=function(t){this.canUpdate&&(this.deltaTime=this.deltaTime+t,this.deltaTime>=1&&(this.deltaTime=0,this.leftTime=this.leftTime-1,this.leftTime>0?this.txtLeftTime.string=u.formatTimeStringForSecond(this.leftTime):(this.txtLeftTime.string=GetLanguage(200026),this.canUpdate=!1)))},r.SetIndex=function(t){this.curIndex!=t&&(this.curIndex=t,this.curIndex==A.pay?(this.findChild("topBg/reward").active=!1,this.payList.node.active=!0,this.taskList.node.active=!1,this.txtTitle.string=GetLanguage_UI(300523),this.OnPayGiftInfoUpdate()):this.curIndex==A.task&&(this.findChild("topBg/reward").active=!0,this.payList.node.active=!1,this.taskList.node.active=!0,this.txtTitle.string=GetLanguage_UI(300522),this.OnTaskUpdate()))},r.SetDay=function(t,i){if(i||this.curDay!=t){this.curDay=t,this.curIndex==A.pay?this.OnPayGiftInfoUpdate():this.curIndex==A.task&&this.OnTaskUpdate();for(var n,s=e(this.dayList);!(n=s()).done;){n.value.show()}}},r.OnActUpdate=function(){for(var t=0,i=1;i<=7;i++){IS(k).GetActivityInfo(U[i])&&(t=i)}this.pb.progress=t/7;for(var n,s=e(this.dayList);!(n=s()).done;){n.value.show()}this.canGet.active=IS(x).canGetLastReward2(),this.OnTaskUpdate()},r.OnPayGiftInfoUpdate=function(){if(0!=this.curDay){for(var t,i=IS(k).GetActivityInfo(U[this.curDay]),n=IS(C).GetAcivityGift(w.Activity,i.type,i.round),s=e(this.dayList);!(t=s()).done;){t.value.show()}n.sort((function(t,i){var e=IS(C).GetPayGiftInfo(t.id),n=IS(C).GetPayGiftInfo(i.id),s=e&&e.bought_times&&e.bought_times>=e.payCfg.buy_times;return s!=(n&&n.bought_times&&n.bought_times>=n.payCfg.buy_times)?s?1:-1:t.id-i.id})),this.payList.datas=n}},r.OnTaskUpdate=function(t){if(0!=this.curDay){t&&(this.canGet.active=IS(x).canGetLastReward2());for(var i,n=e(this.dayList);!(i=n()).done;){i.value.show()}var s=IS(k).GetActivityInfo(U[this.curDay]),a=[];for(var o in s.task_list)s.task_list.hasOwnProperty(o)&&a.push(s.task_list[o]);for(var d in a.sort((function(t,i){return 1==t.state&&1!=i.state?-1:1!=t.state&&1==i.state?1:t.state!=i.state?t.state-i.state:t.id-i.id})),s.group_task_list)s.group_task_list.hasOwnProperty(d)&&a.unshift(s.group_task_list[d]);if(this.taskList.datas=a,this.defalutTaskId)for(var r=0;r<a.length;r++)if(a[r].task_id==this.defalutTaskId){this.taskList.scrollTo(r,null,1);break}this.defalutTaskId=null}},n}(D)),function(){function t(){this.view=void 0,this.node=void 0,this.index=void 0,this.normal=void 0,this.selected=void 0,this.lock=void 0,this.red=void 0,this.nodeFinish=void 0}var i=t.prototype;return i.init=function(t,i,e){this.view=i,this.node=t,this.index=e,this.onInit()},i.onInit=function(){var t=this;this.normal=f.findChild(this.node,"normal"),this.selected=f.findChild(this.node,"selected"),this.lock=f.findChild(this.node,"lock"),this.red=f.findChild(this.node,"red"),this.nodeFinish=f.findChild(this.node,"finish"),this.view.addComponentCallbackListener(this.node,s.EventType.CLICK,(function(){t.normal.active&&t.view.SetDay(t.index)}))},i.show=function(){this.selected.active=this.view.curDay==this.index;var t=IS(k).GetActivityInfo(U[this.index]);if(this.lock.active=!t,this.normal.active=!this.selected.active&&!this.lock.active,this.view.curIndex==A.pay){if(this.red.active=!1,t)for(var i,n=IS(C).GetAcivityGift(w.Activity,t.type,t.round),s=e(n);!(i=s()).done;){var a=i.value;if(0==a.price){var o=IS(C).GetPayGiftInfo(a.id);if(!o||2!=o.rewardState){this.red.active=!0;break}}}this.nodeFinish.active=!1}else if(this.view.curIndex==A.task){var d;if(this.red.active=t&&IS(k).GetTaskRedNum(t.type)>0,t&&t.group_task_list)for(var r in t.group_task_list)if(t.group_task_list.hasOwnProperty(r)){d=t.group_task_list[r];break}this.nodeFinish.active=d&&d.state==T.HadGet}},t}()),V=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return(i=t.call.apply(t,[this].concat(n))||this).txtName=void 0,i.txtPrice=void 0,i.btnBuy=void 0,i.out=void 0,i.rewardScroll=void 0,i.bg1=void 0,i.bg2=void 0,i.discountNode=void 0,i.txtDiscount=void 0,i.red=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){var t=this;this.bg1=f.findChild(this.node,"imgBg"),this.bg2=f.findChild(this.node,"imgBg2"),this.txtName=f.findChildComponent(this.node,"title/Label",a),this.txtPrice=f.findChildComponent(this.node,"btnBuy/Label",a),this.red=f.findChild(this.node,"btnBuy/red"),this.out=f.findChild(this.node,"out"),this.btnBuy=f.findChild(this.node,"btnBuy"),this.discountNode=f.findChild(this.node,"btnBuy/discount"),this.txtDiscount=f.findChildComponent(this.node,"btnBuy/discount/Label",a),this.view.addComponentCallbackListener(this.btnBuy,s.EventType.CLICK,(function(){0==t.data.price?IS(m).send_19_2(t.data.id):IS(C).Pay(t.data.id)}));var i=f.findChildComponent(this.node,"rewardScroll",d);this.rewardScroll=this.view.addUIList(i,N)},n.onRender=function(t,i){this.txtName.string=t.name,this.rewardScroll.datas=t.reward,this.bg1.active=0!=t.price,this.bg2.active=0==t.price;var e=IS(C).GetPayGiftInfo(t.id);0==t.ratio?this.discountNode.active=!1:(this.discountNode.active=!0,this.txtDiscount.string=100*t.ratio+"%"),0==t.price?(this.txtPrice.string=GetLanguage(200045),e&&2==e.rewardState?(this.out.active=!0,this.btnBuy.active=!1,this.red.active=!1):(this.out.active=!1,this.btnBuy.active=!0,this.red.active=!0)):(this.red.active=!1,this.txtPrice.string=IS(C).GetPriceString(t.cost_level),0==t.buy_times?(this.out.active=!1,this.btnBuy.active=!0):e&&e.bought_times&&e.bought_times>=e.payCfg.buy_times?(this.out.active=!0,this.btnBuy.active=!1):(this.out.active=!1,this.btnBuy.active=!0))},e}(c),E=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return(i=t.call.apply(t,[this].concat(n))||this).txtDesc=void 0,i.btnGet=void 0,i.received=void 0,i.undone=void 0,i.rewardScroll=void 0,i.btnGo=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){var t=this;this.txtDesc=f.findChildComponent(this.node,"txtDesc",a),this.received=f.findChild(this.node,"received"),this.undone=f.findChild(this.node,"undone"),this.btnGet=f.findChild(this.node,"btnGet"),this.view.addComponentCallbackListener(this.btnGet,s.EventType.CLICK,(function(){IS(b).send_24_15(U[t.view.curDay],t.data.task_id,t.data.group_id)}));var i=f.findChildComponent(this.node,"rewardScroll",d);this.rewardScroll=this.view.addUIList(i,N),this.btnGo=f.findChild(this.node,"btnGo"),this.view.addComponentCallbackListener(this.btnGo,s.EventType.CLICK,(function(){var i=t.data.cfg.acces;if(null!=i&&0!=i){var e=configGoods_source.getDataByKey(i),n=!0;if(0==e.newopen_func||IS(S).CheckFuncOpen(e.newopen_func,!0)||(n=!1),n){if(""!=e.view)if("MainView"==e.view)IS(g).TryJumpToMainViewPanel(e.openArgs[0],e.openArgs[1],e.openArgs[2]);else{if(("GuildDonateView"==e.view||"SingleEnterView"==e.view)&&!IS(S).HasGuild())return void y.showFlyTip(GetLanguage(200165));if("SingleEnterView"==e.view)IS(I).send_29_21(1);else{var s,a=e.openArgs.slice(0);(s=uiMgr).openView.apply(s,[e.view].concat(a))}}uiMgr.close("ActivitySevenView2")}}}))},n.onRender=function(t,i){if(0==t.task_id?this.txtDesc.string=GetLanguage(201665):this.txtDesc.string=t.cfg.desc+r.formatStr("(%s/%s)",t.count,t.cfg.condition[2]),this.rewardScroll.datas=t.cfg.reward,t.state==T.CanGet)this.received.active=!1,this.undone.active=!1,this.btnGet.active=!0,this.btnGo.active=!1;else if(t.state==T.HadGet)this.received.active=!0,this.undone.active=!1,this.btnGet.active=!1,this.btnGo.active=!1;else{this.received.active=!1,this.btnGet.active=!1;var e=this.data.cfg.acces;if(null==e||0==e)this.undone.active=!0,this.btnGo.active=!1;else{var n=configGoods_source.getDataByKey(e);IS(p).curChapterId>n.chapter_id?(this.undone.active=!1,this.btnGo.active=!0):(this.undone.active=!0,this.btnGo.active=!1)}}},e}(c),N=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return(i=t.call.apply(t,[this].concat(n))||this).itemGridNode=void 0,i.itemGrid=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){this.itemGridNode=f.findChild(this.node,"itemGrid"),this.itemGrid=new h(this.view,this.itemGridNode)},n.onRender=function(t,i){this.itemGrid.SetItemId(t[0],t[1])},e}(c);n._RF.pop()}}}));

