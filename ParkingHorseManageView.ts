System.register("chunks:///_virtual/ParkingHorseManageView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./BaseView.ts","./ConfigGlobal.ts","./HorseDataChche.ts","./ParkingControl.ts","./ParkingDataCache.ts","./ParkingDefine.ts"],(function(t){"use strict";var i,e,n,r,o,a,s,h,d,l,c,f,u,g,C,v,m,_,p,S,L,y;return{setters:[function(t){i=t.inheritsLoose,e=t.createForOfIteratorHelperLoose},function(t){n=t.cclegacy,r=t.Button,o=t.ScrollView,a=t.Label,s=t.RichText,h=t.Layout,d=t.ProgressBar,l=t.js,c=t.Sprite},function(t){f=t.ItemGrid},function(t){u=t.ListItem},function(t){g=t.default},function(t){C=t.default},function(t){v=t.default},function(t){m=t.BaseView},function(t){_=t.ConfigGlobal},function(t){p=t.HorseDataCache},function(t){S=t.default},function(t){L=t.ParkingDataCache},function(t){y=t.ParkingEventDefine}],execute:function(){n._RF.push({},"a8d7aj5m7ZICK0/Bgan18Mu","ParkingHorseManageView",void 0);t("default",function(t){function n(){var i;return(i=t.call(this)||this).scrollAward=void 0,i.attrUIList=void 0,i.attrTopUIList=void 0,i.scrollCar=void 0,i.starUIList=void 0,i.cur_Sel_Car=void 0,i.cur_pos=void 0,i.horseEffectID=void 0,i.btnLeft=void 0,i.btnRight=void 0,i.carList=[],i.nodeParking=void 0,i.nodeCD=void 0,i.txtCD=void 0,i.txtRate=void 0,i.txtParkTime=void 0,i.btnUse=void 0,i.btnCancel=void 0,i.name="ParkingHorseManageView",i.url="ui/module/parking/ParkingHorseManageView",i.poolTime=3e3,i}i(n,t);var c=n.prototype;return c.onInit=function(){var t=this,i=this.findChild("btnClose");this.addComponentCallbackListener(i,r.EventType.CLICK,(function(){t.close()})),this.btnLeft=this.findChild("root/nodeShow/btnLeft"),this.btnRight=this.findChild("root/nodeShow/btnLeft");var n=this.findChildComponent("root/nodePreview/ScrollView",o);this.scrollAward=this.addUIList(n,I);var h=this.findChildComponent("root/nodeChange/ScrollView",o);this.attrUIList=this.addUIList(h,w);var d=this.findChildComponent("root/nodeTop/ScrollView",o);this.attrTopUIList=this.addUIList(d,w);var l=this.findChildComponent("root/ScrollView",o);this.scrollCar=this.addUIList(l,x);var c=this.findChildComponent("root/nodeShow/ScrollView",o);this.starUIList=this.addUIList(c,k),this.btnLeft=this.findChild("root/nodeShow/btnLeft"),this.addComponentCallbackListener(this.btnLeft,r.EventType.CLICK,(function(){for(var i,n=e(t.carList);!(i=n()).done;){var r=i.value;if(r.id==t.cur_Sel_Car){t.cur_Sel_Car=t.carList[t.carList.indexOf(r)-1].id;break}}t.updateData()})),this.btnRight=this.findChild("root/nodeShow/btnRight"),this.addComponentCallbackListener(this.btnRight,r.EventType.CLICK,(function(){for(var i,n=e(t.carList);!(i=n()).done;){var r=i.value;if(r.id==t.cur_Sel_Car){t.cur_Sel_Car=t.carList[t.carList.indexOf(r)+1].id;break}}t.updateData()})),this.btnCancel=this.findChild("root/nodeShow/btnCancel"),this.addComponentCallbackListener(this.btnCancel,r.EventType.CLICK,(function(){IS(S).reqShowCar(0)})),this.btnUse=this.findChild("root/nodeShow/btnUse"),this.addComponentCallbackListener(this.btnUse,r.EventType.CLICK,(function(){IS(S).reqShowCar(t.cur_Sel_Car)}));var f=this.findChild("root/ProgressBar/btnAdd");this.addComponentCallbackListener(f,r.EventType.CLICK,(function(){uiMgr.openView("ParkingHorseExpAddView",203,t.cur_Sel_Car)})),this.txtRate=this.findChildComponent("root/nodeGain/num",a),this.txtParkTime=this.findChildComponent("root/nodeGain/txtParkTime",s)},c.registerUpdateHandler=function(){this.addEvent(y.PARKING_CHANGE_CUR_SEL_CAR,this.updateData,this),this.addEvent(y.PARKING_CUR_PARKING_INFO_UPDATE,this.refreshHorseChange,this),this.addEvent(y.PARKING_CAR_LIST_UPDATE,this.updateData,this)},c.onAfterOpen=function(){var t,i=this;IS(S).reqCarListInfo(),this.carList=[];for(var n,r=configParking_mount.getDataByList("level",1),o=e(r);!(n=o()).done;)for(var a,s=n.value,h=e(IS(p).skin_list);!(a=h()).done;){var d=a.value;s.id==d.k&&this.carList.push(s)}this.carList.sort((function(t,i){var e=configMount.getDataByKey(t.id),n=configMount.getDataByKey(i.id);return e.quality>n.quality?-1:1})),this.carList=this.carList.filter((function(t,e){return i.carList.indexOf(t)===e})),this.cur_Sel_Car=this.carList[0].id,this.cur_pos=null!=(t=this.openArgs[0])?t:0,this.updateData()},c.onBeforeClose=function(){this.carList=[]},c.onDestroy=function(){},c.refreshHorseChange=function(){var t,i,e,n=this.findChild("root/nodeShow/icon"),r=this.findChildComponent("root/nodeShow/bgName/txtName",a);this.removeUIEffect(this.horseEffectID),this.horseEffectID=this.addUIEffect(configMount.getDataByKey(this.cur_Sel_Car).path,n,-1),this.refreshTxtMirrorByLayout(this.findChildComponent("root/nodeShow/bgName",h)),this.refreshTxtMirrorByLayout(this.findChildComponent("root/nodeChange/common_ui_xiaotidi",h)),this.refreshTxtMirrorByLayout(this.findChildComponent("root/nodePreview/common_ui_xiaotidi",h)),this.adjustMirrorNode(this.findChild("root/nodePreview/common_ui_xiaotidi/txtName-001"),0,!0),this.adjustMirrorNode(this.findChild("root/nodeChange/common_ui_xiaotidi/txtName-001"),0,!0),this.adjustMirrorNode(this.findChild("root/nodeShow/bgName/txtName"),0,!0),this.adjustMirrorNode(this.findChild("root/ProgressBar/Node/gg_icon_zuoqijingyan"),0,!0);var o=configMount.getDataByKey(this.cur_Sel_Car);r.string=o.name;var s=IS(L).car_list[this.cur_Sel_Car],d=null!=(t=null==(i=configParking_mount.getDataByKeys("id",this.cur_Sel_Car,"level",null!=(e=null==s?void 0:s.car_lev)?e:0))?void 0:i.drop_show)?t:[];this.scrollAward.datas=d,this.checkPageBtn()},c.checkPageBtn=function(){this.btnLeft.active=!0,this.btnRight.active=!0;for(var t,i=e(this.carList);!(t=i()).done;){var n=t.value;n.id==this.cur_Sel_Car&&(0==this.carList.indexOf(n)&&(this.btnLeft.active=!1),this.carList.indexOf(n)==this.carList.length-1&&(this.btnRight.active=!1))}this.cur_Sel_Car==IS(L).show_car?this.btnCancel.active=!0:this.btnCancel.active=!1},c.refreshAttrChange=function(){var t,i,e=this.findChild("root/nodeChange"),n=this.findChild("root/nodeTop"),r=g.findChildComponent(e,"txtLevelBase",a),o=g.findChildComponent(e,"txtLevelNext",a),s=g.findChildComponent(n,"txtLevelBase",a),h=IS(L).car_list[this.cur_Sel_Car],d=configParking_mount.getDataByKeys("id",this.cur_Sel_Car,"level",null!=(t=null==h?void 0:h.car_lev)?t:0),l=configParking_mount.getDataByKeys("id",this.cur_Sel_Car,"level",(null!=(i=null==h?void 0:h.car_lev)?i:0)+1),c=[],f=[];if(null!=d)if(null!=l){r.string=d.level+"",o.string=l.level+"";for(var u=0;u<d.own_attrs.length;u++){var C=configAttribute.getDataByKey(d.own_attrs[u][0]),v={show_type:C.show_type,name:C.desc,base:d.own_attrs[u][1],next:l.own_attrs[u][1]};c.push(v)}this.attrUIList.datas=c,e.active=!0,n.active=!1}else{s.string=d.level+"";for(u=0;u<d.own_attrs.length;u++){var m=configAttribute.getDataByKey(d.own_attrs[u][0]),_={show_type:m.show_type,name:m.desc,base:d.own_attrs[u][1]};f.push(_)}this.attrTopUIList.datas=f,e.active=!1,n.active=!0}},c.refreshProgress=function(){var t,i,e,n=IS(L).car_list[this.cur_Sel_Car],r=configParking_mount.getDataByKeys("id",this.cur_Sel_Car,"level",null!=(t=null==n?void 0:n.car_lev)?t:0);if(null!=r){var o=this.findChildComponent("root/ProgressBar",d),s=this.findChildComponent("root/ProgressBar/txtDesc",a),h=r.expend,l=configParking_mount.getDataByKeys("id",this.cur_Sel_Car,"level",(null!=(i=null==n?void 0:n.car_lev)?i:0)+1);if(null==l)return o.progress=1,void(s.string=h+"/"+h);var c=null!=(e=null==n?void 0:n.car_exp)?e:0;c-=h,h=l.expend-r.expend,o.progress=c/h,s.string=c+"/"+h}},c.refreshStarInfo=function(){for(var t=configParking_mount.getDataByList("id",this.cur_Sel_Car),i=[0,0,0,0,0],e=0;e<t.length;e++){i[e%5]+=1}this.starUIList.datas=i},c.refreshRate=function(){var t,i=IS(L).car_list[this.cur_Sel_Car],e=configParking_mount.getDataByKeys("id",this.cur_Sel_Car,"level",null!=(t=null==i?void 0:i.car_lev)?t:1);this.txtRate.string=e.rate+"/min"},c.refreshParkTime=function(){var t=IS(L).car_list[this.cur_Sel_Car],i=0;if(0==t.parking_data.start_time)i=t.minute;else{var e=v.ServerDate(1e3*v.serverTime),n=v.ServerDate(1e3*t.parking_data.start_time),r=l.formatStr("%s/%s/%s %s:%s:%s",e.getFullYear(),e.getMonth()+1,e.getDate(),0,0,0);i=r==l.formatStr("%s/%s/%s %s:%s:%s",n.getFullYear(),n.getMonth()+1,n.getDate(),0,0,0)?t.minute+Math.min(Math.floor((v.serverTime-t.parking_data.start_time)/60),480):t.minute+Math.min(Math.floor((v.serverTime-Math.floor(v.getServerDateByLocalStr(r).getTime()/1e3))/60),480)}this.txtParkTime.string=i<720?C.formatStrWithMirrorDeal(GetLanguage(201450),i):GetLanguage(201451)},c.updateData=function(){var t=this;this.scrollCar.datas=this.carList,this.refreshHorseChange(),this.refreshRate(),this.refreshParkTime(),this.refreshAttrChange(),this.refreshProgress(),this.addTimer(1,-1,(function(){var i=IS(L).car_list[t.cur_Sel_Car];Math.min(Math.max(v.serverTime-i.parking_data.start_time,0),60*_.park_time_limit)%60==0&&t.refreshParkTime()}))},n}(m));var I=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(i=t.call.apply(t,[this].concat(n))||this).itemGridNode=void 0,i.itemGrid=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){this.itemGridNode=g.findChild(this.node,"itemGrid"),this.itemGrid=new f(this.view,this.itemGridNode)},n.onRender=function(t,i){this.itemGrid.SetItemId(t)},e}(u),w=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(i=t.call.apply(t,[this].concat(n))||this).txtAttrName=void 0,i.txtAttrBase=void 0,i.txtAttrNext=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){this.txtAttrName=g.findChildComponent(this.node,"txtAttrName",a),this.txtAttrBase=g.findChildComponent(this.node,"txtAttrBase",a),this.txtAttrNext=g.findChildComponent(this.node,"txtAttrNext",a)},n.onRender=function(t,i){this.txtAttrName.string=t.name,2==t.show_type?(this.txtAttrBase.string=l.formatStr("%s%",C.GetNumString(t.base/100)),this.txtAttrNext.string=l.formatStr("%s%",C.GetNumString(t.next/100))):3==t.show_type?(this.txtAttrBase.string=C.GetNumString(Math.floor(t.base/100)/100),this.txtAttrNext.string=C.GetNumString(Math.floor(t.next/100)/100)):(this.txtAttrBase.string=C.GetNumString(t.base),this.txtAttrNext.string=C.GetNumString(t.next))},n.onItemClick=function(){},e}(u),x=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(i=t.call.apply(t,[this].concat(n))||this).imgFrame=void 0,i.imgIcon=void 0,i.imgLock=void 0,i.imgRP=void 0,i.nodeUse=void 0,i.nodeSel=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){var t=this;this.imgFrame=g.findChildComponent(this.node,"frame",c),this.imgIcon=g.findChildComponent(this.node,"icon",c),this.imgLock=g.findChild(this.node,"lock"),this.imgRP=g.findChild(this.node,"rp"),this.nodeUse=g.findChild(this.node,"nodeUse"),this.nodeSel=g.findChild(this.node,"sel"),this.view.addComponentCallbackListener(this.node,r.EventType.CLICK,(function(){t.view.cur_Sel_Car=t.data.id,normalEvent.emit(y.PARKING_CHANGE_CUR_SEL_CAR)}))},n.onRender=function(t,i){var e=configMount.getDataByKey(t.id).icon_small,n=configMount.getDataByKey(t.id).quality,r=configColor.getDataByKey(n).path;this.view.loadIcon(this.imgFrame,"icon_equip",r),this.view.loadIcon(this.imgIcon,"icon_item",e);var o=this.view;this.nodeSel.active=o.cur_Sel_Car==t.id},e}(u),k=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return(i=t.call.apply(t,[this].concat(n))||this).imgOne=void 0,i.imgTwo=void 0,i.imgThree=void 0,i.imgDark=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){this.imgOne=g.findChild(this.node,"one"),this.imgTwo=g.findChild(this.node,"two"),this.imgThree=g.findChild(this.node,"three"),this.imgDark=g.findChild(this.node,"dark")},n.onRender=function(t,i){this.imgDark.active=0==t,this.imgOne.active=1==t,this.imgTwo.active=2==t,this.imgThree.active=3==t},e}(u);n._RF.pop()}}}));

