System.register("chunks:///_virtual/ResCachePool.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){"use strict";var t,o,s,i;return{setters:[function(e){t=e.createClass},function(e){o=e.cclegacy,s=e.isValid,i=e.sys}],execute:function(){o._RF.push({},"eb6a0D/mmRFaIO9oHw8sCuf","ResCachePool",void 0);e("ResCachePool",function(){function e(){this._poolMap=new Map,this._poolList=new Array}var o=e.prototype;return o.get=function(e){var t=this._poolMap.get(e);return t&&(s(t.asset)||(this.removeByUrl(t.url),t=null)),t},o.add=function(e){var t=this._poolMap,o=e.url;t.has(o)?printLogErr("AddResItem("+e.url+", "+e+") already exsit, not cache"):(t.set(o,e),this._poolList.push(e))},o.removeByUrl=function(e){var t=this._poolMap,o=this._poolList,s=t.get(e);if(null!=s){for(var i=o.length,r=0;r<i;++r)if(o[r]===s){o.splice(r,1);break}t.delete(e)}else printLogErr("DelResItem("+e+") not exsit");return s},o.removeByRes=function(e){for(var t=this._poolMap,o=this._poolList,s=o.length,i=0;i<s;++i)if(o[i]===e){o.splice(i,1),t.delete(o[i].url);break}},o.update=function(){this._stepClearup(3e3)},o.clearup=function(){this._stepClearup(3e3,!0)},o._stepClearup=function(e,t){void 0===t&&(t=!1);var o=this._poolList,s=this._poolList.length;ftime.beginFTime(ftime.ResCacheClear);for(var r=0;r<s;++r){var l=o[r];if(!(l.refCount>0)&&(!(i.now()<=l.requestTime+e)&&(l.destroy(),this._poolMap.delete(l.url),o.splice(r,1),r--,s=o.length,!t&&ftime.checkPass(ftime.ResCacheClear))))break}},o.clearAll=function(){for(var e=this._poolList,t=this._poolList.length,o=0;o<t;++o){e[o].destroy()}e.length=0,this._poolMap.clear()},t(e,[{key:"poolList",get:function(){return this._poolList}}]),e}());o._RF.pop()}}}));

