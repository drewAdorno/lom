System.register("chunks:///_virtual/ActivityAutumnGiftView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./RedPointMgr.ts","./NodeUtil.ts","./StorageUtil.ts","./StringUtil.ts","./index57.ts","./MessageView.ts","./PayDataCache.ts","./PayDefine.ts","./RoleDataCache.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./ActivityAutumnDataCache.ts","./BaseView.ts"],(function(t){"use strict";var i,e,n,o,a,r,s,u,d,c,f,l,h,m,y,v,g,p,I,G,S;return{setters:[function(t){i=t.inheritsLoose},function(t){e=t.cclegacy,n=t.Button,o=t.Label,a=t.ScrollView},function(t){r=t.ItemGrid},function(t){s=t.ListItem},function(t){u=t.RedPointMgr},function(t){d=t.default},function(t){c=t.default},function(t){f=t.default},null,function(t){l=t.default},function(t){h=t.default},function(t){m=t.PayEventDefine,y=t.GiftType},function(t){v=t.RoleDataCache},function(t){g=t.default},function(t){p=t.ActivityType,I=t.ActivityState},function(t){G=t.default},function(t){S=t.BaseView}],execute:function(){e._RF.push({},"0b17e5DtiFL8aLqai3TQ8gk","ActivityAutumnGiftView",void 0);t("default",function(t){function e(){var i;return(i=t.call(this)||this).txtNum=void 0,i.rewardScroll=void 0,i.txtPrice=void 0,i.limit=void 0,i.btn=void 0,i.payId=void 0,i.name="ActivityAutumnGiftView",i.url="ui/module/autumn/ActivityAutumnGiftView",i}i(e,t);var r=e.prototype;return r.onInit=function(){var t=this,i=this.findChild("imgMask");this.addComponentCallbackListener(i,n.EventType.CLICK,(function(){t.close()})),this.limit=this.findChild("bg/limit"),this.txtNum=this.findChildComponent("bg/btn/num/txtNum",o);var e=this.findChildComponent("bg/rewardScroll",a);this.rewardScroll=this.addUIList(e,b),this.rewardScroll.lackCenter=!0,this.txtPrice=this.findChildComponent("bg/btn/Label",o),this.btn=this.findChild("bg/btn"),this.addComponentCallbackListener(this.btn,n.EventType.CLICK,(function(){if(t.payId){var i=IS(h).GetPayGiftInfo(t.payId);if(i.bought_times>=i.payCfg.buy_times)return void l.showFlyTip(GetLanguage(200027));IS(h).Pay(t.payId)}}))},r.registerUpdateHandler=function(){this.addEvent(m.PAY_INFO_UPDATE,this.updateInfo,this)},r.onAfterOpen=function(){var t=IS(g).GetActivityInfo(p.AutumnGift);if(t){var i,e=String(t.id)+"#"+String(t.round),n="ActivityAutumnGiftRed"+IS(v).GetRoleId();(null!=(i=c.get(n))?i:"")!=e&&(c.set(n,e),IS(g).UpdateMainRedByActType(t.type),IS(u).changeValue("autumn_gift",IS(G).GetGiftRed()))}this.updateInfo()},r.onBeforeClose=function(){this.payId=null},r.onDestroy=function(){},r.updateInfo=function(){var t=IS(g).GetActivityInfo(p.AutumnGift);if(t){this.btn.active=t.state==I.Open,this.limit.active=t.state==I.Preview;var i=IS(h).GetAcivityGift(y.Activity,t.type,t.round)[0],e=IS(h).GetPayGiftInfo(i.id);this.rewardScroll.datas=i.reward,this.payId=i.id,e&&e.bought_times?(e.bought_times>=i.buy_times?this.txtPrice.string=GetLanguage(200027):this.txtPrice.string=IS(h).GetPriceString(i.cost_level),this.txtNum.string=f.formatStrWithMirrorDeal(GetLanguage(200727)+"%s/%s",i.buy_times-e.bought_times,i.buy_times)):(this.txtPrice.string=IS(h).GetPriceString(i.cost_level),this.txtNum.string=f.formatStrWithMirrorDeal(GetLanguage(200727)+"%s/%s",i.buy_times,i.buy_times))}},e}(S));var b=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(i=t.call.apply(t,[this].concat(n))||this).itemGridNode=void 0,i.itemGrid=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){this.itemGridNode=d.findChild(this.node,"itemGrid"),this.itemGrid=new r(this.view,this.itemGridNode)},n.onRender=function(t,i){this.itemGrid.SetItemId(t[0],t[1])},e}(s);e._RF.pop()}}}));

