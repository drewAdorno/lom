System.register("chunks:///_virtual/WingDataCache.ts",["./rollupPluginModLoBabelHelpers.js","cc","./RedPointMgr.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./ConfigGlobal.ts","./ObjectUtil.ts","./BagModel.ts","./RoleDataCache.ts","./WingDefine.ts","./UIDefine.ts"],(function(t){"use strict";var e,i,n,a,l,s,o,r,c,h,u;return{setters:[function(t){e=t.createForOfIteratorHelperLoose},function(t){i=t.cclegacy},function(t){n=t.RedPointMgr},function(t){a=t.default},function(t){l=t.default},null,function(t){s=t.ConfigGlobal},function(t){o=t.default},function(t){r=t.BagModel},function(t){c=t.RoleDataCache},function(t){h=t.WingEvent},function(t){u=t.OpenFunction}],execute:function(){i._RF.push({},"bb2b09d/YlAq6U5+Z7JZaCU","WingDataCache",void 0);t("WingDataCache",function(){function t(){this.isSendProto=void 0,this.wing_id=void 0,this.prviewId=void 0,this.feather_list={},this.talent_list=void 0,this.skin_list=void 0,this.skill_use=void 0,this.collection_list={},this.wingRed={},this.talentTypeRed={},this.talentRed={},this.skinRed=0,this.collectionRed={},this.bookAddlev=0,this.cacheMaxTalent={},this.cacheFirstTalent={},this.curTalentTab=1,this.tempTalentTypeRed={},this.tempTalentRed={}}var i=t.prototype;return i.clear=function(){},i.SetWingData=function(t){this.wing_id=t.use,this.feather_list={};for(var e=0;e<t.feather_list.length;e++){var i=t.feather_list[e];this.feather_list[i.cfg_id]=i}this.curTalentTab=t.tab,this.talent_list={};for(var n=0;n<t.tab_list.length;n++){var a=t.tab_list[n].talent_type_list,l={tab:t.tab_list[n].tab,name:t.tab_list[n].name,count:t.tab_list[n].count,talentDict:{}};this.talent_list[t.tab_list[n].tab]=l;for(var s=0;s<a.length;s++)for(var o=a[s].talent_list,r=0;r<o.length;r++)l.talentDict[o[r].k]=o[r].v}this.skin_list={};for(var c=0;c<t.skin_list.length;c++)this.skin_list[t.skin_list[c].k]=t.skin_list[c].v;this.collection_list={};for(var u=0;u<t.collection_list.length;u++)this.collection_list[t.collection_list[u]]=!0;this.skill_use=t.skill_use,this.UpdateFeatureRed(),this.checkSkinRP(),this.UpdateTalentRed(),this.UpdateCollectionRed(),normalEvent.emit(h.TYPE_WING_CHANGE)},i.UpdateFeatureData=function(t){this.feather_list[t.feather.cfg_id]=t.feather,this.UpdateFeatureRed(),this.UpdateCollectionRed(),normalEvent.emit(h.TYPE_WING_CHANGE)},i.UpdateWingId=function(t){this.wing_id=t.use,normalEvent.emit(h.TYPE_WING_CHANGE)},i.UpdateTalentList=function(t){this.talent_list[t.tab]||(this.talent_list[t.tab]={tab:t.tab,name:"",count:0,talentDict:{}}),this.talent_list[t.tab]&&(this.talent_list[t.tab].count=t.count,this.talent_list[t.tab].talentDict[t.talent.k]=t.talent.v,this.UpdateTalentRed(t.tab),normalEvent.emit(h.TYPE_WING_TALENT_CHANGE))},i.ResetTalentList=function(t){if(this.talent_list[t.tab]){this.talent_list[t.tab].count=t.count;var e=o.copyObject(this.talent_list[t.tab].talentDict);for(var i in e){configBack_talent.getDataByKey(i).job_type==t.type&&delete this.talent_list[t.tab].talentDict[i]}this.UpdateTalentRed(t.tab),normalEvent.emit(h.TYPE_WING_TALENT_CHANGE)}},i.GetFeatureInfo=function(t){var e;return null!=(e=this.feather_list[t])?e:{cfg_id:t,level:0,exp:0}},i.GetTalentInfo=function(t,e){var i,n=null!=e?e:this.curTalentTab;return this.talent_list&&this.talent_list[n]&&null!=(i=this.talent_list[n].talentDict[t])?i:0},i.GetWingIsOpen=function(t){for(var e=s.back_decoration_unlock,i=0;i<e.length;i++)if(e[i][0]==t)for(var n=0;n<e.length;n++){var a=e[i][1][n][0],l=e[i][1][n][1];if(!this.feather_list[a]||this.feather_list[a].level+this.GetBookAddLev()<l)return[!1,l]}return[!0,0]},i.getSkinLevelByID=function(t){var e;return this.skin_list&&null!=(e=this.skin_list[t])?e:0},i.checkWingCanShow=function(t){var e=configBack_decoration.getDataByKey(t);if(null==e)return!1;var i=e.open_time;return!!o.isEmpty(i)||l.checkOpenTime(i)},i.getAllWingState=function(t){var e=this.getWingState(t);return 5==e&&this.getSkinLevelByID(t)>0?2:e},i.getWingState=function(t){if(this.wing_id==t)return 4;if(!configBack_skin.getDataByKey(t))return this.GetWingIsOpen(t)[0]?2:1;var e=configBack_skin.getDataByKeys("back_id",t,"skin_level",this.getSkinLevelByID(t));return null==e.expend||0==e.expend.length?t==this.wing_id?4:3:IS(r).getGoodsCountByGoodsGtid(e.expend[0][0])>=e.expend[0][1]?5:t==this.wing_id?4:0==e.attr.length?1:2},i.UpdateFeatureRed=function(){if(IS(c).CheckFuncOpen(u.FUNC_BACK)){var t={},e=IS(r).getGoodsCountByGoodsGtid(1084),i=configBack_level.getDataListByMainKey("id");if(e>0)for(var a in i){var l=Number(a),s=this.GetFeatureInfo(l),o=configBack_level.getDataByKeys("id",l,"level",s.level+1);if(null!=o&&1!=o.era_level){var d=o.expend_exp;e>=(d-=s.exp)&&(t[l]=1)}}this.wingRed=t,IS(n).changeValue("wing_red",this.GetWingRed()),normalEvent.emit(h.TYPE_WING_FEATURE_RED_CHANGE)}},i.GetWingRedById=function(t){var e;return null!=(e=this.wingRed[t])?e:0},i.UpdateTalentRed=function(t){if(IS(c).CheckFuncOpen(u.FUNC_BACK)){t||(t=this.curTalentTab);for(var e={},i={},a={},l=!0,s=1;s<=3;s++)for(var o=this.GetCurTypeAllFirstTalent(s),d=0;d<o.length;d++){if(this.GetTalentInfo(o[d],t)>0){l=!1,a[s]=!0;break}}var _=configBack_talent.getDataListByMainKey("id"),f=0;this.talent_list&&this.talent_list[t]&&(f=this.talent_list[t].count);var v=IS(r).getGoodsCountByGoodsGtid(1085)-f;for(var g in _){var T=Number(g),G=this.GetTalentInfo(T,t);if(_[g].length!=G){var p=_[g][G];if(p&&(a[p.job_type]||l)){var k=!0;0==G&&(k=this.GetTalentIsActive(T,t));for(var b=0;b<p.cost.length;b++)k&&v>=p.cost[b][1]&&(e[p.job_type]||(e[p.job_type]=!0),i[p.id]=!0)}}}t&&t!=this.curTalentTab?(this.tempTalentTypeRed[t]=e,this.tempTalentRed[t]=i):(this.talentTypeRed=e,this.talentRed=i,IS(n).changeValue("wing_red",this.GetWingRed())),normalEvent.emit(h.TYPE_WING_TALENT_RED_CHANGE)}},i.GetTalentIsActive=function(e,i){if(this.GetTalentInfo(e,i)>0)return!0;var n=configBack_talent.getDataListByMainKey("id"),a=n[e][0];if(0==a.condition_1.length){for(var l=this.GetCurTypeAllFirstTalent(a.job_type),s=0;s<l.length;s++){if(this.GetTalentInfo(l[s],i)>0){var o=n[l[s]][0],r=this.GetCurTypeMaxTalent(o.job_type,o.color_type);if(0==this.GetTalentInfo(r,i))return!1}}return!0}for(var c=1;c<=2;c++)if(a["condition_"+c].length>0){for(var h=!0,u=0;u<a["condition_"+c].length;u++){var d=a["condition_"+c][u][0],_=a["condition_"+c][u][1];if(IS(t).GetTalentInfo(d,i)<_){h=!1;break}}if(h)return this.GetTalentlevIsFull(e,i)}return!1},i.GetTalentlevIsFull=function(t,e){var i=configBack_talent.getDataListByMainKey("id")[t][0];if(this.GetCurTypeMaxTalent(i.job_type,i.color_type)==t)for(var n=0,a=1;a<=3;a++)for(var l=1;l<=3;l++){var s=this.GetCurTypeMaxTalent(a,l);if(this.GetTalentInfo(s,e)>0&&++n>=3)return!1}return!0},i.GetCurTypeMaxTalent=function(t,e){if(this.cacheMaxTalent[t]&&this.cacheMaxTalent[t][e])return this.cacheMaxTalent[t][e];var i=configBack_talent.getDatas();if(i&&i.length>0){for(var n=0,a=0;a<i.length;a++){var l=i[a].id;t==i[a].job_type&&e==i[a].color_type&&l>n&&(n=l)}return this.cacheMaxTalent[t]||(this.cacheMaxTalent[t]={}),this.cacheMaxTalent[t][e]=n,n}return 0},i.GetCurTypeAllFirstTalent=function(t){if(this.cacheFirstTalent[t])return this.cacheFirstTalent[t];this.cacheFirstTalent[t]||(this.cacheFirstTalent[t]=[]);var e=configBack_talent.getDatas();if(e&&e.length>0)for(var i=0;i<e.length;i++)e[i].job_type==t&&1==e[i].level&&0==e[i].condition_1.length&&this.cacheFirstTalent[t].push(e[i].id);return this.cacheFirstTalent[t]},i.GetTalenTypeRed=function(t,e){var i,n;return e&&e!=this.curTalentTab?this.tempTalentTypeRed[e]&&null!=(n=this.tempTalentTypeRed[e][t])?n:0:null!=(i=this.talentTypeRed[t])?i:0},i.GetTalenRedById=function(t,e){var i,n;return e&&e!=this.curTalentTab?this.tempTalentRed[e]&&null!=(n=this.tempTalentRed[e][t])?n:0:null!=(i=this.talentRed[t])?i:0},i.GetWingUpgradRed=function(){for(var t in this.wingRed)return 1;return 0},i.GetWingTalentRed=function(){for(var t in this.talentTypeRed)return 1;return 0},i.GetWingRed=function(){return this.GetWingTalentRed()+this.GetWingUpgradRed()+this.skinRed+this.GetCollectionRed()},i.ChangeUseSkill=function(t){this.skill_use=t.skill_use,normalEvent.emit(h.TYPE_WING_USE_SKILL)},i.UpdateSkinLevel=function(t){this.skin_list||(this.skin_list={}),this.skin_list[t.skin.k]=t.skin.v,this.checkSkinRP(),normalEvent.emit(h.TYPE_WING_CHANGE)},i.UpdateCollection=function(t){this.collection_list[t.cfg_id]=!0,this.UpdateCollectionRed(),normalEvent.emit(h.TYPE_WING_CHANGE)},i.checkSkinRP=function(){this.skinRed=0;for(var t,i=configBack_skin.getDataByList("skin_level",0),a=e(i);!(t=a()).done;){var l=t.value;if(this.checkWingCanShow(l.back_id)&&this.GetWingCanUp(l.back_id)){this.skinRed=1;break}}IS(n).changeValue("wing_red",this.GetWingRed()),normalEvent.emit(h.TYPE_WING_SKIN_RED_CHANGE)},i.GetWingCanUp=function(t){var e=configBack_skin.getDataByKeys("back_id",t,"skin_level",this.getSkinLevelByID(t));return null!=e.expend&&e.expend.length>0&&IS(r).getGoodsCountByGoodsGtid(e.expend[0][0])>=e.expend[0][1]},i.GetSkinRed=function(){return this.skinRed},i.GetCollectionIsActive=function(t){return this.collection_list[t]},i.GetCollectionRedById=function(t){return this.collectionRed[t]},i.GetCollectionRed=function(){for(var t in this.collectionRed)return 1;return 0},i.UpdateCollectionRed=function(){this.collectionRed={};var t=this.bookAddlev;if(this.bookAddlev=0,this.skin_list)for(var e=configBack_book.getDatas(),i=0;i<e.length;i++){var n=e[i];if(this.collection_list[n.id])this.bookAddlev+=n.level;else{for(var a=!0,l=0;l<n.condition.length;l++){var s=n.condition[l];this.getWingState(s)<=1&&(a=!1)}a&&(this.collectionRed[n.id]=!0)}}t!=this.bookAddlev&&normalEvent.emit(h.TYPE_WING_CHANGE),normalEvent.emit(h.TYPE_WING_BOOK_RED_CHANGE)},i.GetBookAddLev=function(){return this.bookAddlev},i.GetTalentAttrList=function(t){var e,i=null==(e=this.talent_list[t])?void 0:e.talentDict,n=[],a={},l={},s=[],o=configBack_talent.getDataListByMainKey("id");if(i)for(var r in i){var c=o[r][i[r]-1];if(c){for(var h=0;h<c.attr.length;h++){var u=1==configAttribute.getDataByKey(c.attr[h][0]).num_type?1:100;if(a[c.attr[h][0]])a[c.attr[h][0]].value=(a[c.attr[h][0]].value*u+c.attr[h][1])/u;else{var d={attr_id:c.attr[h][0],value:c.attr[h][1]/u};a[c.attr[h][0]]=d,n.push(d)}}for(var _=0;_<c.skill.length;_++)if(!l[c.skill[_][0]]){var f={skill_id:c.skill[_][0]};l[c.skill[_][0]]=f,s.unshift(f)}}}return n.sort((function(t,e){return t.attr_id<e.attr_id?-1:1})),s.concat(n)},i.GetPlanName=function(t){if(this.talent_list[t]){var e=this.talent_list[t].name;return""==e?a.formatStrWithMirrorDeal(GetLanguage(200488),t):e}return a.formatStrWithMirrorDeal(GetLanguage(200488),t)},i.GetTabInfo=function(t){return this.talent_list[t]},i.UpdateTab=function(t){this.curTalentTab=t.new_tab,this.UpdateTalentRed(),normalEvent.emit(h.TYPE_WING_TALENT_CHANGE)},i.UpdateTabName=function(t){this.talent_list[t.tab]||(this.talent_list[t.tab]={tab:t.tab,name:"",count:0,talentDict:{}}),this.talent_list[t.tab].name=t.name,normalEvent.emit(h.TYPE_WING_TALENT_TAB_NAME_CHANGE)},i.GetTalentTabItemCount=function(t){return this.talent_list[t]?IS(r).getGoodsCountByGoodsGtid(1085)-this.talent_list[t].count:IS(r).getGoodsCountByGoodsGtid(1085)},t}());i._RF.pop()}}}));

