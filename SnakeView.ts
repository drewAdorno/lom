System.register("chunks:///_virtual/SnakeView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./NodeUtil.ts","./index57.ts","./MessageView.ts","./GameCenterControl.ts","./GameCenterModel.ts","./SnakeVo.ts","./BaseView.ts"],(function(t){"use strict";var e,i,s,n,h,r,o,c,a,d,l,u,f;return{setters:[function(t){e=t.inheritsLoose,i=t.createClass,s=t.assertThisInitialized},function(t){n=t.cclegacy,h=t.Button,r=t.Rect},function(t){o=t.default},null,function(t){c=t.default},function(t){a=t.default},function(t){d=t.default},function(t){l=t.EDire,u=t.SnakeVo},function(t){f=t.BaseView}],execute:function(){var p;n._RF.push({},"e3c89XvRU9MOatiTeGAcK1x","SnakeView",void 0),window.openSnakeView=function(t){void 0===t&&(t=1),uiMgr.openView("SnakeView",t)},function(t){t[t.Level_1=1]="Level_1",t[t.Level_2=2]="Level_2"}(p||(p={}));t("default",function(t){function n(){var e;return(e=t.call(this)||this).session=void 0,e.gdApple=void 0,e._rect1=new r,e._rect2=new r,e._rect3=new r,e._rectOver=new r,e._rectEnd=new r,e._rectStart=new r,e._rectApple=new r,e.snakeList={},e._poolSnakeList=[],e.length=3,e.SPEED=.02,e.A_SPEED_Y=2,e._timerId=-1,e._aSpeedY=0,e._down=!1,e._end=!1,e._section=p.Level_1,e.temp=new r,e.name="SnakeView",e.url="ui/module/jumping/SnakeView",window.SnakeView=s(e),e}e(n,t);var f=n.prototype;return f.onInit=function(){var t=this;this.addComponentCallbackListener(this.findChild("imgMask"),h.EventType.CLICK,(function(){t.onCloseClick()})),this.addComponentCallbackListener(this.findChild("btnClose"),h.EventType.CLICK,(function(){t.onCloseClick()})),this.addComponentCallbackListener(this.findChild("btn/btnUp"),h.EventType.CLICK,(function(){t.onOperateClick(l.Up)})),this.addComponentCallbackListener(this.findChild("btn/btnDown"),h.EventType.CLICK,(function(){t.onOperateClick(l.Down)})),this.addComponentCallbackListener(this.findChild("btn/btnLeft"),h.EventType.CLICK,(function(){t.onOperateClick(l.Left)})),this.addComponentCallbackListener(this.findChild("btn/btnRight"),h.EventType.CLICK,(function(){t.onOperateClick(l.Right)})),this.addComponentCallbackListener(this.findChild("btnReset"),h.EventType.CLICK,(function(){t.onStartClick()}))},f.setSession=function(t){var e=this.findChild("session1"),i=this.findChild("session2");e.active=1==t,i.active=2==t,this.session=this.findChild("session"+t),this.gdApple=o.findChild(this.session,"gdApple"),this.setRect(this._rect1,o.findChild(this.session,"ground1")),this.setRect(this._rect2,o.findChild(this.session,"ground2")),this.setRect(this._rect3,o.findChild(this.session,"ground3")),this.setRect(this._rectOver,o.findChild(this.session,"gdOver")),this.setRect(this._rectEnd,o.findChild(this.session,"gdEnd")),this.setRect(this._rectStart,o.findChild(this.session,"gdStart")),this.setRect(this._rectApple,this.gdApple)},f.setRect=function(t,e){e?t.set(e.position.x,e.position.y,e.width,e.height):t.set(0,0,0,0)},f.onCloseClick=function(){this.close()},f.onStartClick=function(){this.onBeforeClose(),this.onAfterOpen()},f.registerUpdateHandler=function(){},f.onAfterOpen=function(){var t=this;this._section=this.openArgs[0]||p.Level_1,this.setSession(this._section),this._timerId<0&&(this._timerId=this.addTimer(this.SPEED,-1,(function(){t.onLoop()})));for(var e=1;e<=this.length;e++){var i=void 0;this._poolSnakeList.length?(i=this._poolSnakeList.pop()).parant=this.session:i=new u(this.session,(function(){t.updatePose()})),i.init(e,this),e<this.length?(i.setXY(this._rectStart.x-this._rectStart.width*(e-1),this._rectStart.y),i.dire=l.Right):(i.setXY(this._rectStart.x-this._rectStart.width*(e-2),this._rectStart.y-this._rectStart.height),i.dire=l.Up),this.snakeList[i.id]=i}this.updatePose()},f.clearTimer=function(){this._timerId>0&&(this.removeTimer(this._timerId),this._timerId=-1)},f.clearSnake=function(){for(var t=1;t<=this.length;t++){var e=this.snakeList[t];e&&(e.clear(),this._poolSnakeList.push(e),delete this.snakeList[t])}},f.onBeforeClose=function(){this.clearTimer(),this.clearSnake(),this.length=3,this.down=!1,this.gdApple.active=!0},f.onDestroy=function(){},f.onOperateClick=function(t){var e=this;if(this.log(t),this.down)this.log("mini-正在下落");else{var i=this.snakeList[1],s=i.rect.clone(),n=i.next,h=this.snakeList[this.length];switch(t){case l.Up:s.y+=s.height;break;case l.Down:s.y-=s.height;break;case l.Left:s.x-=s.width;break;case l.Right:s.x+=s.width}for(;n;){if(s.containsRect(n.rect))return void this.log("mini-方向错误");n=n.next}if(this.checkIntersects(this._rect1,s)||this.checkIntersects(this._rect2,s)||this.checkIntersects(this._rect3,s))this.log("mini-撞地板");else{var r,o=h.rect.x,c=h.rect.y;if(i.operate(t),this.checkIsWin())this.winGame();else this.checkIntersects(this._rectApple,s)&&this.gdApple.active&&(this.gdApple.active=!1,this._poolSnakeList.length?(r=this._poolSnakeList.pop()).parant=this.session:r=new u(this.session,(function(){e.updatePose()})),r.init(++this.length,this),r.setXY(o,c),this.snakeList[r.id]=r),this.checkStatus(),this.updateDire(t),this.updatePose()}}},f.updateDire=function(t){for(var e=this.length;e>1;){this.snakeList[e].dire=this.snakeList[--e].dire}this.snakeList[e].dire=t},f.checkIntersects=function(t,e){if(t.intersects(e)){this.temp.set(0,0,0,0);var i=r.intersection(this.temp,t,e);if((i?i.width*i.height:0)>0)return!0}return!1},f.checkIsWin=function(){var t=this.snakeList[1];if(t.rect.intersects(this._rectEnd)){this.temp.set(0,0,0,0);var e=r.intersection(this.temp,t.rect,this._rectEnd);if((e?e.width*e.height:0)>100)return!0}return!1},f.checkStatus=function(){if(this.intersects(this._rectOver))return this.log("mini-掉陷阱"),this.down=!1,this.adjustXY(this._rectOver),void this.failGame();var t=this.intersects(this._rect1),e=this.intersects(this._rect2),i=this.intersects(this._rect3);if(!(t||e||i))return this.log("mini-掉一格"),void(this.down=!0);this.down=!1,t&&this.adjustXY(this._rect1),e&&this.adjustXY(this._rect2),i&&this.adjustXY(this._rect3)},f.intersects=function(t){if(0==t.width&&0==t.height)return!1;for(var e=1;e<=this.length;e++){if(this.snakeList[e].rect.intersects(t))return!0}return!1},f.adjustXY=function(t){var e=this.crossMaxSnake(t);if(e)for(var i=t.y+t.height-e.rect.y,s=1;s<=this.length;s++){var n=this.snakeList[s],h=n.rect.y;n.setXY(n.rect.x,h+i)}},f.updatePose=function(){for(var t=1;t<=this.length;t++){this.snakeList[t].updatePose()}},f.onLoop=function(){if(this.down){this._aSpeedY+=this.A_SPEED_Y;for(var t=1;t<=this.length;t++){var e=this.snakeList[t],i=e.rect.y;i-=this._aSpeedY,e.setXY(e.rect.x,i)}}this.checkStatus()},f.crossMaxSnake=function(t){this.temp.set(0,0,0,0);for(var e=0,i=null,s=1;s<=this.length;s++){var n=this.snakeList[s];if(this.checkIntersects(n.rect,t)){var h=r.intersection(this.temp,n.rect,t),o=h?h.width*h.height:0;o>0&&(!i||o>e)&&(i=n,e=o)}}return i},f.log=function(t){console.log(t)},f.failGame=function(){var t=this;this.end=!0,this.clearTimer(),this.log("mini-Game Over"),c.showBoxTip({tip:"关卡"+this._section+"通关失败，请重新开始！",btnCnt:1,func:function(e){t.onStartClick()},ensure:GetLanguage(200413)})},f.winGame=function(){var t=this;this.end=!0,this.clearTimer(),this.clearSnake(),this.log("mini-通关"),this._section<p.Level_2?c.showBoxTip({tip:"关卡"+this._section+"胜利,请前往下一关卡！",btnCnt:1,func:function(e){t._section=t.openArgs[0]=t._section+1,t.onStartClick()},ensure:GetLanguage(200414)}):c.showBoxTip({tip:"您已经通关全部的关卡！",btnCnt:1,func:function(e){t.close();var i=IS(d).getRewardInfo(4);i&&2!=i.status&&IS(a).repTakeReward(4)},ensure:GetLanguage(200129)})},i(n,[{key:"down",get:function(){return this._down},set:function(t){this._down=t,t||(this._aSpeedY=0)}},{key:"end",get:function(){return this._end},set:function(t){this._end=t}}]),n}(f));n._RF.pop()}}}));

