System.register("chunks:///_virtual/ActivityAutumnTurnView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./V2.ts","./index3.ts","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./StorageUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./SpineSkeleton.ts","./ConfigGlobal.ts","./BagDefine.ts","./BagModel.ts","./MessageView.ts","./RoleDefine.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./HorseCarnivalControl.ts","./HorseCarnivalDataCache.ts","./BaseView.ts","./EaseMethod.ts"],(function(t){"use strict";var i,e,n,o,r,s,a,d,h,c,l,f,u,p,m,w,v,g,C,T,y,I,_,L,S,R,k,x,G,V,b,A,E;return{setters:[function(t){i=t.inheritsLoose,e=t.createForOfIteratorHelperLoose},function(t){n=t.cclegacy,o=t.Button,r=t.HorizontalTextAlignment,s=t.Sprite,a=t.Label,d=t.ScrollView,h=t.RichText,c=t.Toggle,l=t.js},function(t){f=t.V2},null,function(t){u=t.ItemGrid},function(t){p=t.ListItem},function(t){m=t.default},function(t){w=t.default},function(t){v=t.default},function(t){g=t.default},null,function(t){C=t.SpineSkeleton},function(t){T=t.ConfigGlobal},function(t){y=t.BagEventDefine},function(t){I=t.BagModel},function(t){_=t.default},function(t){L=t.RoleEventDefine},function(t){S=t.default},function(t){R=t.ActivityType,k=t.ActivityEventDefine,x=t.ActivityState},function(t){G=t.default},function(t){V=t.HorseCarnivalDataCache},function(t){b=t.ViewEvent,A=t.BaseView},function(t){E=t.EasingMethod}],execute:function(){var D,M;n._RF.push({},"3ba2epP1jVOK6ZlPyD2ViI0","ActivityAutumnTurnView",void 0);var O=((D={})[1]="zq_ui_zhuanpan03",D[2]="zq_ui_zhuanpan04",D[3]="zq_ui_zhuanpan05",D),B=((M={})[1]=1054,M[2]=1054,M),j=(t("default",function(t){function n(){var i;return(i=t.call(this)||this).actType=void 0,i.nodeResParent=void 0,i.nodeResItem=void 0,i.nodeRolling=void 0,i.rollEff=void 0,i.bgEff=void 0,i.turnEff=void 0,i.resItems=void 0,i.btnGift=void 0,i.btnStore=void 0,i.togSkip=void 0,i.skipAnim=void 0,i.iconTen=void 0,i.iconOne=void 0,i.txtOne=void 0,i.txtTen=void 0,i.txtNumReward=void 0,i.numScroll=void 0,i.tipsGo=void 0,i.tipsScroll=void 0,i.imgPreview=void 0,i.iconRewardOne=void 0,i.iconRewardTen=void 0,i.txtRewardOne=void 0,i.txtRewardTen=void 0,i.preViewCount=0,i.refreshTimer=void 0,i.curTips=0,i.tipsTimer=0,i.txtLeftTime=void 0,i.deltaTime=0,i.leftTime=0,i.canUpdate=!1,i.jackpot=0,i.jackpotType=0,i.curIndex=0,i.finalIndex=0,i.reward_list=[],i.actionTime=2,i.moveTween=void 0,i.rerwardList=[],i.waitRewardList=[],i.rewardNum=12,i.extraReward=void 0,i.name="ActivityAutumnTurnView",i.url="ui/module/autumn/ActivityAutumnTurnView",i.poolTime=3e3,i.fullScreen=!0,i.actType=R.AutumnTurn,i}i(n,t);var u=n.prototype;return u.onInit=function(){var t=this;this.initResShow(),this.btnStore=this.findChild("root/bottomBtn/btnStore"),this.addComponentCallbackListener(this.btnStore,o.EventType.CLICK,(function(){uiMgr.openView("ActivityAutumnStoreView",R.Autumn)})),this.btnGift=this.findChild("root/bottomBtn/btnGift"),this.addComponentCallbackListener(this.btnGift,o.EventType.CLICK,(function(){uiMgr.openView("HorseCarnivalGiftView",R.AutumnTurn)}));var i=this.findChild("root/btnClose");this.addComponentCallbackListener(i,o.EventType.CLICK,(function(){t.close()}));var e=this.findChild("root/btnShow/btnShow");this.addComponentCallbackListener(e,o.EventType.CLICK,(function(){uiMgr.openView("SlumberPartyTipsView",e,t.actType)}));var n=this.findChild("root/turn/img/nodeTips/btnTips");this.addComponentCallbackListener(n,o.EventType.CLICK,(function(){for(var i=T.LIMITED_RANK_SYSTEM_DETAILS,e="",n=0;n<i.length;n++)i[n][0]==t.actType&&(e=GetLanguage(i[n][1]));""!=e&&_.showBoxTip({tip:e,btnCnt:1,horizontalAlign:r.LEFT})})),this.nodeRolling=this.findChild("root/turn/img/nodeRolling"),this.imgPreview=this.findChildComponent("root/turn/img/imgPreview",s),this.addComponentCallbackListener(this.imgPreview.node,o.EventType.CLICK,(function(){t.onClickPreview()})),this.txtLeftTime=this.findChildComponent("root/top/nodeTime/txtTime",a),this.txtNumReward=this.findChildComponent("root/numReward/num",a);var l=this.findChildComponent("root/numReward/ScrollView",d);this.numScroll=this.addUIList(l,j),this.tipsGo=this.findChild("root/top/tips");var f=this.findChildComponent("root/top/tips/ScrollView",d);this.tipsScroll=this.addUIList(f,N),this.iconOne=this.findChildComponent("root/btnOne/icon",s),this.iconTen=this.findChildComponent("root/btnTen/icon",s),this.txtOne=this.findChildComponent("root/btnOne/num",h),this.txtTen=this.findChildComponent("root/btnTen/num",h),this.iconRewardOne=this.findChildComponent("root/btnOne/iconBack",s),this.iconRewardTen=this.findChildComponent("root/btnTen/iconBack",s),this.txtRewardOne=this.findChildComponent("root/btnOne/numBack",a),this.txtRewardTen=this.findChildComponent("root/btnTen/numBack",a);var u=this.findChild("root/btnOne");this.addComponentCallbackListener(u,o.EventType.CLICK,(function(){t.onLottery(1)}));var p=this.findChild("root/btnTen");this.addComponentCallbackListener(p,o.EventType.CLICK,(function(){t.onLottery(2)})),this.togSkip=this.findChildComponent("root/toggleSkip",c),this.addComponentCallbackListener(this.togSkip.node,c.EventType.TOGGLE,(function(){t.togSkip.isChecked?w.set("SkipHCAnim",1):w.set("SkipHCAnim",0)})),this.skipAnim=this.findChild("skipAnim"),this.addComponentCallbackListener(this.skipAnim,o.EventType.CLICK,(function(){t.SkipAnim()}));for(var v=function(){var i=t.findChild("root/turn/itemRoll/itemGrid"+g),e={node:i,index:g,item_id:0,cfg_id:0,imgFram:m.findChildComponent(i,"imgFrame",s),imgIcon:m.findChildComponent(i,"imgIcon",s),num:m.findChildComponent(i,"num",a),select:m.findChild(i,"select"),light:m.findChild(i,"light"),limit:m.findChild(i,"nodeLimit")};t.addComponentCallbackListener(i,o.EventType.CLICK,(function(){0!=e.item_id&&IS(I).OpenItemTips(e.item_id,i)})),t.rerwardList.push(e)},g=0;g<this.rewardNum;g++)v()},u.initResShow=function(){var t=this;this.nodeResParent=this.findChild("resRoot"),this.nodeResItem=this.findChild("resRoot/resItem"),this.nodeResItem.active=!1;var i=[IS(V).GetCost(this.actType)[0]];this.resItems=new Array;for(var e=function(e){var n=nodeInstantiate.instantiate(t.nodeResItem),r=i[e];t.addComponentCallbackListener(n,o.EventType.CLICK,(function(){IS(I).OpenItemTips(r,m.findChild(n,"txtNum"))})),n.parent=t.nodeResParent,n.active=!0;var d=m.findChildComponent(n,"imgIcon",s),h=configGoods.getDataByKey(r);t.loadIcon(d,"icon_item",h.icon),t.resItems.push({node:n,txtNum:m.findChildComponent(n,"txtNum",a),goodsGtid:r})},n=0;n<i.length;n++)e(n)},u.registerUpdateHandler=function(){this.addEvent(k.OnHorseCarnivalUpdate,this.updateInfo,this),this.addEvent(k.OnHorseCarnivalReward,this.updateReward,this),this.addEvent(k.OnHorseCarnivalLottery,this.updateLotteryResult,this),this.addEvent(y.GOODS_INFO_UPDATE,this.updateResShow,this),this.addEvent(L.ROLE_RES_UPDATE,this.updateResShow,this),this.addEvent(b.ViewClose,this.onViewClose,this)},u.onAfterOpen=function(){var t,i=this;this.rollEff=null,this.bgEff=null,this.turnEff=null,this.updateResShow(),IS(G).send_24_16(this.actType),this.togSkip.isChecked=1==w.get("SkipHCAnim"),this.skipAnim.active=!1,this.nodeRolling.active=!1;var e=IS(S).GetActivityInfo(this.actType),n=null!=(t=e.state_time[e.state])?t:e.state_time[x.Open];this.leftTime=n.end_time-g.serverTime,this.leftTime>0?(this.canUpdate=!0,this.txtLeftTime.string=g.formatTimeStringForSecond(this.leftTime)):this.txtLeftTime.string=GetLanguage(200026);var o=IS(V).GetCost(this.actType),r=configGoods.getDataByKey(o[0]);this.loadIcon(this.iconOne,r.icon_group,r.icon),this.loadIcon(this.iconTen,r.icon_group,r.icon);var s=IS(V).GetDrawReward(this.actType),a=configGoods.getDataByKey(s[0]);this.loadIcon(this.iconRewardOne,a.icon_group,a.icon),this.loadIcon(this.iconRewardTen,a.icon_group,a.icon),this.txtRewardOne.string=l.formatStr("x%s",s[1]),this.txtRewardTen.string=l.formatStr("x%s",10*s[1]);var d=configMount_draw_cumulative_times.getDatas(),h=[];for(var c in d)if(d.hasOwnProperty(c)){var u=d[c];u.type==e.type&&u.group_id==e.roundCfg.group_id&&h.push(u)}this.numScroll.datas=h;var p=configMount_draw.getDatas(),m=[];for(var v in p)if(p.hasOwnProperty(v)){var T=p[v];T.type==e.type&&T.group_id==e.roundCfg.group_id&&m.push(T)}m.sort((function(t,i){return t.id-i.id}));for(var y=0;y<m.length;y++){var I=m[y],_=this.rerwardList[I.order-1];_.item_id=I.reward[0],_.num.string=I.reward[1],_.cfg_id=I.id;var L=configGoods.getDataByKey(_.item_id);this.loadIcon(_.imgIcon,L.icon_group,L.icon);var R=configColor.getDataByKey(L.quality);this.loadIcon(_.imgFram,"icon_equip",R.path),_.limit&&(_.limit.active=!1),_.select.active=!1,_.light.active=!1}if(this.clearTimer(),this.refreshTimer=this.addTimer(5,-1,(function(){i.preViewCount=3==i.preViewCount?1:i.preViewCount+1;var t=O[i.preViewCount];i.loadIcon(i.imgPreview,"autumn_turn",t)})),null==this.bgEff){this.bgEff=this.addUIEffect("prefab/ui-effect/MX_tx_zhongqiuzhuanpan",this.findChild("root/turn/itemRoll/bg"),-1,new f(0,-116),1,(function(t){t.node.getComponent(C).needAnimation="ren"}))}if(null==this.turnEff){this.turnEff=this.addUIEffect("prefab/ui-effect/MX_tx_zhongqiuzhuanpan",this.findChild("root/turn/img"),-1,new f(0,-43.5),1,(function(t){t.node.getComponent(C).needAnimation="deng1"}))}},u.clearTimer=function(){null!=this.refreshTimer&&(this.removeTimer(this.refreshTimer),this.refreshTimer=null)},u.onBeforeClose=function(){this.canUpdate=!1,this.curIndex=0,this.tipsTimer=0;for(var t=0;t<this.rerwardList.length;t++)this.rerwardList[t].select.active=!1,this.rerwardList[t].light.active=!1;this.jackpot=0,this.jackpotType=0,this.waitRewardList=[],this.extraReward=null,this.clearTimer()},u.onDestroy=function(){for(var t=0;t<this.resItems.length;t++)this.resItems[t].node.destroy();this.resItems={}},u.onUpdate=function(t){this.canUpdate&&(this.deltaTime=this.deltaTime+t,this.deltaTime>=1&&(this.deltaTime=0,this.leftTime=this.leftTime-1,this.leftTime>0?this.txtLeftTime.string=g.formatTimeStringForSecond(this.leftTime):(this.txtLeftTime.string=GetLanguage(200026),this.canUpdate=!1)))},u.updateResShow=function(){for(var t=0;t<this.resItems.length;t++)this.resItems[t].txtNum.string=v.GetNumString(IS(I).getGoodsCountByGoodsGtid(this.resItems[t].goodsGtid));var i,e,n=IS(V).GetCost(this.actType),o=IS(I).getGoodsCountByGoodsGtid(n[0]);o>=n[1]?(e="#5aff42",i="#27720d"):(e="#ff1f1f",i="#891000"),this.txtOne.string=l.formatStr("<b><outline color=%s width=2><color=%s>%s<color></outline></b>",i,e,n[1]),o>=10*n[1]?(e="#5aff42",i="#27720d"):(e="#ff1f1f",i="#891000"),this.txtTen.string=l.formatStr("<b><outline color=%s width=2><color=%s>%s<color></outline></b>",i,e,10*n[1])},u.updateInfo=function(){var t=this,i=IS(V).getInfo(this.actType);this.tipsGo.active=i.lucky_list.length>0,0!=this.tipsTimer&&this.removeTimer(this.tipsTimer),this.tipsGo.active&&(this.tipsScroll.datas=i.lucky_list,this.curTips=0,this.tipsTimer=this.addTimer(1,-1,(function(){t.curTips=t.curTips+1,t.curTips==i.lucky_list.length&&(t.curTips=0);var e=0==t.curTips?.2:1;t.tipsScroll.scrollTo(t.curTips,e)}))),this.updateReward()},u.updateReward=function(){var t=IS(V).getInfo(this.actType);this.txtNumReward.string=t.count+"",this.numScroll.updateAll(),this.findChildComponent("root/turn/img/nodeTips/drawNum",a).string=IS(V).getInfo(this.actType).remain_draw+"";for(var i,n=e(this.rerwardList);!(i=n()).done;){var o=i.value,r=configMount_draw.getDataByKey(o.cfg_id);if(r.num){o.limit.active=!0;var s=IS(V).getInfo(this.actType),d=m.findChildComponent(o.limit,"Node",a);if(d.string="限量 "+r.num,s.get_drop.length>0)for(var h,c=e(s.get_drop);!(h=c()).done;){var l=h.value,f=l.k,u=l.v;f==o.cfg_id&&(d.string="限量 "+(r.num-u))}}}},u.onClickPreview=function(){var t=B[this.preViewCount];null!=t&&uiMgr.openView("PlayerSkinLookView",t,!0)},u.onLottery=function(t){var i=IS(V).GetCost(this.actType),e=i[0],n=i[1];2==t&&(n*=10),IS(I).getGoodsCountByGoodsGtid(e)>=n?IS(G).send_24_17(this.actType,t):uiMgr.openView("HorseCarnivalGiftView",this.actType)},u.updateLotteryResult=function(t){var i=this;if(t.act_type==this.actType){this.nodeRolling.active=!1;var e=IS(V).GetDrawReward(this.actType),n=1==t.type?e[1]:10*e[1];if(this.extraReward=[e[0],n],this.checkJackpot(t.drop_id_list),this.togSkip.isChecked)0!=this.jackpot?(this.openTypeView(this.jackpot,this.jackpotType),this.waitRewardList=t.reward_list,this.jackpot=0,this.jackpotType=0):(uiMgr.openView("GoodsGetView",t.reward_list,this.extraReward),this.extraReward=null);else{var o=t.drop_id_list[t.drop_id_list.length-1];if(this.finalIndex=configMount_draw.getDataByKey(o).order-1,this.reward_list=t.reward_list,this.skipAnim.active=!0,this.nodeRolling.active=!0,null==this.rollEff){this.rollEff=this.addUIEffect("prefab/ui-effect/MX_tx_zhongqiuzhuanpan",this.nodeRolling,-1,new f(0,-43.5),1,(function(t){t.node.getComponent(C).needAnimation="deng2"}))}1==t.drop_id_list.length?this.doLotteryTween(this.finalIndex,(function(){for(var e=0;e<i.rerwardList.length;e++)i.rerwardList[e].select.active=!1,i.rerwardList[e].light.active=!1;i.rerwardList[i.finalIndex].select.active=!0,i.rerwardList[i.finalIndex].light.active=!0,i.curIndex=i.finalIndex,0!=i.jackpot?(i.waitRewardList=t.reward_list,i.openTypeView(i.jackpot,i.jackpotType),i.jackpot=0,i.jackpotType=0):(uiMgr.openView("GoodsGetView",t.reward_list,i.extraReward),i.extraReward=null),i.skipAnim.active=!1,i.nodeRolling.active=!1})):this.lotteryNext(0,t)}}},u.lotteryNext=function(t,i){var e,n=this,o=configMount_draw.getDataByKey(i.drop_id_list[t]).order-1;e=t<i.drop_id_list.length-1?function(){n.curIndex=o,n.lotteryNext(t+1,i)}:function(){for(var t=0;t<n.rerwardList.length;t++)n.rerwardList[t].select.active=!1,n.rerwardList[t].light.active=!1;n.rerwardList[o].select.active=!0,n.rerwardList[o].light.active=!0,n.curIndex=o,0!=n.jackpot?(n.waitRewardList=i.reward_list,n.openTypeView(n.jackpot,n.jackpotType),n.jackpot=0,n.jackpotType=0):(uiMgr.openView("GoodsGetView",i.reward_list,n.extraReward),n.extraReward=null),n.skipAnim.active=!1,n.nodeRolling.active=!1},this.doLotteryTween(o,e)},u.doLotteryTween=function(t,i){var e=this;null!=this.moveTween&&this.moveTween.stop();var n=4*this.rewardNum+t-this.curIndex;this.moveTween=this.addTween(0,1,this.actionTime,(function(t,i){for(var o=n*i,r=Math.floor((o+e.curIndex)%e.rewardNum),s=0;s<e.rerwardList.length;s++)e.rerwardList[s].select.active=!1,e.rerwardList[s].light.active=!1;e.rerwardList[r].select.active=!0})).easing(E.SINE_OUT).call((function(){i()}),.5).start()},u.SkipAnim=function(){null!=this.moveTween&&this.moveTween.stop();for(var t=0;t<this.rerwardList.length;t++)this.rerwardList[t].select.active=!1,this.rerwardList[t].light.active=!1;this.rerwardList[this.finalIndex].select.active=!0,this.rerwardList[this.finalIndex].light.active=!0,this.curIndex=this.finalIndex,0!=this.jackpot?(this.waitRewardList=this.reward_list,this.openTypeView(this.jackpot,this.jackpotType),this.jackpot=0,this.jackpotType=0):(uiMgr.openView("GoodsGetView",this.reward_list,this.extraReward),this.extraReward=null),this.skipAnim.active=!1,this.nodeRolling.active=!1},u.checkJackpot=function(t){this.jackpot=0,this.jackpotType=0;for(var i,n=e(t);!(i=n()).done;){var o=i.value,r=configMount_draw.getDataByKey(o);if(r.goods_type)return this.jackpot=r.reward[0],this.jackpotType=r.goods_type,!0}return!1},u.onViewClose=function(t){this.waitRewardList.length<=0||"ArtifactGetView"!=t&&"PlayerSkinGetView"!=t||"ArtifactGetView"==t&&null!=uiMgr.getOpenView("PlayerSkinGetView")||"PlayerSkinGetView"==t&&null!=uiMgr.getOpenView("ArtifactGetView")||(uiMgr.openView("GoodsGetView",this.waitRewardList,this.extraReward),this.extraReward=null,this.waitRewardList=[])},u.openTypeView=function(t,i){switch(i){case 1:return void uiMgr.openView("ArtifactGetView",configGoods.getDataByKey(t).effect[0],!0);case 2:return void uiMgr.openView("HorseGetView",configGoods.getDataByKey(t).effect[0],!0);case 3:return void uiMgr.openView("PlayerSkinGetView",configGoods.getDataByKey(t).effect[0],!0);case 4:return void uiMgr.openView("FateNewView",configGoods.getDataByKey(t).effect[0])}},n}(A)),function(t){function e(){for(var i,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(i=t.call.apply(t,[this].concat(n))||this).txtDesc=void 0,i.itemGridNode=void 0,i.effNode=void 0,i.itemGrid=void 0,i.isReward=void 0,i.eff=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){var t=this;this.txtDesc=m.findChildComponent(this.node,"desc",h),this.itemGridNode=m.findChild(this.node,"itemGrid"),this.effNode=m.findChild(this.node,"eff"),this.itemGrid=new u(this.view,this.itemGridNode,(function(){var i=t.view,e=IS(V).getInfo(i.actType);!t.isReward&&e.count>=t.data.cumulative_times?IS(G).send_24_18(i.actType,t.data.id):IS(I).OpenItemTips(t.data.reward[0],t.itemGridNode)}))},n.onRender=function(t,i){this.itemGrid.SetItemId(t.reward[0],t.reward[1]);var e=this.view,n=IS(V).getInfo(e.actType);this.isReward=n.gotReward[t.id],this.view.removeUIEffect(this.eff),this.isReward?this.txtDesc.string=v.formatStrWithMirrorDeal(GetLanguage(200033)):n.count>=t.cumulative_times?(this.txtDesc.string=v.formatStrWithMirrorDeal(GetLanguage(200034)),this.eff=this.view.addUIEffect("prefab/ui-effect/MX_tx_tongyong_daojulingqu",this.effNode,-1)):this.txtDesc.string=l.formatStr("<b><color=#ff1c1c>%s</color><color=#80342e>/%s</color></b>",n.count,t.cumulative_times)},e}(p)),N=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(i=t.call.apply(t,[this].concat(n))||this).txt=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){this.txt=m.findChildComponent(this.node,"txt",h)},n.onRender=function(t,i){var e,n=null==(e=configGoods.getDataByKey(t.k))?void 0:e.name;this.txt.string=v.formatStrWithMirrorDeal(GetLanguage(200050),t.s,n)},e}(p);n._RF.pop()}}}));

