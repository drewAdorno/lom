System.register("chunks:///_virtual/ActivityPayRebateView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIRichText.ts","./RedPoint.ts","./RedPointMgr.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./FixMath.ts","./PayControl.ts","./PayDataCache.ts","./PayDefine.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./ActivityRechargeControl.ts","./ActivityRechargeDataCache.ts","./BaseView.ts"],(function(t){"use strict";var e,i,n,o,a,r,s,d,c,f,h,l,u,v,m,p,g,y,T,b,C,w;return{setters:[function(t){e=t.inheritsLoose,i=t.createForOfIteratorHelperLoose},function(t){n=t.cclegacy,o=t.Button,a=t.Label,r=t.Vec2,s=t.js},function(t){d=t.UIRichText},function(t){c=t.RedPointType},function(t){f=t.RedPointMgr},function(t){h=t.default},function(t){l=t.default},null,function(t){u=t.FixMath},function(t){v=t.default},function(t){m=t.default},function(t){p=t.PayEventDefine},function(t){g=t.default},function(t){y=t.ActivityEventDefine,T=t.ActivityState},function(t){b=t.default},function(t){C=t.default},function(t){w=t.BaseView}],execute:function(){n._RF.push({},"c1af9x7SeRDL4qr62IXR8yo","ActivityPayRebateView",void 0);var x=303003;t("default",function(t){function n(){var e;return(e=t.call(this)||this).txtLeftTime=void 0,e.deltaTime=0,e.leftTime=0,e.canUpdate=!1,e.txtDesc=void 0,e.txtNeed=void 0,e.btn=void 0,e.btn2=void 0,e.btnTips=void 0,e.actType=void 0,e.curReward=void 0,e.imgBox=void 0,e.nodeGrey=void 0,e.name="ActivityPayRebateView",e.url="ui/module/activity/ActivityPayRebateView",e.actType=2002,e}e(n,t);var w=n.prototype;return w.onInit=function(){var t=this,e=this.findChild("imgMask");this.addComponentCallbackListener(e,o.EventType.CLICK,(function(){t.close()}));var i=this.findChild("btnClose");this.addComponentCallbackListener(i,o.EventType.CLICK,(function(){t.close()})),this.btnTips=this.findChild("view/btnTips"),this.addComponentCallbackListener(this.btnTips,o.EventType.CLICK,(function(){uiMgr.openView("ActivityPayRebateTipsView",t.curReward)})),this.txtLeftTime=this.findChildComponent("view/topBg/txtLeftTime",a),this.txtDesc=this.findChildComponent("view/txtDesc",d),this.txtNeed=this.findChildComponent("view/txtNeed",d),this.btn=this.findChild("view/btn"),this.btn2=this.findChild("view/btn2"),this.addRedPoint("ActivityPayRebate",this.btn,new r(94,27),c.Num),this.addComponentCallbackListener(this.btn,o.EventType.CLICK,(function(){IS(C).getBoxInfo().got_reward[t.curReward]||IS(b).send_24_90(t.curReward)}));var n=this.findChild("view/topBg/btnReward");this.imgBox=this.findChild("view/topBg/btnReward/imgBox"),this.nodeGrey=this.findChild("view/topBg/btnReward/nodeGrey"),this.addComponentCallbackListener(n,o.EventType.CLICK,(function(){IS(v).send_19_2(x)}))},w.registerUpdateHandler=function(){this.addEvent(y.OnActivityRebateBox,this.updateInfo,this),this.addEvent(p.PAY_INFO_UPDATE,this.UpdateBtn,this)},w.onAfterOpen=function(){var t;IS(b).send_24_89(),this.UpdateBtn();var e=IS(g).GetActivityInfo(this.actType),i=null!=(t=e.state_time[e.state])?t:e.state_time[T.Open];this.leftTime=i.end_time-l.serverTime,this.leftTime>0?(this.canUpdate=!0,this.txtLeftTime.string=l.formatTimeStringForSecond(this.leftTime)):this.txtLeftTime.string=GetLanguage(200026)},w.onBeforeClose=function(){this.canUpdate=!1,this.curReward=0},w.onDestroy=function(){},w.onUpdate=function(t){this.canUpdate&&(this.deltaTime=this.deltaTime+t,this.deltaTime>=1&&(this.deltaTime=0,this.leftTime=this.leftTime-1,this.leftTime>0?this.txtLeftTime.string=l.formatTimeStringForSecond(this.leftTime):(this.txtLeftTime.string=GetLanguage(200026),this.canUpdate=!1)))},w.UpdateBtn=function(){var t=IS(m).GetPayGiftInfo(x);t&&t.rewardState<2?(this.imgBox.active=!0,this.nodeGrey.active=!1):(this.imgBox.active=!1,this.nodeGrey.active=!0)},w.updateInfo=function(){for(var t,e,n=IS(g).GetActivityInfo(this.actType),o=IS(C).getBoxInfo(),a=configPay_rebate_reward.getDatas(),r=[],d=i(a);!(t=d()).done;){var c=t.value;c.act_group==n.roundCfg.group_id&&r.push(c)}r.sort((function(t,e){return t.order-e.order}));for(var l=0;l<r.length;l++){var v=r[l];if(!o.got_reward[v.id]){this.curReward=v.id,e=o.process>=v.limit;break}}this.btn.active=e,this.btn2.active=!e;for(var m=0,p=0,y=0,T=!0,b=0;b<r.length;b++){var w=r[b];o.process>=w.limit?(m++,o.got_reward[w.id]||y++):0==p&&(p=w.limit-o.process),o.got_reward[w.id]||(T=!1)}this.btnTips.active=!T;var x=h.formatStrWithMirrorDeal(GetLanguage(400002),s.formatStr("<color=#3aff1d>%s</color>",m));if(this.txtDesc.string=s.formatStr("<b><outline width = 2 color=#921e1a><color=#ffee88>%s</color></outline></b>",x),0!=p){var R=h.formatStrWithMirrorDeal(GetLanguage(400001),s.formatStr("<color=#00a100>%s</color>",u.round(p/100)));this.txtNeed.string=s.formatStr("<b><color=#624324>%s</color></b>",R)}else this.txtNeed.string=T?s.formatStr("<b><color=#624324>%s</color></b>",GetLanguage(400005)):"";IS(f).changeValue("ActivityPayRebate",y)},n}(w));n._RF.pop()}}}));

