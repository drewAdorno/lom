System.register("chunks:///_virtual/ActivityMergeServersRechargeView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./TimeUtil.ts","./index57.ts","./MainViewModel.ts","./ActivityControl.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./ActivityMergeServersDataCache.ts","./ActivityMergeServersDefine.ts","./ActivityMergeServersControl.ts","./UIDefine.ts","./BaseView.ts"],(function(t){"use strict";var e,i,n,s,r,a,d,o,c,h,l,u,v,f,m,p,g,C,S,I,G,y,T,L;return{setters:[function(t){e=t.inheritsLoose,i=t.createForOfIteratorHelperLoose},function(t){n=t.cclegacy,s=t.Button,r=t.Label,a=t.ScrollView,d=t.js,o=t.ProgressBar},function(t){c=t.ItemGrid},function(t){h=t.ListItem},function(t){l=t.default},function(t){u=t.default},null,function(t){v=t.MainViewModel},function(t){f=t.default},function(t){m=t.default},function(t){p=t.ActivityEventDefine,g=t.ActivityType,C=t.ActivityState,S=t.ActivityTaskState},function(t){I=t.default},function(t){G=t.ActivityMergeServersEvent},function(t){y=t.default},function(t){T=t.PanelTabType},function(t){L=t.BaseView}],execute:function(){n._RF.push({},"a7cc1ft/vxEiqSyjzS8iHYM","ActivityMergeServersRechargeView",void 0);t("default",function(t){function n(){var e;return(e=t.call(this)||this).tabBtns=[],e.curIndex=0,e.txtLeftTime=void 0,e.taskList=void 0,e.tipsNode=void 0,e.deltaTime=0,e.leftTime=0,e.canUpdate=!1,e.red1=void 0,e.red2=void 0,e.name="ActivityMergeServersRechargeView",e.url="ui/module/activityMergeServers/ActivityMergeServersRechargeView",e}e(n,t);var o=n.prototype;return o.onInit=function(){var t=this,e=this.findChild("imgMask");this.addComponentCallbackListener(e,s.EventType.CLICK,(function(){t.close()}));var i=this.findChild("btnClose");this.addComponentCallbackListener(i,s.EventType.CLICK,(function(){t.close()}));var n=this.findChild("view/btnGo");this.addComponentCallbackListener(n,s.EventType.CLICK,(function(){IS(v).TryJumpToMainViewPanel(T.Main_Shop,T.Shop_Limit,[0])&&(uiMgr.close("ActivityMergeServersView"),t.close())})),this.txtLeftTime=this.findChildComponent("view/nodeTime/txtLeftTime",r),this.tipsNode=this.findChild("view/tips");var o=this.findChildComponent("view/taskList",a);this.taskList=this.addUIList(o,x,!0),this.red1=l.findChild(this.node,"bottomBtn/item1/red"),this.red2=l.findChild(this.node,"bottomBtn/item2/red");for(var c=function(e){var i=l.findChild(t.node,d.formatStr("bottomBtn/item%s",e)),n={itemGo:i,normalTxt:l.findChildComponent(i,"normal/Label",r),normalGo:l.findChild(i,"normal"),selectedGo:l.findChild(i,"selected"),selectTxt:l.findChildComponent(i,"selected/Label",r),index:e};t.addComponentCallbackListener(i,s.EventType.CLICK,(function(){t.SetIndex(n.index)})),t.tabBtns[e]=n},h=1;h<=2;h++)c(h)},o.registerUpdateHandler=function(){this.addEvent(p.OnActivityInfoTaskUpdate,this.OnTaskUpdate,this),this.addEvent(p.OnActivityInfoUpdate,this.OnTaskUpdate,this),this.addEvent(G.OnMergeGuildInfoUpdate,this.OnTaskUpdate,this)},o.onAfterOpen=function(){IS(f).send_24_14(g.MergeServersRecharge),IS(y).send_24_173(g.MergeServersGuild);var t=IS(m).GetActivityInfo(g.MergeServersRecharge);if(t){var e,i=null!=(e=t.state_time[t.state])?e:t.state_time[C.Open];this.leftTime=i.end_time-u.serverTime,this.leftTime>0?(this.canUpdate=!0,this.txtLeftTime.string=u.formatTimeStringForSecond(this.leftTime)):this.txtLeftTime.string=GetLanguage(200026)}else this.txtLeftTime.string=GetLanguage(200026);this.SetIndex(1)},o.onBeforeClose=function(){this.canUpdate=!1,this.curIndex>0&&(this.tabBtns[this.curIndex].normalGo.active=!0,this.tabBtns[this.curIndex].selectedGo.active=!1,this.curIndex=0)},o.onDestroy=function(){},o.onUpdate=function(t){this.canUpdate&&(this.deltaTime=this.deltaTime+t,this.deltaTime>=1&&(this.deltaTime=0,this.leftTime=this.leftTime-1,this.leftTime>0?this.txtLeftTime.string=u.formatTimeStringForSecond(this.leftTime):(this.txtLeftTime.string=GetLanguage(200026),this.canUpdate=!1)))},o.SetIndex=function(t){this.curIndex!=t&&(this.curIndex>0&&(this.tabBtns[this.curIndex].selectedGo.active=!1,this.tabBtns[this.curIndex].normalGo.active=!0),this.curIndex=t,this.tabBtns[this.curIndex].normalGo.active=!1,this.tabBtns[this.curIndex].selectedGo.active=!0,this.tipsNode.active=2==this.curIndex,this.OnTaskUpdate())},o.OnTaskUpdate=function(){if(this.red1.active=IS(m).GetTaskRedNum(g.MergeServersRecharge)>0,this.red2.active=IS(I).GetGuildRed()>0,1==this.curIndex){var t=IS(m).GetActivityInfo(g.MergeServersRecharge),e=[];for(var n in t.task_list)t.task_list.hasOwnProperty(n)&&e.push(t.task_list[n]);e.sort((function(t,e){return t.state==S.CanGet&&e.state!=S.CanGet?-1:t.state!=S.CanGet&&e.state==S.CanGet?1:t.state!=e.state?t.state-e.state:t.task_id-e.task_id})),this.taskList.datas=e}else{for(var s,r=IS(I).getGuildInfo(),a=IS(m).GetActivityInfo(g.MergeServersGuild),o=configAct_guild_pay.getDatas(),c=[],h=i(o);!(s=h()).done;){var l=s.value;if(l.act_type==g.MergeServersGuild&&l.group_id==a.roundCfg.group_id){var u=0;r.got_reward.includes(l.id)?u=2:r.count>=l.pay_num&&(u=1),c.push({id:l.id,count:r.count,state:u,cfg:{desc:d.formatStr(GetLanguage(303643),l.pay_num),reward:l.reward,condition:{2:l.pay_num}}})}}c.sort((function(t,e){return t.state==S.CanGet&&e.state!=S.CanGet?-1:t.state!=S.CanGet&&e.state==S.CanGet?1:t.state!=e.state?t.state-e.state:t.id-e.id})),this.taskList.datas=c}},n}(L));var x=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))||this).txtDesc=void 0,e.btnGet=void 0,e.received=void 0,e.undone=void 0,e.pb=void 0,e.schedule=void 0,e.rewardScroll=void 0,e}e(i,t);var n=i.prototype;return n.onInit=function(){var t=this;this.txtDesc=l.findChildComponent(this.node,"txtDesc",r),this.pb=l.findChildComponent(this.node,"ProgressBar",o),this.schedule=l.findChildComponent(this.node,"ProgressBar/schedule",r),this.received=l.findChild(this.node,"received"),this.undone=l.findChild(this.node,"undone"),this.btnGet=l.findChild(this.node,"btnGet"),this.view.addComponentCallbackListener(this.btnGet,s.EventType.CLICK,(function(){t.data.task_id?IS(f).send_24_15(g.MergeServersRecharge,t.data.task_id,t.data.group_id):IS(y).send_24_174(g.MergeServersGuild,t.data.id)}));var e=l.findChildComponent(this.node,"ScrollView",a);this.rewardScroll=this.view.addUIList(e,b),this.rewardScroll.virtual=!1},n.onRender=function(t,e){this.txtDesc.string=t.cfg.desc,this.rewardScroll.datas=t.cfg.reward,this.schedule.string=d.formatStr("%s/%s",t.count,t.cfg.condition[2]),this.pb.progress=t.count/t.cfg.condition[2],t.state==S.CanGet?(this.received.active=!1,this.undone.active=!1,this.btnGet.active=!0):t.state==S.HadGet?(this.received.active=!0,this.undone.active=!1,this.btnGet.active=!1):(this.received.active=!1,this.undone.active=!0,this.btnGet.active=!1)},i}(h),b=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))||this).itemGridNode=void 0,e.itemGrid=void 0,e}e(i,t);var n=i.prototype;return n.onInit=function(){this.itemGridNode=l.findChild(this.node,"itemGrid"),this.itemGrid=new c(this.view,this.itemGridNode)},n.onRender=function(t,e){this.itemGrid.SetItemId(t[0],t[1])},i}(h);n._RF.pop()}}}));

