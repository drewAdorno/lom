System.register("chunks:///_virtual/ActivityLoopyMusicGameMainView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./StorageUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./MessageView.ts","./RoleDataCache.ts","./ActivityControl.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./ActivityLoopyDataCache.ts","./ActivityLoopyDefine.ts","./BaseView.ts"],(function(t){"use strict";var e,i,n,o,s,d,a,c,r,h,l,u,v,f,p,m,L,y,I,C,S,g,T,G,w;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,n=t.Button,o=t.Label,s=t.ScrollView,d=t.js,a=t.Sprite},function(t){c=t.ItemGrid},function(t){r=t.SelectedType,h=t.ListItem},function(t){l=t.default},function(t){u=t.default},function(t){v=t.default},function(t){f=t.default},null,function(t){p=t.default},function(t){m=t.RoleDataCache},function(t){L=t.default},function(t){y=t.default},function(t){I=t.ActivityType,C=t.ActivityEventDefine,S=t.ActivityState,g=t.ActivityTaskState},function(t){T=t.default},function(t){G=t.ActivityLoopyEvent},function(t){w=t.BaseView}],execute:function(){i._RF.push({},"4f5bdwjSdtLJrZV3iVJQaZQ","ActivityLoopyMusicGameMainView",void 0);t("default",function(t){function i(){var e;return(e=t.call(this)||this).txtTimeDesc=void 0,e.txtLeftTime=void 0,e.txtDesc=void 0,e.leftTime=0,e.deltaTime=0,e.canUpdate=!1,e.actType=void 0,e.txtTopScore=void 0,e.levelList=void 0,e.rewardList=void 0,e.received=void 0,e.undone=void 0,e.btnGet=void 0,e.curRewardInfo=void 0,e.name="ActivityLoopyMusicGameMainView",e.url="ui/module/activityLoopy/ActivityLoopyMusicGameMainView",e.fullScreen=!0,e}e(i,t);var a=i.prototype;return a.onInit=function(){var t=this,e=this.findChild("bottom/btnClose");this.addComponentCallbackListener(e,n.EventType.CLICK,(function(){t.close()}));var i=this.findChild("btnStart");this.addComponentCallbackListener(i,n.EventType.CLICK,(function(){IS(L).send_24_102(I.LoopyMusic,IS(T).curLevelId)}));var d=this.findChild("bottom/btnGuide");this.addComponentCallbackListener(d,n.EventType.CLICK,(function(){uiMgr.openView("ActivityLoopyGameGuideView",I.LoopyMusic)}));var a=this.findChild("bottom/btnRank");this.addComponentCallbackListener(a,n.EventType.CLICK,(function(){uiMgr.openView("ActivityLoopyMusicGameRankView")}));var c=this.findChild("bottom/btnTest");this.addComponentCallbackListener(c,n.EventType.CLICK,(function(){IS(T).curLevelId=1,uiMgr.openView("ActivityLoopyMusicGameView",1)})),this.txtTimeDesc=this.findChildComponent("top/nodeTime/txtDesc",o),this.txtLeftTime=this.findChildComponent("top/nodeTime/txtTime",o),this.txtDesc=this.findChildComponent("content/nodeReward/nodeDesc/txtDesc",o),this.txtTopScore=this.findChildComponent("content/nodeTopScore/txtTopScore",o);var h=this.findChildComponent("content/nodeLevel/ScrollView",s);this.levelList=this.addUIList(h,k,!0),this.levelList.selectedMode=r.SINGLE;var l=this.findChildComponent("content/nodeReward/ScrollView",s);this.rewardList=this.addUIList(l,A),this.received=this.findChild("content/nodeReward/received"),this.undone=this.findChild("content/nodeReward/undone"),this.btnGet=this.findChild("content/nodeReward/btnGet"),this.addComponentCallbackListener(this.btnGet,n.EventType.CLICK,(function(){t.curRewardInfo&&IS(L).send_24_15(I.LoopyMusic,t.curRewardInfo.task_id,t.curRewardInfo.group_id)}))},a.registerUpdateHandler=function(){this.addEvent(G.OnActivityLoopyMusicGameLevelUpdate,this.UpdateLevelList,this),this.addEvent(G.OnActivityLoopyMusicGameLevelUpdate,this.OnTaskUpdate,this),this.addEvent(C.OnActivityGameStart,this.GameStart,this),this.addEvent(C.OnActivityInfoUpdate,this.updateTimeInfo,this),this.addEvent(C.OnActivityInfoUpdate,this.OnTaskUpdate,this),this.addEvent(C.OnActivityInfoTaskUpdate,this.OnTaskUpdate,this),this.addEvent(C.OnActivityInfoTaskUpdate,this.UpdateLevelList,this)},a.onAfterOpen=function(){""==u.get("loopymusicgame"+IS(m).GetRoleId())&&(this.addTimer(1,0,(function(){uiMgr.openView("ActivityLoopyGameGuideView",I.LoopyMusic)})),u.set("loopymusicgame"+IS(m).GetRoleId(),"1")),""==u.get("adjustlevel"+IS(m).GetRoleId())&&u.set("adjustlevel"+IS(m).GetRoleId(),11),IS(L).send_24_14(I.LoopyMusic),IS(L).send_24_101(I.LoopyMusic),this.updateTimeInfo()},a.onBeforeClose=function(){this.canUpdate=!1},a.onDestroy=function(){},a.onUpdate=function(t){this.canUpdate&&(this.deltaTime=this.deltaTime+t,this.deltaTime>=1&&(this.deltaTime=0,this.leftTime=this.leftTime-1,this.leftTime>0?this.txtLeftTime.string=d.formatStr("%s",f.formatTimeStringForSecond(this.leftTime)):(this.txtLeftTime.string=GetLanguage(200026),this.canUpdate=!1)))},a.GameStart=function(){uiMgr.openView("ActivityLoopyMusicGameView",0)},a.updateTimeInfo=function(t){if(t||(t=IS(y).GetActivityInfo(I.LoopyMusic)),t){var e,i=null!=(e=t.state_time[t.state])?e:t.state_time[S.Open];this.leftTime=i.end_time-f.serverTime,this.leftTime>0?(this.canUpdate=!0,this.txtLeftTime.string=d.formatStr("%s",f.formatTimeStringForSecond(this.leftTime))):this.txtLeftTime.string=GetLanguage(200026)}},a.OnTaskUpdate=function(){var t=IS(y).GetActivityInfo(I.LoopyMusic),e=[];for(var i in t.task_list)t.task_list.hasOwnProperty(i)&&e.push(t.task_list[i]);e.sort((function(t,e){return t.task_id-e.task_id})),this.curRewardInfo=e[IS(T).curLevelId-1],this.txtDesc.string=configActivity_task.getDataByKey(e[IS(T).curLevelId-1].task_id).desc,this.curRewardInfo.state==g.CanGet?(this.received.active=!1,this.undone.active=!1,this.btnGet.active=!0):this.curRewardInfo.state==g.HadGet?(this.received.active=!0,this.undone.active=!1,this.btnGet.active=!1):(this.received.active=!1,this.undone.active=!0,this.btnGet.active=!1),this.rewardList.datas=this.curRewardInfo.cfg.reward},a.UpdateLevelList=function(t){if(void 0===t&&(t=0),!(t>1&&t!=I.LoopyMusic)){var e=[],i=configMusic_main,n=IS(y).GetActivityInfo(I.LoopyMusic),o=[];for(var s in n.task_list)n.task_list.hasOwnProperty(s)&&o.push(n.task_list[s]);if(1!=t){for(var d=1,a=0;a<i.getDatas().length;a++){if(o[a].state==g.CanGet){d=a+1;break}if(o[a].state==g.Normal){d=a+1;break}o[a].state!=g.HadGet||(d=a+1)}d>IS(T).act_day&&(d=IS(T).act_day),IS(T).curLevelId=d,d>2&&this.levelList.content.setPosition(-110,96.974)}IS(T).chapterInfo[IS(T).curLevelId-1]&&(this.txtTopScore.string=IS(T).chapterInfo[IS(T).curLevelId-1].status);for(var c=function(t){var i={isLocked:!IS(T).openLevelList.some((function(e){return e==t+1})),isSelected:t==IS(T).curLevelId-1,red:o[t].state==g.CanGet};e.push(i)},r=0;r<i.getDatas().length;r++)c(r);this.OnTaskUpdate(),this.levelList.datas=e}},i}(w));var k=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).id=void 0,e.imgSelected=void 0,e.imgLock=void 0,e.txtLevel1=void 0,e.txtLevel2=void 0,e.RedPoint=void 0,e}e(i,t);var n=i.prototype;return n.onInit=function(){this.imgSelected=l.findChildComponent(this.node,"imgSelected",a),this.imgLock=l.findChildComponent(this.node,"imgLock",a),this.txtLevel1=l.findChildComponent(this.node,"txtLevel",o),this.txtLevel2=l.findChildComponent(this.node,"imgLock/txtLevel",o),this.RedPoint=l.findChild(this.node,"RedPoint")},n.onRender=function(t,e){this.id=e+1,this.imgSelected.node.active=t.isSelected,this.txtLevel1.string=this.id.toString(),this.txtLevel2.string=this.id.toString(),this.imgLock.node.active=t.isLocked,this.RedPoint.active=t.red},n.onItemClick=function(){this.imgLock.node.active?this.id<=IS(T).act_day?p.showFlyTip(GetLanguage(201214)):p.showFlyTip(v.formatStrWithMirrorDeal(GetLanguage(201212),this.id)):(IS(T).curLevelId=this.id,normalEvent.emit(G.OnActivityLoopyMusicGameLevelUpdate,1))},i}(h),A=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).itemGridNode=void 0,e.itemGrid=void 0,e}e(i,t);var n=i.prototype;return n.onInit=function(){this.itemGridNode=l.findChild(this.node,"itemGrid"),this.itemGrid=new c(this.view,this.itemGridNode)},n.onRender=function(t,e){this.itemGrid.SetItemId(t[0],t[1])},i}(h);i._RF.pop()}}}));

