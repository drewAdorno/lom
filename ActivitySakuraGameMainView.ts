System.register("chunks:///_virtual/ActivitySakuraGameMainView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./StorageUtil.ts","./StringUtil.ts","./index57.ts","./MessageView.ts","./RoleDataCache.ts","./ActivityControl.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./ActivitySakuraControl.ts","./ActivitySakuraDataCache.ts","./ActivitySakuraDefine.ts","./BaseView.ts"],(function(t){"use strict";var e,i,n,a,s,d,o,r,c,u,h,l,v,f,p,S,m,I,L,G,k,y,C;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,n=t.Button,a=t.ScrollView,s=t.Sprite,d=t.Label},function(t){o=t.ItemGrid},function(t){r=t.SelectedType,c=t.ListItem},function(t){u=t.default},function(t){h=t.default},function(t){l=t.default},null,function(t){v=t.default},function(t){f=t.RoleDataCache},function(t){p=t.default},function(t){S=t.default},function(t){m=t.ActivityType,I=t.ActivityEventDefine,L=t.ActivityTaskState},function(t){G=t.default},function(t){k=t.default},function(t){y=t.ActivitySakuraEvent},function(t){C=t.BaseView}],execute:function(){i._RF.push({},"de335tHqf9GIZI3GsuGEt+Z","ActivitySakuraGameMainView",void 0);t("default",function(t){function i(){var e;return(e=t.call(this)||this).actType=void 0,e.levelList=void 0,e.rewardList=void 0,e.btnGet=void 0,e.received=void 0,e.undone=void 0,e.taskList=[],e.curRewardInfo=void 0,e.name="ActivitySakuraGameMainView",e.url="ui/module/activitySakura/ActivitySakuraGameMainView",e}e(i,t);var s=i.prototype;return s.onInit=function(){var t=this,e=this.findChild("bottom/btnClose");this.addComponentCallbackListener(e,n.EventType.CLICK,(function(){t.close()}));var i=this.findChild("btnStart");this.addComponentCallbackListener(i,n.EventType.CLICK,(function(){IS(G).send_24_121()}));var s=this.findChildComponent("content/nodeLevel/ScrollView",a);this.levelList=this.addUIList(s,w,!0),this.levelList.selectedMode=r.SINGLE;var d=this.findChildComponent("content/nodeReward/ScrollView",a);this.rewardList=this.addUIList(d,g);var o=this.findChild("bottom/btnGuide");this.addComponentCallbackListener(o,n.EventType.CLICK,(function(){uiMgr.openView("ActivitySakuraGameGuideView")})),this.btnGet=this.findChild("content/nodeReward/btnGet"),this.received=this.findChild("content/nodeReward/received"),this.undone=this.findChild("content/nodeReward/undone"),this.addComponentCallbackListener(this.btnGet,n.EventType.CLICK,(function(){IS(p).send_24_15(m.SakuraGame,t.curRewardInfo.task_id,t.curRewardInfo.group_id)}))},s.registerUpdateHandler=function(){this.addEvent(y.OnSakuraGameLevelUpdate,this.UpdateLevelList,this),this.addEvent(y.OnSakuraGameLevelUpdate,this.OnTaskUpdate,this),this.addEvent(y.OnSakuraGameViewInit,this.InitView,this),this.addEvent(y.OnSakuraGameStart,this.StartGame,this),this.addEvent(I.OnActivityInfoTaskUpdate,this.OnTaskUpdate,this),this.addEvent(I.OnActivityInfoUpdate,this.OnTaskUpdate,this),this.addEvent(I.OnActivityInfoTaskUpdate,this.UpdateLevelList,this),this.addEvent(I.OnActivityInfoUpdate,this.UpdateLevelList,this)},s.onAfterOpen=function(){""==h.get("SakuraGame"+IS(f).GetRoleId())&&(this.addTimer(.5,0,(function(){uiMgr.openView("ActivitySakuraGameGuideView")})),h.set("SakuraGame"+IS(f).GetRoleId(),"1")),"1"==h.get("SakuraGame_NewLevel_"+IS(f).GetRoleId())&&(h.set("SakuraGame_NewLevel_"+IS(f).GetRoleId(),"0"),IS(S).UpdateMainRedByActType(m.Sakura),normalEvent.emit(y.OnSakuraGameNewLevelUpdate)),this.InitView()},s.onBeforeClose=function(){},s.onDestroy=function(){},s.onUpdate=function(t){},s.StartGame=function(){uiMgr.openView("ActivitySakuraGameView")},s.InitView=function(){IS(p).send_24_14(m.SakuraGame),IS(G).send_24_120(),this.UpdateLevelList()},s.OnTaskUpdate=function(){var t=IS(S).GetActivityInfo(m.SakuraGame),e=[];for(var i in t.task_list)t.task_list.hasOwnProperty(i)&&e.push(t.task_list[i]);this.curRewardInfo=e[IS(k).curLevelId-1],this.curRewardInfo.state==L.CanGet?(this.received.active=!1,this.undone.active=!1,this.btnGet.active=!0):this.curRewardInfo.state==L.HadGet?(this.received.active=!0,this.undone.active=!1,this.btnGet.active=!1):(this.received.active=!1,this.undone.active=!0,this.btnGet.active=!1),this.rewardList.datas=this.curRewardInfo.cfg.reward},s.UpdateLevelList=function(t){var e=[],i=configConnect_pipe_chapter,n=IS(S).GetActivityInfo(m.SakuraGame),a=[];for(var s in n.task_list)n.task_list.hasOwnProperty(s)&&a.push(n.task_list[s]);if(1!=t){for(var d=1,o=0;o<i.getDatas().length;o++){if(a[o].state==L.CanGet){d=o+1;break}if(a[o].state==L.Normal){d=o+1;break}a[o].state!=L.HadGet||(d=o+1)}d>IS(k).act_day&&(d=IS(k).act_day),IS(k).curLevelId=d,d>4&&this.levelList.content.setPosition(-395,77.5),this.OnTaskUpdate()}for(var r=function(t){var i={isLocked:!IS(k).openLevelList.some((function(e){return e==t+1})),isSelected:t==IS(k).curLevelId-1,red:a[t].state==L.CanGet};e.push(i)},c=0;c<i.getDatas().length;c++)r(c);this.levelList.datas=e},i}(C));var w=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),a=0;a<i;a++)n[a]=arguments[a];return(e=t.call.apply(t,[this].concat(n))||this).id=void 0,e.imgSelected=void 0,e.imgLock=void 0,e.txtLevel=void 0,e.RedPoint=void 0,e}e(i,t);var n=i.prototype;return n.onInit=function(){this.imgSelected=u.findChildComponent(this.node,"imgSelected",s),this.imgLock=u.findChildComponent(this.node,"imgLock",s),this.txtLevel=u.findChildComponent(this.node,"txtLevel",d),this.RedPoint=u.findChild(this.node,"RedPoint")},n.onRender=function(t,e){this.id=e+1,this.imgSelected.node.active=t.isSelected,this.txtLevel.string=this.id.toString(),this.imgLock.node.active=t.isLocked,this.RedPoint.active=t.red},n.onItemClick=function(){this.imgLock.node.active?this.id<=IS(k).act_day?v.showFlyTip(GetLanguage(201214)):v.showFlyTip(l.formatStrWithMirrorDeal(GetLanguage(201212),this.id)):(IS(k).curLevelId=this.id,normalEvent.emit(y.OnSakuraGameLevelUpdate,1))},i}(c),g=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),a=0;a<i;a++)n[a]=arguments[a];return(e=t.call.apply(t,[this].concat(n))||this).itemGridNode=void 0,e.itemGrid=void 0,e}e(i,t);var n=i.prototype;return n.onInit=function(){this.itemGridNode=u.findChild(this.node,"itemGrid"),this.itemGrid=new o(this.view,this.itemGridNode)},n.onRender=function(t,e){this.itemGrid.SetItemId(t[0],t[1])},i}(c);i._RF.pop()}}}));

