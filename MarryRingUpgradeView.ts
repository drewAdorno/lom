System.register("chunks:///_virtual/MarryRingUpgradeView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./index57.ts","./ItemIcon.ts","./BagModel.ts","./MessageView.ts","./RoleDataCache.ts","./MarryControl.ts","./MarryDefine.ts","./MarryDialogDataCache.ts","./BaseView.ts"],(function(t){"use strict";var e,i,n,o,r,s,a,h,l,d,f,c,g,v,u,I,p,C,m,S,w,A,L,_;return{setters:[function(t){e=t.inheritsLoose,i=t.createForOfIteratorHelperLoose},function(t){n=t.cclegacy,o=t.RichText,r=t.Label,s=t.Button,a=t.ScrollView,h=t.Vec2,l=t.UITransform,d=t.Node,f=t.Sprite,c=t.js,g=t.ProgressBar},function(t){v=t.ListItem},function(t){u=t.default},function(t){I=t.default},null,function(t){p=t.IconAseetType},function(t){C=t.BagModel},function(t){m=t.default},function(t){S=t.RoleDataCache},function(t){w=t.default},function(t){A=t.MarryEventDefine},function(t){L=t.default},function(t){_=t.BaseView}],execute:function(){n._RF.push({},"3cb63dfbwROF7j6JaAxeHrd","MarryRingUpgradeView",void 0);t("default",function(t){function n(){var e;return(e=t.call(this)||this).nodeRoot=void 0,e.btnOne=void 0,e.btnTen=void 0,e.btnLeft=void 0,e.btnRight=void 0,e.nodeUnlock=void 0,e.attrUIList=void 0,e.attrTopUIList=void 0,e.AttrlistItem=[],e.AttrToplistItem=[],e.ringEffectID=0,e.ringInfo=void 0,e.canShowIDList=void 0,e.showID=1,e.txtLevel=void 0,e.lover_favor_lv=0,e.favorAdd=0,e.name="MarryRingUpgradeView",e.url="ui/module/marry/MarryRingUpgradeView",e.poolTime=3e3,e}e(n,t);var v=n.prototype;return v.onInit=function(){var t=this;this.nodeRoot=this.findChild("root"),this.nodeUnlock=this.findChildComponent("root/nodeShow/nodeUnlock",o),this.txtLevel=this.findChildComponent("root/nodeProgress/ProgressBar/Node",r);var e=this.findChild("root/btnClose");this.addComponentCallbackListener(e,s.EventType.CLICK,(function(){t.close()}));var n=this.findChild("root/nodeItem");this.addComponentCallbackListener(n,s.EventType.CLICK,(function(){IS(C).OpenItemTips(1114,n)})),this.btnOne=this.findChild("root/nodeChange/btnOne"),this.addComponentCallbackListener(this.btnOne,s.EventType.CLICK,(function(){t.onClickOne()})),this.btnTen=this.findChild("root/nodeChange/btnTen"),this.addComponentCallbackListener(this.btnTen,s.EventType.CLICK,(function(){t.onClickTen()})),this.btnLeft=this.findChild("root/nodeShow/btnLeft"),this.addComponentCallbackListener(this.btnLeft,s.EventType.CLICK,(function(){for(var e,i=0,n=0;n<t.canShowIDList.length;n++)t.canShowIDList[n][0]==t.showID&&(i=n,t.nodeUnlock.node.active=t.ringInfo.curLevel<t.canShowIDList[n][1],t.ringInfo.curLevel<t.canShowIDList[n][1]&&(t.nodeUnlock.string=I.formatStr(GetLanguage(204629),t.canShowIDList[n][1])));t.showID=null!=(e=t.canShowIDList[i-1][0])?e:t.showID,t.refreshUpgradeShow()})),this.btnRight=this.findChild("root/nodeShow/btnRight"),this.addComponentCallbackListener(this.btnRight,s.EventType.CLICK,(function(){for(var e,i=0,n=0;n<t.canShowIDList.length;n++)t.canShowIDList[n][0]==t.showID&&(i=n,t.nodeUnlock.node.active=t.ringInfo.curLevel<t.canShowIDList[n][1],t.ringInfo.curLevel<t.canShowIDList[n][1]&&(t.nodeUnlock.string=I.formatStr(GetLanguage(204629),t.canShowIDList[n][1])));t.showID=null!=(e=t.canShowIDList[i+1][0])?e:t.showID,t.refreshUpgradeShow()}));var f=this.findChildComponent("root/nodeChange/ScrollView",a);this.attrUIList=this.addUIList(f,x);var c=this.findChildComponent("root/nodeTop/ScrollView",a);this.attrTopUIList=this.addUIList(c,y);for(var g,v=i(configRing_level.getDatas());!(g=v()).done;){var u=g.value;0!=u.unlock&&(this.showID=u.unlock)}this.addRedPoint("marry_ring_upgrade_active",this.btnTen,new h(100,30));var p=this.findChild("root/nodeSkill/ScrollView/view/content/item"),m=this.findChildComponent("root/nodeSkill/ScrollView/view/content",l);p.on(d.EventType.SIZE_CHANGED,(function(){m.height=p.getComponent(l).height}))},v.onAfterOpen=function(){if(this.favorAdd=0,this.ringInfo=IS(L).GetRingInfo(),console.log(this.ringInfo),this.ringInfo){this.showID=this.ringInfo.ring_id,this.canShowIDList=[];for(var t,e=i(configRing_level.getDatas());!(t=e()).done;){var n=t.value;0!=n.unlock&&this.canShowIDList.push([n.unlock,n.level])}this.refreshUpgradeShow()}IS(w).send_marry_status_c2s()},v.updateMarryInfo=function(){var t=IS(L).GetLoverId();t&&0!=t&&IS(w).send_favor_friend_lv_c2s(t)},v.UpdateInfo=function(){if(this.ringInfo=IS(L).GetRingInfo(),this.ringInfo){this.showID=this.ringInfo.ring_id,this.canShowIDList=[];for(var t,e=i(configRing_level.getDatas());!(t=e()).done;){var n=t.value;0!=n.unlock&&this.canShowIDList.push([n.unlock,n.level])}this.refreshUpgradeShow()}},v.registerUpdateHandler=function(){this.addEvent(A.MARRY_RING_USE_CHANGE,this.refreshUpgradeShow,this),this.addEvent(A.MARRY_RING_ADD_EXP,this.refreshItemNum,this),this.addEvent(A.MARRY_RING_INFO_UPDATE,this.UpdateInfo,this),this.addEvent(A.MARRY_RING_SKILL_USE_CHANGE,this.refreshUseSkillBtn,this),this.addEvent(A.MARRY_FAVOR_FRIEND_LV_BACK,this.refreshloverInfo,this),this.addEvent(A.MARRY_DIALOG_STAGE_CHANGE,this.updateMarryInfo,this)},v.refreshloverInfo=function(t){this.lover_favor_lv=t.favor_lv;var e=configFavorability_level.getDataByKey(this.lover_favor_lv);this.favorAdd=e.buff[2][1],this.attrUIList.updateAll(),this.attrTopUIList.updateAll()},v.onClickOne=function(){IS(C).getGoodsCountByGoodsGtid(1114)<1?m.showFlyTip(GetLanguage(200108)):IS(w).send_marry_ring_levup_c2s(0)},v.onClickTen=function(){IS(C).getGoodsCountByGoodsGtid(1114)<1?m.showFlyTip(GetLanguage(200108)):IS(w).send_marry_ring_levup_c2s(1)},v.onBeforeClose=function(){},v.onDestroy=function(){},v.refreshUpgradeShow=function(){this.refreshSkillInfo(),this.refreshAttrChange(),this.refreshRingShow(),this.refreshItemNum(),this.refreshProgress(),this.refreshUseSkillBtn()},v.refreshUseSkillBtn=function(){},v.refreshSkillInfo=function(){var t=u.findChildComponent(this.nodeRoot,"nodeSkill/Frame",f),e=u.findChildComponent(this.nodeRoot,"nodeSkill/Icon",f),i=u.findChildComponent(this.nodeRoot,"nodeSkill/txtName",r),n=configRing_level.getDataByKey(this.ringInfo.curLevel);if(n){var o=configSkill.getDataByKey(n.base_skill[0][0]);this.loadIcon(t,"icon_skill",c.formatStr("common_ICON_jinengkuang0%s",o.quality)),this.loadIcon(e,"icon_skill",o.icon,null,p.ICON_SPRITE),i.string=o.name;var s=u.findChildComponent(this.nodeRoot,"nodeSkill/ScrollView/view/content/item",r),a=configSkill_level.getDataByKeys("id",n.base_skill[0][0],"level",n.base_skill[0][1]);s.string=I.formatStr.apply(I,[a.desc].concat(a.desc_parm))}},v.refreshAttrChange=function(){var t=u.findChildComponent(this.nodeRoot,"nodeChange/txtLevelBase",r),e=u.findChildComponent(this.nodeRoot,"nodeChange/txtLevelNext",r),i=this.findChild("root/nodeChange"),n=this.findChild("root/nodeTop"),o=configRing_level.getDataByKey(this.ringInfo.curLevel),s=configRing_level.getDataByKey(this.ringInfo.curLevel+1);if(this.AttrlistItem=[],this.AttrToplistItem=[],null!=o)if(null!=s){t.string=o.level+"",e.string=s.level+"";for(var a=0;a<o.attr.length;a++){var h=configAttribute.getDataByKey(o.attr[a][0]),l={show_type:h.show_type,name:h.desc,base:o.attr[a][1],next:s.attr[a][1]};this.AttrlistItem.push(l)}this.attrUIList.datas=this.AttrlistItem,i.active=!0,n.active=!1}else{t.string=o.level+"";for(a=0;a<o.attr.length;a++){var d=configAttribute.getDataByKey(o.attr[a][0]),f={show_type:d.show_type,name:d.desc,base:o.attr[a][1]};this.AttrToplistItem.push(f)}this.attrTopUIList.datas=this.AttrToplistItem,i.active=!1,n.active=!0}},v.refreshRingShow=function(){if(this.canShowIDList.length<=1)this.btnLeft.active=!1,this.btnRight.active=!1;else{for(var t=0,e=0;e<this.canShowIDList.length;e++)this.canShowIDList[e][0]==this.showID&&(t=e,this.nodeUnlock.node.active=this.ringInfo.curLevel<this.canShowIDList[e][1],this.ringInfo.curLevel<this.canShowIDList[e][1]&&(this.nodeUnlock.string=I.formatStr(GetLanguage(204629),this.canShowIDList[e][1])));this.btnLeft.active=0!=t,this.btnRight.active=t!=this.canShowIDList.length-1}var i=this.findChildComponent("root/nodeShow/imgIcon",f),n=this.findChildComponent("root/nodeShow/txtName",r),o=configRing.getDataByKey(this.showID);n.string=o.name,this.removeUIEffect(this.ringEffectID),2==IS(S).GetGender()?this.loadIcon(i,"icon_ring",o.icon2,null,p.ICON_SPRITE):this.loadIcon(i,"icon_ring",o.icon1,null,p.ICON_SPRITE),this.checkPageBtn()},v.checkPageBtn=function(){},v.refreshItemNum=function(){this.refreshProgress(),this.checkOneKeyShow(),this.refreshAttrChange();var t=this.findChildComponent("root/nodeItem/Label",r),e=IS(C).getGoodsCountByGoodsGtid(1114);t.string=""+e,IS(L).checkUpgradeRP()},v.refreshProgress=function(){var t=configRing_level.getDataByKey(this.ringInfo.curLevel);if(null!=t){var e=this.findChildComponent("root/nodeProgress/ProgressBar",g),i=this.findChildComponent("root/nodeProgress/ProgressBar/txtDesc",r),n=t.expend_exp,o=configRing_level.getDataByKey(this.ringInfo.curLevel+1);if(this.txtLevel.string="lv."+this.ringInfo.curLevel,null==o)return e.progress=1,void(i.string=n+"/"+n);var s=this.ringInfo.curexp;s-=n,n=o.expend_exp-t.expend_exp,e.progress=s/n,i.string=s+"/"+n}},v.checkOneKeyShow=function(){this.ringInfo=IS(L).GetRingInfo();var t=u.findChild(this.btnTen,"txtNum"),e=u.findChild(this.btnTen,"txtRed"),i=u.findChildComponent(this.btnTen,"txtNum",r),n=u.findChild(this.btnOne,"txtNum"),o=u.findChild(this.btnOne,"txtRed"),s=IS(C).getGoodsCountByGoodsGtid(1114);if(e.active=0==s,t.active=0!=s,o.active=0==s,n.active=0!=s,null!=configRing_level.getDataByKey(this.ringInfo.curLevel+1)){var a=configRing_level.getDataByKey(this.ringInfo.curLevel+1).expend_exp;console.log("nextLevelNeed "+a),a-=this.ringInfo.curexp,i.string=s>=a?"X"+a:"X"+s}else i.string="X1"},n}(_));var x=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).txtAttrName=void 0,e.txtAttrBase=void 0,e.txtAttrNext=void 0,e}e(i,t);var n=i.prototype;return n.onInit=function(){this.txtAttrName=u.findChildComponent(this.node,"txtAttrName",r),this.txtAttrBase=u.findChildComponent(this.node,"txtAttrBase",r),this.txtAttrNext=u.findChildComponent(this.node,"txtAttrNext",r)},n.onRender=function(t,e){this.txtAttrName.string=t.name,2==t.show_type?this.view.favorAdd&&this.view.favorAdd>0?(this.txtAttrBase.string=c.formatStr("%s%",I.GetNumString(t.base/100+Math.floor(t.base/100*(this.view.favorAdd/1e4)))),this.txtAttrNext.string=c.formatStr("%s%",I.GetNumString(t.next/100+Math.floor(t.next/100*(this.view.favorAdd/1e4))))):(this.txtAttrBase.string=c.formatStr("%s%",I.GetNumString(t.base/100)),this.txtAttrNext.string=c.formatStr("%s%",I.GetNumString(t.next/100))):3==t.show_type?this.view.favorAdd&&this.view.favorAdd>0?(this.txtAttrBase.string=I.GetNumString(Math.floor(t.base/100)/100+Math.floor(Math.floor(t.base/100)/100*(this.view.favorAdd/1e4))),this.txtAttrNext.string=I.GetNumString(Math.floor(t.next/100)/100+Math.floor(Math.floor(t.next/100)/100*(this.view.favorAdd/1e4)))):(this.txtAttrBase.string=I.GetNumString(Math.floor(t.base/100)/100),this.txtAttrNext.string=I.GetNumString(Math.floor(t.next/100)/100)):this.view.favorAdd&&this.view.favorAdd>0?(this.txtAttrBase.string=I.GetNumString(t.base+t.base*(this.view.favorAdd/1e4)),this.txtAttrNext.string=I.GetNumString(t.next+t.next*(this.view.favorAdd/1e4))):(this.txtAttrBase.string=I.GetNumString(t.base),this.txtAttrNext.string=I.GetNumString(t.next))},n.onItemClick=function(){},i}(v),y=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).txtAttrName=void 0,e.txtAttrBase=void 0,e}e(i,t);var n=i.prototype;return n.onInit=function(){this.txtAttrName=u.findChildComponent(this.node,"txtAttrName",r),this.txtAttrBase=u.findChildComponent(this.node,"txtAttrBase",r)},n.onRender=function(t,e){this.txtAttrName.string=t.name,2==t.show_type?this.view.favorAdd&&this.view.favorAdd>0?this.txtAttrBase.string=c.formatStr("%s%",I.GetNumString(t.base/100+Math.floor(t.base/100*(this.view.favorAdd/1e4)))):this.txtAttrBase.string=c.formatStr("%s%",I.GetNumString(t.base/100)):3==t.show_type?this.view.favorAdd&&this.view.favorAdd>0?this.txtAttrBase.string=I.GetNumString(Math.floor(t.base/100)/100+Math.floor(Math.floor(t.base/100)/100*(this.view.favorAdd/1e4))):this.txtAttrBase.string=I.GetNumString(Math.floor(t.base/100)/100):this.view.favorAdd&&this.view.favorAdd>0?this.txtAttrBase.string=I.GetNumString(t.base+Math.floor(t.base*(this.view.favorAdd/1e4))):this.txtAttrBase.string=I.GetNumString(t.base)},n.onItemClick=function(){},i}(v);n._RF.pop()}}}));

