System.register("chunks:///_virtual/SeasonRankView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GuildPinItem.ts","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./ConfigSeason_kv.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./CommonModel.ts","./MessageView.ts","./FriendControl.ts","./GuildControl.ts","./FrameDataCache.ts","./RankControl.ts","./RankDefine.ts","./RankModel.ts","./RoleDataCache.ts","./RoleDefine.ts","./BaseView.ts"],(function(e){"use strict";var i,t,n,o,r,a,s,d,h,c,m,l,v,f,g,I,k,u,y,R,C,S,p,x,_,w,F,N,L,b,T;return{setters:[function(e){i=e.inheritsLoose,t=e.createForOfIteratorHelperLoose},function(e){n=e.cclegacy,o=e.Button,r=e.ScrollView,a=e.Label,s=e.Sprite,d=e.Layout,h=e.sys,c=e.js},function(e){m=e.GuildPinItem},function(e){l=e.ItemGrid},function(e){v=e.ListItem},function(e){f=e.default},function(e){g=e.default},function(e){I=e.default},null,function(e){k=e.ConfigSeason_kv},function(e){u=e.default},function(e){y=e.ActivityType,R=e.ActivityState},function(e){C=e.CommonModel},function(e){S=e.default},function(e){p=e.default},function(e){x=e.default},function(e){_=e.FrameDataCache},function(e){w=e.default},function(e){F=e.RankDefine},function(e){N=e.RankModel},function(e){L=e.RoleDataCache},function(e){b=e.PlayerAttr},function(e){T=e.BaseView}],execute:function(){var G;n._RF.push({},"ad73eY8SNVJs5R4BwNR7Ohg","SeasonRankView",void 0);var M=k.SEASON_RANK_ID,B=e("tabToRankid",((G={})[1]=M[0],G[2]=M[1],G[3]=M[0],G[4]=M[1],G)),H=1,D=2,A=3,E=4,O={1:"1st",2:"2rd",3:"3th"},K=(e("default",function(e){function n(){var i;return(i=e.call(this)||this).tabBtns=[],i.curIndex=0,i.bgNode1=void 0,i.bgNode2=void 0,i.bgNode3=void 0,i.bgNode4=void 0,i.nodeTopRank=void 0,i.nodeMyServer=void 0,i.nodeServer=void 0,i.nodeMyReward=void 0,i.scrollRank=void 0,i.rankList=void 0,i.page=1,i.isSendToServer=void 0,i.rankInfo=void 0,i.rank_info_list=void 0,i.myInfo=void 0,i.flagRankList=[],i.serverFlag=void 0,i.serverName=void 0,i.serverScore=void 0,i.serverIcon=void 0,i.scrollReward=void 0,i.rewardList=void 0,i.myRewardScroll=void 0,i.txtMyRank=void 0,i.myIcon=void 0,i.myRankIcon=void 0,i.imgHeadFrame=void 0,i.myRankIndex=void 0,i.myServer=void 0,i.meNoRank=void 0,i.myRankGuildFlag=void 0,i.myRankHeadFram=void 0,i.myRankHeadBase=void 0,i.myRankScore=void 0,i.myRankName=void 0,i.roleList={},i.txtTime=void 0,i.Timer=void 0,i.name="SeasonRankView",i.url="ui/module/season/SeasonRankView",i.poolTime=3e3,i}i(n,e);var l=n.prototype;return l.onInit=function(){var e=this,i=this.findChild("root/btnClose");this.addComponentCallbackListener(i,o.EventType.CLICK,(function(){e.close()}));for(var t=function(i){var t=f.findChild(e.node,c.formatStr("root/bottomBtn/item%s",i)),n={itemGo:t,normalGo:f.findChild(t,"normal"),selectedGo:f.findChild(t,"selected"),index:i};e.addComponentCallbackListener(t,o.EventType.CLICK,(function(){e.SetIndex(n.index)})),e.tabBtns[i]=n},n=1;n<=4;n++)t(n);this.scrollRank=this.findChildComponent("root/rankList",r),this.addComponentCallbackListener(this.scrollRank.node,r.EventType.SCROLL_TO_BOTTOM,(function(){if(!(e.isSendToServer||e.rank_info_list.length>=e.rankInfo.total_num)){e.page+=1;var i=new Array;i.push({type:B[e.curIndex],server:2,page:e.page}),IS(w).reqRankList(i),e.isSendToServer=!0}})),this.rankList=this.addUIList(this.scrollRank,K);for(var l=1;l<5;l++){var v=this.findChild(1==l?"root/nodeServer/node"+l:"root/nodeServer/Node/node"+l),g={nodeBase:v,nodeFlag:f.findChild(v,"flag1"),nodeServer:f.findChild(v,"bgServer"),nodeScore:f.findChild(v,"bgScore"),nodeIcon:f.findChild(v,"rankIcon"),nodeEmpty:f.findChild(v,"empty"),score:l,server:l,txtScore:f.findChildComponent(v,"bgScore/txtScore",a),txtServer:f.findChildComponent(v,"bgServer/txtServer",a),nid:l};this.flagRankList.push(g)}this.myRankIcon=this.findChildComponent("root/myRank/imgFrame/frame/imgIcon",s),this.imgHeadFrame=this.findChildComponent("root/myRank/imgFrame/frame/imgHeadFrame",s),this.myRankGuildFlag=new m(this,f.findChild(this.node,"root/myRank/imgFrame/GuildPinItem")),this.myRankHeadBase=this.findChild("root/myRank/imgFrame/frame"),this.myRankHeadFram=this.findChild("root/myRank/imgFrame/frame2"),this.myRankName=this.findChildComponent("root/myRank/info/name",a),this.myRankIndex=this.findChildComponent("root/myRank/rank",a),this.myServer=this.findChildComponent("root/myRank/info/server",a),this.meNoRank=this.findChild("root/myRank/no_rank"),this.myRankScore=this.findChildComponent("root/myRank/score",a),this.serverFlag=this.findChild("root/nodeMyServer/flag"),this.serverName=this.findChildComponent("root/nodeMyServer/name",a),this.serverScore=this.findChildComponent("root/nodeMyServer/scoreBg/score",a),this.serverIcon=this.findChildComponent("root/nodeMyServer/rankIcon",s),this.scrollReward=this.findChildComponent("root/nodeReward/rankList",r),this.rewardList=this.addUIList(this.scrollReward,U);var I=this.findChildComponent("root/myReward/rewardScroll",r);this.myRewardScroll=this.addUIList(I,V,!1),this.txtMyRank=this.findChildComponent("root/myReward/rankNum",a),this.myIcon=this.findChildComponent("root/myReward/rankIcon",s),this.bgNode1=this.findChild("root/Node1"),this.bgNode2=this.findChild("root/Node2"),this.bgNode3=this.findChild("root/Node3"),this.bgNode4=this.findChild("root/Node4"),this.nodeMyServer=this.findChild("root/nodeMyServer"),this.nodeTopRank=this.findChild("root/nodeTopRank"),this.nodeServer=this.findChild("root/nodeServer"),this.nodeMyReward=this.findChild("root/myReward");var k=this.findChildComponent("root/Node",d);this.dealMirrorLayout(k),k.horizontalDirection=h.uiMirror?0:1,this.txtTime=this.findChildComponent("root/Node/time",a);for(var u=1;u<=3;u++){var y=new q;y.init(this.findChild("root/nodeTopRank/rank"+u),this,u),this.roleList[u]=y}},l.registerUpdateHandler=function(){this.addEvent(F.RankInfoBack,this.refreshRank,this)},l.onAfterOpen=function(){var e=this;this.SetIndex(H);var i=IS(u).GetActivityInfo(y.Season);i&&(this.Timer&&this.removeTimer(this.Timer),this.Timer=this.addTimer(1,-1,(function(){if(i.state==R.Open){var t=i.end_time-I.serverTime;e.txtTime.string=g.formatStr(GetLanguage(204939),I.getTimeLeft(t))}else i.state==R.EndShow&&(e.txtTime.string=GetLanguage(302170))})))},l.refreshRank=function(e){var i=IS(N).GetRankInfoByType(B[this.curIndex]);if(null==i)return this.refreshTop3(),this.refreshScrollItem(),void this.refreshMyInfo();this.rankInfo=i,this.rank_info_list=i.rank_list,this.myInfo=i.my_info,this.curIndex==H?(this.refreshTop3(),this.refreshScrollItem()):this.curIndex==D?(this.refreshFlagInfo(),this.rankList.datas=[]):this.curIndex==A?this.refreshTop3():this.curIndex==E&&this.refreshRewardFlagInfo(),this.refreshMyInfo(),this.isSendToServer=!1},l.onClickCheck=function(e){this.rank_info_list&&this.rank_info_list.length>0&&(2==configRanktype.getDataByKey(B[this.curIndex]).rank_type?e==IS(L).GetServerId()?S.showFlyTip(GetLanguage(200230)):IS(x).send_29_1(e):IS(p).reqOtherRoleNotice(e))},l.refreshRewardFlagInfo=function(){this.serverName.string="[s"+IS(L).GetServerId()+"]",this.serverScore.string=this.rankInfo.my_info.score,new m(this,this.serverFlag).SetItem(this.rankInfo.my_info.guild_flag),this.myIcon.node.active?(this.serverIcon.node.active=!0,this.serverIcon.spriteFrame=this.myIcon.spriteFrame,this.serverIcon.node.setScale(-.9,.9,1)):this.serverIcon.node.active=!1},l.refreshScrollItem=function(){var e=IS(N).GetRankInfoByType(B[this.curIndex]),i=new Array;if(e)for(var t=0;t<e.rank_list.length;t++)t>2&&i.push({info:e.rank_list[t],rank_id:B[this.curIndex]});this.rankList.datas=i},l.refreshTop3=function(){for(var e=1;e<=3;e++)this.rank_info_list.length>=e?this.roleList[e].show(this.rank_info_list[e-1]):this.roleList[e].show(null)},l.refreshFlagInfo=function(){for(var e,i=this.rank_info_list,n=t(this.flagRankList);!(e=n()).done;){var o=e.value;o.nodeFlag.active=!1,o.nodeServer.active=!1,o.nodeScore.active=!1,o.nodeIcon.active=!1,o.nodeEmpty.active=!0}i.sort((function(e,i){return 0==e.rank?1:0==i.rank?-1:e.rank>i.rank?1:e.rank==i.rank?e.serv_id-i.serv_id:-1}));for(var r,a=t(i.entries());!(r=a()).done;){var d=r.value,h=d[0],c=d[1];this.flagRankList[h].nodeFlag.active=!0,this.flagRankList[h].nodeServer.active=!0,this.flagRankList[h].nodeScore.active=!0,this.flagRankList[h].nodeIcon.active=!0,this.loadIcon(this.flagRankList[h].nodeIcon.getComponent(s),"common","common_ICON_paiming0"+(h+1)),this.flagRankList[h].nodeEmpty.active=!1;var l=this.flagRankList[h];new m(this,l.nodeFlag).SetItem(c.guild_flag),l.txtServer.string="[s"+c.serv_id+"]",l.server=c.serv_id,l.txtScore&&(l.txtScore.string=g.GetNumString(c.score))}},l.refreshMyInfo=function(){if(this.curIndex!=A&&this.curIndex!=E){this.myInfo||(this.myInfo={});var e=f.findChildComponent(this.node,"/root/myRank/rankIcon",s);this.myInfo.rank>0?(this.myInfo.rank<=3?(this.myRankIndex.node.active=!1,e.node.active=!0,this.loadIcon(e,"common","common_ICON_paiming0"+this.myInfo.rank)):(this.myRankIndex.node.active=!0,this.myRankIndex.string=this.myInfo.rank+"",e.node.active=!1),this.meNoRank.active=!1,this.myServer.node.active=!0):(this.meNoRank.active=!0,this.myServer.node.active=!1,this.myRankIndex.node.active=!1,e.node.active=!1);var i=IS(L),t=i.GetRoleAttr(b.ROLE_ATTR_HEAD_URL);i.GetRoleAttr(b.ROLE_ATTR_HEAD_ID);if(this.curIndex==D)this.myRankIcon.node.active=!1,this.myRankHeadBase.active=!1,this.myRankHeadFram.active=!1,this.myRankGuildFlag.node.active=!0,this.myRankGuildFlag.SetItem(this.myInfo.guild_flag),this.myRankName.string=IS(L).GetRoleName();else{this.myRankIcon.node.active=!0,this.myRankHeadBase.active=!0,this.myRankHeadFram.active=!0,this.myRankGuildFlag.node.active=!1,this.loadRemoteIcon(t,this.myRankIcon);var n=IS(_).curFrameId;if(n>0){var o=configAvatar_frame.getDataByKey(n);this.loadIcon(this.imgHeadFrame,"icon_frame",o.icon),this.imgHeadFrame.node.active=!0}else this.imgHeadFrame.node.active=!1;this.myServer.string="[s"+IS(L).GetServerId()+"]",this.myRankName.string=IS(L).GetRoleName()}var r=configRanktype.getDataByKey(B[this.curIndex]).prefix;this.myRankScore.string=r+g.GetNumString(this.myInfo.score||0)}else this.refreshMyRewardInfo()},l.refreshMyRewardInfo=function(){var e,i=0;this.rankInfo&&this.rankInfo.my_info&&(i=this.rankInfo.my_info.rank);var n=configSeason_rank_reward.getDataByList("type",B[this.curIndex]);if(0==i)e=n[n.length-1];else for(var o,r=t(n);!(o=r()).done;){var a=o.value,s=a.range[0],d=a.range[1];if(i>=s){if(0==d){e=a;break}if(i<=d){e=a;break}}}if(this.myRewardScroll.datas=e.reward,0==i){this.myIcon.node.active=!1,this.txtMyRank.node.active=!0;var h="",c=e.range[0],m=e.range[1];h=0==m?c+"+":c==m?c:m+"+",this.txtMyRank.string=h}else i>0&&i<=3?(this.myIcon.node.active=!0,this.txtMyRank.node.active=!1,this.loadIcon(this.myIcon,"common","common_ICON_paiming0"+i)):(this.myIcon.node.active=!1,this.txtMyRank.node.active=!0,this.txtMyRank.string=i+"")},l.onBeforeClose=function(){var e;null==(e=this.rankList)||e.clearData(),this.curIndex>0&&(this.tabBtns[this.curIndex].normalGo.active=!0,this.tabBtns[this.curIndex].selectedGo.active=!1,this.curIndex=0)},l.onDestroy=function(){},l.SetIndex=function(e){if(this.curIndex!=e){if(this.curIndex>0&&(this.tabBtns[this.curIndex].selectedGo.active=!1,this.tabBtns[this.curIndex].normalGo.active=!0),this.curIndex=e,this.tabBtns[this.curIndex].normalGo.active=!1,this.tabBtns[this.curIndex].selectedGo.active=!0,this.bgNode1.active=!1,this.bgNode2.active=!1,this.bgNode3.active=!1,this.bgNode4.active=!1,this.scrollRank.node.active=!1,this.scrollReward.node.active=!1,this.nodeTopRank.active=!1,this.nodeServer.active=!1,this.nodeMyReward.active=!1,this.nodeMyServer.active=!1,this.curIndex==H?(this.bgNode1.active=!0,this.nodeTopRank.active=!0,this.scrollRank.node.active=!0):this.curIndex==D&&(this.bgNode2.active=!0,this.nodeServer.active=!0),this.curIndex==A){this.bgNode3.active=!0,this.nodeTopRank.active=!0,this.scrollReward.node.active=!0,this.nodeMyReward.active=!0;var i=configSeason_rank_reward.getDataByList("type",B[this.curIndex]);this.rewardList.datas=i}else if(this.curIndex==E){this.bgNode4.active=!0,this.nodeMyServer.active=!0,this.scrollReward.node.active=!0,this.nodeMyReward.active=!0;var t=configSeason_rank_reward.getDataByList("type",B[this.curIndex]);this.rewardList.datas=t}this.rankList.scrollView.scrollToTop(),this.page=1,this.isSendToServer=!1;var n=new Array;n.push({type:B[this.curIndex],server:2,page:this.page}),IS(w).reqRankList(n)}},n}(T)),function(e){function t(){for(var i,t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return(i=e.call.apply(e,[this].concat(n))||this).imgIcon=void 0,i.imgHeadFrame=void 0,i.txtScore=void 0,i.txtRank=void 0,i.txtName=void 0,i.txtServer=void 0,i.btnHead=void 0,i.guildFlag=void 0,i}i(t,e);var n=t.prototype;return n.onInit=function(){var e=this;this.imgIcon=f.findChildComponent(this.node,"imgFrame/frame/imgIcon",s),this.imgHeadFrame=f.findChildComponent(this.node,"imgFrame/frame/imgHeadFrame",s),this.txtScore=f.findChildComponent(this.node,"score",a),this.txtRank=f.findChildComponent(this.node,"rank",a),this.txtServer=f.findChildComponent(this.node,"Node/server",a),this.txtName=f.findChildComponent(this.node,"Node/name",a),this.guildFlag=new m(this.view,f.findChild(this.node,"imgFrame/GuildPinItem")),this.btnHead=f.findChild(this.node,"imgFrame"),this.view.addComponentCallbackListener(this.btnHead,o.EventType.CLICK,(function(){e.onItemClick()}))},n.onRender=function(e,i){this.imgIcon.node.active=!0,this.view.loadRemoteIcon(e.info.head.url,this.imgIcon);var t=e.info.head.frame_id;if(t>0){this.imgHeadFrame.node.active=!0;var n=configAvatar_frame.getDataByKey(t);this.view.loadIcon(this.imgHeadFrame,"icon_frame",n.icon)}else this.imgHeadFrame.node.active=!1;this.txtName.string=e.info.name,this.txtServer.string="[s"+e.info.serv_id+"]",this.txtRank.string=e.info.rank;var o=configRanktype.getDataByKey(e.rank_id);this.txtScore.string=o.prefix+g.GetNumString(e.info.score)},n.onItemClick=function(){1004==this.data.rank_id?IS(p).reqOtherRoleNotice(this.data.info.belong_id,2):32==configRanktype.getDataByKey(this.data.rank_id).rank_type?this.data.info.belong_id==IS(L).GetGuildId()?S.showFlyTip(GetLanguage(200233)):IS(x).send_29_1(this.data.info.belong_id):IS(p).reqOtherRoleNotice(this.data.info.belong_id)},t}(v)),U=function(e){function t(){for(var i,t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return(i=e.call.apply(e,[this].concat(n))||this).rewardScroll=void 0,i.txtRank=void 0,i.rankIcon=void 0,i}i(t,e);var n=t.prototype;return n.onInit=function(){this.txtRank=f.findChildComponent(this.node,"rankNum",a),this.rankIcon=f.findChildComponent(this.node,"rankIcon",s);var e=f.findChildComponent(this.node,"rewardScroll",r);this.rewardScroll=this.view.addUIList(e,V,!1),this.rewardScroll.touchEvent=!1,this.rewardScroll.virtual=!1},n.onRender=function(e,i){this.rewardScroll.datas=e.reward;var t=e.range[0],n=e.range[1];if(t==n&&t<=3)this.rankIcon.node.active=!0,this.txtRank.node.active=!1,this.view.loadIcon(this.rankIcon,"common","common_ICON_paiming0"+t);else{this.rankIcon.node.active=!1,this.txtRank.node.active=!0;var o="";o=0==n?t+"+":t==n?t:t+"-"+n,this.txtRank.string=o}},n.onItemClick=function(){},t}(v),V=function(e){function t(){for(var i,t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return(i=e.call.apply(e,[this].concat(n))||this).itemGridNode=void 0,i.itemGrid=void 0,i}i(t,e);var n=t.prototype;return n.onInit=function(){this.itemGridNode=f.findChild(this.node,"itemGrid"),this.itemGrid=new l(this.view,this.itemGridNode)},n.onRender=function(e,i){this.itemGrid.SetItemId(e[0],e[1])},t}(v),q=function(){function e(){this.view=void 0,this.node=void 0,this.rank=void 0,this.nodeEmpty=void 0,this.nodeInfo=void 0,this.nodeScore=void 0,this.nodeImgFrame=void 0,this.txtName=void 0,this.txtServer=void 0,this.txtScore=void 0,this.imgIcon=void 0,this.imgHeadFrame=void 0,this.job=void 0,this.data=void 0,this.role=void 0}var i=e.prototype;return i.init=function(e,i,t){this.view=i,this.node=e,this.rank=t,this.onInit()},i.onInit=function(){var e=this;this.nodeEmpty=f.findChild(this.node,"empty"),this.nodeInfo=f.findChild(this.node,"info"),this.nodeScore=f.findChild(this.node,"score"),this.job=f.findChild(this.node,"role"),this.txtName=f.findChildComponent(this.node,"info/name",a),this.txtServer=f.findChildComponent(this.node,"info/server",a),this.txtScore=f.findChildComponent(this.node,"score",a),this.nodeImgFrame=f.findChild(this.node,"imgFrame"),this.imgIcon=f.findChildComponent(this.node,"imgFrame/imgIcon",s),this.imgHeadFrame=f.findChildComponent(this.node,"imgFrame/imgHeadFrame",s),this.view.addComponentCallbackListener(this.nodeImgFrame,o.EventType.CLICK,(function(){e.data&&IS(p).reqOtherRoleNotice(e.data.belong_id)}));var i=f.findChild(this.node,"role/click");this.view.addComponentCallbackListener(i,o.EventType.CLICK,(function(){e.data&&IS(p).reqOtherRoleNotice(e.data.belong_id)}));var t=f.findChildComponent(this.node,"imgFrame/rank_icon",s);this.view.loadIcon(t,"rank","phb_paiming_tx_"+O[this.rank])},i.show=function(e){if(this.data=e,this.txtName.string="",this.txtScore.string="0",this.imgIcon.node.active=!1,this.nodeEmpty.active=!0,this.nodeInfo.active=!1,this.nodeScore.active=!1,this.nodeImgFrame.active=!1,null!=this.role&&(this.view.removeUnitModel(this.role),this.role=null),e){this.nodeEmpty.active=!1,this.nodeInfo.active=!0,this.nodeScore.active=!0,this.nodeImgFrame.active=!0;var i=e.figure;this.role=IS(C).AddRoleModel(this.view,i,this.job),this.txtName.string=e.name,this.txtServer.string="[s"+e.serv_id+"]";var t=configRanktype.getDataByKey(B[this.view.curIndex]).prefix;this.txtScore.string=t+g.GetNumString(e.score);var n=e.head.frame_id;if(n>0){this.imgHeadFrame.node.active=!0;var o=configAvatar_frame.getDataByKey(n);this.view.loadIcon(this.imgHeadFrame,"icon_frame",o.icon)}else this.imgHeadFrame.node.active=!1;this.imgIcon.node.active=!0,this.view.loadRemoteIcon(e.head.url,this.imgIcon)}},e}();n._RF.pop()}}}));

