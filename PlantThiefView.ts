System.register("chunks:///_virtual/PlantThiefView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./TimeUtil.ts","./index57.ts","./ObjectUtil.ts","./ChatDataCache.ts","./ChatDefine.ts","./MessageView.ts","./FriendListView.ts","./RoleDataCache.ts","./PlantControl.ts","./PlantDefine.ts","./BaseView.ts"],(function(t){"use strict";var i,e,n,o,h,l,a,d,s,f,r,u,m,c,p,I,v,C,g;return{setters:[function(t){i=t.inheritsLoose},function(t){e=t.cclegacy,n=t.Button,o=t.Label,h=t.ProgressBar,l=t.Sprite,a=t.UITransform,d=t.js},function(t){s=t.default},null,function(t){f=t.default},function(t){r=t.ChatDataCache},function(t){u=t.ChatDefine},function(t){m=t.default},function(t){c=t.EFriendListOpenType},function(t){p=t.RoleDataCache},function(t){I=t.default},function(t){v=t.PlantEventDefine,C=t.CropState},function(t){g=t.BaseView}],execute:function(){e._RF.push({},"5f0e6zH3WZK05GVvhBmNUu6","PlantThiefView",void 0);t("default",function(t){function e(){var i;return(i=t.call(this)||this).txtTime=void 0,i.imgIcon=void 0,i.utNameRoot=void 0,i.txtName=void 0,i.utName=void 0,i.utNameTitle=void 0,i.utLevelRoot=void 0,i.txtLevel=void 0,i.utLevel=void 0,i.utLevelTitle=void 0,i.nodeBtnFight=void 0,i.nodeBtnCallFriend=void 0,i.nodeBtnCallGuild=void 0,i.nodeBtnHelpFight=void 0,i.thiefRoleId=void 0,i.farmRoldId=void 0,i.landInfo=void 0,i.cropId=void 0,i.endTime=void 0,i.time=void 0,i.pbTime=void 0,i.startTime=void 0,i.canHelp=!1,i.name="PlantThiefView",i.url="ui/module/plant/PlantThiefView",i}i(e,t);var g=e.prototype;return g.onInit=function(){var t=this;this.time=0;var i=this.findChild("imgMask");this.addComponentCallbackListener(i,n.EventType.CLICK,(function(){t.close()})),this.txtTime=this.findChildComponent("view/thief/info/steal/txtTime",o),this.pbTime=this.findChildComponent("view/thief/info/steal/pbTime",h),this.imgIcon=this.findChildComponent("view/thief/imgFrame/imgIcon",l),this.utNameRoot=this.findChildComponent("view/thief/info/name",a),this.txtName=this.findChildComponent("view/thief/info/name/name",o),this.utName=this.txtName.node.getComponent(a),this.utNameTitle=this.findChildComponent("view/thief/info/name/txt",a),this.utLevelRoot=this.findChildComponent("view/thief/info/level",a),this.txtLevel=this.findChildComponent("view/thief/info/level/txtLevel",o),this.utLevel=this.txtLevel.node.getComponent(a),this.utLevelTitle=this.findChildComponent("view/thief/info/level/txt",a),this.nodeBtnFight=this.findChild("view/btnFight"),this.addComponentCallbackListener(this.nodeBtnFight,n.EventType.CLICK,(function(){t.onFightClick()})),this.nodeBtnCallFriend=this.findChild("view/btnCallFriend"),this.addComponentCallbackListener(this.nodeBtnCallFriend,n.EventType.CLICK,(function(){t.onCallFriendClick()})),this.nodeBtnCallGuild=this.findChild("view/btnCallGuild"),this.addComponentCallbackListener(this.nodeBtnCallGuild,n.EventType.CLICK,(function(){t.onCallGuildClick()})),this.nodeBtnHelpFight=this.findChild("view/btnHelpFight"),this.addComponentCallbackListener(this.nodeBtnHelpFight,n.EventType.CLICK,(function(){t.onHelpFightClick()}))},g.registerUpdateHandler=function(){this.addEvent(v.ROLE_LAND_INFO_UPDATE,this.onRoleLandUpdate,this),this.addEvent(v.ROLE_HOME_FARM_INFO_BACK,this.onRoleHomeInfoBack,this),this.addEvent(v.FARM_CHOOSE_HELPER_FINISH,this.onFarmChooseHelperFinish,this)},g.onAfterOpen=function(){this.time=0,this.farmRoldId=this.openArgs[0],this.landInfo=this.openArgs[1],this.canHelp=this.openArgs[2]||!1,this.updateLandInfo()},g.updateLandInfo=function(){if(null!=this.landInfo){var t=this.landInfo.crop;if(null==t)return m.showFlyTip(GetLanguage(200519)),void this.close();if(t.state!=C.STEALING)return m.showFlyTip(GetLanguage(200520)),void this.close();this.cropId=t.id,this.endTime=t.end_time,this.startTime=t.start_time,this.updateThiefShow(),this.updateBtnShow(),this.updateTimeShow()}},g.updateThiefShow=function(){var t=this,i=this.landInfo.crop.robber;f.isEmpty(i)||(this.thiefRoleId=i.id,this.txtName.string=i.name,this.loadRemoteIcon(i.head.url,this.imgIcon),this.txtLevel.string=d.formatStr("Lv.%s",i.level),this.txtName.schedule((function(){var i=Math.max(t.utName.height,t.utNameTitle.height);t.utNameRoot.height=i+2.2}),0),this.txtLevel.schedule((function(){var i=Math.max(t.utLevel.height,t.utLevelTitle.height);t.utLevelRoot.height=i+2.2}),0))},g.updateBtnShow=function(){var t=this.farmRoldId==IS(p).GetRoleId();this.nodeBtnFight.active=t,this.nodeBtnCallFriend.active=t,this.nodeBtnCallGuild.active=t,this.nodeBtnHelpFight.active=!t&&this.canHelp&&this.thiefRoleId!=IS(p).GetRoleId()},g.onUpdate=function(t){this.time=this.time+t,this.time>=1&&(this.time=0,this.updateTimeShow())},g.updateTimeShow=function(){if(null!=this.endTime){var t=this.endTime-s.serverTime;t<0&&IS(I).reqFarmInfo(this.farmRoldId),this.txtTime.string=s.formatTimeForSecond(Math.max(0,t)),this.pbTime.progress=(s.serverTime-this.startTime)/(this.endTime-this.startTime)}},g.onBeforeClose=function(){this.canHelp=!1,this.thiefRoleId=null,this.farmRoldId=null,this.landInfo=null},g.onDestroy=function(){},g.onRoleLandUpdate=function(t,i){this.farmRoldId==t&&i.id==this.landInfo.id&&(this.landInfo=i,this.updateLandInfo())},g.onRoleHomeInfoBack=function(t){this.farmRoldId!=IS(p).GetRoleId()&&this.farmRoldId==t.role_id&&(this.landInfo=t.landIdToInfo[this.landInfo.id],this.updateLandInfo())},g.onFarmChooseHelperFinish=function(t){null!=t&&t==this.farmRoldId&&IS(I).reqFarmInfo(this.farmRoldId)},g.onFightClick=function(){var t=this.landInfo.crop.battle_list,i=IS(p).GetRoleId();if(t&&t.length>0)for(var e=0;e<t.length;e++)if(t[e]==i)return void m.showFlyTip(GetLanguage(200521));IS(I).reqHomeFarmBattleBegin(this.cropId,this.thiefRoleId,this.openArgs[3],this.landInfo.id),battleMain.enterChapter(0),this.close()},g.onCallFriendClick=function(){var t={farmRoleId:this.farmRoldId,landId:this.landInfo.id,thiefRoleId:this.thiefRoleId,cropId:this.cropId,shareList:this.landInfo.crop.share_list,endTime:this.endTime};uiMgr.openView("PlantFriendView",c.PlantRequestHelp,t)},g.onCallGuildClick=function(){if(IS(p).HasGuild()){var t={farmRoleId:this.farmRoldId,landId:this.landInfo.id,thiefRoleId:this.thiefRoleId,cropId:this.cropId,shareList:this.landInfo.crop.share_list,endTime:this.endTime};IS(r).SendShareData(u.ChatLinkType.FarmHelp,t,u.Channel.Guild),m.showFlyTip(GetLanguage(200523)),this.close()}else m.showFlyTip(GetLanguage(200522))},g.onHelpFightClick=function(){var t=this.landInfo.crop.battle_list,i=IS(p).GetRoleId();if(t&&t.length>0)for(var e=0;e<t.length;e++)if(t[e]==i)return void m.showFlyTip(GetLanguage(200524));IS(I).reqHomeFarmBattleBegin(this.cropId,this.thiefRoleId,this.openArgs[3],this.landInfo.id),battleMain.enterChapter(0),this.close()},e}(g));e._RF.pop()}}}));

