System.register("chunks:///_virtual/EquipControl.ts",["cc","./ConfigGlobal.ts","./MessageView.ts","./EquipDataCache.ts","./EquipDefine.ts","./EquipModel.ts"],(function(e){"use strict";var n,i,t,u,_,o,a;return{setters:[function(e){n=e.cclegacy},function(e){i=e.ConfigGlobal},function(e){t=e.default},function(e){u=e.EquipDataCache},function(e){_=e.EquipEventDefine,o=e.BoxChangeType},function(e){a=e.EquipModel}],execute:function(){n._RF.push({},"02565BthD1LC61qLJ7wbALn","EquipControl",void 0);var s=i.batch_auto_open_box;e("default",function(){var e=n.prototype;function n(){netManager.addEventListener("equip.equip_info_s2c",this.on_equip_info_s2c,this),netManager.addEventListener("equip.equip_change_s2c",this.on_equip_change_s2c,this),netManager.addEventListener("equip.equip_shop_s2c",this.on_equip_shop_s2c,this),netManager.addEventListener("equip.equip_box_info_s2c",this.on_equip_box_info_s2c,this),netManager.addEventListener("equip.equip_box_open_s2c",this.on_equip_box_open_s2c,this),netManager.addEventListener("equip.equip_box_open_all_s2c",this.on_equip_box_open_all_s2c,this),netManager.addEventListener("equip.equip_book_list_s2c",this.on_equip_book_list_s2c,this),netManager.addEventListener("equip.equip_book_update_s2c",this.on_equip_book_update_s2c,this),netManager.addEventListener("equip.equip_figure_list_s2c",this.on_equip_figure_list_s2c,this),netManager.addEventListener("equip.equip_figure_s2c",this.on_equip_figure_s2c,this),netManager.addEventListener("equip.equip_tab_info_s2c",this.on_equip_tab_info_s2c,this),netManager.addEventListener("equip.equip_change_tab_name_s2c",this.on_equip_change_tab_name_s2c,this),netManager.addEventListener("equip.equip_box_skin_s2c",this.on_equip_box_skin_s2c,this),netManager.addEventListener("equip.equip_change_box_skin_s2c",this.on_equip_change_box_skin_s2c,this)}return e.clear=function(){console.log("清理EquipControl")},e.reqEquipInfo=function(){netManager.send("equip.equip_info_c2s",{})},e.on_equip_info_s2c=function(e){IS(u).equipList=e.equip_list,normalEvent.emit(_.EQUIP_LIST_INIT)},e.reqWearEquip=function(e){netManager.send("equip.equip_wear_c2s",{equip_id:e})},e.on_equip_change_s2c=function(e){IS(u).updateEquipList(e.type,e.change_list,e.sub_type)},e.reqSellEquip=function(e){for(var n,i,u=!1,_=e.length,o=0;o<_;o++){n=e[o];var s=IS(a).getEquipInfoByEquipId(n);if(null!=s){i=s.config_id;var p=configEquipment.getDataByKey(i);null!=p.is_precious&&1==p.is_precious&&(u=!0)}}if(u){var q=_>1?GetLanguage(200242):GetLanguage(200243);t.showBoxTip({tip:q,title:GetLanguage(200048),func:function(n){"type_yes"==n&&netManager.send("equip.equip_shop_c2s",{equip_ids:e})}})}else netManager.send("equip.equip_shop_c2s",{equip_ids:e})},e.on_equip_shop_s2c=function(e){IS(a).isAutoOpen&&IS(a).getEmptyEquipIdList(!1,0).length<=0&&IS(a).tryAutoMultiOpenBox(),normalEvent.emit(_.EQUIP_SELL,e.reward)},e.reqBoxInfo=function(){netManager.send("equip.equip_box_info_c2s",{})},e.on_equip_box_info_s2c=function(e){var n,i=IS(u).boxInfo;if(i)if(0!=i.lv&&i.lv!=e.lv){n=o.lvUp;for(var a=0,p=0,q=0;q<s.length;q++)i.lv>=s[q][0]&&(a=s[q][1]),e.lv>=s[q][0]&&(p=s[q][1]);for(var r=configTreasure_level.getDataByKey(i.lv),c=configTreasure_level.getDataByKey(e.lv).pro_quality,l=0,f=0,g=0;g<c.length;g++)c[g][1]>0&&c[g][0]>l&&(l=c[g][0],f=c[g][1]);for(var d=0,E=r.pro_quality,h=0;h<E.length;h++)if(E[h][0]==l){d=E[h][1];break}t.onEquipBoxShowEffect(l,d,f),a!=p&&normalTimer.start(1.5,1,(function(){t.onLevelUpShowEffect(a,p)}))}else i.exp!=e.exp&&(n=o.expAdd);IS(u).boxInfo=e,IS(u).updateBoxProgressRedPoint(),IS(u).updateBoxUpgradeRedPoint(),normalEvent.emit(_.BOX_INFO_UPDATE,n)},e.reqUpBoxLv=function(){netManager.send("equip.equip_box_lv_c2s",{})},e.reqOpenBox=function(){netManager.send("equip.equip_box_open_c2s",{})},e.on_equip_box_open_s2c=function(e){var n=e.equip_id;IS(a).doAfterOpenBox([n])},e.reqMutiOpenBox=function(e,n){netManager.send("equip.equip_box_open_all_c2s",{num:e,quality:n})},e.on_equip_box_open_all_s2c=function(e){var n=e.equip_ids,i=e.reward;i&&i.length>0&&normalEvent.emit(_.EQUIP_SELL,i),null==n||n.length<=0||(n.sort((function(e,n){var i=IS(a).getEquipInfoByEquipId(e),t=IS(a).getEquipInfoByEquipId(n),u=configEquipment.getDataByKey(null==i?void 0:i.config_id),_=configEquipment.getDataByKey(null==t?void 0:t.config_id);return(null==u?void 0:u.quality)!=(null==_?void 0:_.quality)?(null==u?void 0:u.quality)>(null==_?void 0:_.quality)?-1:1:(null==i?void 0:i.equip_lv)!=(null==t?void 0:t.equip_lv)?(null==i?void 0:i.equip_lv)>(null==t?void 0:t.equip_lv)?-1:1:e<n?-1:1})),IS(a).doAfterOpenBox(n))},e.reqBoxLvSpeed=function(e){netManager.send("equip.equip_box_lv_speed_c2s",{num:e})},e.reqEquipBookList=function(){netManager.send("equip.equip_book_list_c2s",{})},e.on_equip_book_list_s2c=function(e){IS(u).setEquipGot(e.got_list,!0)},e.on_equip_book_update_s2c=function(e){IS(u).setEquipGot(e.add_list)},e.reqEquipFigureList=function(){netManager.send("equip.equip_figure_list_c2s",{})},e.on_equip_figure_list_s2c=function(e){IS(u).initEquipFigure(e.figure_list)},e.reqEquipFigure=function(e,n){netManager.send("equip.equip_figure_c2s",{figure:{k:e,v:n}})},e.on_equip_figure_s2c=function(e){IS(u).updateFigure(e.figure_list)},e.reqEquipSuitInfo=function(){netManager.send("equip.equip_tab_info_c2s",{})},e.on_equip_tab_info_s2c=function(e){IS(u).updateTabInfo(e)},e.reqEquipChooseSuitInfo=function(e){netManager.send("equip.equip_choose_tab_c2s",{tab:e})},e.reqEquipChangeTabName=function(e,n){netManager.send("equip.equip_change_tab_name_c2s",{tab:e,name:n})},e.on_equip_change_tab_name_s2c=function(e){for(var n=e.tab,i=e.name,o=IS(u).tabInfo.unlock_list,a=0;a<o.length;a++)if(o[a].k==n){o[a].s=i;break}t.showFlyTip(GetLanguage(200577)),uiMgr.close("TabRenameView"),normalEvent.emit(_.EQUIP_TAB_NAME_CHANGE,n)},e.reqEquipBoxSkin=function(){netManager.send("equip.equip_box_skin_c2s",{},!0)},e.on_equip_box_skin_s2c=function(e){IS(u).curSkin=e.id,normalEvent.emit(_.BOX_SKIN_CHANGE)},e.reqEquipChangeBoxSkin=function(e){netManager.send("equip.equip_change_box_skin_c2s",{id:e},!0)},e.on_equip_change_box_skin_s2c=function(e){IS(u).curSkin=e.id,IS(a).setAutoOpen(!1),t.showFlyTip(GetLanguage(204526)),normalEvent.emit(_.BOX_SKIN_CHANGE)},n}());n._RF.pop()}}}));

