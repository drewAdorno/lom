System.register("chunks:///_virtual/BuffShield.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ObjectPool.ts","./FixMath.ts","./EnumDefine.ts","./index83.ts","./Buff.ts","./MetaAttrib.ts","./BuffCtr.ts"],(function(t){"use strict";var e,i,a,n,r,s,o,u,h,f,d;return{setters:[function(t){e=t.inheritsLoose,i=t.createForOfIteratorHelperLoose},function(t){a=t.cclegacy},function(t){n=t.ObjectPool},function(t){r=t.FixMath},function(t){s=t.BuffGroupType,o=t.StateTrigerType,u=t.HealthType},null,function(t){h=t.Buff},function(t){f=t.AttribDefine},function(t){d=t.freeBuffList}],execute:function(){var l;a._RF.push({},"e6f071gab1A0bcdttbHD1ej","BuffShield",void 0),function(t){t[t.Attack=1]="Attack",t[t.Target=2]="Target"}(l||(l={}));var c=t("BuffShield",function(t){function a(){for(var e,i=arguments.length,a=new Array(i),n=0;n<i;n++)a[n]=arguments[n];return(e=t.call.apply(t,[this].concat(a))||this)._hpType=void 0,e._calType=void 0,e._attribId=void 0,e._value=void 0,e._buffList=[],e._buffs=[],e}e(a,t);var n=a.prototype;return n.onBegin=function(){var t=this.owner,e=this.runner.cast,a=0;switch(this._calType){case 0:a=this._hpType&l.Target?t.data.getAttrib(this._attribId):e.data.getAttrib(this._attribId);break;case 1:var n=e.data.getAttrib(f.att),h=t.data.getAttrib(f.def),d=t.data.getAttrib(f.def_coe);a=Math.max(r.roundInt(n-h*(1+d)),1);break;case 2:var c=e.data.getAttrib(f.hp);a=r.roundInt(c-t.data.currenHp);break;case 3:a=r.roundInt(t.data.currenHp)}a=r.roundInt(a*this.skillPar),a=r.roundInt(a*r.round(1+t.data.getAttrib(f.shield_hp_extra))),a=r.roundInt(a*t.battleMain.shieldDecay),this._value=a;var p=this.config.param5;if(p.length>0)for(var _,v=p[0],b=i(v);!(_=b()).done;){var g=_.value;this._buffs.push(this.runner.addBuff(t,g[0],-1,r.round(g[1]/1e4)))}this._buffList.length=0;for(var I,y=t.buffCtr.getBuffByType(s.STATE_TRIGER),H=i(y);!(I=H()).done;){var T=I.value.onStateTrigger(o.Shield);T&&T.length>0&&this._buffList.push(T)}this.owner.data.shieldHp=r.roundInt(this.owner.data.shieldHp+this._value),t.battleMain.openLogCount&&t.battleMain.addLogCount(e.unitId,t.config.id,u.Shield,a,t.teamId,this.runner.useSkill.config.id,this.owner.data.shieldHp)},n.onDestroy=function(){if(this._buffList&&this._buffList.length>0){for(var t=0;t<this._buffList.length;t++)d(this._buffList[t]),this._buffList[t].length=0;this._buffList.length=0}for(var e,n=i(this._buffs);!(e=n()).done;){e.value.stop()}if(this._buffs.length=0,this._value>0){this.owner.data.shieldHp=r.roundInt(this.owner.data.shieldHp-this._value),this.owner.data.shieldHp=Math.max(0,this.owner.data.shieldHp);var s=this.owner,o=this.runner.cast;s.battleMain.openLogCount&&s.battleMain.addLogCount(o.unitId,s.config.id,u.Shield,-this._value,s.teamId,this.runner.useSkill.config.id,s.data.shieldHp)}var h=this.config.param5;if(h.length>0&&h[1])for(var f,l=h[1],c=i(l);!(f=c()).done;){var p=f.value;this.runner.addBuff(this.owner,p[0],p[1],r.round(p[2]/1e4))}a._pool.free(this)},n.onShieldAction=function(t){if(!this._run)return 0;var e=this._value>=t?t:this._value;return this.owner.data.shieldHp=r.roundInt(this.owner.data.shieldHp-e),this.owner.data.shieldHp=Math.max(0,this.owner.data.shieldHp),this._value=r.roundInt(this._value-e),this._value<=0&&this.stop(),e},a.alloc=function(t){var e=a._pool.alloc();return e.config=t,e._hpType=t.param1,e._calType=t.param2,e._attribId=t.param3,e},a}(h));c._pool=new n(c,30),a._RF.pop()}}}));

