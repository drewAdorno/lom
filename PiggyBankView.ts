System.register("chunks:///_virtual/PiggyBankView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./StorageUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./MessageView.ts","./PayDataCache.ts","./PayDefine.ts","./RoleDataCache.ts","./TaskDataCache.ts","./TaskDefine.ts","./PrivilegeDataCache.ts","./PrivilegeDefine.ts","./BaseView.ts"],(function(t){"use strict";var i,e,n,o,s,a,r,d,h,l,u,c,f,g,m,v,P,p,y,C,B,T,I;return{setters:[function(t){i=t.inheritsLoose},function(t){e=t.cclegacy,n=t.Button,o=t.Sprite,s=t.Label,a=t.ProgressBar,r=t.ScrollView,d=t.sys},function(t){h=t.ItemGrid},function(t){l=t.ListItem},function(t){u=t.default},function(t){c=t.default},function(t){f=t.default},function(t){g=t.default},null,function(t){m=t.default},function(t){v=t.default},function(t){P=t.PayEventDefine},function(t){p=t.RoleDataCache},function(t){y=t.TaskDataCache},function(t){C=t.TaskEventDefine},function(t){B=t.PrivilegeDataCache},function(t){T=t.PrivilegeEventDefine},function(t){I=t.BaseView}],execute:function(){e._RF.push({},"f3841LYkBBDY4JAq0C1t7GH","PiggyBankView",void 0);var b=19001,x=(t("default",function(t){function e(){var i;return(i=t.call(this)||this).txtMultiplier=void 0,i.pb=void 0,i.txtProgress=void 0,i.txtResetTime=void 0,i.rewardList=void 0,i.btnBuy=void 0,i.imgNormal=void 0,i.imgGrey=void 0,i.txtPrice=void 0,i.txtSoldOut=void 0,i.maxPoint=void 0,i.endTime=void 0,i.leftTime=0,i.deltaTime=0,i.canUpdate=!1,i.isPbFulled=!1,i.isBought=!1,i.RedPoint=void 0,i.name="PiggyBankView",i.url="ui/module/recharge/PiggyBankView",i.poolTime=3e3,i}i(e,t);var h=e.prototype;return h.onInit=function(){var t=this,i=this.findChild("root/imgMask");this.addComponentCallbackListener(i,n.EventType.CLICK,(function(){t.onCloseClick()}));var e=this.findChildComponent("root/bg/bg4",o);this.loadIcon(e,"cqg","cqg_ui_zhu"),this.txtMultiplier=this.findChildComponent("root/nodeMultiplier/Label",s),this.pb=this.findChildComponent("root/ProgressBar",a),this.txtProgress=this.findChildComponent("root/ProgressBar/Label",s),this.txtResetTime=this.findChildComponent("root/txtTime",s);var d=this.findChildComponent("root/RewardScroll",r);this.rewardList=this.addUIList(d,x),this.rewardList.lackCenter=!0,this.btnBuy=this.findChild("root/btnBuy"),this.imgNormal=this.findChild("root/btnBuy/imgNormal"),this.RedPoint=this.findChild("root/btnBuy/imgNormal/RedPoint"),this.imgGrey=this.findChild("root/btnBuy/imgGrey"),this.addComponentCallbackListener(this.btnBuy,n.EventType.CLICK,(function(){if(t.isPbFulled&&!t.isBought)IS(v).Pay(b);else{if(!t.isPbFulled)return void uiMgr.openView("PiggyBankJumpView");t.isBought&&m.showFlyTip(GetLanguage(200039))}})),this.txtPrice=this.findChildComponent("root/btnBuy/txtPrice",s),this.txtSoldOut=this.findChildComponent("root/btnBuy/txtSoldOut",s)},h.onAfterOpen=function(){var t=configPay_mall.getDataByKey(b);this.txtPrice.string=IS(v).GetPriceString(t.cost_level),this.txtMultiplier.string=100*t.ratio+"%",this.rewardList.datas=t.reward;var i=configDaily_task_reward.getDatas();this.maxPoint=i[i.length-1].point,this.updateBar(),this.updatePayInfo()},h.registerUpdateHandler=function(){this.addEvent(C.TASK_DAILY_UPDATE,this.updateBar,this),this.addEvent(P.PAY_INFO_UPDATE,this.updatePayInfo,this)},h.onCloseClick=function(){this.close()},h.onBeforeClose=function(){},h.onDestroy=function(){},h.onUpdate=function(t){this.canUpdate&&(this.deltaTime=this.deltaTime+t,this.deltaTime>=1&&(this.deltaTime=0,this.leftTime=this.leftTime-1,this.leftTime>0?this.txtResetTime.string=d.uiMirror?g.formatTimeStringForSecond(this.leftTime):f.formatStr(GetLanguage_UI(999000514),g.formatTimeStringForSecond(this.leftTime)):(this.txtResetTime.string=GetLanguage(200026),this.canUpdate=!1)))},h.updateBar=function(){var t=IS(y).GetDailyPoint();this.pb.progress=t/this.maxPoint,this.txtProgress.string=t+"/"+this.maxPoint,this.pb.progress<1?this.isPbFulled=!1:this.isPbFulled=!0,this.updateBtnGrey()},h.updatePayInfo=function(){var t=IS(v).GetPayGiftInfo(b);if(!t)return m.showFlyTip(GetLanguage(200026)),void this.close();this.endTime=t.end_time,this.leftTime=this.endTime-g.serverTime,this.leftTime>0&&(this.canUpdate=!0),t.bought_times>0?this.isBought=!0:this.isBought=!1,this.updateBtnGrey()},h.updateBtnGrey=function(){if(this.isPbFulled&&!this.isBought){IS(B).PiggyBankRedPoint=1,this.imgGrey.active=!1,this.imgNormal.active=!0;var t="PiggyBankRed"+IS(p).GetRoleId();return this.RedPoint.active="1"==c.get(t),this.txtPrice.node.active=!this.isBought,this.txtSoldOut.node.active=this.isBought,void normalEvent.emit(T.ACITVITY_RED_UPDATE)}IS(B).PiggyBankRedPoint=0,this.imgGrey.active=!0,this.imgNormal.active=!1,this.txtPrice.node.active=!this.isBought,this.txtSoldOut.node.active=this.isBought,normalEvent.emit(T.ACITVITY_RED_UPDATE)},e}(I)),function(t){function e(){for(var i,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(i=t.call.apply(t,[this].concat(n))||this).itemGridNode=void 0,i.itemGrid=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){this.itemGridNode=u.findChild(this.node,"itemGrid"),this.itemGrid=new h(this.view,this.itemGridNode)},n.onRender=function(t,i){this.itemGrid.SetItemId(t[0],t[1])},e}(l));e._RF.pop()}}}));

