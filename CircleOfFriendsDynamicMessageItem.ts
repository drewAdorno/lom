System.register("chunks:///_virtual/CircleOfFriendsDynamicMessageItem.ts",["./rollupPluginModLoBabelHelpers.js","cc","./TranslateTips.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./ConfigGlobal.ts","./RoleDataCache.ts","./CircleOfFriendsControl.ts","./CircleOfFriendsDefine.ts"],(function(t){"use strict";var e,i,n,o,s,a,d,h,m,r,c,l,C,f,p,g,v,u,L,I,T;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,n=t.Button,o=t.UITransform,s=t.Label,a=t.sys,d=t.Widget,h=t.Sprite,m=t.RichText,r=t.HorizontalTextAlignment,c=t.js},function(t){l=t.TranslateTips},function(t){C=t.ListItem},function(t){f=t.default},function(t){p=t.default},function(t){g=t.default},function(t){v=t.ConfigGlobal},function(t){u=t.RoleDataCache},function(t){L=t.default},function(t){I=t.CircleOfFriendsEvent,T=t.CircleOfFriendsDefine}],execute:function(){i._RF.push({},"16377A6aMdJXorc56UPBpda","CircleOfFriendsDynamicMessageItem",void 0);t("CircleOfFriendsDynamicMessageItem",function(t){function i(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).widgeAlign={left:1,right:2},e.btn=void 0,e.name=void 0,e.time=void 0,e.posNode=void 0,e.posName=void 0,e.official=void 0,e.gmIcon=void 0,e.headImg=void 0,e.imgHeadFrame=void 0,e.attentionBtn=void 0,e.operateBtn=void 0,e.attentionNormal=void 0,e.attentionActive=void 0,e.attentionTxt=void 0,e.isTempItem=void 0,e.bgTrans=void 0,e.content=void 0,e.contenTrans=void 0,e.picWidge=void 0,e.picIcon=void 0,e.commentListWidge=void 0,e.commentListTrans=void 0,e.isLike=void 0,e.emptyLike=void 0,e.likeNum=void 0,e.commentNum=void 0,e.operateListWidge=void 0,e.commentList=[],e.translateTips=void 0,e}e(i,t);var C=i.prototype;return C.onInit=function(){var t=this;if(this.view.addComponentCallbackListener(f.findChild(this.node,"playerInfo/head"),n.EventType.CLICK,(function(){0!=t.data.role_id&&normalEvent.emit(I.OpenChildView,T.ViewType.OtherPanel,[t.data.role_id])})),this.btn=f.findChildComponent(this.node,"btn",o),this.view.addComponentCallbackListener(this.btn.node,n.EventType.CLICK,(function(){normalEvent.emit(I.OpenChildView,T.ViewType.MessageMainPanel,[t.data])})),this.name=f.findChildComponent(this.node,"playerInfo/name",s),this.time=f.findChildComponent(this.node,"time",s),this.posNode=f.findChild(this.node,"time/pos"),a.uiMirror){var e=f.findChildComponent(this.node,"time/pos",d),i=e.right;e.isAlignRight=!1,e.isAlignLeft=!0,e.left=i,e.node.setScale(-1,1,1)}this.posName=f.findChildComponent(this.node,"time/pos/name",s),this.attentionBtn=f.findChild(this.node,"attentionBtn"),this.attentionNormal=f.findChild(this.node,"attentionBtn/normal"),this.attentionActive=f.findChild(this.node,"attentionBtn/active"),this.attentionTxt=f.findChildComponent(this.node,"attentionBtn/Label",s),this.view.addComponentCallbackListener(this.attentionBtn,n.EventType.CLICK,(function(){1==t.data.state||3==t.data.state||IS(L).sendToSubscrib(t.data.role_id,1)})),this.operateBtn=f.findChild(this.node,"operateBtn"),this.view.addComponentCallbackListener(this.operateBtn,n.EventType.CLICK,(function(){uiMgr.openView("CircleOfFriendsOperateView",t.operateBtn,t.data.id)})),this.official=f.findChild(this.node,"playerInfo/name/official"),this.gmIcon=f.findChild(this.node,"playerInfo/head/gmIcon"),this.headImg=f.findChildComponent(this.node,"playerInfo/head/image",h),this.imgHeadFrame=f.findChildComponent(this.node,"playerInfo/head/imgHeadFrame",h),this.bgTrans=f.findChildComponent(this.node,"messageContent/bg",o),this.content=f.findChildComponent(this.node,"messageContent/content",m),this.contenTrans=f.findChildComponent(this.node,"messageContent/content",o),this.picWidge=f.findChildComponent(this.node,"messageContent/pic",d),this.view.addComponentCallbackListener(this.picWidge.node,n.EventType.CLICK,(function(){uiMgr.openView("CircleOfFriendsPicCheckView",t.picIcon.spriteFrame)})),this.picIcon=f.findChildComponent(this.node,"messageContent/pic/mask/default",h),this.commentListWidge=f.findChildComponent(this.node,"messageContent/commentList",d),this.commentListTrans=f.findChildComponent(this.node,"messageContent/commentList",o),this.isLike=f.findChild(this.node,"messageContent/operateList/likeBtn/isLike"),this.emptyLike=f.findChild(this.node,"messageContent/operateList/likeBtn/empty"),this.likeNum=f.findChildComponent(this.node,"messageContent/operateList/likeBtn/num",s),this.view.addComponentCallbackListener(f.findChild(this.node,"messageContent/operateList/likeBtn"),n.EventType.CLICK,(function(){IS(L).sendToPostMomentLike(t.data.id,1==t.data.is_like?2:1)})),this.commentNum=f.findChildComponent(this.node,"messageContent/operateList/commentBtn/num",s),this.operateListWidge=f.findChildComponent(this.node,"messageContent/operateList",d),this.view.addComponentCallbackListener(f.findChild(this.node,"messageContent/operateList/commentBtn"),n.EventType.CLICK,(function(){uiMgr.openView("CircleOfFriendsCommentView",t.data.id)})),this.translateTips=new l(this.view,f.findChild(this.node,"messageContent/operateList/translateBtn"));for(var c=0;c<3;c++)if(this.commentList.push({node:f.findChild(this.node,"messageContent/commentList/item"+(c+1)),name:f.findChildComponent(this.node,"messageContent/commentList/item"+(c+1)+"/name",s),content:f.findChildComponent(this.node,"messageContent/commentList/item"+(c+1)+"/name/content",s)}),a.uiMirror){f.findChildComponent(this.node,"messageContent/commentList/item"+(c+1)+"/name/content",s).horizontalAlign=r.RIGHT;var C=f.findChildComponent(this.node,"messageContent/commentList/item"+(c+1)+"/name/content",d),p=C.right;C.isAlignRight=!1,C.isAlignLeft=!0,C.left=p}},C.onRender=function(t,e){if(0==t.role_id?(this.name.string=GetLanguage(v.circle_official_name_id),this.official.active=!0,this.gmIcon.active=!0,this.headImg.node.active=!1):(this.headImg.node.active=!0,this.name.string=p.GetServNameById(t.server_id)+t.name,this.official.active=!1,this.gmIcon.active=!1,this.view.loadRemoteIcon(t.head_url,this.headImg)),t.area1&&t.area1>0){this.posNode.active=!0;var i=configCircle_location.getDataByKey(t.area1);this.posName.string=i.name}else this.posNode.active=!1;if(this.time.string=g.getDateDiff(t.time),t.role_id==IS(u).GetRoleId()||0==t.role_id)this.attentionBtn.active=!1,this.operateBtn.active=t.role_id==IS(u).GetRoleId();else{this.attentionBtn.active=!0,this.operateBtn.active=!1;var n=1==t.state||3==t.state;this.attentionNormal.active=!n,this.attentionActive.active=n,this.attentionTxt.string=n?GetLanguage(300127):GetLanguage(300128)}var o=t.head_frame;if(o>0){this.imgHeadFrame.node.active=!0;var s=configAvatar_frame.getDataByKey(o);this.view.loadIcon(this.imgHeadFrame,"icon_frame",s.icon)}else this.imgHeadFrame.node.active=!1;this.translateTips.SetTranslateInfo("CircleOfFriend",t.id,t.moment);var d=this.translateTips.GetShowContent();this.content.string=c.formatStr("<color=#544231>%s</color>",d);var h=5+this.contenTrans.height;t.photo&&""!=t.photo?(this.picWidge.top=h,h+=266,this.picWidge.node.active=!0,this.view.loadRemoteIcon(t.photo,this.picIcon)):(this.picWidge.node.active=!1,h+=5),this.operateListWidge.top=h,h+=36,h+=10,this.commentListWidge.top=h;var m=0;this.isLike.active=1==t.is_like,this.emptyLike.active=0==t.is_like,this.likeNum.string=t.like_num,this.commentNum.string=t.discuss_num;for(var r=0;r<this.commentList.length;r++){var l=t.discusses[r];if(this.commentList[r].node.active=!(!l&&0!=r),l||0!=r){if(l){var C=a.uiMirror?"："+l.name:l.name+"：";if(this.commentList[r].name.string=C,this.commentList[r].content.string=l.discuss,p.getStringLength(C+l.discuss)>22){var f=22-p.getStringLength(C),L=l.discuss;this.commentList[r].content.string=L.slice(0,f)+"..."}m++}}else this.commentList[r].name.string="",this.commentList[r].content.string=GetLanguage(300129),m++}h+=10+34*m+10,this.bgTrans.height=h+20,this.btn.height=h+78},C.CalcHeight=function(t){this.translateTips.SetTranslateInfo("CircleOfFriend",t.id,t.moment);var e=this.translateTips.GetShowContent(),i=78;this.content.string=c.formatStr("<color=#544231>%s</color>",e),i+=5,i+=this.contenTrans.height,t.photo&&""!=t.photo?(i+=256,i+=10):i+=5,i+=36;for(var n=0,o=0;o<this.commentList.length;o++){var s=t.discusses[o];s||0!=o?s&&n++:n++}return i+=10,i+=10+34*n+10,i+=20},C.GetShowContent=function(t){var e=t;return this.translateTips.SetTranslateInfo("CircleOfFriend",e.id,e.moment),this.translateTips.GetShowContent()},i}(C));i._RF.pop()}}}));

