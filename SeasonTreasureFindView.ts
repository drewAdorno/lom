System.register("chunks:///_virtual/SeasonTreasureFindView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./NodeUtil.ts","./StorageUtil.ts","./StringUtil.ts","./index57.ts","./SpineSkeleton.ts","./BagDefine.ts","./BagModel.ts","./MessageView.ts","./SeasonControl.ts","./SeasonDataCache.ts","./SeasonDefine.ts","./BaseSubView.ts"],(function(t){"use strict";var i,e,n,o,s,r,a,d,h,u,f,l,c,p,C,m,S,g,v,w,T,I,L;return{setters:[function(t){i=t.inheritsLoose,e=t.createForOfIteratorHelperLoose},function(t){n=t.cclegacy,o=t.Button,s=t.sys,r=t.HorizontalTextAlignment,a=t.RichText,d=t.Toggle,h=t.Sprite,u=t.js,f=t.Label},function(t){l=t.default},function(t){c=t.default},function(t){p=t.default},null,function(t){C=t.SpineSkeleton},function(t){m=t.BagEventDefine},function(t){S=t.BagModel},function(t){g=t.default},function(t){v=t.default},function(t){w=t.SeasonDataCache},function(t){T=t.SeasonShipEventDefind,I=t.TREASURE_QUALITY_TO_EFFLIGHT},function(t){L=t.BaseSubView}],execute:function(){n._RF.push({},"bfe706o7wZG4oSt4LvosHov","SeasonTreasureFindView",void 0);var k=[270008];t("default",function(t){function n(){var i;return(i=t.call(this)||this).nodeResParent=void 0,i.nodeResItem=void 0,i.resItems=void 0,i.btnOne=void 0,i.btnTen=void 0,i.txtOne=void 0,i.txtTen=void 0,i.togSkip=void 0,i.skipAnim=void 0,i.txtCount=void 0,i.eff=void 0,i.rewardList=[],i.showTimer=0,i.name="SeasonTreasureFindView",i.url="ui/module/season/SeasonTreasureFindView",i.poolTime=0,i}i(n,t);var L=n.prototype;return L.onInit=function(){var t=this,i=this.findChild("root/title/btnRule");this.addComponentCallbackListener(i,o.EventType.CLICK,(function(){g.showBoxTip({tip:GetLanguage(104427),btnCnt:1,horizontalAlign:s.uiMirror?r.RIGHT:r.LEFT})})),this.txtOne=this.findChildComponent("root/btnOne/num",a),this.txtTen=this.findChildComponent("root/btnTen/num",a),this.btnOne=this.findChild("root/btnOne"),this.addComponentCallbackListener(this.btnOne,o.EventType.CLICK,(function(){IS(S).getGoodsCountByGoodsGtid(k[0])<1?uiMgr.openView("ItemGetWayView",k[0]):IS(v).reqShipDrawCard(1,1)})),this.btnTen=this.findChild("root/btnTen"),this.addComponentCallbackListener(this.btnTen,o.EventType.CLICK,(function(){IS(S).getGoodsCountByGoodsGtid(k[0])<10?uiMgr.openView("ItemGetWayView",k[0]):IS(v).reqShipDrawCard(2,1)})),this.togSkip=this.findChildComponent("root/toggleSkip",d),this.addComponentCallbackListener(this.togSkip.node,d.EventType.TOGGLE,(function(){t.togSkip.isChecked?c.set("SkipSeasonFindAnim",1):c.set("SkipSeasonFindAnim",2)})),this.skipAnim=this.findChild("skipAnim"),this.addComponentCallbackListener(this.skipAnim,o.EventType.CLICK,(function(){t.SkipAnim()}));var e=this.findChild("root/btnShow/btnShow");this.addComponentCallbackListener(e,o.EventType.CLICK,(function(){uiMgr.openView("SeasonTreasureTipsView")})),this.txtCount=this.findChildComponent("root/nodeTip/Label",a),this.eff=this.findChildComponent("root/eff",C),this.initResShow(),s.uiMirror&&this.loadIcon(this.findChildComponent("root/toggleSkip/Checkmark",h),"season_treasure","zqkh_ui_gouxuan01")},L.initResShow=function(){var t=this;this.nodeResParent=this.findChild("root/resRoot"),this.nodeResItem=this.findChild("root/resRoot/resItem"),this.nodeResItem.active=!1,this.resItems=new Array;for(var i=function(i){var e=nodeInstantiate.instantiate(t.nodeResItem),n=k[i];t.addComponentCallbackListener(e,o.EventType.CLICK,(function(){IS(S).OpenItemTips(n,l.findChild(e,"imgIcon"))})),e.parent=t.nodeResParent,e.active=!0;var s=l.findChildComponent(e,"imgIcon",h),r=configGoods.getDataByKey(n);t.loadIcon(s,"icon_item",r.icon),t.resItems.push({node:e,txtNum:l.findChildComponent(e,"txtNum",f),goodsGtid:n})},e=0;e<k.length;e++)i(e)},L.registerUpdateHandler=function(){this.addEvent(m.GOODS_INFO_UPDATE,this.updateResShow,this),this.addEvent(T.TYPE_TREASURE_DRAW_INFO_UPDATE,this.updateResShow,this),this.addEvent(T.TYPE_TREASURE_DRAW_RESULT,this.updateResult,this)},L.updateResShow=function(){for(var t,i=0;i<this.resItems.length;i++)this.resItems[i].txtNum.string=p.GetNumString(IS(S).getGoodsCountByGoodsGtid(k[i]));this.txtCount.string=(s.uiMirror?p:u).formatStr(GetLanguage(204588),null!=(t=IS(w).drawCount)?t:100);var e=configGoods.getDataByKey(k[0]),n=l.findChildComponent(this.btnOne,"icon",h);this.loadIcon(n,"icon_item",e.icon);var o=l.findChildComponent(this.btnTen,"icon",h);this.loadIcon(o,"icon_item",e.icon);var r,a,d=IS(S).getGoodsCountByGoodsGtid(k[0]);d>=1?(l.findChild(this.btnOne,"rp").active=!0,a="#5aff42",r="#27720d"):(l.findChild(this.btnOne,"rp").active=!1,a="#ff1f1f",r="#891000"),this.txtOne.string=u.formatStr("<b><outline color=%s width=2><color=%s>%s<color></outline></b>",r,a,1),d>=10?(l.findChild(this.btnTen,"rp").active=!0,a="#5aff42",r="#27720d"):(l.findChild(this.btnTen,"rp").active=!1,a="#ff1f1f",r="#891000"),this.txtTen.string=u.formatStr("<b><outline color=%s width=2><color=%s>%s<color></outline></b>",r,a,10),IS(w).checkTreasureFindRP(),IS(w).checkTreasureListRP()},L.updateResult=function(t){var i=this;if(this.rewardList=t.reward_list,this.txtCount.string=(s.uiMirror?p:u).formatStr(GetLanguage(204588),IS(w).drawCount),this.togSkip.isChecked)uiMgr.openView("GoodsGetView",this.rewardList),this.rewardList=[],this.eff.node.active=!1;else{this.skipAnim.active=!0;for(var n,o=0,r=e(this.rewardList);!(n=r()).done;){var a=n.value,d=configGoods.getDataByKey(a.gtid).quality;o=Math.max(o,d)}this.eff.node.active=!0,this.eff.setAnimation(0,I[o].eff,!1),this.showTimer&&this.removeTimer(this.showTimer),this.showTimer=this.addTimer(4.5,1,(function(){i.eff.node.active=!1,i.skipAnim.active=!1,uiMgr.openView("GoodsGetView",i.rewardList),i.rewardList=[]}))}},L.SkipAnim=function(){this.txtCount.string=(s.uiMirror?p:u).formatStr(GetLanguage(204588),IS(w).drawCount),this.skipAnim.active=!1,this.eff.node.active=!1,this.showTimer&&this.removeTimer(this.showTimer),uiMgr.openView("GoodsGetView",this.rewardList),this.rewardList=[]},L.onAfterOpen=function(){IS(v).reqShipDrawCardInfo(1),this.togSkip.isChecked=1==c.get("SkipSeasonFindAnim"),this.eff.node.active=!1,this.skipAnim.active=!1,this.updateResShow(),this.rewardList.length>0&&uiMgr.openView("GoodsGetView",this.rewardList)},L.onBeforeClose=function(){},L.onDestroy=function(){},n}(L));n._RF.pop()}}}));

