System.register("chunks:///_virtual/Launch.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameLoadingView.ts","./GlobalDefine.ts","./MainGame.ts","./AudioMgr.ts","./UpdateBindMgr.ts","./init2.ts","./PlatformUtil.ts","./init3.ts","./GameSetting.ts","./MessageView.ts","./HttpClient.ts","./env","./ConfigMgr.ts","./StringUtil.ts","./MulLanguageUtil.ts","./DeviceConfig.ts","./LowModeView.ts","./LoginDefine.ts","./NativeToJs.ts"],(function(e,n){"use strict";var t,o,i,r,a,s,c,l,u,f,d,g,h,m,p,_,S,E,v,w,G,L,D,I,M,b,R,A,T,V,x,N,B,O,P,k,y,C,U;return{setters:[function(e){t=e.inheritsLoose,o=e.regeneratorRuntime,i=e.asyncToGenerator},function(e){r=e.cclegacy,a=e._decorator,s=e.screen,c=e.director,l=e.Node,u=e.isValid,f=e.assetManager,d=e.game,g=e.Game,h=e.Director,m=e.sys,p=e.Prefab,_=e.instantiate,S=e.find,E=e.JsonAsset,v=e.Component},function(e){w=e.GameLoadingView},function(e){G=e._GlobalDefine},function(e){L=e.GameState},function(e){D=e.audioMgr},function(e){I=e.updateBindMgr},function(e){M=e.initLoad},function(e){b=e.PlatformUtil},function(e){R=e.poolInit},function(e){A=e.default},function(e){T=e.default},function(e){V=e.HttpClient},function(e){x=e.HTML5},function(e){N=e.ConfigMgr},function(e){B=e.default},function(e){O=e.default},function(e){P=e.DeviceConfig,k=e.DeviceLevel},function(e){y=e.default},function(e){C=e.LoginEventDefine},function(e){U=e.NativeToJs}],execute:function(){var H;r._RF.push({},"6f777NPgf5HrqZvhIlUp1/f","Launch",void 0);var F=a.ccclass;a.property,e("Launch",F("Launch")(H=function(e){function r(){for(var n,t=arguments.length,o=new Array(t),i=0;i<t;i++)o[i]=arguments[i];return(n=e.call.apply(e,[this].concat(o))||this)._startTime=0,n._times=[],n._clickEffect=void 0,n}t(r,e);var a=r.prototype;return a.onLoad=function(){var e=this;_G("GlobalDefine",G),""!=w.instance.AppVerion&&(GlobalDefine.VERSION=w.instance.AppVerion),O.SetCurLanguage(w.instance.curlaguage),U.selectLanguage(O.GetGurLanuage()),s.windowSize.height/s.windowSize.width<1.7&&(G.IPAD=!0),0==GlobalDefine.SERVER_LIST_TYPE&&(GlobalDefine.CONFIG_READ_MODE=2),w.instance.show(),GlobalDefine.FULL_VERSION=GlobalDefine.VERSION+"."+String(GlobalDefine.SMALLVERSION),w.instance.SetVersion(GlobalDefine.VERSION+"."+String(GlobalDefine.SMALLVERSION)),M(),U.RequestIpQury(),this.startLoad();var n=0;c.on("director_input_event",(function(t,o){if(2==t&&o.type==l.EventType.TOUCH_END&&u(e._clickEffect)){var i=o.getTouches()[0].getUILocation();e._clickEffect.setWorldPosition(i.x,i.y,0),e._clickEffect.active=!0,n>0&&normalTimer.stop(n),n=normalTimer.start(.5,1,(function(){e._clickEffect.active=!1}))}}))},a._changeRootPath=function(){if(console.error("GlobalDefine.PUBLISH_PATH:"+w.instance.isPublic),"public"!=w.instance.isPublic){var e=f.downloader.remoteServerAddress;e=e.replace("public",w.instance.isPublic),f.downloader._remoteServerAddress=e,console.error("当前资源路径更改为 "+f.downloader.remoteServerAddress)}},a.updateBunderVersion=function(){var e=this,n=f.downloader.remoteServerAddress+"remote/bunderversion.txt",t=B.getRootDomain(n);n=n.replace(t,t+"/cdnconfig_{0}"),U.logNative("fy=====11111====="+n),V.requestUrl(n,!0,(function(n){if(U.logNative("fy====2222======"+n),n){for(var t=JSON.parse(n),o=0;o<t.list.length;o++){var i;null==(i=f.downloader)||i.SetBundlerVersion(t.list[o].key,t.list[o].version)}e.startLoad()}}))},a.startLoad=function(){this.loadBund(),b.checkIsIphoneX(),b.checkGameUpdate(),d.on(g.EVENT_HIDE,this.onGameHide,this),d.on(g.EVENT_SHOW,this.onGameShow,this),c.on(h.EVENT_AFTER_DRAW,this.onEndDrawUpdate,this),b.setSkeepScreenOn(),b.getUserSetting(),m.os==m.OS.IOS&&(d.frameRate=45),(m.os==m.OS.IOS||x||m.os==m.OS.WINDOWS||m.os==m.OS.OSX)&&(P.currenDeviceLevel=k.High),P.setDownloaderQuality(P.currenDeviceLevel)},a.launchInit=o().mark((function e(){var n,t,i=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:0!=GlobalDefine.SERVER_LIST_TYPE&&(cc._throw=function(e){printLogException(e,"cc-exception")}),w.instance.setStateTxt(w.instance.GetInitLanauage(3)),(n=IS(N)).loadConfig();case 4:if(n.isLoad){e.next=9;break}return e.next=7,coroutine.wait(.1);case 7:e.next=4;break;case 9:return console.log("初始化完毕"),m.garbageCollect(),console.log("基础加载路径:"+resourceMgr.getBasePath()),"9.0.2"!=(t=w.instance.AppVerion)&&"9.0.3"!=t||(GlobalDefine.ENABLE_SDK=0),1==GlobalDefine.ENABLE_SDK?sdkControl.initSdk():console.log("跳过sdk初始化"),void(e.next=17);case 17:return resourceMgr.loadRes("prefab/ui-effect/MX_tx_dianji",p,(function(e){if(null!=e.item&&null!=e.item.asset){var n=_(e.item.asset);n.parent=S("UIRoot/ReconnectView"),n.active=!1,i._clickEffect=n}})),w.instance.setStateTxt(w.instance.GetInitLanauage(4)),resourceMgr.loadFirstLoadRes("config/proto",E,(function(e){if(!e.error&&null!=e.item&&null!=e.item.asset){var n=e.item.asset;netManager.setProtoJson(n.json)}})),resourceMgr.loadRes("ui/module/main/MainView",p,(function(){})),e.next=23,coroutine.wait(.1);case 23:return resourceMgr.loadRes("ui/module/common/ReconnectView",p,(function(){})),e.next=26,coroutine.wait(.1);case 26:return IS(T),e.next=29,coroutine.wait(.1);case 29:return IS(y),e.next=32,coroutine.wait(.1);case 32:1==GlobalDefine.ENABLE_SDK?(w.instance.setStateTxt(w.instance.GetInitLanauage(5)),"xmh5"!=GlobalDefine.PLAT_TAG||null!=m.localStorage.getItem("ShowProtol")&&""!=m.localStorage.getItem("ShowProtol")?(console.log("请求服务器"),loginControl.CheckLoginArea()):uiMgr.openView("ProtocolView")):uiMgr.openView("LoginView"),uiMgr.checkView="GMView";case 34:case"end":return e.stop()}}),e)})),a._changeremotePath=function(){if("none"!=GlobalDefine.REMOTE_PATH&&"none"!=GlobalDefine.REMOTE_BAK_PATH){var e=f.downloader.remoteServerAddress;GlobalDefine.USE_BACKCDN=!0,e=e.replace(GlobalDefine.REMOTE_PATH,GlobalDefine.REMOTE_BAK_PATH),f.downloader._remoteServerAddress=e,console.error("服务器地址切换为 "+f.downloader.remoteServerAddress)}},a._loadBundle1=function(e,n,t){var o=this;f.loadBundle(e,(function(i,r){if(i||null==r)return t++,console.error("errornum "+t),1==t&&(console.error("尝试使用备用CDN"),o._changeremotePath()),t>=3?(printLogErr("[",o.name,"]加载bundle失败"),void w.instance.showExitGameNotice(w.instance.GetInitLanauage(16))):void o._loadBundle1(e,n,t++);n(r)}))},a._loadBundle=function(){var e=i(o().mark((function e(n){var t=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,o){t._loadBundle1(n,(function(n){e(n)}),0)})));case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),a.LoadRemoteConfig=function(){var e=resourceMgr.getBasePath()+"binverion.txt";console.log(e),f.loadRemote(e,{ext:".txt"},(function(e,n){e?console.log(e):console.log(n.text)}))},a.loadBund=function(){var e=i(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(2!=GlobalDefine.CONFIG_READ_MODE){e.next=3;break}return e.next=3,this._loadBundle("bundle-config-json");case 3:return e.next=5,this._loadBundle("bundle-firstload-res");case 5:return e.next=7,this._loadBundle("bundle-res");case 7:return e.next=9,n.import("./RegisterModule.ts");case 9:for(t in ISInclude)try{IS(ISInclude[t])}catch(e){printLogErr(t," 循环引用异常！！！")}return R(),D.init(),IS(A).InitSetting(),D.playMusic("loadbackground"),e.next=16,uiMgr.InitUIFont();case 16:coroutine.start(this.launchInit()),c.on(h.EVENT_BEGIN_FRAME,this.onBeginFrame,this),c.on(h.EVENT_END_FRAME,this.onEndFrame,this);case 19:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),a.update=function(e){I.update(e),T.update(e)},a.onBeginFrame=function(){mainGame.state==L.Runing&&(this._startTime=m.now())},a.onEndFrame=function(){if(mainGame.state==L.Runing){this._times.push(m.now()-this._startTime),this._times.length>10&&this._times.splice(0,1);var e=0;this._times.forEach((function(n){e+=n})),mainGame.fps=Math.floor(Math.min(1e3/(e/this._times.length),60))}},a.onEndDrawUpdate=function(){I.lateUpdate(d.deltaTime)},a.onGameHide=function(){printLogErr("游戏切后台！"),D.pauseMusic()},a.onGameShow=function(){printLogErr("后台切回游戏！"),b.setSkeepScreenOn(),D.restoreMusic(),b.ByteDanceOnShow(),normalEvent.emit(C.GAME_BACK_SHOW)},r}(v))||H);r._RF.pop()}}}));

