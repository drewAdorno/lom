System.register("chunks:///_virtual/CircleOfFriendsAttentionSubView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./index57.ts","./ConfigGlobal.ts","./RoleDataCache.ts","./CircleOfFriendsControl.ts","./CircleOfFriendsDataCache.ts","./CircleOfFriendsDefine.ts","./BaseSubView.ts"],(function(e){"use strict";var t,i,n,o,a,s,d,r,l,h,c,p,f,g,C,v,u;return{setters:[function(e){t=e.inheritsLoose},function(e){i=e.cclegacy,n=e.Button,o=e.Label,a=e.ScrollView,s=e.Node,d=e.Sprite},function(e){r=e.ListItem},function(e){l=e.default},function(e){h=e.default},null,function(e){c=e.ConfigGlobal},function(e){p=e.RoleDataCache},function(e){f=e.default},function(e){g=e.CircleOfFriendsDataCache},function(e){C=e.CircleOfFriendsEvent,v=e.CircleOfFriendsDefine},function(e){u=e.BaseSubView}],execute:function(){i._RF.push({},"c9ff1uSyBFHF5wh1UlG8nVI","CircleOfFriendsAttentionSubView",void 0);e("default",function(e){function i(){var t;return(t=e.call(this)||this).ScrollView=void 0,t.target_id=void 0,t.empty=void 0,t.title=void 0,t.titleName=void 0,t.openType=0,t.target_name="",t.isSendToServer=void 0,t.page=void 0,t.isTopRefresh=!1,t.name="CircleOfFriendsMainSubView",t.fullScreen=!1,t}t(i,e);var d=i.prototype;return d.registerUpdateHandler=function(){this.addEvent(C.UpdateAttentionInfo,this.RefreshContent,this),this.addEvent(C.UpdateFansInfo,this.RefreshContent,this),this.addEvent(C.UpdateBlockInfo,this.RefreshContent,this)},d.onInit=function(){var e=this;this.InitScroll(),this.addComponentCallbackListener(this.findChild("bottom/btnClose"),n.EventType.CLICK,(function(){1==e.openType?IS(g).ClearAttentionInfo():2==e.openType?IS(g).ClearFansInfo():IS(g).ClearBlockInfo(),normalEvent.emit(C.CloseChildView,v.ViewType.AttentionPanel)})),this.title=this.findChildComponent("title/Label",o),this.titleName=this.findChildComponent("titleAttention/name",o),this.empty=this.findChild("empty")},d.InitScroll=function(){var e=this,t=this.findChildComponent("ScrollView",a);this.ScrollView=this.addUIList(t,S),this.ScrollView.lackSlide=!0,this.addComponentCallbackListener(t.node,a.EventType.SCROLL_TO_BOTTOM,(function(){if(!e.isSendToServer)if(1==e.openType){var t=IS(g).GetAttentionInfo();if(t.isMaxPage||!t)return;e.page=t.page+1,e.isSendToServer=!0,IS(f).sendToGetSubscrib(e.target_id,e.page,v.PageSize)}else if(2==e.openType){var i=IS(g).GetFansInfo();if(i.isMaxPage)return;e.page=i.page+1,e.isSendToServer=!0,IS(f).sendToGetFan(e.target_id,e.page,v.PageSize)}else{e.page=1;var n=IS(g).GeBlockInfo();if(!n||n.isMaxPage)return;e.page=n.page+1,e.isSendToServer=!0,IS(f).sendToGetBlock(e.page,v.PageSize)}})),this.addComponentCallbackListener(t.node,a.EventType.BOUNCE_TOP,(function(){1!=e.openType&&e.isTopRefresh&&(e.isTopRefresh=!1,1==e.openType?(e.page=1,IS(f).sendToGetSubscrib(e.target_id,e.page,v.PageSize)):2==e.openType?(e.page=1,IS(f).sendToGetFan(e.target_id,e.page,v.PageSize)):(e.page=1,IS(f).sendToGetBlock(e.page,v.PageSize)))}));var i=this.findChild("ScrollView/view/content");this.addComponentCallbackListener(i,s.EventType.TRANSFORM_CHANGED,(function(t){1!=e.openType&&t&s.TransformBit.POSITION&&i.position.y<v.ContentRefeshPos&&(e.isTopRefresh=!0)}))},d.RefreshContent=function(){var e=[];e=1==this.openType?IS(g).GetAttentionData():2==this.openType?IS(g).GetFansData():IS(g).GetBlockData(),this.ScrollView.datas=e,this.empty.active=0==e.length,this.isSendToServer=!1},d.onAfterOpen=function(){var e,t,i;this.openType=null!=(e=this.openArgs[0])?e:this.openType,this.target_id=null!=(t=this.openArgs[1])?t:this.target_id,this.target_name=null!=(i=this.openArgs[2])?i:this.target_name,1==this.openType?this.title.string=GetLanguage(300125):2==this.openType?this.title.string=GetLanguage(300126):this.title.string=GetLanguage(999300167),this.titleName.string=h.formatStr(GetLanguage(300132),this.target_name,this.title.string),this.openArgs[0]&&(this.ScrollView.scrollView.scrollToTop(),this.page=1,1==this.openType?(IS(g).ClearFansInfo(),IS(f).sendToGetSubscrib(this.target_id,1,v.PageSize)):2==this.openType?(IS(g).ClearAttentionInfo(),IS(f).sendToGetFan(this.target_id,1,v.PageSize)):(IS(g).ClearBlockInfo(),IS(f).sendToGetBlock(1,v.PageSize))),this.RefreshContent()},d.onBeforeClose=function(){},d.onDestroy=function(){},i}(u));var S=function(e){function i(){for(var t,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(t=e.call.apply(e,[this].concat(n))||this).gmIcon=void 0,t.name=void 0,t.headImg=void 0,t.imgHeadFrame=void 0,t.attentionNode=void 0,t.attentionCancel=void 0,t.attentionAdd=void 0,t.blockNode=void 0,t.blockBtnName=void 0,t}t(i,e);var a=i.prototype;return a.onInit=function(){var e=this;this.view.addComponentCallbackListener(l.findChild(this.node,"playerInfo/head"),n.EventType.CLICK,(function(){normalEvent.emit(C.OpenChildView,v.ViewType.OtherPanel,[e.data.target_id])})),this.name=l.findChildComponent(this.node,"playerInfo/name",o),this.gmIcon=l.findChild(this.node,"playerInfo/head/gmIcon"),this.headImg=l.findChildComponent(this.node,"playerInfo/head/image",d),this.imgHeadFrame=l.findChildComponent(this.node,"playerInfo/head/imgHeadFrame",d),this.attentionCancel=l.findChild(this.node,"attention/cancelBtn"),this.attentionAdd=l.findChild(this.node,"attention/addBtn"),this.view.addComponentCallbackListener(this.attentionCancel,n.EventType.CLICK,(function(){IS(f).sendToSubscrib(e.data.target_id,0)})),this.view.addComponentCallbackListener(this.attentionAdd,n.EventType.CLICK,(function(){IS(f).sendToSubscrib(e.data.target_id,1)})),this.view.addComponentCallbackListener(l.findChild(this.node,"block/btnBlock"),n.EventType.CLICK,(function(){var t=e.data.is_block&&2==e.data.is_block?1:2;IS(f).sendToBlock(e.data.target_id,t)})),this.attentionNode=l.findChild(this.node,"attention"),this.blockNode=l.findChild(this.node,"block"),this.blockBtnName=l.findChildComponent(this.node,"block/btnBlock/Label",o)},a.onRender=function(e,t){0==e.role_id?(this.name.string=GetLanguage(c.circle_official_name_id),this.gmIcon.active=!0,this.headImg.node.active=!1):(this.name.string=h.GetServNameById(e.server_id)+e.name,this.gmIcon.active=!1,this.view.loadRemoteIcon(e.head_url,this.headImg));var i=e.head.frame_id;if(i>0){this.imgHeadFrame.node.active=!0;var n=configAvatar_frame.getDataByKey(i);this.view.loadIcon(this.imgHeadFrame,"icon_frame",n.icon)}else this.imgHeadFrame.node.active=!1;1==this.view.openType||2==this.view.openType?(this.attentionNode.active=!0,this.blockNode.active=!1,e.target_id!=IS(p).GetRoleId()?1==e.state||3==e.state?(this.attentionCancel.active=!0,this.attentionAdd.active=!1):(this.attentionAdd.active=!0,this.attentionCancel.active=!1):(this.attentionAdd.active=!1,this.attentionCancel.active=!1)):(this.attentionNode.active=!1,this.blockNode.active=!0,this.blockBtnName.string=e.is_block&&2==e.is_block?GetLanguage(999300165):GetLanguage(999300166))},i}(r);i._RF.pop()}}}));

