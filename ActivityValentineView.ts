System.register("chunks:///_virtual/ActivityValentineView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./RedPoint.ts","./RedPointMgr.ts","./StorageUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./BattlePassControl.ts","./BattlePassDefine.ts","./MessageView.ts","./RoleDataCache.ts","./RoleDefine.ts","./ActivityControl.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./ActivityValentineDataCache.ts","./ActivityValentineDefine.ts","./BaseView.ts"],(function(t){"use strict";var e,i,n,a,s,o,d,l,r,c,h,u,v,f,p,C,m,g,y,T,w,V,I,S,b;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,n=t.Button,a=t.Vec2,s=t.Label,o=t.js},function(t){d=t.RedPointType},function(t){l=t.RedPointMgr},function(t){r=t.default},function(t){c=t.default},function(t){h=t.default},null,function(t){u=t.default},function(t){v=t.BattlePassDefine},function(t){f=t.default},function(t){p=t.RoleDataCache},function(t){C=t.RoleEventDefine,m=t.RoleRedPointSystemEnum},function(t){g=t.default},function(t){y=t.default},function(t){T=t.ActivityType,w=t.ActivityState,V=t.ActivityEventDefine},function(t){I=t.ActivityValentineDataCache},function(t){S=t.ActivityValentineEvent},function(t){b=t.BaseView}],execute:function(){i._RF.push({},"feb03fP8jpA+6DbkIqMa8qP","ActivityValentineView",void 0);t("default",function(t){function i(){var e;return(e=t.call(this)||this).btnInvite=void 0,e.btnSelect=void 0,e.txtLeftTime=void 0,e.txtPassValue=void 0,e.deltaTime=0,e.leftTime=0,e.btnTask=void 0,e.timer=void 0,e.name="ActivityValentineView",e.url="ui/module/valentine/ActivityValentineView",e.fullScreen=!0,e}e(i,t);var b=i.prototype;return b.onInit=function(){var t=this,e=this.findChild("view/btnClose");this.addComponentCallbackListener(e,n.EventType.CLICK,(function(){t.close()}));var i=this.findChild("view/btnPass");this.addRedPoint("qixi_pass",i,new a(290,20),d.Dot),this.addComponentCallbackListener(i,n.EventType.CLICK,(function(){var t=IS(y).GetActivityInfo(T.QiXiTask);t&&t.state==w.Open?uiMgr.openView("ActivityValentinePassView"):t&&t.state==w.Preview?f.showFlyTip(GetLanguage(200086)):f.showFlyTip(GetLanguage(200026))}));var o=this.findChild("view/btnGift");this.addRedPoint("qixi_gift",o,new a(290,20),d.Dot,1),this.addComponentCallbackListener(o,n.EventType.CLICK,(function(){var t=IS(y).GetActivityInfo(T.Qixi);t&&t.state==w.Open?uiMgr.openView("ActivityValentineOptionalGiftView"):t&&t.state==w.Preview?f.showFlyTip(GetLanguage(200086)):f.showFlyTip(GetLanguage(200026))})),this.btnTask=this.findChild("view/btnTask"),this.addRedPoint("qixi_task",this.btnTask,new a(125,20),d.Dot,1),this.addComponentCallbackListener(this.btnTask,n.EventType.CLICK,(function(){var t=IS(y).GetActivityInfo(T.QiXiTask);t&&t.state==w.Open?uiMgr.openView("ActivityValentineTaskView",T.QiXiTask):t&&t.state==w.Preview?f.showFlyTip(GetLanguage(200086)):f.showFlyTip(GetLanguage(200026))}));var l=this.findChild("view/btnTurn");this.addRedPoint("valentine_turn",l,new a(70,50),d.Dot),this.addComponentCallbackListener(l,n.EventType.CLICK,(function(){var t=IS(y).GetActivityInfo(T.ValentineTurn);if(t&&t.state==w.Open)uiMgr.openView("ActivityValentineTurnView");else if(t&&t.state==w.Preview){var e=t.state_time[w.Open].start_time-h.serverTime;f.showFlyTip(c.formatStrWithMirrorDeal(GetLanguage(201410),h.formatTimeStringForSecond(e)))}else f.showFlyTip(GetLanguage(200026))}));var r=this.findChild("view/btnRank_1");this.addComponentCallbackListener(r,n.EventType.CLICK,(function(){uiMgr.openView("ActivityValentinePassRankView",T.ValentinePassRank)}));var u=this.findChild("view/btnRank_2");this.addComponentCallbackListener(u,n.EventType.CLICK,(function(){uiMgr.openView("ActivityValentineRankView",T.QiXiSendFlowerRank)}));var v=this.findChild("view/btns/btnSend");this.addRedPoint("qixi_record/tab2",v,new a(40,43),d.Dot),this.addRedPoint("qixi_record/tab3",v,new a(40,43),d.Dot),this.addComponentCallbackListener(v,n.EventType.CLICK,(function(){uiMgr.openView("ActivityValentineSendView")}));var p=this.findChild("view/btns/btnPay");this.addComponentCallbackListener(p,n.EventType.CLICK,(function(){uiMgr.openView("ActivityValentinePayView",T.QiXiSign)})),this.btnInvite=this.findChild("view/btns/btnInvite"),this.addComponentCallbackListener(this.btnInvite,n.EventType.CLICK,(function(){uiMgr.openView("ActivityValentineInviteView")})),this.btnSelect=this.findChild("view/btns/btnSelect"),this.addRedPoint("qixi_select",this.btnSelect,new a(40,43),d.Dot),this.addComponentCallbackListener(this.btnSelect,n.EventType.CLICK,(function(){uiMgr.openView("ActivityValentineSelectView")}));var C=this.findChild("view/btnStore");this.addRedPoint("valentine_store",C,new a(25,30),d.Dot),this.addComponentCallbackListener(C,n.EventType.CLICK,(function(){uiMgr.openView("ActivityValentineStoreView",T.Qixi)})),this.txtLeftTime=this.findChildComponent("view/nodeTime/txtTime",s),this.txtPassValue=this.findChildComponent("view/myScore/Label",s)},b.registerUpdateHandler=function(){this.addEvent(V.OnActivityInfoTaskUpdate,this.updateRed,this),this.addEvent(V.OnActivityInfoUpdate,this.updateRed,this),this.addEvent(C.ROLE_RED_DETAIL_UPDATE,this.updateRed,this),this.addEvent(S.OnActivityValentinePassInfo,this.updatePassInfo,this),this.addEvent(v.BATTLE_PASS_INFO_UPDATE,this.updateRed,this),this.addEvent(V.OnActivityQixiAskList,this.updateRed,this)},b.onAfterOpen=function(){var t,e=this;IS(u).send_40_1(19),IS(g).send_24_24(),IS(g).send_24_27(),this.updateRed(),this.btnInvite.active=!1,this.btnSelect.active=!1,this.txtPassValue.string=GetLanguage(204381)+(null!=(t=IS(I).getPassInfo().my_value)?t:0);var i=IS(y).GetActivityInfo(T.Qixi);if(i){var n,a=null!=(n=i.state_time[i.state])?n:i.state_time[w.Open];this.leftTime=a.end_time-h.serverTime,this.timer&&(this.removeTimer(this.timer),this.timer=null),this.leftTime>0?(this.txtLeftTime.string=o.formatStr("%s",h.formatTimeStringForSecond(this.leftTime)),this.timer=this.addTimer(1,this.leftTime,(function(){var t=a.end_time-h.serverTime;e.txtLeftTime.string=t>0?o.formatStr("%s",h.formatTimeStringForSecond(t)):GetLanguage(200026)}))):this.txtLeftTime.string=GetLanguage(200026)}},b.updateRed=function(){var t,e=IS(y).GetActivityInfo(T.Qixi);e&&e.state==w.Open?(this.findChild("view/btns").active=!0,IS(l).changeValue("qixi_pass",IS(I).getPassRedNum()+(IS(I).addRed&&0==IS(I).getPartnerId()?1:0))):(this.findChild("view/btns").active=!1,IS(l).changeValue("qixi_pass",0)),IS(l).changeValue("qixi_task",IS(y).GetTaskRedNum(T.QiXiTask)),IS(l).changeValue("qixi_record/tab2",IS(p).getRedNumByModule(m.Qixi_Record,1)),IS(l).changeValue("qixi_record/tab3",IS(p).getRedNumByModule(m.Qixi_Record,2)),IS(l).changeValue("qixi_gift",IS(I).GetOptionGiftRed());var i=null!=(t=r.get("ValentineAskListTime"))?t:0;IS(l).changeValue("qixi_select",i<IS(I).lastAskTime?1:0)},b.updatePassInfo=function(){this.txtPassValue.string=GetLanguage(204381)+IS(I).getPassInfo().my_value},b.onBeforeClose=function(){this.removeTimer(this.timer),this.timer=null},b.onUpdate=function(t){},b.onDestroy=function(){},i}(b));i._RF.pop()}}}));

