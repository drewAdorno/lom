System.register("chunks:///_virtual/EquipFigureView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./V2.ts","./UIList.ts","./NodeUtil.ts","./BaseView.ts","./ItemIcon.ts","./EquipControl.ts","./EquipDefine.ts","./EquipModel.ts","./RoleDataCache.ts","./RoleDefine.ts","./EquipDataCache.ts"],(function(i){"use strict";var t,e,o,n,c,s,u,h,d,a,r,l,p,g,C,m,S,v,f,q;return{setters:[function(i){t=i.inheritsLoose},function(i){e=i.cclegacy,o=i.math,n=i.Button,c=i.ScrollView,s=i.Label,u=i.Sprite,h=i.sys},function(i){d=i.V2},function(i){a=i.SelectedType,r=i.ListItem},function(i){l=i.default},function(i){p=i.BaseView},function(i){g=i.IconAseetType},function(i){C=i.default},function(i){m=i.EquipEventDefine},function(i){S=i.EquipModel},function(i){v=i.RoleDataCache},function(i){f=i.PlayerAttr},function(i){q=i.EquipDataCache}],execute:function(){var I;e._RF.push({},"c4ae6iyybBPKKfpMC1f1IHH","EquipFigureView",void 0);o.Vec3,o.Vec2;var L=((I={})[1]="zjm_ui_wuqi",I[2]="zjm_ui_goushi",I[3]="zjm_ui_mianshi",I),E=(i("default",function(i){function e(){var t;return(t=i.call(this)||this).scrollEquipList=void 0,t.nodeModelRoot=void 0,t.txtSelectName=void 0,t.imgSelectFrame=void 0,t.imgSelectIcon=void 0,t.nodeNotSelect=void 0,t.nodeHasFigureDesc=void 0,t.nodeLockDesc=void 0,t.nodebtnChange=void 0,t.curLocation=void 0,t.curSelectFigure=void 0,t.modelRole=void 0,t.equipCidList=void 0,t.name="EquipFigureView",t.url="ui/module/equip/EquipFigureView",t}t(e,i);var o=e.prototype;return o.onInit=function(){var i=this,t=this.findChild("imgMask");this.addComponentCallbackListener(t,n.EventType.CLICK,(function(){i.onMaskClick()}));var e=this.findChild("content/btnClose");this.addComponentCallbackListener(e,n.EventType.CLICK,(function(){i.onCloseClick()}));var o=this.findChildComponent("content/scrollEquipList",c);this.scrollEquipList=this.addUIList(o,E,!0,0,0),this.scrollEquipList.selectedMode=a.SINGLE,this.txtSelectName=this.findChildComponent("content/top/selected/txtName",s),this.imgSelectFrame=this.findChildComponent("content/top/selected/imgFrame",u),this.imgSelectIcon=this.findChildComponent("content/top/selected/imgIcon",u),this.nodeNotSelect=this.findChild("content/top/selected/imgNo"),this.nodeHasFigureDesc=this.findChild("content/top/selected/txtCur"),this.nodeLockDesc=this.findChild("content/top/selected/txtLock"),this.nodebtnChange=this.findChild("content/top/selected/btnChange"),this.addComponentCallbackListener(this.nodebtnChange,n.EventType.CLICK,(function(){i.onChangeClick()})),this.nodeModelRoot=this.findChild("content/top/modelRoot")},o.registerUpdateHandler=function(){this.addEvent(m.EQUIP_FIGURE_UPDATE,this.onEquipFigureUpdate,this)},o.onAfterOpen=function(){this.curLocation=this.openArgs[0],this.curSelectFigure=IS(S).getEquipFigureByLocation(this.curLocation),this.updateSelectShow(),this.showEquipList(),this.updateModelEquipShow()},o.updateModelEquipShow=function(){null!=this.modelRole&&(this.removeUnitModel(this.modelRole),this.modelRole=null);var i=this.getShowEquipByLocation(1),t=this.getShowEquipByLocation(2),e=this.getShowEquipByLocation(3),o=IS(v).GetTypeUsedSkin(1);this.modelRole=this.addUnitModel({job:IS(v).GetTypeUsedSkin(0),dressId:IS(v).GetTypeUsedSkin(2)||0,gender:IS(v).GetRoleAttr(f.ROLE_ATTR_GENDER),weapon:i,ornaments:t,face:e,color:o,parent:this.nodeModelRoot,shenqi:0},new d(0,-80),1.2),h.uiMirror&&(this.getUnitModel(this.modelRole).dir=-1)},o.getShowEquipByLocation=function(i){return this.curLocation!=i?IS(S).getShowEquipCfgIdByLocation(i):-1==this.curSelectFigure?0:0!=this.curSelectFigure?this.curSelectFigure:IS(S).getWearEquipCfgIdByLocation(i)},o.updateSelectShow=function(){var i=IS(S).getEquipFigureByLocation(this.curLocation);if(-1==this.curSelectFigure)return this.txtSelectName.string=GetLanguage(200267),this.nodeNotSelect.active=!1,this.loadIcon(this.imgSelectFrame,"icon_equip","zjm_ui_pinzhikuangwu"),this.imgSelectIcon.node.active=!0,this.loadIcon(this.imgSelectIcon,"equip",L[this.curLocation]),this.nodeLockDesc.active=!1,this.nodeHasFigureDesc.active=i==this.curSelectFigure||!1,void(this.nodebtnChange.active=i!=this.curSelectFigure||!1);if(0==this.curSelectFigure)return this.txtSelectName.string=GetLanguage(200266),this.imgSelectIcon.node.active=!1,this.nodeNotSelect.active=!0,this.nodeHasFigureDesc.active=i==this.curSelectFigure||!1,this.nodebtnChange.active=i!=this.curSelectFigure||!1,this.nodeLockDesc.active=!1,void this.loadIcon(this.imgSelectFrame,"icon_equip","zjm_ui_pinzhikuangbai");var t=configEquipment.getDataByKey(this.curSelectFigure);this.txtSelectName.string=t.name;var e=configColor.getDataByKey(t.quality);this.loadIcon(this.imgSelectFrame,"icon_equip",e.path),this.loadIcon(this.imgSelectIcon,t.atlas,t.icon,null,g.ICON_SPRITE);var o=IS(S).checkEquipGot(this.curSelectFigure);this.nodeLockDesc.active=!o,this.nodeHasFigureDesc.active=o&&i==this.curSelectFigure,this.nodebtnChange.active=o&&i!=this.curSelectFigure,this.imgSelectIcon.node.active=!0,this.nodeNotSelect.active=!1},o.showEquipList=function(){for(var i=IS(v).GetJob(),t=configJobs.getDataByKey(i).transmog_list||[],e={},o=0;o<t.length;o++)e[t[o]]=!0;var n=configEquipment.getDatas();this.equipCidList=[];var c={};for(var s in n){var u=n[s];1!=u.is_hide&&(u.part==this.curLocation&&1==e[u.job]&&(c[u.icon]?u.id<c[u.icon]&&(c[u.icon]=u.id):c[u.icon]=u.id))}for(var h in IS(q).equipCidToGot){var d=configEquipment.getDataByKey(Number(h));c[d.icon]&&(c[d.icon]=Number(h))}for(var a in c){var r=c[a],l=!0;1==configEquipment.getDataByKey(r).preview&&(l=0!=r&&IS(S).checkEquipGot(r)),l&&this.equipCidList.push(r)}this.equipCidList.sort((function(i,t){var e=IS(S).checkEquipGot(i);return e!=IS(S).checkEquipGot(t)?1==e?-1:1:i<t?-1:1})),1!=this.curLocation&&this.equipCidList.unshift(-1),this.equipCidList.unshift(0);for(var p=0;p<this.equipCidList.length&&this.curSelectFigure!=this.equipCidList[p];p++);this.scrollEquipList.datas=this.equipCidList,this.scrollEquipList.scrollTo(1)},o.onBeforeClose=function(){},o.onDestroy=function(){},o.onEquipFigureUpdate=function(i){i==this.curLocation&&(this.updateModelEquipShow(),this.curSelectFigure=IS(S).getEquipFigureByLocation(i),this.updateSelectShow(),this.showEquipList())},o.updateSelectItem=function(i){for(var t=0;t<this.equipCidList.length;t++)i!=this.equipCidList[t]&&this.curSelectFigure!=this.equipCidList[t]||this.scrollEquipList.updateItem([t])},o.onMaskClick=function(){this.close()},o.onCloseClick=function(){this.close()},o.onChangeClick=function(){IS(C).reqEquipFigure(this.curLocation,this.curSelectFigure)},e}(p)),function(i){function e(){for(var t,e=arguments.length,o=new Array(e),n=0;n<e;n++)o[n]=arguments[n];return(t=i.call.apply(i,[this].concat(o))||this).imgFrame=void 0,t.imgIcon=void 0,t.nodeNo=void 0,t.nodeMask=void 0,t.nodeSelect=void 0,t.equipCid=void 0,t.nodeCurFigure=void 0,t.txtCondition=void 0,t}t(e,i);var o=e.prototype;return o.onInit=function(){this.imgFrame=l.findChildComponent(this.node,"imgFrame",u),this.imgIcon=l.findChildComponent(this.node,"imgIcon",u),this.nodeNo=l.findChild(this.node,"imgNo"),this.nodeMask=l.findChild(this.node,"imgMask"),this.nodeSelect=l.findChild(this.node,"imgSelected"),this.nodeCurFigure=l.findChild(this.node,"imgFigure"),this.txtCondition=l.findChildComponent(this.node,"txtCondition",s),this.nodeSelect.active=!1},o.onRender=function(i,t){this.equipCid=i,this.nodeNo.active=0==this.equipCid||!1,this.imgIcon.node.active=0!=this.equipCid||!1,this.view.loadIcon(this.imgFrame,"icon_equip","zjm_ui_pinzhikuangbai");var e=this.view;if(0!=this.equipCid)if(-1==this.equipCid)this.view.loadIcon(this.imgFrame,"icon_equip","zjm_ui_pinzhikuangwu"),this.view.loadIcon(this.imgIcon,"equip",L[e.curLocation]);else{var o=configEquipment.getDataByKey(this.equipCid),n=configColor.getDataByKey(o.quality);this.view.loadIcon(this.imgFrame,"icon_equip",n.path),this.view.loadIcon(this.imgIcon,o.atlas,o.icon,null,g.ICON_SPRITE),this.txtCondition.string=o.drop_condition}var c=0!=this.equipCid&&!IS(S).checkEquipGot(this.equipCid)||!1;-1==this.equipCid&&(c=!1),this.nodeMask.active=c,this.txtCondition.node.active=c,0==this.equipCid||-1==this.equipCid?this.nodeCurFigure.active=!1:this.nodeCurFigure.active=this.equipCid==IS(S).getEquipFigureByLocation(e.curLocation),this.nodeSelect.active=e.curSelectFigure==this.equipCid},o.onItemClick=function(){var i=this.view,t=i.curSelectFigure;i.curSelectFigure=this.equipCid,i.updateModelEquipShow(),i.updateSelectShow(),i.updateSelectItem(t)},e}(r));e._RF.pop()}}}));

