System.register("chunks:///_virtual/ActivityAutumnRiddlesView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./MessageView.ts","./ActivityControl.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./ActivityAutumnDataCache.ts","./BaseView.ts"],(function(t){"use strict";var i,e,n,s,o,d,r,a,h,l,c,u,v,f,w,m,g,I,p,C,_,b,A;return{setters:[function(t){i=t.inheritsLoose,e=t.createForOfIteratorHelperLoose},function(t){n=t.cclegacy,s=t.Button,o=t.HorizontalTextAlignment,d=t.Label,r=t.Sprite,a=t.ScrollView,h=t.js,l=t.Color},function(t){c=t.ItemGrid},function(t){u=t.ListItem},function(t){v=t.default},function(t){f=t.default},function(t){w=t.default},null,function(t){m=t.default},function(t){g=t.default},function(t){I=t.default},function(t){p=t.ActivityEventDefine,C=t.ActivityType,_=t.ActivityState},function(t){b=t.default},function(t){A=t.BaseView}],execute:function(){n._RF.push({},"7ffd8NQJqFLCaFE/1NWX+ih","ActivityAutumnRiddlesView",void 0);t("default",function(t){function n(){var i;return(i=t.call(this)||this).tabScroll=void 0,i.rewardScroll=void 0,i.itemGrid=void 0,i.itemMask=void 0,i.itemReceived=void 0,i.title1=void 0,i.title2=void 0,i.txtDesc=void 0,i.txtTips=void 0,i.txtAnswer=void 0,i.btn=void 0,i.answerItems={},i.curIndex=0,i.curAnswer=0,i.name="ActivityAutumnRiddlesView",i.url="ui/module/autumn/ActivityAutumnRiddlesView",i}i(n,t);var l=n.prototype;return l.onInit=function(){var t=this,i=this.findChild("btnClose");this.addComponentCallbackListener(i,s.EventType.CLICK,(function(){t.close()}));var e=this.findChild("view/bg/btnTips");this.addComponentCallbackListener(e,s.EventType.CLICK,(function(){m.showBoxTip({tip:GetLanguage(200743),btnCnt:1,horizontalAlign:o.LEFT})})),this.btn=this.findChild("view/bg/btn"),this.addComponentCallbackListener(this.btn,s.EventType.CLICK,(function(){var i;0!=t.curAnswer?1==(null==(i=IS(b).getRiddlesList()[t.curIndex])?void 0:i.state)&&m.showBoxTip({tip:GetLanguage(200724),func:function(i){"type_yes"==i&&IS(g).send_24_51(t.curIndex,t.curAnswer)}}):m.showFlyTip(GetLanguage(200723))})),this.txtAnswer=this.findChildComponent("view/bg/txtAnswer",d),this.title1=this.findChildComponent("view/bg/title/title/img1",r),this.title2=this.findChildComponent("view/bg/title/title/img2",r),this.txtDesc=this.findChildComponent("view/bg/desc/desc",d),this.txtTips=this.findChildComponent("view/bg/desc/tips",d),this.itemGrid=new c(this,this.findChild("view/bg/reward/itemGrid")),this.itemMask=this.findChild("view/bg/reward/mask"),this.itemReceived=this.findChild("view/bg/reward/received"),this.tabScroll=this.addUIList(this.findChildComponent("view/tabScroll",a),x),this.rewardScroll=this.addUIList(this.findChildComponent("view/bg/rewards/rewardScroll",a),y),this.rewardScroll.lackCenter=!0;for(var n=1;n<=4;n++){var h=new S;h.init(this.findChild("view/bg/answer/item"+n),this,n),this.answerItems[n]=h}},l.registerUpdateHandler=function(){this.addEvent(p.OnAutumnRiddlesUpdate,this.updateInfo,this)},l.onAfterOpen=function(){IS(g).send_24_50();for(var t,i=IS(I).GetActivityInfo(C.AutumnRiddles),n=[],s=configMoonfestival_riddle.getDatas(),o=e(s);!(t=o()).done;){var d=t.value;d.type==i.type&&d.group_id==i.roundCfg.group_id&&n.push(d)}n.sort((function(t,i){return t.rank_num-i.rank_num})),this.setIndex(n[0].id),this.tabScroll.datas=n},l.onBeforeClose=function(){this.curIndex=0,this.curAnswer=0},l.onDestroy=function(){},l.setIndex=function(t){this.curIndex!=t&&(this.curAnswer=0,this.curIndex=t,this.tabScroll.updateAll(),this.updateInfo())},l.updateInfo=function(){var t;if(0!=this.curIndex){this.tabScroll.updateAll();var i=configMoonfestival_riddle.getDataByKey(this.curIndex);this.txtDesc.string=i.subject,this.txtTips.string=i.subject_detail,this.itemGrid.SetItemId(i.right_reward[0][0],i.right_reward[0][1]),this.rewardScroll.datas=i.join_reward;for(var n=0;n<i.answer.length;n++)this.answerItems[n+1].show(i.answer[n]);var s,o=Math.floor(i.rank_num/10),d=i.rank_num%10;0==o?this.title1.node.active=!1:(this.title1.node.active=!0,1==o&&(o=0),this.loadIcon(this.title1,"autumn_riddles",h.formatStr("title_%s",o))),0==d?this.title2.node.active=!1:(this.title2.node.active=!0,this.loadIcon(this.title2,"autumn_riddles",h.formatStr("title_%s",d)));var r=IS(b).getRiddlesList();if(2==(null==(t=r[this.curIndex])?void 0:t.state)){s=r[this.curIndex].answer==i.right_answer,this.txtAnswer.node.active=!0,this.btn.active=!1;for(var a,l="",c=e(i.answer);!(a=c()).done;){var u=a.value;if(u[0]==i.right_answer){l=u[1];break}}this.txtAnswer.string=f.formatStrWithMirrorDeal(GetLanguage(200725),l)}else this.txtAnswer.node.active=!1,this.btn.active=!0;this.itemMask.active=s,this.itemReceived.active=s}},l.setAnswer=function(t){if(this.curAnswer!=t){this.curAnswer=t;for(var i=configMoonfestival_riddle.getDataByKey(this.curIndex),e=0;e<i.answer.length;e++)this.answerItems[e+1].show(i.answer[e])}},n}(A));var x=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return(i=t.call.apply(t,[this].concat(n))||this).normal=void 0,i.select=void 0,i.lock=void 0,i.img1=void 0,i.img2=void 0,i.red=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){var t=this;this.normal=v.findChildComponent(this.node,"normal",r),this.select=v.findChild(this.node,"selected"),this.lock=v.findChild(this.node,"lock"),this.red=v.findChild(this.node,"red"),this.img1=v.findChildComponent(this.node,"title/img1",r),this.img2=v.findChildComponent(this.node,"title/img2",r),this.view.addComponentCallbackListener(this.node,s.EventType.CLICK,(function(){if(t.lock.active){var i=IS(I).GetActivityInfo(C.AutumnRiddles).state_time[_.Open].start_time+24*t.data.open_time*3600,e=Math.ceil((i-w.serverTime)/86400)-1;m.showFlyTip(f.formatStrWithMirrorDeal(GetLanguage(200726),e))}else t.view.setIndex(t.data.id)}))},n.onRender=function(t,i){var e,n,s=Math.floor(t.rank_num/10),o=t.rank_num%10;0==s?this.img1.node.active=!1:(this.img1.node.active=!0,1==s&&(s=0),this.view.loadIcon(this.img1,"autumn_riddles",h.formatStr("title_%s",s))),0==o?this.img2.node.active=!1:(this.img2.node.active=!0,this.view.loadIcon(this.img2,"autumn_riddles",h.formatStr("title_%s",o))),this.select.active=t.id==this.view.curIndex;var d=IS(b).getRiddlesList();this.red.active=1==(null==(e=d[t.id])?void 0:e.state),null!=(n=d[t.id])&&n.state?(this.lock.active=!1,this.normal.color=new l(255,255,255),this.img1.color=new l(255,255,255),this.img2.color=new l(255,255,255)):(this.lock.active=!0,this.normal.color=new l(128,128,128),this.img1.color=new l(128,128,128),this.img2.color=new l(128,128,128))},e}(u),y=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return(i=t.call.apply(t,[this].concat(n))||this).itemGridNode=void 0,i.itemGrid=void 0,i.received=void 0,i.mask=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){this.received=v.findChild(this.node,"received"),this.mask=v.findChild(this.node,"mask"),this.itemGridNode=v.findChild(this.node,"itemGrid"),this.itemGrid=new c(this.view,this.itemGridNode)},n.onRender=function(t,i){var e,n;this.itemGrid.SetItemId(t[0],t[1]);var s=IS(b).getRiddlesList();this.received.active=2==(null==(e=s[this.view.curIndex])?void 0:e.state),this.mask.active=2==(null==(n=s[this.view.curIndex])?void 0:n.state)},e}(u),S=function(){function t(){this.view=void 0,this.node=void 0,this.index=void 0,this.bg=void 0,this.txt=void 0,this.wrong=void 0,this.correct=void 0,this.data=void 0}var i=t.prototype;return i.init=function(t,i,e){this.view=i,this.node=t,this.index=e,this.onInit()},i.onInit=function(){var t=this;this.bg=v.findChildComponent(this.node,"bg",r),this.txt=v.findChildComponent(this.node,"Label",d),this.wrong=v.findChild(this.node,"wrong"),this.correct=v.findChild(this.node,"correct"),this.view.addComponentCallbackListener(this.node,s.EventType.CLICK,(function(){var i;2!=(null==(i=IS(b).getRiddlesList()[t.view.curIndex])?void 0:i.state)&&t.data&&t.view.setAnswer(t.data[0])}))},i.show=function(t){var i;this.data=t,this.txt.string=t[1];var e=IS(b).getRiddlesList();if(2==(null==(i=e[this.view.curIndex])?void 0:i.state)){var n,s=configMoonfestival_riddle.getDataByKey(this.view.curIndex),o=null==(n=e[this.view.curIndex])?void 0:n.answer;o==t[0]?(this.wrong.active=o!=s.right_answer,this.correct.active=o==s.right_answer,o==s.right_answer?this.view.loadIcon(this.bg,"autumn_riddles","zq_btn_anniu04"):this.view.loadIcon(this.bg,"autumn_riddles","zq_btn_anniu05")):(this.wrong.active=!1,this.correct.active=!1,this.view.loadIcon(this.bg,"autumn_riddles","zq_btn_anniu02"))}else this.wrong.active=!1,this.correct.active=!1,t[0]==this.view.curAnswer?this.view.loadIcon(this.bg,"autumn_riddles","zq_btn_anniu03"):this.view.loadIcon(this.bg,"autumn_riddles","zq_btn_anniu02")},t}();n._RF.pop()}}}));

