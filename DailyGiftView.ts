System.register("chunks:///_virtual/DailyGiftView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./PayControl.ts","./PayDataCache.ts","./PayDefine.ts","./BaseView.ts"],(function(t){"use strict";var i,e,n,o,s,a,r,d,h,c,l,u,f,v,m,p;return{setters:[function(t){i=t.inheritsLoose,e=t.createForOfIteratorHelperLoose},function(t){n=t.cclegacy,o=t.Button,s=t.Sprite,a=t.Label,r=t.ScrollView},function(t){d=t.ItemGrid},function(t){h=t.ListItem},function(t){c=t.default},function(t){l=t.default},function(t){u=t.default},null,function(t){f=t.default},function(t){v=t.default},function(t){m=t.PayEventDefine},function(t){p=t.BaseView}],execute:function(){n._RF.push({},"bace6S2HglB36jkspDPGE8d","DailyGiftView",void 0);var g=19010,y=(t("default",function(t){function n(){var i;return(i=t.call(this)||this).txtLeftTime=void 0,i.payList=void 0,i.deltaTime=0,i.leftTime=0,i.canUpdate=!1,i.red=void 0,i.img=void 0,i.name="DailyGiftView",i.url="ui/module/recharge/DailyGiftView",i}i(n,t);var d=n.prototype;return d.onInit=function(){var t=this,i=this.findChild("view/btnClose");this.addComponentCallbackListener(i,o.EventType.CLICK,(function(){t.close()}));var e=this.findChild("view/topBg/reward");this.img=this.findChildComponent("view/topBg/reward",s),this.red=this.findChild("view/topBg/reward/red"),this.addComponentCallbackListener(e,o.EventType.CLICK,(function(){var t=IS(v).GetPayGiftInfo(g);t&&2==t.rewardState||IS(f).send_19_2(g)})),this.txtLeftTime=this.findChildComponent("view/topBg/txtLeftTime",a);var n=this.findChildComponent("view/payList",r);this.payList=this.addUIList(n,y,!0)},d.registerUpdateHandler=function(){this.addEvent(m.PAY_INFO_UPDATE,this.OnPayGiftInfoUpdate,this)},d.onAfterOpen=function(){this.OnPayGiftInfoUpdate()},d.onBeforeClose=function(){},d.onDestroy=function(){},d.onUpdate=function(t){this.canUpdate&&(this.deltaTime=this.deltaTime+t,this.deltaTime>=1&&(this.deltaTime=0,this.leftTime=this.leftTime-1,this.leftTime>0?this.txtLeftTime.string=l.formatStrWithMirrorDeal(GetLanguage(200980),u.formatTimeStringForSecond(this.leftTime)):(this.txtLeftTime.string="",this.canUpdate=!1)))},d.OnPayGiftInfoUpdate=function(){var t=IS(v).GetPayGiftInfo(g);this.leftTime=t.end_time-u.serverTime,this.leftTime>0?(this.canUpdate=!0,this.txtLeftTime.string=l.formatStrWithMirrorDeal(GetLanguage(200980),u.formatTimeStringForSecond(this.leftTime))):this.txtLeftTime.string="",this.red.active=!t||2!=t.rewardState,this.loadIcon(this.img,"mrth",this.red.active?"mrth_ui_bukelingqu":"mrth_ui_yilingqu");for(var i,n=[],o=configPay_mall.getDatas(),s=e(o);!(i=s()).done;){var a=i.value;15==a.type&&19011==a.bundle_group&&n.push(a)}n.sort((function(t,i){return t.cost_level-i.cost_level}));var r=n.pop();n.unshift(r),this.payList.datas=n},n}(p)),function(t){function n(){for(var i,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(i=t.call.apply(t,[this].concat(n))||this).txtName=void 0,i.txtDesc=void 0,i.txtPrice=void 0,i.btnBuy=void 0,i.btnNot=void 0,i.out=void 0,i.rewardScroll=void 0,i.tips=void 0,i.bg1=void 0,i.bg2=void 0,i.txtDiscount=void 0,i.discountNode=void 0,i.nodeExtra=void 0,i.itemGridExtra=void 0,i}i(n,t);var s=n.prototype;return s.onInit=function(){var t=this;this.bg1=c.findChild(this.node,"bg1"),this.bg2=c.findChild(this.node,"bg2"),this.tips=c.findChild(this.node,"tips"),this.txtName=c.findChildComponent(this.node,"title/Label",a),this.txtDesc=c.findChildComponent(this.node,"txtDesc",a),this.txtPrice=c.findChildComponent(this.node,"btnBuy/Label",a),this.discountNode=c.findChild(this.node,"discount"),this.txtDiscount=c.findChildComponent(this.node,"discount/Label",a),this.out=c.findChild(this.node,"out"),this.btnNot=c.findChild(this.node,"btnNot"),this.btnBuy=c.findChild(this.node,"btnBuy"),this.view.addComponentCallbackListener(this.btnBuy,o.EventType.CLICK,(function(){IS(v).Pay(t.data.id)}));var i=c.findChildComponent(this.node,"rewardScroll",r);this.rewardScroll=this.view.addUIList(i,b,!1),this.rewardScroll.touchEvent=!1,this.nodeExtra=c.findChild(this.node,"extra"),this.itemGridExtra=new d(this.view,c.findChild(this.node,"extra/itemGrid"))},s.onRender=function(t,i){this.bg1.active=0!=i,this.bg2.active=0==i,this.tips.active=0==i,this.nodeExtra.active=0==i&&t.extra_reward&&t.extra_reward.length>0,t.extra_reward&&t.extra_reward.length>0&&this.itemGridExtra.SetItemId(t.extra_reward[0][0],t.extra_reward[0][1]),this.txtName.string=t.name,this.rewardScroll.node.active=0!=i,this.rewardScroll.datas=t.reward,0==t.ratio?this.discountNode.active=!1:(this.discountNode.active=!0,this.txtDiscount.string=100*t.ratio+"%");var n=IS(v).GetPayGiftInfo(t.id);if(this.txtPrice.string=IS(v).GetPriceString(t.cost_level),0==t.buy_times?(this.out.active=!1,this.btnBuy.active=!0,this.discountNode.active=!0,this.txtDesc.node.active=!1):n&&n.bought_times?n.bought_times>=n.payCfg.buy_times?(this.out.active=!0,this.btnBuy.active=!1,this.discountNode.active=!1,this.txtDesc.node.active=!1):(this.out.active=!1,this.btnBuy.active=!0,this.discountNode.active=!0,this.txtDesc.node.active=!0,this.txtDesc.string=l.formatStrWithMirrorDeal(GetLanguage(200028),t.buy_times-n.bought_times,t.buy_times)):(this.out.active=!1,this.btnBuy.active=!0,this.discountNode.active=!0,this.txtDesc.node.active=!0,this.txtDesc.string=l.formatStrWithMirrorDeal(GetLanguage(200028),t.buy_times,t.buy_times)),this.btnNot.active=!1,this.btnBuy.active)for(var o,s=e(t.mutually_exclusive);!(o=s()).done;){var a=o.value,r=IS(v).GetPayGiftInfo(a);if(r&&r.bought_times&&r.bought_times>=0){this.btnNot.active=!0,this.btnBuy.active=!1;break}}},n}(h)),b=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(i=t.call.apply(t,[this].concat(n))||this).itemGridNode=void 0,i.itemGrid=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){this.itemGridNode=c.findChild(this.node,"itemGrid"),this.itemGrid=new d(this.view,this.itemGridNode)},n.onRender=function(t,i){this.itemGrid.SetItemId(t[0],t[1])},e}(h);n._RF.pop()}}}));

