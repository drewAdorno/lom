System.register("chunks:///_virtual/PrivilegeCardView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./RedPoint.ts","./RedPointMgr.ts","./StringUtil.ts","./TimeUtil.ts","./BaseView.ts","./ItemIcon.ts","./GameSetting.ts","./PayDataCache.ts","./RoleDataCache.ts","./SdkControl.ts","./PrivilegeControl.ts","./PrivilegeDataCache.ts","./PrivilegeDefine.ts"],(function(t){"use strict";var e,i,o,n,r,c,h,s,d,f,a,l,p,v,C,g,m,u,P,T,y,B,F,b;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,o=t.Button,n=t.Sprite,r=t.Label,c=t.sys,h=t.UITransform,s=t.LabelOutline,d=t.Vec2,f=t.Layout,a=t.Vec3,l=t.Color,p=t.Overflow},function(t){v=t.RedPointType},function(t){C=t.RedPointMgr},function(t){g=t.default},function(t){m=t.default},function(t){u=t.BaseView},function(t){P=t.IconAseetType},null,function(t){T=t.default},function(t){y=t.RoleDataCache},null,function(t){B=t.default},function(t){F=t.PrivilegeDataCache},function(t){b=t.PrivilegeEventDefine}],execute:function(){var E;i._RF.push({},"30f42qqB7pCKLev/HGBTZXH","PrivilegeCardView",void 0);var x=1,M=2,R=3,S=4,D=5,I=6,w=((E={})[x]=[[249,227,255],[83,52,129]],E[M]=[[255,238,136],[146,30,26]],E[R]=[[255,247,190],[18,60,23]],E[S]=[[255,247,190],[98,28,56]],E[D]=[[240,254,255],[24,23,117]],E[I]=[[255,255,225],[36,64,93]],E);t("default",function(t){function i(){var e;return(e=t.call(this)||this).imgBgTop=void 0,e.imgBgBottom=void 0,e.txtRebateNum=void 0,e.nodeRebate=void 0,e.nodeTime=void 0,e.txtTime=void 0,e.nodeEffectTopMonth=void 0,e.nodeEffectTopForever=void 0,e.nodeEffectTopFarm=void 0,e.nodeEffectTopMine=void 0,e.nodeEffectTopWing=void 0,e.nodeEffectTopFlyPet=void 0,e.txtState=void 0,e.outLineState=void 0,e.nodeEffectBottomMonth=void 0,e.nodeEffectBottomForever=void 0,e.nodeEffectBottomFarm=void 0,e.nodeEffectBottomMine=void 0,e.nodeEffectBottomWing=void 0,e.nodeEffectBottomFlyPet=void 0,e.nodeBtnBuy=void 0,e.txtBuyPrice=void 0,e.nodeBtnFetch=void 0,e.nodeBtnHasFetch=void 0,e.btnRenewal=void 0,e.txtRenewal=void 0,e.nodePrivilegeDarkTrial=void 0,e.curPrivilegeType=void 0,e.privilegeTypeCfg=void 0,e.needRefreshTxt=new Array,e.name="PrivilegeCardView",e.url="ui/module/recharge/PrivilegeCardView",e}e(i,t);var u=i.prototype;return u.onInit=function(){var t=this,e=this.findChild("root/imgMask");this.addComponentCallbackListener(e,o.EventType.CLICK,(function(){t.onMaskClick()}));var i=this.findChild("root/content/btnClose");this.addComponentCallbackListener(i,o.EventType.CLICK,(function(){t.close()})),this.imgBgTop=this.findChildComponent("root/content/top/imgBg",n),this.imgBgBottom=this.findChildComponent("root/content/bottom/imgBg",n),this.txtRebateNum=this.findChildComponent("root/content/top/rebate/txtRebateNum",r),this.nodeRebate=this.findChild("root/content/top/rebate"),this.nodeTime=this.findChild("root/content/top/time"),this.txtTime=this.findChildComponent("root/content/top/time/txtTime",r),this.nodeEffectTopMonth=this.findChild("root/content/top/effectParentMonth"),this.nodeEffectTopForever=this.findChild("root/content/top/effectParentForever"),this.nodeEffectTopFarm=this.findChild("root/content/top/effectParentFarm"),this.nodeEffectTopMine=this.findChild("root/content/top/effectParentMine"),this.nodeEffectTopWing=this.findChild("root/content/top/effectParentWing"),this.nodeEffectTopFlyPet=this.findChild("root/content/top/effectParentFlyPet"),this.findChild("root/content/top/effectParentMonth/Node").setPosition(c.uiMirror?300:0,52,0),this.findChild("root/content/top/effectParentForever/Node").setPosition(c.uiMirror?300:0,72,0),this.findChild("root/content/top/effectParentFarm/Node").setPosition(c.uiMirror?300:0,52,0),this.findChild("root/content/top/effectParentMine/Node").setPosition(c.uiMirror?300:0,52,0),this.findChild("root/content/top/effectParentWing/Node").setPosition(c.uiMirror?173.473:-126.527,-59.2785,0),this.needRefreshTxt=[[this.findChildComponent("root/content/top/effectParentMonth/item-001/txtDesc",r),this.findChildComponent("root/content/top/effectParentMonth/item-001/txtDesc",h)],[this.findChildComponent("root/content/top/effectParentForever/item-001/txtDesc",r),this.findChildComponent("root/content/top/effectParentForever/item-001/txtDesc",h)],[this.findChildComponent("root/content/top/effectParentForever/item-002/txtDesc",r),this.findChildComponent("root/content/top/effectParentForever/item-002/txtDesc",h)],[this.findChildComponent("root/content/top/effectParentFarm/item/txtDesc",r),this.findChildComponent("root/content/top/effectParentFarm/item/txtDesc",h)],[this.findChildComponent("root/content/top/effectParentFarm/item-001/txtDesc",r),this.findChildComponent("root/content/top/effectParentFarm/item-001/txtDesc",h)],[this.findChildComponent("root/content/top/effectParentMine/item/txtDesc",r),this.findChildComponent("root/content/top/effectParentMine/item/txtDesc",h)],[this.findChildComponent("root/content/top/effectParentMine/item-001/txtDesc",r),this.findChildComponent("root/content/top/effectParentMine/item-001/txtDesc",h)],[this.findChildComponent("root/content/top/effectParentWing/item/txtDesc",r),this.findChildComponent("root/content/top/effectParentWing/item/txtDesc",h)],[this.findChildComponent("root/content/top/effectParentWing/item-001/txtDesc",r),this.findChildComponent("root/content/top/effectParentWing/item-001/txtDesc",h)]],this.txtState=this.findChildComponent("root/content/bottom/txtState",r),this.outLineState=this.findChildComponent("root/content/bottom/txtState",s),this.nodeBtnBuy=this.findChild("root/content/bottom/btnBuy"),this.addComponentCallbackListener(this.nodeBtnBuy,o.EventType.CLICK,(function(){t.onBuyClick()})),this.txtBuyPrice=this.findChildComponent("root/content/bottom/btnBuy/Label",r),this.nodeBtnFetch=this.findChild("root/content/bottom/btnFetch"),this.addRedPoint("PrivilegeCardView/btnFetch",this.nodeBtnFetch,new d(90,25),v.Dot),this.addComponentCallbackListener(this.nodeBtnFetch,o.EventType.CLICK,(function(){t.onFetchClick()})),this.btnRenewal=this.findChild("root/content/bottom/btnRenewal"),this.txtRenewal=this.findChildComponent("root/content/bottom/btnRenewal/Label",r),this.addComponentCallbackListener(this.btnRenewal,o.EventType.CLICK,(function(){IS(T).Pay(t.privilegeTypeCfg.gift_id)})),this.nodeBtnHasFetch=this.findChild("root/content/bottom/btnHasFetch"),this.nodeEffectBottomMonth=this.findChild("root/content/bottom/effectParentMonth"),this.nodeEffectBottomForever=this.findChild("root/content/bottom/effectParentForever"),this.nodeEffectBottomFarm=this.findChild("root/content/bottom/effectParentFarm"),this.nodeEffectBottomMine=this.findChild("root/content/bottom/effectParentMine"),this.nodeEffectBottomWing=this.findChild("root/content/bottom/effectParentWing"),this.nodeEffectBottomFlyPet=this.findChild("root/content/bottom/effectParentFlyPet"),this.nodePrivilegeDarkTrial=this.findChild("root/content/bottom/effectParentForever/item-005"),this.dealMirrorShow()},u.dealMirrorShow=function(){if(c.uiMirror)for(var t=this.node.getComponentsInChildren(f),e=0;e<t.length;e++)1==t[e].type&&"time"!=t[e].node.name&&this.dealMirrorLayout(t[e])},u.registerUpdateHandler=function(){this.addEvent(b.PRIVILEGE_CARD_UPDATE,this.updateCardState,this),this.addEvent(b.PRIVILEGE_CARD_FETCH,this.onPrivilegeCardFetch,this)},u.onMaskClick=function(){this.close()},u.onAfterOpen=function(){this.curPrivilegeType=this.openArgs[0],this.privilegeTypeCfg=configPrivilege_cardtype.getDataByKey(this.curPrivilegeType),this.showCardInfo(),this.updateCardState()},u.showCardInfo=function(){var t=this;this.loadIcon(this.imgBgTop,"icon_privilege_card",this.privilegeTypeCfg.card_poster,null,P.ICON_SPRITE),this.loadIcon(this.imgBgBottom,"icon_privilege_card",this.privilegeTypeCfg.card_bg,null,P.ICON_SPRITE),this.txtRebateNum.string=this.privilegeTypeCfg.rebate,this.nodeRebate.position=this.curPrivilegeType==R||this.curPrivilegeType==S||this.curPrivilegeType==I?new a(232.356,187.873,0):new a(216.513,163.074,0),this.nodeEffectTopMonth.active=this.curPrivilegeType==x,this.nodeEffectTopForever.active=this.curPrivilegeType==M,this.nodeEffectTopFarm.active=this.curPrivilegeType==R,this.nodeEffectTopMine.active=this.curPrivilegeType==S,this.nodeEffectTopWing.active=this.curPrivilegeType==D,this.nodeEffectTopFlyPet.active=this.curPrivilegeType==I;for(var e=function(e){var i=t.needRefreshTxt[e][0],o=t.needRefreshTxt[e][1];i.schedule((function(){o.width>=423?(i.overflow=p.SHRINK,o.width=423):i.overflow=p.NONE}),0)},i=0;i<this.needRefreshTxt.length;i++)e(i);this.nodeEffectBottomMonth.active=this.curPrivilegeType==x,this.nodeEffectBottomForever.active=this.curPrivilegeType==M,this.nodeEffectBottomFarm.active=this.curPrivilegeType==R,this.nodeEffectBottomMine.active=this.curPrivilegeType==S,this.nodeEffectBottomWing.active=this.curPrivilegeType==D,this.nodeEffectBottomFlyPet.active=this.curPrivilegeType==I;var o=w[this.curPrivilegeType],n=o[0];this.txtState.color=new l(n[0],n[1],n[2]);var r=o[1];this.outLineState.color=new l(r[0],r[1],r[2]),this.outLineState.width=this.curPrivilegeType==R||this.curPrivilegeType==S||this.curPrivilegeType==D||this.curPrivilegeType==I?3:2,this.txtBuyPrice.string=IS(T).GetPriceString(configPay_mall.getDataByKey(this.privilegeTypeCfg.gift_id).cost_level),this.txtRenewal.string=g.formatStrWithMirrorDeal(GetLanguage(210307),IS(T).GetPriceString(configPay_mall.getDataByKey(this.privilegeTypeCfg.gift_id).cost_level)),this.refreshTxtMirrorScale()},u.refreshTxtMirrorScale=function(){if(c.uiMirror)for(var t=this.node.getComponentsInChildren(f),e=0;e<t.length;e++)1==t[e].type&&"time"!=t[e].node.name&&this.refreshTxtMirrorByLayout(t[e])},u.updateCardState=function(){var t=IS(F).getPrivilegeCardInfo(this.curPrivilegeType);this.txtState.string=null==t?GetLanguage(200556):GetLanguage(200027),this.nodeBtnBuy.active=null==t,2==this.curPrivilegeType&&(this.nodePrivilegeDarkTrial.active=IS(y).CheckFuncOpen(81)),5==this.curPrivilegeType||6==this.curPrivilegeType?(this.nodeBtnFetch.active=!1,this.nodeBtnHasFetch.active=!1,this.btnRenewal.active=null!=t&&0!=t.end_time):(this.nodeBtnFetch.active=null!=t&&0==t.status,null!=t&&1==t.status?0!=t.end_time?(this.nodeBtnHasFetch.active=!1,this.btnRenewal.active=!0):(this.nodeBtnHasFetch.active=!0,this.btnRenewal.active=!1):(this.nodeBtnHasFetch.active=!1,this.btnRenewal.active=!1)),IS(C).changeValue("PrivilegeCardView/btnFetch",IS(F).checkPrivilegeCardCanFetch(this.curPrivilegeType)?1:0),this.updateRemainTime(t)},u.updateRemainTime=function(t){null!=t&&0!=t.end_time?(this.nodeTime.active=!0,this.txtTime.string=g.formatStrWithMirrorDeal(GetLanguage(200557),m.getDeltaDays(1e3*m.serverTime,1e3*t.end_time)+1)):this.nodeTime.active=!1},u.onBeforeClose=function(){},u.onDestroy=function(){},u.onPrivilegeCardFetch=function(t){t==this.curPrivilegeType&&this.updateCardState()},u.onBuyClick=function(){null==IS(F).getPrivilegeCardInfo(this.curPrivilegeType)&&IS(T).Pay(this.privilegeTypeCfg.gift_id)},u.onFetchClick=function(){var t=IS(F).getPrivilegeCardInfo(this.curPrivilegeType);null!=t&&1!=t.status&&IS(B).reqPrivilegeCardReward(this.curPrivilegeType)},i}(u));i._RF.pop()}}}));

