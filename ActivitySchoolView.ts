System.register("chunks:///_virtual/ActivitySchoolView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./RedPoint.ts","./RedPointMgr.ts","./TimeUtil.ts","./index57.ts","./BattlePassControl.ts","./BattlePassDefine.ts","./MessageView.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./HorseCarnivalDataCache.ts","./ActivitySchoolDataCache.ts","./BaseView.ts"],(function(t){"use strict";var e,i,n,o,a,s,c,r,h,l,d,u,f,v,p,m,C,T,S;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,n=t.Label,o=t.Button,a=t.Vec2,s=t.js},function(t){c=t.RedPointType},function(t){r=t.RedPointMgr},function(t){h=t.default},null,function(t){l=t.default},function(t){d=t.BattlePassDefine},function(t){u=t.default},function(t){f=t.default},function(t){v=t.ActivityType,p=t.ActivityState,m=t.ActivityEventDefine},function(t){C=t.HorseCarnivalDataCache},function(t){T=t.default},function(t){S=t.BaseView}],execute:function(){i._RF.push({},"49055FeF3pDvLo4/ocITnC+","ActivitySchoolView",void 0);t("default",function(t){function i(){var e;return(e=t.call(this)||this).txtLeftTime=void 0,e.leftTime=0,e.timer=void 0,e.name="ActivitySchoolView",e.url="ui/module/activity/ActivitySchoolView",e.fullScreen=!0,e}e(i,t);var S=i.prototype;return S.onInit=function(){var t=this;this.txtLeftTime=this.findChildComponent("view/nodeTime/txtTime",n);var e=this.findChild("view/btnClose");this.addComponentCallbackListener(e,o.EventType.CLICK,(function(){t.close()}));var i=this.findChild("view/btnPass");this.addRedPoint("school_pass",i,new a(50,80),c.Dot),this.addComponentCallbackListener(i,o.EventType.CLICK,(function(){var t=IS(f).GetActivityInfo(v.SchoolPass);t&&t.state==p.Open?uiMgr.openView("ActivitySchoolPassView"):u.showFlyTip(GetLanguage(200026))}));var s=this.findChild("view/btnTurn");this.addRedPoint("school_turn",s,new a(55,85),c.Dot),this.addComponentCallbackListener(s,o.EventType.CLICK,(function(){var t=IS(f).GetActivityInfo(v.SchoolTurn);t&&t.state==p.Open?uiMgr.openView("ActivitySchoolTurnView"):u.showFlyTip(GetLanguage(200026))}));var h=this.findChild("view/btnRank");this.addComponentCallbackListener(h,o.EventType.CLICK,(function(){uiMgr.openView("RankingQiXiView",v.School)}));var l=this.findChild("view/btnStore");this.addRedPoint("school_store",l,new a(50,80),c.Dot),this.addComponentCallbackListener(l,o.EventType.CLICK,(function(){uiMgr.openView("ActivitySchoolStoreView",v.School),IS(r).changeValue("school_store",0)}));var d=this.findChild("view/btnTask");this.addRedPoint("school_task",d,new a(55,85),c.Dot),this.addComponentCallbackListener(d,o.EventType.CLICK,(function(){var t=IS(f).GetActivityInfo(v.SchoolTask);t&&t.state==p.Open?uiMgr.openView("ActivitySchoolTaskView",v.SchoolTask):u.showFlyTip(GetLanguage(200026))}));var m=this.findChild("view/btnGift");this.addComponentCallbackListener(m,o.EventType.CLICK,(function(){var t=IS(f).GetActivityInfo(v.SchoolTurn);t&&t.state==p.Open?uiMgr.openView("HorseCarnivalGiftView",v.SchoolTurn):u.showFlyTip(GetLanguage(200026))}))},S.registerUpdateHandler=function(){this.addEvent(m.OnActivityInfoTaskUpdate,this.updateRed,this),this.addEvent(m.OnActivityInfoUpdate,this.updateRed,this),this.addEvent(d.BATTLE_PASS_INFO_UPDATE,this.updateRed,this),this.addEvent(m.OnHorseCarnivalUpdate,this.updateRed,this),this.addEvent(m.OnHorseCarnivalReward,this.updateRed,this)},S.onAfterOpen=function(){var t=this;this.updateRed();var e=IS(f).GetActivityInfo(v.School);if(e){var i,n=null!=(i=e.state_time[e.state])?i:e.state_time[p.Open];this.leftTime=n.end_time-h.serverTime,this.timer&&(this.removeTimer(this.timer),this.timer=null),this.leftTime>0?(this.txtLeftTime.string=s.formatStr("%s",h.formatTimeStringForSecond(this.leftTime)),this.timer=this.addTimer(1,this.leftTime,(function(){var e=n.end_time-h.serverTime;t.txtLeftTime.string=e>0?s.formatStr("%s",h.formatTimeStringForSecond(e)):GetLanguage(200026)}))):this.txtLeftTime.string=GetLanguage(200026)}},S.onBeforeClose=function(){this.removeTimer(this.timer),this.timer=null},S.onDestroy=function(){},S.updateRed=function(){IS(r).changeValue("school_task",IS(f).GetTaskRedNum(v.SchoolTask)),IS(r).changeValue("school_store",IS(T).GetStoreRed()),IS(r).changeValue("school_pass",(l.checkRewardRP(5)>=0?1:0)+(l.checkAddRewardRP(5)>0?1:0)),IS(r).changeValue("school_turn",IS(C).getRedNum(v.SchoolTurn))},i}(S));i._RF.pop()}}}));

