System.register("chunks:///_virtual/WingSkillPlanSelectView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./index57.ts","./ItemIcon.ts","./WingDataCache.ts","./RoleControl.ts","./RoleDataCache.ts","./RoleDefine.ts","./BaseView.ts"],(function(i){"use strict";var t,n,e,s,o,l,a,c,h,r,d,k,f,S,u,g,v,I,m,C,_,p;return{setters:[function(i){t=i.inheritsLoose,n=i.createForOfIteratorHelperLoose},function(i){e=i.cclegacy,s=i.Button,o=i.UITransform,l=i.Node,a=i.ScrollView,c=i.Label,h=i.Layout,r=i.Overflow,d=i.Sprite,k=i.js},function(i){f=i.SelectedType,S=i.ListItem},function(i){u=i.default},function(i){g=i.default},null,function(i){v=i.IconAseetType},function(i){I=i.WingDataCache},function(i){m=i.default},function(i){C=i.RoleDataCache},function(i){_=i.RoleEventDefine},function(i){p=i.BaseView}],execute:function(){e._RF.push({},"2da8cVdASZDJolMTmTWWyBQ","WingSkillPlanSelectView",void 0);i("default",function(i){function e(){var t;return(t=i.call(this)||this).btnUseSkill=void 0,t.btnNoUseSkill=void 0,t.curPlan=void 0,t.skinIDSel=void 0,t.curPlanSkillId=void 0,t.WingUIList=void 0,t.wingInfo=[],t.txtName=void 0,t.name="WingSkillPlanSelectView",t.url="ui/module/role/WingSkillPlanSelectView",t}t(e,i);var S=e.prototype;return S.onInit=function(){var i=this,t=this.findChild("imgMask");this.addComponentCallbackListener(t,s.EventType.CLICK,(function(){i.onCloseClick()})),this.btnUseSkill=this.findChild("content/nodeSkill/btnUse"),this.addComponentCallbackListener(this.btnUseSkill,s.EventType.CLICK,(function(){IS(m).send_role_update_plan_c2s(i.curPlan,[{k:6,v:i.skinIDSel}])})),this.btnNoUseSkill=this.findChild("content/nodeSkill/btnNoUse"),this.addComponentCallbackListener(this.btnNoUseSkill,s.EventType.CLICK,(function(){IS(m).send_role_update_plan_c2s(i.curPlan,[{k:6,v:0}])}));var n=this.findChild("content/nodeSkill/ScrollView/view/content/item"),e=this.findChildComponent("content/nodeSkill/ScrollView/view/content",o);n.on(l.EventType.SIZE_CHANGED,(function(){e.height=n.getComponent(o).height}));var r=this.findChildComponent("content/nodeSelect/ScrollView",a);this.WingUIList=this.addUIList(r,y),this.WingUIList.selectedMode=f.SINGLE,this.txtName=this.findChildComponent("content/nodeSkill/common_ui_xiaotidi/txtName-001",c),this.refreshTxtMirrorByLayout(this.findChildComponent("content/nodeSkill/common_ui_xiaotidi",h))},S.onCloseClick=function(){this.close()},S.registerUpdateHandler=function(){this.addEvent(_.PLAN_ARTIFACT_SKIN_EFFECT_SEL,this.onRefreshWingSel,this),this.addEvent(_.PLAN_INFO_UPDATE,this.onPlanInfoUpdate,this)},S.onAfterOpen=function(){var i=this;this.txtName.schedule((function(){var t=i.txtName.node.getComponent(o);t.width>=368?(i.txtName.overflow=r.SHRINK,t.width=368):i.txtName.overflow=r.NONE}),0),this.curPlan=this.openArgs[0],this.rebuildWingList(),this.skinIDSel=this.wingInfo[0].skin,this.refreshAll()},S.refreshAll=function(){this.refreshWingShow(),this.refreshWingSkill(),this.refreshUseSkillBtn()},S.refreshWingShow=function(){var i=this.rebuildWingList();this.WingUIList.datas=this.wingInfo,this.WingUIList.scrollTo(i)},S.onRefreshWingSel=function(i){this.skinIDSel!=i&&(this.skinIDSel=i,this.refreshAll())},S.onPlanInfoUpdate=function(i){i==this.curPlan&&this.refreshAll()},S.rebuildWingList=function(){var i=configBack_skin.getDataByList("skin_level",0),t=0;this.wingInfo=[];for(var e,s=n(i.entries());!(e=s()).done;){var o=e.value,l=(o[0],o[1]);if(IS(I).checkWingCanShow(l.back_id)){var a=IS(I).getSkinLevelByID(l.back_id);this.wingInfo.push({skin:l.back_id,level:a,state:IS(I).getWingState(l.back_id)})}}this.wingInfo.sort((function(i,t){return i.state>t.state?-1:1}));for(var c,h=n(this.wingInfo.entries());!(c=h()).done;){var r=c.value,d=r[0];r[1].skin==this.skinIDSel&&(t=d)}return t},S.refreshWingSkill=function(){var i=this.findChildComponent("content/nodeSkill/Frame",d),t=this.findChildComponent("content/nodeSkill/Icon",d),n=this.findChildComponent("content/nodeSkill/txtName",c),e=this.findChildComponent("content/nodeSkill/ScrollView/view/content/item",c),s=configBack_skin.getDataByKeys("back_id",this.skinIDSel,"skin_level",IS(I).getSkinLevelByID(this.skinIDSel));0==s.skin_skill.length&&(s=configBack_skin.getDataByKeys("back_id",this.skinIDSel,"skin_level",IS(I).getSkinLevelByID(this.skinIDSel)+1));var o=configSkill.getDataByKey(s.skin_skill[0][0]);this.loadIcon(i,"icon_skill",k.formatStr("common_ICON_jinengkuang0%s",o.quality)),this.loadIcon(t,"icon_skill",o.icon,null,v.ICON_SPRITE),n.string=o.name;var l=configSkill_level.getDataByKeys("id",s.skin_skill[0][0],"level",s.skin_skill[0][1]);e.string=g.formatStr.apply(g,[l.desc].concat(l.desc_parm))},S.refreshUseSkillBtn=function(){var i=IS(C).planIdToInfo[this.curPlan].detail;this.curPlanSkillId=0;for(var t=0;t<i.length;t++)6==i[t].k&&(this.curPlanSkillId=i[t].v);if(IS(I).getSkinLevelByID(this.skinIDSel)<=0)return this.btnUseSkill.active=!1,void(this.btnNoUseSkill.active=!1);this.btnUseSkill.active=this.curPlanSkillId!=this.skinIDSel,this.btnNoUseSkill.active=this.curPlanSkillId==this.skinIDSel},S.onBeforeClose=function(){},S.onDestroy=function(){},e}(p));var y=function(i){function n(){for(var t,n=arguments.length,e=new Array(n),s=0;s<n;s++)e[s]=arguments[s];return(t=i.call.apply(i,[this].concat(e))||this).imgFrame=void 0,t.imgIcon=void 0,t.imgLock=void 0,t.nodeUse=void 0,t.nodeSel=void 0,t}t(n,i);var e=n.prototype;return e.onInit=function(){this.imgFrame=u.findChildComponent(this.node,"frame",d),this.imgIcon=u.findChildComponent(this.node,"icon",d),this.imgLock=u.findChild(this.node,"lock"),this.nodeUse=u.findChild(this.node,"nodeUse"),this.nodeSel=u.findChild(this.node,"sel")},e.onRender=function(i,t){this.data=i;var n=configBack_decoration.getDataByKey(this.data.skin).icon_small,e=configBack_decoration.getDataByKey(this.data.skin).quality,s=configColor.getDataByKey(e).path;this.view.loadIcon(this.imgFrame,"icon_equip",s),this.view.loadIcon(this.imgIcon,"icon_item",n),this.checkState();var o=this.view;this.nodeSel.active=o.skinIDSel==this.data.skin},e.checkState=function(){this.imgLock.active=!1,this.imgFrame.grayscale=!1,this.imgIcon.grayscale=!1,this.nodeUse.active=!1,1==this.data.state&&(this.imgLock.active=!0,this.imgFrame.grayscale=!0,this.imgIcon.grayscale=!0);var i=configBack_skin.getDataByKeys("back_id",this.data.skin,"skin_level",IS(I).getSkinLevelByID(this.data.skin));0==i.skin_skill.length&&(i=configBack_skin.getDataByKeys("back_id",this.data.skin,"skin_level",IS(I).getSkinLevelByID(this.data.skin)+1));var t=this.view;this.nodeUse.active=this.data.skin==t.curPlanSkillId},e.onItemClick=function(){normalEvent.emit(_.PLAN_ARTIFACT_SKIN_EFFECT_SEL,this.data.skin)},n}(S);e._RF.pop()}}}));

