System.register("chunks:///_virtual/JumpingView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./NodeUtil.ts","./index57.ts","./MessageView.ts","./EquipModel.ts","./GameCenterControl.ts","./GameCenterModel.ts","./RoleDataCache.ts","./RoleDefine.ts","./BaseView.ts"],(function(t){"use strict";var i,e,s,n,o,h,r,a,c,d,l,u,p,_,m,f;return{setters:[function(t){i=t.inheritsLoose,e=t.createClass,s=t.assertThisInitialized},function(t){n=t.cclegacy,o=t.Button,h=t.Node,r=t.Rect},function(t){a=t.default},null,function(t){c=t.default,d=t.TYPE_YES},function(t){l=t.EquipModel},function(t){u=t.default},function(t){p=t.default},function(t){_=t.RoleDataCache},function(t){m=t.PlayerAttr},function(t){f=t.BaseView}],execute:function(){var g,v;n._RF.push({},"aea0dhx6GRL/YCof8zDMldA","JumpingView",void 0),function(t){t[t.Level_1=1]="Level_1",t[t.Level_2=2]="Level_2",t[t.Level_3=3]="Level_3"}(g||(g={})),function(t){t[t.Run=0]="Run",t[t.JumpUp=1]="JumpUp",t[t.JumpDown=2]="JumpDown"}(v||(v={}));t("default",function(t){function n(){var i;return(i=t.call(this)||this).model=void 0,i.modelObj=void 0,i.container=void 0,i.imgTop=void 0,i.ground1=void 0,i.ground2=void 0,i.gdOver=void 0,i.gdEnd=void 0,i.bgTips=void 0,i.txtTip1=void 0,i.txtTip2=void 0,i._rectPlayer=new r,i._rect1=new r,i._rect2=new r,i._rectOver=new r,i._rectEnd=new r,i.SPEED=.02,i.RUN_X=6,i.JUMP_X=8,i.A_SPEED_Y=2,i.MAX_SPEED_Y=27,i.TIME=5,i._timerId=-1,i._timerId2=-1,i._run=!1,i._end=!1,i._jump=v.Run,i._speedX=i.RUN_X,i._aSpeedY=i.MAX_SPEED_Y,i._playerInitX=0,i._playerInitY=0,i._playerX=0,i._playerY=0,i._section=g.Level_1,i.name="JumpingView",i.url="ui/module/jumping/JumpingView",window.JumpingView=s(i),i}i(n,t);var f=n.prototype;return f.onInit=function(){var t=this,i=this.findChild("imgMask");this.addComponentCallbackListener(i,o.EventType.CLICK,(function(){t.onCloseClick()}));var e=this.findChild("btnStart");this.addComponentCallbackListener(e,o.EventType.CLICK,(function(){t.onStartClick()})),e.active=!1;var s=this.findChild("btnJump");this.addComponentCallbackListener(s,h.EventType.TOUCH_START,(function(){t.onJumpClick()})),this.imgTop=this.findChild("imgTop"),this.addComponentCallbackListener(this.imgTop,h.EventType.TOUCH_START,(function(){t.onTopClick()})),this.container=a.findChild(this.node,"container"),this.ground1=a.findChild(this.node,"bg/ground1"),this.ground2=a.findChild(this.node,"bg/ground2"),this.gdOver=a.findChild(this.node,"bg/gdOver"),this.gdEnd=a.findChild(this.node,"bg/gdEnd"),this.bgTips=a.findChild(this.node,"bg/bgTips"),this.txtTip1=a.findChild(this.bgTips,"txtTip1"),this.txtTip2=a.findChild(this.bgTips,"txtTip2"),this.setRect(this._rect1,this.ground1),this.setRect(this._rect2,this.ground2),this.setRect(this._rectOver,this.gdOver),this.setRect(this._rectEnd,this.gdEnd),this._playerInitX=this.container.position.x,this._playerInitY=this.container.position.y},f.setRect=function(t,i){t.set(i.position.x,i.position.y,i.width,i.height)},f.onCloseClick=function(){(this._section!=g.Level_1||this.end)&&this.close()},f.onStartClick=function(){var t=this;this.end&&(this.log("游戏已结束"),this.onBeforeClose(),this.prepareGame()),this.log("游戏开始"),this._section==g.Level_1?(this._timerId2=this.addTimer(this.TIME,1,(function(){t.run=!0})),this.imgTop.active=!0,this.log("mini-第1关start")):(this._timerId2=this.addTimer(1,1,(function(){t.run=!0})),this.log("mini-第"+this._section+"关start"))},f.onJumpClick=function(){this.end?this.log("游戏结束"):this._section!=g.Level_2?this.run&&(this.jump==v.Run&&(this.jump=v.JumpUp),this.log("mini-跳")):this.failGame()},f.onTopClick=function(){this.end?this.log("游戏结束"):this._section!=g.Level_1?this.log("mini-异常情况"):this.failGame()},f.registerUpdateHandler=function(){},f.createModel=function(){null!=this.model&&(this.removeUnitModel(this.model),this.model=void 0,this.modelObj=null);var t=IS(l).getShowEquipCfgIdByLocation(1),i=IS(l).getShowEquipCfgIdByLocation(2),e=IS(l).getShowEquipCfgIdByLocation(3),s=IS(_).GetTypeUsedSkin(1);this.model=this.addUnitModel({job:IS(_).GetTypeUsedSkin(0),dressId:IS(_).GetTypeUsedSkin(2)||0,gender:IS(_).GetRoleAttr(m.ROLE_ATTR_GENDER),weapon:t,ornaments:i,face:e,color:s,parent:this.container,shenqi:0}),this.modelObj=this.getUnitModel(this.model)},f.onAfterOpen=function(){var t=this;this._section=this.openArgs[0]||g.Level_1,this.prepareGame(),c.showBoxTip({tip:"欢迎来到趣味关卡"+this._section+"！",btnCnt:1,func:function(i){t.onStartClick()},ensure:GetLanguage(200413)})},f.prepareGame=function(){var t=this;switch(this._section){case g.Level_1:this.bgTips.active=!0,this.txtTip1.active=!0,this.txtTip2.active=!1;break;case g.Level_2:this.bgTips.active=!0,this.txtTip1.active=!1,this.txtTip2.active=!0;break;case g.Level_3:this.bgTips.active=!1}this._timerId<0&&(this._timerId=this.addTimer(this.SPEED,-1,(function(){t.onLoop()}))),this.createModel(),this._playerX=this.container.position.x,this._playerY=this.container.position.y,this._rectPlayer.set(this.container.position.x-this.container.width/2,this.container.position.y,this.container.width,this.container.height)},f.clearTimer=function(){this._timerId>0&&(this.removeTimer(this._timerId),this._timerId=-1),this._timerId2>0&&(this.removeTimer(this._timerId2),this._timerId2=-1)},f.onLoop=function(){this.modelObj&&(this.jump==v.JumpDown?(this._playerY-=this._aSpeedY,this._aSpeedY+=this.A_SPEED_Y,this._aSpeedY>=this.MAX_SPEED_Y&&(this._aSpeedY=this.MAX_SPEED_Y),this._speedX=this.JUMP_X):this.jump==v.JumpUp?(this._playerY+=this._aSpeedY,this._aSpeedY-=this.A_SPEED_Y,this._aSpeedY<=0&&(this._aSpeedY=0,this.jump=v.JumpDown),this._speedX=this.JUMP_X):this._speedX=this.RUN_X,this.run&&(this._playerX+=this._speedX),this._playerY<=this._rectOver.y&&(this._playerY=this._rectOver.y),this.container.setPosition(this._playerX,this._playerY,0),this._rectPlayer.x=this._playerX-this._rectPlayer.width/2,this._rectPlayer.y=this._playerY,this.check())},f.check=function(){if(this._rectPlayer.intersects(this._rectEnd))this.winGame();else{if(this._rectPlayer.intersects(this._rectOver))return this.log("mini-掉陷阱"),void this.failGame();var t=this._rectPlayer.intersects(this._rect1);if(t||this._rectPlayer.intersects(this._rect2))return this.jump=v.Run,this._playerY<=this._playerInitY&&(this._playerY=this._playerInitY),void(this._section==g.Level_1&&t&&this._rectPlayer.x+40>=this._rect1.x+this._rect1.width&&(this.jump=v.JumpUp));this._section!=g.Level_2&&this.jump==v.Run&&(this.jump=v.JumpDown)}},f.failGame=function(){var t=this;this.run=!1,this.end=!0,this.imgTop.active=!1,this.clearTimer(),this.log("mini-Game Over"),c.showBoxTip({tip:"趣味关卡"+this._section+"通关失败，是否重新开始！",btnCnt:2,func:function(i){switch(i){case d:t.onStartClick();break;default:t.close()}},ensure:GetLanguage(200413)})},f.winGame=function(){var t=this;this.run=!1,this.end=!0,this.imgTop.active=!1,this.clearTimer(),this.log("mini-通关"),this._section<g.Level_3?c.showBoxTip({tip:"趣味关卡"+this._section+"胜利,是否前往下一关卡！",btnCnt:2,func:function(i){switch(i){case d:t._section=t.openArgs[0]=t._section+1,t.onStartClick();break;default:t.close()}},ensure:GetLanguage(200414)}):c.showBoxTip({tip:"您已经通关全部的趣味关卡！",btnCnt:1,func:function(i){t.close();var e=IS(p).getRewardInfo(1);e&&2!=e.status&&IS(u).repTakeReward(1)},ensure:GetLanguage(200129)})},f.onBeforeClose=function(){this.clearTimer(),null!=this.model&&(this.removeUnitModel(this.model),this.model=void 0,this.modelObj=null),this._run=!1,this._end=!1,this._jump=v.Run,this._speedX=this.RUN_X,this._aSpeedY=this.MAX_SPEED_Y,this.container.setPosition(this._playerInitX,this._playerInitY,0),this.imgTop.active=!1},f.log=function(t){},f.onDestroy=function(){},e(n,[{key:"run",get:function(){return this._run},set:function(t){this._run=t,this.modelObj&&(this.modelObj.aniName=t?"run":"idle")}},{key:"jump",get:function(){return this._jump},set:function(t){this._jump=t}},{key:"end",get:function(){return this._end},set:function(t){this._end=t}}]),n}(f));n._RF.pop()}}}));

