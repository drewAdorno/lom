System.register("chunks:///_virtual/JobTreeView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./NodeUtil.ts","./index57.ts","./ItemIcon.ts","./ConfigGlobal.ts","./MessageView.ts","./RoleDataCache.ts","./RoleJobView.ts","./BaseView.ts"],(function(i){"use strict";var t,o,e,n,s,h,a,l,c,r,d,f,v,b,u,C,j,w,m;return{setters:[function(i){t=i.inheritsLoose,o=i.createForOfIteratorHelperLoose},function(i){e=i.cclegacy,n=i.Button,s=i.Animation,h=i.UITransform,a=i.js,l=i.Label,c=i.ScrollView,r=i.Vec2,d=i.Sprite,f=i.sys},function(i){v=i.default},null,function(i){b=i.IconAseetType},function(i){u=i.ConfigGlobal},function(i){C=i.default},function(i){j=i.RoleDataCache},function(i){w=i.JobInfoPanel},function(i){m=i.BaseView}],execute:function(){e._RF.push({},"52a91HS2hVMta/Fv4qr9/OU","JobTreeView",void 0);i("default",function(i){function e(){var t;return(t=i.call(this)||this).btnJobMask=void 0,t.jobInfoNode=void 0,t.levNode=void 0,t.jobInfo=void 0,t.jobTree=[],t.jobPath=[],t.content=void 0,t.treeViewUT=void 0,t.contentUT=void 0,t.anim=void 0,t.scroll=void 0,t.name="JobTreeView",t.url="ui/module/role/JobTreeView",t}t(e,i);var d=e.prototype;return d.onInit=function(){var i=this,t=this.findChild("imgMask");this.addComponentCallbackListener(t,n.EventType.CLICK,(function(){i.onMaskClick()}));var e=this.findChild("btnClose");this.addComponentCallbackListener(e,n.EventType.CLICK,(function(){i.onMaskClick()})),this.btnJobMask=this.findChild("jobMask"),this.addComponentCallbackListener(this.btnJobMask,n.EventType.CLICK,(function(){i.onJobMaskClick()})),this.jobInfoNode=this.findChild("JobInfoPanel"),this.anim=this.jobInfoNode.getComponent(s),this.jobInfo=new w,this.jobInfo.init(this.findChild("JobInfoPanel/JobInfoPanel"),this),this.levNode=this.findChild("jobTree/view/lev"),this.content=this.findChild("jobTree/view/content"),this.contentUT=this.findChildComponent("jobTree/view/content",h),this.treeViewUT=this.findChildComponent("jobTree/view",h),this.addComponentCallbackListener(this.content,h.EventType.TRANSFORM_CHANGED,(function(){var t=i.levNode.getPosition();i.levNode.setPosition(i.content.position.x,t.y,t.z)}));for(var r,d=this.content.children,f=o(d);!(r=f()).done;){var v=r.value,b=new p;b.init(v,this,Number(v.name)),this.jobTree.push(b)}for(var C=u.transfer_job_level,j=0;j<C.length;j++){var m=this.findChildComponent(a.formatStr("jobTree/view/lev/lev%s/Label",j+1),l);null!=m&&(m.string=5==j?GetLanguage(200581):a.formatStr("Lv.%s",C[j]))}this.scroll=this.findChildComponent("jobTree",c)},d.onMaskClick=function(){this.close()},d.onJobMaskClick=function(){this.btnJobMask.active=!1,this.jobInfoNode.active=!1},d.registerUpdateHandler=function(){},d.onAfterOpen=function(){this.btnJobMask.active=!1,this.jobInfoNode.active=!1;for(var i,t=IS(j).GetJob();0!=t;)this.jobPath.push(t),t=configJobs.getDataByKey(t).front_job;t=this.jobPath[0];for(var e,n=o(this.jobTree);!(e=n()).done;){var s=e.value;s.show(),t==s.job&&(i=s.node)}if(null!=i){var h=-this.treeViewUT.width/2,a=-(this.contentUT.width-this.treeViewUT.width+this.treeViewUT.width/2),l=Math.max(a,Math.min(h,-i.position.x)),c=-this.contentUT.height/2,d=c+(this.contentUT.height-this.treeViewUT.height),f=Math.max(c,Math.min(d,-i.position.y-500));this.content.setPosition(l,f,0)}this.scroll.scrollTo(new r(1,.8))},d.onBeforeClose=function(){this.jobPath=[]},d.onDestroy=function(){},e}(m));var p=function(){function i(){this.view=void 0,this.node=void 0,this.job=void 0,this.isGirl=void 0,this.txtName=void 0,this.icon=void 0,this.selectBg=void 0,this.nameSelectBg=void 0,this.lineGo=void 0,this.lines=[]}var t=i.prototype;return t.init=function(i,t,o){this.view=t,this.node=i,o>2e3?(this.job=Math.floor(o/10),this.isGirl=!0):this.job=o,this.onInit()},t.onInit=function(){var i=this;this.selectBg=v.findChild(this.node,"selectBg"),this.nameSelectBg=v.findChild(this.node,"nameSelectBg"),this.lineGo=v.findChild(this.node,"line/light"),this.txtName=v.findChildComponent(this.node,"name",l),this.icon=v.findChildComponent(this.node,"icon",d);var t=configJobs.getDataByKey(this.job);if(this.txtName.string=t.name,null!=t.job_change)for(var e,s=o(t.job_change);!(e=s()).done;){var h=e.value,c=v.findChild(this.node,a.formatStr("line_%s/light",h));null!=c&&(this.lines[h]=c)}this.view.addComponentCallbackListener(this.node,n.EventType.CLICK,(function(){0!=configJobs.getDataByKey(i.job).unlock?(i.view.btnJobMask.active=!0,i.view.jobInfoNode.active=!0,i.view.anim.play(),i.view.jobInfo.show(i.job,i.isGirl)):C.showFlyTip(GetLanguage(200119))}))},t.show=function(){var i=IS(j).GetJob();this.selectBg.active=i==this.job,this.nameSelectBg.active=i==this.job;var t=configJobs.getDataByKey(this.job);for(var e in 1==t.unlock?(this.isGirl?(this.view.loadIcon(this.icon,"icon_job",a.formatStr("job_%s_2",this.job),null,b.ICON_SPRITE),this.icon.node.setPosition(t.position[2],t.position[3],0)):(this.view.loadIcon(this.icon,"icon_job",a.formatStr("job_%s",this.job),null,b.ICON_SPRITE),this.icon.node.setPosition(t.position[0],t.position[1],0)),this.icon.node.setScale(f.uiMirror?-t.scale:t.scale,t.scale,t.scale)):(this.view.loadIcon(this.icon,"icon_job","job_shadow"),this.icon.node.setPosition(0,75,0),this.icon.node.setScale(f.uiMirror?-.55:.55,.55,.55)),null!=this.lineGo&&(this.lineGo.active=!1),this.lines)this.lines[e].active=!1;for(var n,s=o(this.view.jobPath);!(n=s()).done;){var h=n.value,l=this.lines[h];if(null!=l){this.lineGo.active=!0,l.active=!0;break}}},i}();e._RF.pop()}}}));

