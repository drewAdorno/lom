System.register("chunks:///_virtual/DoubleChapterLevelDetailView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./NodeUtil.ts","./BaseView.ts","./ItemIcon.ts","./ObjectUtil.ts","./MessageView.ts","./RoleDataCache.ts","./RoleDefine.ts","./ChapterDataCache.ts","./ChapterDefine.ts","./DungeonControl.ts"],(function(t){"use strict";var e,n,o,i,a,r,h,s,d,l,p,m,u,f,C,c,g,I,v,S,_,b,y,E;return{setters:[function(t){e=t.inheritsLoose},function(t){n=t.cclegacy,o=t.Button,i=t.Sprite,a=t.LabelOutline,r=t.HorizontalTextAlignment,h=t.Label,s=t.UITransform,d=t.Node,l=t.ProgressBar,p=t.Layout,m=t.Color,u=t.js},function(t){f=t.default},function(t){C=t.BaseView},function(t){c=t.IconAseetType},function(t){g=t.default},function(t){I=t.default},function(t){v=t.RoleDataCache},function(t){S=t.PlayerAttr},function(t){_=t.ChapterDataCache},function(t){b=t.DungeonDefine,y=t.ChapterEventDefine},function(t){E=t.default}],execute:function(){n._RF.push({},"ec33doqmXNIapIvLqlAbOeA","DoubleChapterLevelDetailView",void 0);t("default",function(t){function n(){var e;return(e=t.call(this)||this).teammateItemStart=void 0,e.selfItemStart=void 0,e.teammateItemEnd=void 0,e.selfItemEnd=void 0,e.curChapter=void 0,e.curChapterCfg=void 0,e.txtTitle=void 0,e.txtDesc=void 0,e.nodeCur=void 0,e.nodeThrough=void 0,e.throughInfo=void 0,e.strategyId=void 0,e.posInfo=void 0,e.strategyCfgs=void 0,e.txtStrategyName=void 0,e.txtStrategyDesc=void 0,e.posItems=void 0,e.btnLast=void 0,e.btnNext=void 0,e.imgGotoBg=void 0,e.outlineGoto=void 0,e.name="DoubleChapterLevelDetailView",e.url="ui/module/dungeon/DoubleChapterLevelDetailView",e}e(n,t);var C=n.prototype;return C.onInit=function(){var t=this,e=this.findChild("container/content/btnClose");this.addComponentCallbackListener(e,o.EventType.CLICK,(function(){t.close()}));var n=this.findChild("container/content/cur/btnGoto");this.addComponentCallbackListener(n,o.EventType.CLICK,(function(){var e=IS(_).doubleChapterInfo.now_dc_level||1;t.curChapter==e&&(null==t.posInfo||t.posInfo.length<2?I.showFlyTip(GetLanguage(204926)):(IS(E).reqDungeonBattleMoreStart(b.CHAPTER_TYPE_DOUBLE_LADDER,t.curChapter),uiMgr.closeAllView(["MainView","MessageView","GuideView","BattleHubView"]),battleMain.enterChapter(0,!0),normalEvent.emit(y.DUNGEON_ENTER)))})),this.imgGotoBg=n.getComponent(i),this.outlineGoto=this.findChildComponent("container/content/cur/btnGoto/Label",a);var m=this.findChild("container/content/through/btnReset");this.addComponentCallbackListener(m,o.EventType.CLICK,(function(){IS(E).reqDoubleChapterRestartLevel(t.curChapter)}));var C=this.findChild("container/content/cur/subTitlePos/btnTip");this.addComponentCallbackListener(C,o.EventType.CLICK,(function(){I.showBoxTip({tip:GetLanguage(204802),btnCnt:1,horizontalAlign:r.LEFT})}));var c=this.findChild("container/content/cur/subTitleStrategy/btnTip");this.addComponentCallbackListener(c,o.EventType.CLICK,(function(){I.showBoxTip({tip:GetLanguage(204923),btnCnt:1,horizontalAlign:r.LEFT})})),this.txtTitle=this.findChildComponent("container/imgTitle",h),this.txtDesc=this.findChildComponent("container/content/detail/ScrollView/view/content/txtDesc",h);var g=this.txtDesc.node,v=this.findChildComponent("container/content/detail/ScrollView/view/content",s);g.on(d.EventType.SIZE_CHANGED,(function(){v.height=g.getComponent(s).height})),this.nodeCur=this.findChild("container/content/cur"),this.nodeThrough=this.findChild("container/content/through");var S=this.findChild("container/content/through/start/roleOther");this.teammateItemStart={node:S,txtName:f.findChildComponent(S,"txtName",h),imgHead:f.findChildComponent(S,"head",i),pbHp:f.findChildComponent(S,"pbHp",l),imgBar:f.findChildComponent(S,"pbHp/Bar",i),txtHp:f.findChildComponent(S,"txtHp",h)};var L=this.findChild("container/content/through/start/roleSelf");this.selfItemStart={node:L,txtName:f.findChildComponent(L,"txtName",h),imgHead:f.findChildComponent(L,"head",i),pbHp:f.findChildComponent(L,"pbHp",l),imgBar:f.findChildComponent(L,"pbHp/Bar",i),txtHp:f.findChildComponent(L,"txtHp",h)};var D=this.findChild("container/content/through/end/roleOther");this.teammateItemEnd={node:D,txtName:f.findChildComponent(D,"txtName",h),imgHead:f.findChildComponent(D,"head",i),pbHp:f.findChildComponent(D,"pbHp",l),imgBar:f.findChildComponent(D,"pbHp/Bar",i),txtHp:f.findChildComponent(D,"txtHp",h)};var x=this.findChild("container/content/through/end/roleSelf");this.selfItemEnd={node:x,txtName:f.findChildComponent(x,"txtName",h),imgHead:f.findChildComponent(x,"head",i),pbHp:f.findChildComponent(x,"pbHp",l),imgBar:f.findChildComponent(x,"pbHp/Bar",i),txtHp:f.findChildComponent(x,"txtHp",h)},this.txtStrategyName=this.findChildComponent("container/content/cur/common_ui_xiaotidi/txtName",h),this.txtStrategyDesc=this.findChildComponent("container/content/cur/ScrollView/view/content/txtDesc",h);var H=this.txtStrategyDesc.node,T=this.findChildComponent("container/content/cur/ScrollView/view/content",s);H.on(d.EventType.SIZE_CHANGED,(function(){T.height=H.getComponent(s).height})),this.dealMirrorLayout(this.findChildComponent("container/content/cur/common_ui_xiaotidi",p)),this.btnLast=this.findChild("container/content/cur/btnLast"),this.addComponentCallbackListener(this.btnLast,o.EventType.CLICK,(function(){var e=t.getLastStrategyId();null!=e&&IS(E).reqDoubleChapterChangeStrategy(e)})),this.btnNext=this.findChild("container/content/cur/btnNext"),this.addComponentCallbackListener(this.btnNext,o.EventType.CLICK,(function(){var e=t.getNextStrategyId();null!=e&&IS(E).reqDoubleChapterChangeStrategy(e)})),this.posItems=new Array;for(var B=function(e){var n=t.findChild(u.formatStr("container/content/cur/pos/item%s",e));t.posItems.push({node:n,index:e,imgHead:f.findChildComponent(n,"head",i)}),t.addComponentCallbackListener(n,o.EventType.CLICK,(function(){t.onPosClick(e)}))},A=1;A<=5;A++)B(A)},C.registerUpdateHandler=function(){this.addEvent(y.DOUBLE_CHAPTER_INFO_BACK,this.updateInfo,this),this.addEvent(y.DOUBLE_CHAPTER_INFO_UPDATE,this.updateInfo,this),this.addEvent(y.DOUBLE_CHAPTER_GET_LEVEL_INFO_BACK,this.onDoubleChapterGetLevelInfoBack,this),this.addEvent(y.DOUBLE_CHAPTER_GET_THROUGH_INFO_BACK,this.onDoubleChapterGetThroughInfoBack,this),this.addEvent(y.DOUBLE_CHAPTER_LEVEL_INFO_POS_UPDATE,this.onDoubleChapterLevelInfoPosUpdate,this),this.addEvent(y.DOUBLE_CHAPTER_LEVEL_INFO_STRATEGY_UPDATE,this.onDoubleChapterLevelInfoStrategyUpdate,this)},C.onAfterOpen=function(){this.curChapter=this.openArgs[0],this.curChapterCfg=configDouble_ladder_chapter.getDataByKey(this.curChapter),this.txtTitle.string=this.curChapterCfg.name,this.txtDesc.string=this.curChapterCfg.desc,this.strategyCfgs=configDouble_ladder_strategic.getDatas(),this.updateInfo(),this.updateThroughShow()},C.getCurStartegyIndex=function(){if(null!=this.strategyId){for(var t,e=0;e<this.strategyCfgs.length;e++)if(this.strategyCfgs[e].id==this.strategyId){t=e;break}return t}},C.getNextStrategyId=function(){var t=this.getCurStartegyIndex();if(null!=t&&!(t>=this.strategyCfgs.length-1))return this.strategyCfgs[t+1].id},C.getLastStrategyId=function(){var t=this.getCurStartegyIndex();if(null!=t&&!(t<=0))return this.strategyCfgs[t-1].id},C.updateInfo=function(){if(null!=IS(_).doubleChapterInfo){var t=IS(_).doubleChapterInfo.now_dc_level||1;this.nodeCur.active=this.curChapter>=t,this.nodeThrough.active=this.curChapter<t,this.loadIcon(this.imgGotoBg,"common",this.curChapter!=t?"common_ICON_zhihuianniu":"common_ICON_luanniu"),this.outlineGoto.color=this.curChapter!=t?new m(76,76,76):new m(41,65,21),this.curChapter>=t?IS(E).reqDoubleChapterGetLevelInfo(this.curChapter):IS(E).reqDoubleChapterGetThroughLevelInfo(this.curChapter)}},C.updateThroughShow=function(){this.selfItemStart.txtName.string=IS(_).doubleChapterInfo.my_name,this.loadRemoteIcon(IS(v).GetRoleAttr(S.ROLE_ATTR_HEAD_URL),this.selfItemStart.imgHead);var t=this.throughInfo.my_bf_hp/IS(_).doubleChapterInfo.my_max_hp;this.loadIcon(this.selfItemStart.imgBar,"double_chapter",this.getHpBarImgByHpRate(t),null,c.UI_ATLAS,!0),this.selfItemStart.pbHp.progress=t,this.selfItemStart.txtHp.string=u.formatStr("%s%",(100*t).toFixed(1)),this.teammateItemStart.txtName.string=IS(_).doubleChapterInfo.teammate_name,this.loadRemoteIcon(IS(_).doubleChapterInfo.teammate_head.url,this.teammateItemStart.imgHead);var e=this.throughInfo.teammate_bf_hp/IS(_).doubleChapterInfo.teammate_max_hp;this.loadIcon(this.teammateItemStart.imgBar,"double_chapter",this.getHpBarImgByHpRate(e),null,c.UI_ATLAS,!0),this.teammateItemStart.pbHp.progress=e,this.teammateItemStart.txtHp.string=u.formatStr("%s%",(100*e).toFixed(1)),this.selfItemEnd.txtName.string=IS(_).doubleChapterInfo.my_name,this.loadRemoteIcon(IS(v).GetRoleAttr(S.ROLE_ATTR_HEAD_URL),this.selfItemEnd.imgHead);var n=this.throughInfo.my_af_hp/IS(_).doubleChapterInfo.my_max_hp;this.loadIcon(this.selfItemEnd.imgBar,"double_chapter",this.getHpBarImgByHpRate(n),null,c.UI_ATLAS,!0),this.selfItemEnd.pbHp.progress=n,this.selfItemEnd.txtHp.string=u.formatStr("%s%",(100*n).toFixed(1)),this.teammateItemEnd.txtName.string=IS(_).doubleChapterInfo.teammate_name,this.loadRemoteIcon(IS(_).doubleChapterInfo.teammate_head.url,this.teammateItemEnd.imgHead);var o=this.throughInfo.teammate_af_hp/IS(_).doubleChapterInfo.teammate_max_hp;this.loadIcon(this.teammateItemEnd.imgBar,"double_chapter",this.getHpBarImgByHpRate(o),null,c.UI_ATLAS,!0),this.teammateItemEnd.pbHp.progress=o,this.teammateItemEnd.txtHp.string=u.formatStr("%s%",(100*o).toFixed(1)),this.selfItemStart.imgBar.node.setPosition(0,0),this.selfItemStart.imgBar.node.setScale(1,1),this.teammateItemStart.imgBar.node.setPosition(0,0),this.teammateItemStart.imgBar.node.setScale(1,1),this.selfItemEnd.imgBar.node.setPosition(0,0),this.selfItemEnd.imgBar.node.setScale(1,1),this.teammateItemEnd.imgBar.node.setPosition(0,0),this.teammateItemEnd.imgBar.node.setScale(1,1)},C.onDoubleChapterGetLevelInfoBack=function(t){this.strategyId=t.strategy_id,this.posInfo=t.battle_pos,this.updateLevelShow()},C.updateLevelShow=function(){this.updatePosShow(),this.updateStrategyShow()},C.updatePosShow=function(){for(var t={},e=0;e<this.posInfo.length;e++)this.posInfo[e].v&&0!=this.posInfo[e].v&&(t[this.posInfo[e].k]=this.posInfo[e].v);for(var n=0;n<this.posItems.length;n++){var o=this.posItems[n],i=o.index;t[i]?(o.imgHead.node.active=!0,2==t[i]?this.loadRemoteIcon(IS(_).doubleChapterInfo.teammate_head.url,o.imgHead):this.loadRemoteIcon(IS(v).GetRoleAttr(S.ROLE_ATTR_HEAD_URL),o.imgHead)):o.imgHead.node.active=!1}},C.updateStrategyShow=function(){var t=configDouble_ladder_strategic.getDataByKey(this.strategyId);this.txtStrategyName.string=t.name,this.txtStrategyDesc.string=t.desc;var e=IS(_).doubleChapterInfo.now_dc_level||1;if(this.curChapter!=e)return this.btnLast.active=!1,void(this.btnNext.active=!1);var n=this.getCurStartegyIndex();this.btnLast.active=n>0,this.btnNext.active=n<this.strategyCfgs.length-1},C.onDoubleChapterGetThroughInfoBack=function(t){this.throughInfo=g.clone(t),this.updateThroughShow()},C.onDoubleChapterLevelInfoPosUpdate=function(t){this.posInfo=t,this.updatePosShow()},C.onDoubleChapterLevelInfoStrategyUpdate=function(t){this.strategyId=t,this.updateStrategyShow()},C.getHpBarImgByHpRate=function(t){return t>=.5?"srfb_ui_jdt_g":t>=.2?"srfb_ui_jdt_y":"srfb_ui_jdt_r"},C.checkMyCantFight=function(){return IS(_).doubleChapterInfo.my_hp/IS(_).doubleChapterInfo.my_max_hp<=0},C.checkTeammateCantFight=function(){return IS(_).doubleChapterInfo.teammate_hp/IS(_).doubleChapterInfo.teammate_max_hp<=0},C.onPosClick=function(t){var e=IS(_).doubleChapterInfo.now_dc_level||1;if(this.curChapter==e){for(var n,o,i=0;i<this.posInfo.length;i++)this.posInfo[i].v&&0!=this.posInfo[i].v&&(2==this.posInfo[i].v?o=this.posInfo[i].k:n=this.posInfo[i].k);if(n&&o){if(t!=n&&t!=o)return;if(t==n){if(this.checkMyCantFight()&&5==t)return;var a=[{k:o,v:2}];IS(E).reqDoubleChapterChangePosInfo(a)}else{if(this.checkTeammateCantFight()&&5==t)return;var r=[{k:n,v:1}];IS(E).reqDoubleChapterChangePosInfo(r)}}else if(n)if(n==t){if(this.checkMyCantFight()&&5==t)return;IS(E).reqDoubleChapterChangePosInfo([])}else{var h=[{k:n,v:1},{k:t,v:2}];IS(E).reqDoubleChapterChangePosInfo(h)}else if(o)if(o==t){if(this.checkTeammateCantFight()&&5==t)return;IS(E).reqDoubleChapterChangePosInfo([])}else{var s=[{k:t,v:1},{k:o,v:2}];IS(E).reqDoubleChapterChangePosInfo(s)}else{var d=[{k:t,v:1}];IS(E).reqDoubleChapterChangePosInfo(d)}}},C.onBeforeClose=function(){},C.onDestroy=function(){},n}(C));n._RF.pop()}}}));

