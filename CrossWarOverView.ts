System.register("chunks:///_virtual/CrossWarOverView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./V2.ts","./GuildPinItem.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./ArtifactDataCache.ts","./ChatDataCache.ts","./ChatDefine.ts","./MessageView.ts","./EquipModel.ts","./HorseDataChche.ts","./RoleDataCache.ts","./RoleDefine.ts","./CrossWarControl.ts","./CrossWarDatacache.ts","./CrossWarDefine.ts","./BaseSubView.ts"],(function(e){"use strict";var t,i,o,n,a,r,s,d,l,h,c,f,v,C,S,u,m,g,b,p,I,y,_,L,w,T,B,R,j,G,D;return{setters:[function(e){t=e.inheritsLoose,i=e.createForOfIteratorHelperLoose},function(e){o=e.cclegacy,n=e.Button,a=e.sys,r=e.ScrollView,s=e.Label,d=e.Layout,l=e.Sprite},function(e){h=e.V2},function(e){c=e.GuildPinItem},function(e){f=e.ListItem},function(e){v=e.default},function(e){C=e.default},function(e){S=e.default},null,function(e){u=e.default},function(e){m=e.ActivityType,g=e.ActivityState},function(e){b=e.ArtifactDataCache},function(e){p=e.ChatDataCache},function(e){I=e.ChatDefine},function(e){y=e.default,_=e.TYPE_YES},function(e){L=e.EquipModel},function(e){w=e.HorseDataCache},function(e){T=e.RoleDataCache},function(e){B=e.PlayerAttr},function(e){R=e.default},function(e){j=e.CrossWarDataCache},function(e){G=e.CrossWarEventDefine},function(e){D=e.BaseSubView}],execute:function(){o._RF.push({},"3d55buCclRPa70D8gLsi6BP","CrossWarOverView",void 0);e("default",function(e){function o(){var t;return(t=e.call(this)||this).flagList=[],t.flagRankList=[],t.nodeReady=void 0,t.nodeBattle=void 0,t.actData=void 0,t.model=void 0,t.ReadyScroll=void 0,t.BattleScroll=void 0,t.jobShow=void 0,t.serverShow=0,t.txtTimeLabel=void 0,t.btnJob1=void 0,t.btnJob2=void 0,t.btnJob3=void 0,t.jobSel=void 0,t.jobSel1=void 0,t.jobSwitch=void 0,t.countTimer=void 0,t.name="CrossWarOverView",t.url="ui/module/crosswar/CrossWarOverView",t.poolTime=3e3,t}t(o,e);var f=o.prototype;return f.onInit=function(){var e=this,t=this.findChild("title/btnRule");this.addComponentCallbackListener(t,n.EventType.CLICK,(function(){y.showBoxTip({tip:GetLanguage(200820),title:GetLanguage(200143),btnCnt:1,horizontalAlign:a.uiMirror?2:0})})),this.btnJob1=this.findChild("nodeBattle/jobSel/btnJob1"),this.addComponentCallbackListener(this.btnJob1,n.EventType.CLICK,(function(){e.jobShow=1,e.refreshJobSel()})),this.btnJob2=this.findChild("nodeBattle/jobSel/btnJob2"),this.addComponentCallbackListener(this.btnJob2,n.EventType.CLICK,(function(){e.jobShow=2,e.refreshJobSel()})),this.btnJob3=this.findChild("nodeBattle/jobSel/btnJob3"),this.addComponentCallbackListener(this.btnJob3,n.EventType.CLICK,(function(){e.jobShow=3,e.refreshJobSel()})),this.jobSel1=this.findChild("nodeBattle/jobSel/btnSel1"),this.jobSel=this.findChild("nodeBattle/jobSel/btnSel"),this.addComponentCallbackListener(this.jobSel,n.EventType.CLICK,(function(){var t=configCross_war_kv.getDataByKey(21).value[0];if(IS(T).GetLevel()<t)y.showFlyTip(C.formatStrWithMirrorDeal(GetLanguage(300148),t));else{var i=configCross_war_job.getDataByKey(e.jobShow).name;y.showBoxTip({tip:C.formatStrWithMirrorDeal(GetLanguage(300144),i),title:GetLanguage(200048),func:function(t){t==_&&(IS(R).reqCrossWarJobSel(e.jobShow),e.refreshJobSel())}})}})),this.jobSwitch=this.findChild("nodeBattle/jobSel/btnSwitch"),this.addComponentCallbackListener(this.jobSwitch,n.EventType.CLICK,(function(){var t=configCross_war_kv.getDataByKey(21).value[0];if(IS(T).GetLevel()<t)y.showFlyTip(C.formatStrWithMirrorDeal(GetLanguage(300148),t));else{var i=configCross_war_kv.getDataByKey(1).value[0][1];y.showBoxTip({tip:C.formatStrWithMirrorDeal(GetLanguage(400027),i),title:GetLanguage(200048),func:function(t){t==_&&IS(R).reqCrossWarJobSel(e.jobShow)}}),e.refreshJobSel()}}));var o=this.findChild("nodeReady/record/node1/btnShare");this.addComponentCallbackListener(o,n.EventType.CLICK,(function(){IS(p).SendShareData(I.ChatLinkType.CrossWarReport,{serv_rank:IS(j).report_his.serv_rank,self_rank:IS(j).report_his.self_rank,self_kill:IS(j).report_his.self_kill,self_point:IS(j).report_his.self_point,self_monster:IS(j).report_his.self_monster,job:IS(T).GetTypeUsedSkin(0),dressId:IS(T).GetTypeUsedSkin(2)||0,gender:IS(T).GetRoleAttr(B.ROLE_ATTR_GENDER),weapon:IS(L).getShowEquipCfgIdByLocation(1),ornaments:IS(L).getShowEquipCfgIdByLocation(2),face:IS(L).getShowEquipCfgIdByLocation(3),color:IS(T).GetTypeUsedSkin(1),mount:IS(w).horse_id,shenqi:IS(b).artifact_id},I.Channel.World)}));var h=this.findChild("nodeBattle/jobSel/btnGoto");this.addComponentCallbackListener(h,n.EventType.CLICK,(function(){var t=configCross_war_kv.getDataByKey(21).value[0];if(IS(T).GetLevel()<t)y.showFlyTip(C.formatStrWithMirrorDeal(GetLanguage(300148),t));else if(0!=e.serverShow)if(0!=IS(j).job)if(e.serverShow!=IS(T).GetServerId()){var i=1==IS(j).is_first?0:configCross_war_kv.getDataByKey(2).value[0][1];y.showBoxTip({tip:C.formatStr(GetLanguage(999100409),i,e.serverShow),title:GetLanguage(200048),func:function(t){t==_&&IS(R).reqCrossWarSceneSelect(e.serverShow)}})}else IS(R).reqCrossWarSceneSelect(e.serverShow);else y.showFlyTip(GetLanguage(200225));else y.showFlyTip(GetLanguage(200224))})),this.nodeReady=this.findChild("nodeReady"),this.nodeBattle=this.findChild("nodeBattle");for(var c=function(){var t={nodeBase:v.findChild(e.nodeReady,"node"+f),nodeFlag:v.findChild(e.nodeReady,"node"+f+"/flag1"),score:f,server:f,txtScore:null,txtServer:v.findChildComponent(e.nodeReady,"node"+f+"/txtTitle",s),sel:null,nid:f},o=v.findChild(e.nodeBattle,1==f?"node"+f:"Node/node"+f),a={nodeBase:o,nodeFlag:v.findChild(o,"flag1"),score:f,server:f,txtScore:v.findChildComponent(o,"bgScore/txtScore",s),txtServer:v.findChildComponent(o,"bgServer/txtServer",s),sel:v.findChild(o,"sel"),nid:f};for(e.flagList.push(t),e.flagRankList.push(a),e.addComponentCallbackListener(a.nodeBase,n.EventType.CLICK,(function(t,o){for(var n,r=i(e.flagRankList);!(n=r()).done;){var s=n.value;s.sel.active=!1,s.nid==a.nid&&(s.sel.active=!0,e.serverShow=s.server)}})),S=1;S<5;S++){var r=v.findChild(o,"b"+S);e.addComponentCallbackListener(r,n.EventType.CLICK,(function(e,t){for(var o,n=-1,r=IS(j).server_list,s=i(r);!(o=s()).done;){var d=o.value;d.serv_id==a.server&&(n=d.holy_num)}-1!=n&&y.showBoxTip({tip:C.formatStrWithMirrorDeal(GetLanguage(300147),n),title:GetLanguage(201384),btnCnt:1})}))}},f=1;f<5;f++){var S;c()}var u=this.findChildComponent("nodeReady/record/node1/ScrollView",r);this.ReadyScroll=this.addUIList(u,k);var m=this.findChildComponent("nodeBattle/jobSel/ScrollView",r);this.BattleScroll=this.addUIList(m,k),this.txtTimeLabel=this.findChildComponent("title/nodeTime/txtTime",s),a.uiMirror&&(this.dealMirrorLayout(this.findChildComponent("title/nodeTime",d)),this.loadIcon(this.findChildComponent("nodeBattle/node1/hy_ICON_paiming01",l),"common","common_ICON_paiming01"),this.loadIcon(this.findChildComponent("nodeBattle/Node/node2/hy_ICON_paiming01",l),"common","common_ICON_paiming02"),this.loadIcon(this.findChildComponent("nodeBattle/Node/node3/hy_ICON_paiming01",l),"common","common_ICON_paiming03"),this.loadIcon(this.findChildComponent("nodeBattle/Node/node4/hy_ICON_paiming01",l),"common","common_ICON_paiming04"))},f.registerUpdateHandler=function(){this.addEvent(G.CROSS_WAR_JOB_CHANGE,this.refreshJobSel,this),this.addEvent(G.CROSS_WAR_INFO_CHANGE,this.refreshView,this)},f.onAfterOpen=function(){IS(R).reqCrossWarInfo(),this.refreshView()},f.refreshView=function(){var e=this;if(this.actData=IS(u).GetActivityInfo(m.CrossWar),this.actData){this.jobShow=IS(j).job||1,this.actData.state==g.Open?this.refreshBattleNode():this.refreshReadyNode();var t=this.findChildComponent("title/nodeTime/txtStart",s),i=this.findChild("title/nodeTime/icon");this.actData.state==g.Open?(t.string=GetLanguage(201143),i.active=!0,this.txtTimeLabel.node.active=!0):this.actData.state==g.EndShow?(t.string=GetLanguage(201144),i.active=!1,this.txtTimeLabel.node.active=!1):this.actData.state==g.Preview&&(t.string=GetLanguage(201145),i.active=!0,this.txtTimeLabel.node.active=!0),0!=this.countTimer&&(this.removeTimer(this.countTimer),this.updateTime(),this.countTimer=this.addTimer(1,-1,(function(){e.updateTime()})))}},f.updateTime=function(){this.actData=IS(u).GetActivityInfo(m.CrossWar);var e=this.actData.end_time-S.serverTime;this.txtTimeLabel.string=S.getTimeLeft(e)},f.refreshBattleNode=function(){this.nodeReady.active=!1,this.nodeBattle.active=!0,this.refreshFlagInfo(this.flagRankList);var e=v.findChild(this.nodeBattle,"jobSel/model");e.removeAllChildren(),this.loadRoleModel(e),this.refreshJobSel()},f.refreshJobSel=function(){v.findChild(this.btnJob1,"normal").active=1!=this.jobShow,v.findChild(this.btnJob1,"select").active=1==this.jobShow,v.findChild(this.btnJob2,"normal").active=2!=this.jobShow,v.findChild(this.btnJob2,"select").active=2==this.jobShow,v.findChild(this.btnJob3,"normal").active=3!=this.jobShow,v.findChild(this.btnJob3,"select").active=3==this.jobShow,this.jobSel.active=!1,this.jobSwitch.active=!1,this.jobSel1.active=!1,0==IS(j).job?this.jobSel.active=!0:this.jobShow==IS(j).job?this.jobSel1.active=!0:this.jobSwitch.active=!0;for(var e,t=configCross_war_job.getDataByKey(this.jobShow),o=[],n=i(t.desc);!(e=n()).done;){var a=e.value,r=GetLanguage(a);o.push({name:r})}this.BattleScroll.datas=o},f.refreshReadyNode=function(){this.nodeReady.active=!0,this.nodeBattle.active=!1,this.refreshFlagInfo(this.flagList);var e=IS(j).report_his;if(0!=e.serv_rank){v.findChild(this.nodeReady,"record/node1").active=!0,v.findChild(this.nodeReady,"record/node2").active=!1;var t=v.findChild(this.nodeReady,"record/node1/model");t.removeAllChildren(),this.loadRoleModel(t);var i=[{name:GetLanguage(200226),num:e.serv_rank},{name:GetLanguage(200227),num:e.self_rank},{name:GetLanguage(200221),num:e.self_monster},{name:GetLanguage(200229),num:e.self_point}];this.ReadyScroll.datas=i;var o=v.findChildComponent(this.nodeReady,"record/node1/imgBg/txtName",s),n=v.findChildComponent(this.nodeReady,"record/node1/imgBg/txtServer",s);o.string=IS(T).GetRoleName(),n.string="[s"+IS(T).GetServerId()+"]"}else v.findChild(this.nodeReady,"record/node1").active=!1,v.findChild(this.nodeReady,"record/node2").active=!0},f.refreshFlagInfo=function(e){var t=IS(j).server_list;t.sort((function(e,t){return 0==e.rank?1:0==t.rank?-1:e.rank>t.rank?1:e.rank==t.rank?e.serv_id-t.serv_id:-1}));for(var o,n=i(e);!(o=n()).done;){o.value.nodeBase.active=!1}for(var a,r=i(t.entries());!(a=r()).done;){var s=a.value,d=s[0],l=s[1],h=e[d];h.nodeBase.active=!0,new c(this,h.nodeFlag).SetItem(l.guild_flag),h.txtServer.string="[s"+l.serv_id+"]",h.server=l.serv_id,h.txtScore&&(h.txtScore.string=C.GetNumString(l.point));for(var f=0;f<4;f++){var S=v.findChild(h.nodeBase,"b"+(f+1));S&&(S.active=f<l.holy_num)}}},f.loadRoleModel=function(e){this.removeUnitModel(this.model);var t=IS(L).getShowEquipCfgIdByLocation(1),i=IS(L).getShowEquipCfgIdByLocation(2),o=IS(L).getShowEquipCfgIdByLocation(3),n=IS(T).GetTypeUsedSkin(1);this.model=this.addUnitModel({job:IS(T).GetTypeUsedSkin(0),dressId:IS(T).GetTypeUsedSkin(2)||0,gender:IS(T).GetRoleAttr(B.ROLE_ATTR_GENDER),weapon:t,ornaments:i,face:o,color:n,parent:e,mount:IS(w).horse_id,shenqi:IS(b).artifact_id},h.ZERO,1),a.uiMirror&&(this.getUnitModel(this.model).dir=-1)},f.onBeforeClose=function(){},f.onDestroy=function(){},o}(D));var k=function(e){function i(){for(var t,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return(t=e.call.apply(e,[this].concat(o))||this).txtAttrName=void 0,t.txtNum=void 0,t}t(i,e);var o=i.prototype;return o.onInit=function(){this.txtAttrName=v.findChildComponent(this.node,"txtAttrName",s),this.txtNum=v.findChildComponent(this.node,"txtNum",s)},o.onRender=function(e,t){this.txtAttrName.string=e.name,this.txtNum.string=e.num},i}(f);o._RF.pop()}}}));

