System.register("chunks:///_virtual/SlaveMainView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AudioMgr.ts","./RedPoint.ts","./RedPointMgr.ts","./TimeUtil.ts","./index57.ts","./ObjectUtil.ts","./CommonModel.ts","./MessageView.ts","./RoleDataCache.ts","./RoleDefine.ts","./SlaveControl.ts","./SlaveDataCache.ts","./SlaveDefine.ts","./SlaveModel.ts","./BaseView.ts"],(function(e){"use strict";var t,i,n,o,a,d,s,l,r,f,h,u,v,c,m,S,p,C,R,I,w,g,E;return{setters:[function(e){t=e.inheritsLoose},function(e){i=e.cclegacy,n=e.Button,o=e.Label,a=e.Sprite,d=e.Vec2,s=e.sys,l=e.js},function(e){r=e.audioMgr},function(e){f=e.RedPointType},function(e){h=e.RedPointMgr},function(e){u=e.default},null,function(e){v=e.default},function(e){c=e.CommonModel},function(e){m=e.default},function(e){S=e.RoleDataCache},function(e){p=e.RoleEventDefine,C=e.RoleRedPointSystemEnum},function(e){R=e.default},function(e){I=e.SlaveDataCache},function(e){w=e.SlaveEventDefine},function(e){g=e.SlaveModel},function(e){E=e.BaseView}],execute:function(){var M;i._RF.push({},"6a02eo2XltIX6VhwJKwrDYp","SlaveMainView",void 0);var L=((M={})[1]={ani:"yumao",eff:"MX_yumao",playTime:.74,spaceTime:.2,posX:0,audio:"puren_yumao"},M[2]={ani:"hit",eff:"MX_fangqie",playTime:.2,spaceTime:.3,posX:0,audio:"puren_fanqie"},M[3]={ani:"tan",eff:"MX_tangzhi",playTime:2,spaceTime:.9,posX:30,audio:"puren_etou"},M);e("default",function(e){function i(){var t;return(t=e.call(this)||this).nodeNoMaster=void 0,t.txtMasterName=void 0,t.nodeSlave=void 0,t.nodeNoSlave=void 0,t.nodeEffectRoot=void 0,t.nodeRole=void 0,t.txtSlaveRemark=void 0,t.txtSlaveName=void 0,t.modelRole=void 0,t.btnLast=void 0,t.btnNext=void 0,t.curIndex=void 0,t.curSlaveInfo=void 0,t.lastEffectTime=void 0,t.recoverTimer=void 0,t.name="SlaveMainView",t.url="ui/module/slave/SlaveMainView",t.fullScreen=!0,t}t(i,e);var E=i.prototype;return E.onInit=function(){var e=this,t=this.findChild("view/btnClose");this.addComponentCallbackListener(t,n.EventType.CLICK,(function(){e.close()})),this.nodeNoMaster=this.findChild("view/title/noMaster"),this.txtMasterName=this.findChildComponent("view/title/txtName",o),this.nodeSlave=this.findChild("view/slave"),this.nodeNoSlave=this.findChild("view/noSlave"),this.nodeRole=this.findChild("view/slave/role"),this.txtSlaveRemark=this.findChildComponent("view/slave/remark/txtRemark",o);var i=this.findChild("view/slave/remark/btnRename");this.addComponentCallbackListener(i,n.EventType.CLICK,(function(){null!=e.curSlaveInfo&&uiMgr.openView("TabRenameView",e.curSlaveInfo.role_id,"slave",GetLanguage(201738))})),this.txtSlaveName=this.findChildComponent("view/slave/name/imgNameBg/txtName",o),this.btnLast=this.findChild("view/slave/btnLast"),this.addComponentCallbackListener(this.btnLast,n.EventType.CLICK,(function(){e.curIndex<=0||(e.curIndex=e.curIndex-1,e.updateCurSlaveShow())})),this.btnNext=this.findChild("view/slave/btnNext"),this.addComponentCallbackListener(this.btnNext,n.EventType.CLICK,(function(){var t=IS(g).getSlaveInfoCount();e.curIndex>=t-1||(e.curIndex=e.curIndex+1,e.updateCurSlaveShow())})),this.nodeEffectRoot=this.findChild("view/middleBottons/effect");var s=this.findChild("view/noSlave/btnCatch");this.addComponentCallbackListener(s,n.EventType.CLICK,(function(){uiMgr.openView("SlaveFindView")}));var r=this.findChild("view/middleBottons/btnManage");this.addComponentCallbackListener(r,n.EventType.CLICK,(function(){uiMgr.openView("SlaveManageView")}));for(var h=function(t){var i=e.findChild(l.formatStr("view/middleBottons/effect/btnEffect%s",t));e.addComponentCallbackListener(i,n.EventType.CLICK,(function(){u.serverTime-e.lastEffectTime<=1?m.showFlyTip(GetLanguage(201739)):e.trySlaveEffect(t)}))},c=1;c<=3;c++)h(c);this.loadIcon(this.findChildComponent("view/middleBottons/effect/btnEffect1",a),"slave","zgb_icon_naoyangyang"),this.findChild("view/middleBottons/effect/btnEffect1/txtEffect").setScale(1,1,1),this.loadIcon(this.findChildComponent("view/middleBottons/effect/btnEffect2",a),"slave","zgb_icon_rengfanqie"),this.findChild("view/middleBottons/effect/btnEffect2/txtEffect").setScale(1,1,1),this.loadIcon(this.findChildComponent("view/middleBottons/effect/btnEffect3",a),"slave","zgb_icon_tannaoke"),this.findChild("view/middleBottons/effect/btnEffect3/txtEffect").setScale(1,1,1);var S=this.findChild("view/bottomButtons/btnLog");this.addRedPoint("SlaveMainView/btnLog",S,new d(25,30),f.Dot),this.addComponentCallbackListener(S,n.EventType.CLICK,(function(){uiMgr.openView("SlaveLogView")}));var p=this.findChild("view/bottomButtons/btnReward");this.addRedPoint("SlaveMainView/btnReward",p,new d(80,40),f.Dot),this.addComponentCallbackListener(p,n.EventType.CLICK,(function(){uiMgr.openView("SlaveRewardView")}));var C=this.findChild("view/title");this.addComponentCallbackListener(C,n.EventType.CLICK,(function(){v.isEmpty(IS(I).masterInfo)||uiMgr.openView("SlaveMasterView",IS(I).masterInfo.role_id)}))},E.registerUpdateHandler=function(){this.addEvent(w.SLAVE_INFO_BACK,this.onSlaveInfoBack,this),this.addEvent(w.SLAVE_INFO_UPDATE,this.updateInfo,this),this.addEvent(w.SLAVE_RENAME_SUCCESS,this.onSlaveRenameSuccess,this),this.addEvent(p.ROLE_RED_POINT_LIST_UPDATE,this.onRoleRedPointListUpdate,this),this.addEvent(p.ROLE_RED_DETAIL_UPDATE,this.onRoleRedDetailUpdate,this),this.addEvent(w.SLAVE_REWARD_INFO_BACK,this.updateRewardRedPoint,this),this.addEvent(w.SLAVE_SEE_REWARD,this.updateRewardRedPoint,this)},E.updateInfo=function(){this.updateMasterInfo();var e=IS(g).getSlaveInfoCount();this.nodeNoSlave.active=e<=0,this.nodeSlave.active=e>0,this.nodeEffectRoot.active=e>0,this.curIndex||(this.curIndex=0),this.curIndex=Math.min(this.curIndex,e-1),this.curIndex=Math.max(0,this.curIndex),this.updateCurSlaveShow()},E.updateRedPoint=function(){this.updateLogRedPoint(),this.updateRewardRedPoint()},E.updateLogRedPoint=function(){IS(h).changeValue("SlaveMainView/btnLog",IS(I).getSlaveReportRed())},E.updateRewardRedPoint=function(){IS(h).changeValue("SlaveMainView/btnReward",IS(I).getSlaveRewardCanFetchRed()+IS(I).getSlaveFullRewardRed())},E.updateMasterInfo=function(){this.nodeNoMaster.active=v.isEmpty(IS(I).masterInfo),this.txtMasterName.node.active=!v.isEmpty(IS(I).masterInfo),this.txtMasterName.string=IS(g).getRoleName(IS(I).masterInfo)},E.updateCurSlaveShow=function(){var e=IS(g).getSlaveInfoCount();this.btnLast.active=this.curIndex>0,this.btnNext.active=this.curIndex<e-1,this.curSlaveInfo=IS(g).getSlaveByIndex(this.curIndex),null!=this.curSlaveInfo&&(this.txtSlaveName.string=IS(g).getRoleName(this.curSlaveInfo),this.updateSlaveMark(),null!=this.modelRole&&(this.removeUnitModel(this.modelRole),this.modelRole=null),this.curSlaveInfo.figure.skin_list=null,this.curSlaveInfo.figure.mount_figure=0,this.modelRole=IS(c).AddRoleModel(this,this.curSlaveInfo.figure,this.nodeRole,null,2.5),this.getUnitModel(this.modelRole).mount=0,s.uiMirror&&(this.getUnitModel(this.modelRole).dir=-1))},E.updateSlaveMark=function(){this.txtSlaveRemark.string=IS(g).getSlaveMark(this.curSlaveInfo)},E.clearRecoverTimer=function(){if(null!=this.recoverTimer){if(this.modelRole){var e=this.getUnitModel(this.modelRole);e&&(e.aniName="idle")}this.removeTimer(this.recoverTimer),this.recoverTimer=null}},E.trySlaveEffect=function(e){var t=this;this.lastEffectTime=u.serverTime;var i=L[e],n=this.getUnitModel(this.modelRole).modelHeight;this.addUIEffect(l.formatStr("prefab/ui-effect/%s",i.eff),this.nodeRole,1,new d(i.posX,n),2,(function(e){s.uiMirror&&(e.dir=-1)})),r.playSound(i.audio),this.addTimer(i.spaceTime,1,(function(){t.playEffectAni(i)}))},E.playEffectAni=function(e){var t=this;this.clearRecoverTimer(),this.getUnitModel(this.modelRole).aniName=e.ani,this.recoverTimer=this.addTimer(e.playTime,1,(function(){if(t.modelRole){var e=t.getUnitModel(t.modelRole);e&&(e.aniName="idle")}}))},E.onSlaveInfoBack=function(e){e==IS(S).GetRoleId()&&this.updateInfo()},E.onSlaveRenameSuccess=function(e){e==this.curSlaveInfo.role_id&&this.updateSlaveMark()},E.onRoleRedPointListUpdate=function(){this.updateLogRedPoint()},E.onRoleRedDetailUpdate=function(e){e==C.System_Slave&&this.updateLogRedPoint()},E.onAfterOpen=function(){IS(R).reqCaptureSlaveInfo(0),this.updateRedPoint()},E.onBeforeClose=function(){this.curIndex=null,this.lastEffectTime=0},E.onDestroy=function(){},i}(E));i._RF.pop()}}}));

