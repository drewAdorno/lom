System.register("chunks:///_virtual/ActivityValentineDataCache.ts",["./rollupPluginModLoBabelHelpers.js","cc","./StorageUtil.ts","./TimeUtil.ts","./BattlePassControl.ts","./PayDataCache.ts","./PayDefine.ts","./RoleDataCache.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./ActivityValentineDefine.ts","./HorseCarnivalDataCache.ts"],(function(t){"use strict";var e,i,a,n,s,r,o,c,u,f,l,v,p,d,h;return{setters:[function(t){e=t.createForOfIteratorHelperLoose},function(t){i=t.cclegacy,a=t.js},function(t){n=t.default},function(t){s=t.default},function(t){r=t.default},function(t){o=t.default},function(t){c=t.GiftType},function(t){u=t.RoleDataCache},function(t){f=t.default},function(t){l=t.ActivityType,v=t.ActivityState,p=t.ActivityEventDefine},function(t){d=t.ActivityValentineEvent},function(t){h=t.HorseCarnivalDataCache}],execute:function(){i._RF.push({},"3912dH0iklEB6N1Nc9u8YZP","ActivityValentineDataCache",void 0);t("ActivityValentineDataCache",function(){var t=i.prototype;function i(){this.passInfo={},this.recordList={send:{type:1,list:[],curPage:0},receive:{type:2,list:[],curPage:0}},this.recRoleList=[],this.lastAskTime=0,this.addRed=!0,this.canGetReward=0,normalEvent.on(p.OnActivityListUpdate,this.activityChange,this),normalEvent.on(p.OnActivityInfoUpdate,this.activityChange,this)}return t.clear=function(){},t.activityChange=function(t){this.checkPop()},t.checkPop=function(){var t=IS(f).GetActivityInfo(l.Qixi);if(t&&t.state==v.Open){var e,i=s.ServerDate(1e3*s.serverTime),r=a.formatStr("#%s#%s#%s",i.getFullYear(),i.getMonth()+1,i.getDate());if(14==i.getDate())return;var o="ActivityValentinePopView"+IS(u).GetRoleId();if((null!=(e=n.get(o))?e:"")==r)return;uiMgr.ViewIsAddPop("ActivityValentinePopView")||(uiMgr.addPopView("ActivityValentinePopView"),n.set(o,r))}},t.updatePassInfo=function(t){this.passInfo.my_figure=t.my_figure,this.passInfo.my_value=t.my_value,this.passInfo.ta_id=t.ta_id,this.passInfo.ta_value=t.ta_value,this.passInfo.ta_name=t.ta_name,this.passInfo.ta_figure=t.ta_figure,this.passInfo.reward_status=t.reward_status,this.passInfo.ta_pay_status=t.ta_pay_status,this.passInfo.ta_pay_status_2=t.ta_pay_status_2,this.passInfo.gift_status=t.gift_status,this.passInfo.gift_status_2=t.gift_status_2,normalEvent.emit(d.OnActivityValentinePassInfo)},t.updatePassExp=function(t){this.passInfo.my_value=t.my_value,this.passInfo.ta_value=t.ta_value,normalEvent.emit(d.OnActivityValentinePassInfo)},t.updatePassReward=function(t){this.passInfo.reward_status=t.reward_status,normalEvent.emit(d.OnActivityValentinePassInfo)},t.updateRecordList=function(t){var i,a;if(1==t.type?a=this.recordList.send:2==t.type&&(a=this.recordList.receive),a){for(var n in a.pageList&&1!=t.page||(a.pageList=[]),a.list=[],a.pageList[t.page]=null!=(i=t.history_list)?i:[],a.pageList)if(a.pageList.hasOwnProperty(n))for(var s,r=e(a.pageList[n]);!(s=r()).done;){var o=s.value;a.list.push(o)}a.curPage=t.page,a.maxPage=t.num,a.isMax=a.curPage>=a.maxPage,normalEvent.emit(d.OnActivityValentineRecordList)}},t.updateRecommendRoleList=function(t){this.recRoleList=t,normalEvent.emit(d.OnActivityValentineRecommendList)},t.getPassInfo=function(){return this.passInfo},t.getRecordList=function(){return this.recordList},t.getPartnerId=function(){var t;return null!=(t=this.passInfo.ta_id)?t:0},t.getRecRoleList=function(){return this.recRoleList},t.GetOptionGiftRed=function(){var t=IS(f).GetActivityInfo(l.Qixi);if(!t||t.state!=v.Open)return 0;for(var i,a=IS(o).GetAcivityGift(c.Activity,t.type,t.round),n=e(a);!(i=n()).done;){var s=i.value;if(0==s.price){var r=IS(o).GetPayGiftInfo(s.id);if(!r||2!=r.rewardState)return 1}}return 0},t.getPassRedNum=function(){var t=IS(f).GetActivityInfo(l.Qixi);if(!t||t.state!=v.Open)return 0;var e=0;return e=(e=e+r.checkRewardRP(19)>=0?1:0)+r.checkAddRewardRP(19)>0?1:0,e+=r.checkSpecialRewardRP(19),e+=this.canGetReward},t.GetStoreRed=function(){var t=IS(f).GetActivityInfo(l.Qixi);if(!t||t.state!=v.Open)return 0;if(t){var e,i=String(t.id)+"#"+String(t.round),a="ActivityValentineStoreRed"+IS(u).GetRoleId();return(null!=(e=n.get(a))?e:"")==i?0:1}return 0},t.GetTurnRed=function(){var t=IS(f).GetActivityInfo(l.ValentineTurn);if(!t||t.state!=v.Open)return 0;var e=0;return e+=IS(h).getRedNum(l.ValentineTurn)},i}());i._RF.pop()}}}));

