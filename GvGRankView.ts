System.register("chunks:///_virtual/GvGRankView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./V2.ts","./GuildPinItem.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./BaseView.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./CommonModel.ts","./FriendControl.ts","./GuildControl.ts","./GuildDataCache.ts","./RoleDataCache.ts","./RoleDefine.ts","./GvGControl.ts","./GvGDataCache.ts","./GvGDefine.ts"],(function(t){"use strict";var i,n,e,o,s,a,r,h,d,c,l,f,v,m,u,p,g,k,C,y,I,S,R,x,T,G,L;return{setters:[function(t){i=t.inheritsLoose},function(t){n=t.cclegacy,e=t.Button,o=t.Label,s=t.Sprite,a=t.ScrollView,r=t.js,h=t.sys,d=t.Layout},function(t){c=t.V2},function(t){l=t.GuildPinItem},function(t){f=t.ListItem},function(t){v=t.default},function(t){m=t.default},function(t){u=t.BaseView},function(t){p=t.default},function(t){g=t.ActivityType},function(t){k=t.CommonModel},function(t){C=t.default},function(t){y=t.default},function(t){I=t.default},function(t){S=t.RoleDataCache},function(t){R=t.PlayerAttr},function(t){x=t.default},function(t){T=t.GvGDataCache},function(t){G=t.GvGEventDefine,L=t.GvGRoleRankToRankIcon}],execute:function(){var _,w,M;n._RF.push({},"2c773SxjQZEF76C8GOGxzyT","GvGRankView",void 0);var N=1,F=2,b=((_={})[N]="",_[F]="",_),A=((w={})[1]=new c(0,0),w[2]=new c(0,0),w[3]=new c(0,0),w),D=((M={})[0]=999000218,M[1]=999000220,M[2]=999000216,M[3]=999000214,M[4]=999000212,M),E=(t("default",function(t){function n(){var i;return(i=t.call(this)||this).curType=void 0,i.rankList=void 0,i.typeItems=void 0,i.nodeRank=void 0,i.nodeRankBg=void 0,i.nodeGuildTop=void 0,i.nodePlayerTop=void 0,i.myFrame=void 0,i.myIcon=void 0,i.myFlag=void 0,i.txtMyRank=void 0,i.txtMyScore=void 0,i.txtMyName=void 0,i.txtMyServer=void 0,i.guildTopList={},i.playerTopList={},i.txtTitle=void 0,i.rankInfo=void 0,i.typeToRankInfo={},i.name="GvGRankView",i.url="ui/module/gvg/GvGRankView",i}i(n,t);var h=n.prototype;return h.onInit=function(){var t=this,i=this.findChild("imgMask");this.addComponentCallbackListener(i,e.EventType.CLICK,(function(){t.onMaskClick()}));var n=this.findChild("content/btnClose");this.addComponentCallbackListener(n,e.EventType.CLICK,(function(){t.close()})),this.txtTitle=this.findChildComponent("content/title/txtTitle",o),this.nodeRank=this.findChild("content/nodeRank"),this.nodeRankBg=this.findChild("content/imgBgRank"),this.nodeGuildTop=this.findChild("content/guildTopRank"),this.nodePlayerTop=this.findChild("content/playerTopRank"),this.typeItems=[];for(var h=function(i){var n=t.findChild(r.formatStr("content/bottomBtns/btnRanking%s",i));t.addComponentCallbackListener(n,e.EventType.CLICK,(function(){t.curType!=i&&(t.curType=i,t.updateContent())})),t.typeItems.push({node:n,nodeSelect:v.findChild(n,"imgSelect"),type:i})},d=1;d<=2;d++)h(d);this.txtMyRank=this.findChildComponent("content/nodeRank/myRank/rankNum",o),this.txtMyScore=this.findChildComponent("content/nodeRank/myRank/score",o),this.txtMyName=this.findChildComponent("content/nodeRank/myRank/info/name",o),this.txtMyServer=this.findChildComponent("content/nodeRank/myRank/info/txtServer",o),this.myFrame=this.findChildComponent("content/nodeRank/myRank/imgFrame",s),this.myIcon=this.findChildComponent("content/nodeRank/myRank/imgFrame/imgIcon",s),this.myFlag=new l(this,v.findChild(this.node,"content/nodeRank/myRank/GuildPinItem"));var c=this.findChildComponent("content/nodeRank/rankList",a);this.rankList=this.addUIList(c,E);for(var f=1;f<=3;f++){var m=new U;m.init(this.findChild("content/guildTopRank/rank"+f),this,f),this.guildTopList[f]=m}for(var u=1;u<=3;u++){var p=new B;p.init(this.findChild("content/playerTopRank/rank"+u),this,u),this.playerTopList[u]=p}},h.registerUpdateHandler=function(){this.addEvent(G.GVG_WEEK_RANK_BACK,this.onGvGWeekRankBack,this)},h.onMaskClick=function(){this.close()},h.onAfterOpen=function(){var t;for(var i in this.guildTopList)this.guildTopList.hasOwnProperty(i)&&this.guildTopList[i].show();for(var n in this.playerTopList)this.playerTopList.hasOwnProperty(n)&&this.playerTopList[n].show();var e=IS(p).GetActivityInfo(g.GvG),o=configFamiliybrawl.getDataByKey(e.roundCfg.group_id),s=configRanktype.getDataByKey(o.family_rank_cross_id),a=configRanktype.getDataByKey(o.self_rank_cross_id);(t={})[N]=s.prefix,t[F]=a.prefix,b=t,IS(x).reqGvGWeekRank(1),IS(x).reqGvGWeekRank(2),this.txtTitle.string=GetLanguage_UI(D[IS(T).curRanking]),this.curType=1,this.updateContent()},h.updateContent=function(){for(var t=0;t<this.typeItems.length;t++){var i=this.typeItems[t];i.nodeSelect.active=i.type==this.curType}if(this.curType==N){if(this.nodeGuildTop.active=!0,this.nodePlayerTop.active=!1,this.myFrame.node.active=!1,IS(S).HasGuild()){var n=IS(I).GetGuildInfo();this.txtMyName.string=n.name,this.myFlag.node.active=!0,this.myFlag.SetItem(n.guild_flag),this.txtMyServer.node.active=1==IS(T).ifCross,1==IS(T).ifCross&&(this.txtMyServer.string=r.formatStr("[s%s]",IS(S).GetServerId()))}else this.txtMyName.string=GetLanguage(200083),this.myFlag.node.active=!1,this.txtMyServer.node.active=!1;this.UpdateRankInfo(),this.rankList.scrollTo(0,0)}else this.curType==F&&(this.nodeGuildTop.active=!1,this.nodePlayerTop.active=!0,this.myFlag.node.active=!1,this.myFrame.node.active=!0,this.txtMyServer.node.active=1==IS(T).ifCross,1==IS(T).ifCross&&(this.txtMyServer.string=r.formatStr("[s%s]",IS(S).GetServerId())),this.txtMyName.string=IS(S).GetRoleAttr(R.ROLE_ATTR_NAME),this.loadRemoteIcon(IS(S).GetRoleAttr(R.ROLE_ATTR_HEAD_URL),this.myIcon),this.UpdateRankInfo(),this.rankList.scrollTo(0,0))},h.onBeforeClose=function(){this.typeToRankInfo={},this.rankList.clearData()},h.onDestroy=function(){},h.UpdateRankInfo=function(){if(this.rankInfo=this.getRankInfo(),this.rankInfo){var t,i={},n=[];this.curType==N?i=this.guildTopList:this.curType==F&&(i=this.playerTopList);for(var e=0;e<this.rankInfo.rank_info.length;e++)e<3?this.rankInfo.rank_info.length>=e?i[e+1].show(this.rankInfo.rank_info[e]):i[e+1].show(null):n.push(this.rankInfo.rank_info[e]);n.sort((function(t,i){return t.rank<i.rank?-1:1})),this.rankList.datas=n,this.txtMyRank.string=0!=this.rankInfo.my_rank_info.rank?this.rankInfo.my_rank_info.rank:GetLanguage(200037),this.txtMyScore.string=r.formatStr("%s%s",b[this.curType],m.GetNumString(null!=(t=this.rankInfo.my_rank_info.score)?t:0))}else{if(this.curType==N)for(var o=1;o<=3;o++)this.guildTopList[o].show(null);else if(this.curType==F)for(var s=1;s<=3;s++)this.playerTopList[s].show(null);this.txtMyRank.string=GetLanguage(200037),this.txtMyScore.string=r.formatStr("%s%s",b[this.curType],0),this.rankList.datas=[]}},h.getRankInfo=function(){return this.typeToRankInfo[this.curType]},h.onGvGWeekRankBack=function(t){this.typeToRankInfo[t.type]=t,this.UpdateRankInfo()},n}(u)),function(t){function n(){for(var i,n=arguments.length,e=new Array(n),o=0;o<n;o++)e[o]=arguments[o];return(i=t.call.apply(t,[this].concat(e))||this).imgFrame=void 0,i.imgIcon=void 0,i.flag=void 0,i.txtRank=void 0,i.rankIcon=void 0,i.txtName=void 0,i.txtServer=void 0,i.txtScore=void 0,i}i(n,t);var a=n.prototype;return a.onInit=function(){var t=this;this.imgFrame=v.findChildComponent(this.node,"imgFrame",s),this.imgIcon=v.findChildComponent(this.node,"imgFrame/imgIcon",s),this.flag=new l(this.view,v.findChild(this.node,"GuildPinItem")),this.txtRank=v.findChildComponent(this.node,"rankNum",o),this.rankIcon=v.findChildComponent(this.node,"rankIcon",s),this.txtName=v.findChildComponent(this.node,"info/name",o),this.txtServer=v.findChildComponent(this.node,"info/txtServer",o),this.txtScore=v.findChildComponent(this.node,"score",o),this.view.addComponentCallbackListener(this.imgFrame.node,e.EventType.CLICK,(function(){IS(C).reqOtherRoleNotice(t.data.belong_id)}))},a.onRender=function(t,i){var n=this.view;n.curType==N?(this.flag.node.active=!0,this.imgFrame.node.active=!1,this.flag.SetItem(t.guild_flag)):n.curType==F&&(this.flag.node.active=!1,this.imgFrame.node.active=!0,this.view.loadRemoteIcon(t.head.url,this.imgIcon)),this.txtName.string=t.name,this.txtScore.string=b[n.curType]+m.GetNumString(t.score),this.txtServer.node.active=1==IS(T).ifCross,1==IS(T).ifCross&&(this.txtServer.string=r.formatStr("[s%s]",t.serv_id)),t.rank<=3?(this.rankIcon.node.active=!0,this.txtRank.node.active=!1,this.view.loadIcon(this.rankIcon,"common","common_ICON_paiming0"+t.rank)):(this.rankIcon.node.active=!1,this.txtRank.node.active=!0,this.txtRank.string=t.rank)},a.onItemClick=function(){var t=this.view;t.curType==N?IS(y).send_29_1(this.data.belong_id):t.curType==F&&IS(C).reqOtherRoleNotice(this.data.info.belong_id)},n}(f)),B=function(){function t(){this.view=void 0,this.node=void 0,this.rank=void 0,this.txtName=void 0,this.txtServer=void 0,this.txtScore=void 0,this.imgFrame=void 0,this.imgIcon=void 0,this.rankIcon=void 0,this.job=void 0,this.data=void 0,this.role=void 0}var i=t.prototype;return i.init=function(t,i,n){this.view=i,this.node=t,this.rank=n,this.onInit()},i.onInit=function(){var t=this;this.job=v.findChild(this.node,"role"),this.txtName=v.findChildComponent(this.node,"nameInfo/name",o),this.txtServer=v.findChildComponent(this.node,"nameInfo/txtServer",o),this.txtScore=v.findChildComponent(this.node,"score",o),this.imgFrame=v.findChild(this.node,"imgFrame"),this.imgIcon=v.findChildComponent(this.node,"imgFrame/imgIcon",s),this.view.addComponentCallbackListener(this.imgFrame,e.EventType.CLICK,(function(){t.data&&IS(C).reqOtherRoleNotice(t.data.belong_id)}));var i=v.findChild(this.node,"role/click");this.view.addComponentCallbackListener(i,e.EventType.CLICK,(function(){t.data&&IS(C).reqOtherRoleNotice(t.data.belong_id)})),this.rankIcon=v.findChildComponent(this.node,"imgFrame/rank_icon",s),this.view.loadIcon(this.rankIcon,"rank",L[this.rank]),h.uiMirror&&this.view.dealMirrorLayout(v.findChildComponent(this.node,"nameInfo",d))},i.show=function(t){if(this.data=t,this.txtName.string=GetLanguage(200038),this.txtScore.string=b[F]+"0",this.imgIcon.node.active=!1,this.txtServer.node.active=!1,null!=this.role&&(this.view.removeUnitModel(this.role),this.role=null),t){var i=t.figure;this.role=IS(k).AddRoleModel(this.view,i,this.job,null,.9),this.view.getUnitModel(this.role).mount=i.mount_figure,this.imgIcon.node.active=!0,this.view.loadRemoteIcon(t.head.url,this.imgIcon),i.mount_figure<=0&&(this.view.getUnitModel(this.role).position=A[this.rank]),h.uiMirror&&(this.view.getUnitModel(this.role).dir=-1),this.view.loadRemoteIcon(t.head.url,this.imgIcon),this.txtName.string=t.name,this.txtScore.string=b[F]+m.GetNumString(t.score),this.txtServer.node.active=1==IS(T).ifCross,1==IS(T).ifCross&&(this.txtServer.string=r.formatStr("[s%s]",t.serv_id))}},t}(),U=function(){function t(){this.view=void 0,this.node=void 0,this.rank=void 0,this.flag=void 0,this.txtName=void 0,this.txtServer=void 0,this.txtScore=void 0,this.rankIcon=void 0,this.data=void 0}var i=t.prototype;return i.init=function(t,i,n){this.view=i,this.node=t,this.rank=n,this.onInit()},i.onInit=function(){var t=this;this.txtName=v.findChildComponent(this.node,"info/name/name",o),this.txtServer=v.findChildComponent(this.node,"info/txtServer",o),this.txtScore=v.findChildComponent(this.node,"score",o),this.flag=new l(this.view,v.findChild(this.node,"GuildPinItem")),this.view.addComponentCallbackListener(this.flag.node,e.EventType.CLICK,(function(){t.data&&IS(y).send_29_1(t.data.belong_id)})),this.rankIcon=v.findChildComponent(this.node,"rank_icon",s),this.view.loadIcon(this.rankIcon,"common","common_ICON_paiming0"+this.rank)},i.show=function(t){this.data=t,this.txtName.string=GetLanguage(200038),this.txtScore.string=b[N]+"0",this.flag.node.active=!1,this.txtServer.node.active=!1,t&&(this.flag.node.active=!0,this.flag.SetItem(t.guild_flag),this.txtName.string=t.name,this.txtScore.string=b[N]+m.GetNumString(t.score),this.txtServer.node.active=1==IS(T).ifCross,1==IS(T).ifCross&&(this.txtServer.string=r.formatStr("[s%s]",t.serv_id)))},t}();n._RF.pop()}}}));

