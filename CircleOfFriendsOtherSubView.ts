System.register("chunks:///_virtual/CircleOfFriendsOtherSubView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./StringUtil.ts","./index57.ts","./CommonDefine.ts","./FriendControl.ts","./RoleDataCache.ts","./CircleOfFriendsControl.ts","./CircleOfFriendsDataCache.ts","./CircleOfFriendsDefine.ts","./CircleOfFriendsDynamicMessageItem.ts","./BaseSubView.ts"],(function(t){"use strict";var e,i,n,a,s,o,r,h,d,l,c,f,m,g,p,C,u,I,v;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,n=t.Button,a=t.Label,s=t.Sprite,o=t.ScrollView,r=t.Node,h=t.instantiate,d=t.Vec3},function(t){l=t.default},null,function(t){c=t.CommonEventDefine},function(t){f=t.default},function(t){m=t.RoleDataCache},function(t){g=t.default},function(t){p=t.CircleOfFriendsDataCache},function(t){C=t.CircleOfFriendsEvent,u=t.CircleOfFriendsDefine},function(t){I=t.CircleOfFriendsDynamicMessageItem},function(t){v=t.BaseSubView}],execute:function(){i._RF.push({},"d2098lkfk9PwLgT87TsVu4h","CircleOfFriendsOtherSubView",void 0);t("default",function(t){function i(){var e;return(e=t.call(this)||this).ScrollView=void 0,e.target_id=void 0,e.empty=void 0,e.tempMessageItem=void 0,e.imgHeadFrame=void 0,e.specHead=void 0,e.headImg=void 0,e.playerName=void 0,e.gender=void 0,e.fansNum=void 0,e.attentionNum=void 0,e.posName=void 0,e.tagName=void 0,e.isSendToServer=void 0,e.page=void 0,e.attentionCancel=void 0,e.attentionAdd=void 0,e.attentionState=void 0,e.blockBtn=void 0,e.blockBtnName=void 0,e.isTopRefresh=!1,e.name="CircleOfFriendsMainSubView",e.fullScreen=!1,e}e(i,t);var v=i.prototype;return v.registerUpdateHandler=function(){this.addEvent(C.UpdateRoleInfo,this.RefreshMyInfo,this),this.addEvent(C.UpdateDynamicInfo,this.RefreshContent,this),this.addEvent(C.UpdateDynamicDiscuss,this.RefreshContent,this),this.addEvent(C.InsertDiscusses,this.RefreshContent,this),this.addEvent(C.InsertDynamic,this.InsertDynamic,this),this.addEvent(C.UpdateAttentionInfo,this.RefreshMyInfo,this),this.addEvent(C.UpdateAttentionInfo,this.RefreshContent,this),this.addEvent(C.UpdateBlockInfo,this.UpdateBlock,this),this.addEvent(C.DeleteDynamic,this.RefreshContent,this),this.addEvent(C.DeleteDynamicDiscuss,this.RefreshContent,this),this.addEvent(c.UpdateTranslateResult,this.updateTranslate,this)},v.onInit=function(){var t=this;this.InitMyPlayerInfo(),this.InitTempItem(),this.InitScroll(),this.addComponentCallbackListener(this.findChild("bottom/btnClose"),n.EventType.CLICK,(function(){IS(p).ClearDynamicOtherInfo(),normalEvent.emit(C.CloseChildView,u.ViewType.OtherPanel)})),this.empty=this.findChild("empty"),this.attentionCancel=this.findChild("attention/cancelBtn"),this.addComponentCallbackListener(this.attentionCancel,n.EventType.CLICK,(function(){IS(g).sendToSubscrib(t.target_id,0)})),this.attentionAdd=this.findChild("attention/addBtn"),this.addComponentCallbackListener(this.attentionAdd,n.EventType.CLICK,(function(){IS(g).sendToSubscrib(t.target_id,1)})),this.attentionState=this.findChildComponent("attention/state",a),this.blockBtn=this.findChild("block/blockBtn"),this.blockBtnName=this.findChildComponent("block/blockBtn/Label",a),this.addComponentCallbackListener(this.blockBtn,n.EventType.CLICK,(function(){var e=IS(p).GetOtherRoleInfo();if(e){var i=e.is_block&&2==e.is_block?1:2;IS(g).sendToBlock(t.target_id,i)}})),this.attentionState=this.findChildComponent("attention/state",a)},v.InitMyPlayerInfo=function(){var t=this;this.addComponentCallbackListener(this.findChild("top/myPlayerInfo/playerInfo/head"),n.EventType.CLICK,(function(){var e=IS(m).GetRoleId();t.target_id!=e&&IS(f).reqOtherRoleNotice(t.target_id)})),this.imgHeadFrame=this.findChildComponent("top/myPlayerInfo/playerInfo/head/imgHeadFrame",s),this.specHead=this.findChild("top/myPlayerInfo/playerInfo/head/gmIcon"),this.headImg=this.findChildComponent("top/myPlayerInfo/playerInfo/head/image",s),this.playerName=this.findChildComponent("top/myPlayerInfo/playerInfo/name",a),this.gender=this.findChildComponent("top/myPlayerInfo/playerInfo/name/gender",s),this.fansNum=this.findChildComponent("top/myPlayerInfo/fansBtn/num",a),this.addComponentCallbackListener(this.findChild("top/myPlayerInfo/fansBtn"),n.EventType.CLICK,(function(){normalEvent.emit(C.OpenChildView,u.ViewType.AttentionPanel,[2,t.target_id,t.playerName.string])})),this.attentionNum=this.findChildComponent("top/myPlayerInfo/attentionBtn/num",a),this.addComponentCallbackListener(this.findChild("top/myPlayerInfo/attentionBtn"),n.EventType.CLICK,(function(){normalEvent.emit(C.OpenChildView,u.ViewType.AttentionPanel,[1,t.target_id,t.playerName.string])})),this.posName=this.findChildComponent("top/myPlayerInfo/posSettingBtn/name",a),this.tagName=this.findChildComponent("top/myPlayerInfo/tagSettingBtn/name",a)},v.InitScroll=function(){var t=this,e=this.findChildComponent("ScrollView",o);this.ScrollView=this.addUIList(e,I),this.ScrollView.lackSlide=!0,this.addComponentCallbackListener(e.node,o.EventType.SCROLL_TO_BOTTOM,(function(){if(!t.isSendToServer){var e=IS(p).GetOtherDynamicInfo();!e.isMaxPage&&e.page&&(t.page=e.page+1,t.isSendToServer=!0,IS(g).sendToGetMoment(t.target_id,t.page,u.PageSize))}})),this.addComponentCallbackListener(e.node,o.EventType.BOUNCE_TOP,(function(){t.isTopRefresh&&(t.isTopRefresh=!1,t.page=1,IS(g).sendToGetMoment(t.target_id,t.page,u.PageSize))}));var i=this.findChild("ScrollView/view/content");this.addComponentCallbackListener(i,r.EventType.TRANSFORM_CHANGED,(function(e){e&r.TransformBit.POSITION&&i.position.y<u.ContentRefeshPos&&(t.isTopRefresh=!0)}))},v.InitTempItem=function(){this.tempMessageItem=new I;var t=this.findChild("ScrollView/view/content/item"),e=h(t);e.setParent(this.node),e.active=!0,e.position=new d(99999,99999,99999),this.tempMessageItem.isTempItem=!0,this.tempMessageItem.init(null,e,this)},v.onAfterOpen=function(){var t;this.page=1,this.target_id=null!=(t=this.openArgs[0])?t:this.target_id,this.openArgs[0]?(this.ScrollView.scrollView.scrollToTop(),IS(g).sendToGetRole(this.target_id),IS(g).sendToGetMoment(this.target_id,this.page,u.PageSize)):IS(g).sendToGetRole(this.target_id),this.RefreshMyInfo(),this.RefreshContent()},v.updateTranslate=function(t){var e=IS(p).GetDynamicOtherList();if(e&&e.length>0)for(var i=0;i<e.length;i++){var n=e[i];if("CircleOfFriend"==t.key1&&n.id==Number(t.key2)){delete n.height;var a=this.CalcHeightByIndex(n);this.ScrollView.setCustomItemSize(i,a),this.ScrollView.updateAll();break}}},v.RefreshMyInfo=function(){var t=IS(p).GetOtherRoleInfo();if(t){if(0==t.role_id)this.playerName.string=t.name,this.specHead.active=!0,this.headImg.node.active=!1,this.imgHeadFrame.node.active=!1;else{this.specHead.active=!1,this.playerName.string=l.GetServNameById(t.server_id)+t.name,this.loadRemoteIcon(t.head_url,this.headImg);var e=t.head.frame_id;if(e>0){this.imgHeadFrame.node.active=!0;var i=configAvatar_frame.getDataByKey(e);this.loadIcon(this.imgHeadFrame,"icon_frame",i.icon)}else this.imgHeadFrame.node.active=!1}if(t.gender>0?(this.gender.node.active=!0,this.loadIcon(this.gender,"player",1==t.gender?"grxx_ui_nan":"grxx_ui_nv")):this.gender.node.active=!1,this.fansNum.string=t.fan_num,this.attentionNum.string=t.subscrib_num,t.area1&&t.area1>0){var n=configCircle_location.getDataByKey(t.area1);this.posName.string=n.name}else this.posName.string=GetLanguage(300130);t.label&&t.label>0?this.tagName.string=configCircle_label.getDataByKey(t.label).name:this.tagName.string=GetLanguage(300130),this.UpdateAttention(),this.UpdateBlock()}},v.UpdateAttention=function(){var t=IS(p).GetOtherRoleInfo();t&&(1==t.state||3==t.state?(this.attentionCancel.active=!0,this.attentionAdd.active=!1):(this.attentionCancel.active=!1,this.attentionAdd.active=!0),3==t.state?this.attentionState.string=GetLanguage(300131):1==t.state?this.attentionState.string=GetLanguage(300127):2==t.state?this.attentionState.string=GetLanguage(300156):this.attentionState.string="")},v.UpdateBlock=function(){var t=IS(p).GetOtherRoleInfo();t&&(this.blockBtnName.string=t.is_block&&2==t.is_block?GetLanguage(999300165):GetLanguage(999300166))},v.RefreshContent=function(){var t,e=this;t=IS(p).GetDynamicOtherList(),this.ScrollView.setCustomItemsSize(t,(function(i){return e.CalcHeightByIndex(t[i])}),!0),this.ScrollView.datas=t,this.empty.active=0==t.length,this.isSendToServer=!1},v.CalcHeightByIndex=function(t){if(t){var e=this.tempMessageItem.GetShowContent(t);if(t.height&&t.height.discussLen==t.discusses.length&&e==t.height.content)return t.height.height;var i=this.tempMessageItem.CalcHeight(t);return t.height={discussLen:t.discusses.length,height:i,content:e},i}},v.InsertDynamic=function(){this.ScrollView.scrollView.scrollToTop(),IS(g).sendToGetRole(this.target_id),IS(g).sendToGetMoment(this.target_id,this.page,u.PageSize)},v.onBeforeClose=function(){},v.onDestroy=function(){},i}(v));i._RF.pop()}}}));

