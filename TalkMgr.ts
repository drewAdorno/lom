System.register("chunks:///_virtual/TalkMgr.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GameLoadingView.ts","./EnumDefine.ts","./EventDefine.ts","./MathUtil.ts","./GameSetting.ts","./Talk.ts"],(function(t){"use strict";var e,i,n,a,l,r,o,u,g;return{setters:[function(t){e=t.createForOfIteratorHelperLoose},function(t){i=t.cclegacy},function(t){n=t.GameLoadingView},function(t){a=t.BattleFlag},function(t){l=t.EventDefine},function(t){r=t.default},function(t){o=t.default,u=t.GameSettingKey},function(t){g=t.default}],execute:function(){i._RF.push({},"fd3768zLm5IKaY5JyodRbyo","TalkMgr",void 0);var f=function(){this.unitId=0,this.triggerNum=0,this.triggerFrame=0};t("TalkMgr",function(){function t(){this._talks=[]}var i=t.prototype;return i.init=function(){this._talks.length=0,battleEvent.on(l.UnitHit,this.onUnitHit,this)},i.clear=function(){this._talks.length=0},i.getUnit=function(t){for(var i,n=e(this._talks);!(i=n()).done;){var a=i.value;if(a.unitId==t)return a}},i.onUnitHit=function(t){if("public1"!=n.instance.isPublic&&IS(o).Get(u.BATTLE_TASK)&&battleMain.battleFlag&a.OPEN_GRAPHIC&&!(battleMain.battleFlag&a.SIMP_MODEL||battleMain.battleFlag&a.UI_MASK||battleMain.hideText||t.config.dialogue.length<=0)){for(var i,l=!1,s=null,c=e(t.config.dialogue);!(i=c()).done;){var d=i.value;if(1==d[0]){r.random(0,1)<=d[4]&&(l=!0,s=d);break}}if(l){var h=this.getUnit(t.unitId);if(null==h)(h=new f).unitId=t.unitId,h.triggerNum++,h.triggerFrame=battleMain.frameCount,this._talks.push(h);else{if(h.triggerNum>=s[3])return;if(battleMain.frameCount-h.triggerFrame<=Math.floor(30*s[2]))return}var m=r.getRandomInt(2,t.config.dialogue_list[0].length),v=t.config.dialogue_list[0][m];g.alloc(t.unitId,configDialogue.getDataByKey(v).text)}}},t}());i._RF.pop()}}}));

