System.register("chunks:///_virtual/SeasonMainView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./V2.ts","./AudioMgr.ts","./RedPoint.ts","./RedPointMgr.ts","./NodeUtil.ts","./StringUtil.ts","./index57.ts","./ItemIcon.ts","./SpineSkeleton.ts","./BagDefine.ts","./BagModel.ts","./ChapterControl.ts","./MessageView.ts","./RoleDefine.ts","./SeasonControl.ts","./SeasonDataCache.ts","./SeasonDefine.ts","./SeasonSceneControl.ts","./SeasonShipModel.ts","./BaseView.ts"],(function(e){"use strict";var i,t,n,o,s,a,d,h,p,r,l,u,c,S,f,m,C,I,v,g,E,_,w,b,y,P,T,L,x,V,q,B,R;return{setters:[function(e){i=e.inheritsLoose,t=e.createForOfIteratorHelperLoose},function(e){n=e.cclegacy,o=e.Vec2,s=e.Button,a=e.Label,d=e.Sprite,h=e.ProgressBar,p=e.Animation,r=e.js,l=e.UIOpacity,u=e.Vec3,c=e.sys},function(e){S=e.V2},function(e){f=e.audioMgr},function(e){m=e.RedPointType},function(e){C=e.RedPointMgr},function(e){I=e.default},function(e){v=e.default},null,function(e){g=e.IconAseetType},function(e){E=e.SpineSkeleton},function(e){_=e.BagEventDefine},function(e){w=e.BagModel},function(e){b=e.default},function(e){y=e.default},function(e){P=e.RoleEventDefine},function(e){T=e.default},function(e){L=e.SeasonDataCache},function(e){x=e.SeasonShipEventDefind},function(e){V=e.default},function(e){q=e.SeasonShipModel},function(e){B=e.ViewEvent,R=e.BaseView}],execute:function(){n._RF.push({},"3fd77WqmQ1Fc7cIXC5cB10V","SeasonMainView",void 0);var M=[270006];e("default",function(e){function n(){var i;return(i=e.call(this)||this).EquipList=[],i.nodeShip=void 0,i.txtLevel=void 0,i.nodeResParent=void 0,i.nodeResItem=void 0,i.resItems=void 0,i.expItems=[],i.txtPbLevel=void 0,i.txtPbLevelDesc=void 0,i.pbExp=void 0,i.buildEff=void 0,i.txtTips=void 0,i.imgTips=void 0,i.can_Send_server=!1,i.shipid=void 0,i.buildTimer=void 0,i.gearBox=void 0,i.animationSell=void 0,i.expAniTween=void 0,i.curEquip=void 0,i.btnOpen=void 0,i.name="SeasonMainView",i.url="ui/module/season/SeasonMainView",i.poolTime=0,i.fullScreen=!0,i}i(n,e);var R=n.prototype;return R.onInit=function(){var e=this;this.gearBox=this.findChildComponent("bottom/btnAuto/imgGear",E),this.gearBox.setAnimation(0,"idle",!0),this.buildEff=this.findChildComponent("bottom/bg/dhh_ui_dibuBG/nodeEff",E);var i=this.findChild("bottom/btnSkin");IS(C).addRedPoint("Season/Skin",i,new o(30,30),m.Dot),IS(L).checkShipSkinRP(),this.addComponentCallbackListener(i,s.EventType.CLICK,(function(){uiMgr.openView("SeasonShipSkinView")}));var t=this.findChild("bottom/btnShip");IS(C).addRedPoint("Season/Equip/body",t,new o(70,40),m.Dot),IS(L).checkShipBodyRP(),this.addComponentCallbackListener(t,s.EventType.CLICK,(function(){uiMgr.openView("SeasonShipBodyView")}));var n=this.findChild("bottom/btnClose");this.addComponentCallbackListener(n,s.EventType.CLICK,(function(){f.playMusic("battle"),e.close(),uiMgr.close("SeasonMapSceneView")}));var u=this.findChild("bottom/btnTower");IS(C).addRedPoint("Season/Tower",u,new o(60,30),m.Dot),IS(C).changeValue("Season/Tower",IS(L).checkTowerRP()),this.addComponentCallbackListener(u,s.EventType.CLICK,(function(){uiMgr.openView("SeasonTowerView")}));var c=this.findChild("bottom/btnMap");IS(C).addRedPoint("Season/Map",c,new o(60,30),m.Dot),IS(L).checkMapRP(),this.addComponentCallbackListener(c,s.EventType.CLICK,(function(){IS(V).reqEnter(),uiMgr.getOpenView("SeasonMapSceneView")||(uiMgr.openView("SeasonMapLoadView"),uiMgr.openView("SeasonMapSceneView")),e.close()}));var S=this.findChild("bottom/btnCrew");IS(C).addRedPoint("Season/Crew",S,new o(60,30),m.Dot),IS(L).checkShipRoomRP(),this.addComponentCallbackListener(S,s.EventType.CLICK,(function(){uiMgr.openView("SeasonShipCrewView")}));var v=this.findChild("bottom/btnSeek");IS(C).addRedPoint("Season/Treasure",v,new o(60,30),m.Dot),IS(L).checkTreasureRP(),this.addComponentCallbackListener(v,s.EventType.CLICK,(function(){uiMgr.openView("SeasonTreasureView")}));var g=this.findChild("bottom/btnRoll");this.addComponentCallbackListener(g,s.EventType.CLICK,(function(){uiMgr.openView("SeasonShipTurnView")}));var _=this.findChild("bottom/btnLevel");IS(C).addRedPoint("Season/Equip/equip/level",_,new o(40,20),m.Dot),this.addComponentCallbackListener(_,s.EventType.CLICK,(function(){uiMgr.openView("SeasonShipBuildUpgradeView")}));var w=this.findChild("bottom/btnAuto");this.addComponentCallbackListener(w,s.EventType.CLICK,(function(){IS(q).setAutoOpen(!1),e.can_Send_server=!0;var i=IS(q).getEmptyEquipIdList(!1,0);i.length<=0?uiMgr.openView("SeasonShipEquipAutoOpenView"):i.length<=1?IS(q).tryOpenEquipEditView(i[0]):uiMgr.openView("SeasonShipEquipTempBagView")}));var b=this.findChild("bottom/btnBuild");IS(C).addRedPoint("Season/Equip/equip/build",b,new o(80,80),m.Dot),this.addComponentCallbackListener(b,s.EventType.CLICK,(function(){IS(q).setAutoOpen(!1),IS(q).can_Send_server=!0,e.onStartBuild(),IS(q).onStartBuild()})),this.btnOpen=this.findChild("bottom/btnOpen"),this.addComponentCallbackListener(this.btnOpen,s.EventType.CLICK,(function(){var e=IS(q).getEmptyEquipIdList(!1,0);e.length<=1?IS(q).tryOpenEquipEditView(e[0]):uiMgr.openView("SeasonShipEquipTempBagView")})),this.curEquip=this.findChild("bottom/btnOpen/itemGrid");var P=this.findChild("top/nodeProgress/btnAll");this.addComponentCallbackListener(P,s.EventType.CLICK,(function(){uiMgr.openView("SeasonShipOverView")}));for(var T=function(i){var t=e.findChild("bottom/nodeEquip/node"+i),n={itemNode:I.findChild(t,"itemGrid"),empty:I.findChild(t,"empty"),baseNode:t,index:i,equip_id:0};e.EquipList.push(n),e.addComponentCallbackListener(n.empty,s.EventType.CLICK,(function(){y.showFlyTip(GetLanguage(204229))})),e.addComponentCallbackListener(n.itemNode,s.EventType.CLICK,(function(){uiMgr.openView("SeasonShipEquipDetailView",n.equip_id)}))},x=1;x<6;x++)T(x);this.nodeShip=this.findChild("bottom/nodeShip"),this.txtTips=this.findChildComponent("bottom/resItem/txtNum",a),this.imgTips=this.findChildComponent("bottom/resItem/imgIcon",d),this.txtLevel=this.findChildComponent("bottom/btnLevel/txtLevel",a),this.pbExp=this.findChildComponent("top/nodeProgress/ProgressBar/",h),this.txtPbLevel=this.findChildComponent("top/nodeProgress/ProgressBar/Node",a),this.txtPbLevelDesc=this.findChildComponent("top/nodeProgress/ProgressBar/txtDesc",a),this.animationSell=this.findChildComponent("bottom/nodeBuild/MX_tx_duanzaochushou",p);for(var B=1;B<=5;B++){var R=this.findChild(r.formatStr("bottom/nodeBuild/resRoot/ResItem%s",B)),M=R.getComponent(l);M.opacity=0;var A=R.position;this.expItems.push({node:R,opacity:M,txtResCount:I.findChildComponent(R,"txtCount",a),posX:A.x,posY:A.y,resId:13})}this.initResShow()},R.initResShow=function(){var e=this;this.nodeResParent=this.findChild("bottom/nodeChange"),this.nodeResItem=this.findChild("bottom/nodeChange/resItem"),this.nodeResItem.active=!1,this.resItems=new Array;for(var i=function(i){var t=nodeInstantiate.instantiate(e.nodeResItem),n=M[i];e.addComponentCallbackListener(t,s.EventType.CLICK,(function(){IS(w).OpenItemTips(n,I.findChild(t,"txtNum"))})),t.parent=e.nodeResParent,t.active=!0;var o=I.findChildComponent(t,"imgIcon",d),h=configGoods.getDataByKey(n);e.loadIcon(o,"icon_item",h.icon),e.resItems.push({node:t,txtNum:I.findChildComponent(t,"txtNum",a),goodsGtid:n})},t=0;t<M.length;t++)i(t)},R.registerUpdateHandler=function(){this.addEvent(_.GOODS_INFO_UPDATE,this.updateResShow,this),this.addEvent(P.ROLE_RES_UPDATE,this.updateResShow,this),this.addEvent(x.SHIP_EQUIP_LIST_UPDATE,this.refreshEquipShow,this),this.addEvent(x.TYPE_SHIP_INFO_UPDATE,this.refreshBoxInfo,this),this.addEvent(x.TYPE_SHIP_BODY_SKIN_INFO_UPDATE,this.refreshBoxInfo,this),this.addEvent(x.TYPE_SHIP_LEVEL_INFO_UPDATE,this.refreshLevelShow,this),this.addEvent(x.TYPE_SHIP_FIGURE_CHANGE_UPDATE,this.showShipModel,this),this.addEvent(x.SHIP_EQUIP_LIST_UPDATE,this.showShipModel,this),this.addEvent(x.TYPE_SHIP_EQUIP_BUILD_START,this.onStartBuild,this),this.addEvent(x.TYPE_SHIP_EQUIP_AUTO_OPEN_STATUS_CHANGE,this.updateAutoAni,this),this.addEvent(x.TYPE_SHIP_EQUIP_SELL,this.onEquipSell,this),this.addEvent(B.ViewClose,this.onViewClose,this)},R.onAfterOpen=function(){IS(T).reqShipInfo(),f.playMusic("hanghai_mainbgm"),IS(T).reqSeasonActInfo(),this.buildEff.setAnimation(0,"idle",!0),this.refreshEquipShow(),this.refreshBoxInfo(),this.showShipModel(),this.refreshLevelShow(),this.checkOpenEquipEditView(),this.updateResShow(),this.updateAutoAni()},R.updateResShow=function(){for(var e=0;e<this.resItems.length;e++)this.resItems[e].txtNum.string=v.GetNumString(IS(w).getGoodsCountByGoodsGtid(this.resItems[e].goodsGtid));IS(L).checkShipSkinRP(),IS(L).checkRedPoint()},R.updateShipBodyIcon=function(){var e,i=this.findChildComponent("bottom/btnShip/icon",d),t=IS(L).cur_ship_skin,n=null!=(e=configSeason_ship.getDataByKey(t).icon)?e:"";this.loadIcon(i,"season_equip",n,null,g.ICON_SPRITE)},R.checkOpenEquipEditView=function(){for(var e,i=IS(L).equip_list,n=t(i);!(e=n()).done;){var o=e.value;0==o.location&&uiMgr.openView("SeasonShipEquipEditView",o.equip_id)}},R.refreshEquipShow=function(){this.can_Send_server=!0;for(var e,i=IS(L).getUsingEquipList(),n={},o=t(i);!(e=o()).done;){var s=e.value;n[s.location]=s}for(var h,p=t(this.EquipList);!(h=p()).done;){var r=h.value,l=n[r.index];if(l){r.itemNode.active=!0,r.empty.active=!1;var u=I.findChildComponent(r.itemNode,"num",a),c=I.findChildComponent(r.itemNode,"imgFrame",d),S=I.findChildComponent(r.itemNode,"imgIcon",d),f=configSeason_equipment.getDataByKey(l.config_id);if(f){var m=configColor.getDataByKey(f.quality).path;this.loadIcon(c,"icon_equip",m),this.loadIcon(S,f.atlas,f.icon,null,g.ICON_SPRITE),u.string=v.formatStr("Lv.##1",l.equip_lv),r.equip_id=l.equip_id}}else r.itemNode.active=!1,r.empty.active=!0}this.refreshCurItem()},R.refreshCurItem=function(){var e=IS(q).getEmptyEquipIdList();if(this.btnOpen.active=!1,e&&e.length>0){var i=IS(q).getEquipInfoByEquipId(e[0]);this.btnOpen.active=!0;var t=I.findChildComponent(this.curEquip,"imgFrame",d),n=I.findChildComponent(this.curEquip,"imgIcon",d),o=configSeason_equipment.getDataByKey(i.config_id);if(o){var s=configColor.getDataByKey(o.quality).path;this.loadIcon(t,"icon_equip",s),this.loadIcon(n,o.atlas,o.icon,null,g.ICON_SPRITE)}}},R.refreshBoxInfo=function(){this.txtLevel.string=v.formatStr("Lv.##1",IS(L).equip_box_level);var e=configSeason_ship_level.getDataByKey(IS(L).ship_level);this.txtTips.string=v.formatStr(GetLanguage(302064),e.cost[1]);var i=configGoods.getDataByKey(M[0]);this.loadIcon(this.imgTips,"icon_item",i.icon),this.updateShipBodyIcon(),this.showShipModel()},R.showShipModel=function(){this.shipid&&this.removeShipModel(this.shipid);var e=IS(L).getShipShowFigureInfo();this.shipid=this.addShipModel({shipId:e.shipId,flag:e.flag,ram:e.ram,parent:this.nodeShip,gunId:e.gunId},S.ZERO,.7),this.updateShipBodyIcon()},R.refreshLevelShow=function(){this.txtPbLevel.string=IS(L).ship_level+"";var e=configSeason_ship_level.getDataByKey(IS(L).ship_level),i=configSeason_ship_level.getDataByKey(IS(L).ship_level+1);null!=e&&(null!=i?(this.txtPbLevelDesc.string=IS(L).ship_exp-e.expend_exp+"/"+(i.expend_exp-e.expend_exp),this.pbExp.progress=(IS(L).ship_exp-e.expend_exp)/(i.expend_exp-e.expend_exp)):(this.txtPbLevelDesc.string="max",this.pbExp.progress=1))},R.onStartBuild=function(){var e=this,i=configSeason_ship_level.getDataByKey(IS(L).ship_level);if(IS(w).getGoodsCountByGoodsGtid(M[0])>=i.cost[1]){if(!this.can_Send_server)return;this.can_Send_server=!1,IS(q).checkCanPopEquipEditView()&&f.playSound("haizhan_duanzao"),this.buildEff.setAnimation(0,"skill1",!1),this.buildTimer&&this.removeTimer(this.buildTimer),this.buildTimer=this.addTimer(1.1,1,(function(){e.buildEff.setAnimation(0,"idle",!0)}))}this.updateAutoAni()},R.updateAutoAni=function(){IS(q).getAutoOpen()?this.gearBox.setAnimation(0,"run",!0):this.gearBox.setAnimation(0,"idle",!0)},R.onEquipSell=function(e){var i=this;IS(q).checkCanPopEquipEditView()&&f.playSound("shendeng_tx_shoumai"),this.animationSell.play(),this.addTimer(.5,1,(function(){i.tryShowResFly(e)}))},R.tryShowResFly=function(e){for(var i=this,t=0,n=0;n<e.length;n++)13==e[n].gtid&&(t+=e[n].num);var o={},s=Math.floor(t/5),a=t-5*s;if(a>0)for(var d=1;d<=a;d++)o[d-1]=!0;for(var h=0;h<this.expItems.length;h++){var p=this.expItems[h];p.node.setPosition(new u(p.posX,p.posY,0)),p.txtResCount.string=v.formatStr(c.uiMirror?"##1+":"+##1",o[h]?s+1:s),p.opacity.opacity=255}this.expAniTween=normalTween.to(0,1,.5,(function(e,t){for(var n=0;n<i.expItems.length;n++){var o=i.expItems[n];t>.5&&(o.opacity.opacity=255-255*t),o.node.setPosition(new u(o.posX,o.posY+20*t,0))}})).start()},R.onViewClose=function(e){"SeasonShipEquipEditView"!=e&&"SeasonShipEquipTempBagView"!=e&&IS(q).checkCanPopEquipEditView()&&!IS(q).getAutoOpen()&&this.checkOpenEquipEditView()},R.onBeforeClose=function(){IS(b).reqEnterChapter(0),battleMain.enterChapter(0,!1,!0),IS(L).checkRedPoint(),this.expAniTween&&(this.expAniTween.stop(),this.expAniTween=null)},R.onDestroy=function(){},n}(R));n._RF.pop()}}}));

