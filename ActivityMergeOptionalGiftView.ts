System.register("chunks:///_virtual/ActivityMergeOptionalGiftView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./PayControl.ts","./PayDataCache.ts","./PayDefine.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./BaseView.ts"],(function(t){"use strict";var i,e,n,o,s,a,r,d,h,c,f,u,l,v,m,y,p,g,C,I,G;return{setters:[function(t){i=t.inheritsLoose},function(t){e=t.cclegacy,n=t.Button,o=t.Label,s=t.Layout,a=t.ScrollView,r=t.UITransform,d=t.Vec3},function(t){h=t.ItemGrid},function(t){c=t.ListItem},function(t){f=t.default},function(t){u=t.default},function(t){l=t.default},null,function(t){v=t.default},function(t){m=t.default},function(t){y=t.PayEventDefine,p=t.GiftType},function(t){g=t.default},function(t){C=t.ActivityType,I=t.ActivityState},function(t){G=t.BaseView}],execute:function(){e._RF.push({},"637b0t8FWBCMpFozIXoVrYx","ActivityMergeOptionalGiftView",void 0);t("default",function(t){function e(){var i;return(i=t.call(this)||this).txtLeftTime=void 0,i.payList=void 0,i.deltaTime=0,i.leftTime=0,i.canUpdate=!1,i.name="ActivityMergeOptionalGiftView",i.url="ui/module/activityMerge/ActivityMergeOptionalGiftView",i}i(e,t);var r=e.prototype;return r.onInit=function(){var t=this,i=this.findChild("view/btnClose");this.addComponentCallbackListener(i,n.EventType.CLICK,(function(){t.close()})),this.txtLeftTime=this.findChildComponent("view/time/txtLeftTime",o),this.dealMirrorLayout(this.findChildComponent("view/time",s));var e=this.findChildComponent("view/payList",a);this.payList=this.addUIList(e,S,!0)},r.registerUpdateHandler=function(){this.addEvent(y.PAY_INFO_UPDATE,this.OnPayGiftInfoUpdate,this),this.addEvent(y.PAY_CUSTOM_INFO_UPDATE,this.OnPayGiftInfoUpdate,this),this.addEvent(y.PAY_CUSTOM_INFO_SET,this.OnPayGiftInfoUpdate,this)},r.onAfterOpen=function(){this.dealMirrorLayout(this.findChildComponent("view/time",s));var t=IS(g).GetActivityInfo(C.MergeGame);if(t&&t.state==I.Open){var i=l.getTargetTimestampByServer(23,59,59)/1e3;this.leftTime=i-l.serverTime,this.leftTime>0?(this.canUpdate=!0,this.txtLeftTime.string=l.formatTimeStringForSecond(this.leftTime)):this.txtLeftTime.string=GetLanguage(200026),IS(v).send_19_8()}},r.onBeforeClose=function(){this.canUpdate=!1},r.onDestroy=function(){},r.onUpdate=function(t){this.canUpdate&&(this.deltaTime=this.deltaTime+t,this.deltaTime>=1&&(this.deltaTime=0,this.leftTime=this.leftTime-1,this.leftTime>0?this.txtLeftTime.string=l.formatTimeStringForSecond(this.leftTime):(this.txtLeftTime.string=GetLanguage(200026),this.canUpdate=!1)))},r.OnPayGiftInfoUpdate=function(){var t=IS(g).GetActivityInfo(C.MergeGame);if(t){var i=IS(m).GetAcivityGift(p.Activity,t.type,t.round),e=IS(m).GetAcivityGift(p.Custom,t.type,t.round),n=!1,o=null;for(var s in i)if(i.hasOwnProperty(s)){var a=i[s],r=IS(m).GetPayGiftInfo(a.id);r&&2==r.rewardState?(n=!1,o=a):(n=!0,e.push(a))}e.sort((function(t,i){var e=IS(m).GetPayGiftInfo(t.id),n=IS(m).GetPayGiftInfo(i.id),o=e&&0!=e.payCfg.buy_times&&e.bought_times&&e.bought_times>=e.payCfg.buy_times;return o!=(n&&0!=n.payCfg.buy_times&&n.bought_times&&n.bought_times>=n.payCfg.buy_times)?o?1:-1:t.id-i.id})),0==n&&e.push(o),this.payList.datas=e}},e}(G));var S=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(i=t.call.apply(t,[this].concat(n))||this).txtName=void 0,i.txtDesc=void 0,i.txtPrice=void 0,i.btnBuy=void 0,i.out=void 0,i.rewardScroll=void 0,i.scrollUt=void 0,i.red=void 0,i.nodeChoose=void 0,i.notSet1=void 0,i.notSet2=void 0,i.itemGrid1=void 0,i.itemGrid2=void 0,i.chooseItems=[],i}i(e,t);var s=e.prototype;return s.onInit=function(){var t=this;this.txtName=f.findChildComponent(this.node,"title/Label",o),this.txtDesc=f.findChildComponent(this.node,"txtDesc",o),this.txtPrice=f.findChildComponent(this.node,"btnBuy/Label",o),this.out=f.findChild(this.node,"out"),this.btnBuy=f.findChild(this.node,"btnBuy"),this.view.addComponentCallbackListener(this.btnBuy,n.EventType.CLICK,(function(){0==t.data.cost_level?(IS(v).send_19_2(t.data.id),IS(g).UpdateMainRedByActType(C.MergeGame)):IS(m).Pay(t.data.id)})),this.scrollUt=f.findChildComponent(this.node,"rewardScroll",r);var i=f.findChildComponent(this.node,"rewardScroll",a);this.rewardScroll=this.view.addUIList(i,w,!1),this.rewardScroll.touchEvent=!1,this.red=f.findChild(this.node,"red"),this.nodeChoose=f.findChild(this.node,"choose");for(var e=function(i){var e=f.findChild(t.node,"choose/item"+i),o=f.findChild(e,"notSet"),s=new h(t.view,f.findChild(e,"itemGrid"));t.view.addComponentCallbackListener(e,n.EventType.CLICK,(function(){var e=IS(m).GetPayGiftInfo(t.data.id);t.data.buy_times>0&&e&&e.bought_times>=t.data.buy_times||uiMgr.openView("ActivityMergeOptionalDetailView",t.data.id,i)}));var a={node:e,notSet:o,itemGrid:s};t.chooseItems[i]=a},s=1;s<=2;s++)e(s)},s.onRender=function(t,i){var e=this;this.txtName.string=t.name;var n=IS(m).GetPayGiftInfo(t.id);if(t.type==p.Custom){var o;this.nodeChoose.active=!0,this.rewardScroll.node.position=new d(-77,-11,0),this.scrollUt.width=220;var s=null!=(o=IS(m).GetCustomInfoList(t.id))?o:[],a=configCustom_mall.getDataByKey(t.id);this.rewardScroll.datas=a.regular_reward;for(var r=a.custom_reward,h=function(t){var i=r.find((function(i){return i[0]==t}));if(i){var n,o;e.chooseItems[t].node.active=!0;var a=null!=(n=null==(o=s.find((function(i){return i.k==t})))?void 0:o.v)?n:0,d=i[1].findIndex((function(t){return t[0]==a}));if(-1!=d){e.chooseItems[t].notSet.active=!1,e.chooseItems[t].itemGrid.node.active=!0;var h=i[1][d];e.chooseItems[t].itemGrid.SetItemId(h[0],h[1])}else e.chooseItems[t].notSet.active=!0,e.chooseItems[t].itemGrid.node.active=!1}else e.chooseItems[t].node.active=!1},c=1;c<=2;c++)h(c)}else this.nodeChoose.active=!1,this.rewardScroll.node.position=new d(-275,-11,0),this.scrollUt.width=420,this.rewardScroll.datas=t.reward;0==t.cost_level?(this.txtPrice.string=GetLanguage(200045),n&&2==n.rewardState?(this.out.active=!0,this.red.active=!1,this.btnBuy.active=!1,this.txtDesc.node.active=!1):(this.out.active=!1,this.red.active=!0,this.btnBuy.active=!0,this.txtDesc.node.active=!0,this.txtDesc.string=u.formatStrWithMirrorDeal(GetLanguage(200046),t.buy_times))):(this.red.active=!1,this.txtPrice.string=IS(m).GetPriceString(t.cost_level),0==t.buy_times?(this.out.active=!1,this.btnBuy.active=!0,this.txtDesc.node.active=!1):n&&n.bought_times?n.bought_times>=n.payCfg.buy_times?(this.out.active=!0,this.btnBuy.active=!1,this.txtDesc.node.active=!1):(this.out.active=!1,this.btnBuy.active=!0,this.txtDesc.node.active=!0,this.txtDesc.string=u.formatStrWithMirrorDeal(GetLanguage(200028),t.buy_times-n.bought_times,t.buy_times)):(this.out.active=!1,this.btnBuy.active=!0,this.txtDesc.node.active=!0,this.txtDesc.string=u.formatStrWithMirrorDeal(GetLanguage(200028),t.buy_times,t.buy_times)))},e}(c),w=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(i=t.call.apply(t,[this].concat(n))||this).itemGridNode=void 0,i.itemGrid=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){this.itemGridNode=f.findChild(this.node,"itemGrid"),this.itemGrid=new h(this.view,this.itemGridNode)},n.onRender=function(t,i){this.itemGrid.SetItemId(t[0],t[1])},e}(c);e._RF.pop()}}}));

