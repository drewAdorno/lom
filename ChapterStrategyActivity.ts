System.register("chunks:///_virtual/ChapterStrategyActivity.ts",["./rollupPluginModLoBabelHelpers.js","cc","./FixMath.ts","./EnumDefine.ts","./EventDefine.ts","./V2.ts","./BaseChapter.ts"],(function(t){"use strict";var e,i,r,n,a,s,h,o;return{setters:[function(t){e=t.inheritsLoose,i=t.createForOfIteratorHelperLoose},function(t){r=t.cclegacy},function(t){n=t.FixMath},function(t){a=t.TargetFilter},function(t){s=t.EventDefine},function(t){h=t.V2},function(t){o=t.BaseChapter}],execute:function(){r._RF.push({},"3c276vRzNpC/KXrf6r3PlNo","ChapterStrategyActivity",void 0);var c=new h;t("ChapterStrategyActivity",function(t){function r(){for(var e,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this).maxWave=0,e._curWave=0,e._curIndex=0,e._curMonster=void 0,e._waitNextWave=void 0,e._curTime=0,e._wavefreshtime=0,e}e(r,t);var h=r.prototype;return h.init=function(){},h.destroy=function(){},h.start=function(){this.start_wave()},h.toResult=function(t,e){},h.getConfig=function(t){return configStrategy_activity_chapter.getDataByKey(t)},h.updateTime=function(t){if(this.timeModel){if(this.chapterTime<=0)return this.over=!0,this.toResult(1,!0),!0;this.chapterTime=n.round(this.chapterTime-t),this.chapterTime=Math.max(this.chapterTime,0)}return!1},h.nextPart=function(t){this.setChapter(t),this.start_wave(),this.over=!1},h.start_wave=function(){this._curWave=0,this._curMonster=this.config["monster_refresh"+(this._curWave+1)],this.maxWave=5,this._curTime=0,this._waitNextWave=!1},h.checkPlayerDead=function(){return!!this.battleMain.mainCtr.player.isDead},h.onUpdate=function(t){if(!this.over){var e=this.battleMain;if(this.checkPlayerDead())return this.over=!0,void this.toResult(1);if(!this.updateTime(t))if(this._waitNextWave){var r=e.unitMgr.findTarget(e.mainCtr.player,a.Enemy);if(0==r.length||this._curTime<=0){if(0==r.length&&this._curWave>=this.maxWave-1)return this.over=!0,void this.toResult(0);this._curTime=0,this._waitNextWave=!1,this._curWave++;var h=this._curWave+1;this.battleMain.emit(s.WaveUpdate,h),this._curMonster=this.config["monster_refresh"+h],null==this._curMonster&&(printLogErr(this.config.id,"->关卡缺少刷怪配置！！！波数：",h),this.over=!0,this.toResult(0))}}else{if(this._curTime<=0){for(var o,u=this._curMonster[this._curIndex],f=u[0],v=this.addUnit(f,1),_=i(this.mapConfig.points);!(o=_()).done;){var d=o.value;if(d[0]===u[1]){v.position=c.set(d[1],d[2]).add2f(e.mapCamera.offsetX,0);break}}v.direction=-1,this.onAddMonster(v),this._curIndex++;var l=configStrategy_activity_chapter.getDataByKey(this.config.id);this._curTime=l.interval_in_wave[0],this._curIndex>=this._curMonster.length&&(this._waitNextWave=!0,this._curIndex=0,this._curTime=l.interval_between_wave[0])}this._curTime=n.round(this._curTime-t)}}},h.addUnit=function(t,e){return void 0===e&&(e=0),this.battleMain.unitMgr.addUnit(t,e)},h.onAddMonster=function(t){},r}(o));r._RF.pop()}}}));

