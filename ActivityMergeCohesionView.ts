System.register("chunks:///_virtual/ActivityMergeCohesionView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./RedPoint.ts","./RedPointMgr.ts","./NodeUtil.ts","./TimeUtil.ts","./index57.ts","./BagDefine.ts","./BagModel.ts","./MessageView.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./ActivityMergeServersControl.ts","./ActivityMergeServersDataCache.ts","./ActivityMergeServersDefine.ts","./V2.ts","./AudioMgr.ts","./BaseView.ts"],(function(t){"use strict";var i,e,n,s,o,a,r,d,h,c,f,u,l,v,m,p,g,C,y,T,w,I,S,G,L,x,_,A,M,P;return{setters:[function(t){i=t.inheritsLoose,e=t.createForOfIteratorHelperLoose},function(t){n=t.cclegacy,s=t.Layout,o=t.Label,a=t.Button,r=t.Vec2,d=t.ProgressBar,h=t.Sprite,c=t.ScrollView,f=t.js},function(t){u=t.ItemGrid},function(t){l=t.ListItem},function(t){v=t.RedPointType},function(t){m=t.RedPointMgr},function(t){p=t.default},function(t){g=t.default},null,function(t){C=t.BagEventDefine},function(t){y=t.BagModel},function(t){T=t.default},function(t){w=t.default},function(t){I=t.ActivityState,S=t.ActivityEventDefine,G=t.ActivityType},function(t){L=t.default},function(t){x=t.default},function(t){_=t.ActivityMergeServersEvent},function(t){A=t.V2},function(t){M=t.audioMgr},function(t){P=t.BaseView}],execute:function(){n._RF.push({},"82f73zNZNxCEofu3r2rulCw","ActivityMergeCohesionView",void 0);var R=1826,b=0,k=(t("default",function(t){function n(){var i;return(i=t.call(this)||this).txtLeftTime=void 0,i.leftTime=0,i.deltaTime=0,i.canUpdate=!1,i.actType=0,i.red=void 0,i.txtProgress=void 0,i.pbProgress=void 0,i.list=[],i.maxProcess=0,i.rewardScroll=void 0,i.imgCost=void 0,i.txtCost=void 0,i.name="ActivityMergeCohesionView",i.url="ui/module/activityMergeServers/ActivityMergeCohesionView",i.actType=G.MergeCohesion,i}i(n,t);var u=n.prototype;return u.onInit=function(){var t=this;this.dealMirrorLayout(this.findChildComponent("view/nodeTime",s)),this.txtLeftTime=this.findChildComponent("view/nodeTime/txtLeftTime",o);var i=this.findChild("view/btnClose");this.addComponentCallbackListener(i,a.EventType.CLICK,(function(){t.close()}));var e=this.findChild("view/btnTips");this.addComponentCallbackListener(e,a.EventType.CLICK,(function(){IS(w).ShowSysTips(t.actType)}));var n=this.findChild("view/btnTask");this.addRedPoint("merge_cohesion_task",n,new r(25,30),v.Dot),this.addComponentCallbackListener(n,a.EventType.CLICK,(function(){var i=IS(w).GetActivityInfo(t.actType);i&&i.state==I.Open?uiMgr.openView("ActivityMergeCohesionTaskView",t.actType):i&&i.state==I.Preview?T.showFlyTip(GetLanguage(200086)):T.showFlyTip(GetLanguage(200026))}));var f=this.findChild("view/btnRank");this.addComponentCallbackListener(f,a.EventType.CLICK,(function(){uiMgr.openView("ActivityMergeCohesionRankView",t.actType)}));var u=this.findChild("view/donate/btn");this.red=this.findChild("view/donate/btn/red"),this.addComponentCallbackListener(u,a.EventType.CLICK,(function(){IS(y).getGoodsCountByGoodsGtid(R)<=0?T.showFlyTip(GetLanguage(200069)):uiMgr.openView("ActivityMergeCohesionUseView",R)})),this.txtProgress=this.findChildComponent("view/progress/txtProgress",o),this.pbProgress=this.findChildComponent("view/progress/pb",d);for(var l=1;l<=6;l++){var m=new k;m.init(this.findChild("view/progress/progress/item"+l),this,l),this.list[l]=m}this.imgCost=this.findChildComponent("view/donate/cost/img",h),this.txtCost=this.findChildComponent("view/donate/cost/num",o),this.rewardScroll=this.addUIList(this.findChildComponent("view/donate/rewardScroll",c),U)},u.registerUpdateHandler=function(){this.addEvent(S.OnActivityInfoUpdate,this.updateActInfo,this),this.addEvent(C.GOODS_INFO_UPDATE,this.updateResShow,this),this.addEvent(_.OnCohesionInfoUpdate,this.updateInfo,this),this.addEvent(S.OnActivityInfoTaskUpdate,this.updateRed,this),this.addEvent(S.OnActivityInfoUpdate,this.updateRed,this)},u.onAfterOpen=function(){this.updateRed(),this.updateResShow(),IS(L).send_24_175(this.actType);var t=IS(w).GetActivityInfo(this.actType);if(t){var i,n=null!=(i=t.state_time[t.state])?i:t.state_time[I.Open];this.leftTime=n.end_time-g.serverTime,this.leftTime>0?(this.canUpdate=!0,this.txtLeftTime.string=f.formatStr("%s",g.formatTimeStringForSecond(this.leftTime))):this.txtLeftTime.string=GetLanguage(200026)}else this.txtLeftTime.string=GetLanguage(200026);var s=configGoods.getDataByKey(R);this.loadIcon(this.imgCost,s.icon_group,s.icon);var o=configGoods.getDataByKey(s.effect[0]).effect[0],a=configOutput.getDataByList("groupid",o);b=0;for(var r,d=e(a);!(r=d()).done;){var h=r.value;b+=h.prob}this.rewardScroll.datas=a;for(var c,u=configAct_cohesion_reward.getDatas(),l=[],v=e(u);!(c=v()).done;){var m=c.value;m.act_type==this.actType&&m.act_group==t.roundCfg.group_id&&(l.push(m),m.limit>this.maxProcess&&(this.maxProcess=m.limit))}l.sort((function(t,i){return t.limit-i.limit}));for(var p=1;p<=6;p++)this.list[p].show(l[p-1])},u.onBeforeClose=function(){this.canUpdate=!1},u.onDestroy=function(){},u.showEffect=function(){M.playSound("hefu_lipaozhanfang"),this.addUIEffect("prefab/ui-effect/MX_tx_julihuodong_lipao",this.node,2,new A(0,0),1)},u.updateResShow=function(){var t=IS(y).getGoodsCountByGoodsGtid(R);this.txtCost.string=t,this.red.active=t>0},u.onUpdate=function(t){this.canUpdate&&(this.deltaTime=this.deltaTime+t,this.deltaTime>=1&&(this.deltaTime=0,this.leftTime=this.leftTime-1,this.leftTime>0?this.txtLeftTime.string=f.formatStr("%s",g.formatTimeStringForSecond(this.leftTime)):(this.txtLeftTime.string=GetLanguage(200026),this.canUpdate=!1)))},u.updateActInfo=function(t){if(t.type==this.actType&&t.state!=I.Null){var i,e=null!=(i=t.state_time[t.state])?i:t.state_time[I.Open];this.leftTime=e.end_time-g.serverTime,this.leftTime>0?(this.canUpdate=!0,this.txtLeftTime.string=f.formatStr("%s",g.formatTimeStringForSecond(this.leftTime))):this.txtLeftTime.string=GetLanguage(200026)}},u.updateRed=function(){IS(m).changeValue("merge_cohesion_task",IS(w).GetTaskRedNum(this.actType))},u.updateInfo=function(){var t=IS(x).getCohesionInfo();this.txtProgress.string=String(t.process),this.pbProgress.progress=t.process/this.maxProcess;for(var i=1;i<=6;i++)this.list[i].updateInfo()},n}(P)),function(){function t(){this.view=void 0,this.node=void 0,this.index=void 0,this.data=void 0,this.itemGrid=void 0,this.canGet=void 0,this.txtProgress=void 0,this.mask=void 0}var i=t.prototype;return i.init=function(t,i,e){this.view=i,this.node=t,this.index=e,this.onInit()},i.onInit=function(){var t=this;this.txtProgress=p.findChildComponent(this.node,"txtProgress",o),this.canGet=p.findChild(this.node,"canGet"),this.mask=p.findChild(this.node,"mask"),this.view.loadIcon(p.findChildComponent(this.node,"mask/img",h),"common","common_ui_dagou"),this.itemGrid=new u(this.view,p.findChild(this.node,"itemGrid"),(function(){t.canGet.active?IS(L).send_24_176(t.view.actType,t.data.id):IS(y).OpenItemTips(t.data.reward[0][0],t.itemGrid.node)}))},i.show=function(t){t&&(this.data=t,this.itemGrid.SetItemId(t.reward[0][0],t.reward[0][1]),this.txtProgress.string=t.limit)},i.updateInfo=function(){if(this.data){var t=IS(x).getCohesionInfo();t.got_reward.includes(this.data.id)?(this.mask.active=!0,this.canGet.active=!1):(this.mask.active=!1,this.canGet.active=t.process>=this.data.limit)}},t}()),U=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return(i=t.call.apply(t,[this].concat(n))||this).itemGridNode=void 0,i.itemGrid=void 0,i.txtRatio=void 0,i.line=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){this.txtRatio=p.findChildComponent(this.node,"ratio",o),this.line=p.findChild(this.node,"line"),this.itemGridNode=p.findChild(this.node,"itemGrid"),this.itemGrid=new u(this.view,this.itemGridNode)},n.onRender=function(t,i){this.line.active=i%3==0,this.itemGrid.SetItemId(t.item[0],t.item[1]),this.txtRatio.string=f.formatStr("%s%",(t.prob/b*100).toFixed(2))},e}(l);n._RF.pop()}}}));

