System.register("chunks:///_virtual/ActivityStrategyRoleJobView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./RedPoint.ts","./RedPointMgr.ts","./NodeUtil.ts","./StringUtil.ts","./index57.ts","./ItemIcon.ts","./ConfigGlobal.ts","./ObjectUtil.ts","./BagModel.ts","./MessageView.ts","./RoleDataCache.ts","./RoleDefine.ts","./ActivityDefine.ts","./ActivityStrategyControl.ts","./ActivityStrategyDataCache.ts","./BaseView.ts"],(function(t){"use strict";var i,e,o,n,s,a,l,c,d,r,h,v,f,m,p,b,g,u,C,y,k,I,S,L,w;return{setters:[function(t){i=t.inheritsLoose},function(t){e=t.cclegacy,o=t.Button,n=t.RichText,s=t.Vec2,a=t.Label,l=t.Sprite,c=t.ProgressBar,d=t.js},function(t){r=t.RedPointType},function(t){h=t.RedPointMgr},function(t){v=t.default},function(t){f=t.default},null,function(t){m=t.IconAseetType},function(t){p=t.ConfigGlobal},function(t){b=t.default},function(t){g=t.BagModel},function(t){u=t.default},function(t){C=t.RoleDataCache},function(t){y=t.PlayerAttr},function(t){k=t.ActivityEventDefine,I=t.ActivityType},function(t){S=t.default},function(t){L=t.default},function(t){w=t.BaseView}],execute:function(){e._RF.push({},"ac519zaqxVEBLyD3Sziiozx","ActivityStrategyRoleJobView",void 0);t("default",function(t){function e(){var i;return(i=t.call(this)||this).txtTips=void 0,i.btnJob=void 0,i.btnReset=void 0,i.btnAwake=void 0,i.jobInfo=void 0,i.isJobLimit=!1,i.name="ActivityStrategyRoleJobView",i.url="ui/module/ActivityStrategy/ActivityStrategyRoleJobView",i}i(e,t);var a=e.prototype;return a.onInit=function(){var t=this,i=this.findChild("imgMask");this.addComponentCallbackListener(i,o.EventType.CLICK,(function(){t.close()})),this.txtTips=this.findChildComponent("tips",n),this.jobInfo=new _,this.jobInfo.init(this.findChild("JobInfoPanel"),this),this.btnJob=this.findChild("bottom/btnJob"),this.addRedPoint("ActivityStrategy/changeJob",this.btnJob,new s(90,25),r.Dot),IS(h).updateRed("ActivityStrategy/changeJob"),this.addComponentCallbackListener(this.btnJob,o.EventType.CLICK,(function(){t.onJobClick()})),this.btnReset=this.findChild("bottom/btnReset"),this.addComponentCallbackListener(this.btnReset,o.EventType.CLICK,(function(){t.onResetClick()})),this.btnAwake=this.findChild("bottom/btnAwake"),this.addComponentCallbackListener(this.btnAwake,o.EventType.CLICK,(function(){t.onAwakeClick()}));var e=this.findChild("btnPreview");this.addComponentCallbackListener(e,o.EventType.CLICK,(function(){t.onPreviewClick()}));var a=this.findChild("btnClose");this.addComponentCallbackListener(a,o.EventType.CLICK,(function(){t.close()}))},a.registerUpdateHandler=function(){this.addEvent(k.OnStrategyJobUpdate,this.updateInfo,this)},a.onAfterOpen=function(){IS(h).updateRed("ActivityStrategy/changeJob"),this.updateInfo()},a.onBeforeClose=function(){},a.onDestroy=function(){},a.onJobClick=function(){this.isJobLimit?u.showFlyTip(GetLanguage(200106)):uiMgr.openView("JobSelectView_4",I.Strategy)},a.onAwakeClick=function(){this.isJobLimit?u.showFlyTip(GetLanguage(200106)):uiMgr.openView("JobSelectView_3")},a.onResetClick=function(){var t=p.strategy_activity_reset_job_cost,i=IS(g).getGoodsCountByGoodsGtid(t[0][0]);uiMgr.openView("ActivityStrategyConfirmView",{desc1:GetLanguage(999000608),num:t[0][1],goodsId:1038,cb:function(e){1==e&&(i>=t[0][1]?IS(S).reqActStrategyTabJob(0):u.showFlyTip(GetLanguage(200108)))}})},a.onPreviewClick=function(){uiMgr.openView("JobTreeView")},a.updateInfo=function(){var t=IS(L).job,i=IS(L).level,e=p.transfer_job_level,o=IS(C).GetRoleAttr(y.ROLE_ATTR_GENDER),n=configJobs.getDataByKey(t).change_times;n>=5&&2==o?this.jobInfo.show(t,!0):this.jobInfo.show(t,!1);var s=e[n];(null==s||n>=5)&&(s=p.jobs_wakeup_condition),this.isJobLimit=i<s;var a=this.isJobLimit?"#e76262":"#5ACF97";n<5?(this.txtTips.node.active=!0,this.txtTips.string=f.formatStrWithMirrorDeal(GetLanguage(200109),s,a,i,s)):this.txtTips.node.active=!1,this.btnJob.active=n<=5,this.btnReset.active=n>0},e}(w));var _=t("JobInfoPanel",function(){function t(){this.view=void 0,this.node=void 0,this.job=void 0,this.txtJobName=void 0,this.txtWeaponName=void 0,this.txtPos=void 0,this.txtJobDesc=void 0,this.activeSkillName=void 0,this.activeSkillDesc=void 0,this.passiveList=[],this.txtLevel=void 0,this.txtExperience=void 0,this.pbExperience=void 0,this.imgFrame=void 0,this.imgIcon=void 0,this.imgJob=void 0}var i=t.prototype;return i.init=function(t,i){this.view=i,this.node=t,this.onInit()},i.onInit=function(){var t=this;this.txtJobName=v.findChildComponent(this.node,"desc/name",a),this.txtWeaponName=v.findChildComponent(this.node,"desc/weapon",a),this.txtPos=v.findChildComponent(this.node,"desc/pos",a),this.txtJobDesc=v.findChildComponent(this.node,"desc/desc",a),this.imgFrame=v.findChildComponent(this.node,"skill/active/frame",l),this.imgIcon=v.findChildComponent(this.node,"skill/active/frame/icon",l),this.activeSkillName=v.findChildComponent(this.node,"skill/active/name",a),this.activeSkillDesc=v.findChildComponent(this.node,"skill/active/desc/view/desc",n),this.imgJob=v.findChildComponent(this.node,"role/imgJob",l),this.txtLevel=v.findChildComponent(this.node,"role/levelRoot/txtLevel",a),this.txtExperience=v.findChildComponent(this.node,"role/levelRoot/txtProgress",a),this.pbExperience=v.findChildComponent(this.node,"role/levelRoot/pbExperience",c);for(var i=p.job_passive_skill,e=function(e){var n=v.findChild(t.node,d.formatStr("skill/passive/item%s",e+1)),s={node:n,frame:v.findChildComponent(n,"frame",l),icon:v.findChildComponent(n,"frame/icon",l),txtLev:v.findChildComponent(n,"lev",a),mask:v.findChild(n,"mask"),levLimit:0,skillId:0,skillLev:0};t.view.addComponentCallbackListener(n,o.EventType.CLICK,(function(){if(0==s.skillId)u.showFlyTip(f.formatStrWithMirrorDeal(GetLanguage(200110),i[e]));else{var t=configSkill_level.getDataByKeys("id",s.skillId,"level",s.skillLev);uiMgr.openView("JobSkillTipsView",f.formatStr.apply(f,[t.desc].concat(t.desc_parm)),s.node)}})),t.passiveList.push(s)},s=0;s<5;s++)e(s)},i.show=function(t,i){this.job=t;var e=configJobs.getDataByKey(t);this.txtJobName.string=e.name,this.txtWeaponName.string=e.arms_name,this.txtPos.string=e.job_pos,this.txtJobDesc.string=f.formatStrWithMirrorDeal(GetLanguage(200111),e.desc),i?(this.view.loadIcon(this.imgJob,"icon_job",d.formatStr("job_%s_2",this.job),null,m.ICON_SPRITE),this.imgJob.node.setPosition(e.position[2],e.position[3]-70,0)):(this.view.loadIcon(this.imgJob,"icon_job",d.formatStr("job_%s",this.job),null,m.ICON_SPRITE),this.imgJob.node.setPosition(e.position[0],e.position[1]-70,0)),this.imgJob.node.setScale(e.scale,e.scale,e.scale);var o=configSkill.getDataByKey(e.skill[0][1][0]),n=IS(L).level,s=configSkill_level.getDataByKeys("id",o.id,"level",n);this.activeSkillName.string=o.name,this.activeSkillDesc.string=d.formatStr("<b><color=#304231>%s</color></b>",f.formatStr.apply(f,[s.desc].concat(s.desc_parm))),this.view.loadIcon(this.imgFrame,"icon_skill",d.formatStr("common_ICON_jinengkuang0%s",o.quality)),this.view.loadIcon(this.imgIcon,"icon_skill",o.icon);for(var a=0;a<5;a++){var l=this.passiveList[a];if(a<e.passive_skill.length){l.levLimit=e.passive_skill[a][0],l.skillId=e.passive_skill[a][1][0],l.skillLev=e.passive_skill[a][1][1];var c=configSkill.getDataByKey(l.skillId);l.icon.node.active=!0,this.view.loadIcon(l.frame,"icon_skill",d.formatStr("common_ICON_jinengkuang0%s",c.quality)),this.view.loadIcon(l.icon,"icon_skill",c.icon,null,m.ICON_SPRITE),l.txtLev.string=d.formatStr("Lv.%s",l.levLimit),n<l.levLimit?(l.mask.active=!0,l.txtLev.node.active=!0):(l.mask.active=!1,l.txtLev.node.active=!1)}else l.levLimit=0,l.skillId=0,l.skillLev=0,this.view.loadIcon(l.frame,"icon_skill","common_ICON_jinengwenhao"),l.icon.node.active=!1,l.mask.active=!0,l.txtLev.node.active=!1}var r=IS(L).level,h=r+1,v=configLevel.getDataByKey(h);b.isEmpty(v),this.txtLevel.string=String(r)},t}());e._RF.pop()}}}));

