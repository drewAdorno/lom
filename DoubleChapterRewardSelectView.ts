System.register("chunks:///_virtual/DoubleChapterRewardSelectView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./index57.ts","./ObjectUtil.ts","./ChapterDataCache.ts","./ChapterDefine.ts","./DungeonControl.ts","./BaseView.ts"],(function(t){"use strict";var e,i,n,o,l,r,c,a,s,d,h,u,f,m,v,I,k,S;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,n=t.Button,o=t.ScrollView,l=t.RichText,r=t.Layout,c=t.Label,a=t.js},function(t){s=t.ItemGrid},function(t){d=t.SelectedType,h=t.ListItem},function(t){u=t.default},function(t){f=t.default},null,function(t){m=t.default},function(t){v=t.ChapterDataCache},function(t){I=t.ChapterEventDefine},function(t){k=t.default},function(t){S=t.BaseView}],execute:function(){i._RF.push({},"602e0c7+QxD7qA905YSQkz1","DoubleChapterRewardSelectView",void 0);t("default",function(t){function i(){var e;return(e=t.call(this)||this).chooseScroll=void 0,e.txtSelectNum=void 0,e.curSelectList=void 0,e.unlockItemList=void 0,e.lockItemList=void 0,e.nodeUnlockItem=void 0,e.nodeUnlockContent=void 0,e.nodeLockItem=void 0,e.nodeLockContent=void 0,e.nodeLock=void 0,e.txtCondition=void 0,e.name="DoubleChapterRewardSelectView",e.url="ui/module/dungeon/DoubleChapterRewardSelectView",e}e(i,t);var h=i.prototype;return h.onInit=function(){var t=this,e=this.findChild("imgMask");this.addComponentCallbackListener(e,n.EventType.CLICK,(function(){t.close()}));var i=this.findChild("view/btnCancel");this.addComponentCallbackListener(i,n.EventType.CLICK,(function(){t.close()}));var a=this.findChild("view/btnSave");this.addComponentCallbackListener(a,n.EventType.CLICK,(function(){IS(k).reqDoubleChangeOptionalReward(t.curSelectList),t.close()}));var s=this.findChildComponent("view/chooseScroll",o);this.chooseScroll=this.addUIList(s,L),this.chooseScroll.selectedMode=d.SINGLE,this.txtSelectNum=this.findChildComponent("view/common_ui_xiaotidi/txtName/txtNum",l),this.dealMirrorLayout(this.findChildComponent("view/common_ui_xiaotidi",r)),this.nodeUnlockItem=this.findChild("view/rewardScroll/view/content/content/item"),this.nodeUnlockItem.active=!1,this.nodeUnlockContent=this.findChild("view/rewardScroll/view/content/content"),this.nodeLockItem=this.findChild("view/rewardScroll/view/content/lock/content/item"),this.nodeLockItem.active=!1,this.nodeLockContent=this.findChild("view/rewardScroll/view/content/lock/content"),this.nodeLock=this.findChild("view/rewardScroll/view/content/lock"),this.txtCondition=this.findChildComponent("view/rewardScroll/view/content/lock/condition/txtCondition",c)},h.registerUpdateHandler=function(){this.addEvent(I.DOUBLE_CHAPTER_REWARD_UNSELECT,this.onDoubleChapterRewardUnSelect,this)},h.onAfterOpen=function(){this.curSelectList=IS(v).doubleChapterEntraceInfo?m.clone(IS(v).doubleChapterEntraceInfo.choose_reward_list):new Array;var t=IS(v).doubleChapterEntraceInfo?IS(v).doubleChapterEntraceInfo.max_reward_num:0;null==t&&(t=0);for(var e=new Array,i=0;i<t;i++)e.push(i);this.chooseScroll.datas=e,this.showUnlockItems(),this.updateUnlockItems(),this.tryShowLockItems(),this.updateSelectNum()},h.showUnlockItems=function(){var t=IS(v).doubleChapterInfo?IS(v).doubleChapterInfo.max_dc_level:1;null==t&&(t=1);for(var e=configDouble_ladder_chapter.getDatas(),i=new Array,n=0;n<e.length;n++){var o=e[n];if(o.id<=t&&null!=o.final_reward_unlock)for(var l=0;l<o.final_reward_unlock.length;l++)i.push({chapter:o.id,level:o.chapter,index:l+1,reward:o.final_reward_unlock[l]})}i.sort((function(t,e){return t.chapter!=e.chapter?e.chapter-t.chapter:t.index-e.index})),null==this.unlockItemList&&(this.unlockItemList=new Array);for(var r=0;r<i.length;r++){var c=this.unlockItemList[r]||this.newUnlockItem();c.itemInfo=i[r],c.itemGrid.SetItemId(i[r].reward[0],i[r].reward[1]),c.node.active=!0,this.unlockItemList[r]=c}for(var a=i.length;a<this.unlockItemList.length;a++)this.unlockItemList[a].node.active=!1},h.newUnlockItem=function(){var t=this,e=nodeInstantiate.instantiate(this.nodeUnlockItem);e.parent=this.nodeUnlockContent;var i={node:e,nodeSelect:u.findChild(e,"choose"),nodeItemGrid:u.findChild(e,"itemGrid"),itemGrid:null,itemInfo:null};return i.itemGrid=new s(this,i.nodeItemGrid,(function(){t.onClickUnlcokItem(i.itemInfo)})),i},h.checkItemSelect=function(t,e){if(null==this.curSelectList||this.curSelectList.length<=0)return[!1,0];for(var i=0;i<this.curSelectList.length;i++)if(this.curSelectList[i].k==t&&this.curSelectList[i].v==e)return[!0,i];return[!1,0]},h.onClickUnlcokItem=function(t){var e=this.checkItemSelect(t.level,t.index);if(1!=e[0]){var i=IS(v).doubleChapterEntraceInfo?IS(v).doubleChapterEntraceInfo.max_reward_num:0;null==i&&(i=0),(null!=this.curSelectList?this.curSelectList.length:0)>=i||(this.curSelectList.push({k:t.level,v:t.index}),this.updateSelect())}else this.onDoubleChapterRewardUnSelect(e[1])},h.tryShowLockItems=function(){var t=IS(v).doubleChapterInfo?IS(v).doubleChapterInfo.max_dc_level:1;null==t&&(t=1);for(var e,i=configDouble_ladder_chapter.getDatas(),n=new Array,o=0;o<i.length;o++){var l=i[o];if(l.id>t&&null!=l.final_reward_unlock&&l.final_reward_unlock.length>0){for(var r=0;r<l.final_reward_unlock.length;r++)n.push({chapter:l.id,level:l.chapter,index:r+1,reward:l.final_reward_unlock[r]});e=l.chapter;break}}if(this.nodeLock.active=null!=e,null!=e){this.txtCondition.string=f.formatStrWithMirrorDeal(GetLanguage(204858),e),null==this.lockItemList&&(this.lockItemList=new Array);for(var c=0;c<n.length;c++){var a=this.lockItemList[c]||this.newLockItem();a.itemGrid.SetItemId(n[c].reward[0],n[c].reward[1]),a.node.active=!0,this.lockItemList[c]=a}for(var s=n.length;s<this.lockItemList.length;s++)this.lockItemList[s].node.active=!1}},h.updateUnlockItems=function(){if(this.unlockItemList)for(var t=0;t<this.unlockItemList.length;t++){var e=this.unlockItemList[t],i=this.checkItemSelect(e.itemInfo.level,e.itemInfo.index);e.nodeSelect.active=1==i[0]}},h.newLockItem=function(){var t=nodeInstantiate.instantiate(this.nodeLockItem);return t.parent=this.nodeLockContent,{node:t,itemGrid:new s(this,u.findChild(t,"itemGrid"))}},h.updateSelect=function(){this.updateUnlockItems(),this.chooseScroll.updateAll(),this.updateSelectNum()},h.updateSelectNum=function(){var t=IS(v).doubleChapterEntraceInfo?IS(v).doubleChapterEntraceInfo.max_reward_num:0;null==t&&(t=0);var e=null!=this.curSelectList?this.curSelectList.length:0,i=e>=t?"#e53b3b":"#544231";this.txtSelectNum.string=a.formatStr("<b><color=%s>%s</color><color = #544231>/%s</color></b>",i,e,t)},h.onBeforeClose=function(){if(this.curSelectList=null,this.unlockItemList)for(var t=0;t<this.unlockItemList.length;t++)this.unlockItemList[t].node.active=!1;if(this.lockItemList)for(var e=0;e<this.lockItemList.length;e++)this.lockItemList[e].node.active=!1},h.onDestroy=function(){if(this.unlockItemList)for(var t=0;t<this.unlockItemList.length;t++)this.unlockItemList[t].node.destroy();if(this.lockItemList=null,this.lockItemList)for(var e=0;e<this.lockItemList.length;e++)this.lockItemList[e].node.destroy();this.lockItemList=null},h.onDoubleChapterRewardUnSelect=function(t){this.curSelectList.splice(t,1),this.updateSelect()},i}(S));var L=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).notSet=void 0,e.itemGrid=void 0,e}e(i,t);var n=i.prototype;return n.onInit=function(){this.notSet=u.findChild(this.node,"notSet"),this.itemGrid=new s(this.view,u.findChild(this.node,"itemGrid"))},n.onRender=function(t,e){var i=this.view.curSelectList[t];if(this.notSet.active=null==i,this.itemGrid.node.active=null!=i,null!=i){for(var n,o=i.k,l=0;l<configDouble_ladder_chapter.getDatas().length;l++){var r=configDouble_ladder_chapter.getDatas()[l];if(r.chapter==o&&r.final_reward_unlock&&r.final_reward_unlock.length>0){n=r;break}}var c=n.final_reward_unlock[i.v-1];this.itemGrid.SetItemId(c[0],c[1])}},n.onItemClick=function(){null!=this.view.curSelectList[this.data]&&normalEvent.emit(I.DOUBLE_CHAPTER_REWARD_UNSELECT,this.data)},i}(h);i._RF.pop()}}}));

