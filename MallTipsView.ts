System.register("chunks:///_virtual/MallTipsView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./StringUtil.ts","./index57.ts","./BagModel.ts","./MessageView.ts","./MallControl.ts","./MallDataCache.ts","./BaseView.ts"],(function(t){"use strict";var i,n,e,s,o,a,d,h,u,l,r,c,m,f,C;return{setters:[function(t){i=t.inheritsLoose},function(t){n=t.cclegacy,e=t.Button,s=t.Label,o=t.RichText,a=t.Sprite,d=t.EditBox,h=t.js},function(t){u=t.ItemGrid},function(t){l=t.default},null,function(t){r=t.BagModel},function(t){c=t.default},function(t){m=t.default},function(t){f=t.default},function(t){C=t.BaseView}],execute:function(){n._RF.push({},"41e07BHA1hMDauel1n0lI3l","MallTipsView",void 0);t("default",function(t){function n(){var i;return(i=t.call(this)||this).txtPrice=void 0,i.editBox=void 0,i.itemGrid=void 0,i.priceIcon=void 0,i.txtName=void 0,i.data=void 0,i.buyNum=1,i.limitNum=0,i.maxEditNum=10,i.txtAddTen=void 0,i.txtMinusTen=void 0,i.name="MallTipsView",i.url="ui/module/shop/MallTipsView",i}i(n,t);var C=n.prototype;return C.onInit=function(){var t=this,i=this.findChild("imgMask");this.addComponentCallbackListener(i,e.EventType.CLICK,(function(){t.onCloseClick()})),this.itemGrid=new u(this,this.findChild("item/itemGrid")),this.txtName=this.findChildComponent("item/txtName",s),this.txtPrice=this.findChildComponent("price",o),this.priceIcon=this.findChildComponent("price/imgIcon",a),this.editBox=this.findChildComponent("EditBox",d),this.addComponentCallbackListener(this.editBox.node,d.EventType.EDITING_DID_ENDED,(function(){var i=Number(t.editBox.string);(isNaN(i)||i<=1)&&(i=1),t.buyNum=Math.floor(i),t.changeNum()}));var n=this.findChild("btnBuy");this.addComponentCallbackListener(n,e.EventType.CLICK,(function(){t.BuyClick()}));var h=this.findChild("btnAdd");this.addComponentCallbackListener(h,e.EventType.CLICK,(function(){t.changeNum(1)}));var l=this.findChild("btnMinus");this.addComponentCallbackListener(l,e.EventType.CLICK,(function(){t.changeNum(-1)}));var r=this.findChild("btnAddTen");this.addComponentCallbackListener(r,e.EventType.CLICK,(function(){t.changeNum(t.maxEditNum)})),this.txtAddTen=this.findChildComponent("btnAddTen/Label",s);var c=this.findChild("btnMinusTen");this.addComponentCallbackListener(c,e.EventType.CLICK,(function(){t.changeNum(-t.maxEditNum)})),this.txtMinusTen=this.findChildComponent("btnMinusTen/Label",s)},C.onCloseClick=function(){this.close()},C.registerUpdateHandler=function(){},C.onAfterOpen=function(){this.data=this.openArgs[0],this.buyNum=1;var t=this.data.goods[0],i=configGoods.getDataByKey(t),n=i.quality;configColor.getDataByKey(n);this.txtName.string=i.name,this.itemGrid.SetItemId(this.data.goods[0],this.data.goods[1]);var e=configGoods.getDataByKey(this.data.price[0]);if(this.loadIcon(this.priceIcon,e.icon_group,e.icon),-1==this.data.limit)this.limitNum=0;else{this.limitNum=this.data.limit;var s=IS(f).GetBuyInfoByType(this.data.type);s[this.data.id]&&(this.limitNum=this.data.limit-s[this.data.id])}this.maxEditNum=null!=this.openArgs[1]?this.openArgs[1]:10,this.txtMinusTen.string=h.formatStr("-%s",this.maxEditNum),this.txtAddTen.string=h.formatStr("+%s",this.maxEditNum),this.changeNum()},C.onBeforeClose=function(){},C.onDestroy=function(){},C.BuyClick=function(){for(var t=this.data.price[0],i=IS(r).getGoodsCountByGoodsGtid(t),n=0,e=0;e<this.buyNum;e++)n+=IS(f).getFactPrice(this.data.id,e);if(i>=n)IS(m).send_27_2(this.data.type,this.data.id,this.buyNum),this.close();else{var s=configGoods.getDataByKey(t);c.showFlyTip(l.formatStrWithMirrorDeal(GetLanguage(200453),s.name))}},C.changeNum=function(t){null!=t&&(this.buyNum=this.buyNum+t);var i=0!=this.limitNum?this.limitNum:999999;this.buyNum=Math.min(i,Math.max(this.buyNum,1)),this.editBox.string=String(this.buyNum);for(var n=IS(r).getGoodsCountByGoodsGtid(this.data.price[0]),e=(IS(f).getFactPrice(this.data.id),0),s=0;s<this.buyNum;s++)e+=IS(f).getFactPrice(this.data.id,s);var o="#2dc05a";n<e&&(o="#DB0C0C"),this.txtPrice.string=h.formatStr("<b><color=%s>%s</color></b>",o,e)},n}(C));n._RF.pop()}}}));

