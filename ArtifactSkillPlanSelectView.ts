System.register("chunks:///_virtual/ArtifactSkillPlanSelectView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./index57.ts","./ItemIcon.ts","./ArtifactDataCache.ts","./RoleControl.ts","./RoleDataCache.ts","./RoleDefine.ts","./BaseView.ts"],(function(t){"use strict";var i,e,n,s,l,o,a,c,r,h,f,d,k,S,u,v,I,m,g,C,_,p;return{setters:[function(t){i=t.inheritsLoose,e=t.createForOfIteratorHelperLoose},function(t){n=t.cclegacy,s=t.Button,l=t.UITransform,o=t.Node,a=t.ScrollView,c=t.Label,r=t.Layout,h=t.Overflow,f=t.Sprite,d=t.js},function(t){k=t.SelectedType,S=t.ListItem},function(t){u=t.default},function(t){v=t.default},null,function(t){I=t.IconAseetType},function(t){m=t.ArtifactDataCache},function(t){g=t.default},function(t){C=t.RoleDataCache},function(t){_=t.RoleEventDefine},function(t){p=t.BaseView}],execute:function(){n._RF.push({},"1bed1+nwhtDTYXHWYpL/23n","ArtifactSkillPlanSelectView",void 0);t("default",function(t){function n(){var i;return(i=t.call(this)||this).btnUseSkill=void 0,i.btnNoUseSkill=void 0,i.curPlan=void 0,i.skinIDSel=void 0,i.curPlanSkillId=void 0,i.ArtifactUIList=void 0,i.actifactInfo=[],i.txtName=void 0,i.name="ArtifactSkillPlanSelectView",i.url="ui/module/role/ArtifactSkillPlanSelectView",i}i(n,t);var S=n.prototype;return S.onInit=function(){var t=this,i=this.findChild("imgMask");this.addComponentCallbackListener(i,s.EventType.CLICK,(function(){t.onCloseClick()})),this.btnUseSkill=this.findChild("content/nodeSkill/btnUse"),this.addComponentCallbackListener(this.btnUseSkill,s.EventType.CLICK,(function(){IS(g).send_role_update_plan_c2s(t.curPlan,[{k:8,v:t.skinIDSel}])})),this.btnNoUseSkill=this.findChild("content/nodeSkill/btnNoUse"),this.addComponentCallbackListener(this.btnNoUseSkill,s.EventType.CLICK,(function(){IS(g).send_role_update_plan_c2s(t.curPlan,[{k:8,v:0}])}));var e=this.findChild("content/nodeSkill/ScrollView/view/content/item"),n=this.findChildComponent("content/nodeSkill/ScrollView/view/content",l);e.on(o.EventType.SIZE_CHANGED,(function(){n.height=e.getComponent(l).height}));var h=this.findChildComponent("content/nodeSelect/ScrollView",a);this.ArtifactUIList=this.addUIList(h,y),this.ArtifactUIList.selectedMode=k.SINGLE,this.txtName=this.findChildComponent("content/nodeSkill/common_ui_xiaotidi/txtName-001",c),this.refreshTxtMirrorByLayout(this.findChildComponent("content/nodeSkill/common_ui_xiaotidi",r))},S.onCloseClick=function(){this.close()},S.registerUpdateHandler=function(){this.addEvent(_.PLAN_ARTIFACT_SKIN_EFFECT_SEL,this.onRefreshArtifactSel,this),this.addEvent(_.PLAN_INFO_UPDATE,this.onPlanInfoUpdate,this)},S.onAfterOpen=function(){var t=this;this.txtName.schedule((function(){var i=t.txtName.node.getComponent(l);i.width>=368?(t.txtName.overflow=h.SHRINK,i.width=368):t.txtName.overflow=h.NONE}),0),this.curPlan=this.openArgs[0],this.rebuildArtifactList(),this.skinIDSel=this.actifactInfo[0].skin,this.refreshAll()},S.refreshAll=function(){this.refreshArtifactShow(),this.refreshArtifactSkill(),this.refreshUseSkillBtn()},S.refreshArtifactShow=function(){var t=this.rebuildArtifactList();this.ArtifactUIList.datas=this.actifactInfo,this.ArtifactUIList.scrollTo(t)},S.onRefreshArtifactSel=function(t){this.skinIDSel!=t&&(this.skinIDSel=t,this.refreshAll())},S.onPlanInfoUpdate=function(t){t==this.curPlan&&this.refreshAll()},S.rebuildArtifactList=function(){var t=configArtifact_skin.getDataByList("skin_level",0),i=0;this.actifactInfo=[];for(var n,s=e(t.entries());!(n=s()).done;){var l=n.value,o=(l[0],l[1]);if(IS(m).checkArtifactCanShow(o.artifact_id)){var a=IS(m).getSkinLevelByID(o.artifact_id);this.actifactInfo.push({skin:o.artifact_id,level:a,state:IS(m).getArtifactState(o.artifact_id)})}}this.actifactInfo.sort((function(t,i){return t.state>i.state?-1:1}));for(var c,r=e(this.actifactInfo.entries());!(c=r()).done;){var h=c.value,f=h[0];h[1].skin==this.skinIDSel&&(i=f)}return i},S.refreshArtifactSkill=function(){var t=this.findChildComponent("content/nodeSkill/Frame",f),i=this.findChildComponent("content/nodeSkill/Icon",f),e=this.findChildComponent("content/nodeSkill/txtName",c),n=this.findChildComponent("content/nodeSkill/ScrollView/view/content/item",c),s=configArtifact_skin.getDataByKeys("artifact_id",this.skinIDSel,"skin_level",IS(m).getSkinLevelByID(this.skinIDSel));0==s.skin_skill.length&&(s=configArtifact_skin.getDataByKeys("artifact_id",this.skinIDSel,"skin_level",IS(m).getSkinLevelByID(this.skinIDSel)+1));var l=configSkill.getDataByKey(s.skin_skill[0][0]);this.loadIcon(t,"icon_skill",d.formatStr("common_ICON_jinengkuang0%s",l.quality)),this.loadIcon(i,"icon_skill",l.icon,null,I.ICON_SPRITE),e.string=l.name;var o=configSkill_level.getDataByKeys("id",s.skin_skill[0][0],"level",s.skin_skill[0][1]);n.string=v.formatStr.apply(v,[o.desc].concat(o.desc_parm))},S.refreshUseSkillBtn=function(){var t=IS(C).planIdToInfo[this.curPlan].detail;this.curPlanSkillId=0;for(var i=0;i<t.length;i++)8==t[i].k&&(this.curPlanSkillId=t[i].v);if(IS(m).getSkinLevelByID(this.skinIDSel)<=0)return this.btnUseSkill.active=!1,void(this.btnNoUseSkill.active=!1);this.btnUseSkill.active=this.curPlanSkillId!=this.skinIDSel,this.btnNoUseSkill.active=this.curPlanSkillId==this.skinIDSel},S.onBeforeClose=function(){},S.onDestroy=function(){},n}(p));var y=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return(i=t.call.apply(t,[this].concat(n))||this).imgFrame=void 0,i.imgIcon=void 0,i.imgLock=void 0,i.nodeUse=void 0,i.nodeSel=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){this.imgFrame=u.findChildComponent(this.node,"frame",f),this.imgIcon=u.findChildComponent(this.node,"icon",f),this.imgLock=u.findChild(this.node,"lock"),this.nodeUse=u.findChild(this.node,"nodeUse"),this.nodeSel=u.findChild(this.node,"sel")},n.onRender=function(t,i){this.data=t;var e=configArtifact.getDataByKey(this.data.skin).icon_small,n=configArtifact.getDataByKey(this.data.skin).quality,s=configColor.getDataByKey(n).path;this.view.loadIcon(this.imgFrame,"icon_equip",s),this.view.loadIcon(this.imgIcon,"icon_item",e),this.checkState();var l=this.view;this.nodeSel.active=l.skinIDSel==this.data.skin},n.checkState=function(){this.imgLock.active=!1,this.imgFrame.grayscale=!1,this.imgIcon.grayscale=!1,this.nodeUse.active=!1,1==this.data.state&&(this.imgLock.active=!0,this.imgFrame.grayscale=!0,this.imgIcon.grayscale=!0);var t=configArtifact_skin.getDataByKeys("artifact_id",this.data.skin,"skin_level",IS(m).getSkinLevelByID(this.data.skin));0==t.skin_skill.length&&(t=configArtifact_skin.getDataByKeys("artifact_id",this.data.skin,"skin_level",IS(m).getSkinLevelByID(this.data.skin)+1));var i=this.view;this.nodeUse.active=this.data.skin==i.curPlanSkillId},n.onItemClick=function(){normalEvent.emit(_.PLAN_ARTIFACT_SKIN_EFFECT_SEL,this.data.skin)},e}(S);n._RF.pop()}}}));

