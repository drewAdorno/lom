System.register("chunks:///_virtual/RelicDataCache.ts",["cc","./RedPointMgr.ts","./index57.ts","./ObjectUtil.ts","./BagModel.ts","./RoleDataCache.ts","./RoleDefine.ts","./RelicDefine.ts","./RelicModel.ts","./UIDefine.ts"],(function(t){"use strict";var e,i,n,o,c,l,a,u,d,r;return{setters:[function(t){e=t.cclegacy},function(t){i=t.RedPointMgr},null,function(t){n=t.default},function(t){o=t.BagModel},function(t){c=t.RoleDataCache},function(t){l=t.RoleEventDefine,a=t.PlayerAttr},function(t){u=t.RelicEventDefine},function(t){d=t.RelicModel},function(t){r=t.OpenFunction}],execute:function(){e._RF.push({},"45d53dD/B1HvIkG7u3Ji+1e","RelicDataCache",void 0);t("RelicDataCache",function(){var t=e.prototype;function e(){this.relicIdToInfo=void 0,this.typeToUnlock=void 0,this.findCount=void 0,this.typeToCfgIds=void 0,this.maxRelicCount=void 0,this.curTab=1,this.tabToInfo={},this.relicIdToInfo={},this.typeToUnlock={},this.findCount=0,this.typeToCfgIds={},this.initTypeToCfgIds(),this.initMaxRelicCount(),normalEvent.on(l.ROLE_RES_UPDATE,this.onRoleResUpdate,this),normalEvent.on(l.ROLE_OPEN_FUNCTION_UPDATE,this.onRoleOpenFunctionUpdate,this)}return t.clear=function(){normalEvent.off(l.ROLE_RES_UPDATE,this.onRoleResUpdate,this),normalEvent.off(l.ROLE_OPEN_FUNCTION_UPDATE,this.onRoleOpenFunctionUpdate,this)},t.onRoleResUpdate=function(t){t==a.ROLE_RELIC_FRAG&&this.updateRelicFindRed()},t.onRoleOpenFunctionUpdate=function(t){t==r.FUNC_LEGACY&&(this.updateRelicEquipRed(),this.updateRelicFindRed())},t.initMaxRelicCount=function(){var t,e=configRelic.getDatas(),i={};for(var n in this.maxRelicCount=0,e)i[t=e[n].id]||(i[t]=!0,this.maxRelicCount=this.maxRelicCount+1)},t.initRelicInfo=function(t){if(!(null==t||t.length<=0)){for(var e=0;e<t.length;e++){var i=t[e];this.relicIdToInfo[i.id]=i;var n=configRelic.getDataByKeys("id",i.cfg_id,"level",i.lv);this.typeToUnlock[n.type]=!0}this.updateRelicFindCount(),this.updateRelicFindRed(),this.updateRelicEquipRed(),normalEvent.emit(u.RELIC_LIST_UPDATE)}},t.updateRelicFindCount=function(){for(var t in this.findCount=0,this.relicIdToInfo){null!=this.relicIdToInfo[t]&&(this.findCount=this.findCount+1)}},t.updateRelicInfo=function(t){if(!(null==t||t.length<=0)){for(var e=0;e<t.length;e++){var i=t[e];this.relicIdToInfo[i.id]=i,normalEvent.emit(u.RELIC_INFO_UPDATE,i.id)}normalEvent.emit(u.RELIC_LIST_UPDATE)}},t.initTypeToCfgIds=function(){var t,e=configRelic.getDatas();for(var i in e){var n=e[i];1==n.level&&(t=n.type,this.typeToCfgIds[t]||(this.typeToCfgIds[t]=new Array),this.typeToCfgIds[t].push(n.id))}},t.updateRelicFindRed=function(){IS(i).changeValue("relic_find",this.getRelicFindRedCount()),IS(i).changeValue("relic_main",this.getRelicRedCount())},t.getRelicFindRedCount=function(){if(!IS(c).CheckFuncOpen(r.FUNC_LEGACY))return 0;if(this.findCount>=this.maxRelicCount)return 0;var t=configRelic_get.getDataByKey(this.findCount+1).cost[0];return IS(o).getGoodsCountByGoodsGtid(t[0])>=t[1]?1:0},t.updateRelicEquipRed=function(){IS(i).changeValue("relic_main",this.getRelicRedCount())},t.getRelicEquipRedCount=function(){if(!IS(c).CheckFuncOpen(r.FUNC_LEGACY))return 0;for(var t in this.typeToUnlock)if(n.isEmpty(IS(d).getRelicInfoByLocation(Number(t))))return 1;return 0},t.getRelicUpgradeCount=function(){if(!IS(c).CheckFuncOpen(r.FUNC_LEGACY))return 0;var t=IS(o).getGoodsCountByGoodsGtid(7),e=0;for(var n in this.relicIdToInfo){var l=this.relicIdToInfo[n],a=configRelic.getDataByKeys("id",l.cfg_id,"level",l.lv).cost;if(a&&!(a.length<=0)){var u=a[0][1];0!=l.location&&(IS(i).changeValue("relicequip-"+l.location,u<=t?1:0),e=u<=t?1:0)}}return e},t.checkUpgradeCount=function(){var t=IS(o).getGoodsCountByGoodsGtid(7);for(var e in this.relicIdToInfo){var n=this.relicIdToInfo[e],c=configRelic.getDataByKeys("id",n.cfg_id,"level",n.lv).cost;if(c&&!(c.length<=0)){var l=c[0][1];IS(i).changeValue("relicequip-"+n.location,l>t?0:1)}}},t.checkUpgradeCountByid=function(t){var e=IS(o).getGoodsCountByGoodsGtid(7),n=null;for(var c in this.relicIdToInfo)if(this.relicIdToInfo[c].cfg_id==t){n=this.relicIdToInfo[c];break}if(n){var l=configRelic.getDataByKeys("id",n.cfg_id,"level",n.lv).cost;if(l&&!(l.length<=0)){var a=l[0][1];IS(i).changeValue("relicequip-"+n.location,a>e?0:1)}}},t.checkCanUpgradeById=function(t){var e=IS(d).getRelicInfoByCfgId(t);if(null==e)return!1;var i=configRelic.getDataByKeys("id",t,"level",e.lv).cost;if(!i||i.length<=0)return!1;var n=i[0][1];return IS(o).getGoodsCountByGoodsGtid(7)>=n},t.getRelicRedCount=function(){return this.getRelicFindRedCount()+this.getRelicEquipRedCount()+this.getRelicUpgradeCount()},e}());e._RF.pop()}}}));

