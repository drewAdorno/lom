System.register("chunks:///_virtual/PetSelectView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./index57.ts","./BagModel.ts","./PetModel.ts","./ObjectUtil.ts","./NodeUtil.ts","./UIList.ts","./TeamControl.ts","./TeamDataCache.ts","./RoleDataCache.ts","./MessageView.ts","./BaseView.ts"],(function(t){"use strict";var e,i,n,o,s,a,l,r,d,c,h,u,p,f,v,g,m,C,I,L;return{setters:[function(t){e=t.inheritsLoose,i=t.createForOfIteratorHelperLoose},function(t){n=t.cclegacy,o=t.Button,s=t.ScrollView,a=t.Sprite,l=t.Label,r=t.ProgressBar,d=t.js},null,function(t){c=t.BagModel},function(t){h=t.PetModel},function(t){u=t.default},function(t){p=t.default},function(t){f=t.SelectedType,v=t.ListItem},function(t){g=t.default},function(t){m=t.TeamDataCache},function(t){C=t.RoleDataCache},function(t){I=t.default},function(t){L=t.BaseView}],execute:function(){n._RF.push({},"5c3d3EbKj5N7rNWbB3t7CiY","PetSelectView",void 0);t("default",function(t){function n(){var e;return(e=t.call(this)||this).scrollPetList=void 0,e.nodeScroll=void 0,e.petList=[],e.petShowList=[],e.curSelPetID=0,e.name="PetSelectView",e.url="ui/module/team/PetSelectView",e.poolTime=3e3,e}e(n,t);var a=n.prototype;return a.onInit=function(){var t=this,e=this.findChild("content/bg/btnClose");this.addComponentCallbackListener(e,o.EventType.CLICK,(function(){t.close()}));var i=this.findChild("content/bg/btnSel");this.addComponentCallbackListener(i,o.EventType.CLICK,(function(){IS(g).reqTeamChoosePet([{k:1,v:t.petShowList[t.petShowList.length-1]}]),t.close()}));var n=this.findChild("imgMask");this.addComponentCallbackListener(n,o.EventType.CLICK,(function(){t.close()}));var a=this.findChild("content/bg/btnTips");this.addComponentCallbackListener(a,o.EventType.CLICK,(function(){I.showBoxTip({tip:GetLanguage(200621),title:GetLanguage(200622),btnCnt:1})}));var l=this.findChildComponent("content/scrollPetList",s);this.nodeScroll=l.node,this.scrollPetList=this.addUIList(l,S),this.scrollPetList.selectedMode=f.SINGLE;var r=configPet.getDatas();for(var d in r)this.petList.push(r[d].id);this.petList.sort((function(t,e){var i=configPet.getDataByKey(t),n=configPet.getDataByKey(e);return i.quality!=n.quality?i.quality<n.quality?-1:1:t<e?-1:1}))},a.onAfterOpen=function(){for(var t,e=i(IS(m).member_list);!(t=e()).done;){var n=t.value;if(n.role_id==Number(IS(C).GetRoleId()))for(var o,s=i(n.pet_list);!(o=s()).done;){var a=o.value;1==a.pet_pos&&(this.curSelPetID=a.pet_id)}}this.petShowList=[];for(var l,r=i(this.petList);!(l=r()).done;){var d=l.value,c=IS(h).getPetInfoByPetId(d);u.isEmpty(c)||!1||this.petShowList.push(d)}this.scrollPetList.datas=this.petShowList},a.registerUpdateHandler=function(){},a.setChoosePetId=function(t){t!=this.curSelPetID&&(this.curSelPetID=t,this.scrollPetList.datas=this.petShowList)},a.onBeforeClose=function(){},a.onDestroy=function(){},n}(L));var S=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).imgFrame=void 0,e.imgIcon=void 0,e.imgSel=void 0,e.txtLevel=void 0,e.pbNum=void 0,e.txtNum=void 0,e.nodeCanUpgrade=void 0,e.petId=void 0,e}e(i,t);var n=i.prototype;return n.onInit=function(){this.imgFrame=p.findChildComponent(this.node,"imgFrame",a),this.imgIcon=p.findChildComponent(this.node,"imgIcon",a),this.imgSel=p.findChild(this.node,"imgSel"),this.txtLevel=p.findChildComponent(this.node,"txtLevel",l),this.txtNum=p.findChildComponent(this.node,"txtNum",l),this.pbNum=p.findChildComponent(this.node,"pbNum",r),this.nodeCanUpgrade=p.findChild(this.node,"imgCanUpgrade")},n.onRender=function(t,e){this.petId=t;var i=this.view;this.imgSel.active=this.petId==i.curSelPetID;var n=configPet.getDataByKey(this.petId);this.view.loadIcon(this.imgFrame,"icon_pet",configColor.getDataByKey(n.quality).path),this.view.loadIcon(this.imgIcon,"icon_pet",n.icon);var o=IS(h).getPetInfoByPetId(this.petId),s=u.isEmpty(o)||!1;this.txtLevel.string=s?"":d.formatStr("Lv.%s",o.level);var a=s?0:o.level,l=a+1,r=configPetlevel.getDataByKeys("id",this.petId,"level",l),p=(0==(u.isEmpty(r)||!1)?r:configPetlevel.getDataByKeys("id",this.petId,"level",a)).expend[0],f=IS(c).getGoodsCountByGoodsGtid(p[0]),v=p[1];this.txtNum.string=d.formatStr("%s/%s",f,v),this.pbNum.progress=Math.min(f/v,1),this.nodeCanUpgrade.active=IS(h).checkPetCanUpgrade(this.petId)},n.onItemClick=function(){this.imgSel.active=!0;var t=this.view;t.setChoosePetId(this.petId),uiMgr.openView("PetInfoView",this.petId,!0,1,t.petShowList)},i}(v);n._RF.pop()}}}));

