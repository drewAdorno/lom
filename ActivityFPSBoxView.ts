System.register("chunks:///_virtual/ActivityFPSBoxView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./V2.ts","./AudioMgr.ts","./index3.ts","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./SpineSkeleton.ts","./BagDefine.ts","./BagModel.ts","./ResItems.ts","./MessageView.ts","./ActivityControl.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./HorseCarnivalDataCache.ts","./EaseMethod.ts","./BaseView.ts"],(function(t){"use strict";var e,i,o,n,s,a,d,r,h,c,l,f,v,u,m,p,x,w,g,C,B,b,y,I,S,T,_,k,L,G,A;return{setters:[function(t){e=t.inheritsLoose,i=t.createForOfIteratorHelperLoose,o=t.regeneratorRuntime},function(t){n=t.cclegacy,s=t.Button,a=t.Vec3,d=t.Label,r=t.ScrollView,h=t.Toggle,c=t.Sprite,l=t.RichText},function(t){f=t.V2},function(t){v=t.audioMgr},null,function(t){u=t.ItemGrid},function(t){m=t.ListItem},function(t){p=t.default},function(t){x=t.default},function(t){w=t.default},null,function(t){g=t.SpineSkeleton},function(t){C=t.BagEventDefine},function(t){B=t.BagModel},function(t){b=t.ResItems},function(t){y=t.default},function(t){I=t.default},function(t){S=t.default},function(t){T=t.ActivityEventDefine,_=t.ActivityState,k=t.ActivityType},function(t){L=t.HorseCarnivalDataCache},function(t){G=t.EasingMethod},function(t){A=t.BaseView}],execute:function(){n._RF.push({},"86507wHsTZOiLaxJ0dZjwO7","ActivityFPSBoxView",void 0);var U=[1604],E=(t("default",function(t){function n(){var e;return(e=t.call(this)||this).actType=void 0,e.resItems=void 0,e.rewardState1=void 0,e.rewardState2=void 0,e.rewardStateSel=void 0,e.rewardStateMask=void 0,e.rewardList=[],e.txtTips=void 0,e.txtLevel=void 0,e.txtCount=void 0,e.tipsGo=void 0,e.tipsScroll=void 0,e.curTips=0,e.tipsTimer=0,e.togAuto=void 0,e.nodeState1=void 0,e.nodeState2=void 0,e.nodeState3=void 0,e.nodeNext=void 0,e.nodeLast=void 0,e.btn1=void 0,e.btn2=void 0,e.btn3=void 0,e.btn10=void 0,e.red1=void 0,e.red2=void 0,e.red3=void 0,e.red10=void 0,e.iconCost1=void 0,e.iconCost2=void 0,e.iconCost3=void 0,e.txtCost1=void 0,e.txtCost2=void 0,e.txtCost3=void 0,e.nodeBox1=void 0,e.nodeBox2=void 0,e.nodeBox3=void 0,e.btnBox1=void 0,e.btnBox2=void 0,e.btnBox3=void 0,e.maskBox1=void 0,e.maskBox2=void 0,e.reward1=void 0,e.reward2=void 0,e.reward3=void 0,e.effBox1=void 0,e.effBox2=void 0,e.effBox3=void 0,e.timer=void 0,e.skipAnim=void 0,e.reward_list=[],e.txtLeftTime=void 0,e.deltaTime=0,e.leftTime=0,e.canUpdate=!1,e.cor1=void 0,e.cor2=void 0,e.levelUp=void 0,e.levelUpTxt=void 0,e.levelTween=void 0,e.extraReward=void 0,e.name="ActivityFPSBoxView",e.url="ui/module/activityFPS/ActivityFPSBoxView",e.actType=k.FPSBox,e}e(n,t);var l=n.prototype;return l.onInit=function(){var t=this,e=this.findChild("view/btnClose");this.addComponentCallbackListener(e,s.EventType.CLICK,(function(){t.close()}));var o=this.findChild("view/tips");this.addComponentCallbackListener(o,s.EventType.CLICK,(function(){IS(S).ShowSysTips(t.actType)}));var n=this.findChild("view/btnGift");this.addComponentCallbackListener(n,s.EventType.CLICK,(function(){uiMgr.openView("ActivityFPSGiftView",t.actType)}));var l=this.findChild("view/btnPre");this.addComponentCallbackListener(l,s.EventType.CLICK,(function(){uiMgr.openView("ActivityFPSBoxPreView")}));var v=this.findChild("view/bottom/state3/btn");this.addComponentCallbackListener(v,s.EventType.CLICK,(function(){IS(I).send_box_next(t.actType)}));var m=this.findChild("view/bottom/next/btn");this.addComponentCallbackListener(m,s.EventType.CLICK,(function(){for(var e,o,n=IS(S).GetActivityInfo(t.actType),s=IS(S).getBoxInfo(t.actType),d=s.id,r=i(configBox_tower_level.getDatas());!(o=r()).done;){var h=o.value;if(n.roundCfg.group_id==h.group&&1==h.final){e=h;break}}0==s.id&&(d=e.id);var c=configBox_tower_level.getDataByKey(d);if(null!=t.levelTween&&t.levelTween.stop(),c.level<=5){t.levelUp.active=!0,t.levelUpTxt.string=GetLanguage(600002060);var l=t.levelUp,v=new a,u=new f,m=new f(0,-300),p=new a(0,0),x=a.subtract(new a,p,l.position);t.levelTween=t.addTween(0,1,.5,(function(t,e){a.multiplyScalar(v,x,e),u.set(m).add2f(v.x,v.y),l.setPosition(u.x,u.y)})).easing(G.SINE_OUT).call((function(){t.levelUp.active=!1}),.5).start()}t.nodeNext.active=!1,t.updateInfo()}));var p=this.findChild("view/bottom/last/btn");this.addComponentCallbackListener(p,s.EventType.CLICK,(function(){t.nodeLast.active=!1,t.updateInfo()})),this.levelUp=this.findChild("levelUp"),this.levelUpTxt=this.findChildComponent("levelUp/Label",d),this.skipAnim=this.findChild("skipAnim"),this.addComponentCallbackListener(this.skipAnim,s.EventType.CLICK,(function(){t.SkipAnim()})),this.tipsGo=this.findChild("view/numReward/tipsScroll");var x=this.findChildComponent("view/numReward/tipsScroll/ScrollView",r);this.tipsScroll=this.addUIList(x,D),this.resItems=new b(this),this.resItems.init(U),this.txtLeftTime=this.findChildComponent("view/nodeTime/txtTime",d),this.txtTips=this.findChildComponent("view/numReward/Label",d),this.rewardState1=this.findChild("view/numReward/state1"),this.rewardState2=this.findChild("view/numReward/state2"),this.rewardStateSel=this.findChild("view/numReward/state2/select"),this.rewardStateMask=this.findChild("view/numReward/state2/mask");for(var w=1;w<=5;w++){var g=new E;g.init(this.findChild("view/numReward/state1/item"+w),this,w),this.rewardList.push(g)}this.txtLevel=this.findChildComponent("view/bottom/level/Label",d),this.txtCount=this.findChildComponent("view/bottom/txtCount",d),this.togAuto=this.findChildComponent("view/bottom/auto",h),this.addComponentCallbackListener(this.togAuto.node,h.EventType.CLICK,(function(){IS(I).send_box_auto(t.actType)})),this.nodeState1=this.findChild("view/bottom/state1"),this.nodeState2=this.findChild("view/bottom/state2"),this.nodeState3=this.findChild("view/bottom/state3"),this.nodeNext=this.findChild("view/bottom/next"),this.nodeLast=this.findChild("view/bottom/last"),this.btn1=this.findChild("view/bottom/state1/btn1"),this.red1=this.findChild("view/bottom/state1/btn1/red"),this.iconCost1=this.findChildComponent("view/bottom/state1/btn1/icon",c),this.txtCost1=this.findChildComponent("view/bottom/state1/btn1/num",d),this.addComponentCallbackListener(this.btn1,s.EventType.CLICK,(function(){var e=IS(S).getBoxInfo(t.actType),i=configBox_tower_box.getDataByKey(e.box_id);IS(B).getGoodsCountByGoodsGtid(i.item[0])<i.item[1]?y.showFlyTip(GetLanguage(200069)):IS(I).send_box_open(t.actType,1)})),this.btn2=this.findChild("view/bottom/state1/btn2"),this.red2=this.findChild("view/bottom/state1/btn2/red"),this.iconCost2=this.findChildComponent("view/bottom/state1/btn2/icon",c),this.txtCost2=this.findChildComponent("view/bottom/state1/btn2/num",d),this.addComponentCallbackListener(this.btn2,s.EventType.CLICK,(function(){var e=IS(S).getBoxInfo(t.actType),i=configBox_tower_box.getDataByKey(e.box_id);IS(B).getGoodsCountByGoodsGtid(i.item[0])<i.item[1]?y.showFlyTip(GetLanguage(200069)):IS(I).send_box_open(t.actType,2)})),this.btn10=this.findChild("view/bottom/state1/btn10"),this.red10=this.findChild("view/bottom/state1/btn10/red"),this.addComponentCallbackListener(this.btn10,s.EventType.CLICK,(function(){var e=IS(S).getBoxInfo(t.actType),i=configBox_tower_box.getDataByKey(e.box_id);IS(B).getGoodsCountByGoodsGtid(i.item[0])<10*i.item[1]?y.showFlyTip(GetLanguage(200069)):IS(I).send_box_open_ten(t.actType)})),this.btn3=this.findChild("view/bottom/state2/btn"),this.red3=this.findChild("view/bottom/state2/btn/red"),this.iconCost3=this.findChildComponent("view/bottom/state2/btn/icon",c),this.txtCost3=this.findChildComponent("view/bottom/state2/btn/num",d),this.addComponentCallbackListener(this.btn3,s.EventType.CLICK,(function(){var e=IS(S).getBoxInfo(t.actType),i=configBox_tower_level.getDataByKey(e.id);IS(B).getGoodsCountByGoodsGtid(i.item[0])<i.item[1]?y.showFlyTip(GetLanguage(200069)):IS(I).send_box_open(t.actType,0)})),this.nodeBox1=this.findChild("view/bottom/box1"),this.nodeBox2=this.findChild("view/bottom/box2"),this.nodeBox3=this.findChild("view/bottom/box3"),this.maskBox1=this.findChild("view/bottom/box1/mask"),this.maskBox2=this.findChild("view/bottom/box2/mask"),this.reward1=new u(this,this.findChild("view/bottom/box1/itemGrid")),this.reward2=new u(this,this.findChild("view/bottom/box2/itemGrid")),this.reward3=new u(this,this.findChild("view/bottom/box3/itemGrid")),this.btnBox1=this.findChild("view/bottom/box1/button"),this.addComponentCallbackListener(this.btnBox1,s.EventType.CLICK,(function(){var e=IS(S).getBoxInfo(t.actType);if(1==e.type){var i=configBox_tower_box.getDataByKey(e.box_id);IS(B).getGoodsCountByGoodsGtid(i.item[0])<i.item[1]?y.showFlyTip(GetLanguage(200069)):IS(I).send_box_open(t.actType,1)}})),this.btnBox2=this.findChild("view/bottom/box2/button"),this.addComponentCallbackListener(this.btnBox2,s.EventType.CLICK,(function(){var e=IS(S).getBoxInfo(t.actType);if(1==e.type){var i=configBox_tower_box.getDataByKey(e.box_id);IS(B).getGoodsCountByGoodsGtid(i.item[0])<i.item[1]?y.showFlyTip(GetLanguage(200069)):IS(I).send_box_open(t.actType,2)}})),this.btnBox3=this.findChild("view/bottom/box3/button"),this.addComponentCallbackListener(this.btnBox3,s.EventType.CLICK,(function(){var e=IS(S).getBoxInfo(t.actType);if(2==e.type){var i=configBox_tower_level.getDataByKey(e.id);IS(B).getGoodsCountByGoodsGtid(i.item[0])<i.item[1]?y.showFlyTip(GetLanguage(200069)):IS(I).send_box_open(t.actType,0)}}))},l.registerUpdateHandler=function(){this.addEvent(C.GOODS_INFO_UPDATE,this.updateResShow,this),this.addEvent(T.OnActivityBoxUpdate,this.updateInfo,this),this.addEvent(T.OnActivityBoxAutoUpdate,this.updateAuto,this),this.addEvent(T.OnActivityBoxOpen,this.onBoxOpenCallBack,this),this.addEvent(T.OnActivityBoxTenOpen,this.onBoxTenOpen,this)},l.onAfterOpen=function(){var t=this;this.levelUp.active=!1,IS(S).isBoxAnim=!1,this.effBox1=this.addUIEffect("prefab/ui-effect/MX_jixuqianjinbaoxiang",p.findChild(this.nodeBox1,"eff"),-1,new f(0,0),1,(function(e){e.node.getComponent(g).scheduleOnce((function(){t.updateBoxAnim(1)}))})),this.effBox2=this.addUIEffect("prefab/ui-effect/MX_jixuqianjinbaoxiang",p.findChild(this.nodeBox2,"eff"),-1,new f(0,0),1,(function(e){e.node.getComponent(g).scheduleOnce((function(){t.updateBoxAnim(2)}))})),this.effBox3=this.addUIEffect("prefab/ui-effect/MX_jixuqianjinbaoxiang",p.findChild(this.nodeBox3,"eff"),-1,new f(0,0),1,(function(e){e.node.getComponent(g).scheduleOnce((function(){t.updateBoxAnim(3)}))}));var e=IS(S).GetActivityInfo(this.actType);if(e){var i,o=null!=(i=e.state_time[e.state])?i:e.state_time[_.Open];this.leftTime=o.end_time-w.serverTime,this.leftTime>0?(this.canUpdate=!0,this.txtLeftTime.string=w.formatTimeStringForSecond(this.leftTime)):this.txtLeftTime.string=GetLanguage(200026)}else this.txtLeftTime.string=GetLanguage(200026);this.updateResShow(),IS(I).send_box_info(this.actType)},l.onBeforeClose=function(){this.canUpdate=!1,this.effBox1=null,this.effBox2=null,this.effBox3=null,this.removeTimer(this.timer),this.cor1&&(coroutine.stop(this.cor1),this.cor1=null),this.cor2&&(coroutine.stop(this.cor2),this.cor2=null),this.timer=null,this.reward_list=[],this.skipAnim.active=!1,this.tipsTimer=0,this.extraReward=null},l.onDestroy=function(){},l.onUpdate=function(t){this.canUpdate&&(this.deltaTime=this.deltaTime+t,this.deltaTime>=1&&(this.deltaTime=0,this.leftTime=this.leftTime-1,this.leftTime>0?this.txtLeftTime.string=w.formatTimeStringForSecond(this.leftTime):(this.txtLeftTime.string=GetLanguage(200026),this.canUpdate=!1)))},l.updateResShow=function(){this.resItems.update(),this.updateRed()},l.updateRed=function(){var t=IS(B).getGoodsCountByGoodsGtid(1604);this.red1.active=t>0,this.red2.active=t>0,this.red3.active=t>0,this.red10.active=t>=10},l.updateInfo=function(){var t=this;if(!IS(S).isBoxAnim){this.updateTips(),this.updateAuto();var e=IS(S).GetActivityInfo(this.actType),o=IS(S).getBoxInfo(this.actType);this.nodeNext.active=!1,this.nodeLast.active=!1;for(var n,s,d=o.id,r=i(configBox_tower_level.getDatas());!(s=r()).done;){var h=s.value;if(e.roundCfg.group_id==h.group&&1==h.final){n=h;break}}0==o.id&&(d=n.id);var c=configBox_tower_level.getDataByKey(d);if(c.level<=5){this.rewardState1.active=!0,this.rewardState2.active=!1,this.txtTips.string=GetLanguage(201775),this.txtLevel.string=x.formatStrWithMirrorDeal(GetLanguage(200284),c.level);for(var l,v=i(this.rewardList);!(l=v()).done;){l.value.show()}}else if(this.rewardState1.active=!1,this.rewardState2.active=!0,this.txtLevel.string=x.formatStrWithMirrorDeal(GetLanguage(200284),5),0==o.id)this.rewardStateSel.active=!1,this.rewardStateMask.active=!0,this.txtTips.string=GetLanguage(204319);else{this.rewardStateSel.active=!0,this.rewardStateMask.active=!1;var u=n.level-c.level+1;this.txtTips.string=x.formatStrWithMirrorDeal(GetLanguage(204318),u)}if(this.txtCount.string=x.formatStrWithMirrorDeal(GetLanguage(201793),o.cnt),1==o.type){this.nodeState1.active=!0,this.nodeState2.active=!1,this.nodeState3.active=!1;var m=configBox_tower_box.getDataByKey(o.box_id),p=configGoods.getDataByKey(m.item[0]);this.loadIcon(this.iconCost1,p.icon_group,p.icon),this.loadIcon(this.iconCost2,p.icon_group,p.icon),this.txtCost1.string=m.item[1],this.txtCost2.string=m.item[1],this.nodeBox1.active=!0,this.nodeBox2.active=!0,this.nodeBox3.active=!1,this.maskBox1.active=!1,this.maskBox2.active=!1,this.reward1.node.active=!1,this.reward2.node.active=!1,this.updateBoxAnim(1),this.updateBoxAnim(2)}else if(2==o.type){this.nodeState1.active=!1,this.nodeState2.active=!0,this.nodeState3.active=!1;var w=configBox_tower_level.getDataByKey(o.id),g=configGoods.getDataByKey(w.item[0]);if(this.loadIcon(this.iconCost3,g.icon_group,g.icon),this.txtCost3.string=w.item[1],o.getBigBox){o.getBigBox=!1,null!=this.levelTween&&this.levelTween.stop(),this.levelUp.active=!0,this.levelUpTxt.string=GetLanguage(600002061);var C=this.levelUp,B=new a,b=new f,y=new f(0,-300),I=new a(0,0),T=a.subtract(new a,I,C.position);this.levelTween=this.addTween(0,1,.5,(function(t,e){a.multiplyScalar(B,T,e),b.set(y).add2f(B.x,B.y),C.setPosition(b.x,b.y)})).easing(G.SINE_OUT).call((function(){t.levelUp.active=!1}),.5).start()}this.nodeBox1.active=!1,this.nodeBox2.active=!1,this.nodeBox3.active=!0,this.reward3.node.active=!1,this.updateBoxAnim(3)}else 3==o.type&&(this.nodeState1.active=!1,this.nodeState2.active=!1,this.nodeState3.active=!0,this.nodeBox1.active=!0,this.nodeBox2.active=!0,this.nodeBox3.active=!1,this.maskBox1.active=1!=o.choose,this.maskBox2.active=2!=o.choose,this.reward1.node.active=!0,this.reward2.node.active=!0,this.reward1.SetItemId(o.left_reward.gtid,o.left_reward.num),this.reward2.SetItemId(o.right_reward.gtid,o.right_reward.num),this.updateBoxAnim(1),this.updateBoxAnim(2))}},l.updateTips=function(){var t=this,e=IS(S).getBoxInfo(this.actType);this.tipsGo.active=e.lucky_list.length>0,0!=this.tipsTimer&&this.removeTimer(this.tipsTimer),this.tipsGo.active&&(this.tipsScroll.datas=e.lucky_list,this.curTips=0,this.tipsTimer=this.addTimer(1,-1,(function(){t.curTips=t.curTips+1,t.curTips==e.lucky_list.length&&(t.curTips=0);var i=0==t.curTips?.2:1;t.tipsScroll.scrollTo(t.curTips,i)})))},l.updateAuto=function(){var t=IS(S).getBoxInfo(this.actType);this.togAuto.isChecked=1==t.auto_next},l.updateBoxAnim=function(t){var e=IS(S).getBoxInfo(this.actType);if(e)if(3==t){if(2==e.type&&null!=this.effBox3){var i=this.getUIEffect(this.effBox3);if(i&&i.node){var o=i.node.getComponent(g);o.setSkin("L5"),o.setAnimation(0,"idel",!0)}}}else if(1==e.type){var n=this["effBox"+t];if(null!=n){var s=this.getUIEffect(n);if(s&&s.node){var a=s.node.getComponent(g),d=configBox_tower_box.getDataByKey(e.box_id);a.setSkin(d.shape),a.setAnimation(0,"idel",!0)}}}else if(3==e.type){var r=this["effBox"+t];if(null!=r){var h=this.getUIEffect(r);if(h&&h.node){var c=h.node.getComponent(g),l=configBox_tower_box.getDataByKey(e.box_id);c.setSkin(l.shape);var f=t==e.choose?"idle1":"idle2";c.setAnimation(0,f,!0)}}}},l.SkipAnim=function(){this.timer&&(this.removeTimer(this.timer),this.timer=null),this.cor1&&coroutine.stop(this.cor1),this.cor2&&coroutine.stop(this.cor2),this.cor1=null,this.cor2=null,this.skipAnim.active=!1,0!=this.reward_list.length&&(uiMgr.openView("GoodsGetView",this.reward_list,this.extraReward),this.reward_list=[]),IS(S).isBoxAnim=!1,this.updateInfo()},l.onBoxOpenCallBack=function(t){var e=IS(L).GetDrawReward(this.actType),i=e[1];this.extraReward=[e[0],i],this.cor1&&(coroutine.stop(this.cor1),this.cor1=null),this.cor1=coroutine.start(this.onBoxOpen(t))},l.onBoxOpen=o().mark((function t(e){var i,n,s,a,d,r,h,c,l=this;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.reward_list=[],this.skipAnim.active=!0,this.timer&&(this.removeTimer(this.timer),this.timer=null),v.playSound("stbyt_kaixiang"),0!=e.choose){t.next=12;break}return this.reward3.node.active=!1,null!=this.effBox3&&(i=this.getUIEffect(this.effBox3))&&i.node&&(i.node.getComponent(g).setAnimation(0,"kai2",!1),this.reward_list=[e.left_reward],this.timer=this.addTimer(1,0,(function(){l.skipAnim.active=!1,IS(S).isBoxAnim=!1,uiMgr.openView("GoodsGetView",[e.left_reward]),i.node.getComponent(g).setAnimation(0,"idle1",!0),0!=IS(S).getBoxInfo(l.actType).id?(l.nodeState2.active=!1,l.nodeNext.active=!0):(l.nodeState2.active=!1,l.nodeLast.active=!0)}))),t.next=9,coroutine.wait(.5);case 9:IS(S).isBoxAnim&&(this.reward3.node.active=!0,this.reward3.SetItemId(e.left_reward.gtid,e.left_reward.num)),t.next=25;break;case 12:return this.reward1.node.active=!1,this.reward2.node.active=!1,this.maskBox1.active=!1,this.maskBox2.active=!1,null!=this.effBox1&&(n=this.getUIEffect(this.effBox1))&&n.node&&(s=n.node.getComponent(g),a=1==e.choose?"kai2":"kai1",s.setAnimation(0,a,!1)),null!=this.effBox2&&(d=this.getUIEffect(this.effBox2))&&d.node&&(r=d.node.getComponent(g),h=2==e.choose?"kai2":"kai1",r.setAnimation(0,h,!1)),c=1==e.choose?e.left_reward:e.right_reward,this.reward_list=[c],this.timer=this.addTimer(1,0,(function(){if(l.skipAnim.active=!1,IS(S).isBoxAnim=!1,uiMgr.openView("GoodsGetView",[c],l.extraReward),null!=l.effBox1){var t=l.getUIEffect(l.effBox1);if(t&&t.node){var i=t.node.getComponent(g),o=(e.choose,"idle1");i.setAnimation(0,o,!0)}}if(null!=l.effBox2){var n=l.getUIEffect(l.effBox2);if(n&&n.node){var s=n.node.getComponent(g),a=(e.choose,"idle1");s.setAnimation(0,a,!0)}}l.updateInfo()})),t.next=23,coroutine.wait(.5);case 23:IS(S).isBoxAnim&&(this.maskBox1.active=1!=e.choose,this.maskBox2.active=2!=e.choose,this.reward1.node.active=!0,this.reward2.node.active=!0,this.reward1.SetItemId(e.left_reward.gtid,e.left_reward.num),this.reward2.SetItemId(e.right_reward.gtid,e.right_reward.num)),this.cor1=null;case 25:case"end":return t.stop()}}),t,this)})),l.onBoxTenOpen=function(t){var e=IS(L).GetDrawReward(this.actType),o=e[1]*t.box_list.length;this.extraReward=[e[0],o],this.reward_list=[],this.skipAnim.active=!0;for(var n,s=[],a=i(t.box_list);!(n=a()).done;){var d=n.value;1==d.choose||0==d.choose?s.push(d.left_reward):s.push(d.right_reward)}this.reward_list=s,this.openOneBox(0,t)},l.openOneBox=function(t,e){var i,o=this;i=t<e.box_list.length-1?function(){o.openOneBox(t+1,e)}:function(){o.skipAnim.active=!1,IS(S).isBoxAnim=!1,o.reward_list.length>0&&uiMgr.openView("GoodsGetView",o.reward_list,o.extraReward),o.reward_list=[],o.updateInfo()},this.cor2&&(coroutine.stop(this.cor2),this.cor2=null);var n=e.box_list[t];this.cor2=coroutine.start(this.doOpenTween(n,i))},l.doOpenTween=o().mark((function t(e,i){var n,s,a,d,r,h,c,l,f=this;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return v.playSound("stbyt_kaixiang"),this.reward1.node.active=!1,this.reward2.node.active=!1,this.maskBox1.active=!1,this.maskBox2.active=!1,null!=this.effBox1&&(n=this.getUIEffect(this.effBox1))&&n.node&&(s=n.node.getComponent(g),a=1==e.choose?"kai2":"kai1",(d=configBox_tower_box.getDataByKey(e.box_id))&&s.setSkin(d.shape),s.setAnimation(0,a,!1)),null!=this.effBox2&&(r=this.getUIEffect(this.effBox2))&&r.node&&(h=r.node.getComponent(g),c=2==e.choose?"kai2":"kai1",(l=configBox_tower_box.getDataByKey(e.box_id))&&h.setSkin(l.shape),h.setAnimation(0,c,!1)),this.timer&&(this.removeTimer(this.timer),this.timer=null),this.timer=this.addTimer(1,0,(function(){if(null!=f.effBox1){var t=f.getUIEffect(f.effBox1);if(t&&t.node){var o=t.node.getComponent(g),n=1==e.choose?"idle1":"idle2";o.setAnimation(0,n,!0)}}if(null!=f.effBox2){var s=f.getUIEffect(f.effBox2);if(s&&s.node){var a=s.node.getComponent(g),d=2==e.choose?"idle1":"idle2";a.setAnimation(0,d,!0)}}f.timer=null,i()})),t.next=11,coroutine.wait(.5);case 11:IS(S).isBoxAnim&&(this.reward1.node.active=!0,this.reward2.node.active=!0,this.maskBox1.active=1!=e.choose,this.maskBox2.active=2!=e.choose,this.reward1.SetItemId(e.left_reward.gtid,e.left_reward.num),this.reward2.SetItemId(e.right_reward.gtid,e.right_reward.num)),this.cor2=null;case 13:case"end":return t.stop()}}),t,this)})),n}(A)),function(){function t(){this.view=void 0,this.node=void 0,this.index=void 0,this.num=void 0,this.select=void 0,this.mask=void 0,this.isGet=void 0,this.itemGrid=void 0,this.itemId=0}var e=t.prototype;return e.init=function(t,e,i){this.view=e,this.node=t,this.index=i,this.onInit()},e.onInit=function(){var t=this;this.num=p.findChildComponent(this.node,"num",d),this.select=p.findChild(this.node,"img/select"),this.mask=p.findChild(this.node,"mask"),this.isGet=p.findChild(this.node,"isGet");var e=p.findChild(this.node,"reward/itemGrid");e&&(this.itemGrid=new u(this.view,e));var i=p.findChild(this.node,"big");i&&this.view.addComponentCallbackListener(i,s.EventType.CLICK,(function(){0!=t.itemId&&IS(B).OpenItemTips(t.itemId,i)}))},e.show=function(){for(var t,e,o,n=IS(S).GetActivityInfo(this.view.actType),s=i(configBox_tower_level.getDatas());!(o=s()).done;){var a=o.value;if(n.roundCfg.group_id==a.group&&a.level==this.index){e=a;break}}this.num.string=e.level,this.itemGrid&&this.itemGrid.SetItemId(e.grand_prize[0][0],e.grand_prize[0][1]),this.itemId=e.grand_prize[0][0];var d=IS(S).getBoxInfo(this.view.actType),r=null==(t=configBox_tower_level.getDataByKey(d.id))?void 0:t.level;this.index==r||1==e.final&&0==d.id?this.select.active=!0:this.select.active=!1,r>this.index||0==d.id?(this.isGet.active=!0,this.mask.active=!0):(this.isGet.active=!1,this.mask.active=!1)},t}()),D=function(t){function i(){for(var e,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return(e=t.call.apply(t,[this].concat(o))||this).txt=void 0,e}e(i,t);var o=i.prototype;return o.onInit=function(){this.txt=p.findChildComponent(this.node,"txt",l)},o.onRender=function(t,e){var i=t.k,o=configGoods.getDataByKey(i).name;this.txt.string=x.formatStrWithMirrorDeal(GetLanguage(200050),t.s,o)},i}(m);n._RF.pop()}}}));

