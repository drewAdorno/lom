System.register("chunks:///_virtual/CrossWarSceneControl.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BattleData.ts","./BattleDataFill.ts","./ControlMgr.ts","./ChapterDataCache.ts","./RoleDataCache.ts","./CrossWarDatacache.ts","./CrossWarDefine.ts","./CrossWarSceneDataCache.ts"],(function(e){"use strict";var t,n,a,s,o,c,r,_,l,i,d,v,p,u;return{setters:[function(e){t=e.createForOfIteratorHelperLoose},function(e){n=e.cclegacy},function(e){a=e.PlayerData,s=e.ChapterType,o=e.BattleData},function(e){c=e.BattleDataFill},function(e){r=e.controlMgr},function(e){_=e.ChapterDataCache},function(e){l=e.RoleDataCache},function(e){i=e.CrossWarDataCache},function(e){d=e.CrossWarEventDefine,v=e.RoleUpdateFlag,p=e.SceneObjUpdateElem},function(e){u=e.CrossWarSceneDataCache}],execute:function(){n._RF.push({},"829daGr9mRK8J94KcpxIDS1","CrossWarSceneControl",void 0);e("default",function(){var e=n.prototype;function n(){netManager.addEventListener("scene.scene_obj_add_s2c",this.on_scene_obj_add_s2c,this),netManager.addEventListener("scene.scene_obj_update_s2c",this.on_scene_obj_update_s2c,this),netManager.addEventListener("scene.scene_obj_update_elem_s2c",this.on_scene_obj_update_elem_s2c,this),netManager.addEventListener("scene.scene_obj_del_s2c",this.on_scene_obj_del_s2c,this),netManager.addEventListener("scene.scene_obj_move_s2c",this.on_scene_obj_move_s2c,this),netManager.addEventListener("scene.scene_enter_s2c",this.on_scene_enter_s2c,this),netManager.addEventListener("scene.scene_leave_s2c",this.on_scene_leave_s2c,this),netManager.addEventListener("scene.scene_battle_s2c",this.on_scene_battle_s2c,this),netManager.addEventListener("scene.scene_obj_static_s2c",this.on_scene_obj_static_s2c,this),netManager.addEventListener("scene.scene_obj_attack_cd_s2c",this.on_scene_obj_attack_cd_s2c,this),netManager.addEventListener("scene.scene_load_s2c",this.on_scene_load_s2c,this),r.addControl(this)}return e.clear=function(){printLog("CrossWarControl")},e.onLogin=function(){},e.onReconnect=function(){},e.reqMove=function(e,t,n,a){t&&(t.x=Math.floor(t.x),t.y=Math.floor(t.y)),netManager.send("scene.scene_obj_move_c2s",{move_info:{type:e,pos:t,target_id:n,target_type:a}})},e.reqBattleResult=function(e,t){netManager.send("scene.scene_battle_over_c2s",{}),normalEvent.emit(d.CROSS_WAR_BATTLE,1)},e.reqLeave=function(){netManager.send("scene.scene_leave_c2s",{})},e.reqMoveRocker=function(e){netManager.send("scene.scene_obj_move_rocker_c2s",{})},e.leaveScene=function(e,t){void 0===e&&(e=1),void 0===t&&(t=!0),uiMgr.close("CrossWarDeadView");var n=IS(u);n.roleMap={},n.clearActions(),IS(i).clearActions(),n.currenSceneType=1==e?1:0,t&&normalEvent.emit(d.CROSS_WAR_LEAVE,e)},e.on_scene_obj_add_s2c=function(e){for(var n,a=IS(u),s=t(e.scene_obj_list);!(n=s()).done;){var o=n.value;a.roleUpdateFlag=v.Add;var c=o.obj_id;a.roleActions[v.Add].add(c),a.roleActions[v.Move].delete(c),a.roleActions[v.Del].delete(c),a.roleActions[v.Update].delete(c),a.roleMap[c]=o}},e.on_scene_obj_static_s2c=function(e){for(var n,a=IS(u),s=t(e.scene_obj_list);!(n=s()).done;){var o=n.value;a.roleUpdateFlag=v.Add;var c=o.obj_id;a.roleActions[v.Add].add(c),a.roleActions[v.Move].delete(c),a.roleActions[v.Del].delete(c),a.roleActions[v.Update].delete(c),a.roleMap[c]=o}},e.on_scene_obj_update_s2c=function(e){},e.on_scene_obj_update_elem_s2c=function(e){var n=IS(u),a=n.roleMap[e.obj_id];if(a){n.roleUpdateFlag|=v.Update,n.roleActions[v.Update].add(e.obj_id);for(var s,o=t(e.update_list);!(s=o()).done;){var c=s.value;switch(c.key){case p.Hp:a.hp=c.val;break;case p.State:a.state=c.val;break;case p.ReviveTime:a.role.revive_time=c.val;break;case p.ReviveNum:a.role.revive_count=c.val;break;case p.Speed:a.speed=c.val}}}},e.on_scene_obj_del_s2c=function(e){for(var n,a=IS(u),s=e.list,o=t(s);!(n=o()).done;)for(var c,r=n.value,_=t(r.list);!(c=_()).done;){var i=c.value;i!=IS(l).GetRoleId()&&(a.roleMap[i]&&(a.roleUpdateFlag|=v.Del,delete a.roleMap[i],a.roleActions[v.Del].add(i),a.roleActions[v.Move].delete(i),a.roleActions[v.Add].delete(i),a.roleActions[v.Update].delete(i)))}},e.on_scene_obj_move_s2c=function(e){var t=IS(u),n=e.obj_id;t.roleMap[n]&&(t.roleUpdateFlag|=v.Move,t.roleActions[v.Move].add(n),t.roleMap[n].moveInfo=e.move_info,t.roleMap[n].pos=e.pos,e.move_info&&(t.roleMap[n].speed=e.speed))},e.on_scene_enter_s2c=function(e){var t=IS(u);t.roleMap={},t.clearActions(),t.currenSceneType=e.type,IS(i).scene_base=e.scene_base,IS(i).clearActions()},e.on_scene_leave_s2c=function(e){this.leaveScene(e.type)},e.on_scene_obj_attack_cd_s2c=function(e){for(var n,a=IS(u),s=t(e.attack_cd);!(n=s()).done;){var o=n.value;a.attackCd[o.k]=Number(o.v)+1}},e.on_scene_battle_s2c=function(e){IS(u).battleAction=function(){var t=IS(_);t.currentLoadType=0,t.chapterType=e.type,t.curDungeonId=e.id;var n=new o;n.chapterId=e.id,n.seed=e.random_seed,n.passTime=e.pass_sec,n.chapterType=e.type,n.playerList[1]=new a(1),e.type==s.CrossWarPvp?(c.setPlayerList(e.roles[0],n.playerList[1],e.type),n.playerList[2]=new a(e.roles[1].id),c.setPlayerList(e.roles[1],n.playerList[2],e.type),n.playerImage=e.roles[0].id!=IS(l).GetRoleId()):(c.setPlayerList(e.roles[0],n.playerList[1],e.type),n.monster=c.setMonster(e.monsters[0])),t.battleData=n,battleMain.enterChapter(0,!1,!0),normalEvent.emit(d.CROSS_WAR_BATTLE,0)}},e.on_scene_load_s2c=function(e){IS(i).scene_base=e.scene_base,IS(u).loadScene=1},n}());n._RF.pop()}}}));

