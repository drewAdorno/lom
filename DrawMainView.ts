System.register("chunks:///_virtual/DrawMainView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./NodeUtil.ts","./StringUtil.ts","./index57.ts","./BaseSubView.ts","./ItemIcon.ts","./SpineSkeleton.ts","./ConfigGlobal.ts","./ObjectUtil.ts","./AdDefine.ts","./AdModel.ts","./BagDefine.ts","./BagModel.ts","./MessageView.ts","./MainViewModel.ts","./RoleDataCache.ts","./RoleDefine.ts","./DrawControl.ts","./DrawDefine.ts","./DrawModel.ts","./BaseView.ts","./UIDefine.ts"],(function(t){"use strict";var o,i,n,e,s,a,d,h,r,l,c,f,u,p,C,m,g,v,I,w,_,D,L,A,y,S,b,T,x,R,B;return{setters:[function(t){o=t.inheritsLoose},function(t){i=t.cclegacy,n=t.Sprite,e=t.Button,s=t.Label,a=t.ProgressBar,d=t.Vec3,h=t.js,r=t.Color,l=t.LabelOutline},function(t){c=t.default},function(t){f=t.default},null,function(t){u=t.BaseSubView},function(t){p=t.IconAseetType},function(t){C=t.SpineSkeleton},function(t){m=t.ConfigGlobal},function(t){g=t.default},function(t){v=t.AdEventDefine,I=t.ADS_TYPE},function(t){w=t.AdModel},function(t){_=t.BagEventDefine},function(t){D=t.BagModel},function(t){L=t.default},function(t){A=t.MainViewModel},function(t){y=t.RoleDataCache},function(t){S=t.RoleEventDefine},function(t){b=t.default},function(t){T=t.DrawEventDefine},function(t){x=t.DrawModel},function(t){R=t.ViewEvent},function(t){B=t.PanelTabType}],execute:function(){i._RF.push({},"97a95ujGGlNSYvx+fcwSZne","DrawMainView",void 0);var E=[2,1012,1013],P=(t("default",function(t){function i(){var o;return(o=t.call(this)||this).nodeResParent=void 0,o.nodeResItem=void 0,o.waitShowTxPool=void 0,o.poolList=void 0,o.poolIdToHaveEffect=void 0,o.tabListDefine=[{zhuazi:"ck_ui_zhuazi",progressIcon:"ck_ui_jindudi",bg:"ck_bg_wawaji",tabBg:"ck_ui_biaotidi",staticAnim:"idle_2_1",anim:"idle_1",cfg:configCard_pool_type.getDataByKey(1)},{zhuazi:"ck_ui_zhuazi2",progressIcon:"ck_ui_jindudi2",bg:"ck_bg_wawaji2",tabBg:"ck_ui_biaotidi2",staticAnim:"idle_1_1",anim:"idle_2",cfg:configCard_pool_type.getDataByKey(2)}],o.tabShowItemList=[],o.resItems=void 0,o.tabType=void 0,o.poolItem=void 0,o.bg=void 0,o.tabBg=void 0,o.progressIcon=void 0,o.anim=void 0,o.zhuaziIcon=void 0,o.name="DrawMainView",o.url="ui/module/draw/DrawMainView",o}o(i,t);var a=i.prototype;return a.onInit=function(){var t=this;this.waitShowTxPool={},this.poolIdToHaveEffect={},this.nodeResParent=this.findChild("resRoot"),this.nodeResItem=this.findChild("resRoot/resItem"),this.nodeResItem.active=!1,this.initResShow();for(var o=function(o){var i=t.findChild("content/tab/item"+(o+1)),n={selected:t.findChild("content/tab/item"+(o+1)+"/select"),item:i,info:t.tabListDefine[o]};t.addComponentCallbackListener(n.item,e.EventType.CLICK,(function(){IS(y).CheckFuncOpen(n.info.cfg.open_id,!0)&&t.ChangeTab(o)})),t.tabShowItemList[o]=n},i=0;i<2;i++)o(i);this.poolItem=new P,this.poolItem.onInit(this,this.findChild("content")),this.bg=this.findChildComponent("bgMask/bg",n),this.tabBg=this.findChildComponent("content/tab",n),this.progressIcon=this.findChildComponent("content/progress",n),this.zhuaziIcon=this.findChildComponent("content/zhuazi",n),this.anim=this.findChildComponent("content/animMask/wawajiAnim",C)},a.initResShow=function(){var t=this;this.resItems=new Array;for(var o=function(o){var i=nodeInstantiate.instantiate(t.nodeResItem),a=E[o];t.addComponentCallbackListener(i,e.EventType.CLICK,(function(){if(1==a)IS(A).TryJumpToMainViewPanel(B.Main_Shop,B.Shop_Gem,[1]);else if(2==a)IS(A).TryJumpToMainViewPanel(B.Main_Shop,B.Shop_Gem,[0]);else{var t=c.findChild(i,"txtNum");IS(D).OpenItemTips(a,t)}})),i.parent=t.nodeResParent,i.active=!0;var d=c.findChildComponent(i,"imgIcon",n),h=configGoods.getDataByKey(a);t.loadIcon(d,h.icon_group,h.icon),c.findChild(i,"imgAdd").active=1==a||2==a,t.resItems.push({node:i,txtNum:c.findChildComponent(i,"txtNum",s),goodsGtid:a})},i=0;i<E.length;i++)o(i)},a.registerUpdateHandler=function(){this.addEvent(T.DRAW_POOL_LIST_UPDATE,this.onDrawPoolListUpdate,this),this.addEvent(T.DRAW_POOL_UPDATE,this.onDrawPoolUpdate,this),this.addEvent(S.ROLE_RES_UPDATE,this.onRoleResUpdate,this),this.addEvent(_.GOODS_INFO_UPDATE,this.onRoleResUpdate,this),this.addEvent(v.AD_INFO_UPDATE,this.onAdInfoUpdate,this),this.addEvent(S.ROLE_OPEN_FUNCTION_UPDATE,this.onRoleOpenFunctionUpdate,this),this.addEvent(T.DRAW_RESULT_VIEW_CLOSE,this.onDrawResultViewClose,this)},a.onAfterOpen=function(){this.tabType=null,normalEvent.emit(R.ViewOpen,this.name),this.updateResShow(),this.ChangeTab(0)},a.ChangeTab=function(t){if(this.tabType!=t){var o,i=this.tabType;this.tabType=t;for(var n=0;n<this.tabShowItemList.length;n++){this.tabShowItemList[n].selected.active=this.tabType==n,this.tabType==n&&(o=this.tabShowItemList[n].info)}null!=i?this.anim.setAnimation(0,o.anim,!1):this.anim.setAnimation(0,o.staticAnim,!1),this.loadIcon(this.bg,"draw2",o.bg),this.loadIcon(this.tabBg,"draw2",o.tabBg,null,p.UI_ATLAS,!0),this.loadIcon(this.progressIcon,"draw2",o.progressIcon,null,p.UI_ATLAS,!0),this.loadIcon(this.zhuaziIcon,"draw2",o.zhuazi),this.showPoolList()}},a.updateResShow=function(){for(var t=0;t<this.resItems.length;t++)this.resItems[t].txtNum.string=f.GetNumString(IS(D).getGoodsCountByGoodsGtid(this.resItems[t].goodsGtid))},a.showPoolList=function(){this.poolList=IS(x).getDrawPoolList();var t=this.poolList[this.tabType];this.poolItem.onRender(t)},a.onBeforeClose=function(){normalEvent.emit(R.ViewClose,this.name),this.waitShowTxPool={},this.poolIdToHaveEffect={}},a.onDestroy=function(){if(this.resItems)for(var t=0;t<this.resItems.length;t++)this.resItems[t].node.destroy();this.resItems={}},a.onDrawPoolListUpdate=function(){this.showPoolList()},a.onDrawPoolUpdate=function(t,o){this.showPoolList(),o&&(this.waitShowTxPool[t]=!0)},a.onRoleResUpdate=function(){this.updateResShow(),this.showPoolList()},a.onAdInfoUpdate=function(t){t!=I.AD_DRAW_PET&&t!=I.AD_DRAW_SKILL||this.showPoolList()},a.onRoleOpenFunctionUpdate=function(){this.showPoolList()},a.onDrawResultViewClose=function(){},i}(u)),function(){function t(){this.txtLevel=void 0,this.pbNum=void 0,this.txtNum=void 0,this.drawBtnItems=void 0,this.txtAdDesc=void 0,this.txtAdCount=void 0,this.nodeAdIcon=void 0,this.poolInfo=void 0,this.poolCfg=void 0,this.poolLvCfg=void 0,this.adId=void 0,this.view=void 0,this.node=void 0}var o=t.prototype;return o.onInit=function(t,o){var i=this;this.view=t,this.node=o,this.txtLevel=c.findChildComponent(this.node,"progress/level",s),this.pbNum=c.findChildComponent(this.node,"progress/ProgressBar",a),this.txtNum=c.findChildComponent(this.node,"progress/txtNum",s);var r=c.findChild(this.node,"progress/tip");this.view.addComponentCallbackListener(r,e.EventType.CLICK,(function(){i.onTipClick()}));var f=c.findChild(this.node,"btnAd");this.txtAdDesc=c.findChildComponent(this.node,"btnAd/txtDesc",s),this.txtAdCount=c.findChildComponent(this.node,"btnAd/txtCount",s),this.nodeAdIcon=c.findChild(this.node,"btnAd/imgAd"),this.view.loadIcon(this.nodeAdIcon.getComponent(n),"draw","ck_icon_guanggao"),this.nodeAdIcon.active=1==m.ads_icon_is_show,this.txtAdCount.node.position=1==m.ads_icon_is_show?new d(-32,-3.18,0):new d(-73,-3.19,0),this.view.addComponentCallbackListener(f,e.EventType.CLICK,(function(){i.onAdClick()})),this.drawBtnItems=new Array;for(var u=function(t){var o=c.findChild(i.node,h.formatStr("btnDraw%s",t+1));i.view.addComponentCallbackListener(o,e.EventType.CLICK,(function(){i.onDrawClick(t)})),i.drawBtnItems.push({node:o,imgBtnDraw:o.getComponent(n),nodeCost1:c.findChild(o,"cost/costItem1"),nodeCost2:c.findChild(o,"cost/costItem2"),imgCost1:c.findChildComponent(o,"cost/costItem1/imgCost",n),imgCost2:c.findChildComponent(o,"cost/costItem2/imgCost",n),txtName:c.findChildComponent(o,"txtName",s),outLineName:c.findChildComponent(o,"txtName",l),txtCost1:c.findChildComponent(o,"cost/costItem1/txtCost",s),txtCost2:c.findChildComponent(o,"cost/costItem2/txtCost",s),outLineCost1:c.findChildComponent(o,"cost/costItem1/txtCost",l),outLineCost2:c.findChildComponent(o,"cost/costItem2/txtCost",l)})},p=0;p<2;p++)u(p)},o.onDrawClick=function(t){var o=this,i=this.poolCfg.treasure[t],n=IS(D).getGoodsCountByGoodsGtid(i[1][0]);if(n<i[1][1]){var e=configGoods.getDataByKey(i[1][0]),s=configGoods.getDataByKey(e.price[0]),a=(i[1][1]-n)*e.price[1],d=i[1][1]-n,h=f.formatStrWithMirrorDeal(GetLanguage(200237),a,s.name,d);L.showBoxTip({tip:h,title:GetLanguage(200048),todayTog:"Draw_"+e.id,func:function(t){if("type_yes"==t){if(a>IS(D).getGoodsCountByGoodsGtid(e.price[0]))return void L.showFlyTip(GetLanguage(200240));IS(b).reqDraw(o.poolInfo.pool_id,i[0])}}})}else IS(b).reqDraw(this.poolInfo.pool_id,i[0])},o.onTipClick=function(){uiMgr.openView("PoolInfoView",this.poolInfo.pool_id,this.poolInfo.pool_lv)},o.onAdClick=function(){IS(w).tryWatchAd(this.adId)},o.onRender=function(t,o){this.poolInfo=t;var i=this.poolInfo.pool_id,n=this.poolInfo.pool_lv;this.poolCfg=configCard_pool_type.getDataByKey(i),1==i?this.adId=I.AD_DRAW_SKILL:2==i&&(this.adId=I.AD_DRAW_PET),this.updateAdInfo(),this.txtLevel.string=h.formatStr("Lv.%s",this.poolInfo.pool_lv);for(var e,s,a,d=this.poolCfg.treasure,l=0;l<2;l++){var c=d[l],u=this.drawBtnItems[l];if(null!=c){u.node.active=!0,u.txtName.string=f.formatStrWithMirrorDeal(GetLanguage(13810012),c[0]);var p=c[1];e=p[0];var C=configGoods.getDataByKey(e);if(this.view.loadIcon(u.imgCost1,C.icon_group,C.icon),a=p[1],(s=IS(D).getGoodsCountByGoodsGtid(e))>=a)u.nodeCost1.active=!0,u.nodeCost2.active=!1,u.txtCost1.string=a,u.txtCost1.color=new r(255,255,255),u.outLineCost1.color=new r(54,75,20);else{var m=a-s,v=configGoods.getDataByKey(C.price[0]),w=m*C.price[1];this.view.loadIcon(u.imgCost2,v.icon_group,v.icon),u.nodeCost2.active=!0,u.nodeCost1.active=s>0,u.txtCost2.string=w;var _=IS(D).getGoodsCountByGoodsGtid(C.price[0]);u.txtCost2.color=_>=w?new r(255,255,255):new r(204,81,68),u.outLineCost2.color=_>=w?new r(54,75,20):new r(51,51,51),s>0&&(u.txtCost1.string=s,u.txtCost1.color=new r(255,255,255),u.outLineCost1.color=new r(54,75,20))}}else u.node.active=!1}this.poolLvCfg=configCard_pool.getDataByKeys("type",i,"level",n);var L=configCard_pool.getDataByKeys("type",i,"level",n-1),A=g.isEmpty(L)?0:L.num,y=this.poolInfo.count-A;if(0==this.poolLvCfg.num)return this.pbNum.progress=1,void(this.txtNum.string=h.formatStr("%s/Max",y));var S=this.poolLvCfg.num-A;this.txtNum.string=h.formatStr("%s/%s",y,S),this.pbNum.progress=Math.min(1,y/S)},o.updateAdInfo=function(){var t=configAds.getDataByKey(this.adId);this.txtAdDesc.string=f.formatStrWithMirrorDeal(t.desc,IS(w).getAdRewardValue(this.adId));var o=IS(w).getAdWatchCount(this.adId);this.txtAdCount.string=h.formatStr("（%s/%s）",t.times-o,t.times)},o.showUpgradeEff=function(){},t}());i._RF.pop()}}}));

