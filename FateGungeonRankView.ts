System.register("chunks:///_virtual/FateGungeonRankView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./V2.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./index57.ts","./CommonModel.ts","./FriendControl.ts","./FrameDataCache.ts","./RankControl.ts","./RankDefine.ts","./RankModel.ts","./RoleDataCache.ts","./RoleDefine.ts","./BaseView.ts"],(function(i){"use strict";var t,n,e,o,a,r,s,d,h,m,c,l,f,v,g,u,k,I,C,p,R;return{setters:[function(i){t=i.inheritsLoose},function(i){n=i.cclegacy,e=i.Button,o=i.Label,a=i.Sprite,r=i.ScrollView,s=i.js,d=i.sys},function(i){h=i.V2},function(i){m=i.ListItem},function(i){c=i.default},function(i){l=i.default},null,function(i){f=i.CommonModel},function(i){v=i.default},function(i){g=i.FrameDataCache},function(i){u=i.default},function(i){k=i.RankDefine},function(i){I=i.RankModel},function(i){C=i.RoleDataCache},function(i){p=i.PlayerAttr},function(i){R=i.BaseView}],execute:function(){var y;n._RF.push({},"8d58doTBmxApInd2fG15Czb","FateGungeonRankView",void 0);var F="",w=((y={})[1]=new h(0,0),y[2]=new h(0,0),y[3]=new h(0,0),y),L=(i("default",function(i){function n(){var t;return(t=i.call(this)||this).rankList=void 0,t.txtMyRank=void 0,t.txtMyScore=void 0,t.myFrame=void 0,t.myIcon=void 0,t.meRankIconFrame=void 0,t.txtMyName=void 0,t.roleList={},t.rankId=1015,t.rankInfo=void 0,t.curRankPage=void 0,t.name="FateGungeonRankView",t.url="ui/module/fate/FateGungeonRankView",t}t(n,i);var d=n.prototype;return d.onInit=function(){var i=this,t=this.findChild("btnClose");this.addComponentCallbackListener(t,e.EventType.CLICK,(function(){i.close()})),this.txtMyRank=this.findChildComponent("view/myRank/rankNum",o),this.txtMyScore=this.findChildComponent("view/myRank/score",o),this.txtMyName=this.findChildComponent("view/myRank/name",o),this.myFrame=this.findChildComponent("view/myRank/imgFrame",a),this.myIcon=this.findChildComponent("view/myRank/imgFrame/imgIcon",a),this.meRankIconFrame=this.findChildComponent("view/myRank/imgFrame/imgHeadFrame",a);var n=this.findChildComponent("view/rankList",r);this.rankList=this.addUIList(n,L),this.addComponentCallbackListener(n.node,r.EventType.SCROLL_TO_BOTTOM,(function(){if(i.rankInfo&&i.curRankPage<i.rankInfo.max_page){i.curRankPage++;var t=new Array;t.push({type:i.rankId,server:1,page:i.curRankPage}),IS(u).reqRankList(t)}}));for(var s=1;s<=3;s++){var d=new _;d.init(this.findChild("view/topRank/rank"+s),this,s),this.roleList[s]=d}},d.registerUpdateHandler=function(){this.addEvent(k.RankInfoBack,this.UpdateRankInfo,this)},d.onAfterOpen=function(){for(var i in this.roleList)this.roleList.hasOwnProperty(i)&&this.roleList[i].show();this.txtMyName.string=IS(C).GetRoleAttr(p.ROLE_ATTR_NAME),this.loadRemoteIcon(IS(C).GetRoleAttr(p.ROLE_ATTR_HEAD_URL),this.myIcon);var t=configRanktype.getDataByKey(this.rankId);F=t.prefix;var n=new Array;n.push({type:this.rankId,server:1,page:1}),this.curRankPage=1,IS(u).reqRankList(n);var e=IS(g).curFrameId;if(e>0){var o=configAvatar_frame.getDataByKey(e);this.loadIcon(this.meRankIconFrame,"icon_frame",o.icon),this.meRankIconFrame.node.active=!0}else this.meRankIconFrame.node.active=!1},d.onBeforeClose=function(){this.rankList.clearData()},d.onDestroy=function(){},d.UpdateRankInfo=function(){if(this.rankInfo=IS(I).GetRankInfoByType(this.rankId),this.rankInfo){var i;this.txtMyRank.string=0!=this.rankInfo.my_info.rank?this.rankInfo.my_info.rank:GetLanguage(200037),this.txtMyScore.string=s.formatStr("%s%s",F,l.GetNumString(null!=(i=this.rankInfo.my_info.score)?i:0)),this.rankList.datas=this.rankInfo.rank_list;for(var t=1;t<=3;t++)this.roleList[t].show(this.rankInfo.rank_list[t-1])}},n}(R)),function(i){function n(){for(var t,n=arguments.length,e=new Array(n),o=0;o<n;o++)e[o]=arguments[o];return(t=i.call.apply(i,[this].concat(e))||this).imgFrame=void 0,t.imgIcon=void 0,t.imgHeadFrame=void 0,t.txtRank=void 0,t.rankIcon=void 0,t.txtName=void 0,t.txtScore=void 0,t}t(n,i);var r=n.prototype;return r.onInit=function(){var i=this;this.imgFrame=c.findChildComponent(this.node,"imgFrame",a),this.imgIcon=c.findChildComponent(this.node,"imgFrame/imgIcon",a),this.imgHeadFrame=c.findChildComponent(this.node,"imgFrame/imgHeadFrame",a),this.txtRank=c.findChildComponent(this.node,"rankNum",o),this.rankIcon=c.findChildComponent(this.node,"rankIcon",a),this.txtName=c.findChildComponent(this.node,"name",o),this.txtScore=c.findChildComponent(this.node,"score",o),this.view.addComponentCallbackListener(this.imgFrame.node,e.EventType.CLICK,(function(){IS(v).reqOtherRoleNotice(i.data.belong_id)}))},r.onRender=function(i,t){this.view.loadRemoteIcon(i.head.url,this.imgIcon),this.txtName.string=i.name,this.txtScore.string=F+l.GetNumString(i.score),i.rank<=3?(this.rankIcon.node.active=!0,this.txtRank.node.active=!1,this.view.loadIcon(this.rankIcon,"common","common_ICON_paiming0"+i.rank)):(this.rankIcon.node.active=!1,this.txtRank.node.active=!0,this.txtRank.string=i.rank);var n=i.head.frame_id;if(n>0){this.imgHeadFrame.node.active=!0;var e=configAvatar_frame.getDataByKey(n);this.view.loadIcon(this.imgHeadFrame,"icon_frame",e.icon)}else this.imgHeadFrame.node.active=!1},r.onItemClick=function(){IS(v).reqOtherRoleNotice(this.data.info.belong_id)},n}(m)),_=function(){function i(){this.view=void 0,this.node=void 0,this.rank=void 0,this.txtName=void 0,this.txtScore=void 0,this.imgFrame=void 0,this.imgIcon=void 0,this.imgHeadFrame=void 0,this.rankIcon=void 0,this.job=void 0,this.data=void 0,this.role=void 0}var t=i.prototype;return t.init=function(i,t,n){this.view=t,this.node=i,this.rank=n,this.onInit()},t.onInit=function(){var i=this;this.job=c.findChild(this.node,"role"),this.txtName=c.findChildComponent(this.node,"name",o),this.txtScore=c.findChildComponent(this.node,"score",o),this.imgFrame=c.findChild(this.node,"imgFrame"),this.imgIcon=c.findChildComponent(this.node,"imgFrame/imgIcon",a),this.imgHeadFrame=c.findChildComponent(this.node,"imgFrame/imgHeadFrame",a),this.view.addComponentCallbackListener(this.imgFrame,e.EventType.CLICK,(function(){i.data&&IS(v).reqOtherRoleNotice(i.data.belong_id)}));var t=c.findChild(this.node,"role/click");this.view.addComponentCallbackListener(t,e.EventType.CLICK,(function(){i.data&&IS(v).reqOtherRoleNotice(i.data.belong_id)})),this.rankIcon=c.findChildComponent(this.node,"imgFrame/rank_icon",a),this.view.loadIcon(this.rankIcon,"common","common_ICON_paiming0"+this.rank)},t.show=function(i){if(this.data=i,this.txtName.string=GetLanguage(200038),this.txtScore.string=F+"0",this.imgIcon.node.active=!1,this.imgHeadFrame.node.active=!1,null!=this.role&&(this.view.removeUnitModel(this.role),this.role=null),i){var t=i.figure;this.role=IS(f).AddRoleModel(this.view,t,this.job,null,.9),this.view.getUnitModel(this.role).mount=t.mount_figure,d.uiMirror&&(this.view.getUnitModel(this.role).dir=-1),t.mount_figure<=0&&(this.view.getUnitModel(this.role).position=w[this.rank]),this.imgIcon.node.active=!0,this.view.loadRemoteIcon(i.head.url,this.imgIcon),this.txtName.string=i.name,this.txtScore.string=F+l.GetNumString(i.score);var n=i.head.frame_id;if(n>0){this.imgHeadFrame.node.active=!0;var e=configAvatar_frame.getDataByKey(n);this.view.loadIcon(this.imgHeadFrame,"icon_frame",e.icon)}else this.imgHeadFrame.node.active=!1}},i}();n._RF.pop()}}}));

