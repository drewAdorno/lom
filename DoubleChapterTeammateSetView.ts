System.register("chunks:///_virtual/DoubleChapterTeammateSetView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./index57.ts","./ItemIcon.ts","./ConfigGlobal.ts","./ChatDataCache.ts","./ChatDefine.ts","./CommonModel.ts","./MessageView.ts","./ChapterDataCache.ts","./ChapterDefine.ts","./DungeonControl.ts","./BaseSubView.ts"],(function(t){"use strict";var e,i,n,l,o,a,s,r,h,d,c,m,u,f,I,C,p,g,k,v,_,S,y,b,T,L,w;return{setters:[function(t){e=t.inheritsLoose,i=t.createForOfIteratorHelperLoose},function(t){n=t.cclegacy,l=t.Button,o=t.HorizontalTextAlignment,a=t.RichText,s=t.ScrollView,r=t.Label,h=t.Layout,d=t.sys,c=t.Sprite,m=t.js,u=t.Vec3},function(t){f=t.SelectedType,I=t.ListItem},function(t){C=t.default},function(t){p=t.default},null,function(t){g=t.IconAseetType},function(t){k=t.ConfigGlobal},function(t){v=t.ChatDataCache},function(t){_=t.ChatDefine},function(t){S=t.CommonModel},function(t){y=t.default},function(t){b=t.ChapterDataCache},function(t){T=t.ChapterEventDefine},function(t){L=t.default},function(t){w=t.BaseSubView}],execute:function(){n._RF.push({},"3bb6d0T069BTJlm3wpVcqTi","DoubleChapterTeammateSetView",void 0);var D=[1,2,3],x=(t("default",function(t){function n(){var e;return(e=t.call(this)||this).txtNum=void 0,e.scrollTeammateList=void 0,e.curSelectId=void 0,e.curUseId=0,e.curPlayerInfo=void 0,e.teammateList=void 0,e.maxNum=void 0,e.btnGiveUp=void 0,e.btnSelect=void 0,e.btnChoose=void 0,e.nodeHasChoose=void 0,e.txtCurName=void 0,e.nodeRole=void 0,e.modelRole=void 0,e.skillItems=void 0,e.artifactItem=void 0,e.mountItem=void 0,e.wingItem=void 0,e.txtFightPower=void 0,e.attrItems=void 0,e.AttrMap={1001:1,1002:2,1003:3,1024:24},e.name="DoubleChapterTeammateSetView",e.url="ui/module/dungeon/DoubleChapterTeammateSetView",e}e(n,t);var I=n.prototype;return I.onInit=function(){var t=this,e=this.findChild("btnTip");this.addComponentCallbackListener(e,l.EventType.CLICK,(function(){y.showBoxTip({tip:GetLanguage(204796),btnCnt:1,horizontalAlign:o.LEFT})}));var i=this.findChild("btnInvate");this.addComponentCallbackListener(i,l.EventType.CLICK,(function(){IS(v).IsOpenInput()?uiMgr.openView("ChatView",_.ViewType.Private,null,{contentType:_.ChatContentType.Share,linkType:_.ChatLinkType.DoubleChapterInvateShare,cacheData:{},showString:GetLanguage(204928)}):y.showFlyTip(p.formatStrWithMirrorDeal(GetLanguage(200490),k.chat_level))})),this.txtNum=this.findChildComponent("common_ui_xiaotidi/txtNum",a);var n=this.findChildComponent("scrollTeammateList",s);this.scrollTeammateList=this.addUIList(n,x),this.scrollTeammateList.selectedMode=f.SINGLE,this.btnGiveUp=this.findChild("buttons/btnGiveUp"),this.addComponentCallbackListener(this.btnGiveUp,l.EventType.CLICK,(function(){D.includes(t.curSelectId)||y.showBoxTip({tip:GetLanguage(204787),func:function(e){"type_yes"==e&&IS(L).reqDoubleChapterAbandonTeammate(t.curSelectId)}})})),this.btnChoose=this.findChild("buttons/btnChoose"),this.addComponentCallbackListener(this.btnChoose,l.EventType.CLICK,(function(){0==t.curUseId&&((IS(b).doubleChapterInfo.now_dc_level||1)>IS(b).getMaxDoubleChapterId()||IS(L).reqDoubleChapterUseTeammate(t.curSelectId))})),this.btnSelect=this.findChild("buttons/btnSelect"),this.addComponentCallbackListener(this.btnSelect,l.EventType.CLICK,(function(){t.curSelectId!=t.curUseId&&y.showBoxTip({tip:GetLanguage(204788),func:function(e){"type_yes"==e&&IS(L).reqDoubleChapterUseTeammate(t.curSelectId)}})})),this.nodeHasChoose=this.findChild("buttons/hasChoose"),this.addComponentCallbackListener(this.nodeHasChoose,l.EventType.CLICK,(function(){0!=t.curUseId&&(t.curSelectId==t.curUseId&&((IS(b).doubleChapterInfo.now_dc_level||1)>IS(b).getMaxDoubleChapterId()?IS(L).reqDoubleChapterUseTeammate(0):y.showBoxTip({tip:GetLanguage(205269),func:function(t){"type_yes"==t&&IS(L).reqDoubleChapterUseTeammate(0)}})))})),this.txtCurName=this.findChildComponent("nameBg/txtName",r),this.nodeRole=this.findChild("role"),this.adjustMirrorNode(this.nodeRole),this.dealMirrorLayout(this.findChildComponent("common_ui_xiaotidi",h)),this.adjustMirrorNode(this.txtNum.node,0,!0),this.skillItems=new Array;for(var I=function(e){var i=t.findChild(m.formatStr("wearParentSkill/item%s",e)),n={node:i,index:e,imgFrame:i.getComponent(c),nodeSkill:C.findChild(i,"nodeWear"),imgIcon:C.findChildComponent(i,"nodeWear/imgIcon",c),txtLevel:C.findChildComponent(i,"nodeWear/txtLevel",r)};d.uiMirror&&(n.txtLevel.node.scale=new u(1,1,1)),t.skillItems.push(n),t.addComponentCallbackListener(i,l.EventType.CLICK,(function(){t.onSkillClick(e)}))},g=1;g<=6;g++)I(g);var S=this.findChild("wearParentOther/item1");if(d.uiMirror){var T=this.findChild("wearParentOther/item1/txtName"),w=this.findChild("wearParentOther/item2/txtName"),N=this.findChild("wearParentOther/item3/txtName");T.setScale(1,1,1),w.setScale(1,1,1),N.setScale(1,1,1)}this.artifactItem={node:S,imgFrame:S.getComponent(c),nodeSkill:C.findChild(S,"nodeWear"),imgIcon:C.findChildComponent(S,"nodeWear/imgIcon",c)},this.addComponentCallbackListener(S,l.EventType.CLICK,(function(){t.onArtifactClick()}));var U=this.findChild("wearParentOther/item2");this.mountItem={node:U,imgFrame:U.getComponent(c),nodeSkill:C.findChild(U,"nodeWear"),imgIcon:C.findChildComponent(U,"nodeWear/imgIcon",c)},this.addComponentCallbackListener(U,l.EventType.CLICK,(function(){t.onMountClick()}));var A=this.findChild("wearParentOther/item3");this.wingItem={node:A,imgFrame:A.getComponent(c),nodeSkill:C.findChild(A,"nodeWear"),imgIcon:C.findChildComponent(A,"nodeWear/imgIcon",c)},this.addComponentCallbackListener(A,l.EventType.CLICK,(function(){t.onWingClick()})),this.txtFightPower=this.findChildComponent("attrRoot/fightPowerRoot/txtFightPower",r),this.attrItems=[];for(var E,B,M=k.main_attr,P=0;P<M.length;P++){E=m.formatStr("attrRoot/attrParent/attrItem%s",P+1);var O=this.findChild(E);B=M[P];var K=configAttribute.getDataByKey(B),R={txtName:C.findChildComponent(O,"txtAttrName",r),txtValue:C.findChildComponent(O,"txtAttrValue",a),attrId:B,config:K};R.txtName.string=K.name,this.attrItems.push(R)}},I.registerUpdateHandler=function(){this.addEvent(T.DOUBLE_CHAPTER_GET_TEAMMATE_INFO_BACK,this.onDoubleChapterGetTeammateInfoBack,this),this.addEvent(T.DOUBLE_CHAPTER_SINGLE_TEAMMATE_INFO_BACK,this.onDoubleChapterSingleTeammateInfoBack,this),this.addEvent(T.DOUBLE_CHAPTER_USE_TEAMMATE_CHANGE,this.onDoubleChapterUseTeammateChange,this),this.addEvent(T.DOUBLE_CHAPTER_ABANDON_TEAMMATE_CHANGE,this.onDoubleChapterAbandonTeammateChange,this)},I.onAfterOpen=function(){IS(L).reqDoubleChapterGetTeammateInfo()},I.onDoubleChapterGetTeammateInfoBack=function(t){this.curUseId=t.id,null==this.curSelectId&&(this.curSelectId=t.id),this.maxNum=t.max_teammate_num,this.teammateList=t.all_teammate,this.curSelectId==t.id&&null!=t.teammate_detail&&(this.curPlayerInfo=t.teammate_detail),0==this.curSelectId?(this.curSelectId=this.teammateList[0].role_id,IS(L).reqDoubleChapterSingleTeammateInfo(this.curSelectId)):this.updateCurInfo(),this.updateList(),this.updateNum()},I.updateSelect=function(){this.scrollTeammateList.items.forEach((function(t,e,i){t.updateSelect()}))},I.updateCurInfo=function(){this.updateUse(),null!=this.curPlayerInfo&&(this.txtCurName.string=this.curPlayerInfo.name,null!=this.modelRole&&(this.removeUnitModel(this.modelRole),this.modelRole=null),this.modelRole=IS(S).AddRoleModel(this,this.curPlayerInfo.teammate_figure,this.nodeRole),this.getUnitModel(this.modelRole).mount=0,this.showAttr(),this.showSkill(),this.showOther())},I.showSkill=function(){for(var t=this.curPlayerInfo.skill_list,e={},i=0;i<t.length;i++)t[i]&&t[i].skill_id>0&&(e[t[i].pos_id]=t[i]);for(var n=0;n<this.skillItems.length;n++){var l=this.skillItems[n],o=e[n+1];if(o){l.skill=o,l.nodeSkill.active=!0;var a=configSkill.getDataByKey(o.skill_id);this.loadIcon(l.imgFrame,"icon_skill",m.formatStr("common_ICON_jinengkuang0%s",a.quality)),this.loadIcon(l.imgIcon,"icon_skill",a.icon),l.txtLevel.string=m.formatStr("Lv.%s",o.skill_lv)}else l.skill=null,l.nodeSkill.active=!1,this.loadIcon(l.imgFrame,"icon_skill","common_ICON_jinengwenhao")}},I.showOther=function(){for(var t,e,i,n=this.curPlayerInfo.plan_tab,l=0;l<n.length;l++)6==n[l].plan_type&&(i=n[l].skill_info),7==n[l].plan_type&&(e=n[l].skill_info),8==n[l].plan_type&&(t=n[l].skill_info);if(t&&0!=t.k){var o=configArtifact_skin.getDataByKeys("artifact_id",t.k,"skin_level",t.v);0==o.skin_skill.length&&(o=configArtifact_skin.getDataByKeys("artifact_id",t.k,"skin_level",t.v+1));var a={skill_id:o.skin_skill[0][0],skill_lv:o.skin_skill[0][1]};this.artifactItem.skill=a,this.artifactItem.nodeSkill.active=!0;var s=configSkill.getDataByKey(a.skill_id);this.loadIcon(this.artifactItem.imgFrame,"icon_skill",m.formatStr("common_ICON_jinengkuang0%s",s.quality)),this.loadIcon(this.artifactItem.imgIcon,"icon_skill",s.icon,null,g.ICON_SPRITE)}else this.artifactItem.skill=null,this.artifactItem.nodeSkill.active=!1,this.loadIcon(this.artifactItem.imgFrame,"icon_skill","common_ICON_jinengwenhao");if(i&&0!=i.k){var r=configBack_skin.getDataByKeys("back_id",i.k,"skin_level",i.v);0==r.skin_skill.length&&(r=configBack_skin.getDataByKeys("back_id",i.k,"skin_level",i.v+1));var h={skill_id:r.skin_skill[0][0],skill_lv:r.skin_skill[0][1]};this.wingItem.skill=h,this.wingItem.nodeSkill.active=!0;var d=configSkill.getDataByKey(h.skill_id);this.loadIcon(this.wingItem.imgFrame,"icon_skill",m.formatStr("common_ICON_jinengkuang0%s",d.quality)),this.loadIcon(this.wingItem.imgIcon,"icon_skill",d.icon,null,g.ICON_SPRITE)}else this.wingItem.skill=null,this.wingItem.nodeSkill.active=!1,this.loadIcon(this.wingItem.imgFrame,"icon_skill","common_ICON_jinengwenhao");if(e&&0!=e.k){var c=configMount_skin.getDataByKeys("mount_id",e.k,"skin_level",e.v);0==c.skin_skill.length&&(c=configMount_skin.getDataByKeys("mount_id",e.k,"skin_level",e.v+1));var u={skill_id:c.skin_skill[0][0],skill_lv:c.skin_skill[0][1]};this.mountItem.skill=u,this.mountItem.nodeSkill.active=!0;var f=configSkill.getDataByKey(u.skill_id);this.loadIcon(this.mountItem.imgFrame,"icon_skill",m.formatStr("common_ICON_jinengkuang0%s",f.quality)),this.loadIcon(this.mountItem.imgIcon,"icon_skill",f.icon,null,g.ICON_SPRITE)}else this.mountItem.skill=null,this.mountItem.nodeSkill.active=!1,this.loadIcon(this.mountItem.imgFrame,"icon_skill","common_ICON_jinengwenhao")},I.showAttr=function(){for(var t,e={},n=i(this.curPlayerInfo.attr_list);!(t=n()).done;){var l=t.value;e[l.k]=l.v}for(var o=0;o<this.attrItems.length;o++)this.attrItems[o].txtValue.string=m.formatStr("<color=#544231><bold>%s</bold></color>",this.getAttrValueById(e,this.attrItems[o].attrId));for(var a=0,s=0;s<this.teammateList.length;s++)if(this.teammateList[s].role_id==this.curSelectId){a=this.teammateList[s].power;break}this.txtFightPower.string=p.GetNumString(a)},I.getAttrValueById=function(t,e){e in this.AttrMap&&(e=this.AttrMap[e]);var i=0;null!=t[e]&&(i=t[e]);var n=p.GetNumString(i)+"",l=configAttribute.getDataByKey(e);return 2==l.show_type?n=m.formatStr("%s%",p.GetNumString(i/100)):3==l.show_type&&(n=p.GetNumString(Math.floor(i/100)/100)+""),n},I.onDoubleChapterSingleTeammateInfoBack=function(t){this.curSelectId==t.id&&(this.curPlayerInfo=t.teammate_detail,this.updateCurInfo())},I.updateUse=function(){var t=(IS(b).doubleChapterInfo.now_dc_level||1)>IS(b).getMaxDoubleChapterId();this.nodeHasChoose.active=0!=this.curUseId&&this.curUseId==this.curSelectId,this.btnChoose.active=0==this.curUseId&&!t,this.btnSelect.active=0!=this.curUseId&&this.curUseId!=this.curSelectId&&!t,this.btnGiveUp.active=(0==this.curUseId||this.curUseId!=this.curSelectId)&&!D.includes(this.curSelectId),this.scrollTeammateList.items.forEach((function(t,e,i){t.updateUse()}))},I.onDoubleChapterUseTeammateChange=function(t){this.curUseId=t,this.updateUse()},I.onDoubleChapterAbandonTeammateChange=function(t){if(null!=this.teammateList){for(var e,i=0;i<this.teammateList.length;i++)if(this.teammateList[i].role_id==t){e=i;break}this.teammateList.splice(e,1),this.curSelectId=this.teammateList[0].role_id,this.updateList(),this.updateNum(),IS(L).reqDoubleChapterSingleTeammateInfo(this.curSelectId)}},I.updateList=function(){this.scrollTeammateList.datas=this.teammateList},I.updateNum=function(){var t=this.teammateList.length,e=t>=this.maxNum?"#e53b3b":"#544231";this.txtNum.string=m.formatStr("<b><color=%s>%s</color><color = #544231>/%s</color></b>",e,t,this.maxNum)},I.onArtifactClick=function(){if(null!=this.artifactItem.skill){var t=configSkill_level.getDataByKeys("id",this.artifactItem.skill.skill_id,"level",this.artifactItem.skill.skill_lv);uiMgr.openView("JobSkillTipsView",p.formatStr.apply(p,[t.desc].concat(t.desc_parm)),this.artifactItem.node)}},I.onMountClick=function(){if(null!=this.mountItem.skill){var t=configSkill_level.getDataByKeys("id",this.mountItem.skill.skill_id,"level",this.mountItem.skill.skill_lv);uiMgr.openView("JobSkillTipsView",p.formatStr.apply(p,[t.desc].concat(t.desc_parm)),this.mountItem.node)}},I.onWingClick=function(){if(null!=this.wingItem.skill){var t=configSkill_level.getDataByKeys("id",this.wingItem.skill.skill_id,"level",this.wingItem.skill.skill_lv);uiMgr.openView("JobSkillTipsView",p.formatStr.apply(p,[t.desc].concat(t.desc_parm)),this.wingItem.node)}},I.onSkillClick=function(t){var e=this.skillItems[t-1];if(null!=e.skill){var i=configSkill_level.getDataByKeys("id",e.skill.skill_id,"level",e.skill.skill_lv);uiMgr.openView("JobSkillTipsView",p.formatStr.apply(p,[i.desc].concat(i.desc_parm)),e.node)}},I.onBeforeClose=function(){this.curUseId=null,this.curSelectId=null,this.curPlayerInfo=null,this.maxNum=null},I.onDestroy=function(){},n}(w)),function(t){function i(){for(var e,i=arguments.length,n=new Array(i),l=0;l<i;l++)n[l]=arguments[l];return(e=t.call.apply(t,[this].concat(n))||this).imgHead=void 0,e.txtName=void 0,e.txtLevel=void 0,e.nodeUse=void 0,e.nodeSelect=void 0,e}e(i,t);var n=i.prototype;return n.onInit=function(){this.imgHead=C.findChildComponent(this.node,"head",c),this.txtName=C.findChildComponent(this.node,"txtName",r),this.txtLevel=C.findChildComponent(this.node,"txtLevel",r),this.nodeUse=C.findChild(this.node,"choose"),this.nodeSelect=C.findChild(this.node,"select")},n.onRender=function(t,e){this.txtName.string=t.name,this.txtLevel.string=m.formatStr("Lv.%s",t.level),this.view.loadRemoteIcon(t.head.url,this.imgHead),this.updateSelect(),this.updateUse()},n.onItemClick=function(){var t=this.view;t.curSelectId!=this.data.role_id&&(t.curSelectId=this.data.role_id,t.updateSelect(),IS(L).reqDoubleChapterSingleTeammateInfo(this.data.role_id))},n.updateSelect=function(){var t=this.view;this.nodeSelect.active=t.curSelectId==this.data.role_id},n.updateUse=function(){var t=this.view;this.nodeUse.active=t.curUseId==this.data.role_id},i}(I));n._RF.pop()}}}));

