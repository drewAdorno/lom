System.register("chunks:///_virtual/ActivityFrogEggView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./V2.ts","./AudioMgr.ts","./index3.ts","./ItemGrid.ts","./RedPoint.ts","./RedPointMgr.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./SpineSkeleton.ts","./ConfigGlobal.ts","./ObjectUtil.ts","./BagDefine.ts","./BagModel.ts","./ResItems.ts","./MessageView.ts","./ActivityControl.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./HorseCarnivalDataCache.ts","./BaseView.ts","./EaseMethod.ts"],(function(t){"use strict";var e,i,o,n,s,r,a,d,h,c,f,l,u,g,m,v,p,w,y,_,T,I,C,S,G,b,L,k,E,x,A,N,R;return{setters:[function(t){e=t.inheritsLoose,i=t.createForOfIteratorHelperLoose},function(t){o=t.cclegacy,n=t.Label,s=t.Button,r=t.Vec2,a=t.Sprite,d=t.Layout,h=t.RichText,c=t.js},function(t){f=t.V2},function(t){l=t.audioMgr},null,function(t){u=t.ItemGrid},function(t){g=t.RedPointType},function(t){m=t.RedPointMgr},function(t){v=t.default},function(t){p=t.default},function(t){w=t.default},null,function(t){y=t.SpineSkeleton},function(t){_=t.ConfigGlobal},function(t){T=t.default},function(t){I=t.BagEventDefine},function(t){C=t.BagModel},function(t){S=t.ResItems},function(t){G=t.default},function(t){b=t.default},function(t){L=t.default},function(t){k=t.ActivityType,E=t.ActivityEventDefine,x=t.ActivityState},function(t){A=t.HorseCarnivalDataCache},function(t){N=t.BaseView},function(t){R=t.EasingMethod}],execute:function(){var V;o._RF.push({},"3361dFR38hOY6PFWrVgaeCu","ActivityFrogEggView",void 0);var F=((V={})[4]={left:220,top:220,num:2},V[9]={left:140,top:80,Num:3},V[16]={left:58,top:6,Num:4},V),D=(t("default",function(t){function o(){var e;return(e=t.call(this)||this).actType=void 0,e.resItems=void 0,e.btnGift=void 0,e.btnStore=void 0,e.skipAnim=void 0,e.showList=[],e.eggList=[],e.layout=void 0,e.txtTitle=void 0,e.txtNum=void 0,e.isGetReward=void 0,e.canGetReward=void 0,e.rewardItem=void 0,e.selectItem=void 0,e.btnWear=void 0,e.btnOneKey=void 0,e.rewardNum=16,e.txtLeftTime=void 0,e.deltaTime=0,e.leftTime=0,e.canUpdate=!1,e.btnNextDoor=void 0,e.reward_list=[],e.lastItemNum=0,e.lastTaskNum=0,e.lastTaskNum2=0,e.costId=0,e.costNum=0,e.extraReward=void 0,e.name="ActivityFrogEggView",e.url="ui/module/activityFrog/ActivityFrogEggView",e.actType=k.FrogEgg,e}e(o,t);var f=o.prototype;return f.onInit=function(){var t=this,e=_.break_gold_egg_expend.find((function(e){return e[0]==t.actType}));this.costId=e[1][0],this.resItems=new S(this),this.resItems.init([e[1][0]]),this.txtLeftTime=this.findChildComponent("root/top/nodeTime/txtTime",n);var o=this.findChild("root/btnClose");this.addComponentCallbackListener(o,s.EventType.CLICK,(function(){t.close()}));var c=this.findChild("root/top/nodeTime/tips");this.addComponentCallbackListener(c,s.EventType.CLICK,(function(){IS(L).ShowSysTips(t.actType)})),this.btnStore=this.findChild("root/bottomBtn/btnStore"),this.addRedPoint("frog_store",this.btnStore,new r(25,30),g.Dot),this.addComponentCallbackListener(this.btnStore,s.EventType.CLICK,(function(){uiMgr.openView("ActivityFrogStoreView",k.Frog)})),this.btnGift=this.findChild("root/bottomBtn/btnGift"),this.addComponentCallbackListener(this.btnGift,s.EventType.CLICK,(function(){uiMgr.openView("ActivityFrogGiftView",t.actType)})),this.btnNextDoor=this.findChild("btnNextFloor"),this.addComponentCallbackListener(this.btnNextDoor,s.EventType.CLICK,(function(){IS(b).send_egg_next(t.actType)}));var f=this.findChild("root/btnShow");this.addComponentCallbackListener(f,s.EventType.CLICK,(function(){uiMgr.openView("ActivityFrogEggTipsView",t.actType)})),this.selectItem=new u(this,this.findChild("root/btnSelect/itemGrid")),this.btnWear=this.findChild("root/btnSelect/btnWear");var l=this.findChild("root/btnSelect");this.addComponentCallbackListener(l,s.EventType.CLICK,(function(){uiMgr.openView("ActivityFrogEggSelectView",t.actType)})),this.skipAnim=this.findChild("mask"),this.addComponentCallbackListener(this.skipAnim,s.EventType.CLICK,(function(){t.SkipAnim()})),this.btnOneKey=this.findChildComponent("root/btnOneKeyDraw",a),this.addComponentCallbackListener(this.btnOneKey.node,s.EventType.CLICK,(function(){if(t.btnNextDoor.active)G.showFlyTip(GetLanguage(400185));else{var e=IS(L).getEggInfo(t.actType);if(e)if(e.ceng<_.one_click_break_gold_egg)G.showFlyTip(p.formatStrWithMirrorDeal(GetLanguage(202101),_.one_click_break_gold_egg));else{if(0==e.choose_goods.gtid)return uiMgr.openView("ActivityFrogEggSelectView",t.actType),void G.showFlyTip(GetLanguage(202016));var o=_.break_gold_egg_expend.find((function(e){return e[0]==t.actType}))[1];if(IS(C).getGoodsCountByGoodsGtid(o[0])<o[1])return G.showFlyTip(GetLanguage(200069)),void uiMgr.openView("ActivityFrogGiftView",t.actType);t.lastItemNum=IS(C).getGoodsCountByGoodsGtid(t.costId),t.lastTaskNum=e.total;for(var n,s=0,r=configBreak_cumulative_times.getDataByList("type",t.actType),a=i(r);!(n=a()).done;){var d=n.value;if(!e.sum_rewards[d.id])break;s++}s>=r.length&&(s=r.length-1),t.lastTaskNum2=r[s].cumulative_times,IS(b).send_egg_open(t.actType,0)}}}));for(var m=1;m<=5;m++){var v=new D;v.init(this.findChild("root/top/rewardContent/rewardItem"+m),this,m),this.showList.push(v)}this.layout=this.findChildComponent("root/turn/itemRoll",d);for(var w=1;w<=this.rewardNum;w++){var y=new M;y.init(this.findChild("root/turn/itemRoll/item"+w),this,w),this.eggList[w]=y}this.txtTitle=this.findChildComponent("root/top/title/Label",n),this.txtNum=this.findChildComponent("root/task/num",h),this.isGetReward=this.findChild("root/task/itemGrid/get"),this.canGetReward=this.findChild("root/task/itemGrid/canGet"),this.rewardItem=new u(this,this.findChild("root/task/itemGrid"),(function(){var e=0,o=IS(L).getEggInfo(t.actType);if(o){for(var n,s=IS(L).GetActivityInfo(t.actType),r=configBreak_cumulative_times.getDataByList("type",s.type),a=i(r);!(n=a()).done;){var d=n.value;if(!o.sum_rewards[d.id])break;e++}e>=r.length&&(e=r.length-1);var h=r[e];!o.sum_rewards[h.id]&&o.total>=h.cumulative_times?IS(b).send_egg_reward(t.actType,h.id):IS(C).OpenItemTips(h.reward[0],t.rewardItem.node)}}))},f.registerUpdateHandler=function(){this.addEvent(I.GOODS_INFO_UPDATE,this.updateResShow,this),this.addEvent(E.OnActivityEggUpdate,this.updateInfo,this),this.addEvent(E.OnActivityEggOpen,this.onEggOpenCallBack,this),this.addEvent(E.OnActivityEggReward,this.updateNumReward,this)},f.onAfterOpen=function(){var t;IS(m).updateRed("frog_store"),this.updateResShow(),IS(b).send_egg_info(this.actType),this.skipAnim.active=!1,this.lastItemNum=0,this.lastTaskNum=0;var e=IS(L).GetActivityInfo(this.actType),i=null!=(t=e.state_time[e.state])?t:e.state_time[x.Open];this.leftTime=i.end_time-w.serverTime,this.leftTime>0?(this.canUpdate=!0,this.txtLeftTime.string=w.formatTimeStringForSecond(this.leftTime)):this.txtLeftTime.string=GetLanguage(200026),this.eggList.forEach((function(t){t.addEffect()}))},f.onBeforeClose=function(){this.eggList.forEach((function(t){t.removeTimer(),t.removeTween()})),this.reward_list=[],this.extraReward=null},f.onDestroy=function(){},f.onUpdate=function(t){this.canUpdate&&(this.deltaTime=this.deltaTime+t,this.deltaTime>=1&&(this.deltaTime=0,this.leftTime=this.leftTime-1,this.leftTime>0?this.txtLeftTime.string=w.formatTimeStringForSecond(this.leftTime):(this.txtLeftTime.string=GetLanguage(200026),this.canUpdate=!1)))},f.updateResShow=function(){0==this.lastItemNum&&this.resItems.update()},f.updateInfo=function(){var t,e=IS(L).getEggInfo(this.actType);if(e){var o=IS(L).GetActivityInfo(this.actType);this.txtTitle.string=p.formatStrWithMirrorDeal(GetLanguage(200284),e.ceng),this.btnOneKey.grayscale=e.ceng<_.one_click_break_gold_egg;for(var n,s=[],r=i(configBreak_gold_egg_layers.getDatas());!(n=r()).done;){var a=n.value;a.type==o.type&&a.group_id==o.roundCfg.group_id&&s.push(a)}s.sort((function(t,e){return t.layers-e.layers}));var d=(null!=(t=s.find((function(t){return t.layers==e.ceng})))?t:s[s.length-1]).num,h=F[d];this.layout.paddingLeft=h.left,this.layout.paddingTop=h.top,this.layout.constraintNum=h.num,this.layout.updateLayout(),0==e.choose_goods.gtid?(this.selectItem.node.active=!1,this.btnWear.active=!0):(this.selectItem.node.active=!0,this.btnWear.active=!1,this.selectItem.SetItemId(e.choose_goods.gtid,e.choose_goods.num));for(var c,f=[],l=i(configBreak_big_prize_preview.getDatas());!(c=l()).done;){var u=c.value;u.type==o.type&&f.push(u)}f.sort((function(t,e){return t.id-e.id}));for(var g=-1,m=0;m<f.length-5;m++){var v=f[m];if(e.ceng<=v.level[0])break;g=m}g++;for(var w=0;w<this.showList.length;w++){var y=f[g+w],I=y.good_id[0],C=y.good_id[1],S=y.level[0],G=e.ceng>S?3:1;this.showList[w].show([S,[I,C]],G)}for(var b=1;b<=this.rewardNum;b++)b<=d?(this.eggList[b].node.active=!0,this.eggList[b].show(e.pos_rewards[b])):this.eggList[b].node.active=!1;this.btnNextDoor.active=e.pos_rewards&&T.getPropertyCount(e.pos_rewards)==d,this.updateNumReward()}},f.updateNumReward=function(){for(var t,e=IS(L).getEggInfo(this.actType),o=IS(L).GetActivityInfo(this.actType),n=0,s=configBreak_cumulative_times.getDataByList("type",o.type),r=i(s);!(t=r()).done;){var a=t.value;if(!e.sum_rewards[a.id])break;n++}this.isGetReward.active=n>=s.length,n>=s.length&&n--,this.canGetReward.active=!e.sum_rewards[s[n].id]&&e.total>=s[n].cumulative_times,0==this.lastTaskNum&&(this.txtNum.string=c.formatStr("<b><color=#ffffff>(%s/%s)</color></b>",c.formatStr("<color=#5dff55>%s</color>",e.total),s[n].cumulative_times)),this.rewardItem.SetItemId(s[n].reward[0],s[n].reward[1])},f.onEggOpenCallBack=function(t){var e=this;if(t.act_type==this.actType){var o=IS(A).GetDrawReward(this.actType),n=o[1]*t.cost_num;if(this.extraReward=[o[0],n],this.updateNumReward(),this.reward_list=[],this.skipAnim.active=!0,0==t.pos){this.reward_list=t.reward;var s=T.copyArray(t.pos_rewards);s.sort((function(t,e){return t.pos-e.pos}));!function i(o){var n=s[o],r=n.goods_id,a=n.goods_num;e.resItems.updateGtid(e.costId,e.lastItemNum-(o+1)),e.txtNum.string=c.formatStr("<b><color=#ffffff>(%s/%s)</color></b>",c.formatStr("<color=#5dff55>%s</color>",e.lastTaskNum+o+1),e.lastTaskNum2),e.eggList[n.pos].doAnim(r,a,(function(){o==s.length-1||t.is_big==n.pos?(uiMgr.openView("GoodsGetView",e.reward_list,e.extraReward),e.skipAnim.active=!1,e.lastItemNum=0,e.lastTaskNum=0,e.updateInfo(),e.updateResShow()):i(o+1)}))}(0)}else if(0!=t.is_big){var r=t.pos_rewards.find((function(e){return e.pos==t.pos})),a=r.goods_id,d=r.goods_num;this.reward_list=t.reward,this.eggList[t.pos].doAnim(a,d,(function(){for(var o,n=i(t.pos_rewards);!(o=n()).done;){var s=o.value;if(s.pos!=t.pos){var r;r=function(){uiMgr.openView("GoodsGetView",e.reward_list,e.extraReward),e.skipAnim.active=!1,e.btnNextDoor.active=!0},e.eggList[s.pos].doAnim(s.goods_id,s.goods_num,r)}}}))}else{var h=t.pos_rewards.find((function(e){return e.pos==t.pos})),f=h.goods_id,l=h.goods_num;this.reward_list=t.reward,this.eggList[t.pos].doAnim(f,l,(function(){uiMgr.openView("GoodsGetView",e.reward_list,e.extraReward),e.skipAnim.active=!1}))}}},f.SkipAnim=function(){this.skipAnim.active=!1,this.lastItemNum=0,this.lastTaskNum=0,this.eggList.forEach((function(t){t.skipAnim()})),0!=this.reward_list.length&&(uiMgr.openView("GoodsGetView",this.reward_list,this.extraReward),this.reward_list=[]),this.updateInfo(),this.updateResShow()},o}(N)),function(){function t(){this.view=void 0,this.node=void 0,this.index=void 0,this.itemGrid=void 0,this.txtFloor=void 0,this.imgSelect=void 0,this.complete=void 0}var e=t.prototype;return e.init=function(t,e,i){this.view=e,this.node=t,this.index=i,this.onInit()},e.onInit=function(){this.itemGrid=new u(this.view,v.findChild(this.node,"itemGrid")),this.txtFloor=v.findChildComponent(this.node,"txtFloor",n),this.imgSelect=v.findChild(this.node,"imgSelect"),this.complete=v.findChild(this.node,"complete")},e.show=function(t,e){this.txtFloor.string=p.formatStrWithMirrorDeal(GetLanguage(200284),t[0]),this.itemGrid.SetItemId(t[1][0],t[1][1]),this.imgSelect.active=2==e,this.complete.active=3==e},t}()),M=function(){function t(){this.view=void 0,this.node=void 0,this.index=void 0,this.itemGrid=void 0,this.effNode=void 0,this.eff=void 0,this.timer=void 0,this.tween=void 0}var e=t.prototype;return e.init=function(t,e,i){this.view=e,this.node=t,this.index=i,this.onInit()},e.onInit=function(){var t=this;this.itemGrid=new u(this.view,v.findChild(this.node,"itemGrid")),this.effNode=v.findChild(this.node,"eff"),this.view.addComponentCallbackListener(this.node,s.EventType.CLICK,(function(){var e=IS(L).getEggInfo(t.view.actType);if(e){if(0==e.choose_goods.gtid)return uiMgr.openView("ActivityFrogEggSelectView",t.view.actType),void G.showFlyTip(GetLanguage(202016));var i=_.break_gold_egg_expend.find((function(e){return e[0]==t.view.actType}))[1];if(IS(C).getGoodsCountByGoodsGtid(i[0])<i[1])return G.showFlyTip(GetLanguage(200069)),void uiMgr.openView("ActivityFrogGiftView",t.view.actType);e.pos_rewards[t.index]||IS(b).send_egg_open(t.view.actType,t.index)}}))},e.show=function(t){if(!t){var e=IS(L).getEggInfo(this.view.actType);t=null==e?void 0:e.pos_rewards[this.index]}if(t){var i=this.view.getUIEffect(this.eff);if(i&&i.node)i.node.getComponent(y).setAnimation(0,"idle2",!0)}else{var o=this.view.getUIEffect(this.eff);if(o&&o.node)o.node.getComponent(y).setAnimation(0,"idle",!0)}},e.addEffect=function(){var t=this;this.itemGrid.node.active=!1,this.eff=this.view.addUIEffect("prefab/ui-effect/MX_tx_bsw_zajindan_frog",this.effNode,-1,new f(0,0),1,(function(e){var i=IS(L).getEggInfo(t.view.actType),o=null==i?void 0:i.pos_rewards[t.index];t.show(o)}))},e.doAnim=function(t,e,i){var o=this;this.removeTimer(),this.removeTween(),l.playSound("shuangdan_zajindan");var n=this.view.getUIEffect(this.eff);n&&n.node&&n.node.getComponent(y).setAnimation(0,"skill1",!1);this.timer=this.view.addTimer(.5,0,(function(){o.itemGrid.node.active=!0,o.itemGrid.SetItemId(t,e),o.tween=o.view.addTween(0,1,.5,(function(t,e){o.itemGrid.node.setPosition(5,40*e+40)})).easing(R.SINE_OUT).call((function(){o.itemGrid.node.active=!1;var t=IS(L).getEggInfo(o.view.actType),e=null==t?void 0:t.pos_rewards[o.index];o.show(e),i&&i()}),.2).start()}))},e.skipAnim=function(){this.removeTimer(),this.removeTween(),this.itemGrid.node.active=!1},e.removeTimer=function(){this.timer&&(this.view.removeTimer(this.timer),this.timer=null)},e.removeTween=function(){this.tween&&(this.tween.stop(),this.tween=null)},t}();o._RF.pop()}}}));

