System.register("chunks:///_virtual/SeasonSceneOutlineView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./ConfigSeason_kv.ts","./SeasonControl.ts","./SeasonDataCache.ts","./SeasonDefine.ts","./BaseView.ts"],(function(t){"use strict";var e,i,n,o,r,a,s,d,l,f,u,h,c,v,m,S,g,p,C,I;return{setters:[function(t){e=t.inheritsLoose,i=t.createForOfIteratorHelperLoose},function(t){n=t.cclegacy,o=t.Button,r=t.ScrollView,a=t.Label,s=t.Sprite,d=t.RichText,l=t.js,f=t.sys},function(t){u=t.ItemGrid},function(t){h=t.ListItem},function(t){c=t.default},function(t){v=t.default},function(t){m=t.default},null,function(t){S=t.ConfigSeason_kv},function(t){g=t.default},function(t){p=t.SeasonDataCache},function(t){C=t.SeasonShipEventDefind},function(t){I=t.BaseView}],execute:function(){n._RF.push({},"43234+NTVxCW6ggpdXzMvwQ","SeasonSceneOutlineView",void 0);var _=t("item_2_buffid",{270005:10011,270006:10012,270007:10013}),w=(t("default",function(t){function n(){var e;return(e=t.call(this)||this).scrollGoodsList=void 0,e.timeTxt=void 0,e.awardList=[],e.buffInfo={},e.stationTxt=void 0,e.name="SeasonSceneOutlineView",e.url="ui/module/season/scene-view/SeasonSceneOutlineView",e.poolTime=3e3,e}e(n,t);var h=n.prototype;return h.onInit=function(){var t=this,e=this.findChild("content/btnClose");this.addComponentCallbackListener(e,o.EventType.CLICK,(function(){t.onMaskClick()}));var i=this.findChild("content/btnStart");this.addComponentCallbackListener(i,o.EventType.CLICK,(function(){IS(g).reqOutlineReward()}));var n=this.findChildComponent("content/scrollEquipList",r);this.scrollGoodsList=this.addUIList(n,w),this.timeTxt=this.findChildComponent("content/timeTxt/time",a);for(var l=1;l<4;l++){var f={node:this.findChild("content/icon_bg"+l),icon:this.findChildComponent("content/icon_bg"+l+"/icon",s),rate:this.findChildComponent("content/icon_bg"+l+"/rateTxt",a),award:this.findChildComponent("content/icon_bg"+l+"/awardTxt",a),itemGrid:this.findChild("content/icon_bg"+l+"/itemGrid")};this.awardList.push(f)}this.stationTxt=this.findChildComponent("content/kuang/Label",d)},h.registerUpdateHandler=function(){this.addEvent(C.TYPE_OUTLINE_INFO_UPDATE,this.updateData,this)},h.onMaskClick=function(){this.close()},h.onAfterOpen=function(){IS(g).reqOutlineBoxInfo(),this.addTimer(1,-1,this.refreshIdleTime,this),this.updateData()},h.onBeforeClose=function(){},h.onDestroy=function(){},h.refreshAwardItem=function(){var t=S.SEASON_BATTLE_ONHOOK_TREASURE_OUTPUT;if(t.length>0)for(var e=0;e<this.awardList.length;e++){var n=this.awardList[e];if(n.node.active=!1,t.length>e&&t[e]){var o,r;n.node.active=!0,new u(this,n.itemGrid).SetItemId(t[e][0]);for(var a,s=0,d=configSeason_station_level.getDataByKey(null!=(o=IS(p).station_level)?o:1),f=i(d.attr);!(a=f()).done;){var h=a.value;if(h[0]==_[t[e][0]]){s=h[1];break}}var c=(t[e][1]+(null!=(r=this.buffInfo[t[e][0]])?r:0))*(1e4+s)/1e4;n.rate.string=l.formatStr("%s/m",v.GetNumString(c));for(var m,g=0,C=i(IS(p).outline_reward_list);!(m=C()).done;){var I=m.value;if(I.gtid==t[e][0]){g=I.num;break}}n.award.string=v.GetNumString(g)}}else for(e=0;e<this.awardList.length;e++)this.awardList[e].node.active=!1},h.refreshIdleTime=function(){var t=IS(p).outline_last_time,e=S.SEASON_BATTLE_ONHOOK_TREASURE_LIMIT,i=Math.max(Math.min(m.serverTime-t,e),0),n=m.formatTimeForSecond(i);this.timeTxt.string=n,i%60==0&&this.refreshAwardItem()},h.updateBuffInfo=function(){this.buffInfo={};for(var t,e=i(IS(p).outline_plot_list);!(t=e()).done;)for(var n,o=t.value,r=configSeason_mapevent_reward.getDataByKey(o.k),a=i(r.reward);!(n=a()).done;){var s=n.value;this.buffInfo[s[0]]?this.buffInfo[s[0]]+=s[1]*o.v:this.buffInfo[s[0]]=s[1]*o.v}},h.updateData=function(){this.updateBuffInfo(),this.refreshIdleTime(),this.refreshAwardItem();var t=configSeason_station_level.getDataByKey(IS(p).station_level);this.stationTxt.string=(f.uiMirror?v:l).formatStr(GetLanguage(204721),t.attr[0][1]/100);for(var e={},n=1;n<6;n++)e[n]={k:n,v:0};for(var o,r=i(IS(p).outline_plot_list);!(o=r()).done;){var a=o.value;e[a.k]=a}var s=[];for(var d in e)s.push(e[d]);s.sort((function(t,e){return 0==t.v&&e.v>0?1:0==e.v&&t.v>0?-1:e.k-t.k})),this.scrollGoodsList.datas=s},n}(I)),function(t){function n(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).rewardScroll=void 0,e.txtName=void 0,e.txtNum=void 0,e}e(n,t);var o=n.prototype;return o.onInit=function(){this.txtName=c.findChildComponent(this.node,"name",a),this.txtNum=c.findChildComponent(this.node,"Label",d);var t=c.findChildComponent(this.node,"rewardScroll",r);this.rewardScroll=this.view.addUIList(t,T,!1),this.rewardScroll.touchEvent=!1,this.rewardScroll.lackCenter=!0},o.onRender=function(t,e){for(var n,o=configSeason_mapevent_reward.getDataByKey(t.k).reward,r=[],a=i(o);!(n=a()).done;){var s=n.value;r.push([s[0],s[1]*t.v])}this.rewardScroll.datas=r,this.txtName.string=(f.uiMirror?v:l).formatStr(GetLanguage(204724),t.k),0==t.v?this.txtNum.string=GetLanguage(204723):this.txtNum.string=(f.uiMirror?v:l).formatStr(GetLanguage(204722),t.v)},o.onItemClick=function(){},n}(h)),T=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).itemGridNode=void 0,e.itemGrid=void 0,e.rate=void 0,e}e(i,t);var n=i.prototype;return n.onInit=function(){this.itemGridNode=c.findChild(this.node,"itemGrid"),this.itemGrid=new u(this.view,this.itemGridNode),this.rate=c.findChildComponent(this.node,"rateTxt",a)},n.onRender=function(t,e){this.rate.string=l.formatStr("%s/m",v.GetNumString(t[1])),this.itemGrid.SetItemId(t[0])},i}(h);n._RF.pop()}}}));

