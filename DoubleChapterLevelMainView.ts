System.register("chunks:///_virtual/DoubleChapterLevelMainView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./NodeUtil.ts","./StringUtil.ts","./BaseView.ts","./ItemIcon.ts","./MessageView.ts","./RoleDataCache.ts","./RoleDefine.ts","./ChapterDataCache.ts","./ChapterDefine.ts","./DungeonControl.ts"],(function(e){"use strict";var t,n,i,o,a,l,r,d,h,s,p,f,u,c,C,m,I,g,b,v;return{setters:[function(e){t=e.inheritsLoose},function(e){n=e.cclegacy,i=e.Button,o=e.Label,a=e.UITransform,l=e.Sprite,r=e.ProgressBar,d=e.Widget,h=e.Vec3,s=e.js},function(e){p=e.default},function(e){f=e.default},function(e){u=e.BaseView},function(e){c=e.IconAseetType},function(e){C=e.default},function(e){m=e.RoleDataCache},function(e){I=e.PlayerAttr},function(e){g=e.ChapterDataCache},function(e){b=e.ChapterEventDefine},function(e){v=e.default}],execute:function(){var _;n._RF.push({},"4d6dfU08OdBf5Q9jF9nlK4e","DoubleChapterLevelMainView",void 0);var D=((_={})[1]=.008,_[2]=.215,_[3]=.402,_[4]=.672,_[5]=1,_[6]=1,_);e("default",function(e){function n(){var t;return(t=e.call(this)||this).txtLevel=void 0,t.chapterItems=void 0,t.nodeContent=void 0,t.txtCurChapter=void 0,t.teammateItem=void 0,t.selfItem=void 0,t.defalutIndex=void 0,t.utScroll=void 0,t.name="DoubleChapterLevelMainView",t.url="ui/module/dungeon/DoubleChapterLevelMainView",t.fullScreen=!0,t}t(n,e);var u=n.prototype;return u.onInit=function(){var e=this,t=this.findChild("bottom/btnClose");this.addComponentCallbackListener(t,i.EventType.CLICK,(function(){e.close()}));var n=this.findChild("bottom/btnFight");this.addComponentCallbackListener(n,i.EventType.CLICK,(function(){uiMgr.openView("DoubleChapterLevelDetailView",IS(g).doubleChapterInfo.now_dc_level)}));var h=this.findChild("bottom/btnReward");this.addComponentCallbackListener(h,i.EventType.CLICK,(function(){for(var e,t=IS(g).doubleChapterInfo.now_dc_level||1,n=configDouble_ladder_chapter.getDataByKey(t).chapter,i=configDouble_ladder_chapter.getDatas(),o=0;o<i.length;o++)if(i[o].chapter==n&&i[o].reward&&i[o].reward.length>0){e=i[o].reward;break}uiMgr.openView("RewardPreview",{title:GetLanguage(200151),rewardList:e||[]})})),this.txtLevel=this.findChildComponent("top/title/Label",o),this.txtCurChapter=this.findChildComponent("bottom/title/title/Label",o),this.nodeContent=this.findChild("scrollMiddleShow/view/content"),this.utScroll=this.findChildComponent("scrollMiddleShow",a),this.chapterItems=new Array;for(var f=function(t){var n=e.findChild(s.formatStr("scrollMiddleShow/view/content/item%s",t)),a={node:n,index:t,nodeUnlockBg:p.findChild(n,"imgBgUnlock"),nodeLockBg:p.findChild(n,"imgBgLock"),txtName:p.findChildComponent(n,"txtName",o),nodeLock:p.findChild(n,"imgLock"),nodeCur:p.findChild(n,"imgCur")};e.chapterItems.push(a),e.addComponentCallbackListener(n,i.EventType.CLICK,(function(){e.onClickChapter(t)}))},u=1;u<=6;u++)f(u);var c=this.findChild("bottom/title/title/btnReset");this.addComponentCallbackListener(c,i.EventType.CLICK,(function(){var t=IS(g).doubleChapterInfo.now_dc_level||1;configDouble_ladder_chapter.getDataByKey(t).index<=1||C.showBoxTip({tip:GetLanguage(204801),func:function(t){"type_yes"==t&&(IS(v).reqDoubleChapterRestartChapter(),e.close())}})}));var m=this.findChild("bottom/roleOther");this.teammateItem={node:m,txtName:p.findChildComponent(m,"txtName",o),imgHead:p.findChildComponent(m,"head",l),pbHp:p.findChildComponent(m,"pbHp",r),imgBar:p.findChildComponent(m,"pbHp/Bar",l),txtHp:p.findChildComponent(m,"txtHp",o)};var I=this.findChild("bottom/roleSelf");this.selfItem={node:I,txtName:p.findChildComponent(I,"txtName",o),imgHead:p.findChildComponent(I,"head",l),pbHp:p.findChildComponent(I,"pbHp",r),imgBar:p.findChildComponent(I,"pbHp/Bar",l),txtHp:p.findChildComponent(I,"txtHp",o)};var b=this.findChild("bottom/roleOther/btnDelay");this.addComponentCallbackListener(b,i.EventType.CLICK,(function(){e.onBtnTeammateSkillDelayClick()})),this.adjustMirrorNode(b);var _=this.findChild("bottom/roleSelf/btnDelay");this.addComponentCallbackListener(_,i.EventType.CLICK,(function(){e.onBtnSelfSkillDelayClick()})),this.adjustMirrorNode(_),this.findChildComponent("scrollMiddleShow",d).scheduleOnce((function(){e.setDefalutPosition()}),0)},u.registerUpdateHandler=function(){this.addEvent(b.DOUBLE_CHAPTER_INFO_BACK,this.updateInfo,this),this.addEvent(b.DOUBLE_CHAPTER_INFO_UPDATE,this.updateInfo,this)},u.onAfterOpen=function(){this.updateInfo();var e=IS(g).doubleChapterInfo.now_dc_level||1,t=configDouble_ladder_chapter.getDataByKey(e).index;this.defalutIndex=t,this.setDefalutPosition()},u.setDefalutPosition=function(){if(null!=this.defalutIndex){var e=D[this.defalutIndex],t=-(1640-this.utScroll.height)*e;this.nodeContent.position=new h(-360,t,0)}},u.updateInfo=function(){if(null!=IS(g).doubleChapterInfo){var e=IS(g).doubleChapterInfo.now_dc_level||1,t=configDouble_ladder_chapter.getDataByKey(e);this.txtCurChapter.string=f.formatStrWithMirrorDeal(GetLanguage(204919),t.name),this.txtLevel.string=f.formatStrWithMirrorDeal(GetLanguage(204918),t.chapter);for(var n=new Array,i=configDouble_ladder_chapter.getDatas(),o=0;o<i.length;o++)i[o].chapter==t.chapter&&n.push(i[o]);n.sort((function(e,t){return e.index-t.index}));for(var a=0;a<n.length;a++){var l=n[a],r=this.chapterItems[l.index-1];r.chapter=l.id,r.txtName.string=l.name,r.nodeUnlockBg.active=l.id<=e,r.nodeLockBg.active=l.id>e,r.nodeLock.active=l.id>e,r.nodeCur.active=l.id==e}this.selfItem.txtName.string=IS(g).doubleChapterInfo.my_name,this.loadRemoteIcon(IS(m).GetRoleAttr(I.ROLE_ATTR_HEAD_URL),this.selfItem.imgHead);var d=IS(g).doubleChapterInfo.my_hp/IS(g).doubleChapterInfo.my_max_hp;this.loadIcon(this.selfItem.imgBar,"double_chapter",this.getHpBarImgByHpRate(d),null,c.UI_ATLAS,!0),this.selfItem.pbHp.progress=d,this.selfItem.txtHp.string=s.formatStr("%s%",(100*d).toFixed(1)),this.teammateItem.txtName.string=IS(g).doubleChapterInfo.teammate_name,this.loadRemoteIcon(IS(g).doubleChapterInfo.teammate_head.url,this.teammateItem.imgHead);var h=IS(g).doubleChapterInfo.teammate_hp/IS(g).doubleChapterInfo.teammate_max_hp;this.loadIcon(this.teammateItem.imgBar,"double_chapter",this.getHpBarImgByHpRate(h),null,c.UI_ATLAS,!0),this.teammateItem.pbHp.progress=h,this.teammateItem.txtHp.string=s.formatStr("%s%",(100*h).toFixed(1))}},u.getHpBarImgByHpRate=function(e){return e>=.5?"srfb_ui_jdt_g":e>=.2?"srfb_ui_jdt_y":"srfb_ui_jdt_r"},u.onClickChapter=function(e){var t=this.chapterItems[e-1].chapter;IS(g).doubleChapterInfo.now_dc_level;uiMgr.openView("DoubleChapterLevelDetailView",t)},u.onBtnTeammateSkillDelayClick=function(){uiMgr.openView("DoubleChapterSkillDelayView",2)},u.onBtnSelfSkillDelayClick=function(){uiMgr.openView("DoubleChapterSkillDelayView",1)},u.onBeforeClose=function(){this.defalutIndex=null},u.onDestroy=function(){},n}(u));n._RF.pop()}}}));

