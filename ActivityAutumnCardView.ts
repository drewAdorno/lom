System.register("chunks:///_virtual/ActivityAutumnCardView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./RedPoint.ts","./RedPointMgr.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./BagDefine.ts","./BagModel.ts","./MessageView.ts","./ActivityControl.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./ActivityAutumnDefine.ts","./BaseView.ts"],(function(t){"use strict";var i,e,n,a,s,d,r,o,h,c,u,l,v,f,m,C,w,g,p,k,T,I,L,y,A,R,G,V;return{setters:[function(t){i=t.inheritsLoose},function(t){e=t.cclegacy,n=t.Button,a=t.HorizontalTextAlignment,s=t.Vec2,d=t.Label,r=t.ScrollView,o=t.Color,h=t.Sprite},function(t){c=t.ItemGrid},function(t){u=t.ListItem},function(t){l=t.RedPointType},function(t){v=t.RedPointMgr},function(t){f=t.default},function(t){m=t.default},function(t){C=t.default},null,function(t){w=t.BagEventDefine},function(t){g=t.BagModel},function(t){p=t.default},function(t){k=t.default},function(t){T=t.default},function(t){I=t.ActivityType,L=t.ActivityEventDefine,y=t.ActivityState,A=t.ActivityTaskState},function(t){R=t.CardItemList,G=t.CardItemIcon},function(t){V=t.BaseView}],execute:function(){e._RF.push({},"aeabf2moGdNKJfn0PilXxsi","ActivityAutumnCardView",void 0);t("default",function(t){function e(){var i;return(i=t.call(this)||this).txtLeftTime=void 0,i.cardProgressNum=void 0,i.cardItemList=[],i.taskTitle=void 0,i.taskRewardList=void 0,i.taskRewardBtn=void 0,i.taskReward=void 0,i.taskValueNode=void 0,i.taskValue=void 0,i.tipsView=void 0,i.timer=void 0,i.leftTime=void 0,i.showTaskItem=void 0,i.name="ActivityAutumnCardView",i.url="ui/module/autumn/ActivityAutumnCardView",i}i(e,t);var c=e.prototype;return c.onInit=function(){var t=this,i=this.findChild("imgMask");this.addComponentCallbackListener(i,n.EventType.CLICK,(function(){t.close()}));var e=this.findChild("view/bg/btnClose");this.addComponentCallbackListener(e,n.EventType.CLICK,(function(){t.close()}));var r=this.findChild("view/bg/title/tips");this.addComponentCallbackListener(r,n.EventType.CLICK,(function(){p.showBoxTip({tip:GetLanguage(200747),btnCnt:1,horizontalAlign:a.LEFT})}));var o=this.findChild("view/btnSend");this.addComponentCallbackListener(o,n.EventType.CLICK,(function(){uiMgr.openView("ActivityAutumnCardMsgView")})),this.addRedPoint("ActivityAutumnCardMsgCheck",o,new s(30,33),l.Dot,1),IS(v).updateRed("ActivityAutumnCardMsgCheck"),this.tipsView=this.findChild("tipsView");var h=this.findChild("tipsView/mask");this.addComponentCallbackListener(h,n.EventType.CLICK,(function(){t.tipsView.active=!1}));var c=this.findChild("view/haveTip/btn");this.addComponentCallbackListener(c,n.EventType.CLICK,(function(){t.tipsView.active=!0})),this.txtLeftTime=this.findChildComponent("view/txtLeftTime",d),this.InitCardList(),this.InitTask()},c.InitCardList=function(){var t=this;this.cardProgressNum=this.findChildComponent("view/card/cardProgress/value",d);for(var i=function(i){configGoods.getDataByKey(R[i]);var e=t.findChildComponent("view/card/card"+(i+1),h);t.loadIcon(e,"autumn2",G[R[i]]);var a={id:R[i],normalBg:t.findChild("view/card/card"+(i+1)+"/normalBg"),lightBg:t.findChild("view/card/card"+(i+1)+"/lightBg"),mask:t.findChild("view/card/card"+(i+1)+"/mask"),num:t.findChildComponent("view/card/card"+(i+1)+"/value",d)};t.addComponentCallbackListener(t.findChild("view/card/card"+(i+1)),n.EventType.CLICK,(function(){uiMgr.openView("ActivityAutumnOperateView",R[i])})),t.cardItemList.push(a)},e=0;e<R.length;e++)i(e)},c.InitTask=function(){var t=this;this.taskTitle=this.findChildComponent("view/cardReward/title",d),this.taskRewardBtn=this.findChild("view/cardReward/btnGreen"),this.addComponentCallbackListener(this.taskRewardBtn,n.EventType.CLICK,(function(){IS(k).send_24_15(I.AutumnCard,t.showTaskItem.task_id,t.showTaskItem.group_id)}));var i=this.findChild("view/cardReward/title/tips");this.addComponentCallbackListener(i,n.EventType.CLICK,(function(){})),this.taskReward=this.findChild("view/cardReward/isReward"),this.taskRewardList=this.addUIList(this.findChildComponent("view/cardReward/rewardScroll",r),B,!1),this.taskValueNode=this.findChild("view/cardReward/value"),this.taskValue=this.findChildComponent("view/cardReward/value/value",d)},c.registerUpdateHandler=function(){this.addEvent(w.GOODS_LIST_UPDATE,this.updateInfo,this),this.addEvent(L.OnActivityListUpdate,this.updateTask,this),this.addEvent(L.OnActivityInfoTaskUpdate,this.updateTask,this)},c.onAfterOpen=function(){var t=this;this.tipsView.active=!1,this.updateInfo();var i=IS(T).GetActivityInfo(I.Autumn);if(i){var e,n=null!=(e=i.state_time[i.state])?e:i.state_time[y.Open];this.leftTime=n.end_time-C.serverTime,this.timer&&(this.removeTimer(this.timer),this.timer=null),this.leftTime>0?(this.txtLeftTime.string=m.formatStrWithMirrorDeal(GetLanguage(200776),C.formatActivityTimeStringForSecond(this.leftTime)),this.timer=this.addTimer(1,this.leftTime,(function(){var i=n.end_time-C.serverTime;t.txtLeftTime.string=i>0?m.formatStrWithMirrorDeal(GetLanguage(200776),C.formatActivityTimeStringForSecond(i)):GetLanguage(200026)}))):this.txtLeftTime.string=GetLanguage(200026)}this.updateTask()},c.onBeforeClose=function(){},c.onDestroy=function(){},c.updateInfo=function(){for(var t=0,i=0;i<this.cardItemList.length;i++){var e=this.cardItemList[i],n=IS(g).getGoodsCountByGoodsGtid(e.id);e.num.string=n+"/1",n>0?(e.normalBg.active=!1,e.lightBg.active=!0,e.mask.active=!1,t+=1):(e.normalBg.active=!0,e.lightBg.active=!1,e.mask.active=!0)}this.cardProgressNum.color=new o(t<5?"cf2b2b":"347112"),this.cardProgressNum.string=m.formatStrWithMirrorDeal(GetLanguage(200777),t+"/5")},c.updateTask=function(){var t=IS(T).GetActivityInfo(I.AutumnCard);if(t){var i=[];for(var e in t.task_list)i.push(t.task_list[e]);i.sort((function(t,i){return t.task_id<i.task_id?-1:1})),this.showTaskItem=null;for(var n=0;n<i.length;n++)if(i[n].state!=A.HadGet||n==i.length-1){this.showTaskItem=i[n];break}this.showTaskItem&&(this.taskRewardList.datas=this.showTaskItem.cfg.reward,this.taskTitle.string=this.showTaskItem.cfg.desc,this.taskReward.active=this.showTaskItem.state==A.HadGet,this.showTaskItem.state==A.Normal?(this.taskValueNode.active=!0,this.taskValue.string=this.showTaskItem.count+"/"+this.showTaskItem.cfg.condition[2],this.taskRewardBtn.active=!1):(this.taskValueNode.active=!1,this.taskRewardBtn.active=this.showTaskItem.state==A.CanGet))}},e}(V));var B=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];return(i=t.call.apply(t,[this].concat(n))||this).itemGridNode=void 0,i.itemGrid=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){this.itemGridNode=f.findChild(this.node,"itemGrid"),this.itemGrid=new c(this.view,this.itemGridNode)},n.onRender=function(t,i){this.itemGrid.SetItemId(t[0],t[1])},e}(u);e._RF.pop()}}}));

