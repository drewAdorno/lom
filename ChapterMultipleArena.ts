System.register("chunks:///_virtual/ChapterMultipleArena.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ConfigGlobal.ts","./FixMath.ts","./BattleData.ts","./index83.ts","./MetaAttrib.ts","./EnumDefine.ts","./BaseChapter.ts","./UnitGroupCtr.ts"],(function(t){"use strict";var e,a,r,i,n,s,l,o,u,p;return{setters:[function(t){e=t.inheritsLoose,a=t.createForOfIteratorHelperLoose},function(t){r=t.cclegacy},function(t){i=t.ConfigGlobal},function(t){n=t.FixMath},function(t){s=t.ChapterType},null,function(t){l=t.AttribDefine},function(t){o=t.UnityType},function(t){u=t.BaseChapter},function(t){p=t.UnitGroupCtr}],execute:function(){r._RF.push({},"b97d6XNrOFD+6TLTFsLGp2r","ChapterMultipleArena",void 0);t("ChapterMultipleArena",function(t){function r(){for(var e,a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))||this).arenaPlayerCtrs=[],e}e(r,t);var u=r.prototype;return u.init=function(){this.battleMain.hitThrowDis=!1},u.destroy=function(){},u.getConfig=function(t){return configPvp_chapter.getDataByKey(t)},u.start=function(){for(var t,e=this.battleMain,r=0,s=a(e.playerCtrs);!(t=s()).done;){var l=t.value;r=n.roundInt(r+l.player.data.level)}var o=n.roundInt(r/e.playerCtrs.length),u=configLevel.getDataByKey(o);this.battleMain.injuryReduce=n.round(u.pvp_injury_reduce/1e4),this.battleMain.shieldDecay=n.round(i.shield_correct/1e4),this.battleMain.treatDecay=n.round(i.hp_recovery_correct/1e4)},u.toResult=function(t,e){this.battleMain},u._addPlayer=function(t,e,a,r){var i=this.battleMain,n=new p;n.type=e,n.playerData=a;var u=configChapter_type.getDataByKey(s.DoublePvp).player_points;null!=u[a.pos]&&(n.offsetY=u[a.pos][1],n.offsetX=-u[a.pos][0]);for(var h=a.units,y=0;y<h.length;y++){var c=void 0;h[y].config.type==o.Player?(c=i.unitMgr.addDPVPPlayer(h[y],r),n.player=c):c=i.unitMgr.addPlayer(h[y],r),c.direction=1==e?-1:1,c.data.getAttribMeta(l.att_range).baseValue=1e3,c.data.getAttribMeta(l.detection_range).baseValue=1e3,c.skillAutoDis=1e3,c.config.type==o.FlyPet&&(n.player.flyPet=c),n.units.push(c)}return n.positionSelected(t+e==1?720:0,!0),n},u.loadData=function(t){var e=this.battleMain,a=e.data.playerList;for(var r in a){var i=a[r];if(0==i.team){var n=e.data.playerImage?1:0,s=this._addPlayer(t,n,i,0);e.playerCtrs.push(s)}else{var l=e.data.playerImage?0:1,o=this._addPlayer(t,l,i,1);this.arenaPlayerCtrs.push(o)}}e.mainCtr=e.playerCtrs[0],e.showMainCtr=e.playerCtrs[0],e.data.playerImage&&(e.showMainCtr=this.arenaPlayerCtrs[0])},u.onUpdate=function(t){if(!this.over){for(var e,r=this.battleMain,i=0,n=a(r.playerCtrs);!(e=n()).done;){e.value.player.isDead&&i++}if(i>=r.playerCtrs.length)return this.over=!0,this.toResult(1),!0;if(!this.updateTime(t)){i=0;for(var s,l=a(this.arenaPlayerCtrs);!(s=l()).done;){s.value.player.isDead&&i++}i>=this.arenaPlayerCtrs.length&&(this.over=!0,this.toResult(0))}}},u.updateTime=function(t){if(this.timeModel){if(this.chapterTime<=0){this.over=!0;for(var e,r=this.battleMain,i=0,s=0,l=a(this.arenaPlayerCtrs);!(e=l()).done;){var o=e.value;o.player.isDead||(i=n.roundInt(i+o.player.data.currenHp))}for(var u,p=a(r.playerCtrs);!(u=p()).done;){var h=u.value;h.player.isDead||(s=n.roundInt(s+h.player.data.currenHp))}return this.toResult(s>=i?0:1,!0),!0}this.chapterTime=n.round(this.chapterTime-t),this.chapterTime=Math.max(this.chapterTime,0)}return!1},r}(u));r._RF.pop()}}}));

