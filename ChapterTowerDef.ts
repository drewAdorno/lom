System.register("chunks:///_virtual/ChapterTowerDef.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UnitGroupCtr.ts","./EnumDefine.ts","./EventDefine.ts","./V2.ts","./BaseChapter.ts"],(function(t){"use strict";var n,e,i,r,s,o,a;return{setters:[function(t){n=t.inheritsLoose},function(t){e=t.cclegacy},function(t){i=t.UnitGroupCtr},function(t){r=t.UnityType},function(t){s=t.EventDefine},function(t){o=t.V2},function(t){a=t.BaseChapter}],execute:function(){e._RF.push({},"fe2d7x3tMJD8Jzc2bRKIKOG","ChapterTowerDef",void 0);var u=t("_IdleFormation",{1:360,2:120,3:-130}),c=new o;t("ChapterTowerDef",function(t){function e(){for(var n,e=arguments.length,i=new Array(e),r=0;r<e;r++)i[r]=arguments[r];return(n=t.call.apply(t,[this].concat(i))||this).curDef=0,n._monster=void 0,n}n(e,t);var o=e.prototype;return o.init=function(){this.battleMain.on(s.UnitDead,this.onUnitDead,this)},o.start=function(){this.curDef=3},o.onUpdate=function(t){if(!this.over){var n=this.battleMain;if(this.checkPlayerDead())return this.over=!0,void this.toResult(0);if(!this.updateTime(t)&&this._monster){var e=n.unitMgr.addUnit(this._monster.unitId,1);c.set(this._monster.x,u[this._monster.index]),e.position=c,e.direction=-1,this._monster=null}}},o.destroy=function(){},o.getConfig=function(t){return configReversion_war_chapter.getDataByKey(t)},o.loadData=function(t){var n,e=this.battleMain,r=new i;e.playerCtrs.push(r);for(var s=configReversion_war_chapter.getDataByKey(this.config.id),o=0;o<s.bossList.length;o++){var a=e.unitMgr.addUnit(s.bossList[o]);c.set(130,u[o+1]),a.position=c,r.units.push(a),r.player=a}e.mainCtr=null!=(n=e.mainCtr)?n:e.playerCtrs[0]},o.addMosnter=function(t,n,e){var i;this._monster=null!=(i=this._monster)?i:{},this._monster.unitId=t,this._monster.index=n,this._monster.x=e},o.onUnitDead=function(t){this.battleMain;t.isCallType||t.config.type!=r.DefBoss||(this.curDef--,this.battleMain.emit(s.TFDefChange,this.curDef))},o.checkPlayerDead=function(){if(this.curDef<=0)return!0},o.toResult=function(t,n){},e}(a));e._RF.pop()}}}));

