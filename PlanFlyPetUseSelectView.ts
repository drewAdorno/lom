System.register("chunks:///_virtual/PlanFlyPetUseSelectView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./index57.ts","./ItemIcon.ts","./MessageView.ts","./FlyPetDataCache.ts","./FlyPetDefine.ts","./RoleControl.ts","./RoleDataCache.ts","./RoleDefine.ts","./BaseView.ts"],(function(t){"use strict";var e,i,n,l,s,a,o,c,d,h,r,f,p,v,_,u,y,C,m,g,k;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,n=t.Button,l=t.Sprite,s=t.Label,a=t.Node,o=t.UITransform,c=t.Size,d=t.ScrollView,h=t.js},function(t){r=t.ListItem},function(t){f=t.default},function(t){p=t.default},null,function(t){v=t.IconAseetType},function(t){_=t.default},function(t){u=t.default},function(t){y=t.FlyPetQualityRes},function(t){C=t.default},function(t){m=t.RoleDataCache},function(t){g=t.RoleEventDefine},function(t){k=t.BaseView}],execute:function(){i._RF.push({},"d3296QefpVMBLtiU6hJiI76","PlanFlyPetUseSelectView",void 0);t("default",function(t){function i(){var e;return(e=t.call(this)||this).pet_frame=void 0,e.pet_icon=void 0,e.pet_name=void 0,e.pet_lv=void 0,e.pet_skill_frame=void 0,e.pet_skill_icon=void 0,e.pet_skill_name=void 0,e.pet_skill_desc=void 0,e.pet_skill_cd=void 0,e.beskill_list=void 0,e.select_pet=void 0,e.select_pet_info=void 0,e.pet_list=void 0,e.empty=void 0,e.notice=void 0,e.nodeSkill=void 0,e.nodeChange=void 0,e.nodeAttr=void 0,e.attr_list=[],e.curPlan=void 0,e.attr_rate=void 0,e.btnEnsure=void 0,e.btnUnselect=void 0,e.name="PlanFlyPetUseSelectView",e.url="ui/module/role/PlanFlyPetUseSelectView",e}e(i,t);var r=i.prototype;return r.onInit=function(){var t,e,i=this;this.empty=this.findChild("container/empty"),this.notice=this.findChild("container/notice"),this.nodeSkill=this.findChild("container/nodeSkill"),this.nodeChange=this.findChild("container/nodeChange"),this.nodeAttr=this.findChild("container/attr");var h=this.findChild("imgMask");this.addComponentCallbackListener(h,n.EventType.CLICK,(function(){i.onMaskClick()}));var r=this.findChild("container/btnClose");this.addComponentCallbackListener(r,n.EventType.CLICK,(function(){i.onMaskClick()})),this.pet_frame=this.findChildComponent("container/notice/head/frame",l),this.pet_icon=this.findChildComponent("container/notice/head/icon",l),this.pet_name=this.findChildComponent("container/notice/txtName",s),this.pet_lv=this.findChildComponent("container/notice/txtLv",s),this.pet_skill_frame=this.findChildComponent("container/nodeSkill/Frame",l),this.pet_skill_icon=this.findChildComponent("container/nodeSkill/Icon",l),this.pet_skill_name=this.findChildComponent("container/nodeSkill/txtName",s),this.pet_skill_desc=this.findChildComponent("container/nodeSkill/ScrollView/view/content/item",s),this.pet_skill_desc.node.on(a.EventType.SIZE_CHANGED,(function(){var t=i.findChildComponent("container/nodeSkill/ScrollView/view/content",o),e=i.findChildComponent("container/nodeSkill/ScrollView/view/content/item",o);t.contentSize=new c(t.contentSize.x,e.height+10)})),this.pet_skill_cd=this.findChildComponent("container/nodeSkill/cd/cd",s);var p=this.findChildComponent("container/nodeChange/ScrollView",d);this.beskill_list=this.addUIList(p,I);var v=this.findChildComponent("container/ScrollView",d);this.pet_list=this.addUIList(v,S),this.btnEnsure=this.findChild("container/btnEnsure"),this.addComponentCallbackListener(this.btnEnsure,n.EventType.CLICK,(function(){i.checkHasSelectPet()?IS(C).send_role_update_plan_c2s(i.curPlan,[{k:10,v:i.select_pet}]):_.showFlyTip(GetLanguage(205170))})),this.btnUnselect=this.findChild("container/btnUnSelect"),this.addComponentCallbackListener(this.btnUnselect,n.EventType.CLICK,(function(){i.checkHasSelectPet()?IS(C).send_role_update_plan_c2s(i.curPlan,[{k:10,v:0}]):_.showFlyTip(GetLanguage(205170))}));var u=this.findChild("container/btnCancel");this.addComponentCallbackListener(u,n.EventType.CLICK,(function(){i.close()}));(t={})[1]=205054,t[2]=205055,t[3]=205056;for(var y=((e={})[1]=1002,e[2]=1024,e[3]=1001,e),m=1;m<=3;m++){var g=this.findChild("container/attr/view/content/item"+m),k=f.findChildComponent(g,"txtAttrName",s),P=f.findChildComponent(g,"txtAttrBase",s),w=f.findChildComponent(g,"txtAttrNext",s),B={node:g,attr_id:y[m],txtAttrName:k,txtAttrBase:P,txtAttrNext:w};this.attr_list[m]=B}this.attr_rate=this.findChildComponent("container/attr/view/content/item4/txtAttrBase",s)},r.updateEntry=function(t){var e,i=null!=t?t:[],n=((e={})[3]=1,e[2]=2,e[5]=3,e[1]=4,e[4]=5,e[6]=6,e);i.sort((function(t,e){var i=configFly_entry.getDataByKeys("id",t.k,"level",t.v),l=configFly_entry.getDataByKeys("id",e.k,"level",e.v);return i.quality==l.quality?t.id-e.id:n[i.quality]-n[l.quality]})),this.beskill_list.datas=i},r.updateSkill=function(t){var e=null!=t?t:[];if(!(e.length<=0)){var i=e[0][0],n=configSkill.getDataByKey(i),l=configSkill_level.getDataByKeys("id",i,"level",e[0][1]);this.loadIcon(this.pet_skill_frame,"icon_skill",h.formatStr("common_ICON_jinengkuang0%s",n.quality)),this.loadIcon(this.pet_skill_icon,"icon_skill",n.icon,null,v.ICON_SPRITE),this.pet_skill_name.string=n.name,this.pet_skill_desc.string=p.formatStr.apply(p,[l.desc].concat(l.desc_parm))}},r.updateEmpty=function(){this.empty.active=!this.checkHasSelectPet(),this.notice.active=this.checkHasSelectPet(),this.nodeChange.active=this.checkHasSelectPet(),this.nodeSkill.active=this.checkHasSelectPet(),this.nodeAttr.active=this.checkHasSelectPet()},r.checkHasSelectPet=function(){return this.select_pet&&0!=this.select_pet&&-1!=this.select_pet},r.onMaskClick=function(){this.close()},r.SelectPet=function(t){this.select_pet=t.id,this.select_pet_info=t,this.updateBtns(),this.pet_list.updateAll(),this.updateInfo(),this.updateEmpty()},r.updateBtns=function(){this.btnEnsure.active=this.checkHasSelectPet()&&!IS(m).checkFlyPetInPlan(this.select_pet,this.curPlan),this.btnUnselect.active=this.checkHasSelectPet()&&IS(m).checkFlyPetInPlan(this.select_pet,this.curPlan)},r.updateInfo=function(){var t=configFly.getDataByKey(this.select_pet_info.config_id),e=IS(u).GetPetInfoById(this.select_pet);this.pet_name.string=t.name,1==IS(u).GetIsBianYi(e.entry_list)&&(this.pet_name.string=p.formatStrWithMirrorDeal(GetLanguage(205206),t.name)),""!=e.name&&(this.pet_name.string=e.name),this.pet_lv.string="Lv."+e.level;var i=configFly_level.getDataByKeys("id",e.config_id,"level",e.level),n=IS(u).GetHaveUseItemById(this.select_pet);n&&n.other_times,this.loadIcon(this.pet_frame,"icon_equip",y[t.quality]),this.loadIcon(this.pet_icon,"icon_flypet",t.icon);var l,s=configFly_advance.getDataByKeys("id",e.config_id,"advance_level",e.step);this.updateSkill(s.fly_skill),this.updateEntry(e.entry_list);var a=configFly_level.getDataByKeys("id",e.config_id,"level",e.level+1);if(a&&(l=a.attr),i.if_advance>0&&e.step!=i.if_advance){var o=configFly_advance.getDataByKeys("id",e.config_id,"advance_level",i.if_advance);o&&(l=o.attr)}this.attr_rate.string=e.growth/1e4+"",this.updateAttr(e.attr_list,l)},r.updateAttr=function(t,e){for(var i=null!=t?t:[],n=null!=e?e:[],l={},s=0;s<i.length;s++)l[i[s].k]={now_v:i[s].v,next_v:0};for(var a=0;a<n.length;a++)l[i[a].k].next_v=n[a].v;for(var o=1;o<=3;o++){var c=0;null!=l[this.attr_list[o].attr_id]&&(c=l[this.attr_list[o].attr_id].now_v,l[this.attr_list[o].attr_id].next_v),this.attr_list[o].txtAttrBase.string=p.GetNumString(c);this.attr_list[o].txtAttrNext.string=""}for(var d=1;d<=4;d++)this.adjustMirrorNode(this.findChild("container/attr/view/content/item"+d+"/icon"))},r.onAfterOpen=function(){this.curPlan=this.openArgs[0],this.select_pet=IS(m).getFlyPetByPlan(this.curPlan)||0,this.updateData(),this.updateEmpty()},r.registerUpdateHandler=function(){this.addEvent(g.PLAN_INFO_UPDATE,this.onPlanInfoUpdate,this)},r.onBeforeClose=function(){},r.updateData=function(){var t,e=this,i=null!=(t=IS(u).GetPetList())?t:[],n=[];for(var l in i)i[l]&&n.push(i[l]);if(n.sort((function(t,i){var n=IS(m).checkFlyPetInPlan(t.id,e.curPlan);if(n!=IS(m).checkFlyPetInPlan(i.id,e.curPlan))return n?-1:1;var l=configFly.getDataByKey(t.config_id),s=configFly.getDataByKey(i.config_id),a=IS(u).GetExtByKey(t,1),o=IS(u).GetExtByKey(i,1);return a!=o?o-a:t.level!=i.level?i.level-t.level:t.step!=i.step?i.step-t.step:l.quality!=s.quality?s.quality-l.quality:t.config_id-i.config_id})),this.pet_list.datas=n,n.length>0)if(0==this.select_pet||-1==this.select_pet)this.SelectPet(n[0]);else for(var s=0;s<n.length;s++)if(n[s].id==this.select_pet){this.SelectPet(n[s]);break}},r.onDestroy=function(){},r.onPlanInfoUpdate=function(t){t==this.curPlan&&(this.updateData(),this.updateBtns())},i}(k));var I=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),l=0;l<i;l++)n[l]=arguments[l];return(e=t.call.apply(t,[this].concat(n))||this).addIcon=void 0,e.downIcon=void 0,e.txtName=void 0,e.skill_cfg=void 0,e.quality_list={},e}e(i,t);var l=i.prototype;return l.onInit=function(){var t=this;this.txtName=f.findChildComponent(this.node,"txtName",s),this.addIcon=f.findChild(this.node,"add"),this.downIcon=f.findChild(this.node,"down");for(var e=1;e<=6;e++){var i=f.findChild(this.node,"quality/quality"+e),l=f.findChildComponent(i,"txtQuality",s);this.quality_list[e]={node:i,name:l}}this.view.addComponentCallbackListener(this.node,n.EventType.CLICK,(function(){uiMgr.openView("JobSkillTipsView",p.formatStr.apply(p,[t.skill_cfg.desc].concat(t.skill_cfg.desc_parm)),t.txtName.node)}))},l.onRender=function(t,e){var i=configFly_entry.getDataByKeys("id",t.k,"level",t.v);this.skill_cfg=i,this.txtName.string=i.name;for(var n=1;n<=6;n++)n==i.quality?(this.quality_list[n].node.active=!0,this.quality_list[n].name.string=i.name):this.quality_list[n].node.active=!1},l.onItemClick=function(){},i}(r),S=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),l=0;l<i;l++)n[l]=arguments[l];return(e=t.call.apply(t,[this].concat(n))||this).imgFrame=void 0,e.imgIcon=void 0,e.add=void 0,e.sel=void 0,e.state=void 0,e.txtState=void 0,e.cdNode=void 0,e.p_view=void 0,e.star=void 0,e.nodeUse=void 0,e}e(i,t);var a=i.prototype;return a.onInit=function(){var t=this;this.state=f.findChild(this.node,"state"),this.txtState=f.findChildComponent(this.node,"nodeUse/label",s),this.imgFrame=f.findChildComponent(this.node,"frame",l),this.imgIcon=f.findChildComponent(this.node,"icon",l),this.add=f.findChild(this.node,"add"),this.cdNode=f.findChild(this.node,"cd"),this.sel=f.findChild(this.node,"sel"),this.p_view=this.view,this.view.addComponentCallbackListener(this.node,n.EventType.CLICK,(function(){t.p_view.SelectPet(t.data)})),this.star=f.findChild(this.node,"star"),this.nodeUse=f.findChild(this.node,"using")},a.onRender=function(t,e){var i=configFly.getDataByKey(t.config_id);this.view.loadIcon(this.imgIcon,"icon_flypet",i.icon),this.view.loadIcon(this.imgFrame,"icon_equip",y[i.quality]);var n=t.state,l=IS(u).GetHaveUseItemById(t.id);l&&(n=l.other_state),this.state.active=1==n,this.cdNode.active=2==n,this.sel.active=this.p_view.select_pet==this.data.id,this.star.active=IS(u).GetExtByKey(t,1),this.nodeUse.active=IS(m).checkFlyPetInPlan(this.data.id,this.p_view.curPlan)},a.onItemClick=function(){},i}(r);i._RF.pop()}}}));

