System.register("chunks:///_virtual/ActivityHalloweenPassView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./index57.ts","./ConfigGlobal.ts","./BagDefine.ts","./BagModel.ts","./BattlePassControl.ts","./BattlePassDataCache.ts","./BattlePassDefine.ts","./MessageView.ts","./PayDataCache.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./BaseView.ts"],(function(t){"use strict";var e,i,s,n,o,a,r,d,l,h,c,v,f,u,p,m,x,g,w,I,C,b,_,y,G;return{setters:[function(t){e=t.inheritsLoose,i=t.createForOfIteratorHelperLoose},function(t){s=t.cclegacy,n=t.Button,o=t.Label,a=t.ScrollView,r=t.Sprite,d=t.ProgressBar,l=t.RichText,h=t.js},function(t){c=t.ItemGrid},function(t){v=t.ListItem},function(t){f=t.default},function(t){u=t.default},null,function(t){p=t.ConfigGlobal},function(t){m=t.BagEventDefine},function(t){x=t.BagModel},function(t){g=t.default},function(t){w=t.BattlePassDataCache},function(t){I=t.BattlePassDefine},function(t){C=t.default},function(t){b=t.default},function(t){_=t.default},function(t){y=t.ActivityType},function(t){G=t.BaseView}],execute:function(){s._RF.push({},"08794vFEtNInLCBWaoOnZRe","ActivityHalloweenPassView",void 0);var P=1060,S=(t("default",function(t){function s(){var e;return(e=t.call(this)||this).btnRed=void 0,e.txtNum=void 0,e.txtNumReward=void 0,e.numScroll=void 0,e.scroll=void 0,e.txtPrice=void 0,e.btnBuy=void 0,e.curPassId=0,e.passInfo=void 0,e.rewardScroe=[],e.name="ActivityHalloweenPassView",e.url="ui/module/halloween/ActivityHalloweenPassView",e}e(s,t);var r=s.prototype;return r.onInit=function(){var t=this,e=this.findChild("view/btnClose");this.addComponentCallbackListener(e,n.EventType.CLICK,(function(){t.close()})),this.txtNum=this.findChildComponent("view/banner/num/num",o),this.btnRed=this.findChild("view/banner/btnSend/red");var i=this.findChild("view/banner/btnSend");this.addComponentCallbackListener(i,n.EventType.CLICK,(function(){uiMgr.openView("ItemUseView",P)})),this.txtPrice=this.findChildComponent("view/scroll/titleHigh/btnBuy/Label",o),this.btnBuy=this.findChild("view/scroll/titleHigh/btnBuy"),this.addComponentCallbackListener(this.btnBuy,n.EventType.CLICK,(function(){IS(b).Pay(IS(w).getPassInfo(t.curPassId).bundle_id)}));var s=this.findChildComponent("view/scroll",a);this.scroll=this.addUIList(s,S,!0,0),this.txtNumReward=this.findChildComponent("view/numReward/num",o);var r=this.findChildComponent("view/numReward/ScrollView",a);this.numScroll=this.addUIList(r,E)},r.registerUpdateHandler=function(){this.addEvent(I.BATTLE_PASS_INFO_UPDATE,this.updateBattlePass,this),normalEvent.on(m.GOODS_INFO_UPDATE,this.onBagUpdate,this)},r.onAfterOpen=function(){var t=IS(_).GetActivityInfo(y.HalloweenPass);if(this.curPassId=t.roundCfg.group_id,this.passInfo=IS(w).getPassInfo(this.curPassId),this.passInfo){this.btnBuy.active=!this.passInfo.if_buy;var e=configPay_mall.getDataByKey(this.passInfo.bundle_id);this.txtPrice.string=IS(b).GetPriceString(e.cost_level),this.txtNumReward.string=this.passInfo.total_exp}else this.btnBuy.active=!0;var s=[].concat(configWartoken_reward.getDataByList("id",this.curPassId));s.sort((function(t,e){return t.level-e.level}));var n=0;this.rewardScroe[1]=0;for(var o=0;o<s.length;o++){var a=s[o];n+=a.exp,this.rewardScroe[a.level+1]=n}s.push({level:s[s.length-1].level+1}),this.scroll.datas=s;for(var r,d=p.autumn_panghong_gift,l=i(d);!(r=l()).done;){var h=r.value;if(h[0]==this.curPassId){this.numScroll.datas=h[1];break}}this.txtNum.string="x"+IS(x).getGoodsCountByGoodsGtid(P),this.btnRed.active=IS(x).getGoodsCountByGoodsGtid(P)>0},r.onBeforeClose=function(){},r.onDestroy=function(){},r.onBagUpdate=function(t,e){e==P&&(this.txtNum.string="x"+IS(x).getGoodsCountByGoodsGtid(P),this.btnRed.active=IS(x).getGoodsCountByGoodsGtid(P)>0)},r.updateBattlePass=function(){if(this.passInfo=IS(w).getPassInfo(this.curPassId),this.passInfo){this.btnBuy.active=!this.passInfo.if_buy;var t=configPay_mall.getDataByKey(this.passInfo.bundle_id);this.txtPrice.string=IS(b).GetPriceString(t.cost_level),this.txtNumReward.string=this.passInfo.total_exp}else this.btnBuy.active=!0;this.scroll.updateAll(),this.numScroll.updateAll()},s}(G)),function(t){function s(){for(var e,i=arguments.length,s=new Array(i),n=0;n<i;n++)s[n]=arguments[n];return(e=t.call.apply(t,[this].concat(s))||this).state1=void 0,e.state2=void 0,e.scrollNormal=void 0,e.scrollHigh=void 0,e.lockNode=void 0,e.txtLev=void 0,e.imgLev=void 0,e.pbExp=void 0,e.boxDesc=void 0,e.boxCount=void 0,e.boxExp=void 0,e.boxPb=void 0,e.boxImg=void 0,e}e(s,t);var l=s.prototype;return l.onInit=function(){var t=this;this.adaptiveSize=!0,this.state1=f.findChild(this.node,"state1"),this.state2=f.findChild(this.node,"state2"),this.lockNode=f.findChild(this.node,"state1/high/lock"),this.imgLev=f.findChildComponent(this.node,"state1/pbExp/icon",r),this.txtLev=f.findChildComponent(this.node,"state1/pbExp/icon/txtLabel",o),this.pbExp=f.findChildComponent(this.node,"state1/pbExp",d);var e=f.findChildComponent(this.node,"state1/normal/scroll",a);this.scrollNormal=this.view.addUIList(e,L,!1,0),this.scrollNormal.touchEvent=!1,this.scrollNormal.lackCenter=!0;var i=f.findChildComponent(this.node,"state1/high/scroll",a);this.scrollHigh=this.view.addUIList(i,B,!1,0),this.scrollHigh.touchEvent=!1,this.scrollNormal.lackCenter=!0,this.boxDesc=f.findChildComponent(this.node,"state2/imgExtBG/Label",o),this.boxCount=f.findChildComponent(this.node,"state2/txtExtCount",o),this.boxExp=f.findChildComponent(this.node,"state2/pbExperience/txtExtExp",o),this.boxPb=f.findChildComponent(this.node,"state2/pbExperience",d),this.boxImg=f.findChildComponent(this.node,"state2/imgBox",r),this.view.addComponentCallbackListener(this.boxImg.node,n.EventType.CLICK,(function(){t.onGetExtReward()}));var s=f.findChild(this.node,"state1/high/lock/btnLock");this.view.addComponentCallbackListener(s,n.EventType.CLICK,(function(){IS(b).Pay(IS(w).getPassInfo(t.view.curPassId).bundle_id)}));var l=f.findChild(this.node,"state1/high/lock/mask");this.view.addComponentCallbackListener(l,n.EventType.CLICK,(function(){IS(b).Pay(IS(w).getPassInfo(t.view.curPassId).bundle_id)}))},l.onRender=function(t,e){var i=this.view.passInfo;i&&t.level>i.max_lev?(this.state1.active=!1,this.state2.active=!0,this.ut.height=210,this.showBox()):(this.state1.active=!0,this.state2.active=!1,this.ut.height=120,this.showLev())},l.showLev=function(){var t=this.view.passInfo,e=this.data;if(this.txtLev.string=this.view.rewardScroe[e.level],this.lockNode.active=!!t&&!t.if_buy,t){var s,n;t.lev>=e.level?this.view.loadIcon(this.imgLev,"autumn_pass","zq_ui_numbg01"):this.view.loadIcon(this.imgLev,"autumn_pass","zq_ui_numbg02");var o=null!=(s=null==(n=configWartoken_reward.getDataByKeys("id",t.id,"level",t.lev))?void 0:n.exp)?s:t.need_exp;0==o?this.pbExp.progress=1:e.level==t.lev+1?this.pbExp.progress=t.exp/o-.5:e.level==t.lev?this.pbExp.progress=.5+t.exp/o:e.level<t.lev?this.pbExp.progress=1:this.pbExp.progress=0}else this.pbExp.progress=0;for(var a,r=[],d=i(e.reward);!(a=d()).done;){var l=a.value;r.push({id:e.id,lev:e.level,rewrad:l})}this.scrollNormal.datas=r;for(var h,c=[],v=i(e.high_reward);!(h=v()).done;){var f=h.value;c.push({id:e.id,lev:e.level,rewrad:f})}this.scrollHigh.datas=c},l.showBox=function(){var t=this.view.passInfo;this.boxDesc.string=u.formatStrWithMirrorDeal(GetLanguage(200029),this.view.rewardScroe[t.max_lev],t.extra_need_exp,t.extra_max_times),this.boxCount.string="("+t.extra_times+"/"+t.extra_max_times+")",t.lev<t.max_lev?(this.boxExp.string="0/"+t.extra_need_exp,this.boxPb.progress=0):(this.boxImg.grayscale=t.exp<t.extra_need_exp,this.boxExp.string=t.exp+"/"+t.extra_need_exp,this.boxPb.progress=t.exp/t.extra_need_exp)},l.onGetExtReward=function(){var t=this.view.passInfo;t.extra_times>=t.extra_max_times?C.showFlyTip(GetLanguage(200030)):t.lev>=t.max_lev&&t.exp>=t.extra_need_exp?t.if_buy?1==this.view.curPassId?IS(g).reqBattlePassExtReward():IS(g).send_40_6(this.view.curPassId):C.showFlyTip(GetLanguage(200766)):C.showFlyTip(GetLanguage(200032))},s}(v)),L=function(t){function i(){for(var e,i=arguments.length,s=new Array(i),n=0;n<i;n++)s[n]=arguments[n];return(e=t.call.apply(t,[this].concat(s))||this).canGet=void 0,e.received=void 0,e.itemGridNode=void 0,e.itemGrid=void 0,e}e(i,t);var s=i.prototype;return s.onInit=function(){var t=this;this.canGet=f.findChild(this.node,"canGet"),this.received=f.findChild(this.node,"received"),this.itemGridNode=f.findChild(this.node,"itemGrid"),this.itemGrid=new c(this.view,this.itemGridNode,(function(){t.canGet.active?IS(g).send_40_5(t.view.curPassId,t.data.lev,1):IS(x).OpenItemTips(t.data.rewrad[0],t.node)}))},s.onRender=function(t,e){var i;this.itemGrid.SetItemId(t.rewrad[0],t.rewrad[1]);var s=null==(i=this.view.passInfo)?void 0:i.free_reward[t.lev-1].status;this.canGet.active=1==s,this.received.active=2==s},i}(v),B=function(t){function i(){for(var e,i=arguments.length,s=new Array(i),n=0;n<i;n++)s[n]=arguments[n];return(e=t.call.apply(t,[this].concat(s))||this).canGet=void 0,e.received=void 0,e.itemGridNode=void 0,e.itemGrid=void 0,e}e(i,t);var s=i.prototype;return s.onInit=function(){var t=this;this.canGet=f.findChild(this.node,"canGet"),this.received=f.findChild(this.node,"received"),this.itemGridNode=f.findChild(this.node,"itemGrid"),this.itemGrid=new c(this.view,this.itemGridNode,(function(){t.canGet.active?IS(g).send_40_5(t.view.curPassId,t.data.lev,2):IS(x).OpenItemTips(t.data.rewrad[0],t.node)}))},s.onRender=function(t,e){var i,s,n;this.itemGrid.SetItemId(t.rewrad[0],t.rewrad[1]);var o=null==(i=this.view.passInfo)?void 0:i.high_reward[t.lev-1].status;this.canGet.active=(null==(s=this.view.passInfo)?void 0:s.if_buy)&&1==o,this.received.active=(null==(n=this.view.passInfo)?void 0:n.if_buy)&&2==o},i}(v),E=function(t){function i(){for(var e,i=arguments.length,s=new Array(i),n=0;n<i;n++)s[n]=arguments[n];return(e=t.call.apply(t,[this].concat(s))||this).txtDesc=void 0,e.itemGridNode=void 0,e.effNode=void 0,e.itemGrid=void 0,e.isReward=void 0,e.eff=void 0,e}e(i,t);var s=i.prototype;return s.onInit=function(){var t=this;this.txtDesc=f.findChildComponent(this.node,"desc",l),this.itemGridNode=f.findChild(this.node,"itemGrid"),this.effNode=f.findChild(this.node,"eff"),this.itemGrid=new c(this.view,this.itemGridNode,(function(){var e,i,s=null!=(e=null==(i=t.view)?void 0:i.passInfo.total_exp)?e:0;!t.isReward&&s>=t.data[1]?IS(g).send_40_8(t.view.curPassId,t.data[0]):IS(x).OpenItemTips(t.data[2][0],t.itemGridNode)}))},s.onRender=function(t,e){var i,s,n,o=t[2];this.itemGrid.SetItemId(o[0],o[1]);var a=null!=(i=null==(s=this.view)?void 0:s.passInfo.total_exp)?i:0,r=t[1];this.isReward=null==(n=this.view)?void 0:n.passInfo.specialReward[t[0]],this.view.removeUIEffect(this.eff),this.isReward?this.txtDesc.string=h.formatStr("<outline color=#21150f width=2><color=#ffffff>%s</color></outline>",GetLanguage(200314)):a>=r?(this.txtDesc.string=h.formatStr("<outline color=#21150f width=2><color=#ffffff>%s</color></outline>",GetLanguage(200732)),this.eff=this.view.addUIEffect("prefab/ui-effect/MX_tx_tongyong_daojulingqu",this.effNode,-1)):this.txtDesc.string=h.formatStr("<b><outline color=#21150f width=2><color=#ff1c1c>%s</color><color=#ffffff>/%s</color></outline></b>",a,r)},i}(v);s._RF.pop()}}}));

