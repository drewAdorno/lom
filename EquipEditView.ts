System.register("chunks:///_virtual/EquipEditView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./NodeUtil.ts","./BaseView.ts","./ItemIcon.ts","./ConfigGlobal.ts","./ObjectUtil.ts","./GuideModel.ts","./MessageView.ts","./EquipControl.ts","./EquipDefine.ts","./EquipModel.ts","./RoleControl.ts","./RoleDataCache.ts","./RoleDefine.ts"],(function(t){"use strict";var i,e,n,o,r,a,s,u,c,h,d,l,p,f,g,m,E,I,C,q,v,S,w,y;return{setters:[function(t){i=t.inheritsLoose},function(t){e=t.cclegacy,n=t.Button,o=t.UITransform,r=t.sys,a=t.Layout,s=t.js,u=t.Sprite,c=t.Label,h=t.Vec3},function(t){d=t.default},function(t){l=t.BaseView},function(t){p=t.IconAseetType},function(t){f=t.ConfigGlobal},function(t){g=t.default},function(t){m=t.GuideModel},function(t){E=t.default},function(t){I=t.default},function(t){C=t.EquipEventDefine,q=t.EquipChangeType},function(t){v=t.EquipModel},function(t){S=t.default},function(t){w=t.RoleDataCache},function(t){y=t.ClientData}],execute:function(){e._RF.push({},"88b78+Qg3VNZZixNKKp6eaj","EquipEditView",void 0);for(var _=f.equip_type,b=f.base_attr,L=t("attrToIndex",{}),x=0;x<b.length;x++)L[b[x]]=x;var B=t("carrerTypeToName",{});t("default",function(t){function e(){var i;(i=t.call(this)||this).nodeContent=void 0,i.nodeWearing=void 0,i.nodeCurrent=void 0,i.utContent=void 0,i.utWearing=void 0,i.utCurrent=void 0,i.utInfoWearing=void 0,i.utInfoCurrent=void 0,i.wearingEquipInfo=void 0,i.currentEquipInfo=void 0,i.btnSold=void 0,i.btnWear=void 0,i.currentEquipId=void 0,i.wearingEquipId=void 0,i.isAllHigher=void 0,i.oriBottomPosY=void 0,i.waitingBack=void 0,i.waitTimer=void 0,i.oriWearEquipId=void 0,i.curLocation=void 0,i.canWear=!0,i.curIcon=void 0,i.name="EquipEditView",i.url="ui/module/equip/EquipEditView",i.poolTime=-1;for(var e=0;e<_.length;e++)B[_[e][0]]=GetLanguage(_[e][1]);return i}i(e,t);var l=e.prototype;return l.onInit=function(){var t=this,i=this.findChild("imgMask");this.addComponentCallbackListener(i,n.EventType.CLICK,(function(){t.onMaskClick()})),this.nodeContent=this.findChild("content"),this.utContent=this.nodeContent.getComponent(o),this.nodeWearing=this.findChild("content/wearing"),this.utWearing=this.nodeWearing.getComponent(o),this.nodeCurrent=this.findChild("content/current"),this.utCurrent=this.nodeCurrent.getComponent(o),this.wearingEquipInfo=this.initEquipItem("wearing"),this.currentEquipInfo=this.initEquipItem("current"),this.utInfoWearing=this.findChildComponent("content/wearing/content",o),this.utInfoCurrent=this.findChildComponent("content/current/content",o),this.btnSold=this.findChild("content/current/btnParent/btnSold"),this.addComponentCallbackListener(this.btnSold,n.EventType.CLICK,(function(){t.onSoldClick()})),this.btnWear=this.findChild("content/current/btnParent/btnWear"),this.addComponentCallbackListener(this.btnWear,n.EventType.CLICK,(function(){t.canWear&&(t.onWearClick(),t.canWear=!1,t.addTimer(.2,1,(function(){t.canWear=!0})))})),r.uiMirror&&this.dealMirrorLayout(this.findChildComponent("content/wearing/imgWear",a));var e=this.nodeContent.position,s=this.utContent.height;this.oriBottomPosY=e.y-s},l.initEquipItem=function(t){for(var i=this,e={imgFrame:this.findChildComponent(s.formatStr("content/%s/head/imgFrame",t),u),imgIcon:this.findChildComponent(s.formatStr("content/%s/head/imgIcon",t),u),txtLevel:this.findChildComponent(s.formatStr("content/%s/head/txtLevel",t),c),txtName:this.findChildComponent(s.formatStr("content/%s/content/base/txtName",t),c),txtCarrer:this.findChildComponent(s.formatStr("content/%s/content/base/txtCarrer",t),c),txtSuit:this.findChildComponent(s.formatStr("content/%s/content/base/attrs/txtSuit",t),c),AttrItmes:{normalAttrItems:[],speAttrItems:[]},nodeFigure:this.findChild(s.formatStr("content/%s/newFigure",t))},o=0;o<4;o++){var r=this.findChild(s.formatStr("content/%s/content/base/attrs/attr/baseAttrItem%s",t,o+1)),a={txtName:d.findChildComponent(r,"txtName",c),txtValue:d.findChildComponent(r,"txtValue",c),imgFlag:d.findChildComponent(r,"imgFlag",u),node:r};e.AttrItmes.normalAttrItems.push(a),o<=1&&function(){var r=i.findChild(s.formatStr("content/%s/content/base/attrs/attr/speAttrItem%s",t,o+1)),a={txtName:d.findChildComponent(r,"txtName",c),txtValue:d.findChildComponent(r,"txtValue",c),txtDesc:d.findChildComponent(r,"txtDesc",c),node:r,btnDetail:d.findChild(r,"txtName"),descStr:null,nameStr:null};i.addComponentCallbackListener(a.btnDetail,n.EventType.CLICK,(function(){uiMgr.openView("EquipEditTipsView",a.nameStr,a.descStr,a.btnDetail)})),e.AttrItmes.speAttrItems.push(a)}()}return e},l.registerUpdateHandler=function(){this.addEvent(C.EQUIP_REMOVE,this.onEquipRemove,this),this.addEvent(C.EQUIP_LIST_UPDATE,this.onEquipListUpdate,this)},l.onAfterOpen=function(){if(this.canWear=!0,this.currentEquipId=this.openArgs[0]||0,0!=this.currentEquipId){var t=IS(v).getEquipInfoByEquipId(this.currentEquipId);if(null!=t){var i=configEquipment.getDataByKey(t.config_id);this.curIcon=i.icon,this.curLocation=i.part;var e=IS(v).getEquipByLocation(this.curLocation),n=g.isEmpty(e);if(n)this.wearingEquipId=0;else if(this.wearingEquipId=e.equip_id,this.wearingEquipId==this.currentEquipId)return;this.btnSold.active=!n,this.oriWearEquipId=this.wearingEquipId,this.updateEquipInfos()}}},l.updateEquipInfos=function(){if(0==this.currentEquipId)return this.tryShowEquipChange(),void this.close();this.isAllHigher=!1;var t,i=this.showEquipInfo(this.wearingEquipInfo,this.wearingEquipId,this.nodeWearing,!1),e=(this.showEquipInfo(this.currentEquipInfo,this.currentEquipId,this.nodeContent,!0),352);"hide"==i.status?(e=0,t=-9.5):(this.utWearing.height=e,t=-9.5-e-10);var n=this.nodeCurrent.getPosition();this.nodeCurrent.setPosition(new h(n.x,t,n.z));this.utCurrent.height=483;var o=9.5+e+6+483+24.5;this.utContent.height=o;var r=this.oriBottomPosY+o,a=this.nodeContent.position;this.nodeContent.setPosition(new h(a.x,r,a.z)),normalEvent.emit(C.EQUIP_EDIT_VIEW_OPEN)},l.showEquipInfo=function(t,i,e,n){if(0==i)return e.active=!1,{status:"hide",suitCount:0,hasCarrer:!1};e.active=!0;var o,r=IS(v).getEquipInfoByEquipId(i),a=configEquipment.getDataByKey(r.config_id),u={},c={},h=[];if(1==n){if(o=IS(v).getEquipInfoByEquipId(this.wearingEquipId),!g.isEmpty(o)){for(var d=0;d<o.base_attr.length;d++){var l=o.base_attr[d];u[l.k]=l.v}h=o.rand_attr||[];for(var f=0;f<h.length;f++){var E=h[f];c[E.k]=E.v}}t.nodeFigure.active=IS(v).checkNeedShowRemindIcon(a.icon)}else{var I=IS(w).getClientDataByNum(y.Equip,"replaceable_num");I||(I++,IS(S).send_3_29(y.Equip,1,"replaceable_num",String(I)),IS(m).openGuide(1010))}var C,q=IS(v).getEquipNameShowByEquipConfigId(r.config_id);t.txtName.string=q.name,t.txtName.color=q.color,this.loadIcon(t.imgIcon,a.atlas,a.icon,null,p.ICON_SPRITE),this.loadIcon(t.imgFrame,"icon_equip",configColor.getDataByKey(a.quality).path),t.txtLevel.string=s.formatStr("Lv.%s",r.equip_lv);a.wearable;var _=r.base_attr;_.sort((function(t,i){return L[t.k]<L[i.k]?-1:1}));for(var b,x,B=!0,T=!0,k=0;k<4;k++){var W=t.AttrItmes.normalAttrItems[k],A=_[k];if(g.isEmpty(A))W.node.active=!1;else{W.node.active=!0,b=A.k,x=A.v;var D=configAttribute.getDataByKey(b);if(W.txtName.string=D.name,W.txtValue.string=3==D.show_type?String(Math.floor(x/100)/100):String(x),0==n)W.imgFlag.node.active=!1,T=!1;else if(g.isEmpty(u))W.imgFlag.node.active=!0,this.loadIcon(W.imgFlag,"common","common_ui_tisheng"),T=!1;else{var N=u[b]||0;W.imgFlag.node.active=N!=x||!1,this.loadIcon(W.imgFlag,"common",x>=N?"common_ui_tisheng":"common_ui_xiajiang"),x<N&&(B=!1),x!=N&&(T=!1)}}}for(var F=r.rand_attr||[],P=0;P<2;P++){var V=t.AttrItmes.speAttrItems[P],R=F[P];if(g.isEmpty(R))V.node.active=!1;else{V.node.active=!0,b=R.k,x=R.v;var G=configAttribute.getDataByKey(b);V.txtName.string=G.name,V.txtValue.string=s.formatStr("%s%",100*x/1e4),V.txtDesc.string=G.desc,V.nameStr=G.name,V.descStr=G.desc}}1==n&&(this.isAllHigher=!T&&B);var M=a.suitId;if(0==M)return t.txtSuit.string="",{status:"show",suitCount:0,hasCarrer:C};for(var K=configEquipment_suit.getDataByList("suit_id",M),U="",H=IS(v).getEquipWearCountBySuitId(M),O=0;O<K.length;O++){var Y=K[O];O>0&&(U=s.formatStr("%s\n",U));var Q=s.formatStr("%s(%s/%s):%s",Y.name,H,Y.num,Y.desc);U=s.formatStr("%s%s",U,Q)}return t.txtSuit.string=U,{status:"show",suitCount:K.length,hasCarrer:C}},l.onBeforeClose=function(){(IS(v).clearEquipRemindByIcon(this.curIcon),this.curLocation=0,this.oriWearEquipId=0,this.wearingEquipId=0,this.currentEquipId=0,this.waitingBack=!1,this.curIcon=null,IS(m).newHeadGuide>0)&&(IS(m).newHeadGuide=0,0==IS(w).getClientDataByNum(y.Equip,"new_head")&&(IS(S).send_3_29(y.Equip,1,"new_head",1),IS(m).openGuide(50002)))},l.tryShowEquipChange=function(){var t=IS(v).getEquipByLocation(this.curLocation);(t?t.equip_id:0)!=this.oriWearEquipId&&normalEvent.emit(C.EQUIP_TRY_PLAY_ROLE_EFFECT,this.curLocation)},l.onDestroy=function(){},l.onEquipListUpdate=function(t){if(t==q.UPDATE){this.clearTimer(),this.waitingBack=!1;var i=IS(v).getEquipByLocation(this.curLocation),e=i?i.equip_id:0;if(this.wearingEquipId!=e){var n=this.currentEquipId;this.currentEquipId=this.wearingEquipId,this.wearingEquipId=n,this.updateEquipInfos()}else this.updateEquipInfos()}},l.onEquipRemove=function(t){t==this.currentEquipId&&(this.tryShowEquipChange(),this.close())},l.onMaskClick=function(){this.tryShowEquipChange(),this.close()},l.onSoldClick=function(){var t=this;if(!this.waitingBack)return 0==this.isAllHigher||0==this.checkCurrentEquipCanWear()?(IS(I).reqSellEquip([this.currentEquipId]),this.tryShowEquipChange(),void this.close()):void E.showBoxTip({tip:GetLanguage(200269),title:GetLanguage(200048),ensure:GetLanguage(200054),cancel:GetLanguage(200053),exchange:!0,func:function(i){"type_yes"==i&&(IS(I).reqSellEquip([t.currentEquipId]),t.tryShowEquipChange(),t.close())}})},l.checkCurrentEquipCanWear=function(){var t=IS(v).getEquipInfoByEquipId(this.currentEquipId);if(null==t)return!1;var i=configEquipment.getDataByKey(t.config_id).wearable||0;if(0==i)return!0;var e=IS(w).GetJob();return configJobs.getDataByKey(e).type==i},l.onWearClick=function(){var t=this;this.waitingBack||(0!=this.checkCurrentEquipCanWear()?(IS(I).reqWearEquip(this.currentEquipId),this.waitingBack=!0,this.clearTimer(),this.waitTimer=this.addTimer(1,1,(function(){t.waitingBack=!1})),IS(v).clearEquipRemindByIcon(this.curIcon),0==this.wearingEquipId&&(normalEvent.emit(C.EQUIP_TRY_PLAY_ROLE_EFFECT,this.curLocation),this.close())):E.showFlyTip(GetLanguage(200270)))},l.clearTimer=function(){this.waitTimer&&(this.removeTimer(this.waitTimer),this.waitTimer=null)},e}(l));e._RF.pop()}}}));

