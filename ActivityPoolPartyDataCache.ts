System.register("chunks:///_virtual/ActivityPoolPartyDataCache.ts",["./rollupPluginModLoBabelHelpers.js","cc","./RedPointMgr.ts","./StorageUtil.ts","./TimeUtil.ts","./index57.ts","./ConfigGlobal.ts","./BagDefine.ts","./BagModel.ts","./BattlePassControl.ts","./MainViewModel.ts","./RoleDataCache.ts","./ActivityControl.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./HorseCarnivalDataCache.ts","./ActivityPoolPartyDefine.ts","./BaseView.ts"],(function(t){"use strict";var e,i,n,r,o,a,s,d,c,u,l,h,v,f,g,y,P,p,I,_;return{setters:[function(t){e=t.createForOfIteratorHelperLoose},function(t){i=t.cclegacy,n=t.js},function(t){r=t.RedPointMgr},function(t){o=t.default},function(t){a=t.default},null,function(t){s=t.ConfigGlobal},function(t){d=t.BagEventDefine},function(t){c=t.BagModel},function(t){u=t.default},function(t){l=t.MainViewModel},function(t){h=t.RoleDataCache},function(t){v=t.default},function(t){f=t.default},function(t){g=t.ActivityType,y=t.ActivityState,P=t.ActivityEventDefine},function(t){p=t.HorseCarnivalDataCache},function(t){I=t.ActivityPoolPartyEvent},function(t){_=t.ViewEvent}],execute:function(){i._RF.push({},"309d88gBlZIhZMmXfJ9FZYO","ActivityPoolPartyDataCache",void 0);t("default",function(){var t=i.prototype;function i(){this.sendProList=[{type:g.PoolPartyEndEgg,send:function(){IS(v).send_egg_info(g.PoolPartyEndEgg)},redCheck:function(){}},{type:g.PoolPartyEgg,send:function(){IS(v).send_egg_info(g.PoolPartyEgg)},redCheck:function(){}},{type:g.PoolPartyPuzzle,send:function(){IS(v).send_collect_info(g.PoolPartyPuzzle),IS(v).send_collect_chat_status(g.PoolPartyPuzzle),IS(v).send_collect_show(g.PoolPartyPuzzle)},redCheck:function(){}},{type:g.PoolPartyEndFind,send:function(){IS(v).send_24_52(g.PoolPartyEndFind)},redCheck:function(){}}],this.act_day=1,this.curLevelId=1,this.curLevelCfg=void 0,this.openLevelList=[],this.chapterInfo=[],this.act_day_shot=1,this.curLevelId_shot=1,this.curLevelCfg_shot=void 0,this.openLevelList_shot=[],this.chapterInfo_shot=[],this.newCardMsgRed={},this.preOpenMsgTime={},this.cardChatInfo={},this.viewList=void 0,this.curOpen=0,this.otherViewNum=0,this.isDungeon=void 0,normalEvent.on(P.OnActivityListUpdate,this.activityChange,this),normalEvent.on(P.OnActivityInfoUpdate,this.activityChange,this),normalEvent.on(d.GOODS_INFO_UPDATE,this.onBagUpdate,this),normalEvent.on(P.OnActivityGameInfoUpdate,this.updateGameInfo,this),normalEvent.on(P.OnActivityCollectInfo,this.UpdateNewMsgRed,this),normalEvent.on(P.OnActivityFindUpdate,this.onActivityFindUpdate,this),normalEvent.on(_.ViewOpen,this.onViewOpen,this),normalEvent.on(_.ViewClose,this.onViewClose,this)}return t.clear=function(){},t.updateGameInfo=function(t){if(t.act_type==g.PoolPartyGame){this.act_day=t.act_day,this.openLevelList=[],this.chapterInfo=[];for(var i,n=e(t.chapter_info);!(i=n()).done;){var r=i.value;this.openLevelList.push(r.chapter_id),this.chapterInfo.push(r)}this.openLevelList.sort((function(t,e){return t-e})),this.chapterInfo.sort((function(t,e){return t.chapter_id-e.chapter_id}))}if(t.act_type==g.PoolPartyEndShotGame){this.act_day_shot=t.act_day,this.openLevelList_shot=[],this.chapterInfo_shot=[];for(var o,a=e(t.chapter_info);!(o=a()).done;){var s=o.value;this.openLevelList_shot.push(s.chapter_id),this.chapterInfo_shot.push(s)}this.openLevelList_shot.sort((function(t,e){return t-e})),this.chapterInfo_shot.sort((function(t,e){return t.chapter_id-e.chapter_id}))}normalEvent.emit(I.OnActivityPoolPartyGameLevelUpdate,t.act_type)},t.activityChange=function(t){void 0===t&&(t=null),this.checkPop();for(var e=0;e<this.sendProList.length;e++){var i=this.sendProList[e].type;if(!t||t.type==i){var n=IS(f).GetActivityInfo(i);n&&n.state==y.Open?this.sendProList[e].send():this.sendProList[e].redCheck&&this.sendProList[e].redCheck()}}},t.checkPop=function(){var t=IS(f).GetActivityInfo(g.PoolParty);if(t&&t.state==y.Open){var e,i=a.ServerDate(1e3*a.serverTime),r=n.formatStr("#%s#%s#%s",i.getFullYear(),i.getMonth()+1,i.getDate()),s="ActivityPoolPartyPopView"+IS(h).GetRoleId();if((null!=(e=o.get(s))?e:"")==r)return;uiMgr.ViewIsAddPop("ActivityPoolPartyPopView")||(uiMgr.addPopView("ActivityPoolPartyPopView"),o.set(s,r))}},t.onBagUpdate=function(t,e){1204==e&&(IS(f).UpdateMainRedByActType(g.PoolPartyPass),IS(r).changeValue("poolparty_pass",this.getPassRedNum())),1224==e&&(IS(f).UpdateMainRedByActType(g.PoolPartyEndPass),IS(r).changeValue("poolparty_endpass",this.getEndPassRedNum()))},t.GetRedNum=function(){var t=0;return t+=this.GetStoreRed(),t+=this.getPassRedNum(),t+=this.GetTurnRed(),t+=this.getEggRed(),t+=this.GetCardRed()},t.GetStoreRed=function(){var t=IS(f).GetActivityInfo(g.PoolParty);if(!t||t.state!=y.Open)return 0;if(t){var e,i=String(t.id)+"#"+String(t.round),n="ActivityPoolPartyStoreRed"+IS(h).GetRoleId();return(null!=(e=o.get(n))?e:"")==i?0:1}return 0},t.getPassRedNum=function(){var t=IS(f).GetActivityInfo(g.PoolPartyPass);if(!t||t.state!=y.Open)return 0;var e=0,i=t.roundCfg.group_id;return e=(e=e+u.checkRewardRP(i)>=0?1:0)+u.checkAddRewardRP(i)>0?1:0,e+=u.checkSpecialRewardRP(i),IS(c).getGoodsCountByGoodsGtid(1204)>0&&e++,e},t.GetTurnRed=function(){var t=IS(f).GetActivityInfo(g.PoolPartyTurn);if(!t||t.state!=y.Open)return 0;var e=0;return e+=IS(p).getRedNum(g.PoolPartyTurn),e+=this.GetTurnSelectRed()},t.GetTurnSelectRed=function(){var t=IS(f).GetActivityInfo(g.PoolPartyTurn);if(t){var e,i=String(t.id)+"#"+String(t.round),n="ActivityPoolPartySelectRed"+IS(h).GetRoleId();return(null!=(e=o.get(n))?e:"")==i?0:IS(p).canSelectReward(g.PoolPartyTurn)?1:0}return 0},t.GetShowActNodeIdx=function(t,e){for(var i=t.length-1;i>=0;i--){for(var n=t[i],r=0;r<n.Activity.length;r++)if(e){if(e==n.Activity[r])return i}else{var o=IS(f).GetActivityInfo(n.Activity[r]);if(o&&o.state==y.Open)return i}if(0==i)return i}},t.getEggRed=function(){var t=IS(f).GetActivityInfo(g.PoolPartyEgg);if(!t||t.state!=y.Open)return 0;var i=s.break_gold_egg_expend.find((function(t){return t[0]==g.PoolPartyEgg}))[1];if(IS(c).getGoodsCountByGoodsGtid(i[0])>=16)return 1;var n=0,r=IS(f).getEggInfo(g.PoolPartyEgg);if(!r)return 0;for(var o,a=configBreak_cumulative_times.getDataByList("type",t.type),d=e(a);!(o=d()).done;){var u=o.value;if(!r.sum_rewards[u.id])break;n++}n>=a.length&&(n=a.length-1);var l=a[n];return!r.sum_rewards[l.id]&&r.total>=l.cumulative_times?1:0},t.GetEndRedNum=function(){var t=0;return t+=this.GetEndStoreRed(),t+=this.getEndPassRedNum(),t+=this.GetEndTurnRed(),t+=this.getEndEggRed(),t+=this.getFindRedNum()},t.GetEndStoreRed=function(){var t=IS(f).GetActivityInfo(g.PoolPartyEnd);if(!t||t.state!=y.Open)return 0;if(t){var e,i=String(t.id)+"#"+String(t.round),n="ActivityPoolPartyEndStoreRed"+IS(h).GetRoleId();return(null!=(e=o.get(n))?e:"")==i?0:1}return 0},t.getEndPassRedNum=function(){var t=IS(f).GetActivityInfo(g.PoolPartyEndPass);if(!t||t.state!=y.Open)return 0;var e=0,i=t.roundCfg.group_id;return e=(e=e+u.checkRewardRP(i)>=0?1:0)+u.checkAddRewardRP(i)>0?1:0,e+=u.checkSpecialRewardRP(i),IS(c).getGoodsCountByGoodsGtid(1224)>0&&e++,e},t.GetEndTurnRed=function(){var t=IS(f).GetActivityInfo(g.PoolPartyEndTurn);if(!t||t.state!=y.Open)return 0;var e=0;return e+=IS(p).getRedNum(g.PoolPartyEndTurn),e+=this.GetTurnSelectRed()},t.GetEndTurnSelectRed=function(){var t=IS(f).GetActivityInfo(g.PoolPartyEndTurn);if(t){var e,i=String(t.id)+"#"+String(t.round),n="ActivityPoolPartyEndSelectRed"+IS(h).GetRoleId();return(null!=(e=o.get(n))?e:"")==i?0:IS(p).canSelectReward(g.PoolPartyEndTurn)?1:0}return 0},t.getEndEggRed=function(){var t=IS(f).GetActivityInfo(g.PoolPartyEndEgg);if(!t||t.state!=y.Open)return 0;var i=s.break_gold_egg_expend.find((function(t){return t[0]==g.PoolPartyEndEgg}))[1];if(IS(c).getGoodsCountByGoodsGtid(i[0])>=16)return 1;var n=0,r=IS(f).getEggInfo(g.PoolPartyEndEgg);if(!r)return 0;for(var o,a=configBreak_cumulative_times.getDataByList("type",t.type),d=e(a);!(o=d()).done;){var u=o.value;if(!r.sum_rewards[u.id])break;n++}n>=a.length&&(n=a.length-1);var l=a[n];return!r.sum_rewards[l.id]&&r.total>=l.cumulative_times?1:0},t.UpdateNewMsgRed=function(){var t,e,i=IS(f).GetActivityInfo(g.PoolPartyPuzzle);if(i&&i.state==y.Open){var n=IS(f).getCollectInfo(g.PoolPartyPuzzle);if(n){var a,s=uiMgr.getOpenView("ActivityPoolPartyCardMsgView"),d=IS(h).GetRoleId();if(this.newCardMsgRed[1]=0,!(a=this.preOpenMsgTime[1])){var c,u="ActivityPoolPartyCardMsgCheck_1_"+d;a=null!=(c=o.get(u))?c:0,this.preOpenMsgTime[1]=a}for(var l=0;l<n.send_list.length;l++){var v=n.send_list[l];if((!s||1!=s.curIndex)&&v.start_time>a){this.newCardMsgRed[1]=1;break}}if(this.newCardMsgRed[0]=0,!(a=this.preOpenMsgTime[0])){var P,p="ActivityPoolPartyCardMsgCheck_0_"+d;a=null!=(P=o.get(p))?P:0,this.preOpenMsgTime[0]=a}for(var I=0;I<n.recv_list.length;I++){var _=n.recv_list[I];if((!s||0!=s.curIndex)&&(_.start_time>a||0==_.state)){this.newCardMsgRed[0]=1;break}}IS(r).changeValue("ActivityPoolPartyCardMsgCheck_0",null!=(t=this.newCardMsgRed[0])?t:0),IS(r).changeValue("ActivityPoolPartyCardMsgCheck_1",null!=(e=this.newCardMsgRed[1])?e:0),IS(r).changeValue("ActivityPoolPartyCardMsgCheck",this.GetNewCardMsgRed()),IS(f).UpdateMainRedByActType(g.PoolParty)}}},t.GetNewCardMsgRed=function(){return 1==this.newCardMsgRed[0]||1==this.newCardMsgRed[1]?1:0},t.CheckNewMsgRed=function(t){var e="ActivityPoolPartyCardMsgCheck_"+t+"_"+IS(h).GetRoleId();o.set(e,a.serverTime),this.preOpenMsgTime[t]=a.serverTime,this.newCardMsgRed[t]&&this.newCardMsgRed[t]>0&&this.UpdateNewMsgRed()},t.GetCardRed=function(){if(!IS(f).GetActivityInfo(g.PoolPartyPuzzle))return 0;var t=IS(f).GetTaskRedNum(g.PoolPartyPuzzle);return t+=this.GetNewCardMsgRed()},t.onViewOpen=function(t){if("ActivityFindIcon"!=t){var i=IS(f).GetActivityInfo(g.PoolPartyEndFind);if(i&&i.state==y.Open){if(!this.viewList){this.viewList={};for(var n,r=configMoonfestival_search.getDatas(),o=e(r);!(n=o()).done;){var a=n.value;a.type==i.type&&a.group_id==i.roundCfg.group_id&&(this.viewList[a.system_view]=a.id)}}var s=this.viewList[t];if(s&&s==IS(f).getCurFind(g.PoolPartyEndFind))this.curOpen=s,this.isDungeon||uiMgr.openView("ActivityFindIcon",s),this.otherViewNum=0;else if(0!=this.curOpen){var d=uiMgr.getOpenView("ActivityFindIcon");d&&d.close(),this.otherViewNum++}}}},t.onViewClose=function(t){if("ActivityFindIcon"!=t){var i=IS(f).GetActivityInfo(g.PoolPartyEndFind);if(i&&i.state==y.Open){if(!this.viewList){this.viewList={};for(var n,r=configMoonfestival_search.getDatas(),o=e(r);!(n=o()).done;){var a=n.value;a.type==i.type&&a.group_id==i.roundCfg.group_id&&(this.viewList[a.system_view]=a.id)}}var s=this.viewList[t];if(s&&s==IS(f).getCurFind(g.PoolPartyEndFind)){var d=uiMgr.getOpenView("ActivityFindIcon");d&&d.close(),this.curOpen=0,this.otherViewNum=0}else 0!=this.curOpen&&(this.otherViewNum--,0!=this.otherViewNum||this.isDungeon||uiMgr.openView("ActivityFindIcon",this.curOpen))}}},t.onBattleState=function(t,e){var i=IS(f).GetActivityInfo(g.PoolPartyEndFind);if(i&&i.state==y.Open)if(e){this.isDungeon=!0;var n=uiMgr.getOpenView("ActivityFindIcon");n&&n.close()}else this.isDungeon=!1,0!=this.curOpen&&0==this.otherViewNum&&uiMgr.openView("ActivityFindIcon",this.curOpen)},t.onActivityFindUpdate=function(t){if(t&&t.act_type==g.PoolPartyEndFind&&t.pig_id==this.curOpen){this.curOpen=0;var e=uiMgr.getOpenView("ActivityFindIcon");e&&e.close()}},t.getFindRedNum=function(){var t=IS(f).GetActivityInfo(g.PoolPartyEndFind);if(!t||t.state!=y.Open)return 0;var e=IS(f).getFindInfo(g.PoolPartyEndFind);if(!e)return 0;var i=e.list;for(var n in i){if(i.hasOwnProperty(n))if(1==i[n])return 1}return 0==e.total_reward&&IS(f).isAllFind(g.PoolPartyEndFind)?1:0},t.GetLoginRedNum=function(){var t,i=IS(f).GetActivityInfo(g.PoolPartyEndLogin);if(!i||i.state!=y.Open)return 0;var n=IS(f).GetSignInfo(g.PoolPartyEndLogin);if(!n)return 0;if(n.get_day.length>=10)return IS(l).removeIcon(47),0;for(var r,o=null!=(t=n.get_day)?t:[],a=configAct_login.getDatas(),s=e(a);!(r=s()).done;){var d=r.value;if(d.act_type==i.type&&d.group_id==i.roundCfg.group_id&&n.day>=d.day&&!o.includes(d.id))return 1}return 0},i}());i._RF.pop()}}}));

