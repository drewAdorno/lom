System.register("chunks:///_virtual/ActivitySevenBossView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./TimeUtil.ts","./index57.ts","./BagDefine.ts","./BagModel.ts","./ChapterDataCache.ts","./ChapterDefine.ts","./DungeonControl.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./MessageView.ts","./RankControl.ts","./RoleDataCache.ts","./RoleDefine.ts","./RankDefine.ts","./RankModel.ts","./StringUtil.ts","./BaseSubView.ts"],(function(t){"use strict";var e,i,n,a,o,s,r,f,d,h,l,c,u,m,v,y,p,g,C,S,R,T,I,k;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,n=t.Button,a=t.Label,o=t.Sprite,s=t.js},function(t){r=t.default},null,function(t){f=t.BagEventDefine},function(t){d=t.BagModel},function(t){h=t.ChapterDataCache},function(t){l=t.DungeonDefine,c=t.ChapterEventDefine},function(t){u=t.default},function(t){m=t.default},function(t){v=t.ActivityType,y=t.ActivityState},function(t){p=t.default},function(t){g=t.default},function(t){C=t.RoleDataCache},function(t){S=t.PlayerAttr},function(t){R=t.RankDefine},function(t){T=t.RankModel},function(t){I=t.default},function(t){k=t.BaseSubView}],execute:function(){i._RF.push({},"36519rxQu5Ll69ct+nMtR2v","ActivitySevenBossView",void 0);var L="";t("default",function(t){function i(){var e;return(e=t.call(this)||this).txtLeftTime=void 0,e.deltaTime=0,e.leftTime=0,e.canUpdate=!1,e.data=void 0,e.curLevel=void 0,e.rankId=0,e.txtMyRank=void 0,e.txtMyScore=void 0,e.myFrame=void 0,e.myIcon=void 0,e.txtMyName=void 0,e.txtServer=void 0,e.name="ActivitySevenBossView",e}e(i,t);var k=i.prototype;return k.onInit=function(){var t=this,e=this.findChild("bg/tips");this.addComponentCallbackListener(e,n.EventType.CLICK,(function(){IS(m).ShowSysTips(v.SevenBoss)}));var i=this.findChild("btnGo");this.addComponentCallbackListener(i,n.EventType.CLICK,(function(){t.startWar()}));var s=this.findChild("bg/btnRank");this.addComponentCallbackListener(s,n.EventType.CLICK,(function(){uiMgr.openView("ActivityAutumnRankView",v.SevenBoss)})),this.txtLeftTime=this.findChildComponent("bg/txtLeftTime",a),this.txtMyRank=this.findChildComponent("myRank/rankNum",a),this.txtMyScore=this.findChildComponent("myRank/score",a),this.txtMyName=this.findChildComponent("myRank/name",a),this.txtServer=this.findChildComponent("myRank/txtServer",a),this.myFrame=this.findChildComponent("myRank/imgFrame",o),this.myIcon=this.findChildComponent("myRank/imgFrame/imgIcon",o)},k.registerUpdateHandler=function(){this.addEvent(f.GOODS_INFO_UPDATE,this.updaItemInfo,this),this.addEvent(R.RankInfoBack,this.UpdateRankInfo,this)},k.onAfterOpen=function(){var t;this.txtMyName.string=IS(C).GetRoleAttr(S.ROLE_ATTR_NAME),this.txtServer.string=s.formatStr("[s%s]",IS(C).GetRoleAttr(S.ROLE_ATTR_SERVER)),this.loadRemoteIcon(IS(C).GetRoleAttr(S.ROLE_ATTR_HEAD_URL),this.myIcon);var e=IS(m).GetActivityInfo(v.SevenBoss);this.rankId=e.roundCfg.rank_id;var i=configRanktype.getDataByKey(this.rankId);L=i.prefix;var n=new Array;n.push({type:this.rankId,server:1,page:1}),IS(g).reqRankList(n);var a=null!=(t=e.state_time[e.state])?t:e.state_time[y.Open];this.leftTime=a.end_time-r.serverTime,this.leftTime>0?(this.canUpdate=!0,this.txtLeftTime.string=r.formatTimeStringForSecond(this.leftTime)):this.txtLeftTime.string=GetLanguage(200026),this.data=IS(h).getDungeonInfoByID(l.CHAPTER_TYPE_SEVEN_TRIAL),this.curLevel=this.data.max_level||1,this.updaItemInfo()},k.onBeforeClose=function(){this.canUpdate=!1},k.onDestroy=function(){},k.onUpdate=function(t){this.canUpdate&&(this.deltaTime=this.deltaTime+t,this.deltaTime>=1&&(this.deltaTime=0,this.leftTime=this.leftTime-1,this.leftTime>0?this.txtLeftTime.string=r.formatTimeStringForSecond(this.leftTime):(this.txtLeftTime.string=GetLanguage(200026),this.canUpdate=!1)))},k.startWar=function(){var t;if(IS(d).getGoodsCountByGoodsGtid(1081)<=0)p.showFlyTip(GetLanguage(200384));else{IS(u).reqDungeonBattleStart(this.data.type,this.curLevel);var e=IS(h).getConfig(this.data.type).getDataByList("index",this.curLevel||1);battleMain.enterChapter(e[0].bossModel),normalEvent.emit(c.DUNGEON_ENTER),null==(t=uiMgr.getOpenView("ActivitySevenView2"))||t.close(),this.close()}},k.updaItemInfo=function(){var t=IS(d).getGoodsCountByGoodsGtid(1081),e=this.findChildComponent("bgNum/txtNum",a);e.string=t>99?"99+":t},k.UpdateRankInfo=function(){var t,e=IS(T).GetRankInfoByType(this.rankId);e&&(this.txtMyRank.string=0!=e.my_info.rank?e.my_info.rank:GetLanguage(200037),this.txtMyScore.string=s.formatStr("%s%s",L,I.GetNumString(null!=(t=e.my_info.score)?t:0)))},i}(k));i._RF.pop()}}}));

