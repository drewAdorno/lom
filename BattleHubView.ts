System.register("chunks:///_virtual/BattleHubView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BattleData.ts","./EnumDefine.ts","./EventDefine.ts","./V2.ts","./AudioMgr.ts","./PlatformUtil.ts","./StringUtil.ts","./index57.ts","./UIEffectAsset.ts","./MainGame.ts","./index85.ts","./FlyNum.ts","./ChapterDataCache.ts","./ChapterDefine.ts","./BattleDefine.ts","./BattleChapterArenaPanel.ts","./BattleChapterArtifactGemPanel.ts","./BattleChapterCoinPanel.ts","./BattleChapterDiamondPanel.ts","./BattleChapterDoubleLadderPanel.ts","./BattleChapterFatePanel.ts","./BattleChapterMainPanel.ts","./BattleChapterMountPanel.ts","./BattleChapterSeasonPvpPanel.ts","./BattleChapterSoloPanel.ts","./BattleChapterStrategyActivityPanel.ts","./BattleChapterTeam20Panel.ts","./BattleChapterTeam3Panel.ts","./BattleChapterTowerDefPanel.ts","./BattleChapterWingPanel.ts","./BattleChapterWorldBossPanel.ts","./BattleDoubleLadderInfo.ts","./BattleDungeonInfo.ts","./BattleMainInfo.ts","./BattleMountInfo.ts","./BattlePvpInfo.ts","./BattleShenQiInfo.ts","./BattleSkillPanel.ts","./BattleTeam20Info.ts","./BattleTowerDefInfo.ts","./IBattleChapterPanel.ts","./Mask.ts","./BaseView.ts","./UIDefine.ts"],(function(t){"use strict";var e,n,i,a,l,s,o,h,r,f,d,u,p,c,P,C,w,B,m,g,v,I,b,T,y,_,S,M,k,D,E,L,A,U,G,x,H,F,V,N,W,O,Q,R,j,z,K,q,X,Y,Z,J;return{setters:[function(t){e=t.inheritsLoose},function(t){n=t.cclegacy,i=t.Widget,a=t.Button,l=t.screen,s=t.Vec3,o=t.UITransform,h=t.sys},function(t){r=t.ChapterType},function(t){f=t.BattleFlag,d=t.HealthType,u=t.BindType},function(t){p=t.EventDefine},function(t){c=t.V2},function(t){P=t.audioMgr},function(t){C=t.PlatformUtil},function(t){w=t.default},null,function(t){B=t.UIEffectAsset},function(t){m=t.GameState},null,function(t){g=t.flyNumMgr},function(t){v=t.ChapterDataCache},function(t){I=t.ChapterEventDefine},function(t){b=t.BattleEventDefine},function(t){T=t.BattleChapterArenaPanel},function(t){y=t.BattleChapterArtifactGemPanel},function(t){_=t.BattleChapterCoinPanel},function(t){S=t.BattleChapterDiamondPanel},function(t){M=t.BattleChapterDoubleLadderPanel},function(t){k=t.BattleChapterFatePanel},function(t){D=t.BattleChapterMainPanel},function(t){E=t.BattleChapterMountPanel},function(t){L=t.BattleChapterSeasonPvpPanel},function(t){A=t.BattleChapterSoloPanel},function(t){U=t.BattleChapterStrategyActivityPanel},function(t){G=t.BattleChapterTeam20Panel},function(t){x=t.BattleChapterTeam3Panel},function(t){H=t.BattleChapterTowerDefPanel},function(t){F=t.BattleChapterWingPanel},function(t){V=t.BattleChapterWorldBossPanel},function(t){N=t.BattleDoubleLadderInfo},function(t){W=t.BattleDungeonInfo},function(t){O=t.BattleMainInfo},function(t){Q=t.BattleMountInfo},function(t){R=t.BattlePvpInfo},function(t){j=t.BattleShenQiInfo},function(t){z=t.BattleSkillPanel},function(t){K=t.BattleTeam20Info},function(t){q=t.BattleTowerDefInfo},function(t){X=t.BattleInfoType},function(t){Y=t.Mask},function(t){Z=t.BaseView},function(t){J=t.ViewType}],execute:function(){n._RF.push({},"b5296QwPrZFxZqCgsxqjFFI","BattleHubView",void 0);t("BattleHubView",function(t){function n(){var e;return(e=t.call(this)||this).widgetNode=void 0,e.widgetBottom=void 0,e.widgetSkillPanel=void 0,e.nodeExit=void 0,e.nodeEffect=void 0,e.skillPanel=void 0,e.panels={},e.infos={},e.currentPanel=void 0,e.loadInfo=void 0,e.currenInfo=void 0,e.mask=void 0,e.name="BattleHubView",e.url="ui/module/battle/BattleHubView",e.viewType=J.BattleView,e.poolTime=-1,e}e(n,t);var Z=n.prototype;return Z.registerUpdateHandler=function(){this.addEvent(I.BATTLE_STATE,this.onBattleState,this,!0),this.addEvent(b.BATTLE_MASK_OPEN,this.onMaskOpen,this,!0),this.addEvent(b.BATTLE_MASK_CLOSE,this.onMaskClose,this,!0),this.addEvent(b.BATTLE_PVP_VS,this.onPvpVs,this,!0),this.addEvent(b.HIDE_SKILL_PANEL,this.onHideSkillPanel,this,!0)},Z.onAfterOpen=function(){},Z.onBeforeClose=function(){},Z.onDestroy=function(){},Z.onInit=function(){var t=this;this.widgetNode=this.node.getComponent(i),this.widgetBottom=this.findChildComponent("bottom",i),this.widgetSkillPanel=this.findChildComponent("skillPanel",i);var e=this.findChild("skillPanel/skills");this.skillPanel=new z(this,e),this.panels[r.Main]=new D(this,this.findChild("top/mainPanel")),this.panels[r.Coin]=new _(this,this.findChild("top/coinPanel")),this.panels[r.Diamond]=new S(this,this.findChild("top/diamondPanel")),this.panels[r.Arena]=new T(this,this.findChild("top/arenaPanel"),GetLanguage_UI(999000357)),this.panels[r.Solo]=new A(this,this.findChild("top/soloPanel")),this.panels[r.Team3]=new x(this,this.findChild("top/team3Panel")),this.panels[r.Farm]=new T(this,this.findChild("top/farmPanel"),"zy_txt_quganxiaotou"),this.panels[r.Team20]=new G(this,this.findChild("top/team20Panel")),this.panels[r.Mount]=new E(this,this.findChild("top/mountPanel")),this.panels[r.Fate]=new k(this,this.findChild("top/fatePanel")),this.panels[r.RoleSolo]=new T(this,this.findChild("top/arenaPanel"),GetLanguage_UI(999000348)),this.panels[r.WorldBoss]=new V(this,this.findChild("top/worldBossPanel")),this.panels[r.Gvg]=new T(this,this.findChild("top/arenaPanel"),GetLanguage_UI(999000359)),this.panels[r.CrossPvp]=new T(this,this.findChild("top/arenaPanel"),GetLanguage_UI(999000357)),this.panels[r.StrategyActivity]=new U(this,this.findChild("top/StrategyActivityPanel")),this.panels[r.CrossWarPvp]=new T(this,this.findChild("top/arenaPanel"),GetLanguage_UI(999000350)),this.panels[r.CrossWarMonster]=new T(this,this.findChild("top/arenaPanel"),GetLanguage_UI(999000350)),this.panels[r.ParkPvp]=new T(this,this.findChild("top/arenaPanel"),GetLanguage_UI(999000357)),this.panels[r.CrossParkPvp]=new T(this,this.findChild("top/arenaPanel"),GetLanguage_UI(999000357)),this.panels[r.HalloweenPvp]=new T(this,this.findChild("top/arenaPanel"),GetLanguage_UI(999000361)),this.panels[r.ShenQi]=new T(this,this.findChild("top/arenaPanel"),GetLanguage_UI(999000362)),this.panels[r.ShenQi].infoType=X.ShenQi,this.panels[r.ArtifactGem]=new y(this,this.findChild("top/artifactGemPanel")),this.panels[r.Seven]=new A(this,this.findChild("top/soloPanel"),GetLanguage_UI(300520)),this.panels[r.Wing]=new F(this,this.findChild("top/fatePanel")),this.panels[r.Wing2]=new F(this,this.findChild("top/fatePanel")),this.panels[r.Wing3]=new F(this,this.findChild("top/fatePanel")),this.panels[r.Slave]=new T(this,this.findChild("top/arenaPanel"),GetLanguage_UI(999000523)),this.panels[r.TowerDef]=new H(this,this.findChild("top/towerDefPanel")),this.panels[r.SeasonPvp]=new L(this,this.findChild("top/arenaPanel"),GetLanguage(301821)),this.panels[r.WingPreview]=new T(this,this.findChild("top/arenaPanel"),GetLanguage_UI(600002009)),this.panels[r.WingPreview].infoType=X.ShenQi,this.panels[r.DoubleLadder]=new M(this,this.findChild("top/doubleLadderPanel")),this.infos[X.Main]=new O(this,this.findChild("bottom/mainInfo")),this.infos[X.Dungeon]=new W(this,this.findChild("bottom/dungeonInfo")),this.infos[X.Pvp]=new R(this,this.findChild("bottom/pvpInfo")),this.infos[X.Mount]=new Q(this,this.findChild("bottom/mountInfo")),this.infos[X.Team20]=new K(this,this.findChild("bottom/team20Info")),this.infos[X.ShenQi]=new j(this,this.findChild("bottom/shenqiInfo")),this.infos[X.TowerDef]=new q(this,this.findChild("bottom/towerDefInfo")),this.infos[X.DoubleLadder]=new N(this,this.findChild("bottom/doubleLadderInfo")),this.widgetNode.scheduleOnce((function(){t.setTopPos()}),0),this.nodeExit=this.findChild("bottom/exit");var n=this.findChild("bottom/exit/btnExit");this.addComponentCallbackListener(n,a.EventType.CLICK,(function(){t.exitBattle()})),this.nodeEffect=this.findChild("effect"),this.mask=new Y(this.findChild("mask"),this.findChild("maskEffect"),this.findChild("huisu")),this.reset()},Z.setTopPos=function(){if(!GlobalDefine.IPAD){var t=this.findChild("top"),e=720/l.windowSize.width*l.windowSize.height,n=C.getMeunButtonTopDelta()*e,i=new s(0,e-n,0),a=this.node.getComponent(o).convertToNodeSpaceAR(i),h=t.getPosition();t.setPosition(new s(h.x,a.y,h.z))}},Z.onMaskOpen=function(){var t;null==(t=this.mask)||t.backOpen()},Z.onMaskClose=function(t,e){var n,i;e=null!=(n=e)?n:0,null==(i=this.mask)||i.backClose(t,e);var a=IS(v),l=this.panels[a.chapterType];l.infoType&&(this.loadInfo=this.infos[l.infoType],this.loadInfo.node.active=!0,this.loadInfo.onLoad()),a.chapterType!=r.Team3&&a.chapterType!=r.Team20&&a.chapterType!=r.WorldBoss&&a.chapterType!=r.TowerDef&&a.chapterType!=r.SeasonPvp&&a.chapterType!=r.DoubleLadder&&a.chapterType!=r.DoublePvp&&a.chapterType!=r.IdoBoss||uiMgr.openView("BattleLoadView")},Z.onPvpVs=function(t){var e;null==(e=this.mask)||e.pvpVs(t)},Z.exitBattle=function(){this.currentPanel.exitBattle&&this.currentPanel.exitBattle()},Z.onHideSkillPanel=function(){this.widgetSkillPanel&&(this.widgetSkillPanel.node.active=!1)},Z.reset=function(){var t,e;null!=this.skillPanel&&null!=battleMain.mainCtr&&null!=battleMain.mainCtr.player&&(battleMain.showMainCtr&&this.skillPanel.reset(),this.currentPanel&&this.currentPanel!=this.panels[battleMain.data.chapterType]&&(this.currentPanel.node.active=!1),this.currentPanel=this.panels[battleMain.data.chapterType],this.widgetBottom.bottom=null!=(t=this.currentPanel.bottomY)?t:640,this.widgetSkillPanel.bottom=null!=(e=this.currentPanel.bottomY)?e:640,this.widgetSkillPanel.node.active=battleMain.data.chapterType!=r.TowerDef,this.currentPanel.node.active=!battleMain.hideText,this.currentPanel.reset(),this.currenInfo&&(this.currenInfo.node.active=!1,this.currenInfo=null),this.loadInfo&&(this.loadInfo.node.active=!1,this.loadInfo=null),this.currentPanel.infoType&&(this.currenInfo=this.infos[this.currentPanel.infoType],this.currenInfo.node.active=!0,this.currenInfo.reset()),this.nodeExit.active=battleMain.data.chapterType==r.Team3||battleMain.data.chapterType==r.SeasonPvp)},Z.updateSkill=function(){this.skillPanel.updateSkill()},Z.updatePart=function(){null!=this.currentPanel&&this.currentPanel.updatePart&&this.currentPanel.updatePart()},Z.onApply=function(t){this.node.setSiblingIndex(0)},Z.initBattleEvent=function(){battleEvent.on(p.FlyNum,this.onHealth,this),null!=this.currentPanel&&this.currentPanel.initBattleEvent&&this.currentPanel.initBattleEvent()},Z.showNextPartEffect=function(){B.alloc("prefab/ui-effect/MX_tx_zjm_jiasu",this.nodeEffect,2).position=new c(0,-200)},Z.showVictory=function(){P.playSound("common_shendengshengji"),B.alloc("prefab/ui-effect/MX_victory",this.nodeEffect,3,(function(t){h.uiMirror&&(t.dir=-1)}))},Z.showPvpTimer=function(){B.alloc("prefab/ui-effect/MX_tx_pvp_dumiao",this.nodeEffect,2,(function(t){h.uiMirror&&(t.dir=-1)}))},Z.onHealth=function(t,e,n){if(battleMain.battleFlag&f.OPEN_GRAPHIC&&!(battleMain.battleFlag&f.UI_MASK||battleMain.hideText)){switch(n){case d.Hurt:case d.Hurt_Ret:case d.Hurt_Share_Damage:case d.Hurt_Double:case d.Hurt_Bleed:g.showFly(t.unitId,w.GetNumString(e),"normal",u.bp_top);break;case d.Hurt_Crit:case d.Hurt_Double_Crit:case d.Hurt_Share_Damage_Crit:g.showFly(t.unitId,w.GetNumString(e),"crit",u.bp_top,1);break;case d.Miss:g.showFly(t.unitId,null,"miss",u.bp_top);break;case d.Treat:case d.Treat_Crit:case d.Act_Hpsteal:g.showFly(t.unitId,w.GetNumString(e),"recover",u.bp_top);break;case d.Double_Act:g.showFly(t.unitId,null,"double",u.bp_top,1);break;case d.Counter_Act:g.showFly(t.unitId,null,"counter",u.bp_top,1)}}},Z.onBattleState=function(t,e){this.currenInfo&&!e&&this.currenInfo.type!=this.currentPanel.infoType&&(this.currenInfo.node.active=!1,this.currenInfo=null)},Z.onUpdate=function(e){var n,i,a;mainGame.state==m.Runing&&(t.prototype.onUpdate.call(this,e),battleMain.showMainCtr&&this.skillPanel.onUpdate(e),null==(n=this.currentPanel)||n.onUpdate(e),null!=(i=this.currenInfo)&&i.onUpdate&&(null==(a=this.currenInfo)||a.onUpdate(e)))},n}(Z));n._RF.pop()}}}));

