System.register("chunks:///_virtual/MarryDialogView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./index57.ts","./MarryControl.ts","./MarryDefine.ts","./MarryDialogDataCache.ts","./ItemGrid.ts","./RankTitle.ts","./TimeUtil.ts","./FixMath.ts","./ObjectUtil.ts","./RoleDataCache.ts","./RoleDefine.ts","./TaskDefine.ts","./BaseView.ts"],(function(t){"use strict";var e,i,n,s,o,d,r,a,h,l,c,f,g,v,p,u,m,C,L,y,T,I,G,S,_,w;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,n=t.UITransform,s=t.ScrollView,o=t.Label,d=t.Button,r=t.sys,a=t.Widget,h=t.Size,l=t.js},function(t){c=t.ListItem},function(t){f=t.default},function(t){g=t.default},null,function(t){v=t.default},function(t){p=t.MarryEventDefine},function(t){u=t.default},function(t){m=t.ItemGrid},function(t){C=t.RankTitle,L=t.TitleType},function(t){y=t.default},function(t){T=t.FixMath},function(t){I=t.default},function(t){G=t.RoleDataCache},function(t){S=t.RoleEventDefine},function(t){_=t.TaskEventDefine},function(t){w=t.BaseView}],execute:function(){var D,k,R;i._RF.push({},"44f24nyyfJB3IAqC4myUbjo","MarryDialogView",void 0);var x=((D={})[1]=340,D[2]=470,D[3]=470,D),E=((k={})[0]=260,k[1]=36,k[2]=-34,k[3]=-34,k[4]=130,k[5]=260,k),W=((R={})[1]=-150,R[2]=-251,R[3]=-357,R),A=(t("default",function(t){function i(){var e;return(e=t.call(this)||this).optionList=void 0,e.scrollGo=void 0,e.scrollUt=void 0,e.rewardList=void 0,e.weddingDate=void 0,e.timescroll=void 0,e.timeList=void 0,e.txtWeddingTime=void 0,e.timeList_open=void 0,e.timeList_close=void 0,e.isWeddingChoose=!1,e.decoraImg=void 0,e.choose_wedding_Id=void 0,e.checkWeddingBtn=void 0,e.bgTypeList=[],e.titleTypeList=[],e.loverGender=-1,e.selfGender=-1,e.talk_stage=0,e.options=[],e.name="MarryDialogView",e.url="ui/module/marry/MarryDialogView",e}e(i,t);var c=i.prototype;return c.onInit=function(){var t=this;this.decoraImg=this.findChild("root/decoration/pic02"),this.scrollGo=this.findChild("root/optionList"),this.scrollUt=this.findChildComponent("root/optionList",n);var e=this.findChildComponent("root/optionList",s);this.optionList=this.addUIList(e,A),this.initTypeList(),this.weddingDate=this.findChild("root/weddingDate"),this.timescroll=this.findChildComponent("root/weddingDate/timeList",s),this.txtWeddingTime=this.findChildComponent("root/weddingDate/weddingTime",o),this.timeList_open=this.findChild("root/weddingDate/chooseBtn/open"),this.timeList_close=this.findChild("root/weddingDate/chooseBtn/close");var i=this.findChild("root/weddingDate/chooseBtn");this.addComponentCallbackListener(i,d.EventType.CLICK,(function(){t.isWeddingChoose=!t.isWeddingChoose,t.timeList_open.active=t.isWeddingChoose,t.timeList_close.active=!t.isWeddingChoose,t.timescroll.node.active=t.isWeddingChoose,t.scrollGo.active=!t.isWeddingChoose})),this.timeList=this.addUIList(this.timescroll,B)},c.initTypeList=function(){this.bgTypeList=[];for(var t=1;t<4;t++){var e=this.findChild("root/bg/"+t);this.bgTypeList[t]=e}for(var i=1;i<3;i++){var s=this.findChild("root/title/"+i);if(this.titleTypeList[i]={node:s,txtContent:this.findChildComponent("root/title/"+i+"/txtContent",o),txtTitle:this.findChildComponent("root/title/"+i+"/titleBg/txtTitle",o),costItem:this.findChild("root/title/"+i+"/txtContent/costItem"),bgUt:this.findChildComponent("root/title/"+i+"/dialogBg",n)},r.uiMirror&&this.titleTypeList[i].costItem){var h=this.findChildComponent("root/title/"+i+"/txtContent/costItem",a),l=h.right;h.isAlignRight=!1,h.isAlignLeft=!0,h.left=l,h.node.setScale(-.5,.5,1)}this.titleTypeList[i].txtTitle.string=GetLanguage(204123)}this.checkWeddingBtn=f.findChild(this.titleTypeList[2].node,"content/4/checkWeddingBtn"),this.addComponentCallbackListener(this.checkWeddingBtn,d.EventType.CLICK,(function(){uiMgr.openView("GvGRuleTips",[GetLanguage(204419)])}))},c.registerUpdateHandler=function(){this.addEvent(p.MARRY_PARTY_RESERVE_UPDATE,this.updateReserveList,this),this.addEvent(p.MARRY_DIALOG_STAGE_CHANGE,this.updateInfo,this),this.addEvent(p.MARRY_PARTY_RESERVE_LIST_UPDATE,this.updateMarryTimeList,this),this.addEvent(S.ROLE_RED_POINT_LIST_UPDATE,this.RefreshRed,this),this.addEvent(S.ROLE_RED_DETAIL_UPDATE,this.RefreshRed,this),this.addEvent(_.TASK_COMMIT_UPDATE,this.RefreshRed,this),this.addEvent(_.TASK_INFO_UPDATE,this.RefreshRed,this)},c.RefreshRed=function(){this.optionList&&this.optionList.updateAll()},c.onAfterOpen=function(){IS(v).send_marry_status_c2s(),this.updateReserveList()},c.updateReserveList=function(){IS(v).send_marry_party_reserve_list_c2s()},c.updateInfo=function(){this.isWeddingChoose=!1,this.timeList_open.active=this.isWeddingChoose,this.timeList_close.active=!this.isWeddingChoose,this.timescroll.node.active=this.isWeddingChoose,this.scrollGo.active=!this.isWeddingChoose,this.talk_stage=IS(u).GetTalkStage(),this.options=IS(u).GetTalkOptions(),this.scrollGo.active=this.options.length>0&&!this.isWeddingChoose,this.optionList.datas=this.options,this.txtWeddingTime.string=IS(u).GetWeddingTime(),this.updateType()},c.updateType=function(){this.loverGender=IS(u).GetLoverGender(),this.selfGender=IS(G).GetGender();var t=configTalk_stage.getDataByKey(this.talk_stage);if(this.weddingDate.active=t&&t.type&&4==t.type,t){switch(t.type){case 0:for(var e=1;e<3;e++)this.titleTypeList[e].node.active=1==e;t.differnece.length>0?this.loverGender&&this.loverGender==this.selfGender?this.titleTypeList[1].txtContent.string=g.formatStr(t.talk,GetLanguage(t.differnece[1])):this.titleTypeList[1].txtContent.string=g.formatStr(t.talk,GetLanguage(t.differnece[0])):this.titleTypeList[1].txtContent.string=t.talk;break;case 4:for(var i=1;i<3;i++)this.titleTypeList[i].node.active=1==i;var n=configMarry.getDataByKey(IS(u).GetWeddingType());n&&n.desc&&t.differnece.length>0&&(this.loverGender&&this.loverGender==this.selfGender?this.titleTypeList[1].txtContent.string=g.formatStr(t.talk,GetLanguage(n.desc[1]),GetLanguage(t.differnece[1])):this.titleTypeList[1].txtContent.string=g.formatStr(t.talk,GetLanguage(n.desc[0]),GetLanguage(t.differnece[0])));break;case 5:for(var s=1;s<3;s++)this.titleTypeList[s].node.active=1==s;t.differnece.length>0&&(this.loverGender&&this.loverGender==this.selfGender?this.titleTypeList[1].txtContent.string=g.formatStr(t.talk,GetLanguage(t.differnece[1]),IS(u).GetWeddingTime()):this.titleTypeList[1].txtContent.string=g.formatStr(t.talk,GetLanguage(t.differnece[0]),IS(u).GetWeddingTime()));break;default:for(var o=1;o<3;o++)this.titleTypeList[o].node.active=2==o;this.titleTypeList[2].bgUt.setContentSize(new h(572,x[t.type])),this.updateSpecialTitleInfo(t.type)}for(var d=1;d<4;d++)this.bgTypeList[d].active=d==t.size;this.decoraImg.setPosition(265,W[t.size]),this.scrollGo.setPosition(0,E[t.type])}},c.updateSpecialTitleInfo=function(t){for(var e,i=configTalk_stage.getDataByKey(this.talk_stage),n=[],d=1;d<5;d++){var r=f.findChild(this.titleTypeList[2].node,"content/"+d);n[d]=r}this.titleTypeList[2].costItem&&(e=new m(this,this.titleTypeList[2].costItem));var a,h=configMarry.getDataByKey(t);if(h&&1==h.spend[0])i.differnece.length>0&&(this.loverGender&&this.loverGender==this.selfGender?this.titleTypeList[2].txtContent.string=g.formatStr(i.talk,GetLanguage(i.differnece[1]),h.spend[1][1]):this.titleTypeList[2].txtContent.string=g.formatStr(i.talk,GetLanguage(i.differnece[0]),h.spend[1][1])),e.SetItemId(h.spend[1][0]);else if(h&&2==h.spend[0]){var c=configPay_mall.getDataByKey(h.spend[1]);this.loverGender&&this.loverGender==this.selfGender?this.titleTypeList[2].txtContent.string=g.formatStr(i.talk,GetLanguage(i.differnece[1]),T.round(c.price)):this.titleTypeList[2].txtContent.string=g.formatStr(i.talk,GetLanguage(i.differnece[0]),T.round(c.price)),e.SetItemId(999)}for(var v=1;v<4;v++)n[v].active=v<=h.show_reward.length;(n[4].active=1!=t,2==t||3==t)&&(this.loverGender&&this.loverGender==this.selfGender?2==t?a=GetLanguage(204581):3==t&&(a=GetLanguage(204582)):2==t?a=GetLanguage(204579):3==t&&(a=GetLanguage(204580)),f.findChildComponent(n[4],"label",o).string=a);for(var p=0;p<h.show_reward.length;p++){var u=h.show_reward[p];switch(u[0]){case 1:var y=new m(this,f.findChild(n[1],"itemGrid1")),I=new m(this,f.findChild(n[1],"itemGrid2")),G=f.findChildComponent(n[1],"count1",o),S=f.findChildComponent(n[1],"count2",o);y.SetItemId(u[1][0][0]),I.SetItemId(u[1][1][0]),G.string=l.formatStr("x %s",u[1][0][1]),S.string=l.formatStr("x %s",u[1][1][1]);break;case 2:new m(this,f.findChild(n[2],"itemGrid2")).SetItemId(u[1][1][0]);for(var _=f.findChild(n[2],"bg/title"),w=configTitle.getDatas(),D=void 0,k=0;k<w.length;k++)w[k].item_id==u[1][0][0]&&(D=w[k]);new C(this,_).SetRankTitle(D.id,L.NORMAL);break;case 3:if(!this.rewardList){var R=f.findChildComponent(n[3],"rewardScroll",s);this.rewardList=this.addUIList(R,M)}this.rewardList.datas=u[1]}}},c.updateMarryTimeList=function(){this.choose_wedding_Id=0,this.choose_wedding_Id=IS(u).GetWeddingTimeID();var t=configWedding_time.getDatas(),e=y.ServerDate(1e3*y.serverTime),i=l.formatStr("%s/%s/%s %s:%s:%s",e.getFullYear(),e.getMonth()+1,e.getDate(),0,0,0),n=y.getServerDateByLocalStr(i).getTime()/1e3,s=e.getDay();t&&(t=I.copyArray(t)).sort((function(t,i){var o=t.week%7,d=i.week%7,r=3600*t.time[0]+60*t.time[1]+t.time[2],a=3600*i.time[0]+60*i.time[1]+i.time[2],h=-1;if(o-s>0)h=o-s;else if(o-s<0)h=6-s+o+1;else{var l=3600*e.getHours()+60*e.getMinutes()+e.getSeconds();l<r?h=0:l>r&&(h=7)}var c=n+60*h*60*24+r;if(h=-1,d-s>0)h=d-s;else if(d-s<0)h=6-s+d+1;else{var f=3600*e.getHours()+60*e.getMinutes()+e.getSeconds();f<a?h=0:f>a&&(h=7)}return c<n+60*h*60*24+a?-1:1})),this.timeList.datas=t,this.txtWeddingTime.string=IS(u).GetChooseWeddingTime()},c.onBeforeClose=function(){},c.onDestroy=function(){},i}(w)),function(t){function i(){for(var e,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))||this).txtContent=void 0,e.cfg=void 0,e.red=void 0,e}e(i,t);var n=i.prototype;return n.onInit=function(){var t=this;this.txtContent=f.findChildComponent(this.node,"txtContent",o),this.view.addComponentCallbackListener(this.node,d.EventType.CLICK,(function(){t.onItemClick()})),this.red=f.findChild(this.node,"red")},n.onRender=function(t,e){this.data=t,this.cfg=configTalk_option.getDataByKey(this.data),this.cfg.differnece.length>0?this.view.loverGender&&this.view.loverGender==this.view.selfGender?this.txtContent.string=g.formatStr(this.cfg.option,GetLanguage(this.cfg.differnece[1])):this.txtContent.string=g.formatStr(this.cfg.option,GetLanguage(this.cfg.differnece[0])):this.txtContent.string=this.cfg.option,1==this.data?this.red.active=IS(u).getFavorRedPoint()>0:30==this.data?this.red.active=IS(u).getFavorWeedRedPoint()>0:this.red.active=!1},n.onItemClick=function(){IS(u).ChooseOption(this.cfg.id,this.view)},i}(c)),M=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))||this).goodsItem=void 0,e}e(i,t);var n=i.prototype;return n.onInit=function(){this.goodsItem=new m(this.view,f.findChild(this.node,"itemGrid"))},n.onRender=function(t,e){this.data=t,this.goodsItem.SetItemId(t[0])},i}(c),B=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))||this).txtTime=void 0,e.isSelect=void 0,e.canchoose=void 0,e.choosed=void 0,e}e(i,t);var n=i.prototype;return n.onInit=function(){var t=this;this.view.addComponentCallbackListener(this.node,d.EventType.CLICK,(function(){t.onClick()})),this.txtTime=f.findChildComponent(this.node,"txtTime",o),this.isSelect=f.findChild(this.node,"isSelect"),this.canchoose=f.findChild(this.node,"canchoose"),this.choosed=f.findChild(this.node,"choosed")},n.onRender=function(t,e){this.data=t,this.txtTime.string=y.getFutureDateByDayTime(this.data.week,this.data.time),this.isSelect.active=this.view.choose_wedding_Id&&this.view.choose_wedding_Id==this.data.id,IS(u).IsWeddingTimeDated(this.data.id)?(this.canchoose.active=!1,this.choosed.active=!0):(this.canchoose.active=!0,this.choosed.active=!1)},n.onClick=function(){IS(u).changeChooseWeddingId(this.data.id),this.view.updateMarryTimeList()},i}(c);i._RF.pop()}}}));

