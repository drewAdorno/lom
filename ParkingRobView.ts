System.register("chunks:///_virtual/ParkingRobView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./BaseView.ts","./ConfigGlobal.ts","./ChatDefine.ts","./MessageView.ts","./FriendControl.ts","./MainViewModel.ts","./RoleDataCache.ts","./RoleDefine.ts","./ParkingControl.ts","./ParkingDataCache.ts","./ParkingDefine.ts","./UIDefine.ts"],(function(t){"use strict";var e,i,n,o,s,a,r,h,d,l,f,p,c,u,v,m,C,_,T,g,I,R,b,L,E,k;return{setters:[function(t){e=t.inheritsLoose,i=t.createForOfIteratorHelperLoose},function(t){n=t.cclegacy,o=t.Button,s=t.Sprite,a=t.Label,r=t.sys,h=t.Vec3,d=t.ProgressBar,l=t.RichText},function(t){f=t.default},function(t){p=t.default},function(t){c=t.default},null,function(t){u=t.BaseView},function(t){v=t.ConfigGlobal},function(t){m=t.ChatDefine},function(t){C=t.default,_=t.TYPE_YES},function(t){T=t.default},function(t){g=t.MainViewModel},function(t){I=t.RoleDataCache},function(t){R=t.PlayerAttr},function(t){b=t.default},function(t){L=t.ParkingDataCache},function(t){E=t.ParkingEventDefine},function(t){k=t.PanelTabType}],execute:function(){n._RF.push({},"06138tR211EIK1yRnwDICaf","ParkingRobView",void 0);t("default",function(t){function n(){var e,i;return(i=t.call(this)||this).imgHeadIcon=void 0,i.imgHeadFrame=void 0,i.txtName=void 0,i.txtPower=void 0,i.txtLevel=void 0,i.nodeHp=void 0,i.nodeBuff=void 0,i.nodeTip=void 0,i.txtTips=void 0,i.timeTxt=void 0,i.txtTitle=void 0,i.txtHP=void 0,i.pbHP=void 0,i.awardList=[],i.spotInfo=void 0,i.pos=void 0,i.type=void 0,i.master_id=void 0,i.openType=void 0,i.roleInfo=((e={})[R.ROLE_ATTR_LVL]=0,e[R.ROLE_ATTR_EXP]=0,e[R.ROLE_ATTR_ID]=0,e[R.ROLE_ATTR_NAME]="",e[R.ROLE_ATTR_VIP]=0,e[R.ROLE_ATTR_SERVER]=0,e[R.ROLE_ATTR_CUR_POWER]=0,e[R.ROLE_ATTR_GUILD_NAME]="",e[R.ROLE_ATTR_POWER_SHOW]=0,e[R.ROLE_ATTR_CUR_JOB]=0,e[R.ROLE_ATTR_JOB_TIMES]=0,e[R.ROLE_ATTR_STYLE]=0,e[R.ROLE_ATTR_RENAME]=0,e[R.ROLE_ATTR_GENDER]=0,e[R.ROLE_ATTR_SKIN]=0,e[R.ROLE_ATTR_HEAD_ID]=0,e[R.ROLE_ATTR_HEAD_FRAME_ID]=0,e[R.ROLE_ATTR_HEAD_URL]="",e),i.btnCall=void 0,i.btnRob=void 0,i.btnGoto=void 0,i.btnHelp=void 0,i.nodeHelp=void 0,i.btnBuff=void 0,i.name="ParkingRobView",i.url="ui/module/parking/ParkingRobView",i.poolTime=3e3,i}e(n,t);var u=n.prototype;return u.onInit=function(){var t=this;this.adjustMirrorNode(this.findChild("content/imgBg-001/gg_png_title01"),0,!0),this.adjustMirrorNode(this.findChild("content/icon_bg1/icon_bg"),0,!0);var e=this.findChild("imgMask");this.addComponentCallbackListener(e,o.EventType.CLICK,(function(){t.onMaskClick()})),this.btnRob=this.findChild("content/btnRob"),this.addComponentCallbackListener(this.btnRob,o.EventType.CLICK,(function(){if(t.spotInfo)if(c.serverTime-t.spotInfo.start_time<1800)C.showFlyTip(GetLanguage(201329));else{for(var e,n=IS(L).extInfo,o=0,s=0,a=0,r=i(n);!(e=r()).done;){var h=e.value;2==h.k?o=h.v:3==h.k?s=h.v:4==h.k&&(a=h.v)}!configPark_pvp_debuff.getDataByKeys("num",o,"type",1)||0==o&&0==s&&a<=c.serverTime?t.enterBattle():C.showBoxTip({tip:GetLanguage(201357),title:GetLanguage(200048),func:function(e){e==_&&t.enterBattle()}})}})),this.btnCall=this.findChild("content/btnCall"),this.addComponentCallbackListener(this.btnCall,o.EventType.CLICK,(function(){uiMgr.openView("ChatView",null,null,{contentType:m.ChatContentType.Share,linkType:m.ChatLinkType.ParkingCall,cacheData:{pos:t.pos,type:t.type,master_id:t.master_id,role_id:t.spotInfo.role_id,ceng:IS(L).ceng},showString:GetLanguage(201324)})})),this.btnGoto=this.findChild("content/btnGoto"),this.addComponentCallbackListener(this.btnGoto,o.EventType.CLICK,(function(){IS(g).TryJumpToMainViewPanel(k.Main_Mystery),uiMgr.openView("ParkingMainView",IS(L).type,IS(L).master_id,IS(L).ceng),t.close()}));var n=this.findChild("content/scrollEquipList/role_panel/frame");this.addComponentCallbackListener(n,o.EventType.CLICK,(function(){IS(T).reqOtherRoleNotice(t.roleInfo[R.ROLE_ATTR_ID],1)})),this.imgHeadIcon=this.findChildComponent("content/scrollEquipList/role_panel/frame/icon",s),this.imgHeadFrame=this.findChildComponent("content/scrollEquipList/role_panel/frame/imgHeadFrame",s),this.txtName=this.findChildComponent("content/scrollEquipList/role_panel/name",a),this.txtPower=this.findChildComponent("content/scrollEquipList/role_panel/power",a),this.txtLevel=this.findChildComponent("content/scrollEquipList/role_panel/lev",a),this.txtTitle=this.findChildComponent("content/bg/name",a),this.nodeHp=this.findChild("content/bgHP"),this.timeTxt=this.findChildComponent("content/timeTxt/time",a),r.uiMirror&&(this.timeTxt.node.scale=new h(1,1,1)),this.txtHP=this.findChildComponent("content/bgHP/num",a),this.pbHP=this.findChildComponent("content/bgHP/ProgressBar",d);for(var l=1;l<2;l++){var f={node:this.findChild("content/icon_bg"+l),icon:this.findChildComponent("content/icon_bg"+l+"/icon",s),rate:this.findChildComponent("content/icon_bg"+l+"/rateTxt",a),award:this.findChildComponent("content/icon_bg"+l+"/awardTxt",a)};this.awardList.push(f)}this.nodeBuff=this.findChild("content/SpecialBuff"),this.nodeTip=this.findChild("content/tips");var p=this.findChild("content/tips/txt/mask");this.nodeTip.active=!1,this.addComponentCallbackListener(this.nodeBuff,o.EventType.CLICK,(function(){t.nodeTip.active=!t.nodeTip.active})),this.addComponentCallbackListener(p,o.EventType.CLICK,(function(){t.nodeTip.active=!1})),this.txtTips=this.findChildComponent("content/tips/txt",a),this.nodeHelp=this.findChild("content/nodeHelp"),this.btnHelp=this.findChild("content/nodeHelp/btnHelp"),this.addComponentCallbackListener(this.btnHelp,o.EventType.CLICK,(function(){var e=t.spotInfo.start_time;c.serverTime-e>=60*v.park_time_limit?IS(b).reqHelpStop(t.spotInfo.role_id,t.spotInfo.pos):C.showFlyTip(GetLanguage(201358))})),this.btnBuff=this.findChild("content/btnbuff"),this.addComponentCallbackListener(this.btnBuff,o.EventType.CLICK,(function(){t.onShowProtectTime()}));var u=this.findChild("content/tips-001/txt/mask");this.findChild("content/tips-001").active=!1,this.addComponentCallbackListener(u,o.EventType.CLICK,(function(){t.findChild("content/tips-001").active=!1}))},u.enterBattle=function(){IS(b).reqParkCombat(IS(L).type,IS(L).master_id,this.spotInfo.pos),uiMgr.closeAllView(["MainView","MessageView","GuideView","BattleHubView"]),uiMgr.getOpenView("MainView").setIndex(0),battleMain.enterChapter(0)},u.registerUpdateHandler=function(){this.addEvent(E.PARKING_CUR_PARKING_INFO_UPDATE,this.updateData,this)},u.onMaskClick=function(){this.close()},u.onShowProtectTime=function(){for(var t,e=this.spotInfo.ext,n=0,o=i(e);!(t=o()).done;){var s=t.value;11==s.k&&(n=s.v)}var a=Math.max(30,Math.floor((n-this.spotInfo.start_time)/60));this.findChildComponent("content/tips-001/txt",l).string=p.formatStrWithMirrorDeal(GetLanguage(201709),a),this.findChild("content/tips-001").active=!0},u.onAfterOpen=function(){var t;this.pos=this.openArgs[0],this.type=this.openArgs[1],this.master_id=this.openArgs[2],this.openType=null!=(t=this.openArgs[3])?t:0,1==this.openType?(this.btnCall.active=!1,this.btnGoto.active=!0):(this.btnCall.active=!0,this.btnGoto.active=!1),this.updateData(),this.refreshIdleTime(),this.addTimer(1,-1,this.refreshIdleTime,this)},u.onBeforeClose=function(){},u.onDestroy=function(){},u.refreshAwardItem=function(){for(var t,e,n=this.spotInfo.ext,o=0,s=0,a=i(n);!(e=a()).done;){var r=e.value;5==r.k?o=r.v:10==r.k?s=r.v:11==r.k&&(t=r.v)}var h=this.awardList[0];h.rate.string=o+"/m",this.loadIcon(h.icon,"icon_item","201"),h.award.string=p.GetNumString(s),this.btnBuff.active=t>c.serverTime},u.refreshIdleTime=function(){if(this.spotInfo){var t=this.spotInfo.start_time,e=Math.min(Math.max(c.serverTime-t,0),60*v.park_time_limit),i=c.formatTimeForSecond(e);this.timeTxt.string=i,c.serverTime-t>=60*v.park_time_limit&&IS(L).master_id==IS(I).GetRoleId()?this.btnHelp.getComponent(s).grayscale=!1:this.btnHelp.getComponent(s).grayscale=!0,e%60==0&&(3!=IS(L).type?(this.updateDebuffTime(),IS(b).reqParkingInfo(IS(L).type,IS(L).master_id,IS(L).ceng),this.refreshAwardItem()):(IS(b).reqCrossParkDetail(IS(L).master_id),this.refreshAwardItem()))}},u.refreshRestHP=function(){for(var t,e=this.spotInfo.ext,n=0,o=1,s=0,a=i(e);!(t=a()).done;){var r=t.value;1==r.k?n=r.v:2==r.k?o=r.v:3==r.k&&(s=r.v)}this.nodeHp.active=!0,this.pbHP.progress=n/o,this.txtHP.string=(n/o*100).toFixed(2)+"%",IS(I).GetRoleId()==IS(L).master_id&&s>0?(this.btnCall.active=!1,this.btnGoto.active=!1,this.btnRob.active=!1,this.nodeHelp.active=!0):(this.nodeHelp.active=!1,this.btnRob.active=!0,1==this.openType?(this.btnCall.active=!1,this.btnGoto.active=!0):(this.btnCall.active=!0,this.btnGoto.active=!1))},u.UpdateChangeInfo=function(){var t=this.spotInfo.info_list,e=t.kv,n=t.ks;if(null!=e)for(var o,s=i(e);!(o=s()).done;){var a=o.value;this.updateRoleAttr(a.k,a.v)}if(null!=n)for(var r,h=i(n);!(r=h()).done;){var d=r.value;this.updateRoleAttr(d.k,d.s)}},u.updateRoleAttr=function(t,e){var i=this.roleInfo[t];if(null!=i)return i=e,this.roleInfo[t]=i,i},u.updatePlayerInfo=function(){this.txtName.string=this.roleInfo[R.ROLE_ATTR_NAME],this.txtTitle.string=this.spotInfo.car_master_name+GetLanguage(201418),this.txtPower.string=p.GetNumString(this.roleInfo[R.ROLE_ATTR_POWER_SHOW]),this.txtLevel.string=""==this.roleInfo[R.ROLE_ATTR_GUILD_NAME]?GetLanguage(200165):this.roleInfo[R.ROLE_ATTR_GUILD_NAME];var t=this.roleInfo[R.ROLE_ATTR_HEAD_URL];this.loadRemoteIcon(t,this.imgHeadIcon);var e=this.roleInfo[R.ROLE_ATTR_HEAD_FRAME_ID];if(e>0){var i=configAvatar_frame.getDataByKey(e);this.loadIcon(this.imgHeadFrame,"icon_frame",i.icon),this.imgHeadFrame.node.active=!0}else this.imgHeadFrame.node.active=!1},u.updateDebuffTime=function(){for(var t,e=this.spotInfo.ext,n=0,o=0,s=i(e);!(t=s()).done;){var r=t.value;8==r.k?n=r.v:9==r.k&&(o=r.v)}if(!configPark_pvp_debuff.getDataByKeys("num",n,"type",1)||0==n&&0==o)this.nodeBuff.active=!1;else{var h=f.findChildComponent(this.nodeBuff,"nodeTime/txtTime",a),d=c.getTimeLeft(o-c.serverTime);h.string=d}},u.updateBuffInfo=function(){for(var t,e=this.spotInfo.ext,n=0,o=0,r=0,h=i(e);!(t=h()).done;){var d=t.value;8==d.k?n=d.v:9==d.k?o=d.v:11==d.k&&(r=d.v)}var l=configPark_pvp_debuff.getDataByKeys("num",n,"type",1);if(!l||0==n&&0==o)this.nodeBuff.active=!1;else{this.nodeBuff.active=!0;var u=f.findChildComponent(this.nodeBuff,"imgIcon",s);this.loadIcon(u,"parking","gg_ui_debuff");var v=f.findChildComponent(this.nodeBuff,"num",a);this.updateDebuffTime(),v.string=n+"",this.txtTips.string=p.formatStr.apply(p,[l.debuff_desc].concat(l.desc_parm))}this.btnBuff.active=r>c.serverTime},u.updateData=function(){if(this.type==IS(L).type&&this.master_id==IS(L).master_id){for(var t,e=i(IS(L).space_list);!(t=e()).done;){var n=t.value;n.pos==this.pos&&(this.spotInfo=n)}if(!this.spotInfo)return;this.updateBuffInfo(),this.UpdateChangeInfo(),this.refreshAwardItem(),this.refreshRestHP(),this.updatePlayerInfo(),3==IS(L).type&&(this.btnBuff.active=!1,this.btnCall.active=!1,this.btnGoto.active=!1,this.btnRob.active=!1,this.btnHelp.active=!1,this.nodeHp.active=!1)}},n}(u));n._RF.pop()}}}));

