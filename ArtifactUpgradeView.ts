System.register("chunks:///_virtual/ArtifactUpgradeView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./index57.ts","./ItemIcon.ts","./BagModel.ts","./MessageView.ts","./ArtifactControl.ts","./ArtifactDataCache.ts","./ArtifactDefine.ts","./BaseSubView.ts"],(function(t){"use strict";var e,i,n,o,r,s,a,l,h,d,c,f,g,u,C,v,p,m,I,S,A,x;return{setters:[function(t){e=t.inheritsLoose,i=t.createForOfIteratorHelperLoose},function(t){n=t.cclegacy,o=t.Label,r=t.Sprite,s=t.Button,a=t.ScrollView,l=t.Vec2,h=t.Vec3,d=t.sys,c=t.js,f=t.ProgressBar},function(t){g=t.ListItem},function(t){u=t.default},function(t){C=t.default},null,function(t){v=t.IconAseetType},function(t){p=t.BagModel},function(t){m=t.default},function(t){I=t.default},function(t){S=t.ArtifactDataCache},function(t){A=t.ArtifactEvent},function(t){x=t.BaseSubView}],execute:function(){n._RF.push({},"ce5d1To1WhIsrZSYZWMVZ6N","ArtifactUpgradeView",void 0);t("default",function(t){function n(){var e;return(e=t.call(this)||this).nodeRoot=void 0,e.btnOne=void 0,e.btnTen=void 0,e.btnUse=void 0,e.btnCancel=void 0,e.nodeUnlock=void 0,e.attrUIList=void 0,e.attrTopUIList=void 0,e.AttrlistItem=[],e.AttrToplistItem=[],e.artifactEffectID=0,e.showID=1,e.txtLevel=void 0,e.name="ArtifactUpgradeView",e.url="ui/module/artifact/ArtifactUpgradeView",e.poolTime=3e3,e}e(n,t);var g=n.prototype;return g.onInit=function(){var t=this;this.nodeRoot=this.findChild("root"),this.nodeUnlock=this.findChild("root/nodeShow/nodeUnlock"),this.txtLevel=this.findChildComponent("root/nodeProgress/ProgressBar/Node",o);var e=this.findChild("root/nodeItem"),n=this.findChildComponent("root/nodeItem/Sprite",r);this.loadIcon(n,"icon_item","1017"),this.addComponentCallbackListener(e,s.EventType.CLICK,(function(){IS(p).OpenItemTips(1017,e)})),this.btnCancel=this.findChild("root/nodeShow/btnCancel"),this.addComponentCallbackListener(this.btnCancel,s.EventType.CLICK,(function(){IS(I).reqUseArtifact(0)})),this.btnUse=this.findChild("root/nodeShow/btnUse"),this.addComponentCallbackListener(this.btnUse,s.EventType.CLICK,(function(){IS(I).reqUseArtifact(t.showID)})),this.btnOne=this.findChild("root/nodeChange/btnOne");var c=this.findChildComponent("root/nodeChange/btnOne/common_ui_jinggao",r);this.loadIcon(c,"icon_item","1017"),this.addComponentCallbackListener(this.btnOne,s.EventType.CLICK,(function(){t.onClickOne()})),this.btnTen=this.findChild("root/nodeChange/btnTen");var f=this.findChildComponent("root/nodeChange/btnTen/common_ui_jinggao-001",r);this.loadIcon(f,"icon_item","1017"),this.addComponentCallbackListener(this.btnTen,s.EventType.CLICK,(function(){t.onClickTen()}));var g=this.findChild("root/nodeShow/btnSkin");this.addComponentCallbackListener(g,s.EventType.CLICK,(function(){uiMgr.openView("ArtifactSkinView")}));var u=this.findChildComponent("root/nodeChange/ScrollView",a);this.attrUIList=this.addUIList(u,y);var C=this.findChildComponent("root/nodeTop/ScrollView",a);this.attrTopUIList=this.addUIList(C,b);for(var v,m=i(configArtifact_level.getDatas());!(v=m()).done;){var A=v.value;0!=A.unlock&&(this.showID=A.unlock)}this.addRedPoint("artifact_upgrade_active",this.btnTen,new l(100,30)),IS(S).checkUpgradeRP(),this.findChild("root/nodeShow/icon").position=new h(d.uiMirror?45:-45,-65,0)},g.onAfterOpen=function(){this.refreshUpgradeShow()},g.registerUpdateHandler=function(){this.addEvent(A.TYPE_ARTIFACT_CHANGE,this.refreshUpgradeShow,this),this.addEvent(A.TYPE_ARTIFACT_ADD_EXP,this.refreshItemNum,this)},g.refreshSkillInfo=function(){var t=u.findChildComponent(this.nodeRoot,"nodeSkill/Frame",r),e=u.findChildComponent(this.nodeRoot,"nodeSkill/Icon",r),i=u.findChildComponent(this.nodeRoot,"nodeSkill/txtName",o),n=u.findChildComponent(this.nodeRoot,"nodeSkill/txtCurDesc",o),s=u.findChildComponent(this.nodeRoot,"nodeSkill/txtNextDesc",o),a=u.findChildComponent(this.nodeRoot,"nodeSkill/txtHint",o),l=u.findChild(this.nodeRoot,"nodeSkill/arrow"),h=configArtifact_level.getDataByKey(IS(S).curLevel);if(h){var d=configArtifact_level.getDatas()[configArtifact_level.getDatas().length-1].level,f=10*Math.ceil(IS(S).curLevel/10)+1,g=configSkill.getDataByKey(h.base_skill[0][0]);this.loadIcon(t,"icon_skill",c.formatStr("common_ICON_jinengkuang0%s",g.quality)),this.loadIcon(e,"icon_skill",g.icon,null,v.ICON_SPRITE),i.string=g.name;var p=configSkill_level.getDataByKeys("id",h.base_skill[0][0],"level",h.base_skill[0][1]);if(n.string=C.formatStr.apply(C,[p.desc].concat(p.desc_parm)),f<d){s.node.active=!0,a.node.active=!0,l.active=!0;var m=configArtifact_level.getDataByKey(f),I=configSkill_level.getDataByKeys("id",m.base_skill[0][0],"level",m.base_skill[0][1]);s.string=C.formatStr.apply(C,[I.desc].concat(I.desc_parm)),a.string=C.formatStrWithMirrorDeal(GetLanguage(100010012),m.level.toString())}else s.node.active=!1,a.node.active=!1,l.active=!1}},g.refreshAttrChange=function(){var t=u.findChildComponent(this.nodeRoot,"nodeChange/txtLevelBase",o),e=u.findChildComponent(this.nodeRoot,"nodeChange/txtLevelNext",o),i=u.findChildComponent(this.nodeRoot,"nodeTop/txtLevelBase",o),n=this.findChild("root/nodeChange"),r=this.findChild("root/nodeTop"),s=configArtifact_level.getDataByKey(IS(S).curLevel),a=configArtifact_level.getDataByKey(IS(S).curLevel+1);if(this.AttrlistItem=[],this.AttrToplistItem=[],null!=s)if(null!=a){t.string=s.level+"",e.string=a.level+"";for(var l=0;l<s.attr.length;l++){var h=configAttribute.getDataByKey(s.attr[l][0]),d={show_type:h.show_type,name:h.desc,base:s.attr[l][1],next:a.attr[l][1]};this.AttrlistItem.push(d)}this.attrUIList.datas=this.AttrlistItem,n.active=!0,r.active=!1}else{i.string=s.level+"";for(l=0;l<s.attr.length;l++){var c=configAttribute.getDataByKey(s.attr[l][0]),f={show_type:c.show_type,name:c.desc,base:s.attr[l][1]};this.AttrToplistItem.push(f)}this.attrTopUIList.datas=this.AttrToplistItem,n.active=!1,r.active=!0}},g.onClickOne=function(){IS(p).getGoodsCountByGoodsGtid(1017)<1?m.showFlyTip(GetLanguage(200069)):IS(I).reqLevelUp(0)},g.onClickTen=function(){IS(p).getGoodsCountByGoodsGtid(1017)<1?m.showFlyTip(GetLanguage(200069)):IS(I).reqLevelUp(1)},g.checkOneKeyShow=function(){var t=u.findChild(this.btnTen,"txtNum"),e=u.findChild(this.btnTen,"txtRed"),i=u.findChildComponent(this.btnTen,"txtNum",o),n=u.findChild(this.btnOne,"txtNum"),r=u.findChild(this.btnOne,"txtRed"),s=IS(p).getGoodsCountByGoodsGtid(1017);if(e.active=0==s,t.active=0!=s,r.active=0==s,n.active=0!=s,null!=configArtifact_level.getDataByKey(IS(S).curLevel+1)){var a=configArtifact_level.getDataByKey(IS(S).curLevel+1).expend_exp;a-=IS(S).curexp,i.string=s>=a?"X"+a:"X"+s}else i.string="X1"},g.refreshArtifactShow=function(){var t=this.findChild("root/nodeShow/icon"),e=this.findChildComponent("root/nodeShow/bgName/txtName",o),i=configArtifact.getDataByKey(this.showID);e.string=i.name,this.removeUIEffect(this.artifactEffectID),this.artifactEffectID=this.addUIEffect(configArtifact.getDataByKey(this.showID).path,t,-1,null,1,(function(t){d.uiMirror&&(t.dir=-1)})),this.checkPageBtn()},g.checkPageBtn=function(){if(console.log("checkPageBtn",IS(S).curLevel<21),IS(S).curLevel<21)return this.btnUse.active=!1,this.btnCancel.active=!1,void(this.nodeUnlock.active=!0);this.nodeUnlock.active=!1,this.showID==IS(S).artifact_id?(this.btnCancel.active=!0,this.btnUse.active=!1):(this.btnCancel.active=!1,this.btnUse.active=!0)},g.refreshItemNum=function(){this.refreshProgress(),this.checkOneKeyShow(),this.refreshAttrChange();var t=this.findChildComponent("root/nodeItem/Label",o),e=C.GetNumString(IS(p).getGoodsCountByGoodsGtid(1017));t.string=""+e,IS(S).checkUpgradeRP()},g.refreshProgress=function(){var t=configArtifact_level.getDataByKey(IS(S).curLevel);if(null!=t){var e=this.findChildComponent("root/nodeProgress/ProgressBar",f),i=this.findChildComponent("root/nodeProgress/ProgressBar/txtDesc",o),n=t.expend_exp,r=configArtifact_level.getDataByKey(IS(S).curLevel+1);if(this.txtLevel.string="lv."+IS(S).curLevel,null==r)return e.progress=1,void(i.string=n+"/"+n);var s=IS(S).curexp;s-=n,n=r.expend_exp-t.expend_exp,e.progress=s/n,i.string=s+"/"+n}},g.refreshUpgradeShow=function(){this.refreshSkillInfo(),this.refreshAttrChange(),this.refreshArtifactShow(),this.refreshItemNum(),this.refreshProgress()},g.onBeforeClose=function(){},g.onDestroy=function(){},n}(x));var y=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).txtAttrName=void 0,e.txtAttrBase=void 0,e.txtAttrNext=void 0,e}e(i,t);var n=i.prototype;return n.onInit=function(){this.txtAttrName=u.findChildComponent(this.node,"txtAttrName",o),this.txtAttrBase=u.findChildComponent(this.node,"txtAttrBase",o),this.txtAttrNext=u.findChildComponent(this.node,"txtAttrNext",o)},n.onRender=function(t,e){this.txtAttrName.string=t.name,2==t.show_type?(this.txtAttrBase.string=c.formatStr("%s%",C.GetNumString(t.base/100)),this.txtAttrNext.string=c.formatStr("%s%",C.GetNumString(t.next/100))):3==t.show_type?(this.txtAttrBase.string=C.GetNumString(Math.floor(t.base/100)/100),this.txtAttrNext.string=C.GetNumString(Math.floor(t.next/100)/100)):(this.txtAttrBase.string=C.GetNumString(t.base),this.txtAttrNext.string=C.GetNumString(t.next))},n.onItemClick=function(){},i}(g),b=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).txtAttrName=void 0,e.txtAttrBase=void 0,e}e(i,t);var n=i.prototype;return n.onInit=function(){this.txtAttrName=u.findChildComponent(this.node,"txtAttrName",o),this.txtAttrBase=u.findChildComponent(this.node,"txtAttrBase",o)},n.onRender=function(t,e){this.txtAttrName.string=t.name,2==t.show_type?this.txtAttrBase.string=c.formatStr("%s%",C.GetNumString(t.base/100)):3==t.show_type?this.txtAttrBase.string=C.GetNumString(Math.floor(t.base/100)/100):this.txtAttrBase.string=C.GetNumString(t.base)},n.onItemClick=function(){},i}(g);n._RF.pop()}}}));

