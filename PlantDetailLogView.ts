System.register("chunks:///_virtual/PlantDetailLogView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./FriendControl.ts","./FrameDataCache.ts","./RoleDataCache.ts","./PlantControl.ts","./PlantDefine.ts","./BaseSubView.ts"],(function(t){"use strict";var e,i,n,a,o,s,r,l,d,h,c,u,m,f,g,v,L,p;return{setters:[function(t){e=t.inheritsLoose,i=t.createForOfIteratorHelperLoose},function(t){n=t.cclegacy,a=t.ScrollView,o=t.Button,s=t.Sprite,r=t.Label,l=t.Layout},function(t){d=t.ListItem},function(t){h=t.default},function(t){c=t.default},function(t){u=t.default},null,function(t){m=t.default},function(t){f=t.FrameDataCache},function(t){g=t.RoleDataCache},function(t){v=t.default},function(t){L=t.PlantEventDefine},function(t){p=t.BaseSubView}],execute:function(){n._RF.push({},"ca40dQPpuVLuLVV5Ve0FvES","PlantDetailLogView",void 0);t("default",function(t){function n(){var e;return(e=t.call(this)||this).scrollList=void 0,e.curPage=1,e.list=[],e.uidMap=new Map,e.isEnd=!1,e.isRequesting=!1,e.name="PlantDetailLogView",e.url="ui/module/plant/sub/PlantDetailLogView",e}e(n,t);var o=n.prototype;return o.onInit=function(){var t=this,e=this.findChildComponent("scroll",a);this.scrollList=this.addUIList(e,C),this.scrollList.inBottomFunc=function(){t.requestNextPage()}},o.registerUpdateHandler=function(){this.addEvent(L.ROLE_HOME_FARM_INFO_BACK,this.onGotoOtherPlant,this),this.addEvent(L.FARM_LOG_DETAIL,this.onUpdateLogList,this)},o.onAfterOpen=function(){IS(v).reqDetailLogList()},o.onBeforeClose=function(){},o.onDestroy=function(){},o.onUpdateLogList=function(t){if(0==t.log_list.length)return this.isEnd=!0,void(this.isRequesting=!1);this.curPage=t.page;for(var e,n=i(t.log_list);!(e=n()).done;){var a=e.value;this.uidMap.set(a.id,a)}for(var o,s=[],r=i(this.uidMap.values());!(o=r()).done;){var l=o.value;s.push(l)}s.sort((function(t,e){return e.time-t.time})),this.scrollList.datas=s,this.isRequesting=!1},o.onGotoOtherPlant=function(t){uiMgr.openView("PlantMainView",t),this.parentView.close()},o.requestNextPage=function(){this.isEnd||this.isRequesting||this.scrollList.getIsShowBottomItem(this.uidMap.size-1)&&(this.isRequesting=!0,IS(v).reqDetailLogList(this.curPage+1))},n}(p));var C=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),a=0;a<i;a++)n[a]=arguments[a];return(e=t.call.apply(t,[this].concat(n))||this).imgIcon=void 0,e.imgHeadFrame=void 0,e.txtName=void 0,e.txtTime=void 0,e.txtLevel=void 0,e.txtDesc=void 0,e.btnPlant=void 0,e.imgNew=void 0,e}e(i,t);var n=i.prototype;return n.onInit=function(){var t=this,e=h.findChild(this.node,"imgFrame");this.view.addComponentCallbackListener(e,o.EventType.CLICK,(function(){null!=t.data.farm_id?IS(m).reqOtherRoleNotice(t.data.farm_id,1):IS(m).reqOtherRoleNotice(t.data.role_id,1)})),this.imgIcon=h.findChildComponent(this.node,"imgFrame/imgIcon",s),this.imgHeadFrame=h.findChildComponent(this.node,"imgFrame/imgHeadFrame",s),this.txtLevel=h.findChildComponent(this.node,"txt/txtLevel",r),this.txtName=h.findChildComponent(this.node,"txt/txtName",r),this.txtTime=h.findChildComponent(this.node,"txtTime",r),this.txtDesc=h.findChildComponent(this.node,"txtDesc",r),this.imgNew=h.findChildComponent(this.node,"imgNew",s),this.view.loadIcon(this.imgNew,"farm","zy_ui_new"),this.imgNew.node.active=!1,this.view.dealMirrorLayout(h.findChildComponent(this.node,"txt",l)),this.btnPlant=h.findChild(this.node,"btnPlant"),this.view.addComponentCallbackListener(this.btnPlant,o.EventType.CLICK,(function(){null!=t.data.farm_id?IS(v).reqFarmInfo(t.data.farm_id):IS(v).reqFarmInfo(t.data.role_id)}))},n.onRender=function(t,e){var i=this,n=configFarm_action.getDataByKey(t.action_id);if(0===n.type){this.view.loadRemoteIcon(IS(g).GetHeadUrl(),this.imgIcon),this.txtName.string=GetLanguage(300095),this.txtLevel.string="Lv."+IS(g).GetLevel();var a=IS(f).curFrameId;if(a>0){var o=configAvatar_frame.getDataByKey(a);this.view.loadIcon(this.imgHeadFrame,"icon_frame",o.icon),this.imgHeadFrame.node.active=!0}else this.imgHeadFrame.node.active=!1}else{var s;if(null!=(s=t.head)&&s.url&&i.view.loadRemoteIcon(t.head.url,i.imgIcon),this.txtName.string=c.formatStrWithMirrorDeal(GetLanguage(300143),t.farm_name),this.txtLevel.string="Lv."+t.level,t.head&&t.head.frame_id>0){var r=configAvatar_frame.getDataByKey(t.head.frame_id);this.view.loadIcon(this.imgHeadFrame,"icon_frame",r.icon),this.imgHeadFrame.node.active=!0}else this.imgHeadFrame.node.active=!1}this.imgNew.node.active=0==t.is_read,this.txtTime.string=u.getDateDiff(t.time),this.btnPlant.active=1===n.type,this.txtDesc.string=c.format_p_lang_info(n.desc,t.content,void 0,{leftTimeCallback:function(t){return t/60}})},i}(d);n._RF.pop()}}}));

