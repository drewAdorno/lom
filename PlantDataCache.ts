System.register("chunks:///_virtual/PlantDataCache.ts",["cc","./BagModel.ts","./RoleDefine.ts","./RoleDataCache.ts","./PlantDefine.ts","./ObjectUtil.ts","./RedPointMgr.ts","./index57.ts","./CommonDefine.ts","./UIDefine.ts"],(function(t){"use strict";var n,e,i,o,a,s,r,d,l,c,h,f,u;return{setters:[function(t){n=t.cclegacy,e=t.js},function(t){i=t.BagModel},function(t){o=t.PlayerAttr,a=t.RoleEventDefine},function(t){s=t.RoleDataCache},function(t){r=t.PlantEventDefine,d=t.CropState},function(t){l=t.default},function(t){c=t.RedPointMgr},null,function(t){h=t.CommonEventDefine},function(t){f=t.OpenFunction,u=t.PanelTabType}],execute:function(){var _;n._RF.push({},"83d708vc5lOX6i8fLzWDvLh","PlantDataCache",void 0);var E=[1,2,3],I=((_={})[o.ROLE_SEED_GET]=!0,_[o.ROLE_SEED_BUY]=!0,_[o.ROLE_SEED_RARE]=!0,_[o.ROLE_BUILDING_POINT]=!0,_);t("PlantDataCache",function(){var t=n.prototype;function n(){this.farmLevel=void 0,this.farmExp=void 0,this.landIdToInfo=void 0,this.buildingIdToinfo=void 0,this.stealSearchList=void 0,this.stealEnemyList=void 0,this.stealSearchRefreshTime=void 0,this.lastReqTime=void 0,this.waitShowDeafeatThiefLand=void 0,this.curFightLandId=void 0,this.stolenList=void 0,this.helpList=[],this.farmLevel=1,this.farmExp=0,this.landIdToInfo={},this.buildingIdToinfo={},this.lastReqTime=0,this.stolenList=[],normalEvent.on(a.ROLE_RES_UPDATE,this.onRoleResUpdate,this),normalEvent.on(a.ROLE_OPEN_FUNCTION_UPDATE,this.onRoleOpenFunctionUpdate,this)}return t.clear=function(){normalEvent.off(a.ROLE_RES_UPDATE,this.onRoleResUpdate,this),normalEvent.off(a.ROLE_OPEN_FUNCTION_UPDATE,this.onRoleOpenFunctionUpdate,this)},t.onRoleResUpdate=function(t){I[t]&&this.updateFarmRedPoint()},t.onRoleOpenFunctionUpdate=function(t){t==f.FUNC_FARM&&this.updateFarmRedPoint()},t.onHomeFarmInfoBack=function(t){var n=t.role_id;0==n||n==IS(s).GetRoleId()?this.initHomeFarmInfo(t):this.onOtherHomeFarmInfoBack(t)},t.initHomeFarmInfo=function(t){this.farmLevel=t.level,this.farmExp=t.exp;var n=l.clone(this.landIdToInfo);this.landIdToInfo={};for(var e=t.land_list,i=[],o=0;o<e.length;o++){var a=e[o];null==n[a.id]&&null!=a&&i.push(a.id),this.landIdToInfo[a.id]=a}for(var s=t.building_list,d=0;d<s.length;d++){var c=s[d];this.buildingIdToinfo[c.cfg_id]=c}this.stolenList=t.self_stolen_list||[],this.updateFarmRedPoint(),i.length>0&&normalEvent.emit(r.FARM_LAND_UNLOCK_ACTION,i),normalEvent.emit(r.HOME_FARM_INFO_INIT)},t.onOtherHomeFarmInfoBack=function(t){for(var n={role_id:t.role_id,farmLevel:t.level,farmExp:t.exp,buildingIdToinfo:{},landIdToInfo:{},name:t.name,stolenList:t.self_stolen_list||[],canHelpBattle:t.can_help_battle||0},e=t.land_list,i=0;i<e.length;i++){var o=e[i];n.landIdToInfo[o.id]=o}for(var a=t.building_list,s=0;s<a.length;s++){var d=a[s];n.buildingIdToinfo[d.cfg_id]=d}normalEvent.emit(r.ROLE_HOME_FARM_INFO_BACK,n)},t.updateFarmRedPoint=function(){IS(c).changeValue(e.formatStr("MainView/tab-%s/farm",u.Main_Mystery),this.getFarmRedPoint()),normalEvent.emit(h.UPDATE_MAIN_MYSTERY_RED_POINT)},t.getFarmRedPoint=function(){return IS(s).CheckFuncOpen(f.FUNC_FARM)&&(this.checkHasLandRemind()||this.checkHasBuildingCanUpgrade())?1:0},t.checkShowGrowing=function(){return!this.checkLandHasTargetStatus(d.WAIT_FETCH)&&!this.checkLandHasTargetStatus(d.MATURE)&&this.checkLandHasTargetStatus(d.GROWING)},t.checkHasLandRemind=function(){return this.checkLandHasTargetStatus(d.WAIT_FETCH)||this.checkLandHasTargetStatus(d.MATURE)||this.checkLandHasTargetStatus(d.NOT_EXIT)&&this.checkHasSeed()},t.checkHasSeed=function(){return IS(i).getGoodsCountByGoodsGtid(o.ROLE_SEED_GET)+IS(i).getGoodsCountByGoodsGtid(o.ROLE_SEED_BUY)+IS(i).getGoodsCountByGoodsGtid(o.ROLE_SEED_RARE)>0},t.checkLandHasTargetStatus=function(t){for(var e in IS(n).landIdToInfo){var i=IS(n).landIdToInfo[e].crop;if(null==i&&t==d.NOT_EXIT)return!0;if(i&&i.state==t)return!0}return!1},t.checkHasBuildingCanUpgrade=function(){for(var t=0;t<E.length;t++)if(this.checkBuildingCanUpgrade(E[t]))return!0;return!1},t.checkBuildingCanUpgrade=function(t){var n=this.buildingIdToinfo[t];if((n?n.end_time:0)>0)return!1;var e=n?n.level:0,o=configFarm_buildings.getDataByKeys("id",t,"level",e+1);if(l.isEmpty(o))return!1;var a=o.condition;if(null!=a)for(var s,r,d=0;d<a.length;d++){s=a[d][0],r=a[d][1];var c=this.buildingIdToinfo[s];if((null!=c?c.level:0)<r)return!1}var h=o.cost,f=h[0][0];return IS(i).getGoodsCountByGoodsGtid(f)>=h[0][1]},n}());n._RF.pop()}}}));

