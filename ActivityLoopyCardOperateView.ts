System.register("chunks:///_virtual/ActivityLoopyCardOperateView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./StringUtil.ts","./index57.ts","./BagModel.ts","./MessageView.ts","./ActivityControl.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./ActivityLoopyDefine.ts","./BaseView.ts"],(function(t){"use strict";var e,i,n,o,a,s,r,d,c,l,u,h,f,m,v,g,p;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,n=t.Button,o=t.Sprite,a=t.Label,s=t.RichText,r=t.js},function(t){d=t.default},null,function(t){c=t.BagModel},function(t){l=t.default},function(t){u=t.default},function(t){h=t.default},function(t){f=t.ActivityType,m=t.ActivityState,v=t.ActivityEventDefine},function(t){g=t.CardItemIcon},function(t){p=t.BaseView}],execute:function(){i._RF.push({},"2c493kwvRFPA7A4SPEH7tUr","ActivityLoopyCardOperateView",void 0);t("default",function(t){function i(){var e;return(e=t.call(this)||this).tabList=void 0,e.curIndex=void 0,e.itemId=void 0,e.sendPrivateTxt=void 0,e.sendChannelTxt=void 0,e.item=void 0,e.cardName=void 0,e.haveNum=void 0,e.times=void 0,e.isTimesEnough=void 0,e.isRecTimeEnough=void 0,e.name="ActivityLoopyCardOperateView",e.url="ui/module/activityLoopy/ActivityLoopyCardOperateView",e}e(i,t);var p=i.prototype;return p.onInit=function(){var t=this,e=this.findChild("btnClose");this.addComponentCallbackListener(e,n.EventType.CLICK,(function(){t.close()})),this.tabList=[];for(var i=function(e){var i={itemGo:t.findChild("select/item"+(e+1)),select:t.findChild("select/item"+(e+1)+"/select")};t.addComponentCallbackListener(i.itemGo,n.EventType.CLICK,(function(){t.RefreshSelectItem(e)})),t.tabList[e]=i},r=0;r<2;r++)i(r);this.item=this.findChildComponent("item",o),this.times=this.findChildComponent("times",a),this.haveNum=this.findChildComponent("haveNum",s),this.cardName=this.findChildComponent("item/name/Label",a);var v=this.findChild("sendPrivateBtn");this.addComponentCallbackListener(v,n.EventType.CLICK,(function(){var e=IS(h).GetActivityInfo(f.LoopyCard);if(e&&e.state!=m.EndShow)if(0==t.curIndex){if(IS(c).getGoodsCountByGoodsGtid(t.itemId)<=1)return void l.showFlyTip(GetLanguage(200748));uiMgr.openView("ActivityLoopyCardSendView",t.itemId,1)}else{if(!t.isRecTimeEnough)return void l.showFlyTip(GetLanguage(204418));uiMgr.openView("ActivityLoopyCardSendView",t.itemId,2)}else l.showFlyTip(GetLanguage(200026))}));var g=this.findChild("sendChannelBtn");this.addComponentCallbackListener(g,n.EventType.CLICK,(function(){var e=IS(h).GetActivityInfo(f.LoopyCard);if(e&&e.state!=m.EndShow)if(0==t.curIndex){if(IS(c).getGoodsCountByGoodsGtid(t.itemId)<=1)return void l.showFlyTip(GetLanguage(200748));var i=configGoods.getDataByKey(t.itemId),n=d.formatStrWithMirrorDeal(GetLanguage(200751),i.name);l.showBoxTip({tip:n,title:GetLanguage(200048),func:function(e){"type_yes"==e&&IS(u).send_collect_send(f.LoopyCard,t.itemId,2,0,0)}})}else{if(!t.isRecTimeEnough)return void l.showFlyTip(GetLanguage(204418));var o=configGoods.getDataByKey(t.itemId),a=d.formatStrWithMirrorDeal(GetLanguage(200771),o.name);l.showBoxTip({tip:a,title:GetLanguage(200048),func:function(e){"type_yes"==e&&IS(u).send_collect_ask(f.LoopyCard,t.itemId,0,0)}})}else l.showFlyTip(GetLanguage(200026))})),this.sendPrivateTxt=this.findChildComponent("sendPrivateBtn/Label",a),this.sendChannelTxt=this.findChildComponent("sendChannelBtn/Label",a)},p.RefreshSelectItem=function(t){if(this.curIndex!=t){for(var e=0;e<this.tabList.length;e++)this.tabList[e].select.active=t==e;this.curIndex=t,this.sendPrivateTxt.string=0==this.curIndex?GetLanguage(200787):GetLanguage(200789),this.sendChannelTxt.string=0==this.curIndex?GetLanguage(200788):GetLanguage(200790),this.updateInfo()}},p.registerUpdateHandler=function(){this.addEvent(v.OnActivityCollectInfo,this.updateInfo)},p.onAfterOpen=function(){this.itemId=this.openArgs[0];var t=configGoods.getDataByKey(this.itemId);this.loadIcon(this.item,"act_loopy_card",g[this.itemId]),this.cardName.string=t.name,this.RefreshSelectItem(0),this.updateInfo()},p.onBeforeClose=function(){},p.onDestroy=function(){},p.updateInfo=function(){var t,e=IS(h).getCollectInfo(f.LoopyCard),i=IS(c).getGoodsCountByGoodsGtid(this.itemId),n="";n=i>1?r.formatStr("<color=#66e84c>%s</color>/1<color=#66e84c>%s</color>",i,d.formatStrWithMirrorDeal(GetLanguage(200791),i-1)):i>0?r.formatStr("<color=#66e84c>%s</color>/1",i):r.formatStr("<color=#f33f08>%s</color>/1",i),this.haveNum.string=r.formatStr("<color=#fffde8><outline width = 2 color=#2d2620><b>%s</b></outline></color>",d.formatStrWithMirrorDeal(GetLanguage(200792),n));var o,a=IS(h).GetActivityInfo(f.LoopyCard);a&&a.state!=m.EndShow?this.times.string=d.formatStrWithMirrorDeal(GetLanguage(204404),Math.max(0,null!=(o=e.recv_times)?o:0)):this.times.string="";this.isRecTimeEnough=(null!=(t=e.recv_times)?t:0)>0},i}(p));i._RF.pop()}}}));

