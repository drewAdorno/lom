System.register("chunks:///_virtual/FateBreakView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./index57.ts","./ItemIcon.ts","./ConfigGlobal.ts","./MessageView.ts","./FateControl.ts","./FateDataCache.ts","./FateDefine.ts","./BaseSubView.ts"],(function(t){"use strict";var e,i,n,s,a,o,l,r,c,d,h,u,f,v,p,g,L,m;return{setters:[function(t){e=t.inheritsLoose,i=t.createForOfIteratorHelperLoose},function(t){n=t.cclegacy,s=t.ScrollView,a=t.Button,o=t.Sprite,l=t.Label},function(t){r=t.ItemGrid},function(t){c=t.ListItem},function(t){d=t.default},function(t){h=t.default},null,function(t){u=t.IconAseetType},function(t){f=t.ConfigGlobal},function(t){v=t.default},function(t){p=t.default},function(t){g=t.default},function(t){L=t.FateEventDefine},function(t){m=t.BaseSubView}],execute:function(){n._RF.push({},"eec943EzmVCmZrJk95cWXJK","FateBreakView",void 0);t("default",function(t){function n(){var e;return(e=t.call(this)||this).fateScroll=void 0,e.rewardScroll=void 0,e.selectAll=void 0,e.txtLimit=void 0,e.nothing=void 0,e.curType=0,e.selectList=[],e.fateList=[],e.name="FateBreakView",e.url="ui/module/fate/FateBreakView",e}e(n,t);var r=n.prototype;return r.onInit=function(){var t=this;this.nothing=this.findChild("view/nothing");var e=this.findChildComponent("view/fateScroll",s);this.fateScroll=this.addUIList(e,w);var n=d.findChildComponent(this.node,"view/reward/rewardScroll",s);this.rewardScroll=this.addUIList(n,C);var r=this.findChild("view/btnBreak");this.addComponentCallbackListener(r,a.EventType.CLICK,(function(){if(0!=t.selectList.length){for(var e,n=IS(g).GetFateList(),s=f.rare_fate,a=i(t.selectList);!(e=a()).done;){var o=n[e.value];if(o&&o.cfg.quality>=s)return void v.showBoxTip({tip:GetLanguage(200276),title:GetLanguage(200048),ensure:GetLanguage(200054),cancel:GetLanguage(200053),exchange:!0,func:function(e){"type_yes"==e&&IS(p).send_35_8(t.selectList)}})}IS(p).send_35_8(t.selectList)}else v.showFlyTip(GetLanguage(200275))})),this.selectAll=this.findChild("view/selectAll/img"),this.loadIcon(this.selectAll.getComponent(o),"common","common_ui_dagou");var c=this.findChild("view/selectAll");this.addComponentCallbackListener(c,a.EventType.CLICK,(function(){if(t.selectAll.active)t.selectAll.active=!1,t.selectList=[];else{t.selectAll.active=!0,t.selectList=[];for(var e,n=i(t.fateList);!(e=n()).done;){var s=e.value;t.selectList.push(s.id)}}t.fateScroll.updateAll(),t.UpadateReward()}));var h=this.findChild("view/btnLimit");this.txtLimit=this.findChildComponent("view/btnLimit/txt",l),this.addComponentCallbackListener(h,a.EventType.CLICK,(function(){uiMgr.openView("FateBreakTipsView",h,t.curType)}))},r.registerUpdateHandler=function(){this.addEvent(L.OnFateInfoUpdate,this.UpdateInfo,this),this.addEvent(L.FateSelectBreak,this.SelectLimit,this)},r.onAfterOpen=function(){this.selectAll.active=!1,this.curType=0,this.txtLimit.string=GetLanguage(200274),this.selectList=[],this.UpdateInfo()},r.onBeforeClose=function(){this.curType=0},r.onDestroy=function(){},r.UpdateInfo=function(){this.selectAll.active=!1,this.selectList=[];var t=IS(g).GetFateList(),e=[];for(var i in t)if(t.hasOwnProperty(i)){var n=t[i];if(IS(g).GetWearPos(n.id))continue;(0==this.curType&&n.cfg.quality<5||n.cfg.quality<=this.curType)&&e.push(n)}e.sort((function(t,e){return t.cfg.quality!=e.cfg.quality?e.cfg.quality-t.cfg.quality:t.lv!=e.lv?e.lv-t.lv:t.cfg_id-e.cfg_id})),this.fateList=e,this.fateScroll.datas=e,this.nothing.active=0==e.length,this.UpadateReward()},r.UpadateReward=function(){for(var t,e=[],n=IS(g).GetFateList(),s=i(this.selectList);!(t=s()).done;)for(var a,o=t.value,l=i(n[o].lv_cfg.breakdown_reward);!(a=l()).done;){var r=a.value;e[r[0]]||(e[r[0]]=0),e[r[0]]=e[r[0]]+r[1]}var c=[];for(var d in e)e.hasOwnProperty(d)&&c.push([d,e[d]]);c.sort((function(t,e){return t[0]-e[0]})),this.rewardScroll.datas=c},r.SelectLimit=function(t){this.selectAll.active=!1,this.selectList=[],this.curType=t,0==this.curType?this.txtLimit.string=GetLanguage(200274):this.txtLimit.string=h.formatStrWithMirrorDeal(GetLanguage(200271),GetLanguage(f.fate_quality[this.curType-1][1])),this.UpdateInfo()},n}(m));var w=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))||this).imgIcon=void 0,e.txtLevel=void 0,e.nodeHasWear=void 0,e.select=void 0,e}e(i,t);var n=i.prototype;return n.onInit=function(){var t=this;this.imgIcon=d.findChildComponent(this.node,"imgIcon",o),this.txtLevel=d.findChildComponent(this.node,"txtLevel",l),this.nodeHasWear=d.findChild(this.node,"imgHasWear"),this.select=d.findChild(this.node,"select"),this.view.loadIcon(this.select.getComponent(o),"common","common_ui_dagou"),this.view.addComponentCallbackListener(this.node,a.EventType.CLICK,(function(){t.select.active?(t.select.active=!1,t.view.selectList.splice(t.view.selectList.indexOf(t.data.id),1),t.view.selectAll.active&&(t.view.selectAll.active=!1)):(t.select.active=!0,t.view.selectList.push(t.data.id)),t.view.UpadateReward()}))},n.onRender=function(t,e){this.txtLevel.string="lv."+t.lv,this.view.loadIcon(this.imgIcon,"icon_fate",t.cfg.icon,null,u.ICON_SPRITE),this.nodeHasWear.active=!1;var i=IS(g).GetPosInfo();for(var n in i){if(i.hasOwnProperty(n))if(i[n].id==t.id){this.nodeHasWear.active=!0;break}}this.select.active=this.view.selectList.includes(t.id)},i}(c),C=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))||this).itemGridNode=void 0,e.itemGrid=void 0,e}e(i,t);var n=i.prototype;return n.onInit=function(){this.itemGridNode=d.findChild(this.node,"itemGrid"),this.itemGrid=new r(this.view,this.itemGridNode)},n.onRender=function(t,e){this.itemGrid.SetItemId(t[0],t[1])},i}(c);n._RF.pop()}}}));

