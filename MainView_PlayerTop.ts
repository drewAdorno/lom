System.register("chunks:///_virtual/MainView_PlayerTop.ts",["./rollupPluginModLoBabelHelpers.js","cc","./RedPoint.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./BaseSubView.ts","./ObjectUtil.ts","./AchievementDefine.ts","./RouletteDefine.ts","./BagDefine.ts","./BagModel.ts","./ChapterDataCache.ts","./ChatDefine.ts","./CommonDefine.ts","./GuideModel.ts","./MessageView.ts","./FriendDefine.ts","./GuildDataCache.ts","./GuildDefine.ts","./GuildWarControl.ts","./LoginDataCache.ts","./LoginDefine.ts","./MailDefine.ts","./MarryDataCache.ts","./MarryDefine.ts","./CustomeHeadDefine.ts","./FrameDataCache.ts","./TitleDefine.ts","./PrivilegeDataCache.ts","./PrivilegeDefine.ts","./RoleDataCache.ts","./RoleDefine.ts","./SdkDataCache.ts","./SevenLoginDefine.ts","./SurveyDefine.ts","./MainViewModel.ts","./UIDefine.ts"],(function(e){"use strict";var t,i,n,o,a,s,d,r,h,l,u,c,f,p,m,v,S,g,I,C,E,D,M,_,L,T,y,R,G,N,U,x,b,P,w,A,F,k,B,O,V,H,K,z,Y,j,W,J,X,Z,q;return{setters:[function(e){t=e.inheritsLoose},function(e){i=e.cclegacy,n=e.Button,o=e.Label,a=e.RichText,s=e.sys,d=e.Layout,r=e.Sprite,h=e.ProgressBar,l=e.Vec2,u=e.js},function(e){c=e.RedPointType},function(e){f=e.default},function(e){p=e.default},function(e){m=e.default},null,function(e){v=e.BaseSubView},function(e){S=e.default},function(e){g=e.AchievementEventDefine},function(e){I=e.RouletteEventDefine},function(e){C=e.BagEventDefine,E=e.ItemIdDefine},function(e){D=e.BagModel},function(e){M=e.ChapterDataCache},function(e){_=e.ChatDefine},function(e){L=e.CommonEventDefine},function(e){T=e.GuideModel},function(e){y=e.default},function(e){R=e.FriendDefine},function(e){G=e.default},function(e){N=e.GuildEventDefine},function(e){U=e.default},function(e){x=e.LoginDataCache},function(e){b=e.LoginEventDefine},function(e){P=e.MailDefine},function(e){w=e.default},function(e){A=e.MarryEventDefine},function(e){F=e.CustomeHeadDefine},function(e){k=e.FrameDataCache},function(e){B=e.TitleEventDefine},function(e){O=e.PrivilegeDataCache},function(e){V=e.Privilege,H=e.PrivilegeEventDefine},function(e){K=e.RoleDataCache},function(e){z=e.RoleEventDefine,Y=e.PlayerAttr},function(e){j=e.SdkDataCache},function(e){W=e.SevenLoginDefine},function(e){J=e.SurveyDefine},function(e){X=e.MainViewModel},function(e){Z=e.PanelTabType,q=e.OpenFunction}],execute:function(){i._RF.push({},"e8437ryXfRMY65v5yMFcbDo","MainView_PlayerTop",void 0);e("default",function(e){function i(){var t;return(t=e.call(this)||this).txtLevel=void 0,t.txtName=void 0,t.imgHeadIcon=void 0,t.imgHeadFrame=void 0,t.txtExperience=void 0,t.pbExperience=void 0,t.txtCoinNum=void 0,t.txtDiamondNum=void 0,t.txtStarNum=void 0,t.btnGM=void 0,t.now_time=void 0,t.nodeMask=void 0,t.oriLevelInfo=void 0,t.nodeLevelUp=void 0,t.nodeGuildBtn=void 0,t.opacityLevelUp=void 0,t.nodeLevelRoot=void 0,t.btnSpeed=void 0,t.btnSpeedTxt=void 0,t.txtFightPower=void 0,t.timerID=0,t.timer_speed=0,t.timer_date=0,t.isUpgrading=!1,t.btnMenu=void 0,t.nodeSpeedNormal=void 0,t.nodeInTime=void 0,t.imgSpeedTime=void 0,t.btnMarryMy=void 0,t.btnMarryMyName=void 0,t.name="MainView_PlayerTop",t}t(i,e);var v=i.prototype;return v.onInit=function(){var e=this;this.btnMenu=this.findChild("levelRoot/imgIcon"),this.addComponentCallbackListener(this.btnMenu,n.EventType.CLICK,(function(){e.onMenuClick()})),this.txtFightPower=this.findChildComponent("levelRoot/imgBg/txtFightPower",o),this.nodeLevelRoot=this.findChild("levelRoot"),this.txtLevel=this.findChildComponent("levelRoot/txtLevel",a),this.txtName=this.findChildComponent("levelRoot/imgBg/txtName",o),s.uiMirror&&this.dealMirrorLayout(this.findChildComponent("levelRoot/imgBg",d)),this.imgHeadIcon=this.findChildComponent("levelRoot/imgIcon/imgHeadIcon",r),this.imgHeadFrame=this.findChildComponent("levelRoot/imgIcon/imgHeadFrame",r),this.txtExperience=this.findChildComponent("levelRoot/txtProgress",o),this.pbExperience=this.findChildComponent("levelRoot/pbExperience",h),this.nodeMask=this.findChild("levelRoot/pbExperience/mask");var t=this.findChild("btnCoinRoot");this.addComponentCallbackListener(t,n.EventType.CLICK,(function(){e.onPlayerCoinClick()})),this.txtCoinNum=this.findChildComponent("btnCoinRoot/txtCoin",o);var i=this.findChild("btnDiamondRoot");this.addComponentCallbackListener(i,n.EventType.CLICK,(function(){e.onPlayerDiamondClick()})),this.txtDiamondNum=this.findChildComponent("btnDiamondRoot/txtDiamond",o),this.txtStarNum=this.findChildComponent("btnStarDiamondRoot/txtDiamond",o);var l=this.findChild("btnStarDiamondRoot");this.addComponentCallbackListener(l,n.EventType.CLICK,(function(){0!=IS(j).showrechage&&IS(X).TryJumpToMainViewPanel(Z.Main_Shop,Z.Shop_Cash)})),this.btnGM=this.findChild("btnGM"),this.addComponentCallbackListener(this.btnGM,n.EventType.CLICK,(function(){e.onGMClick()})),this.now_time=this.findChildComponent("time",o),this.btnSpeed=this.findChild("btnSpeed"),this.nodeSpeedNormal=this.findChild("btnSpeed/bs_ipng_bs01"),this.loadIcon(this.nodeSpeedNormal.getComponent(r),"speedup","bs_ipng_bs01"),this.nodeInTime=this.findChild("btnSpeed/inSpeed"),this.imgSpeedTime=this.findChildComponent("btnSpeed/inSpeed/pbTime/Bar",r),this.btnSpeedTxt=this.findChildComponent("btnSpeed/inSpeed/Label",o),this.addComponentCallbackListener(this.btnSpeed,n.EventType.CLICK,(function(){var e=0;IS(O).GetPrivilegeInfoById(V.SPEED_ADS)&&(e=IS(O).GetPrivilegeInfoById(V.SPEED_ADS).end_time),Math.max(0,e-m.serverTime)<=0?uiMgr.openView("SpeedUpView"):y.showFlyTip(GetLanguage(200448))})),this.nodeLevelUp=f.findChild(this.parentView.node,"subRoots/levelUp"),this.nodeGuildBtn=f.findChild(this.parentView.node,"subRoots/btnGuildAct"),this.addComponentCallbackListener(this.nodeGuildBtn,n.EventType.CLICK,(function(){e.onClickGuildAct()})),this.btnGM.active=!1,this.btnMarryMy=f.findChild(this.parentView.node,"subRoots/btnMarryMy"),this.btnMarryMyName=f.findChildComponent(this.parentView.node,"subRoots/btnMarryMy/name",o),this.addComponentCallbackListener(this.btnMarryMy,n.EventType.CLICK,(function(){uiMgr.openView("MarryMapSceneView")}))},v.registerUpdateHandler=function(){this.addEvent(z.ROLE_RES_UPDATE,this.onRoleResUpdate,this),this.addEvent(z.ROLE_MONET_UPDATE,this.updatePlayerMoney,this),this.addEvent(z.ROLE_INFO_UPDATE,this.onRoleInfoUpdate,this),this.addEvent(L.SET_GM_BTN_ACTIVE,this.onSetGMBtnActive,this),this.addEvent(z.ROLE_OPEN_FUNCTION_UPDATE,this.onRoleOpenFunctionUpdate,this),this.addEvent(z.ROLE_INFO_INIT,this.onRoleInfoInit,this),this.addEvent(z.ROLE_ATTR_POWER,this.onRoleInfoUpdate,this),this.addEvent(H.ROLE_PRIVILEGE_UPDATE,this.onGetADReward,this),this.addEvent(N.GUILD_ACT_INFO_UPDATE,this.checkGuildActBtn,this),this.addEvent(b.GAME_BACK_SHOW,this.checkSpeedUpCountDown,this),this.addEvent(z.ROLE_INFO_UPDATE,this.checkGuildActBtn2,this),this.addEvent(B.Frame_INFO_UPDATE,this.OnFrameInfoUpdate,this),this.addEvent(P.MailRedChange,this.UpdateMenuRed,this),this.addEvent(R.FriendRedChange,this.UpdateMenuRed,this),this.addEvent(g.AchievementRedUpdate,this.UpdateMenuRed,this),this.addEvent(I.ROULETTE_INFO_UPDATE,this.UpdateMenuRed,this),this.addEvent(W.SEVEN_LOGIN_INFO_UPDATE,this.UpdateMenuRed,this),this.addEvent(W.SEVEN_LOGIN_REWARDLIST_UPDATE,this.UpdateMenuRed,this),this.addEvent(z.ROLE_SKIN_LIST,this.UpdateMenuRed,this),this.addEvent(z.ROLE_SKIN_CHANGE,this.UpdateMenuRed,this),this.addEvent(B.Title_INFO_UPDATE,this.UpdateMenuRed,this),this.addEvent(B.Bubble_INFO_UPDATE,this.UpdateMenuRed,this),this.addEvent(C.GOODS_INFO_UPDATE,this.onGoodsUpdate,this),this.addEvent(z.ROLE_Menu_Red,this.UpdateMenuRed,this),this.addEvent(F.UpdateHeadRed,this.UpdateMenuRed,this),this.addEvent(J.SURVEY_INFO_UPDATE,this.UpdateMenuRed,this),this.addEvent(A.MARRY_PARTY_INFO,this.updateMarryMyShow,this)},v.onAfterOpen=function(){var e=this;this.UpdateMenuRed(),this.checkShowSpeedBtn(),this.updatePlayerInfo(!0),this.checkSpeedUpCountDown(),this.checkGuildActBtn(),this.updateMarryMyShow(),0==this.timer_speed&&(this.timer_speed=this.addTimer(1,-1,(function(){e.checkSpeedUpCountDown()}))),this.startDateTime()},v.GetDateStr=function(e){var t=e+"";return e<10&&(t="0"+e),t},v.startDateTime=function(){var e=this;this.stopDateTimer();var t=m.ServerDate(1e3*m.serverTime),i=t.getFullYear()+"/"+(t.getMonth()+1)+"/"+t.getDate(),n=this.GetDateStr(t.getHours())+":"+this.GetDateStr(t.getMinutes())+":"+this.GetDateStr(t.getSeconds())+m.GetServerTimeZoneStr();this.now_time.string=i+"\n"+n,0==this.timer_date&&(this.timer_date=this.addTimer(1,-1,(function(){var t=m.ServerDate(1e3*m.serverTime),i=t.getFullYear()+"/"+(t.getMonth()+1)+"/"+t.getDate(),n=e.GetDateStr(t.getHours())+":"+e.GetDateStr(t.getMinutes())+":"+e.GetDateStr(t.getSeconds())+m.GetServerTimeZoneStr();e.now_time.string=i+"\n"+n})))},v.stopDateTimer=function(){0!=this.timer_date&&(this.removeTimer(this.timer_date),this.timer_date=0)},v.UpdateMenuRed=function(){this.addRedPoint("menu_red",this.btnMenu,new l(24,24),c.Dot),IS(X).GetMenuRed()},v.checkGuildActBtn2=function(e){if(e[Y.ROLE_ATTR_GUILD_ID]){if(!IS(K).HasGuild())return void(this.nodeGuildBtn.active=!1);this.checkGuildActBtn()}},v.checkGuildActBtn=function(){if(IS(K).HasGuild()){var e=IS(G).act_list;for(var t in this.nodeGuildBtn.active=!1,e)e.hasOwnProperty(t)&&1==e[t]&&(this.nodeGuildBtn.active=!0)}else this.nodeGuildBtn.active=!1},v.onRoleOpenFunctionUpdate=function(e){e==q.FUNC_DOUBLE_SPEED&&this.checkShowSpeedBtn(),this.UpdateMenuRed()},v.checkShowSpeedBtn=function(){this.btnSpeed.active=IS(K).CheckFuncOpen(q.FUNC_DOUBLE_SPEED)},v.checkSpeedUpCountDown=function(){IS(O).checkPrivilegeUnlock(V.SPEED_ADS)?(this.nodeInTime.active=!0,this.nodeSpeedNormal.active=!1,IS(M).updateSpeedScale(2),this.updateTime()):(this.nodeInTime.active=!1,this.nodeSpeedNormal.active=!0,IS(M).updateSpeedScale(1),this.updateTime())},v.onGetADReward=function(e){var t=this;0!=this.timerID&&(this.removeTimer(this.timerID),this.timerID=0),this.checkShowSpeedBtn(),IS(O).checkPrivilegeUnlock(V.SPEED_ADS)?(this.nodeInTime.active=!0,this.nodeSpeedNormal.active=!1,IS(M).updateSpeedScale(2),this.timerID=this.addTimer(1,-1,(function(){t.updateTime()}))):(this.nodeInTime.active=!1,this.nodeSpeedNormal.active=!0,IS(M).updateSpeedScale(1))},v.updateTime=function(){var e=0;if(IS(O).checkPrivilegeUnlock(V.SPEED_ADS)&&(e=IS(O).GetPrivilegeInfoById(V.SPEED_ADS).end_time),null!=this.btnSpeedTxt){var t=Math.max(0,e-m.serverTime);if(t<=0)return battleMain.timeScale=1,this.nodeInTime.active=!1,this.nodeSpeedNormal.active=!0,this.removeTimer(this.timerID),void(this.timerID=0);this.btnSpeedTxt.string=m.formatTimeForSecond(t),this.imgSpeedTime.fillRange=Math.min(1,(1800-t)/1800)}},v.onRoleInfoInit=function(){this.checkShowSpeedBtn(),this.updatePlayerInfo(!0),this.UpdateMenuRed()},v.updatePlayerInfo=function(e){if(IS(K).checkHasInit()){if(e){var t=this.getPlayerLevelInfo();this.showPlayerLevel(t.level,t.name,t.head,t.rate,t.progressNum,t.nextLevelNeedNum),this.oriLevelInfo=t}else this.showLevelUpgradeEffect();this.updatePlayerMoney(),this.updatePowerInfo()}},v.updatePowerInfo=function(){var e=IS(K).GetPowerInfoByID(0);this.txtFightPower.string=p.GetNumString(e)},v.updateHeadFrame=function(){var e=IS(k).curFrameId;if(e>0){var t=configAvatar_frame.getDataByKey(e);this.loadIcon(this.imgHeadFrame,"icon_frame",t.icon),this.imgHeadFrame.node.active=!0}else this.imgHeadFrame.node.active=!1},v.getPlayerLevelInfo=function(){var e=IS(K).GetLevel(),t=IS(K).GetExp(),i=IS(K).GetRoleName(),n=IS(K).GetHeadUrl(),o=configLevel.getDataByKey(e),a=o.expend,s=e+1,d=configLevel.getDataByKey(s),r=!1;S.isEmpty(d)&&(r=!0),this.txtLevel.string=u.formatStr("<color=#ffffff><outline color=#544231 width=2><size=16>Lv </size><size=18>%s</size></outline></color>",e),this.txtName.string=""+i,this.loadRemoteIcon(n,this.imgHeadIcon),this.updateHeadFrame();var h=t-a,l=r?o.expend-configLevel.getDataByKey(e-1).expend:d.expend-a,c=r?1:h/l;return{level:e,name:i,head:n,rate:Math.min(1,c),progressNum:h,nextLevelNeedNum:l}},v.showLevelUpgradeEffect=function(){var e=this;if(!this.isUpgrading){var t=this.getPlayerLevelInfo();if(t.level!=this.oriLevelInfo.level||t.progressNum!=this.oriLevelInfo.progressNum){this.isUpgrading=!0,2==t.level&&IS(T).openGuide(50001);var i=t.level!=this.oriLevelInfo.level,n=this.oriLevelInfo.rate,o=t.rate;if(!i)return normalTween.to(n,o,1,(function(t,i){e.pbExperience.progress=i})).call((function(){e.pbExperience.progress=o,e.oriLevelInfo=t,e.isUpgrading=!1,e.showLevelUpgradeEffect()})).start(),void normalTween.to(this.oriLevelInfo.progressNum,t.progressNum,1,(function(t,i){e.txtExperience.string=u.formatStr("%s/%s",p.GetNumString(Math.floor(i)),p.GetNumString(e.oriLevelInfo.nextLevelNeedNum))})).call((function(){e.txtExperience.string=u.formatStr("%s/%s",p.GetNumString(t.progressNum),p.GetNumString(e.oriLevelInfo.nextLevelNeedNum))})).start();normalTween.to(n,1,1,(function(t,i){e.pbExperience.progress=i})).call((function(){e.txtLevel.string=u.formatStr("<color=#ffffff><outline color=#544231 width=2><size=16>Lv </size><size=18>%s</size></outline></color>",t.level),e.pbExperience.progress=1,e.showRoleLevelUp()})).start(),normalTween.to(this.oriLevelInfo.progressNum,this.oriLevelInfo.nextLevelNeedNum,1,(function(t,i){e.txtExperience.string=u.formatStr("%s/%s",p.GetNumString(Math.floor(i)),p.GetNumString(e.oriLevelInfo.nextLevelNeedNum))})).call((function(){e.txtExperience.string=u.formatStr("%s/%s",p.GetNumString(e.oriLevelInfo.nextLevelNeedNum),p.GetNumString(e.oriLevelInfo.nextLevelNeedNum))})).start(),this.addTimer(1,1,(function(){normalTween.to(0,o,1,(function(t,i){e.pbExperience.progress=i})).call((function(){e.pbExperience.progress=o,e.oriLevelInfo=t,e.isUpgrading=!1,e.showLevelUpgradeEffect()})).start(),normalTween.to(0,t.progressNum,1,(function(i,n){e.txtExperience.string=u.formatStr("%s/%s",p.GetNumString(Math.floor(n)),p.GetNumString(t.nextLevelNeedNum))})).call((function(){e.txtExperience.string=u.formatStr("%s/%s",p.GetNumString(t.progressNum),p.GetNumString(t.nextLevelNeedNum))})).start()}))}}},v.onClickGuildAct=function(){var e=IS(G).act_list,t=0;for(var i in e)if(e.hasOwnProperty(i)&&1==e[i]){t=Number(i);break}if(0==t)return this.nodeGuildBtn.active=!1,void y.showFlyTip(GetLanguage(200026));2==t?uiMgr.openView("ChatView",_.ViewType.Guild):1==t?IS(X).TryJumpToMainViewPanel(Z.Main_Guild):3==t&&(IS(K).CheckFuncOpen(q.FUNC_LEAGUE_GVE_CHAPTER,!0)?IS(U).reqGuildBossInfo():(this.nodeGuildBtn.active=!1,y.showFlyTip(GetLanguage(200026))))},v.showRoleLevelUp=function(){var e=this;this.addUIEffect("prefab/ui-effect/MX_tx_shengji",this.nodeLevelUp,2,null,1,(function(e){s.uiMirror&&(e.dir=-1)})),this.addTimer(1.5,1,(function(){e.addUIEffect("prefab/ui-effect/MX_tx_tongyong_jingyanguangxiao",e.nodeMask,2)}))},v.updateMarryMyShow=function(){var e=IS(w).GetMarryStateInfo();e&&2==e.stage&&1==e.invitationCard?(this.btnMarryMyName.string=1==IS(w).GetMarrySexType()?GetLanguage(204132):GetLanguage(204133),this.btnMarryMy.active=!0):this.btnMarryMy.active=!1},v.showPlayerLevel=function(e,t,i,n,o,a){this.txtLevel.string=u.formatStr("<color=#ffffff><outline color=#544231 width=2><size=16>Lv </size><size=18>%s</size></outline></color>",e),this.txtName.string=""+t,this.loadRemoteIcon(i,this.imgHeadIcon),this.txtExperience.string=u.formatStr("%s/%s",p.GetNumString(o),p.GetNumString(a)),this.pbExperience.progress=n},v.updatePlayerMoney=function(){this.txtCoinNum.string=p.GetNumString(IS(K).GetGOLD()),this.txtDiamondNum.string=String(IS(K).GetDiamond()),this.txtStarNum.string=String(IS(D).getGoodsCountByGoodsGtid(E.FakeRechare))},v.setGMActive=function(e){this.btnGM.active=e},v.onBeforeClose=function(){this.isUpgrading=!1,0!=this.timer_speed&&(this.removeTimer(this.timer_speed),this.timer_speed=0),this.stopDateTimer()},v.onDestroy=function(){},v.onRoleResUpdate=function(e){1==e&&s.now()-IS(M).lastKillRewardTime<2e3||this.updatePlayerMoney()},v.onRoleInfoUpdate=function(){this.updatePlayerInfo()},v.OnFrameInfoUpdate=function(){this.updateHeadFrame(),this.UpdateMenuRed()},v.onGoodsUpdate=function(e,t){1014==t&&this.UpdateMenuRed()},v.onSetGMBtnActive=function(e){this.setGMActive(e)},v.onMenuClick=function(){uiMgr.openView("MenuView")},v.onPlayerCoinClick=function(){IS(X).TryJumpToMainViewPanel(Z.Main_Shop,Z.Shop_Gem,[4])},v.onPlayerDiamondClick=function(){0!=IS(j).showrechage&&IS(X).TryJumpToMainViewPanel(Z.Main_Shop,Z.Shop_Cash,[0])},v.onGMClick=function(){1==IS(x).isWhiteIp&&netManager.send("system.system_open_gm_c2s",{})},i}(v));i._RF.pop()}}}));

