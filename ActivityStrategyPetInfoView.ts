System.register("chunks:///_virtual/ActivityStrategyPetInfoView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./NodeUtil.ts","./StringUtil.ts","./index57.ts","./ObjectUtil.ts","./EquipModel.ts","./ActivityDefine.ts","./ActivityStrategyControl.ts","./ActivityStrategyDataCache.ts","./BaseView.ts"],(function(t){"use strict";var e,i,n,o,a,s,r,d,c,h,l,f,p,v,m,u,C,g,I;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,n=t.math,o=t.Button,a=t.Sprite,s=t.Label,r=t.sys,d=t.Layout,c=t.js,h=t.UITransform,l=t.Node},function(t){f=t.default},function(t){p=t.default},null,function(t){v=t.default},function(t){m=t.EquipModel},function(t){u=t.ActivityEventDefine},function(t){C=t.default},function(t){g=t.default},function(t){I=t.BaseView}],execute:function(){i._RF.push({},"88721qw2gxMCKqDCYKf/C4m","ActivityStrategyPetInfoView",void 0);n.Vec3;var y=n.Vec2;t("default",function(t){function i(){var e;return(e=t.call(this)||this).imgFrame=void 0,e.imgIcon=void 0,e.txtName=void 0,e.txtLevel=void 0,e.txtTopName=void 0,e.txtQuality=void 0,e.txtAttackValue=void 0,e.txtAttackSpeedValue=void 0,e.txtSkillHaveDesc=void 0,e.txtSkillWearDesc=void 0,e.nodeTraceParent=void 0,e.nodeTraceItem=void 0,e.traceItems=void 0,e.oprate=void 0,e.btnWear=void 0,e.btnRemove=void 0,e.btnPrev=void 0,e.btnNext=void 0,e.nodeModelRoot=void 0,e.modelPet=void 0,e.petId=void 0,e.petCfg=void 0,e.petList=void 0,e.name="ActivityStrategyPetInfoView",e.url="ui/module/ActivityStrategy/ActivityStrategyPetInfoView",e}e(i,t);var n=i.prototype;return n.onInit=function(){var t=this,e=this.findChild("imgMask");if(this.addComponentCallbackListener(e,o.EventType.CLICK,(function(){t.onMaskClick()})),this.imgFrame=this.findChildComponent("content/top/imgFrame",a),this.imgIcon=this.findChildComponent("content/top/imgIcon",a),this.txtName=this.findChildComponent("content/top/nameInfo/txtName",s),this.txtLevel=this.findChildComponent("content/top/level/txtLevel",s),this.txtTopName=this.findChildComponent("content/bgName/txtName",s),this.txtQuality=this.findChildComponent("content/top/txtQuality",s),this.txtAttackValue=this.findChildComponent("content/attr/attrItemAttack/txtValue",s),this.txtAttackSpeedValue=this.findChildComponent("content/attr/attrItemAttackSpeed/txtValue",s),this.txtSkillHaveDesc=this.findChildComponent("content/attr/attrHave/txtDesc",s),this.txtSkillWearDesc=this.findChildComponent("content/attr/txtDesc",s),this.nodeTraceParent=this.findChild("content/top/nameInfo/traceParent"),this.nodeTraceItem=this.findChild("content/top/nameInfo/traceParent/trace"),this.nodeTraceItem.active=!1,this.traceItems=new Array,this.oprate=this.findChild("content/oprate"),this.btnWear=this.findChild("content/oprate/btnWear"),this.addComponentCallbackListener(this.btnWear,o.EventType.CLICK,(function(){t.onWearClick()})),this.btnRemove=this.findChild("content/oprate/btnRemove"),this.addComponentCallbackListener(this.btnRemove,o.EventType.CLICK,(function(){t.onRemoveClick()})),this.btnPrev=this.findChild("content/btnPrev"),this.addComponentCallbackListener(this.btnPrev,o.EventType.CLICK,(function(){t.onPrevClick()})),this.btnNext=this.findChild("content/btnNext"),this.addComponentCallbackListener(this.btnNext,o.EventType.CLICK,(function(){t.onNextClick()})),this.nodeModelRoot=this.findChild("content/modelRoot"),r.uiMirror){var i=this.findChildComponent("content/top/nameInfo",d);i.horizontalDirection=1,i.node.setScale(-1,1,1),this.nodeTraceParent.getComponent(d).horizontalDirection=1,this.txtName.node.setScale(1,1,1)}},n.registerUpdateHandler=function(){this.addEvent(u.OnStrategyPetUpdate,this.onPetInfoUpdate,this)},n.onAfterOpen=function(){this.petList=IS(g).getSortAllPetList(!0),this.petId=this.openArgs[0],this.showPetInfo();var t=this.petList.indexOf(this.petId);this.btnPrev.active=t>0,this.btnNext.active=t<this.petList.length-1},n.showPetInfo=function(){this.petCfg=configPet.getDataByKey(this.petId);var t=this.petList.indexOf(this.petId);this.btnPrev.active=t>0,this.btnNext.active=t<this.petList.length-1,this.showBaseInfo(),this.updatePetInfo()},n.showBaseInfo=function(){var t=this;this.loadIcon(this.imgFrame,"icon_pet",configColor.getDataByKey(this.petCfg.quality).path),this.loadIcon(this.imgIcon,"icon_pet",this.petCfg.icon),this.txtName.string=this.petCfg.name,this.txtTopName.string=this.petCfg.name;var e=IS(m).getEquipQualityNameAndColor(this.petCfg.quality);this.txtQuality.string=e.nameStr,this.txtQuality.color=e.nameColor;for(var i=0;i<this.traceItems.length;i++)this.traceItems[i].node.active=!1;for(var n=this.petCfg.type||[],o=function(e){var i=t.traceItems[e];v.isEmpty(i)&&((i={}).node=nodeInstantiate.instantiate(t.nodeTraceItem),i.node.parent=t.nodeTraceParent,i.txtTrace=f.findChildComponent(i.node,"txtTrace",s),i.ut=i.node.getComponent(h),i.utTxt=i.txtTrace.node.getComponent(h),i.imgTraceBg=i.node.getComponent(a),t.addComponentCallbackListener(i.utTxt.node,l.EventType.SIZE_CHANGED,(function(){i.ut.width=28+i.utTxt.width,i.imgTraceBg.updateRenderer()}))),i.node.active=!0;var o=configPetrace.getDataByKey(n[e]),r=null==o?void 0:o.name;i.txtTrace.string=r,t.traceItems[e]=i},r=0;r<n.length;r++)o(r);this.updatePetModelShow()},n.updatePetModelShow=function(){null!=this.modelPet&&(this.removeUIEffect(this.modelPet),this.modelPet=null);var t=configUnitModel.getDataByKey(this.petCfg.unitId);this.modelPet=this.addUIEffect(t.path,this.nodeModelRoot,-1,new y(0,-60),t.scale/100*2.25,(function(t){t.dir=r.uiMirror?-1:1}))},n.updatePetInfo=function(){var t=IS(g).getPetInfoByPetId(this.petId),e=t.level;this.txtLevel.string=c.formatStr("Lv.%s",e);var i=configPetlevel.getDataByKeys("id",this.petId,"level",e),n=IS(g).getPetFactAttrValue(i.partner_dam,this.petId,1040),o=IS(g).getPetFactAttrValue(i.att_speed,this.petId,1003);this.txtAttackValue.string=String(Math.floor(n)/1e4),this.txtAttackSpeedValue.string=String(Math.floor(o/100)/100),this.txtSkillHaveDesc.string=p.formatStr(i.desc,i.desc_parm);var a=i.equipEffect[0],s=configSkill_level.getDataByKeys("id",a[0],"level",a[1]);this.txtSkillWearDesc.string=p.formatStrWithMirrorDeal(GetLanguage(200098),p.formatStr.apply(p,[s.desc].concat(s.desc_parm))),this.btnWear.active=0==t.pos,this.btnRemove.active=0!=t.pos},n.onBeforeClose=function(){for(var t=0;t<this.traceItems.length;t++)this.traceItems[t].node.active=!1},n.onDestroy=function(){for(var t=0;t<this.traceItems.length;t++)this.traceItems[t].node.destroy();this.traceItems=[]},n.onPetInfoUpdate=function(t){t==this.petId&&this.updatePetInfo()},n.onWearClick=function(){var t=IS(g).getPetEmptyPos();if(null!=t)return IS(C).reqActStrategyTabPet([{k:t,v:this.petId}]),void this.close();normalEvent.emit(u.OnStrategyPetSelectWear,this.petId),this.close()},n.onRemoveClick=function(){var t=IS(g).getPetInfoByPetId(this.petId);IS(C).reqActStrategyTabPet([{k:t.pos,v:0}])},n.onMaskClick=function(){this.close()},n.onPrevClick=function(){var t=this.petList.indexOf(this.petId);t<=0||(this.petId=this.petList[t-1],this.showPetInfo())},n.onNextClick=function(){var t=this.petList.indexOf(this.petId);t>=this.petList.length-1||(this.petId=this.petList[t+1],this.showPetInfo())},i}(I));i._RF.pop()}}}));

