System.register("chunks:///_virtual/ActivityHalloweenGameMainView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./ObjectUtil.ts","./BagModel.ts","./MessageView.ts","./ActivityControl.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./ActivityHalloweenDataCache.ts","./BaseView.ts"],(function(t){"use strict";var e,i,n,a,s,r,o,h,d,c,l,u,f,p,m,v,C,g,I,w,k,y,S,T,L;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,n=t.Label,a=t.Button,s=t.ScrollView,r=t.Vec2,o=t.js,h=t.Sprite},function(t){d=t.ItemGrid},function(t){c=t.SelectedType,l=t.ListItem},function(t){u=t.default},function(t){f=t.default},function(t){p=t.default},null,function(t){m=t.default},function(t){v=t.BagModel},function(t){C=t.default},function(t){g=t.default},function(t){I=t.default},function(t){w=t.ActivityEventDefine,k=t.ActivityType,y=t.ActivityState,S=t.ActivityTaskState},function(t){T=t.default},function(t){L=t.BaseView}],execute:function(){i._RF.push({},"2c7342LbvlA+JhIwnhC4L+e","ActivityHalloweenGameMainView",void 0);t("default",function(t){function i(){var e;return(e=t.call(this)||this).txtLeftTime=void 0,e.taskItems=[],e.scrollChapter=void 0,e.curChapter=void 0,e.time=0,e.endTime=0,e.roundCfg=void 0,e.startTime=0,e.nodeModelRoot=void 0,e.txtTitle=void 0,e.name="ActivityHalloweenGameMainView",e.url="ui/module/halloween/ActivityHalloweenGameMainView",e.fullScreen=!0,e}e(i,t);var h=i.prototype;return h.onInit=function(){var t=this;this.txtTitle=this.findChildComponent("title/txtTitle",n),this.txtLeftTime=this.findChildComponent("view/nodeTime/txtTime",n);var e=this.findChild("view/btnClose");this.addComponentCallbackListener(e,a.EventType.CLICK,(function(){t.close()}));var i=this.findChild("view/btnStart");this.addComponentCallbackListener(i,a.EventType.CLICK,(function(){t.onStartClick()})),this.taskItems=[];for(var r=function(e){var i=t.findChild(o.formatStr("view/task/task%s",e)),s=u.findChild(i,"btnFetch");t.addComponentCallbackListener(s,a.EventType.CLICK,(function(){t.onFetchClick(e)}));var r=u.findChild(i,"rewardContent/item");r.active=!1,t.taskItems.push({node:i,index:e,btnFetch:s,nodeHasFetch:u.findChild(i,"hasFetch"),nodeCantFetch:u.findChild(i,"txtCantFetch"),txtDesc:u.findChildComponent(i,"txtDesc",n),nodeRewardItem:r,nodeRewardContent:u.findChild(i,"rewardContent")})},h=1;h<=3;h++)r(h);var d=this.findChildComponent("view/ScrollView",s);this.scrollChapter=this.addUIList(d,_),this.scrollChapter.selectedMode=c.SINGLE,this.nodeModelRoot=this.findChild("view/model/imgGGBond")},h.registerUpdateHandler=function(){this.addEvent(w.OnActivityInfoUpdate,this.updateInfo,this),this.addEvent(w.OnActivityInfoTaskUpdate,this.updateContent,this),this.addEvent(w.OnHolloweenChapterBack,this.OnHolloweenChapterBack,this)},h.onAfterOpen=function(){IS(g).send_24_72(),this.addUIEffect("prefab/ui-effect/MX_boss_wuwudayao",this.nodeModelRoot,-1,new r(0,-90),.3);var t=IS(I).GetActivityInfo(k.HalloweenGame);if(null!=t&&t.state==y.Open){this.roundCfg=IS(I).GetRoundCfg(k.HalloweenGame,t.round),this.txtTitle.string=this.roundCfg.name;var e=t.state_time[y.Open];this.endTime=e.end_time,this.startTime=e.start_time,this.curChapter=this.getDefaultSelectChapter();var i=configGgbond_chapter.getDatas();this.scrollChapter.datas=i;for(var n=0,a=0;a<i.length;a++)if(i[a].chapter_id==this.curChapter){n=a;break}this.scrollChapter.scrollTo(n),this.updateContent(),this.updateLeftTime()}else this.close()},h.updateContent=function(){for(var t=this.getTaskListByChapter(this.curChapter),e=0;e<this.taskItems.length;e++)this.updateSingleTask(this.taskItems[e],t[e]);this.updateChapterRed()},h.updateSingleTask=function(t,e){var i=configActivity_task.getDataByKey(e);t.txtDesc.string=i.desc;var n=this.getTaskState(e);t.btnFetch.active=n==S.CanGet,t.nodeHasFetch.active=n==S.HadGet,t.nodeCantFetch.active=n==S.Normal,null==t.rewardList&&(t.rewardList=[]);for(var a=i.reward||[],s=0;s<a.length;s++){var r=t.rewardList[s]||this.newRewardItem(t);r.itemId=a[s][0],r.itemGrid.SetItemId(a[s][0],a[s][1]),r.node.active=!0,t.rewardList[s]=r}for(var o=a.length;o<t.rewardList.length;o++)t.rewardList[o].node.active=!1},h.newRewardItem=function(t){var e=nodeInstantiate.instantiate(t.nodeRewardItem);e.parent=t.nodeRewardContent;var i=u.findChild(e,"itemGrid"),n={node:e,itemGrid:new d(this,i,(function(){IS(v).OpenItemTips(n.itemId,i)})),itemId:0};return n},h.getDefaultSelectChapter=function(){var t=this,e=m.clone(IS(T).ggBondChaperIdList);return e.length<=0?1:(e.sort((function(e,i){var n=t.checkChapterHasTaskState(e,S.CanGet);return n!=t.checkChapterHasTaskState(i,S.CanGet)||t.checkChapterHasTaskState(e,S.Normal)!=t.checkChapterHasTaskState(i,S.Normal)?n?-1:1:i-e})),e[0])},h.getTaskListByChapter=function(t){var e=this.roundCfg.task_list[t-1];return configActivity_task_group.getDataByKey(e).task_list},h.getTaskState=function(t){var e=IS(I).GetActivityInfo(k.HalloweenGame).task_list[t];return null==e?S.Normal:e.state},h.checkChapterHasTaskState=function(t,e){for(var i=this.getTaskListByChapter(t),n=0;n<i.length;n++)if(this.getTaskState(i[n])==e)return!0;return!1},h.onBeforeClose=function(){this.time=0,this.endTime=0,this.startTime=0;for(var t=0;t<this.taskItems.length;t++){var e=this.taskItems[t].rewardList;if(null!=e)for(var i=0;i<e.length;i++)e[i].node.active=!1}},h.onUpdate=function(t){this.time=this.time+t,this.time>=1&&(this.time=0,this.updateLeftTime())},h.updateLeftTime=function(){this.txtLeftTime.string=p.formatTimeStringForSecond(Math.max(0,this.endTime-p.serverTime))},h.onDestroy=function(){for(var t=0;t<this.taskItems.length;t++){var e=this.taskItems[t].rewardList;if(null!=e){for(var i=0;i<e.length;i++)e[i].node.destroy(),delete e[i];this.taskItems[t].rewardList=null}}},h.updateInfo=function(t){t.type!=k.HalloweenGame||t.state==y.Open?this.updateContent():this.close()},h.OnHolloweenChapterBack=function(){this.scrollChapter.updateAll()},h.updateSelect=function(){this.scrollChapter.items.forEach((function(t,e,i){t.updateSelect()}))},h.updateChapterRed=function(){this.scrollChapter.items.forEach((function(t,e,i){t.updateRed()}))},h.onStartClick=function(){if(IS(T).checkChapterUnlock(this.curChapter))uiMgr.openView("ActivityHalloweenGamePlayView",this.curChapter);else{var t=configGgbond_chapter.getDataByKey(this.curChapter).open_day;this.getActivityOpenDay()<t?C.showFlyTip(f.formatStrWithMirrorDeal(GetLanguage(201212),t)):C.showFlyTip(GetLanguage(201214))}},h.onFetchClick=function(t){var e=this.getTaskListByChapter(this.curChapter)[t-1];if(this.getTaskState(e)==S.CanGet){var i=this.roundCfg.task_list[this.curChapter-1];IS(g).send_24_15(k.HalloweenGame,e,i)}},h.getActivityOpenDay=function(){var t=p.ServerDate(1e3*this.startTime),e=o.formatStr("%s/%s/%s %s:%s:%s",t.getFullYear(),t.getMonth()+1,t.getDate(),0,0,0),i=p.getServerDateByLocalStr(e).getTime()/1e3,n=p.serverTime-i;return Math.floor(n/86400+1)},i}(L));var _=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),a=0;a<i;a++)n[a]=arguments[a];return(e=t.call.apply(t,[this].concat(n))||this).chapterId=void 0,e.cfg=void 0,e.imgIndex=void 0,e.imgIndex1=void 0,e.imgBg=void 0,e.nodeSelect=void 0,e.nodeRed=void 0,e}e(i,t);var n=i.prototype;return n.onInit=function(){this.imgIndex=u.findChildComponent(this.node,"num/imgNum",h),this.imgIndex1=u.findChildComponent(this.node,"num/imgNum1",h),this.imgBg=u.findChildComponent(this.node,"imgBg",h),this.nodeSelect=u.findChild(this.node,"imgSelect"),this.nodeRed=u.findChild(this.node,"RedPoint")},n.onRender=function(t,e){if(this.cfg=t,this.chapterId=t.chapter_id,this.chapterId<=9)this.imgIndex1.node.active=!1,this.view.loadIcon(this.imgIndex,"halloween_game",o.formatStr("wsj_ui_num0%s",this.chapterId));else{this.imgIndex1.node.active=!0;var i=Math.floor(this.chapterId/10),n=this.chapterId-10*i;this.view.loadIcon(this.imgIndex,"halloween_game",o.formatStr("wsj_ui_num0%s",i)),this.view.loadIcon(this.imgIndex1,"halloween_game",o.formatStr("wsj_ui_num0%s",n))}this.imgBg.grayscale=!IS(T).checkChapterUnlock(this.chapterId),this.imgIndex.grayscale=!IS(T).checkChapterUnlock(this.chapterId),this.imgIndex1.grayscale=!IS(T).checkChapterUnlock(this.chapterId),this.updateSelect(),this.updateRed()},n.updateSelect=function(){var t=this.view;this.nodeSelect.active=t.curChapter==this.chapterId},n.updateRed=function(){for(var t=this.view,e=t.getTaskListByChapter(this.chapterId),i=!1,n=0;n<e.length;n++)if(t.getTaskState(e[n])==S.CanGet){i=!0;break}this.nodeRed.active=i},n.onItemClick=function(){var t=this.view;if(IS(T).checkChapterUnlock(this.chapterId))t.curChapter!=this.chapterId&&(t.curChapter=this.chapterId,t.updateContent(),t.updateSelect());else{var e=this.cfg.open_day;t.getActivityOpenDay()<e?C.showFlyTip(f.formatStrWithMirrorDeal(GetLanguage(201212),e)):C.showFlyTip(GetLanguage(201214))}},i}(l);i._RF.pop()}}}));

