System.register("chunks:///_virtual/UIShipModel.ts",["./rollupPluginModLoBabelHelpers.js","cc","./V2.ts","./AssetPool.ts","./BaseAsset.ts","./NodeUtil.ts","./SlotEquip.ts","./SpineSkeleton.ts","./UIEffectAsset.ts"],(function(i){"use strict";var t,n,e,s,o,a,l,h,r,u,d,p,c;return{setters:[function(i){t=i.inheritsLoose,n=i.createForOfIteratorHelperLoose},function(i){e=i.cclegacy,s=i.isValid,o=i.Layers},function(i){a=i.V2},function(i){l=i.AssetPoolState},function(i){h=i.BaseAsset},function(i){r=i.default},function(i){u=i.SlotEquip},function(i){d=i.SpineSkeleton,p=i.AnimationType},function(i){c=i.UIEffectAsset}],execute:function(){e._RF.push({},"16047Fhs8lGfa8BpAUrDDKU","UIShipModel",void 0);var f=new a;i("UIShipModel",function(i){function e(){var t;return(t=i.call(this)||this).id=0,t._animator=void 0,t.config=void 0,t._skin={flag:0,ram:0,gunId:0},t.skinChange=!1,t._model=void 0,t._slotEquip=void 0,t._skinAssets=[],t._qi=void 0,t.isUI=!0,t}t(e,i),e.alloc=function(i,t){var n=configSeason_ship_appearance.getDataByKey(i);if(!n)throw Error(i+"->船形象不存在！");var e=configUnitModel.getDataByKey(n.model_ID),s=uiShipModelPool.alloc(e.path,e.maxNum,e.maxTime);return s.parent=t,s.layer=o.Enum.UI_2D,s.config=n,s.visible=!0,s.loadSync(),s},e.free=function(i){i.free()};var a=e.prototype;return a.onLoadComplete=function(){var i=this._node;this._model=r.findChild(i,"model");var t=this._model.getComponent(d);null==t&&(t=r.findChildComponent(this._model,"spine",d)),this._qi=r.findChild(this._model,"qi"),this._animator=t,t.__preload(),t.animationType=p.UI},a.onUpdate=function(t){if(i.prototype.onUpdate.call(this,t),!(this.poolState>l.Useing)){var e=this._animator;if(s(e)&&e._skeleton&&this.skinChange){var o,a=null!=(o=this._slotEquip)?o:this.node.getComponent(u);a.init(e,0),a.loadEquip([this._skin.ram],this.layer),this._slotEquip=a;for(var h,r=this._skinAssets,d=n(r);!(h=d()).done;){var p=h.value;null==p||p.free()}r.length=0,r.push(this.addGun(this._skin.gunId,this._qi,0)),r.push(this.addGun(this._skin.gunId,this._qi,1)),r.push(this.addQi(this._skin.flag,this._qi)),r.push(this.addGun(this._skin.gunId,this._qi,2)),r.push(this.addGun(this._skin.gunId,this._qi,3));for(var c=0;c<r.length;c++)r[c]&&(r[c].depth=c);this.skinChange=!1}}},a.addQi=function(i,t){var n=configSeason_ship_appearance.getDataByKey(i);if(n){var e=this.config.sail_plot,s=configUnitModel.getDataByKey(n.model_ID),o=c.alloc(s.path,t,s.maxTime,null,s.maxNum);return f.x=e[0],f.y=e[1],o.position=f,o}printLogErr("船旗帜未配置形象:",i)},a.addGun=function(i,t,n){var e=configSeason_ship_appearance.getDataByKey(i);if(e){var s=this.config.cannon_plot[n],o=configUnitModel.getDataByKey(e.model_ID),a=c.alloc(o.path,t,o.maxTime,null,o.maxNum);return f.x=s[0],f.y=s[1],a.position=f,a.aniName=n<2?"idle_up":"idle",a}printLogErr("船炮未配置形象:",i)},a.onApply=function(i){},a.cacheReset=function(){var t;(i.prototype.cacheReset.call(this),this._skin.flag=0,this._skin.gunId=0,this._skin.ram=0,s(this.node))&&(null==(t=this._slotEquip)||t.unload())},a.setSkin=function(i,t,n){this._skin.flag==i&&this._skin.ram==t&&this._skin.gunId==n||(this._skin.flag=i,this._skin.ram=t,this._skin.gunId=n,this.skinChange=!0)},e}(h));e._RF.pop()}}}));

