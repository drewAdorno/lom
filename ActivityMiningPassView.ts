System.register("chunks:///_virtual/ActivityMiningPassView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./RedPointMgr.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./BagModel.ts","./BattlePassControl.ts","./BattlePassDataCache.ts","./BattlePassDefine.ts","./MessageView.ts","./PayDataCache.ts","./PayDefine.ts","./ActivityControl.ts","./BaseView.ts"],(function(t){"use strict";var e,i,n,s,a,o,d,r,c,h,l,u,I,f,m,v,g,C,P,w,p,S,x,y,_;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,n=t.ScrollView,s=t.Label,a=t.Button,o=t.js,d=t.UITransform,r=t.Sprite,c=t.ProgressBar},function(t){h=t.ItemGrid},function(t){l=t.SelectedType,u=t.ListItem},function(t){I=t.RedPointMgr},function(t){f=t.default},function(t){m=t.default},function(t){v=t.default},null,function(t){g=t.BagModel},function(t){C=t.default},function(t){P=t.BattlePassDataCache},function(t){w=t.BattlePassDefine},function(t){p=t.default},function(t){S=t.default},function(t){x=t.PayEventDefine},function(t){y=t.default},function(t){_=t.BaseView}],execute:function(){i._RF.push({},"80de0hiGtRAeoOSifCtEBYF","ActivityMiningPassView",void 0);t("default",function(t){function i(){var e;return(e=t.call(this)||this).scrollItemList=void 0,e.scrollItem=void 0,e.cost=void 0,e.curPassId=0,e.name="ActivityMiningPassView",e.url="ui/module/mining/ActivityMiningPassView",e.poolTime=3e3,e.fullScreen=!0,e}e(i,t);var o=i.prototype;return o.onInit=function(){var t=this;this.scrollItem=this.findChildComponent("root/ScrollView",n),this.scrollItemList=this.addUIList(this.scrollItem,b),this.scrollItemList.selectedMode=l.SINGLE,this.cost=this.findChildComponent("root/ScrollView/imgColumnPay/qipao/cost",s);var e=this.findChild("root/nodeBottom/btnClose");this.addComponentCallbackListener(e,a.EventType.CLICK,(function(){t.onCloseClick()}));var i=this.findChild("root/nodeBottom/nodeBuy/btnBuy");this.addComponentCallbackListener(i,a.EventType.CLICK,(function(){t.onBuyClick()}));var o=this.findChild("root/nodeBottom/btnGuild");this.addComponentCallbackListener(o,a.EventType.CLICK,(function(){uiMgr.openView("ActivityMiningGuideView")}));var d=this.findChild("root/ScrollView/imgColumnPay");this.addComponentCallbackListener(d,a.EventType.CLICK,(function(){IS(P).getPassInfo(t.curPassId).if_buy||t.onBuyClick()}));var r=this.findChild("root/nodeBottom/btnGame");this.addComponentCallbackListener(r,a.EventType.CLICK,(function(){t.onCloseClick()}))},o.onAfterOpen=function(){this.curPassId=this.openArgs[0],this.onUpdateNormalView(),this.updateRewardList(),this.startUpdateTime(),C.checkRewardRP(this.curPassId)>=0?this.scrollItemList.scrollTo(C.checkRewardRP(this.curPassId)):this.scrollItemList.scrollTo(C.checkRewardRoll(this.curPassId));var t=configPay_mall.getDataByKey(IS(P).getPassInfo(this.curPassId).bundle_id).cost_level;this.cost.string=IS(S).GetPriceString(t)},o.updateScrollInfo=function(){this.updateRewardList(),this.onUpdateNormalView()},o.startUpdateTime=function(){var t=this;this.addTimer(1,-1,(function(){t.updateTime()}))},o.updateRewardList=function(){var t=Array.from({length:IS(P).getPassInfo(this.curPassId).max_lev},(function(t,e){return e+1}));t.shift(),this.scrollItemList.datas=t},o.registerUpdateHandler=function(){this.addEvent(w.BATTLE_PASS_INFO_UPDATE,this.onUpdateNormalView,this),this.addEvent(x.PAY_RECHARGE_SUCCESS,this.updateScrollInfo,this),this.addEvent(w.BATTLE_PASS_TAKE_REWARD,this.updateRewardList,this)},o.onUpdateNormalView=function(){IS(P).getPassInfo(this.curPassId);this.updateTime(),this.findChildComponent("root/nodeBottom/nodeBuy/btnBuy/txtPrice",s).string=IS(S).GetPriceString(configPay_mall.getDataByKey(IS(P).getPassInfo(this.curPassId).bundle_id).cost_level),this.scrollItemList.updateAll()},o.updateTime=function(){var t=IS(P).getPassInfo(this.curPassId).end_time-v.serverTime,e="--:--:--",i=Math.floor(t/3600)%24,n=Math.floor(t/86400);e=n>0?GetLanguage(200136)+m.formatStrWithMirrorDeal(GetLanguage(200006),n,i):GetLanguage(200136)+v.formatTimeForSecond(t),this.findChildComponent("root/nodeBanner/txtRestTime",s).string=e},o.onCloseClick=function(){this.close()},o.onBuyClick=function(){IS(S).Pay(IS(P).getPassInfo(this.curPassId).bundle_id)},o.onBeforeClose=function(){},o.onDestroy=function(){},i}(_));var b=t("BPItem",function(t){function i(){for(var e,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))||this).FINAL_INDEX=0,e.itemIndex=void 0,e.btnLock=void 0,e}e(i,t);var n=i.prototype;return n.onInit=function(){var t=this;this.adaptiveSize=!0,this.btnLock=f.findChildComponent(this.node,"boxStateOne/imgColumnPay/nodeLock",a),this.view.addComponentCallbackListener(this.btnLock.node,a.EventType.CLICK,(function(){t.onBuyClick()}))},n.onRender=function(t,e){var i=this;this.FINAL_INDEX=IS(P).getPassInfo(this.view.curPassId).max_lev,this.itemIndex=t,this.itemIndex>this.FINAL_INDEX&&(this.itemIndex=this.FINAL_INDEX),this.data=configWartoken_reward.getDataByKeys("id",this.view.curPassId,"level",this.itemIndex);for(var n=function(t){var e=f.findChild(i.node,"boxStateOne/imgColumnPay/nodeItem"+t);if(1==i.data.high_reward.length&&1==t)return e.active=!1,"break";e.active=!0,new h(i.view,e,(function(){1==IS(P).getPassInfo(i.view.curPassId).high_reward[i.itemIndex-1].status?(IS(C).send_40_5(i.view.curPassId,i.itemIndex,2),IS(y).send_24_126()):IS(g).OpenItemTips(i.data.high_reward[t][0],e)})).SetItemId(i.data.high_reward[t][0],i.data.high_reward[t][1])},a=0;a<2;a++){if("break"===n(a))break}var d=f.findChild(this.node,"boxStateOne/imgColumnFree/nodeItem");new h(this.view,d,(function(){1==IS(P).getPassInfo(i.view.curPassId).free_reward[i.itemIndex-1].status?(IS(C).send_40_5(i.view.curPassId,i.itemIndex,1),IS(y).send_24_126()):IS(g).OpenItemTips(i.data.reward[0][0],d)})).SetItemId(this.data.reward[0][0],this.data.reward[0][1]);var r=f.findChildComponent(this.node,"boxStateOne/imgColumnFree/txtNeed",s),c=(this.itemIndex-1)%5;0==c&&(c=5),r.string=o.formatStr("%s-%s",Math.floor((this.itemIndex-2)/5+1),c),this.checkItemState()},n.checkBoxState=function(){var t=Boolean(this.itemIndex==this.FINAL_INDEX+1);return f.findChild(this.node,"boxStateTwo").active=t,f.findChild(this.node,"boxStateOne").active=!t,IS(P).getPassInfo(this.view.curPassId).if_buy?this.node.getComponent(d).height=t?170:112:this.node.getComponent(d).height=t?300:112,this.refreshStateTwoShow(),t},n.refreshStateTwoShow=function(){var t=this,e=IS(P).getPassInfo(this.view.curPassId);if(1==this.view.curPassId?configBattlepass.getDataByKey(this.view.curPassId).view:configWartoken.getDataByKey(this.view.curPassId).view,f.findChildComponent(this.node,"boxStateTwo/imgExtBG/Label",s).string="达到"+e.max_lev+"阶后，每获得"+e.extra_need_exp+"通行证经验值，\n都可以领取最多"+e.extra_max_times+"次大型召唤箱",f.findChildComponent(this.node,"boxStateTwo/txtExtCount",s).string="("+e.extra_times+"/"+e.extra_max_times+")",!(e.lev<this.FINAL_INDEX)){var i=f.findChild(this.node,"boxStateTwo/imgBox");f.findComponent(i,r).grayscale=e.exp<e.extra_need_exp,this.view.addComponentCallbackListener(i,a.EventType.CLICK,(function(){t.onGetExtReward()}))}},n.checkItemState=function(){var t=f.findChild(this.node,"boxStateOne/imgColumnPay/nodeItem0/nodeCanGet"),e=f.findChild(this.node,"boxStateOne/imgColumnPay/nodeItem0/nodeGotIt"),i=f.findChild(this.node,"boxStateOne/imgColumnPay/nodeItem1/nodeCanGet"),n=f.findChild(this.node,"boxStateOne/imgColumnPay/nodeItem1/nodeGotIt"),s=f.findChild(this.node,"boxStateOne/imgColumnFree/imgCanGet"),a=f.findChild(this.node,"boxStateOne/imgColumnFree/imgGotIt"),o=IS(P).getPassInfo(this.view.curPassId);if(e.active=!1,t.active=!1,n.active=!1,i.active=!1,o.if_buy)switch(f.findChild(this.node,"boxStateOne/imgColumnPay/nodeLock").active=!1,o.high_reward[this.itemIndex-1].status){case 0:break;case 1:t.active=!0,i.active=!0,IS(I).changeValue("MiningPassView/Reward",2);break;case 2:e.active=!0,n.active=!0}else f.findChild(this.node,"boxStateOne/imgColumnPay/nodeLock").active=!0;switch(a.active=!1,s.active=!1,o.free_reward[this.itemIndex-1].status){case 0:break;case 1:s.active=!0,IS(I).changeValue("MiningPassView/Reward",1);break;case 2:a.active=!0}},n.refreshProgress=function(){var t=f.findChildComponent(this.node,"boxStateOne/pbExp",c),e=IS(P).getPassInfo(this.view.curPassId);e.lev==this.itemIndex-1?t.progress=e.exp/e.need_exp-.3:e.lev==this.itemIndex?t.progress=.7+e.exp/e.need_exp:e.lev>this.itemIndex?t.progress=1:t.progress=0},n.onBuyClick=function(){IS(S).Pay(IS(P).getPassInfo(this.view.curPassId).bundle_id)},n.onGetExtReward=function(){var t=IS(P).getPassInfo(this.view.curPassId);t.extra_times>=t.extra_max_times?p.showFlyTip(GetLanguage(200030)):t.lev>=t.max_lev&&t.exp>=t.extra_need_exp?t.if_buy?1==this.view.curPassId?IS(C).reqBattlePassExtReward():IS(C).send_40_6(this.view.curPassId):1==this.view.curPassId?configBattlepass.getDataByKey(this.view.curPassId).view:configWartoken.getDataByKey(this.view.curPassId).view:p.showFlyTip(GetLanguage(200032))},i}(u));i._RF.pop()}}}));

