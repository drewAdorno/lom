System.register("chunks:///_virtual/ReturnGiftView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./BagModel.ts","./PayControl.ts","./PayDataCache.ts","./PayDefine.ts","./ReturnDataCache.ts","./BaseSubView.ts"],(function(t){"use strict";var i,e,n,o,r,a,d,s,c,h,f,m,u,g,l,_,v,I;return{setters:[function(t){i=t.inheritsLoose},function(t){e=t.cclegacy,n=t.Label,o=t.ScrollView,r=t.sys,a=t.Sprite,d=t.Button,s=t.js},function(t){c=t.ListItem},function(t){h=t.default},function(t){f=t.default},function(t){m=t.default},null,function(t){u=t.BagModel},function(t){g=t.default},function(t){l=t.default},function(t){_=t.PayEventDefine},function(t){v=t.ReturnDataCache},function(t){I=t.BaseSubView}],execute:function(){e._RF.push({},"01853/1C3pNWpGIGrrIEVN9","ReturnGiftView",void 0);t("default",function(t){function e(){var i;return(i=t.call(this)||this).taskList=void 0,i.txtLeftTime=void 0,i.timer=void 0,i.name="ReturnGiftView",i.url="ui/module/return/ReturnGiftView",i.poolTime=3e3,i}i(e,t);var a=e.prototype;return a.onInit=function(){this.txtLeftTime=this.findChildComponent("root/banner/time",n),this.taskList=this.addUIList(this.findChildComponent("root/taskList",o),p)},a.onAfterOpen=function(){this.UpdateTime(),this.updateInfo()},a.registerUpdateHandler=function(){this.addEvent(_.PAY_INFO_UPDATE,this.updateInfo,this)},a.UpdateTime=function(){var t=this;this.timer&&(this.removeTimer(this.timer),this.timer=null);var i=IS(v).GetReturnInfo();if(i&&i.end_time-m.serverTime>0){var e=f.formatStrWithMirrorDeal(GetLanguage(200043),m.formatTimeStringForSecond(Math.max(0,i.end_time-m.serverTime)));r.uiMirror&&(e=m.formatTimeStringForSecond(Math.max(0,i.end_time-m.serverTime))),this.txtLeftTime.string=e,this.timer=this.addTimer(1,i.end_time-m.serverTime,(function(){if(i.end_time-m.serverTime>0){var e=f.formatStrWithMirrorDeal(GetLanguage(200043),m.formatTimeStringForSecond(Math.max(0,i.end_time-m.serverTime)));r.uiMirror&&(e=m.formatTimeStringForSecond(Math.max(0,i.end_time-m.serverTime))),t.txtLeftTime.string=e}else t.removeTimer(t.timer),t.timer=null,t.txtLeftTime.string=GetLanguage(200026)}))}else this.txtLeftTime.string=GetLanguage(200026)},a.updateInfo=function(){for(var t=[],i=IS(l).GetTypeInfoList(5),e=0;e<i.length;e++)5==i[e].payCfg.type&&"return"==i[e].payCfg.conditon[0]&&t.push(i[e].payCfg);t.sort((function(t,i){var e=IS(l).CheckSoldOut(t.id);return e!=IS(l).CheckSoldOut(i.id)?e?1:-1:t.show!=i.show?t.show-i.show:t.id-i.id})),this.taskList.datas=t},a.onBeforeClose=function(){this.timer&&(this.removeTimer(this.timer),this.timer=null)},a.onDestroy=function(){},e}(I));var p=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(i=t.call.apply(t,[this].concat(n))||this).gift_icon=void 0,i.gift_txtName=void 0,i.gift_btnBuy=void 0,i.gift_txtPrice=void 0,i.gift_txtDiscount=void 0,i.gift_discountNode=void 0,i.gift_out=void 0,i.gift_hot=void 0,i.gift_new=void 0,i.gift_red=void 0,i.gift_rewardScroll=void 0,i.giftItem=void 0,i.cardItem=void 0,i.card_txtName=void 0,i.card_txtPrice=void 0,i.card_txtDiscount=void 0,i.card_discountNode=void 0,i.card_out=void 0,i.card_btnBuy=void 0,i.card_oldtxtPrice=void 0,i}i(e,t);var r=e.prototype;return r.onInit=function(){var t=this;this.giftItem=h.findChild(this.node,"giftItem"),this.gift_txtName=h.findChildComponent(this.node,"giftItem/title/Label",n),this.gift_icon=h.findChildComponent(this.node,"giftItem/icon",a),this.gift_txtPrice=h.findChildComponent(this.node,"giftItem/btnBuy/Label",n),this.gift_discountNode=h.findChild(this.node,"giftItem/discount"),this.gift_txtDiscount=h.findChildComponent(this.node,"giftItem/discount/Label",n),this.gift_hot=h.findChild(this.node,"giftItem/hot"),this.gift_new=h.findChild(this.node,"giftItem/new"),this.gift_out=h.findChild(this.node,"giftItem/out"),this.gift_red=h.findChild(this.node,"giftItem/btnBuy/red"),this.gift_btnBuy=h.findChild(this.node,"giftItem/btnBuy"),this.view.addComponentCallbackListener(this.gift_btnBuy,d.EventType.CLICK,(function(){IS(l).CheckConditon(t.data.conditon)&&(0==t.data.price?IS(g).send_19_2(t.data.id):IS(l).Pay(t.data.id))}));var i=h.findChildComponent(this.node,"giftItem/rewardScroll",o);this.gift_rewardScroll=this.view.addUIList(i,C,!1,0),this.gift_rewardScroll.touchEvent=!1,this.cardItem=h.findChild(this.node,"cardItem"),this.card_txtName=h.findChildComponent(this.node,"cardItem/title/Label",n),this.card_txtPrice=h.findChildComponent(this.node,"cardItem/btnBuy/newPrice",n),this.card_oldtxtPrice=h.findChildComponent(this.node,"cardItem/btnBuy/oldPrice",n),this.card_out=h.findChild(this.node,"cardItem/out"),this.card_discountNode=h.findChild(this.node,"cardItem/discount"),this.card_txtDiscount=h.findChildComponent(this.node,"cardItem/discount/Label",n),this.card_btnBuy=h.findChild(this.node,"cardItem/btnBuy"),this.view.addComponentCallbackListener(this.card_btnBuy,d.EventType.CLICK,(function(){IS(l).CheckConditon(t.data.conditon)&&(0==t.data.price?IS(g).send_19_2(t.data.id):IS(l).Pay(t.data.id))}))},r.onRender=function(t,i){if(90202!=t.id){this.giftItem.active=!0,this.cardItem.active=!1,0==t.price?(this.gift_txtPrice.string=GetLanguage(200045),this.gift_red.active=!0):(this.gift_txtPrice.string=IS(l).GetPriceString(t.cost_level),this.gift_red.active=!1),0==t.ratio?this.gift_discountNode.active=!1:(this.gift_discountNode.active=!0,this.gift_txtDiscount.string=100*t.ratio+"%"),this.gift_hot.active=1==t.icon_name,this.gift_new.active=2==t.icon_name,this.view.loadIcon(this.gift_icon,"pay",t.pic_back,null);var e=IS(l).GetPayGiftInfo(t.id);this.gift_out.active=!1,null!=e&&(e.payCfg.buy_times>0&&e.bought_times>=e.payCfg.buy_times?this.gift_out.active=!0:0==e.payCfg.price&&2==e.rewardState&&(this.gift_out.active=!0,this.gift_red.active=!1)),t.buy_times>0?null!=e?0==e.payCfg.price&&2==e.rewardState?this.gift_txtName.string=s.formatStr("%s(%s/%s)",t.name,t.buy_times,t.buy_times):this.gift_txtName.string=s.formatStr("%s(%s/%s)",t.name,e.bought_times,t.buy_times):this.gift_txtName.string=s.formatStr("%s(%s/%s)",t.name,0,t.buy_times):this.gift_txtName.string=t.name,this.gift_rewardScroll.datas=t.reward}else{this.giftItem.active=!1,this.cardItem.active=!0,this.card_txtName.string=t.name,this.card_txtPrice.string=IS(l).GetPriceString(t.cost_level),this.card_oldtxtPrice.string=IS(l).GetPriceString(configPay_mall.getDataByKey(10601).cost_level),0==t.ratio?this.card_discountNode.active=!1:(this.card_discountNode.active=!0,this.card_txtDiscount.string=100*t.ratio+"%");var n=IS(l).GetPayGiftInfo(t.id);this.card_out.active=!1,null!=n&&(n.payCfg.buy_times>0&&n.bought_times>=n.payCfg.buy_times?this.card_out.active=!0:0==n.payCfg.price&&2==n.rewardState&&(this.card_out.active=!0,this.card_out.active=!1))}},r.PlayAnim=function(){},e}(c),C=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(i=t.call.apply(t,[this].concat(n))||this).txtNum=void 0,i.imgFrame=void 0,i.imgIcon=void 0,i}i(e,t);var o=e.prototype;return o.onInit=function(){var t=this;this.txtNum=h.findChildComponent(this.node,"txtNum",n),this.imgFrame=h.findChildComponent(this.node,"imgFrame",a),this.imgIcon=h.findChildComponent(this.node,"imgIcon",a),this.view.addComponentCallbackListener(this.imgIcon.node,d.EventType.CLICK,(function(){IS(u).OpenItemTips(t.data[0],t.imgIcon.node)}))},o.onRender=function(t,i){var e,n=t[0],o=configGoods.getDataByKey(n),r=o.quality;1==o.type?this.txtNum.string="x"+t[1]:this.txtNum.string=o.name+" x"+t[1],3==o.type?(e="icon_skill",this.imgIcon.node.setScale(.5,.5,.5)):4==o.type?(e="icon_pet",this.imgIcon.node.setScale(.6,.6,.6)):(e="icon_item",this.imgIcon.node.setScale(.7,.7,.7));var a=configColor.getDataByKey(r);this.view.loadIcon(this.imgIcon,e,o.icon),this.view.loadIcon(this.imgFrame,"icon_equip",a.path)},e}(c);e._RF.pop()}}}));

