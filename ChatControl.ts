System.register("chunks:///_virtual/ChatControl.ts",["cc","./ChatDataCache.ts","./TimeUtil.ts","./MessageView.ts","./ControlMgr.ts","./RoleDataCache.ts","./RoleDefine.ts","./ChatDefine.ts"],(function(e){"use strict";var t,n,s,_,c,i,r,a;return{setters:[function(e){t=e.cclegacy},function(e){n=e.ChatDataCache},function(e){s=e.default},function(e){_=e.default},function(e){c=e.controlMgr},function(e){i=e.RoleDataCache},function(e){r=e.PlayerAttr},function(e){a=e.ChatDefine}],execute:function(){t._RF.push({},"e7a9ftAAMxALIYoVxPAEREh","ChatControl",void 0);e("default",function(){var e=t.prototype;function t(){IS(n),netManager.addEventListener("chat.chat_message_s2c",this.on_chat_message_s2c,this),netManager.addEventListener("chat.chat_history_s2c",this.on_chat_history_s2c,this),netManager.addEventListener("chat.chat_friend_info_list_s2c",this.on_chat_friend_info_list_s2c,this),netManager.addEventListener("chat.chat_history_read_s2c",this.on_chat_history_read_s2c,this),netManager.addEventListener("chat.ban_chat_s2c",this.on_ban_chat_s2c,this),netManager.addEventListener("chat.chat_channel_list_s2c",this.on_chat_channel_list_s2c,this),netManager.addEventListener("chat.chat_channel_change_s2c",this.on_chat_channel_change_s2c,this),netManager.addEventListener("red.red_all_list_s2c",this.on_red_all_list_s2c,this),netManager.addEventListener("red.red_send_s2c",this.on_red_send_s2c,this),netManager.addEventListener("red.red_grab_s2c",this.on_red_grab_s2c,this),netManager.addEventListener("red.red_pop_s2c",this.on_red_pop_s2c,this),netManager.addEventListener("red.red_brief_list_s2c",this.on_red_brief_list_s2c,this),netManager.addEventListener("customer_service.customer_service_kf_list_s2c",this.on_customer_service_kf_list_s2c,this),netManager.addEventListener("customer_service.customer_service_kf_register_s2c",this.on_customer_service_kf_register_s2c,this),netManager.addEventListener("customer_service.customer_service_kf_unregister_s2c",this.on_customer_service_kf_unregister_s2c,this),netManager.addEventListener("customer_service.customer_service_send_msg_s2c",this.on_customer_service_send_msg_s2c,this),netManager.addEventListener("customer_service.customer_service_kf_send_msg_s2c",this.on_customer_service_kf_send_msg_s2c,this),netManager.addEventListener("customer_service.customer_service_offline_msg_s2c",this.on_customer_service_offline_msg_s2c,this),netManager.addEventListener("customer_service.customer_service_info_s2c",this.on_customer_service_info_s2c,this),c.addControl(this)}return e.clear=function(){console.log("清理ChatControl")},e.onLogin=function(){this.reqChanneList()},e.onReconnect=function(){this.reqChanneList(),this.send_red_all_list_c2s(),this.send_customer_service_kf_list_c2s()},e.reqChatMessage=function(e,t,c,o,d,h,f){if(void 0===o&&(o=0),e!=a.Channel.Private||o!=a.VIPGmUid){var u=IS(i).GetRoleAttr(r.ROLE_ATTR_ID),g=IS(n).GetIsBanRole(u);if(g&&g>s.serverTime)g-s.serverTime<=60?_.showFlyTip(GetLanguage(200157)):uiMgr.openView("ComplainView",16);else if(t==a.ChatContentType.Conetnt||t==a.ChatContentType.Voice){if(t==a.ChatContentType.Conetnt){var l=IS(n).GetMentionRole(),m=[],v=[];for(var p in l){c.match("@"+l[p].name)&&(m.push(l[p].role_id),v.push(l[p].name))}m.length>0&&(d=[{pos:1,type:a.ChatLinkType.MentionRole,args_list:m,string_list:v}])}sdkControl.checkStr(c,(function(n,s){1==s&&netManager.send("chat.chat_message_c2s",{channel:e,target_id:o,content_type:t,content:n,links:d,args:h,lang_args:f})}),2)}else netManager.send("chat.chat_message_c2s",{channel:e,target_id:o,content_type:t,content:c,links:d,args:h,lang_args:f})}else{var M=IS(n).GetKfList();M&&M[0]&&this.send_customer_service_send_msg_c2s(M[0].uid,c,t,"")}},e.on_chat_message_s2c=function(e){IS(n).InsertNewMsg(e)},e.reqChatHistory=function(e,t){void 0===t&&(t=0),netManager.send("chat.chat_history_c2s",{channel:e,target_id:t})},e.on_chat_history_s2c=function(e){IS(n).UpdateChatHistoryMessage(e)},e.reqFriendInfoList=function(e){netManager.send("chat.chat_friend_info_list_c2s",{id:e})},e.on_chat_friend_info_list_s2c=function(e){IS(n).UpdateChatFriendInfoList(e)},e.reqChatHistoryRead=function(e){IS(n).ReadGmMsg(e)||netManager.send("chat.chat_history_read_c2s",{target_id:e})},e.on_chat_history_read_s2c=function(e){IS(n).ReadChat(e)},e.reqBanChat=function(){netManager.send("chat.ban_chat_c2s",{})},e.on_ban_chat_s2c=function(e){IS(n).UpdateBanRoleList(e)},e.reqChanneList=function(){netManager.send("chat.chat_channel_list_c2s",{})},e.on_chat_channel_list_s2c=function(e){IS(n).initChannelList(e.chat_channel_list)},e.on_chat_channel_change_s2c=function(e){IS(n).updateChannelList(e.type,e.chat_channel)},e.send_red_all_list_c2s=function(){netManager.send("red.red_all_list_c2s",{})},e.on_red_all_list_s2c=function(e){IS(n).UpdateRedBagInfo(e)},e.send_red_send_c2s=function(e,t){netManager.send("red.red_send_c2s",{id:e,num:t})},e.on_red_send_s2c=function(e){IS(n).UpdateRedBagBySend(e)},e.send_red_grab_c2s=function(e,t){netManager.send("red.red_grab_c2s",{id:e,type:t})},e.on_red_grab_s2c=function(e){IS(n).UpdateRedBagByGrab(e)},e.on_red_pop_s2c=function(e){IS(n).UpdateRedBagPop(e)},e.send_red_brief_list_c2s=function(){netManager.send("red.red_brief_list_c2s",{})},e.on_red_brief_list_s2c=function(e){IS(n).UpdateShowRedBagInfo(e)},e.send_customer_service_kf_list_c2s=function(){netManager.send("customer_service.customer_service_kf_list_c2s",{})},e.on_customer_service_kf_list_s2c=function(e){IS(n).UpdateGmList(e)},e.on_customer_service_kf_register_s2c=function(e){IS(n).UpdateGmInfo(e)},e.on_customer_service_kf_unregister_s2c=function(e){IS(n).kfOffline(e)},e.send_customer_service_send_msg_c2s=function(e,t,_,c){void 0===c&&(c=""),s.serverTime-IS(n).vipSendTime<a.GmChatSpaceTime||(IS(n).vipSendTime=s.serverTime,IS(n).InsertLocalMsgByGm(t,_),netManager.send("customer_service.customer_service_send_msg_c2s",{kf_uid:e,content:t,msg_type:_.toString(),ext_content:c}))},e.on_customer_service_send_msg_s2c=function(e){if(IS(n).vipSendTime=0,0==e.ret);else{var t=configErrorInfo.getDataByKey(e.ret);t.info&&_.showFlyTip(t.info)}},e.on_customer_service_kf_send_msg_s2c=function(e){IS(n).ReceiveGmMsg(e.msg,!0)},e.send_customer_service_offline_msg_c2s=function(){netManager.send("customer_service.customer_service_offline_msg_c2s",{})},e.on_customer_service_offline_msg_s2c=function(e){IS(n).UpdateVipGmOfflineMsg(e)},e.send_customer_service_info_c2s=function(){netManager.send("customer_service.customer_service_info_c2s",{})},e.on_customer_service_info_s2c=function(e){IS(n).UpdateVipInfo(e)},t}());t._RF.pop()}}}));

