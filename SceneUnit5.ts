System.register("chunks:///_virtual/SceneUnit5.ts",["./rollupPluginModLoBabelHelpers.js","cc","./V2.ts","./AudioMgr.ts","./LabelUtil.ts","./NodeUtil.ts","./UIEffectAsset.ts","./ConfigGlobal.ts","./PolyNavAgent.ts","./CommonModel.ts","./MessageView.ts","./FriendControl.ts","./RoleDataCache.ts"],(function(t){"use strict";var e,i,n,o,h,s,a,d,c,f,r,l,u,m,v,p,C,g,S,y,x,w,T,k,b,I;return{setters:[function(t){e=t.inheritsLoose,i=t.createClass,n=t.assertThisInitialized},function(t){o=t.cclegacy,h=t.Label,s=t.Color,a=t.Vec3,d=t.UITransform,c=t.sys,f=t.HorizontalTextAlignment,r=t.Button,l=t.ProgressBar,u=t.Vec2,m=t.isValid,v=t.Rect},function(t){p=t.V2},function(t){C=t.audioMgr},function(t){g=t.LabelUtil},function(t){S=t.default},function(t){y=t.UIEffectAsset},function(t){x=t.ConfigGlobal},function(t){w=t.PolyNavAgent},function(t){T=t.CommonModel},function(t){k=t.default},function(t){b=t.default},function(t){I=t.RoleDataCache}],execute:function(){o._RF.push({},"086de2aIgtM4p6/9ELLshvw","SceneUnit",void 0);var B=t("SceneUnit",function(){function t(){this.id=void 0,this.uid=0,this.del=!1,this.isDestroy=!1,this.type=1,this.rect=new v}var e=t.prototype;return e.update=function(t){this.del||this.onUpdate(t)},e.destroy=function(){this.isDestroy||(this.isDestroy=!0,this.del=!0,this.onDestroy())},t}());t("SceneRole",function(t){function n(e,i){var n;(n=t.call(this)||this).map=void 0,n.info=void 0,n.agent=void 0,n.model=void 0,n.moveType=0,n.velocity=void 0,n.infoView=void 0,n.btnBreak=void 0,n.nodeActive=void 0,n.titleicon=void 0,n.nodePb=void 0,n.pbPicking=void 0,n.btnRolemodel=void 0,n.nodeChat=void 0,n.txtContent=void 0,n.cacheTalk=void 0,n.nodeSelf=void 0,n.nodeSelfStateCache=null,n.nameStateCache=null,n.nameNode=void 0,n.fireData=[],n.chatBg=void 0,n.timeScale=void 0,n.pickingNum=0,n.info=i,n.uid=i.role_id,n.map=e,n.agent=new w(e.polyNav);var o=new p(i.pos.x,i.pos.y);return n.model=IS(T).createRoleModel(i.figure,e.nodeUnit,o,1),n.infoView=y.alloc("ui/module/marry/scene/PlayerInfo",e.nodeUnitHub,-1,(function(t){n.onInit(t)})),n.agent.pos.set(o.x,o.y),n.agent.maxSpeed=150,n.rect.width=50,n.rect.height=50,n.rect.center=o,n.id="role:"+i.role_id,n}e(n,t);var o=n.prototype;return o.onInit=function(t){var e=t.node;this.nodeSelf=S.findChild(e,"nodeSelf"),this.nodeSelf.active=!0,null!=this.nodeSelfStateCache&&(this.nodeSelf.active=this.nodeSelfStateCache,this.nodeSelfStateCache=null);var i=S.findChildComponent(e,"nodeSelf/node/txtName",h);this.nameNode=i.node;var n=S.findChild(e,"nodeSelf/imgArrow");if(i.string=this.info.role_name,Number(this.info.role_id)==IS(I).GetRoleId()?(n.active=!0,i.color=new s(39,153,22)):(n.active=!1,i.color=s.WHITE),this.nodeChat=S.findChild(e,"nodeChat"),this.nodeChat.position=new a(0,130,0),this.txtContent=S.findChildComponent(e,"nodeChat/nodeTxt/txtChat",h),this.chatBg=S.findChildComponent(e,"nodeChat/nodeTxt",d),this.cacheTalk){this.nodeChat.active=!0,this.txtContent.string=this.cacheTalk;var o=g.measureSize(this.txtContent);if(this.chatBg.width=o.width+30,this.chatBg.height=o.height+22,c.uiMirror){var u=this.txtContent.node.getPosition();S.findChildComponent(e,"nodeChat/nodeTxt/txtChat",d).anchorX=1,this.txtContent.horizontalAlign=f.RIGHT,this.txtContent.node.setPosition(this.chatBg.width-20,u.y,0)}}else this.nodeChat.active=!1;c.uiMirror&&this.nameNode.setScale(1,1,1),this.nodeActive=S.findChild(e,"nodeSelf/node/nodeActive"),this.nodeActive.active=1!=this.info.break,null!=this.nameStateCache&&(this.nameNode.active=this.nameStateCache,this.nodeActive.active=1!=this.info.break&&this.nameStateCache,this.nameStateCache=null),this.btnRolemodel=S.findChild(e,"rolemodel"),this.btnRolemodel.on(r.EventType.CLICK,this.onShowInfo,this),S.findChild(e,"nodeSelf").setPosition(0,this.model.modelHeight+50),this.nodePb=S.findChild(e,"nodeSelf/node/nodePb"),this.pbPicking=this.nodePb.getComponent(l),this.refreshPickingState(this.pickingNum)},o.removeEvent=function(){null!=this.btnBreak&&(this.btnBreak.off(r.EventType.CLICK,this.onBreak,this),this.btnRolemodel.off(r.EventType.CLICK,this.onShowInfo,this))},o.onBreak=function(){k.showBoxTip({title:GetLanguage(200341),tip:GetLanguage(200342),btnCnt:1})},o.onShowInfo=function(){IS(b).reqOtherRoleNotice(this.info.role_id)},o.refreshPickingState=function(t){this.pickingNum=t,this.nodePb&&(this.nodePb.active=t>0,this.pbPicking.progress=t/x.treasure_hunt_pick_time)},o.ShowTalk=function(t){if(t)if(this.nodeChat){this.nodeChat.active=!0,this.txtContent.string=t;var e=g.measureSize(this.txtContent);if(this.chatBg.width=e.width+30,this.chatBg.height=e.height+22,c.uiMirror){var i=this.txtContent.node.getPosition();S.findChildComponent(this.txtContent.node,"",d).anchorX=1,this.txtContent.horizontalAlign=f.RIGHT,this.txtContent.node.setPosition(this.chatBg.width-20,i.y,0)}}else this.cacheTalk=t;else this.nodeChat&&(this.nodeChat.active=!1),this.cacheTalk=null},o.showNameInfo=function(t){this.nodeSelf?this.nodeSelf.active=t:this.nodeSelfStateCache=t},o.showNameState=function(t){this.nodeSelf?(this.nameNode.active=t,this.nodeActive.active=t):this.nameStateCache=t},o.onUpdate=function(t){if(!this.del){if(this.agent.onUpdate(t),1==this.moveType?this.agent.isMove?this.model.aniName="run":(this.model.aniName="idle",this.moveType=0):2==this.moveType&&this.agent.setDirPos(this.velocity,t),this.timeScale){var e=this.model.GetAnimator();e&&e.timeScale!=this.timeScale&&(e.timeScale=this.timeScale)}this.rect.center=this.agent.pos,this.model.position=this.agent.pos,this.infoView.position=this.agent.pos;var i=this.agent.dir;this.model.direction=i}},o.SetAnimation=function(t){var e=this.model.GetAnimator();e&&(this.model.aniName="",e.setAnimation(0,t,!1),e.addAnimation(0,"idle",!0))},o.SetAnimScale=function(t){var e=this.model.GetAnimator();e&&e.timeScale!=t&&(e.timeScale=t),this.timeScale=t},o.moveToTarget=function(t){return!!this.agent.setDestination(t)&&(this.moveType=1,!0)},o.moveToDir=function(t){this.agent.stop(),t.lengthSqr()>1?(this.moveType=2,this.model.aniName="run",this.velocity=t):(this.moveType=0,this.model.aniName="idle",this.velocity=u.ZERO)},o.ToDir=function(t){this.agent.dir=t},o.onDestroy=function(){this.infoView&&(this.removeEvent(),this.infoView.free());var t=this.model.GetAnimator();t&&(t.timeScale=1),this.model&&this.model.free();for(var e=0;e<this.fireData.length;e++){var i=this.fireData[e];i.timer&&this.map.view.removeTimer(i.timer),i.eff&&i.eff.free()}this.fireData=[]},o.updatePolyNav=function(t){this.agent.updatePolyNav(t)},o.playFire=function(){var t=this,e=y.alloc("prefab/ui-effect/MX_tx_jiehun_2",this.map.nodeUnitHub,-1,(function(e){e.position=t.agent.pos}));this.fireData.push({timer:this.map.view.addTimer(.8,1,(function(){var e=t.fireData.shift();e.timer&&t.map.view.removeTimer(e.timer),e.eff&&e.eff.free()})),eff:e}),C.playSound("hunli_lihua")},i(n,[{key:"position",get:function(){return this.model.position},set:function(t){this.agent.stop(),this.agent.isMove||(this.model.aniName="idle",this.moveType=0),this.model.position=t,this.agent.pos.set(t.x,t.y),this.rect.center=t}},{key:"depth",get:function(){return this.model.depth},set:function(t){this.model.depth=t}}]),n}(B)),t("SceneDog",function(t){function n(e){var i;return(i=t.call(this)||this).map=void 0,i.effect=void 0,i.infoView=void 0,i.nodeChat=void 0,i.txtContent=void 0,i.cacheTalk=void 0,i.chatBg=void 0,i.timer=void 0,i.type=4,i.map=e,i.effect=y.alloc("prefab/model/mx_tx_shineihunli",e.nodeUnit,-1,(function(t){})),i.effect.scale=.5,i.infoView=y.alloc("ui/module/marry/scene/PlayerInfo",e.nodeUnitHub,-1,(function(t){var e=t.node;if(e.position=new a(0,-43,0),S.findChild(e,"nodeSelf").active=!1,S.findChild(e,"nodeSelf").active=!1,i.nodeChat=S.findChild(e,"nodeChat"),i.nodeChat.position=new a(0,78.6,0),i.chatBg=S.findChildComponent(e,"nodeChat/nodeTxt",d),i.txtContent=S.findChildComponent(e,"nodeChat/nodeTxt/txtChat",h),i.cacheTalk){i.nodeChat.active=!0,i.txtContent.string=i.cacheTalk;var n=g.measureSize(i.txtContent);if(i.chatBg.width=n.width+30,i.chatBg.height=n.height+22,c.uiMirror){var o=i.txtContent.node.getPosition();S.findChildComponent(e,"nodeChat/nodeTxt/txtChat",d).anchorX=1,i.txtContent.horizontalAlign=f.RIGHT,i.txtContent.node.setPosition(i.chatBg.width-20,o.y,0)}}else i.nodeChat.active=!1})),i.infoView.position=new u(0,-43),i.id="dog:1",i}e(n,t);var o=n.prototype;return o.onUpdate=function(t){},o.ShowTalk=function(t){var e=this;if(this.timer&&(this.map.view.removeTimer(this.timer),this.timer=null),t)if(this.nodeChat){this.nodeChat.active=!0,this.txtContent.string=t;var i=g.measureSize(this.txtContent);if(this.chatBg.width=i.width+30,this.chatBg.height=i.height+22,c.uiMirror){var n=this.txtContent.node.getPosition();S.findChildComponent(this.txtContent.node,"",d).anchorX=1,this.txtContent.horizontalAlign=f.RIGHT,this.txtContent.node.setPosition(this.chatBg.width-20,n.y,0)}this.timer=this.map.view.addTimer(5,1,(function(){e.nodeChat.active=!1,e.timer=null,e.cacheTalk=null}))}else this.cacheTalk=t;else this.nodeChat&&(this.nodeChat.active=!1),this.cacheTalk=null},o.onDestroy=function(){this.infoView&&this.infoView.free(),this.effect&&this.effect.free(),this.timer&&(this.map.view.removeTimer(this.timer),this.timer=null)},i(n,[{key:"position",get:function(){return this.effect.position},set:function(t){this.effect.position=t}},{key:"depth",get:function(){return this.effect.depth},set:function(t){this.effect.depth=t}}]),n}(B)),t("SceneBox",function(t){function o(e,i){var o;return(o=t.call(this)||this).map=void 0,o.effect=void 0,o.nodeInfo=void 0,o.btnInfo=void 0,o.type=2,o.map=e,o.uid=i.n,o.effect=y.alloc("ui/module/marry/scene/Box",e.nodeUnit,-1,(function(t){o.nodeInfo=S.findChild(t.node,"info"),S.findChildComponent(o.nodeInfo,"txtNum",h).string=i.open_num+"/"+i.open_limit,o.btnInfo=S.findChild(t.node,"btnInfo"),o.btnInfo.on(r.EventType.CLICK,o.onClickBox,n(o))})),o.rect.width=x.treasure_hunt_range,o.rect.height=x.treasure_hunt_range,o.rect.center=new u(i.pos.x,i.pos.y),o.effect.position=new p(i.pos.x,i.pos.y),o.id="box:"+i.n,o}e(o,t);var s=o.prototype;return s.onUpdate=function(t){},s.onClickBox=function(){this.map.boxClick(this)},s.onDestroy=function(){m(this.btnInfo)&&this.btnInfo.off(r.EventType.CLICK,this.onClickBox,this),this.effect.free()},i(o,[{key:"position",get:function(){return this.effect.position},set:function(t){this.effect.position=t}},{key:"depth",get:function(){return this.effect.depth},set:function(t){this.effect.depth=t}}]),o}(B)),t("SceneEffect",function(t){function n(e,i){var n;return(n=t.call(this)||this).effect=void 0,n.type=3,n.effect=y.alloc(i,e.nodeUnit,-1),n}e(n,t);var o=n.prototype;return o.onUpdate=function(t){},o.onDestroy=function(){this.effect.free()},i(n,[{key:"position",get:function(){return this.effect.position},set:function(t){this.effect.position=t}},{key:"depth",get:function(){return this.effect.depth},set:function(t){this.effect.depth=t}}]),n}(B));o._RF.pop()}}}));

