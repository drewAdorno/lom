System.register("chunks:///_virtual/MainView_TaskInfo.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BattleData.ts","./EnumDefine.ts","./index3.ts","./StringUtil.ts","./BaseSubView.ts","./CommonDefine.ts","./GuideModel.ts","./TaskControl.ts","./TaskDataCache.ts","./TaskDefine.ts","./MainViewModel.ts","./EaseMethod.ts"],(function(t){"use strict";var e,n,i,o,s,a,r,d,c,f,u,h,l,p,v,g,m,k,C,D,T,I,M,w;return{setters:[function(t){e=t.inheritsLoose},function(t){n=t.cclegacy,i=t.Label,o=t.Button,s=t.RichText,a=t.Sprite,r=t.UITransform,d=t.Node,c=t.Vec3,f=t.Vec2,u=t.js},function(t){h=t.ChapterType},function(t){l=t.RunState},null,function(t){p=t.default},function(t){v=t.BaseSubView},function(t){g=t.CommonEventDefine},function(t){m=t.GuideModel},function(t){k=t.default},function(t){C=t.TaskDataCache},function(t){D=t.TaskState,T=t.TaskType,I=t.TaskEventDefine},function(t){M=t.MainViewModel},function(t){w=t.EasingMethod}],execute:function(){var S;n._RF.push({},"79617vgeOFKZZV3jpiWtkGn","MainView_TaskInfo",void 0);var _=((S={})[0]=.9,S[1]=1.1,S[2]=1.35,S[3]=1.6,S);t("default",function(t){function n(){var e;return(e=t.call(this)||this).txtDesc=void 0,e.imgIcon=void 0,e.txtReward=void 0,e.utNode=void 0,e.utDesc=void 0,e.effNode=void 0,e.taskEff=void 0,e.moveTween=void 0,e.basePos=void 0,e.nodeDesc=void 0,e.utNodeDesc=void 0,e.txtProgress=void 0,e.name="MainView_TaskInfo",e}e(n,t);var v=n.prototype;return v.onInit=function(){var t=this;this.txtDesc=this.findChildComponent("Node/txtDesc",i),this.addComponentCallbackListener(this.node,o.EventType.CLICK,(function(){t.onBtnClick()})),this.txtProgress=this.findChildComponent("Node/txtProgress",s),this.effNode=this.findChild("eff"),this.txtReward=this.findChildComponent("reward/txtReward",i),this.imgIcon=this.findChildComponent("reward/txtReward/imgIcon",a),this.utNode=this.node.getComponent(r),this.utDesc=this.txtDesc.node.getComponent(r),this.nodeDesc=this.findChild("Node"),this.utNodeDesc=this.nodeDesc.getComponent(r),this.addComponentCallbackListener(this.nodeDesc,d.EventType.SIZE_CHANGED,(function(){t.txtDesc.scheduleOnce((function(){t.updateSize()}))})),this.basePos=new c(this.node.position)},v.onBtnClick=function(){var t=IS(C).GetCurMainTask();if(t&&t.state==D.Complete){IS(k).send_10_2(T.Main,t.task_id),this.flyOut();var e=configMain_task.getDataByKey(t.task_id);switch(e.reward[0][0]){case 1001:normalEvent.emit(g.FLY_LAMP,this.node.worldPosition);break;case 1:normalEvent.emit(g.FLY_COIN,this.node.worldPosition);break;case 2:normalEvent.emit(g.FLY_DIAMO,this.node.worldPosition)}uiMgr.isOpenGuide=!1,IS(m).openGuide(e.force_guide)}else if(t&&t.state==D.Normal){var n=IS(C).GetCurMainTaskId(),i=configMain_task.getDataByKey(n);if(1==i.trigger){if(!IS(M).checkGuideShow(!0))return;if(battleMain.runState!=l.Running)return;if(battleMain.data.chapterType!=h.Main)return;if(0==battleMain.data.chapterMode)return}uiMgr.isOpenGuide=!1,IS(m).openGuide(i.guide)}},v.flyOut=function(){var t=this;null!=this.moveTween&&(this.moveTween.stop(),this.node.position=this.basePos);var e=new c,n=this.node.getComponent(r).contentSize,i=this.node.position,o=new c(i.x,i.y);this.moveTween=normalTween.to(0,1,.6,(function(i,s){e.set(o).add3f(-1.1*n.x*Math.sin(Math.PI*s),0,0),t.node.position=e})).easing(w.LINEAR).start()},v.registerUpdateHandler=function(){this.addEvent(I.TASK_INFO_UPDATE,this.updateTaskInfo,this)},v.onAfterOpen=function(){this.updateTaskInfo()},v.onBeforeClose=function(){},v.onDestroy=function(){},v.updateTaskInfo=function(){var t=IS(C).GetCurMainTask(),e=IS(C).GetCurMainTaskId();if(0!=e){this.node.active=!0;var n,i=configMain_task.getDataByKey(e);null!=this.taskEff&&this.removeUIEffect(this.taskEff);var o=i.condition[2],s="#2dc05a",a="#2dc05a";null==t?(n=0,s="#FFFFFF",a="#e76262"):t.state==D.Normal?(n=t.count<=o?t.count:o,s="#FFFFFF",a="#e76262"):t.state==D.Complete?(n=o,s="#2dc05a",a="#2dc05a",this.taskEff=this.addUIEffect("prefab/ui-effect/e_20012",this.effNode,-1,new f(0,44.5))):(n=o,s="#2dc05a",a="#2dc05a"),this.setTaskDesc(p.formatStr.apply(p,[i.desc_client].concat(i.desc_parm)),s,a,n,o);var r=i.reward[0];this.loadIcon(this.imgIcon,"icon_item",r[0]),this.txtReward.string=r[1]}else this.node.active=!1},v.updateSize=function(){var t=this.utNodeDesc.height;this.utNode.height=t+57;var e=Math.floor((t-30)/24);this.effNode.scale=new c(1,_[e],1)},v.setTaskDesc=function(t,e,n,i,o){p.getStringLength(t),p.getStringLength(u.formatStr("%s(%s/%s)",t,i,o));this.txtDesc.string=u.formatStr("<bold><color=#fff9e5>%s</color>%s<color=%s>(<color=%s>%s</color>/%s)</color></bold>",t,"\n",e,n,i,o),this.txtDesc.string=t,this.txtProgress.string=u.formatStr("<color=#fff9e5>(<color=%s>%s</color>/%s)</color>",n,i,o)},n}(v));n._RF.pop()}}}));

