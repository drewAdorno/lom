System.register("chunks:///_virtual/ActivityFPSGameMainView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AudioMgr.ts","./UIList.ts","./RedPoint.ts","./NodeUtil.ts","./StorageUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./ConfigGlobal.ts","./MessageView.ts","./RoleDataCache.ts","./ActivityControl.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./ActivityFPSControl.ts","./ActivityFPSDataCache.ts","./ActivityFPSDefine.ts","./BaseView.ts"],(function(e){"use strict";var t,i,n,o,a,l,s,d,c,r,h,v,f,u,S,m,p,g,L,I,T,C,y,G,M,P,x,b,A,F;return{setters:[function(e){t=e.inheritsLoose},function(e){i=e.cclegacy,n=e.Button,o=e.HorizontalTextAlignment,a=e.Vec2,l=e.Label,s=e.Sprite,d=e.ScrollView,c=e.js},function(e){r=e.audioMgr},function(e){h=e.SelectedType,v=e.ListItem},function(e){f=e.RedPointType},function(e){u=e.default},function(e){S=e.default},function(e){m=e.default},function(e){p=e.default},null,function(e){g=e.ConfigGlobal},function(e){L=e.default},function(e){I=e.RoleDataCache},function(e){T=e.default},function(e){C=e.default},function(e){y=e.ActivityType,G=e.ActivityEventDefine,M=e.ActivityState,P=e.ActivityTaskState},function(e){x=e.default},function(e){b=e.default},function(e){A=e.ActivityFPSEvent},function(e){F=e.BaseView}],execute:function(){i._RF.push({},"36daaox3ZpHkJzkjyr/mUen","ActivityFPSGameMainView",void 0);e("default",function(e){function i(){var t;return(t=e.call(this)||this).txtTimeDesc=void 0,t.txtLeftTime=void 0,t.leftTime=0,t.deltaTime=0,t.canUpdate=!1,t.actType=void 0,t.txtTop=void 0,t.txtTopScore=void 0,t.txtDesc=void 0,t.imgChallengeSelected=void 0,t.levelList=void 0,t.btnChallenge=void 0,t.RedPoint=void 0,t.name="ActivityFPSGameMainView",t.url="ui/module/activityFPS/ActivityFPSGameMainView",t.actType=y.FPSGame,t}t(i,e);var v=i.prototype;return v.onInit=function(){var e=this,t=this.findChild("bottom/btnClose");this.addComponentCallbackListener(t,n.EventType.CLICK,(function(){e.close()}));var i=this.findChild("top/title/btnTip");this.addComponentCallbackListener(i,n.EventType.CLICK,(function(){for(var t=g.LIMITED_RANK_SYSTEM_DETAILS,i="",n=0;n<t.length;n++)t[n][0]==e.actType&&(i=GetLanguage(t[n][1]));""!=i&&L.showBoxTip({tip:i,btnCnt:1,horizontalAlign:o.LEFT})}));var c=this.findChild("btnStart");this.addComponentCallbackListener(c,n.EventType.CLICK,(function(){IS(x).send_24_128(IS(b).curMoleLevelId),IS(b).curMoleLevelId==IS(b).challengeLevelId?IS(b).curChallengeLevelStage=1:IS(b).curChallengeLevelStage=0,IS(b).updateLevelInfo()}));var r=this.findChild("bottom/btnTask");this.addRedPoint("mole_task",r,new a(25,30),f.Dot),this.addComponentCallbackListener(r,n.EventType.CLICK,(function(){uiMgr.openView("ActivityFPSGameTaskView",y.FPSGame)})),this.RedPoint=this.findChild("bottom/btnTask/RedPoint");var v=this.findChild("bottom/btnGuide");this.addComponentCallbackListener(v,n.EventType.CLICK,(function(){uiMgr.openView("ActivityFPSGameGuideView",1)})),this.btnChallenge=this.findChild("content/nodeLevel/btnChallenge"),this.addComponentCallbackListener(this.btnChallenge,n.EventType.CLICK,(function(){IS(b).curMoleLevelId=IS(b).challengeLevelId,e.UpdateLevelList(1)})),this.txtTimeDesc=this.findChildComponent("top/nodeTime/txtDesc",l),this.txtLeftTime=this.findChildComponent("top/nodeTime/txtTime",l),this.imgChallengeSelected=this.findChildComponent("content/nodeLevel/btnChallenge/imgSelected",s),this.txtTop=this.findChildComponent("content/nodeLevel/txtTop/top1",l),this.txtTopScore=this.findChildComponent("content/nodeLevel/txtTopScore",l),this.txtDesc=this.findChildComponent("content/nodeLevel/txtDesc",l);var u=this.findChildComponent("content/nodeLevel/ScrollView",d);this.levelList=this.addUIList(u,k,!0),this.levelList.selectedMode=h.SINGLE},v.registerUpdateHandler=function(){this.addEvent(G.OnTangMoleInfoBack,this.UpdateLevelList,this),this.addEvent(G.OnTangMoleLevelUpdate,this.UpdateLevelList,this),this.addEvent(G.OnTangMoleGameStart,this.GameStart,this),this.addEvent(G.OnActivityInfoUpdate,this.updateTimeInfo,this),this.addEvent(G.OnActivityInfoTaskUpdate,this.updateRed,this)},v.onAfterOpen=function(){""==S.get("FPSgame"+IS(I).GetRoleId())&&(this.addTimer(1,0,(function(){uiMgr.openView("ActivityFPSGameGuideView",1)})),S.set("FPSgame"+IS(I).GetRoleId(),"1")),"1"==S.get("FPSGame_NewLevel_"+IS(I).GetRoleId())&&(S.set("FPSGame_NewLevel_"+IS(I).GetRoleId(),"0"),IS(C).UpdateMainRedByActType(y.FPS),normalEvent.emit(A.OnFPSGameNewLevelUpdate)),IS(x).send_24_126(),IS(T).send_24_14(y.FPSGame),this.updateTimeInfo(),this.UpdateLevelList(),r.playMusic("stbyc_dds_bgm")},v.onBeforeClose=function(){this.canUpdate=!1,r.playMusic("fps_mainbgm")},v.onDestroy=function(){},v.onUpdate=function(e){this.canUpdate&&(this.deltaTime=this.deltaTime+e,this.deltaTime>=1&&(this.deltaTime=0,this.leftTime=this.leftTime-1,this.leftTime>0?this.txtLeftTime.string=c.formatStr("%s",p.formatTimeStringForSecond(this.leftTime)):(this.txtLeftTime.string=GetLanguage(200026),this.canUpdate=!1)))},v.updateRed=function(){var e=0,t=IS(C).GetActivityInfo(y.FPSGame);if(t&&t.state!=M.Null){var i=t.task_list;for(var n in i){if(i.hasOwnProperty(n))i[n].state==P.CanGet&&(e+=1)}var o=t.group_task_list;for(var a in o){if(o.hasOwnProperty(a))o[a].state==P.CanGet&&(e+=1)}}this.RedPoint.active=e>0},v.UpdateLevelList=function(e){void 0===e&&(e=0),(IS(b).levelTopScore[IS(b).curMoleLevelId]||0==IS(b).levelTopScore[IS(b).curMoleLevelId])&&(this.txtTopScore.string=IS(b).levelTopScore[IS(b).curMoleLevelId].toString()),IS(b).curMoleLevelId==IS(b).challengeLevelId?this.txtTop.string=GetLanguage(201715):this.txtTop.string=m.formatStrWithMirrorDeal(GetLanguage(200797),IS(b).curMoleLevelId);var t=[],i=configMole_level;0==e&&(IS(b).curMoleLevelId=IS(b).openLevelList[IS(b).openLevelList.length-2]);for(var n=function(e){if(1==i.getDataByKey(e+1).challenge_level)return IS(b).challengeLevelId=e+1,IS(b).challengeLevelStage=i.getDatas().length-e,"break";var n={isLocked:!IS(b).openLevelList.some((function(t){return t==e+1})),isSelected:e==IS(b).curMoleLevelId-1};t.push(n)},o=0;o<i.getDatas().length;o++){if("break"===n(o))break}this.levelList.datas=t,this.imgChallengeSelected.node.active=IS(b).curMoleLevelId==IS(b).challengeLevelId,this.txtDesc.node.active=IS(b).curMoleLevelId==IS(b).challengeLevelId},v.GameStart=function(){IS(b).updateLevelInfo(),uiMgr.openView("ActivityFPSGameView")},v.updateTimeInfo=function(e){if(e||(e=IS(C).GetActivityInfo(y.FPSGame)),e){var t,i=null!=(t=e.state_time[e.state])?t:e.state_time[M.Open];if(this.leftTime=i.end_time-p.serverTime,this.leftTime>0){var n="";e.state==M.Preview?n=GetLanguage(200763):e.state==M.Open?n=GetLanguage(200764):e.state==M.EndShow&&(n=GetLanguage(200765)),this.txtTimeDesc.string=n,this.canUpdate=!0,this.txtLeftTime.string=c.formatStr("%s",p.formatTimeStringForSecond(this.leftTime))}else this.txtLeftTime.string=GetLanguage(200026)}},i}(F));var k=function(e){function i(){for(var t,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(t=e.call.apply(e,[this].concat(n))||this).id=void 0,t.imgSelected=void 0,t.imgLock=void 0,t.txtLevel=void 0,t}t(i,e);var n=i.prototype;return n.onInit=function(){this.imgSelected=u.findChildComponent(this.node,"imgSelected",s),this.imgLock=u.findChildComponent(this.node,"imgLock",s),this.txtLevel=u.findChildComponent(this.node,"txtLevel",l)},n.onRender=function(e,t){this.id=t+1,this.imgSelected.node.active=e.isSelected,this.txtLevel.string=(t+1).toString(),this.imgLock.node.active=e.isLocked},n.onItemClick=function(){this.imgLock.node.active?this.id<=IS(b).act_day?L.showFlyTip(GetLanguage(201214)):L.showFlyTip(m.formatStrWithMirrorDeal(GetLanguage(201212),this.id)):(IS(b).curMoleLevelId=this.id,normalEvent.emit(G.OnTangMoleLevelUpdate,1))},i}(v);i._RF.pop()}}}));

