System.register("chunks:///_virtual/ActivityPoolPartyShotMainView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./StorageUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./BagModel.ts","./MessageView.ts","./RoleDataCache.ts","./ActivityControl.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./ActivityPoolPartyDataCache.ts","./ActivityPoolPartyDefine.ts","./BaseView.ts"],(function(t){"use strict";var e,i,n,o,a,s,d,r,h,l,c,f,v,m,u,p,I,y,L,S,g,C,k,P,T,G;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,n=t.Button,o=t.Label,a=t.ScrollView,s=t.Sprite,d=t.js},function(t){r=t.ItemGrid},function(t){h=t.SelectedType,l=t.ListItem},function(t){c=t.default},function(t){f=t.default},function(t){v=t.default},function(t){m=t.default},null,function(t){u=t.BagModel},function(t){p=t.default},function(t){I=t.RoleDataCache},function(t){y=t.default},function(t){L=t.default},function(t){S=t.ActivityType,g=t.ActivityEventDefine,C=t.ActivityState,k=t.ActivityTaskState},function(t){P=t.default},function(t){T=t.ActivityPoolPartyEvent},function(t){G=t.BaseView}],execute:function(){i._RF.push({},"37a6aygx/RKkJ6sD8GoSOIJ","ActivityPoolPartyShotMainView",void 0);t("default",function(t){function i(){var e;return(e=t.call(this)||this).txtTimeDesc=void 0,e.txtLeftTime=void 0,e.txtDesc=void 0,e.leftTime=0,e.deltaTime=0,e.canUpdate=!1,e.actType=void 0,e.levelList=void 0,e.taskItems=[],e.taskIdGroup=[],e.roundCfg=void 0,e.name="ActivityPoolPartyShotMainView",e.url="ui/module/activityPoolParty/ActivityPoolPartyShotMainView",e.fullScreen=!0,e}e(i,t);var s=i.prototype;return s.onInit=function(){var t=this,e=this.findChild("bottom/btnClose");this.addComponentCallbackListener(e,n.EventType.CLICK,(function(){t.close()}));var i=this.findChild("btnStart");this.addComponentCallbackListener(i,n.EventType.CLICK,(function(){IS(y).send_24_102(S.PoolPartyEndShotGame,IS(P).curLevelId_shot),uiMgr.openView("ActivityPoolPartyShotView")}));var s=this.findChild("bottom/btnGuide");this.addComponentCallbackListener(s,n.EventType.CLICK,(function(){uiMgr.openView("ActivityPoolPartyGameGuideView",1)})),this.txtTimeDesc=this.findChildComponent("top/nodeTime/txtDesc",o),this.txtLeftTime=this.findChildComponent("top/nodeTime/txtTime",o),this.txtDesc=this.findChildComponent("content/nodeReward/nodeDesc/txtDesc",o);var r=this.findChildComponent("content/nodeLevel/ScrollView",a);this.levelList=this.addUIList(r,w,!0),this.levelList.selectedMode=h.SINGLE,this.taskItems=[];for(var l=function(e){var i=t.findChild(d.formatStr("content/task/task%s",e)),a=c.findChild(i,"btnFetch");t.addComponentCallbackListener(a,n.EventType.CLICK,(function(){var i=t.taskIdGroup[IS(P).curLevelId_shot-1][e-1],n=t.roundCfg.task_list[0];IS(y).send_24_15(S.PoolPartyEndShotGame,i,n)}));var s=c.findChild(i,"rewardContent/item");s.active=!1,t.taskItems.push({node:i,index:e,btnFetch:a,nodeHasFetch:c.findChild(i,"hasFetch"),nodeCantFetch:c.findChild(i,"txtCantFetch"),txtDesc:c.findChildComponent(i,"txtDesc",o),nodeRewardItem:s,nodeRewardContent:c.findChild(i,"rewardContent")})},f=1;f<=3;f++)l(f)},s.registerUpdateHandler=function(){this.addEvent(T.OnActivityPoolPartyGameLevelUpdate,this.UpdateLevelList,this),this.addEvent(T.OnActivityPoolPartyGameLevelUpdate,this.OnTaskUpdate,this),this.addEvent(g.OnActivityGameStart,this.GameStart,this),this.addEvent(g.OnActivityInfoUpdate,this.updateTimeInfo,this),this.addEvent(g.OnActivityInfoUpdate,this.OnTaskUpdate,this),this.addEvent(g.OnActivityInfoTaskUpdate,this.OnTaskUpdate,this),this.addEvent(g.OnActivityInfoTaskUpdate,this.UpdateLevelList,this)},s.onAfterOpen=function(){""==f.get("poolpartyshotgame"+IS(I).GetRoleId())&&(this.addTimer(.5,0,(function(){uiMgr.openView("ActivityPoolPartyGameGuideView",1)})),f.set("poolpartyshotgame"+IS(I).GetRoleId(),"1")),IS(y).send_24_14(S.PoolPartyEndShotGame),IS(y).send_24_101(S.PoolPartyEndShotGame),this.updateTimeInfo()},s.onBeforeClose=function(){this.canUpdate=!1},s.onDestroy=function(){},s.onUpdate=function(t){this.canUpdate&&(this.deltaTime=this.deltaTime+t,this.deltaTime>=1&&(this.deltaTime=0,this.leftTime=this.leftTime-1,this.leftTime>0?this.txtLeftTime.string=m.formatTimeStringForSecond(this.leftTime):(this.txtLeftTime.string=GetLanguage(200026),this.canUpdate=!1)))},s.GameStart=function(){uiMgr.openView("ActivityPoolPartyShotView")},s.updateTimeInfo=function(t){if(t||(t=IS(L).GetActivityInfo(S.PoolPartyEndShotGame)),t){var e,i=null!=(e=t.state_time[t.state])?e:t.state_time[C.Open];this.leftTime=i.end_time-m.serverTime,this.leftTime>0?(this.canUpdate=!0,this.txtLeftTime.string=m.formatTimeStringForSecond(this.leftTime)):this.txtLeftTime.string=GetLanguage(200026)}},s.OnTaskUpdate=function(){var t=IS(L).GetActivityInfo(S.PoolPartyEndShotGame);if(t&&t.state!=C.Null){this.roundCfg=IS(L).GetRoundCfg(S.PoolPartyEndShotGame,t.round);var e=[];for(var i in t.task_list)t.task_list.hasOwnProperty(i)&&e.push(t.task_list[i]);e.sort((function(t,e){return t.task_id-e.task_id})),this.taskIdGroup=[];for(var n=e[0].task_id,o=0;o<configArchery_chapter.getDatas().length;o++){var a=[];a.push(n+3*o),a.push(n+3*o+1),a.push(n+3*o+2),this.taskIdGroup.push(a)}this.UpdateTaskItems()}},s.UpdateTaskItems=function(){var t=this.taskIdGroup[IS(P).curLevelId_shot-1],e=IS(L).GetActivityInfo(S.PoolPartyEndShotGame);if(e)for(var i=e.task_list,n=0;n<3;n++){var o=configActivity_task.getDataByKey(t[n]);this.taskItems[n].txtDesc.string=o.desc;var a=i[t[n]].state;this.taskItems[n].btnFetch.active=a==k.CanGet,this.taskItems[n].nodeHasFetch.active=a==k.HadGet,this.taskItems[n].nodeCantFetch.active=a==k.Normal,null==this.taskItems[n].rewardList&&(this.taskItems[n].rewardList=[]);for(var s=o.reward||[],d=0;d<s.length;d++){var r=this.taskItems[n].rewardList[d]?this.taskItems[n].rewardList[d]:this.newRewardItem(this.taskItems[n]);r.itemId=s[d][0],r.itemGrid.SetItemId(s[d][0],s[d][1]),r.node.active=!0,this.taskItems[n].rewardList[d]=r}for(var h=s.length;h<this.taskItems[n].rewardList.length;h++)this.taskItems[n].rewardList[h].node.active=!1}},s.newRewardItem=function(t){var e=nodeInstantiate.instantiate(t.nodeRewardItem);e.parent=t.nodeRewardContent;var i=c.findChild(e,"itemGrid"),n={node:e,itemGrid:new r(this,i,(function(){IS(u).OpenItemTips(n.itemId,i)})),itemId:0};return n},s.UpdateLevelList=function(t){if(void 0===t&&(t=0),!(t>1&&t!=S.PoolPartyEndShotGame)){var e=[],i=configArchery_chapter,n=IS(L).GetActivityInfo(S.PoolPartyEndShotGame);if(n){var o=[],a=[];for(var s in n.task_list)n.task_list.hasOwnProperty(s)&&o.push(n.task_list[s]);for(var d=0;d<i.getDatas().length;d++){a.push(0);for(var r=0;r<3;r++)if(o[3*d+r].state==k.CanGet){a[d]=1;break}}if(1!=t){for(var h=1,l=function(t){return 1==a[t]?(h=t+1,"break"):0==a[t]&&IS(P).openLevelList_shot.some((function(e){return e==t+1}))?(h=t+1,"continue"):void 0},c=0;c<i.getDatas().length;c++){var f=l(c);if("break"===f)break}h>3*IS(P).act_day_shot&&(h=3*IS(P).act_day_shot),IS(P).curLevelId_shot=h,this.levelList.scrollTo(h-1)}this.UpdateTaskItems();for(var v=function(t){var i={isLocked:!IS(P).openLevelList_shot.some((function(e){return e==t+1})),isSelected:t==IS(P).curLevelId_shot-1,red:1==a[t]};e.push(i)},m=0;m<i.getDatas().length;m++)v(m);this.levelList.datas=e}}},i}(G));var w=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).id=void 0,e.imgSelected=void 0,e.imgLock=void 0,e.txtLevel1=void 0,e.txtLevel2=void 0,e.RedPoint=void 0,e}e(i,t);var n=i.prototype;return n.onInit=function(){this.imgSelected=c.findChildComponent(this.node,"imgSelected",s),this.imgLock=c.findChildComponent(this.node,"imgLock",s),this.txtLevel1=c.findChildComponent(this.node,"txtLevel",o),this.txtLevel2=c.findChildComponent(this.node,"imgLock/txtLevel",o),this.RedPoint=c.findChild(this.node,"RedPoint")},n.onRender=function(t,e){this.id=e+1,this.imgSelected.node.active=t.isSelected,this.txtLevel1.string=this.id.toString(),this.txtLevel2.string=this.id.toString(),this.imgLock.node.active=t.isLocked,this.RedPoint.active=t.red},n.onItemClick=function(){this.imgLock.node.active?this.id<=3*IS(P).act_day_shot?p.showFlyTip(GetLanguage(201214)):p.showFlyTip(v.formatStrWithMirrorDeal(GetLanguage(201212),Math.ceil(this.id/3))):(IS(P).curLevelId_shot=this.id,normalEvent.emit(T.OnActivityPoolPartyGameLevelUpdate,1))},i}(l);i._RF.pop()}}}));

