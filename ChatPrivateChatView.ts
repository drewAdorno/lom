System.register("chunks:///_virtual/ChatPrivateChatView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIList.ts","./NodeUtil.ts","./TimeUtil.ts","./index57.ts","./FriendControl.ts","./ChatControl.ts","./ChatDataCache.ts","./ChatDefine.ts","./BaseSubView.ts"],(function(t){"use strict";var i,e,n,o,a,s,h,d,c,l,r,f,m,v,p,C,g,u;return{setters:[function(t){i=t.inheritsLoose},function(t){e=t.cclegacy,n=t.Widget,o=t.Button,a=t.ScrollView,s=t.Sprite,h=t.Label,d=t.js,c=t.Vec3},function(t){l=t.ListItem},function(t){r=t.default},function(t){f=t.default},null,function(t){m=t.default},function(t){v=t.default},function(t){p=t.ChatDataCache},function(t){C=t.ChatEventDefine,g=t.ChatDefine},function(t){u=t.BaseSubView}],execute:function(){e._RF.push({},"194a6M+MV1N9Y973TUBxFNy","ChatPrivateChatView",void 0);t("ChatPrivateChatView",function(t){function e(){var i;return(i=t.call(this)||this).faceNum=12,i.friendBtn=void 0,i.scrollView=void 0,i.widge=void 0,i.emptyNode=void 0,i.name="ChatPrivateChatView",i}i(e,t);var h=e.prototype;return h.onInit=function(){var t=this;this.widge=this.findChildComponent("",n),this.friendBtn=this.findChild("friendBtn"),this.addComponentCallbackListener(this.friendBtn,o.EventType.CLICK,(function(){t.parentView.showPrivateChatType(2)}));var i=this.findChildComponent("ScrollView",a);this.scrollView=this.addUIList(i,I),this.emptyNode=this.findChild("empty"),this.loadIcon(this.findChildComponent("empty/icon",s),"common","pyq_img_mogutuxiang")},h.registerUpdateHandler=function(){this.addEvent(C.UpdateChatFriendInfo,this.UpdateScroll,this),this.addEvent(C.InsertNewMsg,this.UpdateScroll,this),this.addEvent(C.UpdateBlackMsg,this.UpdateScroll,this),this.addEvent(C.UpdateGmList,this.UpdateScroll,this),this.addEvent(C.UpdateGmOpenInfo,this.UpdateScroll,this)},h.onAfterOpen=function(){IS(v).send_customer_service_kf_list_c2s(),this.widge.updateAlignment(),this.scrollView.scrollTo(-1,-1),IS(p).ReqPrivateChatFriend()},h.UpdateScroll=function(t){if(!t||t.channel==g.Channel.Private){var i=IS(p).GetChatFriendInfoList(),e=[],n=new Array;for(var o in i){var a=i[o];null!=a&&null!=a.chat_info&&(a.role_id==g.VIPGmUid?e.push(a):n.push(a))}n.sort((function(t,i){return t.chat_info.time<i.chat_info.time?1:-1}));var s=e.concat(n);this.scrollView.datas=s,this.emptyNode.active=s.length<=0}},h.onBeforeClose=function(){},h.onDestroy=function(){},e}(u));var I=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(i=t.call.apply(t,[this].concat(n))||this).btn=void 0,i.headIcon=void 0,i.imgHeadFrame=void 0,i.lineIcon=void 0,i.name=void 0,i.content=void 0,i.time=void 0,i.noRead=void 0,i.face=void 0,i.faceOriScale=void 0,i.gmHeadIcon=void 0,i.gmIcon=void 0,i.gmBg=void 0,i.bg=void 0,i.poolInfo=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){var t=this;this.btn=r.findChild(this.node,"itemGo"),this.view.addComponentCallbackListener(this.btn,o.EventType.CLICK,(function(){t.view.parentView.showPrivateChatConetnt(t.poolInfo.role_id)})),this.bg=r.findChild(this.node,"itemGo/bg"),this.gmBg=r.findChild(this.node,"itemGo/gmBg"),this.gmIcon=r.findChild(this.node,"itemGo/name/gmIcon"),this.gmHeadIcon=r.findChild(this.node,"itemGo/head/gmIcon"),this.lineIcon=r.findChildComponent(this.node,"itemGo/lineState",s),this.view.addComponentCallbackListener(r.findChild(this.node,"itemGo/head"),o.EventType.CLICK,(function(){t.poolInfo.role_id!=g.VIPGmUid&&IS(m).reqOtherRoleNotice(t.poolInfo.role_id)})),this.headIcon=r.findChildComponent(this.node,"itemGo/head/image",s),this.imgHeadFrame=r.findChildComponent(this.node,"itemGo/head/imgHeadFrame",s),this.name=r.findChildComponent(this.node,"itemGo/name",h),this.content=r.findChildComponent(this.node,"itemGo/content",h),this.face=r.findChildComponent(this.node,"itemGo/face",s),this.time=r.findChildComponent(this.node,"itemGo/time",h),this.faceOriScale=this.face.node.scale,this.noRead=r.findChildComponent(this.node,"itemGo/noRead",h)},n.onRender=function(t,i){if(this.poolInfo=t,this.poolInfo.role_id==g.VIPGmUid){this.gmBg.active=!0,this.gmIcon.active=!0,this.gmHeadIcon.active=!0,this.bg.active=!1;var e=IS(p).GetVipGmRed();this.noRead.string=e>0?d.formatStr("【%s】",e):"";var n=IS(p).GetKfList();n&&n[0]&&1==n[0].online_state?this.lineIcon.grayscale=!1:this.lineIcon.grayscale=!0}else this.bg.active=!0,this.gmBg.active=!1,this.gmIcon.active=!1,this.gmHeadIcon.active=!1,this.noRead.string=this.poolInfo.num>0?d.formatStr("【%s】",this.poolInfo.num):"",this.lineIcon.grayscale=0==this.poolInfo.is_online;this.name.string=this.poolInfo.name,this.view.loadRemoteIcon(this.poolInfo.head.url,this.headIcon);var o=this.poolInfo.chat_info.content;if(o.length>=13&&(o=o.substring(0,13)+"..."),this.poolInfo.chat_info.type==g.ChatContentType.Face){this.face.node.active=!0,this.content.node.active=!1;var a=IS(p).GetFaceIconByContent(this.poolInfo.chat_info.content),s=a[0],h=a[1],l=this.faceOriScale.y*h.scale;this.face.node.scale=new c(l,l,l),this.view.loadIcon(this.face,"icon_chat",s)}else this.content.node.active=!0,this.face.node.active=!1,this.poolInfo.chat_info.type==g.ChatContentType.Pic?this.content.string=GetLanguage(200179):this.content.string=o;this.time.string=f.getDateDiff(this.poolInfo.chat_info.time);var r=this.poolInfo.head.frame_id;if(r>0){this.imgHeadFrame.node.active=!0;var m=configAvatar_frame.getDataByKey(r);this.view.loadIcon(this.imgHeadFrame,"icon_frame",m.icon)}else this.imgHeadFrame.node.active=!1},e}(l);e._RF.pop()}}}));

