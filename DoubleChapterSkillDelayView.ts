System.register("chunks:///_virtual/DoubleChapterSkillDelayView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./NodeUtil.ts","./StringUtil.ts","./BaseView.ts","./MessageView.ts","./EquipDefine.ts","./SkillControl.ts","./SkillDataCache.ts","./SkillModel.ts","./ChapterDataCache.ts","./ChapterDefine.ts","./DungeonControl.ts"],(function(t){"use strict";var e,i,n,l,o,a,s,d,r,h,c,u,f,C,p,v,k,y,m,S,g;return{setters:[function(t){e=t.inheritsLoose,i=t.createForOfIteratorHelperLoose},function(t){n=t.cclegacy,l=t.math,o=t.Button,a=t.sys,s=t.HorizontalTextAlignment,d=t.js,r=t.Sprite,h=t.Label},function(t){c=t.default},function(t){u=t.default},function(t){f=t.BaseView},function(t){C=t.default},function(t){p=t.EquipEventDefine},function(t){v=t.default},function(t){k=t.SkillDataCache},function(t){y=t.SkillModel},function(t){m=t.ChapterDataCache},function(t){S=t.ChapterEventDefine},function(t){g=t.default}],execute:function(){n._RF.push({},"15ac89hSyxJrKjYxf4P9rXc","DoubleChapterSkillDelayView",void 0);l.Vec3,l.Vec2,t("default",function(t){function n(){var e;return(e=t.call(this)||this).delayList=[],e.openType=void 0,e.skillItems=void 0,e.name="DoubleChapterSkillDelayView",e.url="ui/module/dungeon/DoubleChapterSkillDelayView",e}e(n,t);var l=n.prototype;return l.onInit=function(){var t=this,e=this.findChild("imgMask");this.addComponentCallbackListener(e,o.EventType.CLICK,(function(){t.onMaskClick()}));var i=this.findChild("content/btnOk");this.addComponentCallbackListener(i,o.EventType.CLICK,(function(){t.onOkClick()}));var n=this.findChild("content/btnCancel");this.addComponentCallbackListener(n,o.EventType.CLICK,(function(){t.close()})),this.delayList=[];for(var l=0;l<6;l++){var u=this.findChild("content/conditions/view/content/item"+(l+1));this.delayList[l]=new I(this,u,l+1)}var f=this.findChild("content/btnTip");this.addComponentCallbackListener(f,o.EventType.CLICK,(function(){C.showBoxTip({tip:GetLanguage(204922),btnCnt:1,horizontalAlign:a.uiMirror?s.RIGHT:s.LEFT})})),this.skillItems=new Array;for(var p=function(e){var i=t.findChild(d.formatStr("content/wearParentSkill/item%s",e)),n={node:i,index:e,imgFrame:i.getComponent(r),nodeSkill:c.findChild(i,"nodeWear"),imgIcon:c.findChildComponent(i,"nodeWear/imgIcon",r),txtLevel:c.findChildComponent(i,"nodeWear/txtLevel",h)};t.adjustMirrorNode(n.node,0,!1,.5),t.adjustMirrorNode(n.nodeSkill,0,!1,.5),t.skillItems.push(n),t.addComponentCallbackListener(i,o.EventType.CLICK,(function(){t.onSkillClick(e)}))},v=1;v<=6;v++)p(v)},l.registerUpdateHandler=function(){this.addEvent(p.AUTO_OPEN_CONDITION_CHANGE,this.onConditionChange,this),this.addEvent(S.DOUBLE_CHAPTER_GET_TEAMMATE_SKILL_DELAY_BACK,this.onDoubleChapterGetTeammateSkillDelayBack,this)},l.onConditionChange=function(t){if("delay"==t.typeStr){var e=this.delayList[t.listIdx-1];e.delay=t.selectValue,e.updateSelect()}},l.onDoubleChapterGetTeammateSkillDelayBack=function(t){1!=this.openType&&(this.updateInfo(t.set_delay_time),this.showSkills(t.skill_list))},l.showSkills=function(t){for(var e={},i=0;i<t.length;i++)t[i]&&t[i].skill_id>0&&(e[t[i].pos_id]=t[i]);for(var n=0;n<this.skillItems.length;n++){var l=this.skillItems[n],o=e[n+1];if(o){l.skill=o,l.nodeSkill.active=!0;var a=configSkill.getDataByKey(o.skill_id);this.loadIcon(l.imgFrame,"icon_skill",d.formatStr("common_ICON_jinengkuang0%s",a.quality)),this.loadIcon(l.imgIcon,"icon_skill",a.icon),l.txtLevel.string=d.formatStr("Lv.%s",o.skill_lv)}else l.skill=null,l.nodeSkill.active=!1,this.loadIcon(l.imgFrame,"icon_skill","common_ICON_jinengwenhao")}},l.onAfterOpen=function(){var t,e;if(this.openType=null!=(t=this.openArgs[0])?t:1,1==this.openType){var i,n=IS(k).tabToInfo[IS(k).curTab];e=null!=(i=null==n?void 0:n.delay_time_list)?i:[],this.updateInfo(e),this.showSkills(IS(y).getActiveSkillList())}else IS(g).reqDoubleChapterGetTeammateSkillDelayTime(IS(m).doubleChapterInfo.teammate_id)},l.updateInfo=function(t){function e(e){for(var n,l=i(t);!(n=l()).done;){var o=n.value;if(o.k==e)return o.v}return 0}for(var n=0;n<this.delayList.length;++n){var l=this.delayList[n];l.delay=e(n+1),l.updateSelect()}},l.onBeforeClose=function(){},l.onDestroy=function(){},l.onMaskClick=function(){this.close()},l.onOkClick=function(){for(var t,e=[],n=i(this.delayList);!(t=n()).done;){var l=t.value;e.push(l.delay)}if(1==this.openType)IS(v).reqSetSkillDelay(IS(k).curTab,e);else{for(var o=[],a=0;a<e.length;a++){var s={k:a+1,v:e[a]};o.push(s)}IS(g).reqDoubleChapterSetTeammateSkillDelayTime(IS(m).doubleChapterInfo.teammate_id,o)}this.close()},l.onSkillClick=function(t){var e=this.skillItems[t-1];if(null!=e.skill){var i=configSkill_level.getDataByKeys("id",e.skill.skill_id,"level",e.skill.skill_lv);uiMgr.openView("JobSkillTipsView",u.formatStr.apply(u,[i.desc].concat(i.desc_parm)),e.node)}},n}(f));var I=function(){function t(t,e,i){this.view=void 0,this.node=void 0,this.btnDelay=void 0,this.txtCondition=void 0,this.nodeUp=void 0,this.nodeDown=void 0,this.id=void 0,this.delay=void 0,this.node=e,this.view=t,this.id=i,this.onInit()}var e=t.prototype;return e.onInit=function(){var t=this;this.btnDelay=c.findChild(this.node,"btnDelay"),this.txtCondition=c.findChildComponent(this.btnDelay,"txtSelect",h),this.nodeUp=c.findChild(this.btnDelay,"imgUp"),this.nodeDown=c.findChild(this.btnDelay,"imgDown"),this.view.addComponentCallbackListener(this.btnDelay,o.EventType.CLICK,(function(){var e={typeStr:"delay",listIdx:t.id,targetNode:t.btnDelay,selectValue:t.delay};t.nodeDown.active=!1,t.nodeUp.active=!0,uiMgr.openView("EquipConditionListView",e)}))},e.updateSelect=function(){this.txtCondition.string=0==this.delay?GetLanguage(600001091):u.formatStr(GetLanguage(600001092),this.delay/1e3)},t}();n._RF.pop()}}}));

