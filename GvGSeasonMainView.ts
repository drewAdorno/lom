System.register("chunks:///_virtual/GvGSeasonMainView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./TimeUtil.ts","./BaseView.ts","./MessageView.ts","./GvGControl.ts","./GvGDefine.ts"],(function(t){"use strict";var n,i,e,o,s,a,h,r,d,c,f,l,u;return{setters:[function(t){n=t.inheritsLoose},function(t){i=t.cclegacy,e=t.Button,o=t.Label,s=t.js,a=t.Sprite,h=t.sys,r=t.Layout},function(t){d=t.default},function(t){c=t.BaseView},function(t){f=t.default},function(t){l=t.default},function(t){u=t.GvGEventDefine}],execute:function(){i._RF.push({},"95c4d3Dh9RHk6tQlBwJBex/","GvGSeasonMainView",void 0);t("default",function(t){function i(){var n;return(n=t.call(this)||this).txtTime=void 0,n.time=0,n.curInfo=void 0,n.txtSeasonIndex=void 0,n.rankingTitleItems=void 0,n.imgRank=void 0,n.txtPoint=void 0,n.nodeNeedPointDesc=void 0,n.txtNeedPoint=void 0,n.txtSeasonRank=void 0,n.txtSeasonFight=void 0,n.txtSeasonWin=void 0,n.txtSeasonWinRate=void 0,n.name="GvGSeasonMainView",n.url="ui/module/gvg/GvGSeasonMainView",n}n(i,t);var c=i.prototype;return c.onInit=function(){var t=this,n=this.findChild("content/btnClose");this.addComponentCallbackListener(n,e.EventType.CLICK,(function(){t.close()})),this.txtTime=this.findChildComponent("content/desc/descContent/txtTime",o);var i=this.findChild("content/info/btnTip");this.addComponentCallbackListener(i,e.EventType.CLICK,(function(){f.showBoxTip({tip:GetLanguage(201646),btnCnt:1})})),this.txtSeasonIndex=this.findChildComponent("content/title/titleNum/txtTitle",o),this.rankingTitleItems=new Array;for(var d=1;d<=4;d++)this.rankingTitleItems.push({ranking:d,node:this.findChild(s.formatStr("content/rank/imgRankTitle/title%s",d))});this.imgRank=this.findChildComponent("content/rank/imgRank",a),this.txtPoint=this.findChildComponent("content/info/point/txtPoint",o),this.txtNeedPoint=this.findChildComponent("content/info/needPoint/txtNeedPoint",o),this.txtSeasonRank=this.findChildComponent("content/info/seasonRank/txtSeasonRank",o),this.txtSeasonFight=this.findChildComponent("content/info/seasonFight/txtSeasonFight",o),this.txtSeasonWin=this.findChildComponent("content/info/seasonWin/txtSeasonWin",o),this.txtSeasonWinRate=this.findChildComponent("content/info/seasonWinRate/txtSeasonWinRate",o),this.nodeNeedPointDesc=this.findChild("content/info/needPoint/txtNeedPointDesc");var c=this.findChild("content/bottomBtns/btnDetail");this.addComponentCallbackListener(c,e.EventType.CLICK,(function(){uiMgr.openView("GvGSeasonDetailView")}));var l=this.findChild("content/bottomBtns/btnRank");this.addComponentCallbackListener(l,e.EventType.CLICK,(function(){uiMgr.openView("GvGSeasonRankView")}));var u=this.findChild("content/bottomBtns/btnHall");this.addComponentCallbackListener(u,e.EventType.CLICK,(function(){uiMgr.openView("GvGSeasonHallView")})),h.uiMirror&&(this.dealMirrorLayout(this.findChildComponent("content/desc/descContent",r)),this.loadIcon(c.getComponent(a),"icon_gvg","gvg_icon_xiangqing"),this.loadIcon(l.getComponent(a),"icon_gvg","gvg_icon_paihang"),this.loadIcon(u.getComponent(a),"icon_gvg","gvg_icon_diantang"))},c.registerUpdateHandler=function(){this.addEvent(u.GVG_SEASON_INFO_BACK,this.onGvGSeasonInfoBack,this)},c.onAfterOpen=function(){IS(l).reqGvGSeasonInfo()},c.updateInfo=function(){this.txtSeasonIndex.string=s.formatStr("%s%s",GetLanguage_UI(999000222),this.curInfo.season),this.txtPoint.string=this.curInfo.score,this.txtSeasonRank.string=this.curInfo.rank,this.txtSeasonFight.string=this.curInfo.battle_times,this.txtSeasonWin.string=this.curInfo.win_times,this.txtSeasonWinRate.string=this.curInfo.battle_times<=0?"---":s.formatStr("%s%",(100*this.curInfo.win_times/this.curInfo.battle_times).toFixed(1));var t=this.curInfo.ranking,n=configFamiliybrawl_rank.getDataByKey(t);this.updateRankingTitleShow(t),this.loadIcon(this.imgRank,"icon_gvg",n.rank_picture);var i=t>=configFamiliybrawl_rank.getDatas().length;this.nodeNeedPointDesc.active=!i,this.txtNeedPoint.node.active=!i,i||(this.txtNeedPoint.string=String(Math.max(0,configFamiliybrawl_rank.getDataByKey(t+1).point_require-this.curInfo.score)))},c.updateRankingTitleShow=function(t){for(var n=0;n<this.rankingTitleItems.length;n++)this.rankingTitleItems[n].node.active=this.rankingTitleItems[n].ranking==t},c.onUpdate=function(t){this.time=this.time+t,this.time>=1&&(this.updateTime(),this.time=0)},c.updateTime=function(){if(this.curInfo){var t=this.curInfo.end_time,n=d.serverTime;this.txtTime.string=d.formatTimeStringForSecond(Math.max(0,t-n))}},c.onBeforeClose=function(){this.time=0,this.curInfo=null},c.onDestroy=function(){},c.onGvGSeasonInfoBack=function(t){this.curInfo=t,this.updateInfo()},i}(c));i._RF.pop()}}}));

