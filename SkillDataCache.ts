System.register("chunks:///_virtual/SkillDataCache.ts",["cc","./AudioMgr.ts","./RedPointMgr.ts","./index57.ts","./ConfigGlobal.ts","./ObjectUtil.ts","./BagDefine.ts","./CommonDefine.ts","./RoleDataCache.ts","./RoleDefine.ts","./SkillDefine.ts","./SkillModel.ts","./UIDefine.ts"],(function(i){"use strict";var t,e,l,n,o,s,a,r,S,u,d,p,k,h,f;return{setters:[function(i){t=i.cclegacy,e=i.js},function(i){l=i.audioMgr},function(i){n=i.RedPointMgr},null,function(i){o=i.ConfigGlobal},function(i){s=i.default},function(i){a=i.BagEventDefine,r=i.GoodsType},function(i){S=i.CommonEventDefine},function(i){u=i.RoleDataCache},function(i){d=i.RoleEventDefine},function(i){p=i.SKILLEventDefine},function(i){k=i.SkillModel},function(i){h=i.OpenFunction,f=i.PanelTabType}],execute:function(){t._RF.push({},"52995ZTAdhHTLC7WwYjRmek","SkillDataCache",void 0);var c=o.skill_system;i("SkillDataCache",function(){var i=t.prototype;function t(){this.activePosIdToInfo=void 0,this.passiveSkillList=void 0,this.systemSkillIdToInfo=void 0,this.curTab=1,this.tabToInfo={},this.skillIdToAttr=void 0,this.activePosIdToInfo={},this.passiveSkillList=[],this.systemSkillIdToInfo={},this.skillIdToAttr={},normalEvent.on(a.GOODS_INFO_UPDATE,this.onGoodsInfoUpdate,this),normalEvent.on(d.ROLE_OPEN_FUNCTION_UPDATE,this.onRoleOpenFunctionUpdate,this)}return i.clear=function(){normalEvent.off(a.GOODS_INFO_UPDATE,this.onGoodsInfoUpdate,this),normalEvent.off(d.ROLE_OPEN_FUNCTION_UPDATE,this.onRoleOpenFunctionUpdate,this)},i.onGoodsInfoUpdate=function(i,t){var l=configGoods.getDataByKey(t);null!=l?l.type==r.Skill&&(this.updateAllUpgradeRedPoint(),this.updateAllComposeRedPoint()):printLogErr(e.formatStr("没有该道具配置-> %s",t))},i.onRoleOpenFunctionUpdate=function(i){i==h.FUNC_SKILL&&(this.updateAllSkillEquipRedPoint(),this.updateAllUpgradeRedPoint(),this.updateAllComposeRedPoint())},i.updateActiveSkillList=function(i,t){if(null!=i){for(var e,l=0;l<i.length;l++){var n=!1,o=i[l];e=o.pos_id,null!=this.activePosIdToInfo[e]||t||(n=!0),this.activePosIdToInfo[e]=o,1!=t&&(normalEvent.emit(p.ACTIVE_SKILL_INFO_UPDATE,e),n&&normalEvent.emit(p.ACTIVE_SKILL_POS_UNLOCK,e))}1!=t&&normalEvent.emit(p.ACTIVE_SKILL_LIST_UPDATE)}},i.initPassiveSkillList=function(i){null!=i&&(this.passiveSkillList=i)},i.updatePassiveSkillList=function(i){if(null!=i){for(var t={},e=0;e<i.length;e++){var l=i[e];t[l.skill_id]=l}for(var n,o={},a=0;a<this.passiveSkillList.length;a++)n=this.passiveSkillList[a].skill_id,s.isEmpty(t[n])||(this.passiveSkillList[a]=t[n],o[n]=!0,normalEvent.emit(p.PASSIVE_SKILL_INFO_UPDATE,n));for(var r in t)1!=o[Number(r)]&&this.passiveSkillList.push(t[r])}},i.deletePassiveSkillList=function(i){if(null!=i){for(var t={},e=0;e<i.length;e++){t[i[e].skill_id]=!0}for(var l=this.passiveSkillList.length-1;l>=0;l--)1==t[this.passiveSkillList[l].skill_id]&&this.passiveSkillList.splice(l,1)}},i.updateSystemSkills=function(i,t,e){if(null!=i){for(var n,o,a,r=new Array,S=0;S<i.length;S++){var u=i[S];n=u.skill_id;var d=this.systemSkillIdToInfo[n];1!=s.isEmpty(d)&&(o=d.skill_lv),this.systemSkillIdToInfo[n]=u,0==(a=u.skill_lv)&&(this.systemSkillIdToInfo[n]=null),1!=t&&(normalEvent.emit(p.SYSTEM_SKILL_INFO_UPDATE,n),e&&2==e&&r.push({skillId:n,oriLevel:o,nowLevel:a}))}1!=t&&normalEvent.emit(p.SYSTEM_SKILL_LIST_UPDATE),r.length>0&&l.playSound("common_qianghua"),r.length>0&&null==uiMgr.getOpenView("SkillInfoView")&&uiMgr.openView("SkillUpgradeFinishView",r)}},i.updateSkillUpgradeRedPoint=function(i){IS(n).changeValue(e.formatStr("MainView/tab-%s/tab-%s/upgrade/skill-%s",f.Main_Role,f.Role_Skill,i),this.getSkillUpgradeRedPoint(i))},i.getSkillUpgradeRedPoint=function(i){return IS(u).CheckFuncOpen(h.FUNC_SKILL)&&IS(k).checkSkillCanUpgrade(i)?1:0},i.updateSkillUpgradeRootRedPoint=function(){IS(n).changeValue(e.formatStr("MainView/tab-%s/tab-%s/upgrade",f.Main_Role,f.Role_Skill),this.getAllSkillUpgradeRedPoint()),IS(n).changeValue(e.formatStr("MainView/tab-%s/tab-%s",f.Main_Role,f.Role_Skill),this.getAllSkillEquipRedPoint()+this.getAllSkillUpgradeRedPoint()+this.getAllSkillComposeRedPoint()),normalEvent.emit(S.UPDATE_MAIN_ROLE_RED_POINT)},i.updateAllUpgradeRedPoint=function(){for(var i=0;i<c.length;i++)this.updateSkillUpgradeRedPoint(c[i]);this.updateSkillUpgradeRootRedPoint()},i.getAllSkillUpgradeRedPoint=function(){if(!IS(u).CheckFuncOpen(h.FUNC_SKILL))return 0;for(var i=0,t=0;t<c.length;t++)i+=this.getSkillUpgradeRedPoint(c[t]);return i},i.updateSkillEquipRedPoint=function(i){IS(n).changeValue(e.formatStr("MainView/tab-%s/tab-%s/equip/pos-%s",f.Main_Role,f.Role_Skill,i),this.getSkillEquipRedPoint(i))},i.getSkillEquipRedPoint=function(i){return IS(u).CheckFuncOpen(h.FUNC_SKILL)&&IS(k).checkPosUnlock(i)&&this.checkHasNoWearSkill()&&(null==IS(k).getActiveSkillByPos(i)||0==IS(k).getActiveSkillByPos(i).skill_id)?1:0},i.checkHasNoWearSkill=function(){for(var i in this.systemSkillIdToInfo)if(IS(k).checkSkillCanShow(Number(i))&&0==IS(k).getSkillWearPos(Number(i)))return!0;return!1},i.updateSkillEquipRootRedPoint=function(){IS(n).changeValue(e.formatStr("MainView/tab-%s/tab-%s/equip",f.Main_Role,f.Role_Skill),this.getAllSkillEquipRedPoint()),IS(n).changeValue(e.formatStr("MainView/tab-%s/tab-%s",f.Main_Role,f.Role_Skill),this.getAllSkillEquipRedPoint()+this.getAllSkillUpgradeRedPoint()+this.getAllSkillComposeRedPoint()),normalEvent.emit(S.UPDATE_MAIN_ROLE_RED_POINT)},i.getAllSkillEquipRedPoint=function(){if(!IS(u).CheckFuncOpen(h.FUNC_SKILL))return 0;var i=0;for(var t in this.activePosIdToInfo)i+=this.getSkillEquipRedPoint(Number(t));return i},i.updateAllSkillEquipRedPoint=function(){for(var i in this.activePosIdToInfo)this.updateSkillEquipRedPoint(Number(i));this.updateSkillEquipRootRedPoint()},i.updateSkillComposeRedPoint=function(i){IS(n).changeValue(e.formatStr("MainView/tab-%s/tab-%s/compose/skill-%s",f.Main_Role,f.Role_Skill,i),this.getSkillComposeRedPoint(i))},i.getSkillComposeRedPoint=function(i){return IS(u).CheckFuncOpen(h.FUNC_SKILL)&&IS(k).checkSkillCanCompose(i)?1:0},i.updateSkillComposeRootRedPoint=function(){IS(n).changeValue(e.formatStr("MainView/tab-%s/tab-%s/compose",f.Main_Role,f.Role_Skill),this.getAllSkillComposeRedPoint()),IS(n).changeValue(e.formatStr("MainView/tab-%s/tab-%s",f.Main_Role,f.Role_Skill),this.getAllSkillEquipRedPoint()+this.getAllSkillUpgradeRedPoint()+this.getAllSkillComposeRedPoint()),normalEvent.emit(S.UPDATE_MAIN_ROLE_RED_POINT)},i.updateAllComposeRedPoint=function(){for(var i=0;i<c.length;i++)this.updateSkillComposeRedPoint(c[i]);this.updateSkillComposeRootRedPoint()},i.getAllSkillComposeRedPoint=function(){if(!IS(u).CheckFuncOpen(h.FUNC_SKILL))return 0;for(var i=0,t=0;t<c.length;t++)i+=this.getSkillComposeRedPoint(c[t]);return i},i.updateSkillAttrInfo=function(i,t){if(!(null==t||t.length<=0)){this.skillIdToAttr[i]||(this.skillIdToAttr[i]={});for(var e=0;e<t.length;e++)this.skillIdToAttr[i][t[e].k]=t[e].v;normalEvent.emit(p.SKILL_ATTR_UPDATE,i)}},t}());t._RF.pop()}}}));

