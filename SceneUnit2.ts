System.register("chunks:///_virtual/SceneUnit2.ts",["./rollupPluginModLoBabelHelpers.js","cc","./V2.ts","./UIList.ts","./NodeUtil.ts","./ItemIcon.ts","./UIEffectAsset.ts","./PolyNavAgent.ts","./MessageView.ts","./ParkingControl.ts","./ParkingDataCache.ts","./ParkingDefine.ts"],(function(n){"use strict";var t,e,i,o,s,c,a,d,r,f,h,l,p,u,C,v,I,y,g,m,b,k,x,P,_,E;return{setters:[function(n){t=n.createClass,e=n.inheritsLoose,i=n.createForOfIteratorHelperLoose,o=n.assertThisInitialized},function(n){s=n.cclegacy,c=n.Vec3,a=n.UITransform,d=n.Vec2,r=n.isValid,f=n.Button,h=n.Rect,l=n.Sprite,p=n.math,u=n.ScrollView,C=n.Node},function(n){v=n.V2},function(n){I=n.ListItem},function(n){y=n.default},function(n){g=n.IconAseetType},function(n){m=n.UIEffectAsset},function(n){b=n.PolyNavAgent},function(n){k=n.default},function(n){x=n.default},function(n){P=n.ParkingDataCache},function(n){_=n.ParkingEventDefine,E=n.DEC_TYPE}],execute:function(){s._RF.push({},"6fb310v55BMKpp7y8Ndpp45","SceneUnit",void 0);var T=60,S=60,V=n("SceneUnit",function(){function n(){this.id=void 0,this.uid=0,this.del=!1,this.isDestroy=!1,this.effect=void 0,this.rect=new h}var e=n.prototype;return e.update=function(n){this.del||this.onUpdate(n)},e.destroy=function(){this.isDestroy||(this.isDestroy=!0,this.del=!0,this.onDestroy())},t(n,[{key:"effectPosition",get:function(){return this.effect&&this.effect.node?this.effect.node.position:new v(0,0)}}]),n}()),D=(n("SceneDec",function(n){function s(t,e){var i,s,d;return(d=n.call(this)||this).map=void 0,d.effect=void 0,d.btnConfirm=void 0,d.btnCancel=void 0,d.nodeCheck=void 0,d.btnIcon=void 0,d.boxScroll=void 0,d.imgIcon=void 0,d.agent=void 0,d.lastValidPos=void 0,d.baseInfo=void 0,d.boxOC=[2,3],d.map=t,d.baseInfo=e,d.agent=new b(t.polyNav),d.effect=m.alloc("ui/module/parking/scene/DecUnit",t.nodeUnit,-1,(function(n){var i;d.imgIcon=y.findChildComponent(n.node,"decIcon",l);var s=configParking_design.getDataByKey(e.id);t.view.loadIcon(d.imgIcon,"parking_dec",s.path,(function(){var n=d.imgIcon.node.getComponent(a).contentSize.clone(),t=new p.Size(n.x*s.scaling,n.y*s.scaling);d.imgIcon.node.getComponent(a).contentSize=t,d.effect.node.getComponent(a).contentSize=t,d.nodeCheck.getComponent(a).contentSize=t;var e=s.pos_occupy,i=new c(T*e[0]/2-t.x/2,S*e[1]/2-t.y/2,0);d.imgIcon.node.setPosition(i)}),g.ICON_SPRITE),d.nodeCheck=y.findChild(n.node,"nodeCheck"),d.nodeCheck.active=d.map.modingDecID==d.baseInfo.id,d.btnConfirm=y.findChild(n.node,"nodeCheck/btnComfirm"),d.btnConfirm.on(f.EventType.CLICK,d.onClickConfirm,o(d)),d.btnCancel=y.findChild(n.node,"nodeCheck/btnCancel"),d.btnCancel.on(f.EventType.CLICK,d.onClickCancel,o(d)),d.btnIcon=y.findChild(n.node,"decIcon"),d.btnIcon.getComponent(f).enabled=d.map.modingDecID==d.baseInfo.id;var r=y.findChildComponent(n.node,"ScrollView",u);r.node.active=!1,d.boxScroll=d.map.view.addUIList(r,D,!1),d.map.modingDecID==d.baseInfo.id&&(r.node.active=!0,d.boxScroll.touchEvent=!0,t.view.addComponentCallbackListener(d.nodeCheck,C.EventType.TOUCH_MOVE,(function(n){d.onTouchMoveHandle(n)})),t.view.addComponentCallbackListener(d.nodeCheck,C.EventType.TOUCH_END,(function(n){d.onTouchEndHandle(n)})),t.view.addComponentCallbackListener(d.nodeCheck,C.EventType.TOUCH_START,(function(n){n.getLocation()}))),d.lastValidPos=null!=(i=e.pos)?i:new c(0,0,0),d.attachPos()})),d.position=null!=(i=e.pos)?i:new c(0,0,0),d.id="Dec:"+e.id,d.boxOC=null!=(s=configParking_design.getDataByKey(e.id).pos_occupy)?s:[1,1],d}e(s,n);var h=s.prototype;return h.onUpdate=function(n){},h.onTouchMoveHandle=function(n){var t=n.getLocation(),e=new c(t.x,t.y,0),i=this.map.mapCamera.camera.screenToWorld(e);i.add3f(2e3,0,0);var o=this.btnIcon.getComponent(a).contentSize;i.add3f(-o.x/2,-o.y,0);var s=this.effect.node.position;i.z=s.z,this.refreshValidBox(i),this.effect.node.position=i},h.checkValidPos=function(n){if(this.lastValidPos=n,!this.map.polyNav.pointIsValid(n))return!1;if(!this.map.polyNav.pointIsValid(new c(n.x,n.y+S*this.boxOC[1],n.z)))return!1;if(!this.map.polyNav.pointIsValid(new c(n.x+T*this.boxOC[0],n.y,n.z)))return!1;if(!this.map.polyNav.pointIsValid(new c(n.x+T*this.boxOC[0],n.y+S*this.boxOC[1],n.z)))return!1;if(!this.map.polyNav.pointIsValid(new c(n.x+T*this.boxOC[0]/2,n.y+S*this.boxOC[1]/2,n.z)))return!1;if(!this.map.polyNav.pointIsValid(new c(n.x+T*this.boxOC[0]/2,n.y+S*this.boxOC[1],n.z)))return!1;if(!this.map.polyNav.pointIsValid(new c(n.x+T*this.boxOC[0]/2,n.y,n.z)))return!1;if(!this.map.polyNav.pointIsValid(new c(n.x+T*this.boxOC[0],n.y+S*this.boxOC[1]/2,n.z)))return!1;if(!this.map.polyNav.pointIsValid(new c(n.x,n.y+S*this.boxOC[1]/2,n.z)))return!1;for(var t,e=[],o=i(IS(P).getUsingFreeDec());!(t=o()).done;){var s=t.value;if(s.skin_id!=this.baseInfo.id){var a=new d(s.x,s.y),r=configParking_design.getDataByKey(s.skin_id).pos_occupy;e.push([a.x,a.y,T*r[1],S*r[0]])}}for(var f=[n.x,n.y,T*this.boxOC[0],S*this.boxOC[1]],h=!1,l=0,p=e;l<p.length;l++){var u=p[l];this.checkIntersection(f,u)&&(h=!0)}return!h},h.checkIntersection=function(n,t){var e=Math.abs(n[0]-t[0])<(n[2]+t[2])/2,i=Math.abs(n[1]-t[1])<(n[3]+t[3])/2;return e&&i},h.refreshValidBox=function(n){for(var t=[],e=0;e<4;e++)for(var i=0;i<4;i++)e<this.boxOC[1]&&i<this.boxOC[0]?t.push(this.checkValidPos(n)?1:2):t.push(0);this.boxScroll.datas=t},h.attachPos=function(){var n=this.lastValidPos,t=new c(Math.round(n.x/T)*T,Math.round(n.y/S)*S,n.z);this.refreshValidBox(t),this.effect.node.position=t},h.onTouchEndHandle=function(n){this.attachPos()},h.onClickIcon=function(){this.map.modingDecID==this.baseInfo.id&&(this.nodeCheck.active=!0)},h.onClickConfirm=function(){this.checkValidPos(this.lastValidPos)?(normalEvent.emit(_.PARKING_SKIN_PREVIEW_STATUS,2),normalEvent.emit(_.PARKING_SKIN_PREVIEW_CLICK_TYPE,this.id),IS(x).reqParkSkinUse(0,this.baseInfo.id,1,{x:this.lastValidPos.x,y:this.lastValidPos.y})):k.showFlyTip(GetLanguage(202029))},h.onClickCancel=function(){normalEvent.emit(_.PARKING_SKIN_PREVIEW_STATUS,2),normalEvent.emit(_.PARKING_SKIN_PREVIEW_CLICK_TYPE,this.id)},h.onDestroy=function(){r(this.btnConfirm)&&this.btnConfirm.off(f.EventType.CLICK,this.onClickConfirm,this),r(this.btnCancel)&&this.btnCancel.off(f.EventType.CLICK,this.onClickCancel,this),r(this.btnIcon)&&this.btnIcon.off(f.EventType.CLICK,this.onClickIcon,this),this.effect.free()},t(s,[{key:"position",get:function(){return this.effect.position},set:function(n){this.effect.position=n}},{key:"depth",get:function(){return this.effect.depth},set:function(n){this.effect.depth=n}}]),s}(V)),n("FixedSceneDec",function(n){function i(t,e){var i,o;return(o=n.call(this)||this).map=void 0,o.effect=void 0,o.imgIcon=void 0,o.map=t,o.effect=m.alloc("ui/module/parking/scene/FixedDecUnit",t.nodeUnitFix,-1,(function(n){o.imgIcon=y.findChildComponent(n.node,"decIcon",l);var i=configParking_design.getDataByKey(e.id),s=i.path;e.type==E.TYPE_SPOT?s=i.park_pos[e.groupIndex-1]:e.type==E.TYPE_STAGE?s=i.park_stage:e.type==E.TYPE_BOARD&&(s=i.admin_path),t.view.loadIcon(o.imgIcon,"parking_dec",s,null,g.ICON_SPRITE),e.scale&&(o.imgIcon.node.scale=e.scale)})),o.position=null!=(i=e.pos)?i:new d(0,0),o.id="Dec:"+e.id,o}e(i,n);var o=i.prototype;return o.onUpdate=function(n){},o.onDestroy=function(){this.effect.free()},t(i,[{key:"position",get:function(){return this.effect.position},set:function(n){this.effect.position=n}},{key:"depth",get:function(){return this.effect.depth},set:function(n){this.effect.depth=n}}]),i}(V)),function(n){function t(){for(var t,e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return(t=n.call.apply(n,[this].concat(i))||this).red=void 0,t.green=void 0,t}e(t,n);var i=t.prototype;return i.onInit=function(){this.red=y.findChild(this.node,"red"),this.green=y.findChild(this.node,"green")},i.onRender=function(n,t){this.node.active=0!=n,this.red.active=2==n,this.green.active=1==n},t}(I));s._RF.pop()}}}));

