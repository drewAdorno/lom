System.register("chunks:///_virtual/RelicEditView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./NodeUtil.ts","./StringUtil.ts","./BaseView.ts","./ItemIcon.ts","./ObjectUtil.ts","./BagModel.ts","./MessageView.ts","./RoleDefine.ts","./RelicControl.ts","./RelicDataCache.ts","./RelicDefine.ts","./RelicModel.ts"],(function(t){"use strict";var e,i,n,o,s,c,d,l,h,a,r,u,f,C,p,I,g,R,v,m,S;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,n=t.Button,o=t.Label,s=t.Sprite,c=t.Vec3,d=t.Color,l=t.js},function(t){h=t.default},function(t){a=t.default},function(t){r=t.BaseView},function(t){u=t.IconAseetType},function(t){f=t.default},function(t){C=t.BagModel},function(t){p=t.default},function(t){I=t.PlayerAttr,g=t.RoleEventDefine},function(t){R=t.default},function(t){v=t.RelicDataCache},function(t){m=t.RelicEventDefine},function(t){S=t.RelicModel}],execute:function(){i._RF.push({},"18905RgPsFBSLlQnulrN19i","RelicEditView",void 0);t("default",function(t){function i(){var e;return(e=t.call(this)||this).txtTitle=void 0,e.imgResIcon=void 0,e.txtResNum=void 0,e.imgIcon=void 0,e.txtLevel=void 0,e.txtWearDesc=void 0,e.txtOwnDesc=void 0,e.nodeBtnUpgrade=void 0,e.txtCost=void 0,e.imgCostIcon=void 0,e.nodeBtnEquip=void 0,e.nodeBtnGoTo=void 0,e.nodeHasEquip=void 0,e.nodeRP=void 0,e.txtTypeName=void 0,e.relicItems=void 0,e.selectType=void 0,e.curSelectCfgId=void 0,e.curSelectId=void 0,e.curNeedCost=void 0,e.cfgIds=void 0,e.nodeGroupContent=void 0,e.curTab=void 0,e.name="RelicEditView",e.url="ui/module/relic/RelicEditView",e}e(i,t);var r=i.prototype;return r.onInit=function(){var t=this,e=this.findChild("imgMask");this.addComponentCallbackListener(e,n.EventType.CLICK,(function(){t.onMaskClick()}));var i=this.findChild("root/content/btnClose");this.addComponentCallbackListener(i,n.EventType.CLICK,(function(){t.onCloseClick()}));var c=configGoods.getDataByKey(I.ROLE_RELIC_FRAG);this.txtTitle=this.findChildComponent("root/content/title/txtTitle",o),this.txtResNum=this.findChildComponent("root/content/res/txtNum",o),this.imgResIcon=this.findChildComponent("root/content/res/imgIcon",s),this.loadIcon(this.imgResIcon,"icon_item",c.icon);var d=this.findChild("root/content/btnPrev");this.addComponentCallbackListener(d,n.EventType.CLICK,(function(){t.onPrevClick()}));var a=this.findChild("root/content/btnNext");this.addComponentCallbackListener(a,n.EventType.CLICK,(function(){t.onNextClick()})),this.imgIcon=this.findChildComponent("root/content/imgIcon",s),this.txtLevel=this.findChildComponent("root/content/txtLevel",o),this.txtWearDesc=this.findChildComponent("root/content/desc/txtDesc",o),this.txtOwnDesc=this.findChildComponent("root/content/desc/effect/txtOwnDesc",o),this.nodeRP=this.findChild("root/content/buttons/btnUpgrade/nodeRP"),this.nodeBtnUpgrade=this.findChild("root/content/buttons/btnUpgrade"),this.addComponentCallbackListener(this.nodeBtnUpgrade,n.EventType.CLICK,(function(){t.onUpgradeClick()})),this.txtCost=this.findChildComponent("root/content/buttons/btnUpgrade/txtCost",o),this.imgCostIcon=this.findChildComponent("root/content/buttons/btnUpgrade/imgCost",s),this.loadIcon(this.imgCostIcon,"icon_item",c.icon),this.nodeBtnEquip=this.findChild("root/content/buttons/btnEquip"),this.addComponentCallbackListener(this.nodeBtnEquip,n.EventType.CLICK,(function(){t.onEquipClick()})),this.nodeBtnGoTo=this.findChild("root/content/buttons/btnGoTo"),this.addComponentCallbackListener(this.nodeBtnGoTo,n.EventType.CLICK,(function(){t.onGoToClick()})),this.nodeHasEquip=this.findChild("root/content/buttons/imgHasEquip"),this.txtTypeName=this.findChildComponent("root/content/group/txtTitle",o),this.nodeGroupContent=this.findChild("root/content/group/parent/scroll/view/content"),this.relicItems=new Array;for(var r=function(e){var i=t.findChild(l.formatStr("root/content/group/parent/scroll/view/content/item%s",e));t.addComponentCallbackListener(i,n.EventType.CLICK,(function(){t.onRelicClick(e-1)})),t.relicItems.push({node:i,imgBg:h.findChildComponent(i,"imgBg",s),imgIcon:h.findChildComponent(i,"imgIcon",s),nodeSelect:h.findChild(i,"imgSelect"),nodeEquip:h.findChild(i,"imgEquip"),nodeRP:h.findChild(i,"nodeRP")});var o=h.findChildComponent(i,"imgEquip",s);t.loadIcon(o,"relic","yw_ui_shiyongzhong")},u=1;u<=5;u++)r(u)},r.registerUpdateHandler=function(){this.addEvent(g.ROLE_RES_UPDATE,this.onRoleResUpdate,this),this.addEvent(m.RELIC_INFO_UPDATE,this.onRelicInfoUpdate,this),this.addEvent(m.RELIC_LIST_UPDATE,this.onRelicListUpdate,this),this.addEvent(m.RELIC_TAB_INFO_UPDATE,this.onRelicTabInfoUpdate,this)},r.onAfterOpen=function(){this.nodeGroupContent.position=new c(0,0,0),this.selectType=this.openArgs[0],this.curTab=this.openArgs[1];var t=configRelic_pos.getDataByKey(this.selectType);this.txtTypeName.string=t.name,this.cfgIds=IS(S).getCfgIdsBytype(this.selectType),this.cfgIds.sort((function(t,e){return t<e?-1:1}));var e=IS(S).getRelicInfoByTabAndLocation(this.curTab,this.selectType);this.curSelectCfgId=f.isEmpty(e)?this.cfgIds[0]:e.cfg_id,this.updateRelicItemsShow(),this.updateRelicItemsSelect(),this.updateSelectInfo(),this.updateResNum(),this.updateRelicRed()},r.updateRelicItemsShow=function(){for(var t=0;t<this.relicItems.length;t++)this.updateSingleRelic(t)},r.updateRelicItemsSelect=function(){for(var t=0;t<this.relicItems.length;t++)this.relicItems[t].nodeSelect.active=this.cfgIds[t]==this.curSelectCfgId},r.updateRelicRed=function(){for(var t=0;t<this.relicItems.length;t++)this.relicItems[t].nodeRP.active=IS(v).checkCanUpgradeById(this.cfgIds[t])},r.updateSingleRelic=function(t){var e=this.relicItems[t],i=this.cfgIds[t],n=IS(S).getRelicInfoByCfgId(i),o=f.isEmpty(n);e.imgBg.color=o?new d(122,122,122):new d(255,255,255),e.imgIcon.color=o?new d(122,122,122):new d(255,255,255);var s=configRelic.getDataByKeys("id",i,"level",o?1:n.lv);this.loadIcon(e.imgIcon,"icon_relic",s.icon,null,u.ICON_SPRITE);var c=IS(S).getRelicInfoByTabAndLocation(this.curTab,this.selectType);e.nodeEquip.active=c&&c.cfg_id==i},r.updateSelectInfo=function(){var t=IS(S).getRelicInfoByCfgId(this.curSelectCfgId),e=f.isEmpty(t);e||(this.curSelectId=t.id);var i=configRelic.getDataByKeys("id",this.curSelectCfgId,"level",e?1:t.lv);this.txtTitle.string=i.name,this.loadIcon(this.imgIcon,"icon_relic",i.icon,null,u.ICON_SPRITE),this.imgIcon.color=e?new d(122,122,122):new d(255,255,255),this.txtLevel.string=e?GetLanguage(200573):l.formatStr("Lv.%s",t.lv),this.txtOwnDesc.string=a.formatStr.apply(a,[i.desc].concat(i.desc_parm));var n=i.equip,o=configSkill_level.getDataByKeys("id",n[0],"level",n[1]);this.txtWearDesc.string=a.formatStr.apply(a,[o.desc].concat(o.desc_parm)),this.nodeBtnGoTo.active=e;var s=e?i:configRelic.getDataByKeys("id",this.curSelectCfgId,"level",t.lv+1);this.nodeBtnUpgrade.active=!e&&!f.isEmpty(s),this.curNeedCost=0,f.isEmpty(s)||(this.curNeedCost=i.cost[0][1],this.txtCost.string=String(this.curNeedCost)),this.updateCostStatus();var c=IS(S).getRelicInfoByTabAndLocation(this.curTab,this.selectType),h=c&&c.cfg_id==this.curSelectCfgId;this.nodeBtnEquip.active=!e&&!h,this.nodeHasEquip.active=!e&&h},r.onRelicInfoUpdate=function(t){this.curSelectId&&t==this.curSelectId&&this.updateSelectInfo()},r.onRelicListUpdate=function(){this.updateRelicItemsShow(),this.updateRelicRed()},r.onRelicTabInfoUpdate=function(t){t==this.curTab&&this.updateSelectInfo()},r.updateResNum=function(){this.txtResNum.string=IS(C).getGoodsCountByGoodsGtid(I.ROLE_RELIC_FRAG)},r.updateCostStatus=function(){if(0!=this.curNeedCost){var t=IS(C).getGoodsCountByGoodsGtid(I.ROLE_RELIC_FRAG)>=this.curNeedCost;this.txtCost.color=t?new d(74,157,62):new d(204,81,68),this.nodeRP.active=t}},r.onBeforeClose=function(){},r.onDestroy=function(){},r.onRoleResUpdate=function(t){t==I.ROLE_RELIC_FRAG&&(this.updateResNum(),this.updateCostStatus(),IS(v).checkUpgradeCount(),this.updateRelicRed())},r.onMaskClick=function(){this.close()},r.onCloseClick=function(){this.close()},r.onPrevClick=function(){var t=this.cfgIds.indexOf(this.curSelectCfgId)-1;t<0&&(t=this.cfgIds.length-1),this.curSelectCfgId=this.cfgIds[t],this.updateRelicItemsSelect(),this.updateSelectInfo()},r.onNextClick=function(){var t=this.cfgIds.indexOf(this.curSelectCfgId)+1;t>=this.cfgIds.length&&(t=0),this.curSelectCfgId=this.cfgIds[t],this.updateRelicItemsSelect(),this.updateSelectInfo()},r.onUpgradeClick=function(){if(this.curSelectId)return IS(C).getGoodsCountByGoodsGtid(I.ROLE_RELIC_FRAG)<this.curNeedCost?(uiMgr.openView("ItemGetWayView",I.ROLE_RELIC_FRAG),void p.showFlyTip(GetLanguage(200574))):void IS(R).reqRelicLevelUp(this.curSelectId)},r.onEquipClick=function(){this.curSelectId&&(this.curTab==IS(v).curTab?IS(R).reqRelicEquip(this.curSelectId):IS(R).reqRelicChangeTabInfo(this.curTab,[{k:this.selectType,v:this.curSelectCfgId}]))},r.onGoToClick=function(){this.close()},r.onRelicClick=function(t){this.curSelectCfgId=this.cfgIds[t],this.updateRelicItemsSelect(),this.updateSelectInfo()},i}(r));i._RF.pop()}}}));

