System.register("chunks:///_virtual/ChapterWorldBossCC.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BattleData.ts","./ChapterWorldBoss.ts","./EnumDefine.ts","./EventDefine.ts","./CameraMgr.ts","./ChapterDataCache.ts","./ChapterDefine.ts","./DungeonControl.ts","./MessageView.ts","./RoleDataCache.ts"],(function(t){"use strict";var n,e,s,o,a,i,r,u,h,l,c,f,p,C;return{setters:[function(t){n=t.inheritsLoose,e=t.regeneratorRuntime},function(t){s=t.cclegacy},function(t){o=t.ChapterType},function(t){a=t.ChapterWorldBoss},function(t){i=t.BattleFlag,r=t.BindType},function(t){u=t.EventDefine},function(t){h=t.cameraMgr},function(t){l=t.ChapterDataCache},function(t){c=t.ChapterEventDefine},function(t){f=t.default},function(t){p=t.default},function(t){C=t.RoleDataCache}],execute:function(){s._RF.push({},"485459sr51AA41AUkbN6m1N","ChapterWorldBossCC",void 0);t("ChapterWorldBossCC",function(t){function s(){for(var n,e=arguments.length,s=new Array(e),o=0;o<e;o++)s[o]=arguments[o];return(n=t.call.apply(t,[this].concat(s))||this).selfRank=-1,n}n(s,t);var a=s.prototype;return a.init=function(){battleEvent.on(u.UnitHpNumChange,this.onUnitHpNumChange,this),battleEvent.on(u.BossHpChange,this.onBossHpChange,this),h.battleCamera.enabled=!0,battleMain.battleFlag=i.LIMIT_SKILL|i.OPEN_GRAPHIC},a.destroy=function(){battleEvent.off(u.UnitHpNumChange,this.onUnitHpNumChange,this),battleEvent.off(u.BossHpChange,this.onBossHpChange,this)},a.start=function(){t.prototype.start.call(this),battleEvent.emit(u.WorldBossRank,this)},a.onBossHpChange=function(t,n){var e=this,s=IS(l).worldBossRank;-1==this.selfRank?s.push({id:this.bossUnit.unitId,name:IS(C).GetRoleName(),hurt:this.bossUnit.hurtNum}):s[this.selfRank].hurt=this.bossUnit.hurtNum,s.sort((function(t,n){return n.hurt-t.hurt})),this.selfRank=s.findIndex((function(t){return t.id==e.bossUnit.unitId})),battleEvent.emit(u.WorldBossRank,this)},a.onUnitHpNumChange=function(n){t.prototype.onUnitHpNumChange.call(this,n),battleMain.renderMgr.allocEffect(50115).position=this.bossUnit.getBindPos(r.bp_bottom)},a.endResult=e().mark((function t(n,s,a){return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,coroutine.wait(1);case 2:battleMain.enterChapter(),battleMain.curRecord&&battleMain.curRecord.manual?IS(f).reqDungeonBattleResult(o.WorldBoss,n,s,1,battleMain.curRecord.collects,[{k:1,v:this.bossUnit.hpNum},{k:2,v:this.bossUnit.hurtNum}]):IS(f).reqDungeonBattleResult(o.WorldBoss,n,s,0,null,[{k:1,v:this.bossUnit.hpNum},{k:2,v:this.bossUnit.hurtNum}]),normalEvent.emit(c.BATTLE_STATE,o.WorldBoss,!1),battleMain.toResult(n,o.WorldBoss,s,a);case 6:case"end":return t.stop()}}),t,this)})),a.toResult=function(t,n){void 0===n&&(n=!1);var e=this.battleMain,s=this.config;0==t&&e.checkCheat()&&(t=1,p.showBoxTip({tip:GetLanguage(200998),btnCnt:1,func:function(t){},ensure:GetLanguage(200129)})),e.runningToPart=!0,coroutine.start(this.endResult(s.id,t,n),"battle")},s}(a));s._RF.pop()}}}));

