System.register("chunks:///_virtual/WingSkinView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./index57.ts","./ItemIcon.ts","./BagModel.ts","./WingControl.ts","./WingDataCache.ts","./WingDefine.ts","./BaseSubView.ts"],(function(i){"use strict";var t,n,e,o,s,h,a,l,d,r,c,f,g,k,I,S,v,C,u,m,p,b,_,w;return{setters:[function(i){t=i.inheritsLoose,n=i.createForOfIteratorHelperLoose},function(i){e=i.cclegacy,o=i.Button,s=i.ScrollView,h=i.UITransform,a=i.Node,l=i.Vec3,d=i.sys,r=i.Layout,c=i.Label,f=i.Sprite,g=i.js},function(i){k=i.ItemGrid},function(i){I=i.SelectedType,S=i.ListItem},function(i){v=i.default},function(i){C=i.default},null,function(i){u=i.IconAseetType},function(i){m=i.BagModel},function(i){p=i.default},function(i){b=i.WingDataCache},function(i){_=i.WingEvent},function(i){w=i.BaseSubView}],execute:function(){e._RF.push({},"4fbc16JKYxCv666nveHX9kL","WingSkinView",void 0);i("default",function(i){function e(){var t;return(t=i.call(this)||this).nodeRoot=void 0,t.btnUnlock=void 0,t.btnUse=void 0,t.btnCancel=void 0,t.btnLeft=void 0,t.btnRight=void 0,t.nodeItem=void 0,t.nodeTop=void 0,t.WingUIList=void 0,t.starUIList=void 0,t.imgFrame=void 0,t.imgIcon=void 0,t.wingEffectID=0,t.btnUseSkill=void 0,t.btnNoUseSkill=void 0,t.btnUpgrade=void 0,t.showSkinId=void 0,t.iconOriPos=void 0,t.skinIDSel=void 0,t.starInfo=[],t.wingInfo=[],t.name="WingSkinView",t.url="ui/module/wing/WingSkinView",t.poolTime=3e3,t}t(e,i);var S=e.prototype;return S.onInit=function(){var i=this;this.nodeRoot=this.findChild("root"),this.btnUnlock=this.findChild("root/btnUnlock"),this.addComponentCallbackListener(this.btnUnlock,o.EventType.CLICK,(function(){IS(p).send_wing_skin_level_up_c2s(i.skinIDSel)})),this.addComponentCallbackListener(this.findChild("root/previewBtn"),o.EventType.CLICK,(function(){IS(p).previewBattle(i.skinIDSel)})),this.btnUseSkill=this.findChild("root/nodeSkill/btnUse"),this.addComponentCallbackListener(this.btnUseSkill,o.EventType.CLICK,(function(){IS(p).send_wing_skill_use_c2s(i.skinIDSel)})),this.btnUpgrade=this.findChild("root/nodeSkill/btnUpgrade"),this.addComponentCallbackListener(this.btnUpgrade,o.EventType.CLICK,(function(){uiMgr.openView("WingUpgradeInfoView",i.skinIDSel,IS(b).getSkinLevelByID(i.skinIDSel))})),this.btnNoUseSkill=this.findChild("root/nodeSkill/btnNoUse"),this.addComponentCallbackListener(this.btnNoUseSkill,o.EventType.CLICK,(function(){IS(p).send_wing_skill_use_c2s(0)})),this.btnCancel=this.findChild("root/nodeShow/btnCancel"),this.addComponentCallbackListener(this.btnCancel,o.EventType.CLICK,(function(){IS(p).send_wing_use_c2s(0)})),this.btnUse=this.findChild("root/nodeShow/btnUse"),this.addComponentCallbackListener(this.btnUse,o.EventType.CLICK,(function(){IS(p).send_wing_use_c2s(i.skinIDSel)})),this.btnLeft=this.findChild("root/nodeShow/btnLeft"),this.addComponentCallbackListener(this.btnLeft,o.EventType.CLICK,(function(){for(var t,e=n(i.wingInfo);!(t=e()).done;){var o=t.value;if(o.skin==i.skinIDSel){i.skinIDSel=i.wingInfo[i.wingInfo.indexOf(o)-1].skin;break}}i.refreshAll()})),this.btnRight=this.findChild("root/nodeShow/btnRight"),this.addComponentCallbackListener(this.btnRight,o.EventType.CLICK,(function(){for(var t,e=n(i.wingInfo);!(t=e()).done;){var o=t.value;if(o.skin==i.skinIDSel){i.skinIDSel=i.wingInfo[i.wingInfo.indexOf(o)+1].skin;break}}i.refreshAll()}));var t=this.findChildComponent("root/ScrollView",s);this.WingUIList=this.addUIList(t,D),this.WingUIList.selectedMode=I.SINGLE;var e=this.findChildComponent("root/nodeShow/ScrollView",s);this.starUIList=this.addUIList(e,y),this.nodeItem=this.findChild("root/item"),this.nodeTop=this.findChild("root/nodeTop");var c=this.findChild("root/nodeSkill/ScrollView/view/content/item"),f=this.findChildComponent("root/nodeSkill/ScrollView/view/content",h);c.on(a.EventType.SIZE_CHANGED,(function(){f.height=c.getComponent(h).height}));var g=this.findChild("root/nodeShow/icon");this.iconOriPos=new l(g.position.x,g.position.y,0),d.uiMirror&&(this.dealMirrorLayout(this.findChildComponent("root/nodeChange/common_ui_xiaotidi",r)),this.dealMirrorLayout(this.findChildComponent("root/nodeSkill/common_ui_xiaotidi",r)))},S.rebuildWingList=function(){var i=configBack_skin.getDataByList("skin_level",0),t=0;this.wingInfo=[];for(var e,o=n(i.entries());!(e=o()).done;){var s=e.value,h=(s[0],s[1]);if(IS(b).checkWingCanShow(h.back_id)){var a=IS(b).getSkinLevelByID(h.back_id);this.wingInfo.push({skin:h.back_id,level:a,state:IS(b).getWingState(h.back_id)})}}this.wingInfo.sort((function(i,t){return i.state>t.state?-1:1}));for(var l,d=n(this.wingInfo.entries());!(l=d()).done;){var r=l.value,c=r[0];r[1].skin==this.skinIDSel&&(t=c)}return t},S.onAfterOpen=function(){this.showSkinId=null,this.rebuildWingList(),this.skinIDSel=this.wingInfo[0].skin,this.refreshAll()},S.refreshAll=function(){this.refreshWingShow(),this.refreshWingSkill(),this.refreshWingAttr(),this.refreshWingChange(),this.refreshItemNum(),this.refreshUseSkillBtn()},S.registerUpdateHandler=function(){this.addEvent(_.TYPE_WING_CHANGE,this.onSkinStateChange,this),this.addEvent(_.TYPE_WING_SKIN_EFFECT_SEL,this.onRefreshWingSel,this),this.addEvent(_.TYPE_WING_USE_SKILL,this.refreshUseSkillBtn,this)},S.refreshItemNum=function(){var i=this.findChildComponent("root/nodeItem/Label",c),t=IS(m).getGoodsCountByGoodsGtid(1);i.string=""+t},S.refreshUseSkillBtn=function(){IS(b).getSkinLevelByID(this.skinIDSel)<=0?(this.btnUseSkill.active=!1,this.btnNoUseSkill.active=!1):(this.btnUseSkill.active=IS(b).skill_use!=this.skinIDSel,this.btnNoUseSkill.active=IS(b).skill_use==this.skinIDSel)},S.onSkinStateChange=function(){IS(b).getSkinLevelByID(this.skinIDSel)?this.btnUse.active=!0:this.btnUse.active=!1,this.skinIDSel==IS(b).wing_id?this.btnCancel.active=!0:this.btnCancel.active=!1,this.refreshWingShow(),this.refreshWingSkill(),this.refreshWingAttr(),this.refreshItemNum(),this.refreshUseSkillBtn()},S.refreshWingSkill=function(){var i=v.findChildComponent(this.nodeRoot,"nodeSkill/Frame",f),t=v.findChildComponent(this.nodeRoot,"nodeSkill/Icon",f),n=v.findChildComponent(this.nodeRoot,"nodeSkill/txtName",c),e=v.findChildComponent(this.nodeRoot,"nodeSkill/ScrollView/view/content/item",c),o=configBack_skin.getDataByKeys("back_id",this.skinIDSel,"skin_level",IS(b).getSkinLevelByID(this.skinIDSel));0==o.skin_skill.length&&(o=configBack_skin.getDataByKeys("back_id",this.skinIDSel,"skin_level",IS(b).getSkinLevelByID(this.skinIDSel)+1));var s=configSkill.getDataByKey(o.skin_skill[0][0]),h=IS(b).getSkinLevelByID(this.skinIDSel);h?h<10&&(this.btnUpgrade.active=!0):this.btnUpgrade.active=!1,this.loadIcon(i,"icon_skill",g.formatStr("common_ICON_jinengkuang0%s",s.quality)),this.loadIcon(t,"icon_skill",s.icon,null,u.ICON_SPRITE),n.string=s.name;var a=configSkill_level.getDataByKeys("id",o.skin_skill[0][0],"level",o.skin_skill[0][1]);e.string=C.formatStr.apply(C,[a.desc].concat(a.desc_parm))},S.refreshWingShow=function(){if(this.showSkinId!=this.skinIDSel){this.showSkinId=this.skinIDSel;var i=this.findChild("root/nodeShow/icon"),t=this.findChildComponent("root/nodeShow/bgName/txtName",c);this.removeUIEffect(this.wingEffectID),this.wingEffectID=this.addUIEffect(configBack_decoration.getDataByKey(this.skinIDSel).path,i,-1,null,1,(function(i){d.uiMirror&&(i.dir=-1)}));var n=configBack_decoration.getDataByKey(this.skinIDSel);t.string=n.name,i.position=new l(this.iconOriPos.x,0!=n.back_location_adjust?n.back_location_adjust:this.iconOriPos.y,0)}var e=this.rebuildWingList();this.WingUIList.datas=this.wingInfo,this.WingUIList.scrollTo(e),this.starInfo=[0,0,0,0,0];for(var o=0;o<IS(b).getSkinLevelByID(this.skinIDSel);o++){var s=o%5;this.starInfo[s]+=1}this.starUIList.datas=this.starInfo},S.onRefreshWingSel=function(i){this.skinIDSel!=i&&(this.skinIDSel=i,this.refreshAll())},S.refreshWingAttr=function(){var i=this.findChildComponent("root/nodeChange/txtBase",c),t=this.findChildComponent("root/nodeChange/txtNext",c),n=this.findChildComponent("root/nodeChange/txtEffect",c),e=configBack_skin.getDataByKeys("back_id",this.skinIDSel,"skin_level",IS(b).getSkinLevelByID(this.skinIDSel)),o=configBack_skin.getDataByKeys("back_id",this.skinIDSel,"skin_level",IS(b).getSkinLevelByID(this.skinIDSel)+1),s=this.findChild("root/nodeChange/txtNext"),h=this.findChild("root/nodeChange/Sprite"),a=this.findChildComponent("root/btnUnlock/txtLabel",c);if(null==e.expend||0==e.expend.length)a.string=GetLanguage(200127),n.string=configAttribute.getDataByKey(Number(e.attr[0][0])).name+":",i.string=e.attr[0][1]/100+"%",s.active=!1,h.active=!1,this.nodeItem.active=!1,this.btnUnlock.active=!1,this.btnUpgrade.active=!1,this.nodeTop.active=!0;else{s.active=!0,h.active=!0,this.nodeItem.active=!0,this.btnUnlock.active=!0,this.nodeTop.active=!1,new k(this,this.nodeItem).SetItemId(e.expend[0][0],0);var l=IS(m).getGoodsCountByGoodsGtid(e.expend[0][0]),d=e.expend[0][1];this.findChildComponent("root/item/txtNext",c).string=l+"/"+d,n.string=configAttribute.getDataByKey(Number(o.attr[0][0])).name+":",null==e.attr||0==e.attr.length?(i.string="0%",t.string=o.attr[0][1]/100+"%",a.string=GetLanguage(200101)):(i.string=e.attr[0][1]/100+"%",t.string=o.attr[0][1]/100+"%",a.string=GetLanguage(200128))}},S.refreshWingChange=function(){if(this.checkPageBtn(),this.showSkinId!=this.skinIDSel){this.showSkinId=this.skinIDSel;var i=this.findChild("root/nodeShow/icon"),t=this.findChildComponent("root/nodeShow/txtName",c);this.removeUIEffect(this.wingEffectID),this.wingEffectID=this.addUIEffect(configBack_decoration.getDataByKey(this.skinIDSel).path,i,-1,null,1,(function(i){d.uiMirror&&(i.dir=-1)}));var n=configBack_decoration.getDataByKey(this.skinIDSel);t.string=n.name}},S.checkPageBtn=function(){this.btnLeft.active=!0,this.btnRight.active=!0;for(var i,t=n(this.wingInfo);!(i=t()).done;){var e=i.value;e.skin==this.skinIDSel&&(0==this.wingInfo.indexOf(e)&&(this.btnLeft.active=!1),this.wingInfo.indexOf(e)==this.wingInfo.length-1&&(this.btnRight.active=!1))}IS(b).getSkinLevelByID(this.skinIDSel)?this.btnUse.active=!0:this.btnUse.active=!1,this.skinIDSel==IS(b).wing_id?this.btnCancel.active=!0:this.btnCancel.active=!1},S.onBeforeClose=function(){this.wingEffectID&&(this.removeUIEffect(this.wingEffectID),this.wingEffectID=null)},S.onDestroy=function(){},e}(w));var D=function(i){function n(){for(var t,n=arguments.length,e=new Array(n),o=0;o<n;o++)e[o]=arguments[o];return(t=i.call.apply(i,[this].concat(e))||this).imgFrame=void 0,t.imgIcon=void 0,t.imgLock=void 0,t.imgRP=void 0,t.nodeUse=void 0,t.nodeSel=void 0,t}t(n,i);var e=n.prototype;return e.onInit=function(){this.imgFrame=v.findChildComponent(this.node,"frame",f),this.imgIcon=v.findChildComponent(this.node,"icon",f),this.imgLock=v.findChild(this.node,"lock"),this.imgRP=v.findChild(this.node,"rp"),this.nodeUse=v.findChild(this.node,"nodeUse"),this.nodeSel=v.findChild(this.node,"sel")},e.onRender=function(i,t){this.data=i;var n=configBack_decoration.getDataByKey(this.data.skin).icon_small,e=configBack_decoration.getDataByKey(this.data.skin).quality,o=configColor.getDataByKey(e).path;this.view.loadIcon(this.imgFrame,"icon_equip",o),this.view.loadIcon(this.imgIcon,"icon_item",n),this.checkState();var s=this.view;this.nodeSel.active=s.skinIDSel==this.data.skin},e.checkState=function(){this.imgLock.active=!1,this.imgRP.active=!1,this.imgFrame.grayscale=!1,this.imgIcon.grayscale=!1,this.nodeUse.active=!1,1==this.data.state?(this.imgLock.active=!0,this.imgFrame.grayscale=!0,this.imgIcon.grayscale=!0):(5==this.data.state||IS(b).GetWingCanUp(this.data.skin))&&(this.imgRP.active=!0),this.data.skin==IS(b).wing_id&&(this.nodeUse.active=!0)},e.onItemClick=function(){normalEvent.emit(_.TYPE_WING_SKIN_EFFECT_SEL,this.data.skin)},n}(S),y=function(i){function n(){for(var t,n=arguments.length,e=new Array(n),o=0;o<n;o++)e[o]=arguments[o];return(t=i.call.apply(i,[this].concat(e))||this).imgOne=void 0,t.imgTwo=void 0,t.imgThree=void 0,t.imgDark=void 0,t}t(n,i);var e=n.prototype;return e.onInit=function(){this.imgOne=v.findChild(this.node,"one"),this.imgTwo=v.findChild(this.node,"two"),this.imgThree=v.findChild(this.node,"three"),this.imgDark=v.findChild(this.node,"dark")},e.onRender=function(i,t){this.imgDark.active=0==i,this.imgOne.active=1==i,this.imgTwo.active=2==i,this.imgThree.active=3==i},e.onItemClick=function(){},n}(S);e._RF.pop()}}}));

