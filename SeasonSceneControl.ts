System.register("chunks:///_virtual/SeasonSceneControl.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BattleData.ts","./BattleDataFill.ts","./SLGMapData.ts","./ControlMgr.ts","./ChapterDataCache.ts","./ChapterDefine.ts","./ChatControl.ts","./ChatDefine.ts","./SeasonDataCache.ts","./SeasonDefine.ts","./SeasonSceneDataCache.ts"],(function(e){"use strict";var n,t,s,a,_,o,i,r,c,d,l,f,S,p,u,v,E,g,h,m;return{setters:[function(e){n=e.createForOfIteratorHelperLoose},function(e){t=e.cclegacy,s=e.Vec2},function(e){a=e.ChapterType,_=e.PlayerData,o=e.BattleData},function(e){i=e.BattleDataFill},function(e){r=e.SLGMapData},function(e){c=e.controlMgr},function(e){d=e.ChapterDataCache},function(e){l=e.ChapterEventDefine},function(e){f=e.default},function(e){S=e.ChatDefine},function(e){p=e.SeasonDataCache},function(e){u=e.SeasonEventDefine,v=e.RoleUpdateFlag,E=e.SceneObjType,g=e.MoveUpdateFlag,h=e.SeasonBattleResultType},function(e){m=e.SeasonSceneDataCache}],execute:function(){t._RF.push({},"5f2ebSP/OJM6Z7BW0aoXzri","SeasonSceneControl",void 0);var M=new s;e("default",function(){var e=t.prototype;function t(){netManager.addEventListener("s1.s1_grid_list_s2c",this.on_scene_obj_add_s2c,this),netManager.addEventListener("s1.s1_move_list_s2c",this.on_s1_move_list_s2c,this),netManager.addEventListener("s1.s1_grid_del_s2c",this.on_scene_obj_del_s2c,this),netManager.addEventListener("s1.s1_move_del_s2c",this.on_s1_move_del_s2c,this),netManager.addEventListener("s1.s1_enter_s2c",this.on_scene_enter_s2c,this),netManager.addEventListener("s1.s1_quit_s2c",this.on_s1_quit_s2c,this),netManager.addEventListener("s1.s1_attack_info_s2c",this.on_s1_attack_info_s2c,this),netManager.addEventListener("s1.s1_defend_info_s2c",this.on_s1_defend_info_s2c,this),netManager.addEventListener("s1.s1_defend_detail_s2c",this.on_s1_defend_detail_s2c,this),netManager.addEventListener("s1.s1_team_info_s2c",this.on_s1_team_info_s2c,this),netManager.addEventListener("s1.s1_role_info_s2c",this.on_s1_role_info_s2c,this),netManager.addEventListener("s1.s1_video_s2c",this.on_s1_video_s2c,this),netManager.addEventListener("s1.s1_battle_reports_s2c",this.on_s1_battle_reports_s2c,this),netManager.addEventListener("s1.s1_reward_s2c",this.on_s1_reward_s2c,this),netManager.addEventListener("s1.s1_share_info_s2c",this.on_s1_share_info_s2c,this),netManager.addEventListener("s1.s1_air_drop_info_s2c",this.on_s1_air_drop_info_s2c,this),netManager.addEventListener("s1.s1_monster_info_s2c",this.on_s1_monster_info_s2c,this),netManager.addEventListener("s1.s1_relic_result_s2c",this.on_s1_relic_result_s2c,this),netManager.addEventListener("s1.s1_relic_detail_s2c",this.on_s1_relic_detail_s2c,this),netManager.addEventListener("s1.s1_locate_s2c",this.on_s1_locate_s2c,this),netManager.addEventListener("s1.s1_defend_result_s2c",this.on_s1_defend_result_s2c,this),netManager.addEventListener("s1.s1_monster_result_s2c",this.on_s1_monster_result_s2c,this),netManager.addEventListener("s1.s1_mini_map_s2c",this.on_s1_mini_map_s2c,this),netManager.addEventListener("s1.s1_empire_occupy_s2c",this.on_s1_empire_occupy_s2c,this),netManager.addEventListener("s1.s1_emoji_s2c",this.on_s1_emoji_s2c,this),netManager.addEventListener("s1.s1_search_s2c",this.on_s1_search_s2c,this),netManager.addEventListener("s1.s1_bounty_s2c",this.on_s1_bounty_s2c,this),c.addControl(this)}return e.clear=function(){printLog("SeasonSceneControl")},e.onLogin=function(){IS(m).clearActions()},e.onReconnect=function(){1==IS(m).currenSceneType&&(IS(m).clearActions(),IS(f).reqChatHistory(S.Channel.SeasonMapBattle),IS(f).reqChatHistory(S.Channel.SeasonMap),IS(m).isChatHistory=!0,netManager.send("s1.s1_reconnect_c2s",{}),uiMgr.getOpenView("SeasonMapSceneView")||uiMgr.openView("SeasonMapSceneView"))},e.reqEnter=function(){netManager.send("s1.s1_enter_c2s",{}),IS(m).isChatHistory||(IS(f).reqChatHistory(S.Channel.SeasonMapBattle),IS(f).reqChatHistory(S.Channel.SeasonMap),IS(m).isChatHistory=!0)},e.reqSceneView=function(e){var n=IS(m).viewPos;if(e.x!=n.x||e.y!=n.y){var t={x:e.x,y:e.y};IS(m).viewPos=t,netManager.send("s1.s1_view_c2s",{pos:t})}},e.reqMove=function(e,n,t){n&&(n.x=Math.floor(n.x),n.y=Math.floor(n.y)),netManager.send("s1.s1_move_c2s",{action:e,pos:n,sweep_times:t})},e.reqBattleResult=function(e,n){netManager.send("scene.scene_battle_over_c2s",{})},e.reqQuit=function(){IS(m).currenSceneType=0,netManager.send("s1.s1_quit_c2s",{})},e.reqAttackInfo=function(e){netManager.send("s1.s1_attack_info_c2s",{pos:e})},e.reqDefInfo=function(e){netManager.send("s1.s1_defend_info_c2s",{pos:e})},e.reqDefDetailInfo=function(e){netManager.send("s1.s1_defend_detail_c2s",{pos:e})},e.reqSpeedup=function(e){netManager.send("s1.s1_speed_up_c2s",{base_id:e})},e.reqActionPointItem=function(e){netManager.send("s1.s1_action_point_item_c2s",{num:e})},e.reqSetBorn=function(e){netManager.send("s1.s1_set_born_c2s",{pos:e})},e.reqBack=function(){netManager.send("s1.s1_back_c2s",{})},e.reqRecover=function(e){netManager.send("s1.s1_recover_c2s",{base_id:e})},e.reqRevive=function(){netManager.send("s1.s1_revive_c2s",{})},e.leaveScene=function(e,n){var t=IS(m);t.gridMap={},t.moveMap={},t.gridTimeMap={},t.clearActions(),normalEvent.emit(u.SEASON_SCENE_QUIT)},e.reqVideo=function(e,n){netManager.send("s1.s1_video_c2s",{vid:e,source:n})},e.reqBattleReports=function(){netManager.send("s1.s1_battle_reports_c2s",{})},e.reqShareInfo=function(e){netManager.send("s1.s1_share_info_c2s",{pos:{x:e.x,y:e.y}})},e.reqInspect=function(e){netManager.send("s1.s1_spy_on_c2s",{pos:{x:e.x,y:e.y}})},e.reqRelicDetail=function(){netManager.send("s1.s1_relic_detail_c2s",{})},e.reqMonsterInfo=function(e){netManager.send("s1.s1_monster_info_c2s",{pos:{x:e.x,y:e.y}})},e.reqLocate=function(e){var n;if((e=null!=(n=e)?n:0)>0){var t=r.getIndexToCR(e);netManager.send("s1.s1_locate_c2s",{pos:{x:t.x,y:t.y}})}else netManager.send("s1.s1_locate_c2s",{})},e.reqMinimap=function(){netManager.send("s1.s1_mini_map_c2s",{})},e.reqRoyalInfo=function(e){netManager.send("s1.s1_empire_occupy_c2s",{pos:{x:e.x,y:e.y}})},e.reqEmojiSend=function(e){netManager.send("s1.s1_emoji_c2s",{emoji_id:e})},e.reqSearchInfo=function(){netManager.send("s1.s1_search_c2s",{})},e.reqWantedInfo=function(){netManager.send("s1.s1_bounty_c2s",{})},e.on_scene_obj_add_s2c=function(e){for(var t,s=IS(m),a=n(e.grid_list);!(t=a()).done;){var _=t.value;s.gridUpdateFlag=v.Add;var o=_.id;if(s.gridActions[v.Add].add(o),s.gridActions[v.Move].delete(o),s.gridActions[v.Del].delete(o),s.gridActions[v.Update].delete(o),s.gridMap[o]=_,_.fill_obj)switch(_.fill_obj.obj_type){case E.S1_Base:case E.S1_Rss:case E.S1_Hold:case E.S1_Empire:case E.S1_Relic:case E.S1_AirDrop:var i=configSeason_building_plot.getDataByKey(_.fill_obj.base_id);if(i.plot_number.length>1){var c=r.getIndexToCR(o);M.set(c);for(var d,l=M.x%2==0?i.plot_number_even:i.plot_number,f=n(l);!(d=f()).done;){var S=d.value;if(0!=S[0]||0!=S[1]){var p=r.getCRToIndex(M.x+S[0],M.y+S[1]);s.gridMap[p]=_}}}}}},e.on_scene_obj_update_s2c=function(e){},e.on_scene_obj_update_elem_s2c=function(e){},e.on_scene_obj_del_s2c=function(e){for(var t,s=IS(m),a=e.list,_=n(a);!(t=_()).done;){var o=t.value;if(s.gridMap[o]){s.gridUpdateFlag|=v.Del;var i=s.gridMap[o];if(i.id==o&&(delete s.gridMap[o],s.gridActions[v.Del].add(o),s.gridActions[v.Move].delete(o),s.gridActions[v.Add].delete(o),s.gridActions[v.Update].delete(o),i.fill_obj))switch(i.fill_obj.obj_type){case E.S1_Base:case E.S1_Rss:case E.S1_Hold:case E.S1_Empire:case E.S1_Relic:case E.S1_AirDrop:var c=configSeason_building_plot.getDataByKey(i.fill_obj.base_id);if(c.plot_number.length>1){var d=r.getIndexToCR(o);M.set(d);for(var l,f=M.x%2==0?c.plot_number_even:c.plot_number,S=n(f);!(l=S()).done;){var p=l.value;if(0!=p[0]||0!=p[1]){var u=r.getCRToIndex(M.x+p[0],M.y+p[1]);delete s.gridMap[u]}}}}}}},e.on_s1_move_del_s2c=function(e){for(var t,s=IS(m),a=n(e.list);!(t=a()).done;){var _=t.value;if(!s.moveMap[_])return;s.moveUpdateFlag|=g.Del,s.moveActions[g.Del].add(_),s.moveActions[g.Add].delete(_),delete s.moveMap[_]}},e.on_s1_move_list_s2c=function(e){for(var t,s=IS(m),a=n(e.move_list);!(t=a()).done;){var _=t.value;s.moveUpdateFlag|=g.Add,s.moveMap[_.obj_id]=_,s.moveActions[g.Add].add(_.obj_id),s.moveActions[g.Del].delete(_.obj_id)}},e.on_scene_enter_s2c=function(e){var t=IS(m);t.gridMap={},t.moveMap={},t.gridTimeMap={},t.clearActions(),t.viewPos=e.pos;for(var s,a=n(e.grid_time_list);!(s=a()).done;){var _=s.value;t.gridTimeMap[_.id]=_}t.currenSceneType=1,t.myAreaId=e.area_id,t.airDrops=e.air_drops,normalEvent.emit(u.SEASON_SCENE_ENTER,t.viewPos),normalEvent.emit(u.SEASON_SCENE_AIRDORPS)},e.on_s1_quit_s2c=function(e){this.leaveScene(0)},e.on_s1_attack_info_s2c=function(e){normalEvent.emit(u.SEASON_SCENE_ATTCK_INFO,e)},e.on_s1_defend_info_s2c=function(e){normalEvent.emit(u.SEASON_SCENE_DEF_INFO,e)},e.on_s1_defend_detail_s2c=function(e){normalEvent.emit(u.SEASON_SCENE_DEF_DETAIL_INFO,e)},e.on_s1_team_info_s2c=function(e){IS(m).teamInfo=e,normalEvent.emit(u.SEASON_SCENE_TEAM_INFO)},e.on_s1_role_info_s2c=function(e){var n=IS(m).roleInfo;n||(n={},IS(m).roleInfo=n),n.action_point=e.action_point,n.next_time=e.next_time,normalEvent.emit(u.SEASON_SCENE_ROLE_INFO,e),IS(p).checkMapAPRP()},e.on_s1_battle_reports_s2c=function(e){normalEvent.emit(u.SEASON_SCENE_REPORTS,e.s1_battle_report)},e.on_s1_video_s2c=function(e){var n=IS(d);n.currentLoadType=0,n.chapterType=a.SeasonPvp,n.curDungeonId=310001;var t=new o;t.chapterId=310001,t.seed=e.seed,t.chapterType=a.SeasonPvp,t.playerList[1]=new _(1),t.playerList[2]=new _(2),i.setPlayerList(e.atk_data,t.playerList[1],a.SeasonPvp),i.setShipData(e.atk_ship,t.playerList[1]),i.setPlayerList(e.def_data,t.playerList[2],a.SeasonPvp),i.setShipData(e.def_ship,t.playerList[2]),e.ext&&i.setChapterExt(t,e.ext),n.battleData=t,battleMain.enterChapter(0,!0,!0),normalEvent.emit(l.BATTLE_STATE,t.chapterType,!0)},e.on_s1_reward_s2c=function(e){normalEvent.emit(u.SEASON_SCENE_REWARD,e,h.Attack)},e.on_s1_defend_result_s2c=function(e){normalEvent.emit(u.SEASON_SCENE_REWARD,e,h.Def)},e.on_s1_monster_result_s2c=function(e){normalEvent.emit(u.SEASON_SCENE_REWARD,e,h.Monster)},e.on_s1_share_info_s2c=function(e){normalEvent.emit(u.SEASON_SCENE_SHARE_INFO,e)},e.on_s1_air_drop_info_s2c=function(e){IS(m).airDrops=e.air_drops,normalEvent.emit(u.SEASON_SCENE_AIRDORPS)},e.on_s1_monster_info_s2c=function(e){normalEvent.emit(u.SEASON_SCENE_DEF_DETAIL_INFO,e)},e.on_s1_relic_detail_s2c=function(e){normalEvent.emit(u.SEASON_SCENE_RELIC_INFO,e)},e.on_s1_relic_result_s2c=function(e){uiMgr.openView("SeasonBattleRelicResultView",e)},e.on_s1_locate_s2c=function(e){var n=r.getCRToIndex(e.pos.x,e.pos.y);normalEvent.emit(u.SEASON_SCENE_GOTO,e.is_spy_on,e.base_id,n,e.server_id)},e.on_s1_mini_map_s2c=function(e){normalEvent.emit(u.SEASON_SCENE_MINI_MAP,e.list)},e.on_s1_empire_occupy_s2c=function(e){IS(m).RoyalOccServ_id=e.serv_id,normalEvent.emit(u.SEASON_SCENE_ROYAL_INFO_UPDATE)},e.on_s1_emoji_s2c=function(e){},e.on_s1_search_s2c=function(e){uiMgr.openView("SeasonSceneSearchView",e.search_list)},e.on_s1_bounty_s2c=function(e){IS(m).bountyInfo=e,normalEvent.emit(u.SEASON_WANTED_INFO_UPDATE)},t}());t._RF.pop()}}}));

