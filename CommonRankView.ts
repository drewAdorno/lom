System.register("chunks:///_virtual/CommonRankView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./V2.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./index57.ts","./ChapterDataCache.ts","./FriendControl.ts","./FrameDataCache.ts","./RankControl.ts","./RoleDataCache.ts","./RoleDefine.ts","./CommonModel.ts","./BaseView.ts"],(function(n){"use strict";var i,t,e,a,o,r,s,h,d,m,l,k,c,f,g,_,u,C,v,R;return{setters:[function(n){i=n.inheritsLoose},function(n){t=n.cclegacy,e=n.Button,a=n.Label,o=n.Sprite,r=n.ScrollView,s=n.sys},function(n){h=n.V2},function(n){d=n.SelectedType,m=n.ListItem},function(n){l=n.default},function(n){k=n.default},null,function(n){c=n.ChapterDataCache},function(n){f=n.default},function(n){g=n.FrameDataCache},function(n){_=n.default},function(n){u=n.RoleDataCache},function(n){C=n.PlayerAttr},function(n){v=n.CommonModel},function(n){R=n.BaseView}],execute:function(){var p,I;n("RankType",void 0),t._RF.push({},"f2af1tUN/BLaLODDgIeeuCQ","CommonRankView",void 0),function(n){n[n.TYPE_DMG=1]="TYPE_DMG"}(I||(I=n("RankType",{})));var S=n("Type2DescStr",((p={})[I.TYPE_DMG]=200685,p)),y=(n("default",function(n){function t(){var i;return(i=n.call(this)||this).rankList=void 0,i.rank1Name=void 0,i.rank1Score=void 0,i.rank1Icon=void 0,i.rank1Head=void 0,i.rank1HeadFrame=void 0,i.rank2Name=void 0,i.rank2Score=void 0,i.rank2Icon=void 0,i.rank2Head=void 0,i.rank2HeadFrame=void 0,i.rank3Name=void 0,i.rank3Score=void 0,i.rank3Icon=void 0,i.rank3Head=void 0,i.rank3HeadFrame=void 0,i.meRankIcon=void 0,i.meRankHeadFrame=void 0,i.meRankIndex=void 0,i.meNoRank=void 0,i.meRankScore=void 0,i.meRankName=void 0,i.rank1Role=void 0,i.rank2Role=void 0,i.rank3Role=void 0,i.Rank1Job=void 0,i.Rank2Job=void 0,i.Rank3Job=void 0,i.pos1=new h,i.pos2=new h,i.pos3=new h,i.rank_info_list=void 0,i.my_info=void 0,i.curRankPage=void 0,i.maxPage=void 0,i.rankId=void 0,i.title=void 0,i.nodeSpe=void 0,i.desStr=void 0,i.name="CommonRankView",i.url="ui/module/common/CommonRankView",i.poolTime=3e3,i}i(t,n);var m=t.prototype;return m.onInit=function(){var n=this,i=this.findChild("imgMask");this.addComponentCallbackListener(i,e.EventType.CLICK,(function(){n.close()}));var t=this.findChild("content/btnClose");this.addComponentCallbackListener(t,e.EventType.CLICK,(function(){n.close()})),this.rank1Name=this.findChildComponent("content/mainRank/rank1/name",a),this.rank1Score=this.findChildComponent("content/mainRank/rank1/score",a),this.rank1Icon=this.findChild("content/mainRank/rank1/imgFrame"),this.rank1Head=this.findChildComponent("content/mainRank/rank1/imgFrame/frame/imgIcon",o),this.rank1HeadFrame=this.findChildComponent("content/mainRank/rank1/imgFrame/frame/imgHeadFrame",o),this.addComponentCallbackListener(this.rank1Icon,e.EventType.CLICK,(function(){IS(f).reqOtherRoleNotice(n.rank_info_list[0].role_id)})),this.Rank1Job=this.findChild("content/mainRank/rank1/role");var h=this.findChild("content/mainRank/rank1/role/click");this.addComponentCallbackListener(h,e.EventType.CLICK,(function(){IS(f).reqOtherRoleNotice(n.rank_info_list[0].role_id)})),this.rank2Name=this.findChildComponent("content/mainRank/rank2/name",a),this.rank2Score=this.findChildComponent("content/mainRank/rank2/score",a),this.rank2Icon=this.findChild("content/mainRank/rank2/imgFrame"),this.rank2Head=this.findChildComponent("content/mainRank/rank2/imgFrame/frame/imgIcon",o),this.rank2HeadFrame=this.findChildComponent("content/mainRank/rank2/imgFrame/frame/imgHeadFrame",o),this.addComponentCallbackListener(this.rank2Icon,e.EventType.CLICK,(function(){IS(f).reqOtherRoleNotice(n.rank_info_list[1].role_id)}));var m=this.findChild("content/mainRank/rank2/role/click");this.addComponentCallbackListener(m,e.EventType.CLICK,(function(){IS(f).reqOtherRoleNotice(n.rank_info_list[1].role_id)})),this.Rank2Job=this.findChild("content/mainRank/rank2/role"),this.rank3Name=this.findChildComponent("content/mainRank/rank3/name",a),this.rank3Score=this.findChildComponent("content/mainRank/rank3/score",a),this.rank3Icon=this.findChild("content/mainRank/rank3/imgFrame"),this.addComponentCallbackListener(this.rank3Icon,e.EventType.CLICK,(function(){IS(f).reqOtherRoleNotice(n.rank_info_list[2].role_id)}));var l=this.findChild("content/mainRank/rank3/role/click");this.addComponentCallbackListener(l,e.EventType.CLICK,(function(){IS(f).reqOtherRoleNotice(n.rank_info_list[2].role_id)})),this.Rank3Job=this.findChild("content/mainRank/rank3/role"),this.rank3Head=this.findChildComponent("content/mainRank/rank3/imgFrame/frame/imgIcon",o),this.rank3HeadFrame=this.findChildComponent("content/mainRank/rank3/imgFrame/frame/imgHeadFrame",o);this.findChild("content/mainRank/rankList");var k=this.findChildComponent("content/mainRank/rankList",r);this.rankList=this.addUIList(k,y),this.rankList.selectedMode=d.SINGLE,this.addComponentCallbackListener(k.node,r.EventType.SCROLL_TO_BOTTOM,(function(){if(n.curRankPage<n.maxPage){n.curRankPage++;var i=new Array;i.push({type:n.rankId,server:1,page:n.curRankPage}),IS(_).reqRankList(i)}})),this.meRankIcon=this.findChildComponent("content/mainRank/meRank/imgFrame/frame/imgIcon",o),this.meRankHeadFrame=this.findChildComponent("content/mainRank/meRank/imgFrame/frame/imgHeadFrame",o),this.meRankName=this.findChildComponent("content/mainRank/meRank/name",a),this.meRankIndex=this.findChildComponent("content/mainRank/meRank/rank",a),this.meNoRank=this.findChild("content/mainRank/meRank/no_rank"),this.meRankScore=this.findChildComponent("content/mainRank/meRank/score",a),this.pos1.set(0,-35),this.pos2.set(0,-15),this.pos3.set(0,-15),this.title=this.findChildComponent("content/mainRank/title/txtTitle",a),this.nodeSpe=this.findChild("content/mainRank/nodeSpe"),s.uiMirror&&(this.loadIcon(this.findChildComponent("content/mainRank/rank1/imgFrame/rank_icon",o),"friend","hy_ICON_paiming01"),this.loadIcon(this.findChildComponent("content/mainRank/rank2/imgFrame/rank_icon",o),"friend","hy_ICON_paiming02"),this.loadIcon(this.findChildComponent("content/mainRank/rank3/imgFrame/rank_icon",o),"friend","hy_ICON_paiming03"))},m.onAfterOpen=function(){var n=this.openArgs[0].rank_data_list[0];this.maxPage=n.max_page,this.rank_info_list=n.rank_info,this.curRankPage=1,this.my_info=n.my_rank_info,this.rankId=n.type;var i=this.openArgs[1];i&&(i.title?this.title.string=i.title:this.title.string=GetLanguage(200153),i.desType&&S[i.desType]?this.desStr=S[i.desType]:this.desStr=0),this.refreshTop3(),this.refreshMyRank(),this.refreshSpe()},m.refreshSpe=function(){var n=this,i=l.findChild(this.nodeSpe,"type1020");if(i.active=!1,1020==this.rankId){var t=IS(c).worldBossInfo.today_buff,o=configWorld_boss_bufflist.getDataByKey(t);if(o){l.findChildComponent(i,"buff",a).string=o.buff_desc,i.active=!0;var r=l.findChild(i,"btnReward");this.addComponentCallbackListener(r,e.EventType.CLICK,(function(){uiMgr.openView("WorldBossRankRewardView",n.my_info.rank)}))}}},m.registerUpdateHandler=function(){},m.refreshTop3=function(){if(this.rank1Name.string=GetLanguage(200038),this.rank1Score.string="",this.rank1Icon.active=!1,this.rank2Name.string=GetLanguage(200038),this.rank2Score.string="",this.rank2Icon.active=!1,this.rank3Name.string=GetLanguage(200038),this.rank3Score.string="",this.rank3Icon.active=!1,null!=this.rank1Role&&(this.removeUnitModel(this.rank1Role),this.rank1Role=null),null!=this.rank2Role&&(this.removeUnitModel(this.rank2Role),this.rank2Role=null),null!=this.rank3Role&&(this.removeUnitModel(this.rank3Role),this.rank3Role=null),this.rank_info_list&&this.rank_info_list.length>0){for(var n=this.rank_info_list[0].figure,i=n.skin_list||[],t=n.hair_figure>0&&n.hair_figure||6,e=n.equip_list.length>0&&IS(v).GetKvListByK(n.equip_list,0)||0,a=n.equip_list.length>1&&IS(v).GetKvListByK(n.equip_list,1)||0,o=n.equip_list.length>2&&IS(v).GetKvListByK(n.equip_list,2)||0,r=0,h=0;h<i.length;h++)2==i[h].k&&(r=i[h].v);var d=n.gender||1;this.rank1Role=this.addUnitModel({job:n.job_figure||1001,dressId:r,gender:d,parent:this.Rank1Job,color:t,weapon:e,ornaments:a,face:o,mount:n.mount_figure||0,shenqi:n.artifact_figure||0}),s.uiMirror&&(this.getUnitModel(this.rank1Role).dir=-1),this.getUnitModel(this.rank1Role).mount=n.mount_figure,this.loadRemoteIcon(this.rank_info_list[0].head.url,this.rank1Head),this.rank1Icon.active=!0,this.rank1Name.string=this.rank_info_list[0].name,this.rank1Score.string=k.formatStrWithMirrorDeal(GetLanguage(this.desStr),k.GetNumString(this.rank_info_list[0].score));var m=this.rank_info_list[0].head.frame_id;if(m>0){this.rank1HeadFrame.node.active=!0;var l=configAvatar_frame.getDataByKey(m);this.loadIcon(this.rank1HeadFrame,"icon_frame",l.icon)}else this.rank1HeadFrame.node.active=!1}if(this.rank_info_list&&this.rank_info_list.length>1){for(var c=this.rank_info_list[1].figure,f=c.skin_list||[],g=c.hair_figure>0&&c.hair_figure||6,_=c.equip_list.length>0&&IS(v).GetKvListByK(c.equip_list,0)||0,u=c.equip_list.length>1&&IS(v).GetKvListByK(c.equip_list,1)||0,C=c.equip_list.length>2&&IS(v).GetKvListByK(c.equip_list,2)||0,R=0,p=0;p<f.length;p++)2==f[p].k&&(R=f[p].v);var I=c.gender||1;this.rank2Role=this.addUnitModel({job:c.job_figure||1001,dressId:R,gender:I,parent:this.Rank2Job,color:g,weapon:_,ornaments:u,face:C,mount:c.mount_figure||0,shenqi:c.artifact_figure||0}),s.uiMirror&&(this.getUnitModel(this.rank2Role).dir=-1),this.getUnitModel(this.rank2Role).mount=c.mount_figure,this.loadRemoteIcon(this.rank_info_list[1].head.url,this.rank2Head),this.rank2Icon.active=!0,this.rank2Name.string=this.rank_info_list[1].name,this.rank2Score.string=k.formatStrWithMirrorDeal(GetLanguage(this.desStr),k.GetNumString(this.rank_info_list[1].score));var S=this.rank_info_list[1].head.frame_id;if(S>0){this.rank2HeadFrame.node.active=!0;var y=configAvatar_frame.getDataByKey(S);this.loadIcon(this.rank2HeadFrame,"icon_frame",y.icon)}else this.rank2HeadFrame.node.active=!1}if(this.rank_info_list&&this.rank_info_list.length>2){for(var L=this.rank_info_list[2].figure,F=L.hair_figure>0&&L.hair_figure||6,H=L.equip_list.length>0&&IS(v).GetKvListByK(L.equip_list,0)||0,N=L.equip_list.length>1&&IS(v).GetKvListByK(L.equip_list,1)||0,b=L.equip_list.length>2&&IS(v).GetKvListByK(L.equip_list,2)||0,M=L.skin_list||[],K=0,T=0;T<M.length;T++)2==M[T].k&&(K=M[T].v);var G=L.gender||1;this.rank3Role=this.addUnitModel({job:L.job_figure||1001,dressId:K,gender:G,parent:this.Rank3Job,color:F,weapon:H,ornaments:N,face:b,mount:L.mount_figure,shenqi:L.artifact_figure||0}),s.uiMirror&&(this.getUnitModel(this.rank3Role).dir=-1),this.getUnitModel(this.rank3Role).mount=L.mount_figure,this.loadRemoteIcon(this.rank_info_list[2].head.url,this.rank3Head),this.rank3Icon.active=!0,this.rank3Name.string=this.rank_info_list[2].name,this.rank3Score.string=k.formatStrWithMirrorDeal(GetLanguage(this.desStr),k.GetNumString(this.rank_info_list[2].score));var q=this.rank_info_list[2].head.frame_id;if(q>0){this.rank3HeadFrame.node.active=!0;var D=configAvatar_frame.getDataByKey(q);this.loadIcon(this.rank3HeadFrame,"icon_frame",D.icon)}else this.rank3HeadFrame.node.active=!1}if(this.rank_info_list&&this.rank_info_list.length>3){for(var w=new Array,B=0;B<this.rank_info_list.length;B++)B>2&&w.push({info:this.rank_info_list[B]});this.rankList.datas=w}},m.refreshMyRank=function(){var n=IS(u),i=n.GetRoleAttr(C.ROLE_ATTR_HEAD_URL);this.loadRemoteIcon(i,this.meRankIcon);var t=IS(g).curFrameId;if(t>0){var e=configAvatar_frame.getDataByKey(t);this.loadIcon(this.meRankHeadFrame,"icon_frame",e.icon),this.meRankHeadFrame.node.active=!0}else this.meRankHeadFrame.node.active=!1;this.meRankName.string=n.GetRoleAttr(C.ROLE_ATTR_NAME),this.my_info?(this.meNoRank.active=this.my_info.rank<=0,this.my_info.rank>0?this.meRankIndex.string=this.my_info.rank+"":this.meRankIndex.string="",this.meRankScore.string=k.formatStrWithMirrorDeal(GetLanguage(this.desStr),k.GetNumString(this.my_info.score||0))):(this.meRankScore.string=k.formatStrWithMirrorDeal(GetLanguage(this.desStr),0),this.meNoRank.active=!0,this.meRankIndex.string="")},m.onBeforeClose=function(){},m.onDestroy=function(){},t}(R)),function(n){function t(){for(var i,t=arguments.length,e=new Array(t),a=0;a<t;a++)e[a]=arguments[a];return(i=n.call.apply(n,[this].concat(e))||this).imgFrame=void 0,i.imgIcon=void 0,i.txtScore=void 0,i.txtRank=void 0,i.txtName=void 0,i.btnHead=void 0,i.imgHeadFrame=void 0,i}i(t,n);var r=t.prototype;return r.onInit=function(){var n=this;this.imgFrame=l.findChildComponent(this.node,"imgFrame",o),this.imgIcon=l.findChildComponent(this.node,"imgFrame/frame/imgIcon",o),this.imgHeadFrame=l.findChildComponent(this.node,"imgFrame/frame/imgHeadFrame",o),this.txtScore=l.findChildComponent(this.node,"score",a),this.txtRank=l.findChildComponent(this.node,"rank",a),this.txtName=l.findChildComponent(this.node,"name",a),this.btnHead=l.findChild(this.node,"imgFrame"),this.view.addComponentCallbackListener(this.btnHead,e.EventType.CLICK,(function(){n.onItemClick()}))},r.onRender=function(n,i){var t=this.view.desStr;this.data=n,this.view.loadRemoteIcon(n.info.head.url,this.imgIcon),this.txtRank.string=n.info.rank,this.txtScore.string=k.formatStrWithMirrorDeal(GetLanguage(t),k.GetNumString(n.info.score)),this.txtName.string=n.info.name;var e=n.info.head.frame_id;if(e>0){this.imgHeadFrame.node.active=!0;var a=configAvatar_frame.getDataByKey(e);this.view.loadIcon(this.imgHeadFrame,"icon_frame",a.icon)}else this.imgHeadFrame.node.active=!1},r.onItemClick=function(){IS(f).reqOtherRoleNotice(this.data.info.role_id)},t}(m));t._RF.pop()}}}));

