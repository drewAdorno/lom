System.register("chunks:///_virtual/PlayerCustomeHeadView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./NodeUtil.ts","./index57.ts","./CommonDefine.ts","./MessageView.ts","./RoleDataCache.ts","./RoleDefine.ts","./NativeToJs.ts","./CustomeHeadControl.ts","./CustomeHeadDataCache.ts","./CustomeHeadDefine.ts","./BaseView.ts"],(function(t){"use strict";var e,i,a,n,s,d,o,h,c,l,r,f,u,v,p;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,a=t.Button,n=t.randomRangeInt,s=t.Sprite},function(t){d=t.default},null,function(t){o=t.CommonEventDefine},function(t){h=t.default},function(t){c=t.RoleDataCache},function(t){l=t.PlayerAttr,r=t.RoleEventDefine},null,function(t){f=t.default},function(t){u=t.CustomeHeadDataCache},function(t){v=t.CustomeHeadDefine},function(t){p=t.BaseView}],execute:function(){i._RF.push({},"84e9dHuwxxL1Ltk/PPIyspq","PlayerCustomeHeadView",void 0);t("default",function(t){function i(){var e;return(e=t.call(this)||this).headItemList=[],e.selectIdx=void 0,e.name="PlayerCustomeHeadView",e.url="ui/module/player/PlayerCustomeHeadView",e}e(i,t);var s=i.prototype;return s.onInit=function(){var t=this,e=this.findChild("imgMask");this.addComponentCallbackListener(e,a.EventType.CLICK,(function(){t.close()}));for(var i=0;i<3;i++){var s=new m;s.onInit(this,this.findChild("head"+(i+1)),i),this.headItemList.push(s)}var d=this.findChild("btnChange");this.addComponentCallbackListener(d,a.EventType.CLICK,(function(){for(var e=!1,i=0;i<t.headItemList.length;i++)if(t.headItemList[i].data&&1==t.headItemList[i].data.state){e=!0;break}if(e)if(null!=t.selectIdx){var a=t.headItemList[t.selectIdx].data,n=IS(c).GetRoleAttr(l.ROLE_ATTR_HEAD_URL);a&&a.url!=n&&IS(f).send_role_use_photo_c2s(a.id)}else h.showFlyTip(GetLanguage(300062));else h.showFlyTip(GetLanguage(300061))}));var r=this.findChild("upLoadBtn");this.addComponentCallbackListener(r,a.EventType.CLICK,(function(){for(var e=!1,i=0;i<t.headItemList.length;i++)if(!t.headItemList[i].data){e=!0;break}e?0!=GlobalDefine.SERVER_LIST_TYPE?sdkControl.H5SelectImg():h.showBoxTip({tip:GetLanguage(300071),title:GetLanguage(300070),func:function(e){"type_yes"==e?0==GlobalDefine.SERVER_LIST_TYPE&&t.addTimer(.1,1,(function(){var t=["http://test.chat.4399sy.com/vipkf/static/img/big.png","http://test.chat.4399sy.com/vipkf/static/img/image.jpg","http://test.chat.4399sy.com/vipkf/static/img/vertical.jpg"],e=n(0,t.length-1);normalEvent.emit(o.PhotoUpLoadSuccess,t[e],"1")})):"type_cancel"==e&&0==GlobalDefine.SERVER_LIST_TYPE&&t.addTimer(.1,1,(function(){var t=["http://test.chat.4399sy.com/vipkf/static/img/big.png","http://test.chat.4399sy.com/vipkf/static/img/image.jpg","http://test.chat.4399sy.com/vipkf/static/img/vertical.jpg"],e=n(0,t.length-1);normalEvent.emit(o.PhotoUpLoadSuccess,t[e],"1")}))},ensure:GetLanguage(300073),cancel:GetLanguage(300072)}):h.showFlyTip(GetLanguage(300063))}));var u=this.findChild("btnClose");this.addComponentCallbackListener(u,a.EventType.CLICK,(function(){t.close()}))},s.registerUpdateHandler=function(){this.addEvent(v.UpdateHeadInfo,this.UpdateHeadInfo,this),this.addEvent(o.PhotoUpLoadSuccess,this.UpLoadSuccess,this),this.addEvent(v.UpdateHeadRed,this.UpdateHeadRed,this),this.addEvent(r.ROLE_INFO_UPDATE_HEADURL,this.UpdateHeadInfo,this)},s.onAfterOpen=function(){this.selectIdx=null,IS(f).send_role_photo_list_c2s(),this.UpdateHeadInfo()},s.UpdateHeadInfo=function(){for(var t=0;t<this.headItemList.length;t++)this.headItemList[t].Refresh(IS(u).GetPhotoInfo(t+1))},s.UpdateHeadRed=function(){for(var t=0;t<this.headItemList.length;t++)this.headItemList[t].UpdateRed()},s.UpLoadSuccess=function(t,e){if("1"==e)for(var i=0;i<this.headItemList.length;i++)if(!this.headItemList[i].data){IS(f).send_role_add_photo_c2s(t,i+1);break}},s.onBeforeClose=function(){IS(u).SendCheckRed()},s.onDestroy=function(){},i}(p));var m=function(){function t(){this.icon=void 0,this.checking=void 0,this.addtn=void 0,this.selected=void 0,this.btnDelete=void 0,this.arrow=void 0,this.headNode=void 0,this.node=void 0,this.greenRed=void 0,this.view=void 0,this.data=void 0,this.idx=0}var e=t.prototype;return e.onInit=function(t,e,i){var n=this;this.view=t,this.node=e,this.idx=i,this.view.addComponentCallbackListener(this.node,a.EventType.CLICK,(function(){n.data&&1==n.data.state&&(IS(u).SendCheckRed(n.data.id),n.view.selectIdx=n.idx,n.view.UpdateHeadInfo())})),this.icon=d.findChildComponent(this.node,"head/iconMask/icon",s),this.checking=d.findChild(this.node,"head/iconMask/checking"),this.addtn=d.findChild(this.node,"addtn"),this.selected=d.findChild(this.node,"head/selected"),this.btnDelete=d.findChild(this.node,"btnDelete"),this.greenRed=d.findChild(this.node,"red"),this.view.addComponentCallbackListener(this.btnDelete,a.EventType.CLICK,(function(){IS(f).send_role_delete_photo_c2s(n.data.id)})),this.arrow=d.findChild(this.node,"arrow"),this.headNode=d.findChild(this.node,"head")},e.Refresh=function(t){if(t&&t.state>=0){this.data=t,this.headNode.active=!0,this.addtn.active=!1,this.checking.active=0==t.state;var e=IS(c).GetRoleAttr(l.ROLE_ATTR_HEAD_URL);this.arrow.active=e==t.url,this.selected.active=1==t.state&&this.view.selectIdx==this.idx,this.btnDelete.active=1==t.state,this.view.loadRemoteIcon(this.data.url,this.icon)}else this.view.selectIdx==this.idx&&(this.view.selectIdx=null),this.arrow.active=!1,this.data=null,this.btnDelete.active=!1,this.headNode.active=!1,this.addtn.active=!0;this.UpdateRed()},e.UpdateRed=function(){this.data?this.greenRed.active=!!IS(u).GetIsRedById(this.data.id):this.greenRed.active=!1},t}();i._RF.pop()}}}));

