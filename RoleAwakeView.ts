System.register("chunks:///_virtual/RoleAwakeView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AudioMgr.ts","./NodeUtil.ts","./StringUtil.ts","./index57.ts","./ItemIcon.ts","./ConfigGlobal.ts","./BagDefine.ts","./BagModel.ts","./MessageView.ts","./EquipModel.ts","./RoleControl.ts","./RoleDataCache.ts","./RoleDefine.ts","./BaseSubView.ts"],(function(t){"use strict";var e,i,o,n,s,a,d,r,l,c,h,v,f,u,b,p,C,g,w,I,m,_,y,A;return{setters:[function(t){e=t.inheritsLoose,i=t.createForOfIteratorHelperLoose},function(t){o=t.cclegacy,n=t.Button,s=t.Sprite,a=t.Label,d=t.RichText,r=t.js,l=t.sys,c=t.Color},function(t){h=t.audioMgr},function(t){v=t.default},function(t){f=t.default},null,function(t){u=t.IconAseetType},function(t){b=t.ConfigGlobal},function(t){p=t.BagEventDefine},function(t){C=t.BagModel},function(t){g=t.default},function(t){w=t.EquipModel},function(t){I=t.default},function(t){m=t.RoleDataCache},function(t){_=t.RoleEventDefine,y=t.PlayerAttr},function(t){A=t.BaseSubView}],execute:function(){o._RF.push({},"b58f5vyWB5PvLFpHaYPPzrP","RoleAwakeView",void 0);t("default",function(t){function o(){var e;return(e=t.call(this)||this).bottomNode=void 0,e.notAwake=void 0,e.iconCost=void 0,e.txtCost=void 0,e.iconCostOne=void 0,e.txtCostOne=void 0,e.iconCostAll=void 0,e.txtCostAll=void 0,e.txtAll=void 0,e.isMax=void 0,e.tips=void 0,e.tipsLine=void 0,e.btnAwake=void 0,e.btnAwake2=void 0,e.btnConvert=void 0,e.txtAwakeCost=void 0,e.iconAwakeCost=void 0,e.txtAwake2Desc=void 0,e.attrName=void 0,e.attrValue=void 0,e.jobIcon=void 0,e.jobName=void 0,e.awakeRed=void 0,e.awake2Red=void 0,e.convertRed=void 0,e.oneRed=void 0,e.allRed=void 0,e.itemList=[],e.curIndex=0,e.canUpLev=0,e.name="RoleAwakeView",e.url="ui/module/role/RoleAwakeView",e}e(o,t);var A=o.prototype;return A.onInit=function(){var t=this;this.bottomNode=this.findChild("view/bottom"),this.notAwake=this.findChild("view/notAwake");var e=this.findChild("view/bottom/btn/btnOne");this.addComponentCallbackListener(e,n.EventType.CLICK,(function(){var e;if(0!=t.curIndex){var i=IS(m).GetJob(),o=configJobs.getDataByKey(i),n=IS(m).getAwakeInfo(),s=o.passive_imprint[t.curIndex-1],a=null!=(e=n[s])?e:0,d=configJobs_wakeup.getDataByKeys("id",s,"level",0==a?1:a),r=configGoods.getDataByKey(d.cost[0][0]);if(IS(C).getGoodsCountByGoodsGtid(r.id)<d.cost[0][1])return g.showFlyTip(GetLanguage(200108)),void uiMgr.openView("ItemGetWayView",r.id);IS(I).send_37_3(o.passive_imprint[t.curIndex-1],1)}}));var i=this.findChild("view/bottom/btn/btnAll");this.addComponentCallbackListener(i,n.EventType.CLICK,(function(){if(0!=t.curIndex){if(0==t.canUpLev)return g.showFlyTip(GetLanguage(200108)),void uiMgr.openView("ItemGetWayView",1024);var e=IS(m).GetJob(),i=configJobs.getDataByKey(e);IS(I).send_37_3(i.passive_imprint[t.curIndex-1],t.canUpLev)}})),this.iconCost=this.findChildComponent("view/bottom/res/icon",s),this.txtCost=this.findChildComponent("view/bottom/res/Label",a),this.iconCostOne=this.findChildComponent("view/bottom/btn/btnOne/cost/icon",s),this.txtCostOne=this.findChildComponent("view/bottom/btn/btnOne/cost/Label",d),this.iconCostAll=this.findChildComponent("view/bottom/btn/btnAll/cost/icon",s),this.txtCostAll=this.findChildComponent("view/bottom/btn/btnAll/cost/Label",d),this.txtAll=this.findChildComponent("view/bottom/btn/btnAll/Label",a),this.isMax=this.findChild("view/max"),this.tips=this.findChild("view/desc/desc/Label"),this.tipsLine=this.findChild("view/desc/desc/line"),this.awakeRed=this.findChild("view/btnAwake/red"),this.convertRed=this.findChild("view/btnConvert/red"),this.oneRed=this.findChild("view/bottom/btn/btnOne/red"),this.allRed=this.findChild("view/bottom/btn/btnAll/red"),this.attrName=this.findChildComponent("view/desc/desc/name",a),this.attrValue=this.findChildComponent("view/desc/desc/attr",d),this.jobIcon=this.findChildComponent("view/role/imgJob",s),this.jobName=this.findChildComponent("view/role/nameBg/name",a),this.btnAwake=this.findChild("view/btnAwake"),this.iconAwakeCost=this.findChildComponent("view/btnAwake/icon",s),this.txtAwakeCost=this.findChildComponent("view/btnAwake/num",d),this.addComponentCallbackListener(this.btnAwake,n.EventType.CLICK,(function(){var t=b.jobs_wakeup_cost[0];if(IS(C).getGoodsCountByGoodsGtid(t[0])<t[1])return g.showFlyTip(GetLanguage(200108)),void uiMgr.openView("ItemGetWayView",t[0]);IS(I).send_37_2()})),this.btnAwake2=this.findChild("view/btnAwake2"),this.awake2Red=this.findChild("view/btnAwake2/red"),this.txtAwake2Desc=this.findChildComponent("view/btnAwake2/desc",d),this.addComponentCallbackListener(this.btnAwake2,n.EventType.CLICK,(function(){if(IS(m).GetLevel()<b.transfer_job_level[5])g.showFlyTip(GetLanguage(200106));else{var t=IS(m).GetJob(),e=configJobs.getDataByKey(t).job_change[0],i=IS(m).GetJob(),o=IS(w).getShowEquipCfgIdByLocation(1),n=IS(m).GetTypeUsedSkin(1);IS(I).send_3_6(e),h.playSound("common_evolution"),uiMgr.openView("JobEffectView",i,o,e,n)}})),this.btnConvert=this.findChild("view/btnConvert"),this.addComponentCallbackListener(this.btnConvert,n.EventType.CLICK,(function(){uiMgr.openView("RoleAwakeItemView")}));for(var o=function(e){var i=t.findChild(r.formatStr("view/itemList/item%s",e)),o={node:i,select:v.findChild(i,"select"),bg:v.findChildComponent(i,"bg",s),icon:v.findChildComponent(i,"icon",s),levNode:v.findChild(i,"lev"),lev:v.findChildComponent(i,"lev/lev",a),red:v.findChild(i,"red")};t.addComponentCallbackListener(i,n.EventType.CLICK,(function(){t.setIndex(e)})),t.itemList[e]=o},l=1;l<=6;l++)o(l)},A.registerUpdateHandler=function(){this.addEvent(_.Awake_Info_Update,this.updateInfo,this),this.addEvent(p.GOODS_INFO_UPDATE,this.updateResShow,this),this.addEvent(_.ROLE_INFO_UPDATE,this.updateRoleInfo,this)},A.onAfterOpen=function(){var t=configGoods.getDataByKey(b.jobs_wakeup_cost[0][0]);this.loadIcon(this.iconAwakeCost,t.icon_group,t.icon);var e=IS(m).GetLevel(),i=b.transfer_job_level[5],o=e<i?"#e76262":"#5ACF97";this.txtAwake2Desc.string=f.formatStrWithMirrorDeal(GetLanguage(200582),o,e,i);var n=IS(m).GetJob(),s=configJobs.getDataByKey(n),a=IS(m).GetRoleAttr(y.ROLE_ATTR_GENDER);this.jobName.string=s.name,2==a&&s.change_times>=5?(this.loadIcon(this.jobIcon,"icon_job",r.formatStr("job_%s_2",n),null,u.ICON_SPRITE),this.jobIcon.node.setPosition(l.uiMirror?-s.position[2]:s.position[2],s.position[3]-70,0)):(this.loadIcon(this.jobIcon,"icon_job",r.formatStr("job_%s",n),null,u.ICON_SPRITE),this.jobIcon.node.setPosition(l.uiMirror?-s.position[0]:s.position[0],s.position[1]-70,0)),this.jobIcon.node.setScale(l.uiMirror?-s.scale:s.scale,s.scale,s.scale);var d=0,c=0,h=0,v=0,p=IS(m).getAwakeInfo();for(var g in s.passive_imprint)if(s.passive_imprint.hasOwnProperty(g)){var w=s.passive_imprint[g],I=p[w];if(I&&I>0){I>h&&(h=I,v=Number(g)+1);var _=configJobs_wakeup.getDataByKeys("id",w,"level",I);if(0!=_.cost.length){var A=configGoods.getDataByKey(_.cost[0][0]);IS(C).getGoodsCountByGoodsGtid(A.id)>=_.cost[0][1]&&I>c&&(c=I,d=Number(g)+1)}}}0!=d?this.setIndex(d):0!=v?this.setIndex(v):this.setIndex(1)},A.onBeforeClose=function(){this.curIndex=0,this.canUpLev=0},A.onDestroy=function(){},A.setIndex=function(t){this.curIndex!=t&&(this.curIndex=t,this.updateInfo())},A.updateRoleInfo=function(){var t=IS(m).GetLevel(),e=IS(m).GetJob(),i=configJobs.getDataByKey(e),o=IS(m).GetRoleAttr(y.ROLE_ATTR_GENDER);this.jobName.string=i.name,2==o&&i.change_times>=5?(this.loadIcon(this.jobIcon,"icon_job",r.formatStr("job_%s_2",e),null,u.ICON_SPRITE),this.jobIcon.node.setPosition(l.uiMirror?-i.position[2]:i.position[2],i.position[3]-70,0)):(this.loadIcon(this.jobIcon,"icon_job",r.formatStr("job_%s",e),null,u.ICON_SPRITE),this.jobIcon.node.setPosition(l.uiMirror?-i.position[0]:i.position[0],i.position[1]-70,0)),this.jobIcon.node.setScale(l.uiMirror?-i.scale:i.scale,i.scale,i.scale);var n=b.transfer_job_level[5],s=t<n?"#e76262":"#5ACF97";this.txtAwake2Desc.string=f.formatStrWithMirrorDeal(GetLanguage(200582),s,t,n),this.updateInfo()},A.updateResShow=function(t,e){1023!=e&&1024!=e||this.updateInfo()},A.updateInfo=function(){var t;if(0!=this.curIndex){var e=IS(m).GetJob(),o=configJobs.getDataByKey(e),n=IS(m).getAwakeInfo(),s=!0;for(var a in o.passive_imprint)if(o.passive_imprint.hasOwnProperty(a)){var d=o.passive_imprint[a],l=Number(a)+1,h=this.itemList[l];h.select.active=this.curIndex==l,this.loadIcon(h.icon,"icon_awake",d,null,u.ICON_SPRITE);var v=n[d];if(v&&0!=v){h.bg.color=new c(255,255,255),h.icon.color=new c(255,255,255),h.levNode.active=!0,h.lev.string="LV."+v;var p=configJobs_wakeup.getDataByKeys("id",d,"level",v);if(0==p.cost.length)h.red.active=!1;else{var g=configGoods.getDataByKey(p.cost[0][0]),w=IS(C).getGoodsCountByGoodsGtid(g.id);h.red.active=w>=p.cost[0][1]}}else h.bg.color=new c(128,128,128),h.icon.color=new c(128,128,128),h.levNode.active=!1,h.red.active=!1,s=!1}this.btnAwake.active=!s,this.btnAwake2.active=s&&o.change_times<6,this.btnConvert.active=s&&6==o.change_times,this.tips.active=!this.btnConvert.active,this.tipsLine.active=!this.btnConvert.active;var I=IS(m).GetLevel(),_=b.transfer_job_level[5];if(this.awake2Red.active=I>=_,s){var y=b.jobs_wakeup_cost[0],A=IS(C).getGoodsCountByGoodsGtid(y[0]);this.convertRed.active=A>0}else{var S=b.jobs_wakeup_cost[0],k=IS(C).getGoodsCountByGoodsGtid(S[0]),G=S[1];this.awakeRed.active=k>=G;var L=k>=G?"#FFFFFF":"#f33f28";this.txtAwakeCost.string=r.formatStr("<outline color=#294115 width=2><color=%s>%s</color>/%s</outline>",L,k,G)}for(var R,x=o.passive_imprint[this.curIndex-1],B=null!=(t=n[x])?t:0,D=configJobs_wakeup.getDataByKeys("id",x,"level",0==B?1:B),j="",N=i(b.jobs_wakeup_imprint_name);!(R=N()).done;){var E=R.value;E[0]==x&&(j=GetLanguage(E[1]))}if(0==B){this.bottomNode.active=!1,this.notAwake.active=!0,this.isMax.active=!1,this.attrName.string=f.formatStrWithMirrorDeal(GetLanguage(200583),j);var M=configAttribute.getDataByKey(D.value_plus[0][0]),O=IS(m).getAttrValueShow(M.id,0);this.attrValue.string=r.formatStr("<b><color=#544231>%s</color><color=#4a9d3e>%s</color></b>",M.name,"+"+O)}else{this.notAwake.active=!1,this.attrName.string=j+" LV."+B;var V=configAttribute.getDataByKey(D.value_plus[0][0]),K=IS(m).getAttrValueShow(V.id,D.value_plus[0][1]);if(this.attrValue.string=r.formatStr("<b><color=#544231>%s</color><color=#4a9d3e>%s</color></b>",V.name,"+"+K),0==D.cost.length)this.isMax.active=!0,this.bottomNode.active=!1;else{this.isMax.active=!1,this.bottomNode.active=!0;var T=configGoods.getDataByKey(D.cost[0][0]),J=IS(C).getGoodsCountByGoodsGtid(T.id);this.loadIcon(this.iconCost,T.icon_group,T.icon),this.txtCost.string=f.GetNumString(IS(C).getGoodsCountByGoodsGtid(T.id)),this.loadIcon(this.iconCostOne,T.icon_group,T.icon),this.loadIcon(this.iconCostAll,T.icon_group,T.icon);var P=J>=D.cost[0][1]?"#67e355":"#f33f28";this.txtCostOne.string=r.formatStr("<b><color=%s>%s</color>",P,D.cost[0][1]),this.canUpLev=0;for(var U=0,F=0;F<5;F++){var W=configJobs_wakeup.getDataByKeys("id",x,"level",B+F);if(!(W.cost.length>0))break;J>=U+W.cost[0][1]&&(U+=W.cost[0][1],this.canUpLev++)}this.txtAll.string=f.formatStrWithMirrorDeal(GetLanguage(200584),0==this.canUpLev?1:this.canUpLev),P=this.canUpLev>0?"#67e355":"#f33f28",this.txtCostAll.string=r.formatStr("<b><color=%s>%s</color>",P,0==U?D.cost[0][1]:U),this.oneRed.active=this.canUpLev>0&&this.canUpLev<5,this.allRed.active=5==this.canUpLev}}}},o}(A));o._RF.pop()}}}));

