System.register("chunks:///_virtual/PlantControl.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BattleData.ts","./EnumDefine.ts","./AudioMgr.ts","./TimeUtil.ts","./BattleMainServer.ts","./ChapterControl.ts","./ChapterDataCache.ts","./ChapterDefine.ts","./MessageView.ts","./PvpControl.ts","./PvpDataCache.ts","./RoleDataCache.ts","./PlantDataCache.ts","./PlantDefine.ts"],(function(e){"use strict";var a,t,n,r,_,o,i,s,m,l,d,h,c,f,u,p,I,v,g;return{setters:[function(e){a=e.createForOfIteratorHelperLoose},function(e){t=e.cclegacy},function(e){n=e.ChapterType,r=e.PlayerData,_=e.BattleData},function(e){o=e.RunMode,i=e.RunState},function(e){s=e.audioMgr},function(e){m=e.default},function(e){l=e.BattleMainServer},function(e){d=e.default},function(e){h=e.ChapterDataCache},function(e){c=e.ChapterEventDefine},function(e){f=e.default},function(e){u=e.default},function(e){p=e.PvpDataCache},function(e){I=e.RoleDataCache},function(e){v=e.PlantDataCache},function(e){g=e.PlantEventDefine}],execute:function(){t._RF.push({},"f7ec8tSCuZFIJ8dQgxCO8fM","PlantControl",void 0);var L=[];e("default",function(){var e=t.prototype;function t(){netManager.addEventListener("home.home_farm_info_s2c",this.on_home_farm_info_s2c,this),netManager.addEventListener("home.home_farm_plant_s2c",this.on_home_farm_plant_s2c,this),netManager.addEventListener("home.home_farm_fertilize_s2c",this.on_home_farm_fertilize_s2c,this),netManager.addEventListener("home.home_farm_pick_s2c",this.on_home_farm_pick_s2c,this),netManager.addEventListener("home.home_farm_harvest_s2c",this.on_home_farm_harvest_s2c,this),netManager.addEventListener("home.home_farm_building_lev_up_s2c",this.on_home_farm_building_lev_up_s2c,this),netManager.addEventListener("home.home_farm_battle_report_list_s2c",this.on_home_farm_battle_report_list_s2c,this),netManager.addEventListener("home.home_farm_log_list_s2c",this.on_home_farm_log_list_s2c,this),netManager.addEventListener("home.home_farm_search_list_s2c",this.on_home_farm_search_list_s2c,this),netManager.addEventListener("home.home_farm_search_refresh_s2c",this.on_home_farm_search_refresh_s2c,this),netManager.addEventListener("home.home_farm_battle_begin_s2c",this.on_home_farm_battle_begin_s2c,this),netManager.addEventListener("home.home_farm_battle_result_s2c",this.on_home_farm_battle_result_s2c,this),netManager.addEventListener("home.home_farm_play_video_s2c",this.on_home_farm_play_video_s2c,this),netManager.addEventListener("home.home_farm_update_self_stolen_s2c",this.on_home_farm_update_self_stolen_s2c,this),netManager.addEventListener("home.home_farm_battle_begin_fail_s2c",this.on_home_farm_battle_begin_fail_s2c,this),netManager.addEventListener("home.home_farm_robber_share_s2c",this.on_home_farm_robber_share_s2c,this),netManager.addEventListener("home.home_farm_robber_share_update_s2c",this.on_home_farm_robber_share_update_s2c,this),netManager.addEventListener("home.home_farm_robber_share_ignore_s2c",this.on_home_farm_robber_share_ignore_s2c,this),normalEvent.on(c.CHAPTER_BATTLE_RESUTL,this.onPvpOrRecordVideoEnd,this)}return e.clear=function(){console.log("清理PlantControl")},e.onPvpOrRecordVideoEnd=function(e,t,r,_,i,s){if(t==n.Farm){if(L.length>0){for(var m,l=a(L);!(m=l()).done;){var d,h=m.value,c=h[0],f=h[1];(d=uiMgr).openView.apply(d,[c].concat(f))}L=[]}_!=o.Record&&uiMgr.openView("FarmPvpResultView",t)}},e.reqFarmInfo=function(e){null==e&&(e=0),e==IS(I).GetRoleId()&&(e=0),0!=e&&m.serverTime-IS(v).lastReqTime<1||(IS(v).lastReqTime=m.serverTime,netManager.send("home.home_farm_info_c2s",{role_id:e}))},e.on_home_farm_info_s2c=function(e){IS(v).onHomeFarmInfoBack(e)},e.reqHomeFarmPlant=function(e,a){netManager.send("home.home_farm_plant_c2s",{seed_id:e,land_id:a})},e.on_home_farm_plant_s2c=function(e){0!=e.code&&f.showFlyTip(configErrorInfo.getDataByKey(e.code).info);var a=e.new_land;if(null!=a){var t=IS(v).landIdToInfo[a.id];null!=a.crop&&t&&null==t.crop&&normalEvent.emit(g.FARM_SEED_PLANT_ACTION,a.id),IS(v).landIdToInfo[a.id]=a}IS(v).updateFarmRedPoint(),normalEvent.emit(g.ROLE_LAND_INFO_UPDATE,IS(I).GetRoleId(),a)},e.reqHomeFarmFertilize=function(e,a,t,n){netManager.send("home.home_farm_fertilize_c2s",{role_id:e,land_id:a,fertilizer_id:t,num:n})},e.on_home_farm_fertilize_s2c=function(e){0!=e.code&&f.showFlyTip(configErrorInfo.getDataByKey(e.code).info);var a=e.role_id,t=e.new_land;a==IS(I).GetRoleId()&&null!=t&&(IS(v).landIdToInfo[t.id]=t,IS(v).updateFarmRedPoint()),normalEvent.emit(g.ROLE_LAND_INFO_UPDATE,a,t)},e.reqHomeFarmPick=function(e,a){netManager.send("home.home_farm_pick_c2s",{role_id:e,land_id:a})},e.on_home_farm_pick_s2c=function(e){0!=e.code&&f.showFlyTip(configErrorInfo.getDataByKey(e.code).info);var a=e.role_id,t=e.new_land;a==IS(I).GetRoleId()&&null!=t&&(IS(v).landIdToInfo[t.id]=t,IS(v).updateFarmRedPoint()),normalEvent.emit(g.ROLE_LAND_INFO_UPDATE,a,t)},e.reqHomeFarmHarvest=function(e){netManager.send("home.home_farm_harvest_c2s",{land_id:e})},e.on_home_farm_harvest_s2c=function(e){0!=e.code&&f.showFlyTip(configErrorInfo.getDataByKey(e.code).info);var a=e.new_land;null!=a&&(IS(v).landIdToInfo[a.id]=a);var t=IS(v).farmLevel;IS(v).farmExp;IS(v).farmLevel=e.level,IS(v).farmExp=e.exp;var n=e.level>t;IS(v).updateFarmRedPoint(),normalEvent.emit(g.FARM_LAND_HARVEST_FINISH,a.id,e.reward_list,n)},e.reqBattleLogList=function(e){void 0===e&&(e=1),netManager.send("home.home_farm_battle_report_list_c2s",{page:e})},e.on_home_farm_battle_report_list_s2c=function(e){normalEvent.emit(g.FARM_LOG_BATTLE,e)},e.reqDetailLogList=function(e){void 0===e&&(e=1),netManager.send("home.home_farm_log_list_c2s",{page:e})},e.on_home_farm_log_list_s2c=function(e){normalEvent.emit(g.FARM_LOG_DETAIL,e)},e.reqHomeFarmBuildingLevUp=function(e){netManager.send("home.home_farm_building_lev_up_c2s",{cfg_id:e})},e.on_home_farm_building_lev_up_s2c=function(e){var a=e.building,t=a.cfg_id,n=IS(v).buildingIdToinfo[t]?IS(v).buildingIdToinfo[t].level:0,r=IS(v).buildingIdToinfo[t]?IS(v).buildingIdToinfo[t].end_time:0,_=a.level,o=a.end_time;0==r&&0!=o&&s.playSound("zhuangyuan_jianzhushengji"),IS(v).buildingIdToinfo[t]=a,IS(v).updateFarmRedPoint(),normalEvent.emit(g.FARM_BUILDING_UPDATE,t),n<_&&normalEvent.emit(g.FARM_BUILDING_UPGRADE_FINISH,t)},e.reqStealList=function(){netManager.send("home.home_farm_search_list_c2s",{})},e.on_home_farm_search_list_s2c=function(e){IS(v).stealSearchList=e.search_list,IS(v).stealEnemyList=e.enemy_list,IS(v).stealSearchRefreshTime=e.cd,normalEvent.emit(g.FARM_STEAL_SEARCH_LIST)},e.reqUpdateStealList=function(){netManager.send("home.home_farm_search_refresh_c2s",{})},e.on_home_farm_search_refresh_s2c=function(e){IS(v).stealSearchList=e.search_list,IS(v).stealSearchRefreshTime=e.cd,normalEvent.emit(g.FARM_STEAL_REFRESH_LIST)},e.reqHomeFarmBattleBegin=function(e,a,t,r){var _=IS(h);0==_.currentLoadType&&(_.chapterType=n.Farm,_.currentLoadType=_.chapterType,_.battleData=null,IS(v).curFightLandId=r,(L=[]).push(["PlantMainView",[t,!0]]),netManager.send("home.home_farm_battle_begin_c2s",{crop_id:e,robber_id:a}),battleMain.enterChapter(0),normalEvent.emit(c.BATTLE_STATE,n.Farm,!0))},e.on_home_farm_battle_begin_s2c=function(e){var a=IS(h);if(a.currentLoadType==n.Farm){a.currentLoadType=0,uiMgr.closeAllView(["MainView","MessageView","GuideView","BattleHubView"]),uiMgr.getOpenView("MainView").setIndex(0);var t=new _;t.chapterId=100001,t.seed=e.seed,t.chapterType=n.Farm,t.playerList[1]=new r(1),t.playerList[2]=new r(2);var o=IS(I).GetRoleId();IS(u).setPlayerList(e.atk_data,t.playerList[1]),IS(u).setPlayerList(e.def_data,t.playerList[2]);var s=new l(e.seed);for(s.start(t);s.runState==i.Running;)s.update(s.frameTime);this.reqHomeFarmBattleResult(e.vid,0==s.result?e.atk_data.id:e.def_data.id),s.stop();var m=new _;m.chapterType=n.Farm,m.chapterId=100001,m.seed=e.seed,m.playerList[1]=new r(1),m.playerList[2]=new r(2),IS(u).setPlayerList(e.atk_data,m.playerList[1]),IS(u).setPlayerList(e.def_data,m.playerList[2]),m.playerImage=e.atk_data.id!=o,IS(h).battleData=m,normalEvent.emit(g.FARM_DEFEND_INFO_BACK,e)}},e.reqHomeFarmBattleResult=function(e,a){netManager.send("home.home_farm_battle_result_c2s",{vid:e,win_role_id:a})},e.on_home_farm_battle_result_s2c=function(e){var a={isWin:1==e.is_win,objs:[{name:IS(I).GetRoleName(),head:IS(I).GetHeadUrl()},{name:e.e_name,head:null!=e.e_head?e.e_head.url:""}]};1==e.is_win&&IS(v).curFightLandId&&(IS(v).waitShowDeafeatThiefLand=IS(v).curFightLandId,IS(v).curFightLandId=null),IS(p).result=a},e.reqBattleRecordInfo=function(e,a){var t=IS(h);0==t.currentLoadType&&(t.chapterType=n.Farm,t.currentLoadType=t.chapterType,t.battleData=null,L=[],a&&(L.push(["PlantMainView",[a,!0]]),L.push(["PlantLogView",[1,a]])),netManager.send("home.home_farm_play_video_c2s",{vid:e}))},e.on_home_farm_play_video_s2c=function(e){var a=IS(h);if(a.currentLoadType==n.Farm&&(a.currentLoadType=0,0!=e.vid)){uiMgr.close("ChatView"),battleMain.enterChapter(0);var t=new _;t.chapterId=100001,t.seed=e.seed,t.chapterType=n.Farm,t.recordType=1,t.recordWin=e.winner_id==e.atk_data.id?1:2,t.source=e.source,t.playerList[1]=new r(1),t.playerList[2]=new r(2);var o=IS(I).GetRoleId();o!=e.atk_data.id&&o!=e.def_data.id&&(o=e.atk_data.id),IS(u).setPlayerList(e.atk_data,t.playerList[1]),IS(u).setPlayerList(e.def_data,t.playerList[2]),t.playerImage=e.atk_data.id!=o,a.battleData=t,normalEvent.emit(c.BATTLE_STATE,n.Farm,!0)}},e.on_home_farm_update_self_stolen_s2c=function(e){var a=e.type,t=e.self_stolen;new Array;if(0==a)IS(v).stolenList.push(t),f.showFlyTip(GetLanguage(200493));else{for(var n=IS(v).stolenList.length-1;n>=0;n--)IS(v).stolenList[n].id==t.id&&IS(v).stolenList.splice(n,1);f.showFlyTip(1==a?GetLanguage(200494):GetLanguage(200495))}normalEvent.emit(g.FARM_STOLEN_INFO_UPDATE,a,t)},e.on_home_farm_battle_begin_fail_s2c=function(e){if(0!=e.code){f.showFlyTip(configErrorInfo.getDataByKey(e.code).info);var a=IS(h);a.currentLoadType==n.Farm&&(a.currentLoadType=0,IS(v).curFightLandId=null,L=[],IS(d).reqEnterChapter(0),normalEvent.emit(c.BATTLE_STATE,n.Farm,!1)),normalEvent.emit(g.FARM_BATTLE_REQ_FAIL)}},e.req_home_farm_robber_share_c2s=function(e,a,t,n){netManager.send("home.home_farm_robber_share_c2s",{target_id:e,land_id:a,robber_id:t,crop_id:n})},e.on_home_farm_robber_share_s2c=function(e){},e.req_home_farm_robber_share_update_c2s=function(){netManager.send("home.home_farm_robber_share_update_c2s",{})},e.on_home_farm_robber_share_update_s2c=function(e){if(0==e.type){for(var t,n=[],r=a(e.robber_share);!(t=r()).done;){var _=t.value;n[_.crop_id]=_}IS(v).helpList=n}else if(1==e.type)for(var o,i=IS(v).helpList,s=a(e.robber_share);!(o=s()).done;){var m=o.value;i[m.crop_id]=m}else if(2==e.type)for(var l,d=IS(v).helpList,h=a(e.robber_share);!(l=h()).done;){delete d[l.value.crop_id]}normalEvent.emit(g.FARM_HELP_LIST)},e.req_home_farm_robber_share_ignore_c2s=function(){netManager.send("home.home_farm_robber_share_ignore_c2s",{})},e.on_home_farm_robber_share_ignore_s2c=function(e){IS(v).helpList=[],normalEvent.emit(g.FARM_HELP_LIST)},t}());t._RF.pop()}}}));

