System.register("chunks:///_virtual/RoleAttrCompareView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./RankTitle.ts","./UILabel.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./index57.ts","./ConfigGlobal.ts","./ArtifactDataCache.ts","./EquipModel.ts","./FriendModel.ts","./HorseDataChche.ts","./FrameDataCache.ts","./TitleDataCache.ts","./RoleControl.ts","./RoleDefine.ts","./WingDataCache.ts","./RoleDataCache.ts","./BaseView.ts"],(function(t){"use strict";var e,i,o,n,r,a,s,l,h,d,f,_,u,c,v,g,m,R,p,I,T,A,E,C,L,w,y,D,O,S;return{setters:[function(t){e=t.inheritsLoose,i=t.createForOfIteratorHelperLoose},function(t){o=t.cclegacy,n=t.Button,r=t.ScrollView,a=t.Label,s=t.UITransform,l=t.Sprite,h=t.sys,d=t.js,f=t.Widget},function(t){_=t.RankTitle,u=t.TitleType},function(t){c=t.UILabel},function(t){v=t.ListItem},function(t){g=t.default},function(t){m=t.default},null,function(t){R=t.ConfigGlobal},function(t){p=t.ArtifactDataCache},function(t){I=t.EquipModel},function(t){T=t.FriendModel},function(t){A=t.HorseDataCache},function(t){E=t.FrameDataCache},function(t){C=t.TitleDataCache},function(t){L=t.default},function(t){w=t.RoleEventDefine,y=t.PlayerAttr},function(t){D=t.WingDataCache},function(t){O=t.RoleDataCache},function(t){S=t.BaseView}],execute:function(){o._RF.push({},"46b74orIzlPapgqYbc7vEcl","RoleAttrCompareView",void 0);t("default",function(t){function o(){var e,i;return(i=t.call(this)||this).attrList=void 0,i.attrIdToValue={},i.otherIdToValue={},i.other_attr=void 0,i.leftRoleNode=void 0,i.leftTitleIcon=void 0,i.leftName=void 0,i.leftPower=void 0,i.leftPowerTrans=void 0,i.leftUp=void 0,i.leftDown=void 0,i.leftmodel=void 0,i.leftHead=void 0,i.leftimgHeadFrame=void 0,i.rightRoleNode=void 0,i.rightTitleIcon=void 0,i.rightName=void 0,i.rightPower=void 0,i.rightUp=void 0,i.rightDown=void 0,i.rightmodel=void 0,i.rightHead=void 0,i.rightimgHeadFrame=void 0,i.show_list={},i.delay_time=0,i.is_need_update=!1,i.roleInfo=((e={})[y.ROLE_ATTR_GOLD]=0,e[y.ROLE_ATTR_DIAMOND]=0,e[y.ROLE_RELIC_FRAG]=0,e[y.ROLE_FAKE_RECHARE]=0,e[y.ROLE_ATTR_LVL]=0,e[y.ROLE_ATTR_EXP]=0,e[y.ROLE_ATTR_ID]=0,e[y.ROLE_ATTR_NAME]="",e[y.ROLE_ATTR_VIP]=0,e[y.ROLE_ATTR_SERVER]=0,e[y.ROLE_ATTR_CUR_POWER]=0,e[y.ROLE_ATTR_GUILD_NAME]="",e[y.ROLE_ATTR_POWER_SHOW]=0,e[y.ROLE_ATTR_CUR_JOB]=0,e[y.ROLE_ATTR_JOB_TIMES]=0,e[y.ROLE_ATTR_STYLE]=0,e[y.ROLE_ATTR_RENAME]=0,e[y.ROLE_ATTR_GENDER]=0,e[y.ROLE_ATTR_SKIN]=0,e[y.ROLE_ATTR_HEAD_ID]=0,e[y.ROLE_ATTR_HEAD_FRAME_ID]=0,e[y.ROLE_ATTR_HEAD_URL]="",e),i.open_type=void 0,i.role_id=void 0,i.data=void 0,i.tips_data=void 0,i.name="RoleAttrCompareView",i.url="ui/module/role/RoleAttrCompareView",i}e(o,t);var f=o.prototype;return f.onInit=function(){var t=this,e=this.findChild("node/btnClose");this.addComponentCallbackListener(e,n.EventType.CLICK,(function(){t.onCloseClick()}));var i=this.findChildComponent("node/attrList",r);this.attrList=this.addUIList(i,H),this.leftRoleNode=this.findChild("node/role1/role"),this.leftTitleIcon=this.findChild("node/role1/title"),this.leftName=this.findChildComponent("node/role1/name",a),this.leftPower=this.findChildComponent("node/role1/score",a),this.leftPowerTrans=this.findChildComponent("node/role1/score",s),this.leftUp=this.findChild("node/role1/score/up"),this.leftDown=this.findChild("node/role1/score/down"),this.leftHead=this.findChildComponent("node/role1/imgFrame/frame/imgIcon",l),this.leftimgHeadFrame=this.findChildComponent("node/role1/imgFrame/frame/imgHeadFrame",l),this.rightRoleNode=this.findChild("node/role2/role"),this.rightTitleIcon=this.findChild("node/role2/title"),this.rightName=this.findChildComponent("node/role2/name",a),this.rightPower=this.findChildComponent("node/role2/score",a),this.rightUp=this.findChild("node/role2/score/up"),this.rightDown=this.findChild("node/role2/score/down"),this.rightHead=this.findChildComponent("node/role2/imgFrame/frame/imgIcon",l),this.rightimgHeadFrame=this.findChildComponent("node/role2/imgFrame/frame/imgHeadFrame",l),this.rightUp.active=!1,this.rightDown.active=!1},f.onCloseClick=function(){this.close()},f.registerUpdateHandler=function(){this.addEvent(w.ROLE_ATTR_LIST_UPDATE_VIRTUAL,this.updateInfo,this),this.addEvent(w.ROLE_ATTR_LIST_UPDATE_COMPARE,this.cacheTipsInfo,this)},f.cacheTipsInfo=function(t){this.tips_data=t;for(var e,o=t.my_attr||{},n=t.target_attr||{},r=i(o);!(e=r()).done;){var a=e.value;this.attrIdToValue[a.k]=a.v}for(var s,l=i(n);!(s=l()).done;){var h=s.value;this.otherIdToValue[h.k]=h.v}for(var d=R.show_attr,f={},_=0;_<d.length;_++)f[d[_]]=1;this.show_list=f;var u=this.GetAttrList(1),c=[GetLanguage(200103),u],v=this.GetAttrList(2),g=[GetLanguage(200104),v],m=[];m.push(c),m.push(g),this.attrList.datas=m,this.is_need_update=!0,this.updateRolePanel(this.data.info_list),this.updateMyRolePanel()},f.onAfterOpen=function(){this.open_type=this.openArgs[0];var t,e=this.openArgs[1];if(1==this.open_type)t=e.other_role_info[0].sp_list,this.data=e.other_role_info[0],this.role_id=this.data.role_id;else if(2==this.open_type){var i=e.arena_role;t=i.attr_list,this.data=i,this.role_id=this.data.id}this.other_attr=t,this.attrIdToValue={},this.otherIdToValue={},IS(L).send_3_7(1)},f.onBeforeClose=function(){null!=this.leftmodel&&this.removeUnitModel(this.leftmodel),null!=this.rightmodel&&this.removeUnitModel(this.rightmodel)},f.onUpdate=function(t){this.delay_time+=t,this.delay_time>1&&(this.leftUp.setPosition(this.leftPowerTrans.width+10,0),this.leftDown.setPosition(this.leftPowerTrans.width+10,0),this.delay_time-=1,this.is_need_update&&(this.is_need_update=!1,this.attrList.updateAll()))},f.onDestroy=function(){},f.GetAttrList=function(t){var e=[],o=R.show_attr2;2==t?o=R.advanced_attr:3==t&&(o=R.finally_attr);for(var n,r=i(o);!(n=r()).done;){var a=n.value,s={id:a,me_val:this.attrIdToValue[a]||0,other_val:this.otherIdToValue[a]||0};e.push(s)}return e},f.updateInfo=function(t){for(var e,o=i(t);!(e=o()).done;){var n=e.value;this.attrIdToValue[n.k]=n.v}for(var r,a=i(this.other_attr);!(r=a()).done;){var s=r.value;this.otherIdToValue[s.k]=s.v}this.tips_data=null,IS(L).send_role_sp(this.role_id,IS(T).cacheLookType)},f.UpdateChangeInfo=function(t){var e=t.kv,o=t.ks;if(null!=e)for(var n,r=i(e);!(n=r()).done;){var a=n.value;this.updateRoleAttr(a.k,a.v)}if(null!=o)for(var s,l=i(o);!(s=l()).done;){var h=s.value;this.updateRoleAttr(h.k,h.s)}},f.updateRoleAttr=function(t,e){var i=this.roleInfo[t];if(null!=i)return i=e,this.roleInfo[t]=i,i},f.updateMyRolePanel=function(){this.leftName.string=IS(O).GetRoleName(),this.leftPower.string=m.GetNumString(IS(O).GetPowerInfoByID(0)),this.leftDown.active=this.roleInfo[y.ROLE_ATTR_POWER_SHOW]>IS(O).GetPowerInfoByID(0),this.leftUp.active=this.roleInfo[y.ROLE_ATTR_POWER_SHOW]<IS(O).GetPowerInfoByID(0),this.leftUp.setPosition(this.leftPowerTrans.width+20,0),this.leftDown.setPosition(this.leftPowerTrans.width+20,0);var t=IS(O).GetRoleAttr(y.ROLE_ATTR_HEAD_URL);this.loadRemoteIcon(t,this.leftHead);var e=IS(E).curFrameId;if(e>0){var i=configAvatar_frame.getDataByKey(e);this.loadIcon(this.leftimgHeadFrame,"icon_frame",i.icon),this.leftimgHeadFrame.node.active=!0}else this.leftimgHeadFrame.node.active=!1;null!=this.leftmodel&&this.removeUnitModel(this.leftmodel);var o=IS(I).getShowEquipCfgIdByLocation(1),n=IS(D).wing_id,r=IS(I).getShowEquipCfgIdByLocation(2),a=IS(I).getShowEquipCfgIdByLocation(3),s=IS(O).GetTypeUsedSkin(1);this.leftmodel=this.addUnitModel({job:IS(O).GetTypeUsedSkin(0),dressId:IS(O).GetTypeUsedSkin(2)||0,gender:IS(O).GetRoleAttr(y.ROLE_ATTR_GENDER),weapon:o,ornaments:r,face:a,color:s,parent:this.leftRoleNode,mount:IS(A).horse_id,shenqi:IS(p).artifact_id,wing:n},null,.8),this.getUnitModel(this.leftmodel).dir=h.uiMirror?-1:1;var l=IS(C).curTitleId;if(l>0){var d=this.getUnitModel(this.leftmodel).modelHeight;this.leftTitleIcon.setPosition(0,d+240),this.leftTitleIcon.active=!0,new _(this,this.leftTitleIcon).SetRankTitle(l,u.NORMAL)}else this.leftTitleIcon.active=!1;var f=0;if(IS(O).GetRoleAttr(y.ROLE_ATTR_HEAD_FRAME_ID)>0&&(f=IS(O).GetRoleAttr(y.ROLE_ATTR_HEAD_FRAME_ID)),f>0){var c=configAvatar_frame.getDataByKey(f);this.loadIcon(this.leftimgHeadFrame,"icon_frame",c.icon),this.leftimgHeadFrame.node.active=!0}else this.leftimgHeadFrame.node.active=!1},f.updateRolePanel=function(t){this.UpdateChangeInfo(t),this.rightName.string=this.roleInfo[y.ROLE_ATTR_NAME]+"",this.rightPower.string=m.GetNumString(this.roleInfo[y.ROLE_ATTR_POWER_SHOW]);var e=this.roleInfo[y.ROLE_ATTR_HEAD_URL];this.loadRemoteIcon(e,this.rightHead);var i=this.roleInfo[y.ROLE_ATTR_HEAD_FRAME_ID];if(i>0){var o=configAvatar_frame.getDataByKey(i);this.loadIcon(this.rightimgHeadFrame,"icon_frame",o.icon),this.rightimgHeadFrame.node.active=!0}else this.rightimgHeadFrame.node.active=!1;this.leftDown.active=this.roleInfo[y.ROLE_ATTR_POWER_SHOW]>IS(O).GetPowerInfoByID(0),this.leftUp.active=this.roleInfo[y.ROLE_ATTR_POWER_SHOW]<IS(O).GetPowerInfoByID(0);var n=this.data.figure;null!=this.rightmodel&&this.removeUnitModel(this.rightmodel);for(var r=n.hair_figure>0&&n.hair_figure||6,a=0,s=0,l=0,d=0,f=n.skin_list||[],c=0;c<n.equip_list.length;c++)1==n.equip_list[c].k&&(a=n.equip_list[c].v),2==n.equip_list[c].k&&(s=n.equip_list[c].v),3==n.equip_list[c].k&&(l=n.equip_list[c].v),5==n.equip_list[c].k&&(d=n.equip_list[c].v);for(var v=0,g=0;g<f.length;g++)2==f[g].k&&(v=f[g].v);var R=n.gender||1;this.rightmodel=this.addUnitModel({job:n.job_figure,dressId:v,gender:R,weapon:a,ornaments:s,face:l,color:r,parent:this.rightRoleNode,mount:n.mount_figure,shenqi:n.artifact_figure,wing:d},null,.8),this.getUnitModel(this.rightmodel).mount=n.mount_figure,this.getUnitModel(this.rightmodel).dir=h.uiMirror?-1:1;var p=n.current_title;if(p>0){var I=this.getUnitModel(this.rightmodel).modelHeight;this.rightTitleIcon.active=!0,new _(this,this.rightTitleIcon).SetRankTitle(p,u.NORMAL),this.rightTitleIcon.setPosition(0,I+240)}else this.rightTitleIcon.active=!1;var T=0;if(this.roleInfo[y.ROLE_ATTR_HEAD_FRAME_ID]>0&&(T=this.roleInfo[y.ROLE_ATTR_HEAD_FRAME_ID]),null!=this.data.head&&(T=this.data.head.frame_id),T>0){var A=configAvatar_frame.getDataByKey(T);this.loadIcon(this.rightimgHeadFrame,"icon_frame",A.icon),this.rightimgHeadFrame.node.active=!0}else this.rightimgHeadFrame.node.active=!1},f.getRoleAttrById=function(t){var e=this.attrIdToValue[t];return null==e?0:e},f.getAttrValue=function(t){var e=configAttribute.getDataByKey(t),i=this.getRoleAttrById(t);if(0==i&&3==e.type&&null!=e.group){var o=this.getRoleAttrById(e.group-1e3),n=this.getRoleAttrById(e.group),r=1;2==e.show_type&&(r=1e4),i=(o-n)/n*r}return 2==e.show_type?d.formatStr("%s%",m.GetNumString(i/100)):3==e.show_type?m.GetNumString(Math.floor(i/100)/100):m.GetNumString(i)},o}(S));var H=function(t){function i(){for(var e,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return(e=t.call.apply(t,[this].concat(o))||this).txtTitle=void 0,e.scroll=void 0,e}e(i,t);var o=i.prototype;return o.onInit=function(){this.adaptiveSize=!0,this.txtTitle=g.findChildComponent(this.node,"title/Label",a);var t=g.findChildComponent(this.node,"scroll",r);this.scroll=this.view.addUIList(t,U,!1),this.scroll.touchEvent=!1},o.onRender=function(t,e){this.txtTitle.string=t[0];var i=40*Math.ceil(t[1].length)+20+5+15+.01;this.scroll.height=i,this.scroll.datas=t[1],this.ut.height=42+i},i}(v),U=function(t){function i(){for(var e,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return(e=t.call.apply(t,[this].concat(o))||this).txtName=void 0,e.txtValue=void 0,e.txtValue2=void 0,e.upIcon=void 0,e.dowenIcon=void 0,e.attrBtn=void 0,e.txtNameTrans=void 0,e.p_view=void 0,e}e(i,t);var o=i.prototype;return o.onInit=function(){var t=this;if(this.txtName=g.findChildComponent(this.node,"txtAttrName",c),this.txtValue=g.findChildComponent(this.node,"txtAttrValue",a),this.txtValue2=g.findChildComponent(this.node,"txtAttrValue2",a),this.upIcon=g.findChild(this.node,"up"),this.dowenIcon=g.findChild(this.node,"down"),this.attrBtn=g.findChild(this.node,"txtAttrName/btnTips"),this.txtNameTrans=g.findChildComponent(this.node,"txtAttrName",s),this.p_view=this.view,this.view.addComponentCallbackListener(this.attrBtn,n.EventType.CLICK,(function(){t.p_view.role_id>1e5&&uiMgr.openView("RoleAttrCompareTipsView",t.p_view.role_id,t.data,t.p_view.tips_data)})),h.uiMirror){var e=g.findChildComponent(this.node,"txtAttrName/btnTips",f);e.alignFlags=12,e.left=203.285}},o.getAttrValueById=function(t,e){e=e||0;var i=m.GetNumString(e)+"",o=configAttribute.getDataByKey(t);return 2==o.show_type?i=d.formatStr("%s%",m.GetNumString(e/100)):3==o.show_type&&(i=m.GetNumString(Math.floor(e/100)/100)+""),i},o.onRender=function(t,e){this.attrBtn.active=this.p_view.role_id>1e5&&this.p_view.show_list[t.id]&&1==this.p_view.show_list[t.id],t.me_val<=0&&t.other_val<=0&&(this.attrBtn.active=!1);var i=configAttribute.getDataByKey(t.id);this.txtName.string=i.name,this.txtValue.string=this.getAttrValueById(t.id,t.me_val),this.txtValue2.string=this.getAttrValueById(t.id,t.other_val),this.upIcon.active=t.me_val>t.other_val,this.dowenIcon.active=t.me_val<t.other_val},i}(v);o._RF.pop()}}}));

