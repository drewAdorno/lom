System.register("chunks:///_virtual/ActivityStrategyMilestoneView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./UIRichText.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./AdDefine.ts","./AdModel.ts","./PayDataCache.ts","./PayDefine.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./ActivityStrategyControl.ts","./ActivityStrategyDataCache.ts","./BaseView.ts"],(function(t){"use strict";var i,e,n,s,a,o,d,r,h,c,l,f,v,u,m,C,g,L,p,y,b,S,w,T,I,G;return{setters:[function(t){i=t.inheritsLoose},function(t){e=t.cclegacy,n=t.Button,s=t.Label,a=t.ScrollView,o=t.sys,d=t.Sprite,r=t.Vec3},function(t){h=t.ItemGrid},function(t){c=t.ListItem},function(t){l=t.UIRichText},function(t){f=t.default},function(t){v=t.default},function(t){u=t.default},null,function(t){m=t.ADS_TYPE},function(t){C=t.AdModel},function(t){g=t.default},function(t){L=t.PayEventDefine,p=t.GiftType},function(t){y=t.default},function(t){b=t.ActivityEventDefine,S=t.ActivityType,w=t.ActivityState},function(t){T=t.default},function(t){I=t.default},function(t){G=t.BaseView}],execute:function(){e._RF.push({},"bc98943GtFK1KTA/85S9htS","ActivityStrategyMilestoneView",void 0);t("default",function(t){function e(){var i;return(i=t.call(this)||this).txtLeftTime=void 0,i.taskList=void 0,i.deltaTime=0,i.leftTime=0,i.canUpdate=!1,i.name="ActivityStrategyMilestoneView",i.url="ui/module/ActivityStrategy/ActivityStrategyMilestoneView",i}i(e,t);var d=e.prototype;return d.onInit=function(){var t=this,i=this.findChild("imgMask");this.addComponentCallbackListener(i,n.EventType.CLICK,(function(){t.close()}));var e=this.findChild("btnClose");this.addComponentCallbackListener(e,n.EventType.CLICK,(function(){t.close()})),this.txtLeftTime=this.findChildComponent("container/topBg/txtLeftTime",s);var o=this.findChildComponent("container/taskList",a);this.taskList=this.addUIList(o,_)},d.registerUpdateHandler=function(){this.addEvent(b.OnStrategyInfoUpdate,this.OnTaskUpdate,this),this.addEvent(b.OnStrategyBattlePassUpdate,this.OnTaskUpdate,this),this.addEvent(L.PAY_CUSTOM_INFO_SET,this.OnTaskUpdate,this),this.addEvent(L.PAY_INFO_UPDATE,this.OnTaskUpdate,this)},d.onAfterOpen=function(){var t;IS(T).send_act_strategy_dungeon_info_c2s();var i=IS(y).GetActivityInfo(S.Strategy),e=null!=(t=i.state_time[i.state])?t:i.state_time[w.Open];if(this.leftTime=e.end_time-u.serverTime,this.leftTime>0){this.canUpdate=!0;var n=v.formatStrWithMirrorDeal(GetLanguage(200043),u.formatActivityTimeStringForSecond(this.leftTime));o.uiMirror&&(n=u.formatActivityTimeStringForSecond(this.leftTime)),this.txtLeftTime.string=n}else this.txtLeftTime.string=GetLanguage(200026);this.OnTaskUpdate()},d.onBeforeClose=function(){this.canUpdate=!1,IS(I).SetMillionStoneShowRedData()},d.onDestroy=function(){},d.onUpdate=function(t){if(this.canUpdate&&(this.deltaTime=this.deltaTime+t,this.deltaTime>=1))if(this.deltaTime=0,this.leftTime=this.leftTime-1,this.leftTime>0){var i=v.formatStrWithMirrorDeal(GetLanguage(200043),u.formatActivityTimeStringForSecond(this.leftTime));o.uiMirror&&(i=u.formatActivityTimeStringForSecond(this.leftTime)),this.txtLeftTime.string=i}else this.txtLeftTime.string=GetLanguage(200026),this.canUpdate=!1},d.OnTaskUpdate=function(){for(var t=configStrategy_activity_milestone.getDatas(),i=IS(I).battle_pass_id,e=[],n=0;n<t.length;n++)(t[n].id>=i||t[n].id>=t.length-3)&&e.push(t[n]);this.taskList.datas=e},e}(G));var _=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return(i=t.call.apply(t,[this].concat(n))||this).btnList=void 0,i.btnOriPos=void 0,i.rewarded=void 0,i.btnGet=void 0,i.btnGetLable=void 0,i.btnLock=void 0,i.btnCharge=void 0,i.btnChargeTxt=void 0,i.ad=void 0,i.adCount=void 0,i.arrowNormal=void 0,i.sel=void 0,i.tipNode=void 0,i.tipNum=void 0,i.target=void 0,i.rewardList=void 0,i.red=void 0,i.isPass=void 0,i.isUnLock=void 0,i.nodeChoose=void 0,i.notSet1=void 0,i.notSet2=void 0,i.itemGrid1=void 0,i.itemGrid2=void 0,i.chooseItems=[],i}i(e,t);var o=e.prototype;return o.onInit=function(){var t=this;this.rewarded=f.findChild(this.node,"rewarded"),this.btnList=f.findChild(this.node,"btnList"),this.btnOriPos=this.btnList.position,this.red=f.findChild(this.node,"btnList/red"),this.btnLock=f.findChild(this.node,"btnList/btnLock"),this.btnChargeTxt=f.findChildComponent(this.node,"btnList/btnCharge/Label",s),this.btnCharge=f.findChildComponent(this.node,"btnList/btnCharge",d),this.view.addComponentCallbackListener(this.btnCharge.node,n.EventType.CLICK,(function(){t.ClickReward()})),this.btnGet=f.findChildComponent(this.node,"btnList/btnGet",d),this.view.addComponentCallbackListener(this.btnGet.node,n.EventType.CLICK,(function(){t.ClickReward()})),this.btnGetLable=f.findChild(this.node,"btnList/btnGet/Label"),this.ad=f.findChild(this.node,"btnList/btnGet/ad"),this.adCount=f.findChildComponent(this.node,"btnList/btnGet/ad/txtCount",s),this.arrowNormal=f.findChild(this.node,"arrowNormal"),this.sel=f.findChild(this.node,"sel"),this.tipNode=f.findChild(this.node,"tip"),this.tipNum=f.findChildComponent(this.node,"tip/num",s),this.target=f.findChildComponent(this.node,"target",l);var i=f.findChildComponent(this.node,"rewardScroll",a);this.rewardList=this.view.addUIList(i,k),this.nodeChoose=f.findChild(this.node,"choose");for(var e=function(i){var e=f.findChild(t.node,"choose/item"+i),s=f.findChild(e,"notSet"),a=new h(t.view,f.findChild(e,"itemGrid"));t.view.addComponentCallbackListener(e,n.EventType.CLICK,(function(){uiMgr.openView("PayOptionalSelectView",t.data.get_way[1],i)}));var o={node:e,notSet:s,itemGrid:a};t.chooseItems[i]=o},o=1;o<=2;o++)e(o)},o.onRender=function(t,i){var e=this,n=t.condition;this.isUnLock=IS(I).GetMillionStoneUnLock(t.id);var s=IS(I).battle_pass_id;if(this.isUnLock)this.target.string="",this.btnList.position=new r(this.btnOriPos.x,12,0);else{if(1==n[0])this.target.string=v.formatStrWithMirrorDeal(GetLanguage(200096),n[1]);else if(2==n[0]){var a=configStrategy_activity_chapter.getDataByKey(n[1]);this.target.string=v.formatStrWithMirrorDeal(GetLanguage(200097),a.name)}this.btnList.position=new r(this.btnOriPos.x,27,0)}this.isPass=t.id<=s,this.btnLock.active=!this.isPass,this.isUnLock&&s==t.id?(this.arrowNormal.active=!1,this.sel.active=!0):(this.arrowNormal.active=!0,this.sel.active=!1);var o=t.get_way;if(this.rewarded.active=t.id<s,2==o[0]){this.btnGet.node.active=!1,this.btnCharge.node.active=t.id>=s;var d=configPay_mall.getDataByKey(o[1]);if(this.btnChargeTxt.string=IS(g).GetPriceString(d.cost_level),this.btnCharge.grayscale=!this.isUnLock,this.tipNode.active=d.ratio>0,this.tipNum.string=d.ratio>0?100*d.ratio+"%":"",d.type==p.Custom){var h;this.nodeChoose.active=!0;var c=null!=(h=IS(g).GetCustomInfoList(d.id))?h:[],l=configCustom_mall.getDataByKey(d.id);this.rewardList.datas=l.regular_reward;for(var f=l.custom_reward,u=function(t){var i=f.find((function(i){return i[0]==t}));if(i){var n,s;e.chooseItems[t].node.active=!0;var a=null!=(n=null==(s=c.find((function(i){return i.k==t})))?void 0:s.v)?n:0,o=i[1].findIndex((function(t){return t[0]==a}));if(-1!=o){e.chooseItems[t].notSet.active=!1,e.chooseItems[t].itemGrid.node.active=!0;var d=i[1][o];e.chooseItems[t].itemGrid.SetItemId(d[0],d[1])}else e.chooseItems[t].notSet.active=!0,e.chooseItems[t].itemGrid.node.active=!1}else e.chooseItems[t].node.active=!1},m=1;m<=2;m++)u(m)}else this.nodeChoose.active=!1,this.rewardList.datas=d.reward}else 1==o[0]?(this.btnGet.node.active=t.id>=s,this.btnCharge.node.active=!1,this.ad.active=!0,this.btnGetLable.active=!1,this.btnGet.grayscale=!this.isUnLock,this.tipNode.active=!1,this.rewardList.scrollView.scrollToLeft(),this.rewardList.scrollView.enabled=t.reward.length>=4,this.rewardList.datas=t.reward,this.nodeChoose.active=!1):(this.btnGet.node.active=t.id>=s,this.btnCharge.node.active=!1,this.ad.active=!1,this.btnGetLable.active=!0,this.btnGet.grayscale=!this.isUnLock,this.tipNode.active=!1,this.rewardList.scrollView.scrollToLeft(),this.rewardList.scrollView.enabled=t.reward.length>=4,this.rewardList.datas=t.reward,this.nodeChoose.active=!1);this.red.active=!!IS(I).GetMillionStoneRed(t.id)},o.ClickReward=function(){if(this.red.active&&(IS(I).SetMillionStoneShowRedData(),this.view.taskList.updateAll()),this.isUnLock&&this.isPass){var t=this.data.get_way;2==t[0]?IS(g).Pay(t[1]):1==t[0]?IS(C).tryWatchAd(m.AD_STRATEGY_ACTIVITY):IS(T).send_act_strategy_battle_pass_claim_c2s(this.data.id)}},e}(c),k=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return(i=t.call.apply(t,[this].concat(n))||this).itemGridNode=void 0,i.itemGrid=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){this.itemGridNode=f.findChild(this.node,"itemGrid"),this.itemGrid=new h(this.view,this.itemGridNode)},n.onRender=function(t,i){this.itemGrid.SetItemId(t[0],t[1])},e}(c);e._RF.pop()}}}));

