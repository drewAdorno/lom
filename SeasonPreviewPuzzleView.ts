System.register("chunks:///_virtual/SeasonPreviewPuzzleView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./ObjectUtil.ts","./ActivityControl.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./BagDefine.ts","./BagModel.ts","./RoleDefine.ts","./SeasonControl.ts","./SeasonDataCache.ts","./SeasonDefine.ts","./BaseView.ts"],(function(t){"use strict";var e,i,s,a,n,o,d,r,h,c,u,l,f,T,v,k,m,w,I,y,p,g,S,C,_,R;return{setters:[function(t){e=t.inheritsLoose,i=t.createForOfIteratorHelperLoose},function(t){s=t.cclegacy,a=t.Button,n=t.Label,o=t.ScrollView},function(t){d=t.ItemGrid},function(t){r=t.ListItem},function(t){h=t.default},function(t){c=t.default},function(t){u=t.default},null,function(t){l=t.default},function(t){f=t.default},function(t){T=t.default},function(t){v=t.ActivityType,k=t.ActivityEventDefine,m=t.ActivityState,w=t.ActivityTaskState},function(t){I=t.BagEventDefine},function(t){y=t.BagModel},function(t){p=t.RoleEventDefine,g=t.PlayerAttr},function(t){S=t.default},function(t){C=t.SeasonDataCache},function(t){_=t.SeasonEventDefine},function(t){R=t.BaseView}],execute:function(){s._RF.push({},"dffa5xaGPtADaeXBapbqQnU","SeasonPreviewPuzzleView",void 0);t("default",function(t){function s(){var e;return(e=t.call(this)||this).cardItemList=[],e.taskTitle=void 0,e.taskRewardList=void 0,e.taskRewardBtn=void 0,e.taskReward=void 0,e.taskValueNode=void 0,e.taskValue=void 0,e.taskTitle1=void 0,e.taskRewardList1=void 0,e.taskRewardBtn1=void 0,e.taskReward1=void 0,e.taskValueNode1=void 0,e.taskValue1=void 0,e.showTaskItem=void 0,e.showTodayTaskItem=void 0,e.nodeReady=void 0,e.txtTime=void 0,e.Timer=void 0,e.Timer1=void 0,e.txtSTime=void 0,e.name="SeasonPreviewPuzzleView",e.url="ui/module/season/SeasonPreviewPuzzleView",e}e(s,t);var d=s.prototype;return d.onInit=function(){var t=this,e=this.findChild("content/btnClose");this.addComponentCallbackListener(e,a.EventType.CLICK,(function(){t.close()}));var i=this.findChild("content/nodeReady/btnGroup");this.addComponentCallbackListener(i,a.EventType.CLICK,(function(){uiMgr.openView("SeasonPreviewGroupView",IS(C).server_list)})),this.nodeReady=this.findChild("content/nodeReady"),this.txtTime=this.findChildComponent("content/nodeReady/time",n),this.InitCardList(),this.InitTask()},d.InitCardList=function(){for(var t=0;t<20;t++){var e={index:t+1,icon:this.findChild("content/nodeFull/dhh_ui_pintu2_"+(t+1)),goodsID:300002+t};e.icon.active=!1,this.cardItemList.push(e)}},d.InitTask=function(){var t=this;this.taskTitle=this.findChildComponent("content/cardReward/title",n),this.taskRewardBtn=this.findChild("content/cardReward/btnGreen"),this.addComponentCallbackListener(this.taskRewardBtn,a.EventType.CLICK,(function(){t.showTaskItem&&(IS(f).send_24_15(v.SeasonPuzzle,t.showTaskItem.task_id,t.showTaskItem.group_id),IS(f).send_24_14(v.SeasonPuzzle))})),this.taskReward=this.findChild("content/cardReward/isReward"),this.taskRewardList=this.addUIList(this.findChildComponent("content/cardReward/rewardScroll",o),L,!1),this.taskValueNode=this.findChild("content/cardReward/value"),this.taskValue=this.findChildComponent("content/cardReward/value/value",n),this.taskTitle1=this.findChildComponent("content/nodeToday/title",n),this.taskRewardBtn1=this.findChild("content/nodeToday/btnGreen"),this.addComponentCallbackListener(this.taskRewardBtn1,a.EventType.CLICK,(function(){t.showTodayTaskItem&&(IS(f).send_24_15(v.SeasonPuzzle,t.showTodayTaskItem.task_id,t.showTodayTaskItem.group_id),IS(f).send_24_14(v.SeasonPuzzle))})),this.taskReward1=this.findChild("content/nodeToday/isReward"),this.taskRewardList1=this.addUIList(this.findChildComponent("content/nodeToday/rewardScroll",o),L,!1),this.taskValueNode1=this.findChild("content/nodeToday/value"),this.taskValue1=this.findChildComponent("content/nodeToday/value/value",n),this.txtSTime=this.findChildComponent("content/time",n)},d.registerUpdateHandler=function(){this.addEvent(I.GOODS_LIST_UPDATE,this.updateInfo,this),this.addEvent(k.OnActivityListUpdate,this.updateTask,this),this.addEvent(k.OnActivityInfoTaskUpdate,this.updateTask,this),this.addEvent(p.ROLE_INFO_UPDATE,this.updatePlayerInfo,this),this.addEvent(_.SEASON_START_TIME_INFO_UPDATE,this.updatePreviewTime,this)},d.onAfterOpen=function(){this.txtSTime.string="",IS(S).reqSeasonPreviewTime(),IS(f).send_24_14(v.SeasonPuzzle),this.updateInfo(),this.updateTask()},d.updatePreviewTime=function(){var t=this;0==IS(C).season_start_time?this.txtSTime.string="":(this.Timer1&&this.removeTimer(this.Timer1),this.Timer1=this.addTimer(1,-1,(function(){var e=IS(C).season_start_time-u.serverTime;t.txtSTime.string=c.formatStr(GetLanguage(205455),u.getTimeLeft(e))})))},d.onBeforeClose=function(){},d.onDestroy=function(){},d.updatePlayerInfo=function(t){t[g.ROLE_ATTR_LVL]&&IS(f).send_24_14(v.SeasonPuzzle)},d.updateInfo=function(){for(var t,e=i(this.cardItemList);!(t=e()).done;){var s=t.value,a=IS(y).getGoodsCountByGoodsGtid(s.goodsID);s.icon.active=a>0}},d.updateTask=function(){var t=this;this.nodeReady.active=!1;var e=IS(T).GetActivityInfo(v.SeasonPuzzle);e&&e.state==m.EndShow&&(this.nodeReady.active=!0,this.Timer&&this.removeTimer(this.Timer),this.Timer=this.addTimer(1,-1,(function(){var i=e.end_time-u.serverTime;t.txtTime.string=c.formatStrWithMirrorDeal(GetLanguage(204384),u.getTimeLeft(i))}))),this.updateTotalTask(),this.updateTodayTask()},d.updateTotalTask=function(){var t=IS(T).GetActivityInfo(v.SeasonPuzzle);if(t){for(var e,s=[],a=IS(T).GetRoundCfg(v.SeasonPuzzle,t.round),n=configActivity_task_group.getDataByKey(a.task_list[0]),o=i(n.task_list);!(e=o()).done;){var d=e.value;if(t.task_list.hasOwnProperty(d))s.push(t.task_list[d]);else{var r={cfg:configActivity_task.getDataByKey(d),state:0,count:0};s.push(r)}}l.sort(s,(function(t,e){return t.id>e.id})),this.showTaskItem=null;for(var h=0;h<s.length;h++)if(s[h].state!=w.HadGet||h==s.length-1){this.showTaskItem=s[h];break}this.showTaskItem&&(printLogErr("Total - 当前任务ID：",this.showTaskItem.cfg.id),this.taskRewardList.datas=this.showTaskItem.cfg.reward,this.taskTitle.string=this.showTaskItem.cfg.desc,this.taskReward.active=this.showTaskItem.state==w.HadGet,this.showTaskItem.state==w.Normal?(this.taskValueNode.active=!0,this.taskValue.string=this.showTaskItem.count+"/"+this.showTaskItem.cfg.condition[2],this.taskRewardBtn.active=!1):(this.taskValueNode.active=!1,this.taskRewardBtn.active=this.showTaskItem.state==w.CanGet))}},d.updateTodayTask=function(){var t=IS(T).GetActivityInfo(v.SeasonPuzzle);if(t){for(var e,s=[],a=IS(T).GetRoundCfg(v.SeasonPuzzle,t.round),n=configActivity_task_group.getDataByKey(a.task_list[1]),o=i(n.task_list);!(e=o()).done;){var d=e.value;if(t.task_list.hasOwnProperty(d))s.push(t.task_list[d]);else{var r={cfg:configActivity_task.getDataByKey(d),state:0,count:0};s.push(r)}}l.sort(s,(function(t,e){return t.id>e.id})),this.showTodayTaskItem=null;for(var h=0;h<s.length;h++)if(s[h].state!=w.HadGet||h==s.length-1){this.showTodayTaskItem=s[h];break}if(this.showTodayTaskItem){printLogErr("Today - 当前任务ID：",this.showTodayTaskItem.cfg.id),this.taskRewardList1.datas=this.showTodayTaskItem.cfg.reward,this.taskTitle1.string=this.showTodayTaskItem.cfg.desc,this.taskReward1.active=this.showTodayTaskItem.state==w.HadGet;var c=this.showTodayTaskItem.cfg.condition[2];91==this.showTodayTaskItem.cfg.condition[0]&&(c=1),this.showTodayTaskItem.state==w.Normal?(this.taskValueNode1.active=!0,this.taskValue1.string=this.showTodayTaskItem.count+"/"+c,this.taskRewardBtn1.active=!1):(this.taskValueNode1.active=!1,this.taskRewardBtn1.active=this.showTodayTaskItem.state==w.CanGet)}}},s}(R));var L=function(t){function i(){for(var e,i=arguments.length,s=new Array(i),a=0;a<i;a++)s[a]=arguments[a];return(e=t.call.apply(t,[this].concat(s))||this).itemGridNode=void 0,e.itemGrid=void 0,e}e(i,t);var s=i.prototype;return s.onInit=function(){this.itemGridNode=h.findChild(this.node,"itemGrid"),this.itemGrid=new d(this.view,this.itemGridNode)},s.onRender=function(t,e){this.itemGrid.SetItemId(t[0],t[1])},i}(r);s._RF.pop()}}}));

