System.register("chunks:///_virtual/UnitDeadState.ts",["./rollupPluginModLoBabelHelpers.js","cc","./FixMath.ts","./SkillRunner.ts","./EnumDefine.ts","./UnitMgr.ts","./State.ts"],(function(t){"use strict";var e,i,n,r,a,o,s,c,l,u;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy},function(t){n=t.FixMath},function(t){r=t.SkillRunner},function(t){a=t.BattleFlag,o=t.BindType,s=t.UnitConfig,c=t.StateType},function(t){l=t.UnitMgr},function(t){u=t.State}],execute:function(){i._RF.push({},"4520fifaSlA6pzhPVgV/e2p","UnitDeadState",void 0);t("UnitDeadState",function(t){function i(e,i){var n;return(n=t.call(this,e,i)||this)._curTime=0,n._maxTime=0,n._triggerEvent=!0,n._setp=1,n.type=c.Dead,n}e(i,t);var u=i.prototype;return u.onEnter=function(){var t=this,e=this._ctr;e.needChangeState=!1,e.lockCurrenState=!0,e.beControlled++,this._curTime=0;var i=this._owner.config.dead_skills;if(i&&i.length>0&&i.forEach((function(e){var i=l.newSkill(e,1);i.triggerEffect=!1;var n=new r;n.init(t._owner,i,!0),n.lockTarget=t._owner,n.start(),t._owner.skillctr.addRunner(n)})),this._owner.config.dead_effect>0){this._owner.modelObj.visible=!1;var n=this._owner.battleMain;if(!(n.battleFlag&a.OPEN_GRAPHIC))return;if(n.battleFlag&a.UI_MASK)return;if(n.battleFlag&a.SIMP_MODEL)return;n.renderMgr.allocEffect(this._owner.config.dead_effect).position=this._owner.getBindPos(o.bp_lead)}else this._owner.animatorctr.changeState(s.ANIMATOR_DEAD)},u.setParam=function(t){this._triggerEvent=t,this._maxTime=this._owner.data.modelConfig.deadTime,this._setp=1},u.onUpdate=function(t){if(this._curTime>=this._maxTime){switch(this._setp){case 1:this._owner.visible=!1;break;case 2:this._owner.destroy()}this._setp++}else this._curTime=n.round(this._curTime+t)},u.onExit=function(){this._ctr.beControlled--},i}(u));i._RF.pop()}}}));

