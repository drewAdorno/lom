System.register("chunks:///_virtual/BattleDataFill.ts",["./rollupPluginModLoBabelHelpers.js","cc","./FixMath.ts","./ObjectUtil.ts","./BattleData.ts","./MetaAttrib.ts","./UnitData.ts","./UnitMgr.ts"],(function(t){"use strict";var e,i,a,r,n,l,s,u,o;return{setters:[function(t){e=t.createForOfIteratorHelperLoose},function(t){i=t.cclegacy},function(t){a=t.FixMath},function(t){r=t.default},function(t){n=t.ChapterType},function(t){l=t.MetaAttrib,s=t.AttribDefine},function(t){u=t.UnitData},function(t){o=t.UnitMgr}],execute:function(){i._RF.push({},"7b880w1rAxF3p3hyH8W8X3b","BattleDataFill",void 0);t("BattleDataFill",function(){function t(){}return t.setChapterExt=function(t,i){for(var a,r,n=e(i);!(r=n()).done;){var l=r.value;switch(Number(l.k)){case 1:t.openServerDay=Number(l.v);break;case 2:t.buffs=null!=(a=t.buffs)?a:[],t.buffs.push(Number(l.v));break;case 3:t.seasonPveDamAdd=Number(l.v)}}},t.setMonster=function(t){var i=new u;i.attribs={},i.config=configUnit.getDataByKey(t.id),i.skillList=[];for(var a,r=configAttribute.getDataByList("module",1),n=e(r);!(a=n()).done;){var s=a.value,f=new l(s);f.baseValue=i.config[s.key],i.attribs[s.id]=f}if(t.attr_list)for(var c,g=e(t.attr_list);!(c=g()).done;){var v=c.value;i.attribs[Number(v.k)].baseValue=Number(v.v)}if(null!=i.config.passiveSkills)for(var d=0;d<i.config.passiveSkills.length;d++){var b=i.config.passiveSkills[d];o.addSkill(i,b,1)}return t.hp&&(i.currenHp=t.hp),i},t.setShipData=function(t,e){e.ship={config:configSeason_ship_appearance.getDataByKey(t.id),flag:t.flag,ram:t.ram,gunId:t.gun_id,gun1:t.gun1,gun2:t.gun2,skinChange:!0}},t.setPlayerList=function(t,i,r){var n=new u;n.attribs={};var l,o=configJobs.getDataByKey(t.figure.job_figure).model,f=configUnit.getDataByKey(o);if(n.config=f,n.name=t.name,n.level=t.lev,n.head=t.head,n.roleId=i.id,this.setPlayerAttrib(t,n,r),this.setPlayerSkill(t,n),this.setPlayerPassiveSkill(t,n,r),n.idleIndex=1,this.setPlayerEquip(t,n,o,r),i.units.push(n),t.attr_obj_list&&t.attr_obj_list.length>0){l={1:{},2:{}};for(var c,g=e(t.attr_obj_list);!(c=g()).done;){var v,d=c.value,b=d.obj.k,y=d.obj.v,p=l[b];p[y]=null!=(v=p[y])?v:{};for(var h=0;h<d.attr_list.length;h++)p[y][d.attr_list[h].k]=a.roundInt(Number(d.attr_list[h].v))}}if(this.setPlayerPets(i,t.pet_list,l?l[1]:null),n.skillAttrInfo=l?l[2]:null,t.ext)for(var k,_=function(t,e){switch(t){case 1:i.pos=Number(e);break;case 2:var r=a.roundInt(a.round(Math.max(1,Number(e))/1e4)*n.getAttribByInt(s.hp));n.currenHp=r,n.initHp=r;break;case 3:case 5:case 7:n.buffs.push(Number(e));break;case 4:var l=a.roundInt(Math.max(1,Math.min(Number(e),n.getAttribByInt(s.hp))));n.currenHp=l,n.initHp=l;break;case 6:m(i,Number(e))}},m=this.setPlayerFlyPet,D=e(t.ext);!(k=D()).done;){var P=k.value;_(P.k,P.v)}},t.setDummy=function(e,i,a){var r=new u;r.attribs={};var n=configJobs.getDataByKey(i.figure.job_figure).model,l=configUnit.getDataByKey(n);r.config=l,r.name=i.name,r.level=i.lev,t.setPlayerEquip(i,r,n,a),e.dummy=r},t.setPlayerAttrib=function(t,i,a){for(var r,n=configAttribute.getDataByList("module",1),u=configChapter_type.getDataByKey(a),o=e(n);!(r=o()).done;){var f=r.value,c=configAttribute.getDataByKey(f.id),g=new l(c);0!=u.pve||f.id!=s.pve_dam&&f.id!=s.pve_resist?g.baseValue=this.getAttrib(f.id,t.attr_list):g.baseValue=0,i.attribs[c.id]=g}},t.getAttrib=function(t,i){if(null==i)return 0;for(var r,n=e(i);!(r=n()).done;){var l=r.value;if(l.k==t)return a.roundInt(Number(l.v))}return 0},t.setPlayerEquip=function(t,e,i,a){var r=t.figure.equip_list,l=1,s=2,u=3,o=0,f=0;r.forEach((function(t){switch(t.k){case 1:l=t.v;break;case 2:s=t.v;break;case 3:u=t.v;break;case 4:o=t.v;break;case 5:f=t.v}})),a!=n.Team20&&a!=n.WorldBoss&&a!=n.DoubleLadder||(o=0),e.mount=t.figure.mount_figure;var c=t.figure.hair_figure;t.figure.artifact_figure>0&&(l=t.figure.artifact_figure),e.skin={color:c,weapon:l,ornaments:s,face:u,fate:o,wing:f},t.figure.skin_list&&t.figure.skin_list.forEach((function(a){2==a.k&&e.setDress(i,a.v,t.figure.gender)}))},t.getPetAttrByAttrId=function(t,e,i){var a=t[e];return null==a?0:a[i]||0},t.getPetFactAttrValue=function(t,e,i,r){if(null==t)return e;var n=a.roundInt(e+this.getPetAttrByAttrId(t,i,r)+this.getPetAttrByAttrId(t,0,r)),l=configAttribute.getDataByList("group",r);if(null==l||l.length<=0)return n;for(var s=0;s<l.length;s++){var u=a.roundInt(this.getPetAttrByAttrId(t,i,l[s].id)+this.getPetAttrByAttrId(t,0,l[s].id)),o=a.round(a.round(u/1e4)+1);n=a.roundInt(n*o)}return n},t.setPlayerSkill=function(t,e){var i;e.skillList=null!=(i=e.skillList)?i:[],e.skillList.length=0;var n=t.role_skill.active_skill;r.sort(n,(function(t,e){return t.pos_id>e.pos_id}));for(var l=0;l<n.length;l++){var s,u=n[l];if(!(u.skill_id<=0))u.delay_time=null!=(s=u.delay_time)?s:0,o.addSkill(e,u.skill_id,u.skill_lv).useDelay=a.round(u.delay_time/1e3)}e.ativeSkills=n},t.setPlayerPassiveSkill=function(t,i,a){if(t.role_skill.passive_skill)for(var r,n=e(t.role_skill.passive_skill);!(r=n()).done;){var l=r.value;if(!(l.skill_id<=0)){var s=configSkill.getDataByKey(l.skill_id);this.checkPvpChapterTypeOk(s.chapter_type,a)&&o.addSkill(i,l.skill_id,l.skill_lv)}}},t.checkPvpChapterTypeOk=function(t,e){if(null==t||t.length<=0)return!0;for(var i=0;i<t.length;i++)if(t[i][0]==e)return!0;return!1},t.setPlayerPets=function(t,i,a){if(null!=i&&0!=i.length)for(var r,n=configAttribute.getDataByList("module",1),o=e(i);!(r=o()).done;){var f=r.value;if(0!=f.pet_id){var c=configPet.getDataByKey(f.pet_id),g=configPetlevel.getDataByKeys("id",f.pet_id,"level",f.pet_lev),v=new u;v.attribs={},v.roleId=t.id;var d=configUnit.getDataByKey(c.unitId);v.config=d;for(var b,y=e(n);!(b=y()).done;){var p=b.value,h=new l(p);h.baseValue=this.getPetFactAttrValue(a,g[p.key],f.pet_id,p.id),v.attribs[p.id]=h}v.attribs[s.att].baseValue=t.units[0].attribs[s.att].baseValue,v.attribs[s.partner_dam_extra].baseValue=t.units[0].attribs[s.partner_dam_extra].baseValue,v.idleIndex=f.pet_pos+1,t.units.push(v)}}},t.setPlayerFlyPet=function(t,i){var a=configFly.getDataByKey(i);if(null!=a){var r=configUnit.getDataByKey(a.unitid),n=new u;n.attribs={},n.roleId=t.id,n.config=r;for(var s,o=configAttribute.getDataByList("module",1),f=e(o);!(s=f()).done;){var c=s.value,g=new l(c);g.baseValue=r[c.key],n.attribs[c.id]=g}n.idleIndex=7,t.units.push(n)}},t}());i._RF.pop()}}}));

