System.register("chunks:///_virtual/MovementCtr.ts",["./rollupPluginModLoBabelHelpers.js","cc","./FixMath.ts","./MetaAttrib.ts","./Target.ts","./EnumDefine.ts","./V2.ts"],(function(t){"use strict";var i,n,e,s,o,r,a;return{setters:[function(t){i=t.createClass},function(t){n=t.cclegacy},function(t){e=t.FixMath},function(t){s=t.AttribDefine},function(t){o=t.TargetUnit},function(t){r=t.PathState},function(t){a=t.V2}],execute:function(){n._RF.push({},"e38c1myAHpKeImsVKYkE+Ye","MovementCtr",void 0);t("MovementCtr",function(){function t(){this._owner=void 0,this._play=void 0,this._targetPosition=new a(0,0),this._temV2=new a(0,0),this._state=r.Stop,this._speed=void 0,this.limitRangle=void 0}var n=t.prototype;return n.init=function(t){this._owner=t,this._targetPosition.set(this._owner.position)},n.startMove=function(){return this._play=this.checkTargetPostion(),this._play},n.stopPathFinding=function(){this._owner.animatorctr.speed=1,this._targetPosition.set(this._owner.position),this._state=r.Stop},n.startPathFinding=function(t){var i=this._owner;if(this.limitRangle){var n=t.x>this.limitRangle.y?this.limitRangle.y:t.x;this._targetPosition.set(n,t.y)}else this._targetPosition.set(t);e.distanceX(i.position,this._targetPosition)>.1&&(this._state=r.Seeking)},n.canMove=function(){return!(this._owner.statectr.bound>0)&&(this._speed=this._owner.data.getAttrib(s.speed),!(this._speed<.1))},n.stopMove=function(){this._play&&(this._play=!1,this.stopPathFinding())},n.onUpdate=function(t){if(this._play)if(this.checkTargetPostion()){var i=this._owner,n=e.distanceX(this._targetPosition,i.position);if(n<=.1)i.position=this._targetPosition;else{i.lookAt(this._targetPosition);var s=Math.min(e.round(this._speed*t),n);s=e.round(i.direction*s),this._temV2.set(s,0),i.position=this._temV2.add(i.position)}n<=.1&&this.stopMove()}else this.stopMove()},n.reset=function(){this.stopPathFinding()},n.checkFormationPostion=function(t,i){var n=this._owner;if(null==t)return!1;i.set(t.position);var s=e.roundInt(t.radiusSize+n.radiusSize),o=e.roundInt(s+n.attackDistance),r=e.distanceX(t.position,n.position);if(r<=o)return i.set(n.position),!1;var a=n.position.x>t.position.x?1:-1,h=e.round((r-e.round(o-.1))*a);return i.add2f(h,0),!0},n.checkTargetPostion=function(){var t=this._owner;if(null==t.curTarget)return!1;if(!this.canMove())return!1;var i=t.curTarget.unit;null==i||i.isDestroy||t.curTarget.pos.set(i.position);var n=t.curTarget.pos;if(t.curTarget.type==o.T_Unit){if(i.isDead)return t.curTarget=null,!1;this.checkFormationPostion(i,n)?this.startPathFinding(n):this.stopPathFinding()}else this.startPathFinding(n);return this._state==r.Seeking},i(t,[{key:"state",get:function(){return this._state}}]),t}());n._RF.pop()}}}));

