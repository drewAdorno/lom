System.register("chunks:///_virtual/FarmFriendView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./ObjectUtil.ts","./FriendControl.ts","./FriendDefine.ts","./FriendModel.ts","./PlantControl.ts","./PlantDefine.ts","./PlantModel.ts","./BaseView.ts"],(function(t){"use strict";var e,i,n,a,o,s,r,d,h,l,f,c,m,u,g,v,_,S,F,p,L,I;return{setters:[function(t){e=t.inheritsLoose,i=t.createForOfIteratorHelperLoose},function(t){n=t.cclegacy,a=t.Button,o=t.ScrollView,s=t.UITransform,r=t.Sprite,d=t.Label,h=t.Vec3},function(t){l=t.ListItem},function(t){f=t.default},function(t){c=t.default},function(t){m=t.default},null,function(t){u=t.default},function(t){g=t.default},function(t){v=t.FriendDefine,_=t.FriendListType},function(t){S=t.FriendModel},function(t){F=t.default},function(t){p=t.PlantEventDefine},function(t){L=t.PlantModel},function(t){I=t.BaseView}],execute:function(){var C;n._RF.push({},"a3834GRwxFOspZR6VFipxb3","FarmFriendView",void 0),function(t){t[t.None=0]="None",t[t.Growing=1]="Growing",t[t.Steal=2]="Steal",t[t.Stealing=3]="Stealing",t[t.NoFunction=6]="NoFunction"}(C||(C={}));t("FarmFriendView",function(t){function i(){var e;return(e=t.call(this)||this).itemList=void 0,e.curWaitFarmInfoRoleId=void 0,e.dt=0,e.utScrollView=void 0,e.friend_info_list=void 0,e.friendInfo=void 0,e.list_content=void 0,e.screen_height=858.465,e.is_send_server=!1,e.send_num=0,e.page=1,e.factUseList=void 0,e.name="FarmFriendView",e.url="ui/module/plant/FarmFriendView",e}e(i,t);var n=i.prototype;return n.onInit=function(){var t=this,e=this.findChild("imgMask");this.addComponentCallbackListener(e,a.EventType.CLICK,(function(){}));var i=this.findChildComponent("content/ScrollView",o);this.utScrollView=this.findChildComponent("content/ScrollView/view",s),this.addComponentCallbackListener(i.node,o.EventType.SCROLL_ENDED,(function(){t.checkNeedSend()})),this.list_content=this.findChild("content/ScrollView/view/content"),this.itemList=this.addUIList(i,w)},n.registerUpdateHandler=function(){var t=this;this.addEvent(p.ROLE_HOME_FARM_INFO_BACK,(function(e){t.curWaitFarmInfoRoleId&&e.role_id==t.curWaitFarmInfoRoleId&&(IS(L).tryOpenFarm(e),uiMgr.close("FarmFriendView"))})),this.addEvent(p.FARM_STOLEN_INFO_UPDATE,this.onRefreshList,this),this.addEvent(v.FriendInfoBack,this.onRefreshList,this)},n.onAfterOpen=function(){this.trySetParent(),this.friendInfo=IS(S).GetListInfoByType(_.FriendList),this.friend_info_list=[],this.factUseList=[],IS(g).reqFriendList(_.FriendList,1),this.send_num=1,this.page=1,this.is_send_server=!1,this.checkNeedSend()},n.checkNeedSend=function(){if(!(this.friend_info_list.length>=this.friendInfo.total_num)){var t=this.list_content.position.y,e=this.GetDetailHeight();if(t+this.screen_height>e-1e3&&!this.is_send_server){if(this.is_send_server=!0,this.send_num++,this.send_num>this.friendInfo.total_num/10+1)return void printLogErr("出bug了，不可能请求这么多的 "+this.send_num);this.page++,IS(g).reqFriendList(_.FriendList,this.page)}}},n.GetDetailHeight=function(){var t=this.factUseList.length;return 118*t+(this.factUseList.length>1?20*(t-1):0)+5},n.trySetParent=function(){var t=uiMgr.getOpenView("PlantMainView");t&&t.nodeSubRoot&&this.node.setParent(t.nodeSubRoot)},n.onBeforeClose=function(){},n.onDestroy=function(){},n.onUpdate=function(t){this.dt+=t,this.dt>=1&&(this.dt=0,this.itemList.items.forEach((function(t,e,i){t.updateTimer()})))},n.onRefreshList=function(){var t=[];this.friend_info_list=IS(S).GetListByType(_.FriendList);for(var e=IS(L).getStealingList(),i={},n=0;n<e.length;n++)i[e[n].id]=e[n];for(var a=0;a<this.friend_info_list.length;a++){var o=this.friend_info_list[a];if(o.farm_state!=C.NoFunction){var s=i[o.role_id];u.isEmpty(s)||(o.farm_state=C.Stealing,o.farm_time=s.end_time),t.push(o)}}t.sort((function(t,e){var i=t.farm_state==C.Stealing;if(i!=(e.farm_state==C.Stealing))return i?-1:1})),this.itemList.datas=t,this.friendInfo=IS(S).GetListInfoByType(_.FriendList),this.factUseList=t,this.is_send_server=!1},i}(I));var w=function(t){function n(){for(var e,i=arguments.length,n=new Array(i),a=0;a<i;a++)n[a]=arguments[a];return(e=t.call.apply(t,[this].concat(n))||this).btnRoleInfo=void 0,e.imgIcon=void 0,e.imgHeadFrame=void 0,e.txtLevel=void 0,e.txtName=void 0,e.imgState=void 0,e.txtState=void 0,e.state=void 0,e.txtTime=void 0,e}e(n,t);var o=n.prototype;return o.onInit=function(){var t=this;this.btnRoleInfo=f.findChild(this.node,"imgFrame"),this.view.addComponentCallbackListener(this.btnRoleInfo,a.EventType.CLICK,(function(){t.data.role_id&&IS(g).reqOtherRoleNotice(t.data.role_id,1)})),this.imgIcon=f.findChildComponent(this.node,"imgFrame/imgIcon",r),this.imgHeadFrame=f.findChildComponent(this.node,"imgFrame/imgHeadFrame",r),this.txtLevel=f.findChildComponent(this.node,"txtLevel",d),this.txtName=f.findChildComponent(this.node,"txtName",d),this.imgState=f.findChildComponent(this.node,"state/imgState",r),this.txtState=f.findChildComponent(this.node,"state/txtState",d),this.txtTime=f.findChildComponent(this.node,"txtTime",d);var e=f.findChild(this.node,"btnPlant");this.view.addComponentCallbackListener(e,a.EventType.CLICK,(function(){t.data.role_id&&(t.view.curWaitFarmInfoRoleId=t.data.role_id,IS(F).reqFarmInfo(t.data.role_id))}))},o.onRender=function(t,e){for(var n,a=i(this.node.children);!(n=a()).done;){n.value.active=null!=t}if(null!=t){if(t.head&&""!==t.head.url&&this.view.loadRemoteIcon(t.head.url,this.imgIcon),this.txtName.string=t.name,this.txtLevel.string="Lv."+t.lv,this.state=t.farm_state,this.imgState.node.scale=new h(1,1,1),t.head&&t.head.frame_id>0){var o=configAvatar_frame.getDataByKey(t.head.frame_id);this.view.loadIcon(this.imgHeadFrame,"icon_frame",o.icon),this.imgHeadFrame.node.active=!0}else this.imgHeadFrame.node.active=!1;var s=GetLanguage(200057);switch(0==t.is_online&&(s=m.getDateDiff(t.offline_time)),this.txtTime.string=s,t.farm_state){case C.None:this.view.loadIcon(this.imgState,"farm","zy_ui_zhanwuziyuan"),this.txtState.string=GetLanguage(300134);break;case C.Growing:this.view.loadIcon(this.imgState,"farm","zy_ui_ketouqu01");break;case C.Steal:this.view.loadIcon(this.imgState,"farm","zy_ui_ketouqu02"),this.txtState.string=GetLanguage(300140);break;case C.Stealing:this.view.loadIcon(this.imgState,"farm","zy_icon_xiaotou"),this.imgState.node.scale=new h(.4,.4,1);break;default:console.error("Bad EStealType state")}this.updateTimer()}},o.updateTimer=function(){if(this.state==C.Growing){var t=m.serverTime,e=this.data.farm_time;t>=e?(this.view.loadIcon(this.imgState,"farm","zy_ui_ketouqu02"),this.txtState.string=GetLanguage(300140),this.state=C.Steal):this.txtState.string=c.formatStrWithMirrorDeal(GetLanguage(300135),m.formatTimeForSecond(e-t))}else this.state==C.Stealing&&(this.txtState.string=m.formatTimeForSecond(Math.max(0,this.data.farm_time-m.serverTime))+"\n"+GetLanguage(300136))},n}(l);n._RF.pop()}}}));

