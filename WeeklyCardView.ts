System.register("chunks:///_virtual/WeeklyCardView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./MessageView.ts","./PayControl.ts","./PayDataCache.ts","./PayDefine.ts","./PrivilegeDataCache.ts","./PrivilegeDefine.ts","./WeeklyCardControl.ts","./WeeklyCardDataCache.ts","./WeeklyCardDefine.ts","./BaseView.ts"],(function(t){"use strict";var e,i,n,a,r,d,o,s,l,f,c,h,u,I,y,v,C,m,w,S,p,g,G,T,B;return{setters:[function(t){e=t.inheritsLoose,i=t.createForOfIteratorHelperLoose},function(t){n=t.cclegacy,a=t.Button,r=t.Label,d=t.ScrollView},function(t){o=t.ItemGrid},function(t){s=t.ListItem},function(t){l=t.default},function(t){f=t.default},function(t){c=t.default},null,function(t){h=t.default},function(t){u=t.ActivityType,I=t.ActivityState},function(t){y=t.default},function(t){v=t.default},function(t){C=t.default},function(t){m=t.PayEventDefine,w=t.GiftType},function(t){S=t.PrivilegeDataCache},function(t){p=t.PrivilegeEventDefine},function(t){g=t.default},function(t){G=t.default},function(t){T=t.WeeklyCardEventDefine},function(t){B=t.BaseView}],execute:function(){n._RF.push({},"d8411Wk9EpPgYPErhOXxOVN","WeeklyCardView",void 0);var L=303002,R=(t("default",function(t){function n(){var e;return(e=t.call(this)||this).txtLeftTime=void 0,e.rewardList=void 0,e.deltaTime=0,e.leftTime=0,e.canUpdate=!1,e.btnBuy=void 0,e.imgBox=void 0,e.nodeGrey=void 0,e.name="WeeklyCardView",e.url="ui/module/weeklycard/WeeklyCardView",e}e(n,t);var o=n.prototype;return o.onInit=function(){var t=this,e=this.findChild("imgMask");this.addComponentCallbackListener(e,a.EventType.CLICK,(function(){t.close()}));var i=this.findChild("btnClose");this.addComponentCallbackListener(i,a.EventType.CLICK,(function(){t.close()})),this.txtLeftTime=this.findChildComponent("container/topBg/txtLeftTime",r);var n=this.findChildComponent("container/rewardList",d);this.rewardList=this.addUIList(n,R,!0),this.btnBuy=this.findChild("container/nodeBuy/btnBuy"),this.addComponentCallbackListener(this.btnBuy,a.EventType.CLICK,(function(){if(IS(G).payMallInfo.id){var t=IS(C).GetPayGiftInfo(IS(G).payMallInfo.id);if(t.bought_times>=t.payCfg.buy_times)return void y.showFlyTip(GetLanguage(200027));IS(C).Pay(IS(G).payMallInfo.id)}}));var o=this.findChild("container/topBg/btnReward");this.imgBox=this.findChild("container/topBg/btnReward/imgBox"),this.nodeGrey=this.findChild("container/topBg/btnReward/nodeGrey"),this.addComponentCallbackListener(o,a.EventType.CLICK,(function(){IS(v).send_19_2(L)}))},o.registerUpdateHandler=function(){this.addEvent(T.WEEKLYCARD_UPDATE_LIST,this.UpdateRewardList,this),this.addEvent(m.PAY_INFO_UPDATE,this.UpdateBtn,this)},o.onAfterOpen=function(){IS(G).updateActivityInfo(),IS(g).reqWeeklyCardInfo(),this.UpdateTime(),this.UpdateBtn()},o.onBeforeClose=function(){this.canUpdate=!1},o.onDestroy=function(){},o.onUpdate=function(t){this.canUpdate&&(this.deltaTime=this.deltaTime+t,this.deltaTime>=1&&(this.deltaTime=0,this.leftTime=this.leftTime-1,this.leftTime>0?this.txtLeftTime.string=c.formatTimeStringForSecond(this.leftTime):(this.txtLeftTime.string=GetLanguage(200026),this.canUpdate=!1)))},o.UpdateTime=function(){var t,e=IS(h).GetActivityInfo(u.WeeklyCard),i=null!=(t=e.state_time[e.state])?t:e.state_time[I.Open],n=c.serverTime-i.start_time;IS(G).weeklycardDay=Math.ceil(n/86400),this.leftTime=i.end_time-c.serverTime,this.leftTime>0?(this.canUpdate=!0,this.txtLeftTime.string=c.formatTimeStringForSecond(this.leftTime)):this.txtLeftTime.string=GetLanguage(200026)},o.UpdateBtn=function(){var t=IS(C).GetPayGiftInfo(L);if(t&&t.rewardState<2)return this.imgBox.active=!0,this.nodeGrey.active=!1,IS(S).WeeklyCardFreeGiftRP=1,void normalEvent.emit(p.ACITVITY_RED_UPDATE);IS(S).WeeklyCardFreeGiftRP=0,this.imgBox.active=!1,this.nodeGrey.active=!0,normalEvent.emit(p.ACITVITY_RED_UPDATE)},o.UpdateRewardList=function(){this.btnBuy.getChildByName("imgGrey").active=IS(G).isCardBuyed,this.btnBuy.getChildByName("txtBuy1").active=!IS(G).isCardBuyed,this.btnBuy.getChildByName("txtBuy2").active=IS(G).isCardBuyed,IS(G).payMallInfo=IS(C).GetAcivityGift(w.WeeklyCard,u.WeeklyCard,IS(G).round)[0],this.btnBuy.getChildByName("txtBuy1").getComponent(r).string=IS(C).GetPriceString(IS(G).payMallInfo.cost_level);var t=[];IS(G).curRewardInfo=[],IS(G).totalRewardInfo=[];for(var e=0;e<IS(G).weeklycardInfo.length;e++){IS(G).weeklycardInfo[e].day<=IS(G).weeklycardDay&&this.CalculateReward(IS(G).weeklycardInfo[e].reward,1);var i={id:IS(G).weeklycardInfo[e].id,active:IS(G).weeklycardInfo[e].day<=IS(G).weeklycardDay,rewardList:IS(G).weeklycardInfo[e].reward,isGet:IS(G).rewardGainRecord[IS(G).weeklycardInfo[e].id]};this.CalculateReward(IS(G).weeklycardInfo[e].reward,2),t.push(i)}IS(G).curRewardInfo.filter(Boolean),IS(G).totalRewardInfo.filter(Boolean),this.RewriteRewardList(),this.rewardList.datas=t},o.CalculateReward=function(t,e){if(1==e)for(var n,a=i(t);!(n=a()).done;){var r=n.value;null!=IS(G).curRewardInfo[r[0]]?IS(G).curRewardInfo[r[0]]+=r[1]:IS(G).curRewardInfo[r[0]]=r[1]}if(2==e)for(var d,o=i(t);!(d=o()).done;){var s=d.value;null!=IS(G).totalRewardInfo[s[0]]?IS(G).totalRewardInfo[s[0]]+=s[1]:IS(G).totalRewardInfo[s[0]]=s[1]}},o.RewriteRewardList=function(){for(var t=[],e=[],i=0,n=0,a=0;a<IS(G).curRewardInfo.length;a++)IS(G).curRewardInfo[a]&&(t[i]=[a,IS(G).curRewardInfo[a]],i++);for(var r=0;r<IS(G).totalRewardInfo.length;r++)IS(G).totalRewardInfo[r]&&(e[n]=[r,IS(G).totalRewardInfo[r]],n++);IS(G).curRewardInfo=t,IS(G).totalRewardInfo=e},n}(B)),function(t){function i(){for(var e,i=arguments.length,n=new Array(i),a=0;a<i;a++)n[a]=arguments[a];return(e=t.call.apply(t,[this].concat(n))||this).id=void 0,e.txtTitle=void 0,e.goodsList=void 0,e.btnGet=void 0,e.txtHint=void 0,e}e(i,t);var n=i.prototype;return n.onInit=function(){var t=this;this.txtTitle=l.findChildComponent(this.node,"title/txtTitle",r);var e=l.findChildComponent(this.node,"rewardScroll",d);this.goodsList=this.view.addUIList(e,k,!0),this.btnGet=l.findChild(this.node,"btnGet"),this.txtHint=l.findChild(this.node,"txtHint"),this.view.addComponentCallbackListener(this.btnGet,a.EventType.CLICK,(function(){IS(G).isCardBuyed?IS(g).reqWeeklyCardReward(t.id):uiMgr.openView("WeeklyCardGainInfoView")}))},n.onRender=function(t,e){this.id=t.id,this.btnGet.active=t.active,this.txtHint.active=!t.active,this.goodsList.datas=t.rewardList,this.txtTitle.string=f.formatStrWithMirrorDeal(GetLanguage(400004),IS(G).weeklycardInfo[e].day),this.btnGet.getChildByName("imgGrey").active=2==t.isGet,this.btnGet.getChildByName("txtGet1").active=2!=t.isGet,this.btnGet.getChildByName("txtGet2").active=2==t.isGet,this.btnGet.getChildByName("red").active=2!=t.isGet&&IS(G).isCardBuyed},i}(s)),k=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),a=0;a<i;a++)n[a]=arguments[a];return(e=t.call.apply(t,[this].concat(n))||this).itemGridNode=void 0,e.itemGrid=void 0,e}e(i,t);var n=i.prototype;return n.onInit=function(){this.itemGridNode=l.findChild(this.node,"itemGrid"),this.itemGrid=new o(this.view,this.itemGridNode)},n.onRender=function(t,e){this.itemGrid.SetItemId(t[0],t[1])},i}(s);n._RF.pop()}}}));

