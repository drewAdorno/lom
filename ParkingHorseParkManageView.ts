System.register("chunks:///_virtual/ParkingHorseParkManageView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./BaseView.ts","./ConfigGlobal.ts","./MessageView.ts","./FriendModel.ts","./GuildDataCache.ts","./HorseDataChche.ts","./RoleDataCache.ts","./ParkingControl.ts","./ParkingDataCache.ts","./ParkingDefine.ts"],(function(t){"use strict";var i,e,r,n,o,a,s,d,h,f,c,u,l,v,m,g,C,p,_,S,I,L,k,y,b,P,T;return{setters:[function(t){i=t.inheritsLoose,e=t.createForOfIteratorHelperLoose},function(t){r=t.cclegacy,n=t.Button,o=t.ScrollView,a=t.Layout,s=t.Label,d=t.sys,h=t.RichText,f=t.js,c=t.Sprite},function(t){u=t.ItemGrid},function(t){l=t.ListItem},function(t){v=t.default},function(t){m=t.default},function(t){g=t.default},function(t){C=t.BaseView},function(t){p=t.ConfigGlobal},function(t){_=t.default,S=t.TYPE_YES},function(t){I=t.FriendModel},function(t){L=t.default},function(t){k=t.HorseDataCache},function(t){y=t.RoleDataCache},function(t){b=t.default},function(t){P=t.ParkingDataCache},function(t){T=t.ParkingEventDefine}],execute:function(){r._RF.push({},"618f5vrALlNOrRI6XX4AonU","ParkingHorseParkManageView",void 0);t("default",function(t){function r(){var i;return(i=t.call(this)||this).scrollAward=void 0,i.scrollGain=void 0,i.scrollCar=void 0,i.starUIList=void 0,i.cur_Sel_Car=void 0,i.cur_pos=void 0,i.horseEffectID=void 0,i.btnLeft=void 0,i.btnRight=void 0,i.carList=[],i.nodeStart=void 0,i.nodeParking=void 0,i.nodeCD=void 0,i.txtCD=void 0,i.nodeBuff=void 0,i.txtBuff=void 0,i.txtParkTime=void 0,i.cdTimer=void 0,i.name="ParkingHorseParkManageView",i.url="ui/module/parking/ParkingHorseParkManageView",i.poolTime=3e3,i}i(r,t);var c=r.prototype;return c.onInit=function(){var t=this,i=this.findChild("btnClose");this.addComponentCallbackListener(i,n.EventType.CLICK,(function(){t.close()})),this.btnLeft=this.findChild("root/nodeShow/btnLeft"),this.btnRight=this.findChild("root/nodeShow/btnLeft");var r=this.findChildComponent("root/nodePreview/ScrollView",o);this.scrollAward=this.addUIList(r,w);var f=this.findChildComponent("root/nodeChange/ScrollView",o);this.scrollGain=this.addUIList(f,D);var c=this.findChildComponent("root/ScrollView",o);this.scrollCar=this.addUIList(c,x);var u=this.findChildComponent("root/nodeShow/ScrollView",o);this.starUIList=this.addUIList(u,B),this.refreshTxtMirrorByLayout(this.findChildComponent("root/nodeShow/bgName",a)),this.refreshTxtMirrorByLayout(this.findChildComponent("root/nodePreview/common_ui_xiaotidi",a)),this.btnLeft=this.findChild("root/nodeShow/btnLeft"),this.addComponentCallbackListener(this.btnLeft,n.EventType.CLICK,(function(){for(var i,r=e(t.carList);!(i=r()).done;){var n=i.value;if(n.id==t.cur_Sel_Car){t.cur_Sel_Car=t.carList[t.carList.indexOf(n)-1].id;break}}t.refreshHorseChange()})),this.btnRight=this.findChild("root/nodeShow/btnRight"),this.addComponentCallbackListener(this.btnRight,n.EventType.CLICK,(function(){for(var i,r=e(t.carList);!(i=r()).done;){var n=i.value;if(n.id==t.cur_Sel_Car){t.cur_Sel_Car=t.carList[t.carList.indexOf(n)+1].id;break}}t.refreshHorseChange()})),this.nodeStart=this.findChild("root/nodeStatus/nodePark"),this.addComponentCallbackListener(this.nodeStart,n.EventType.CLICK,(function(){var i=IS(P);if(3==i.type)return IS(b).reqCrossParkStart(i.master_id,t.cur_Sel_Car,t.cur_pos-10),void t.close();if(i.master_id!=IS(y).GetRoleId()&&1==IS(P).protect.is_open){var e=IS(I).IsFriend(IS(P).master_id),r=IS(L).IsGuildMember(IS(P).master_id);return 0==IS(P).protect.protect_type||1==IS(P).protect.protect_type&&r||2==IS(P).protect.protect_type&&e||3==IS(P).protect.protect_type&&(e||r)?void uiMgr.openView("ParkingPayTaxView",t.cur_Sel_Car,t.cur_pos):void _.showBoxTip({title:GetLanguage(200048),tip:GetLanguage(201328),func:function(e){e==S&&IS(b).reqStartPark(null==i?void 0:i.type,null==i?void 0:i.master_id,t.cur_Sel_Car,t.cur_pos,0,0)}})}i.is_focus=!0,IS(b).reqStartPark(null==i?void 0:i.type,null==i?void 0:i.master_id,t.cur_Sel_Car,t.cur_pos,0,0)})),this.nodeParking=this.findChild("root/nodeStatus/nodeParking"),this.nodeCD=this.findChild("root/nodeStatus/nodeCD"),this.txtCD=this.findChildComponent("root/nodeStatus/nodeCD/txtTime",s),this.nodeBuff=this.findChild("root/nodePreview/common_ui_xiaotidi/nodebuff");var l=this.findChildComponent("root/nodePreview/common_ui_xiaotidi/nodebuff/buff",a);this.dealMirrorLayout(l),l.horizontalDirection=d.uiMirror?0:1,this.txtBuff=this.findChildComponent("root/nodePreview/common_ui_xiaotidi/nodebuff/buff/txtnum",s),this.txtParkTime=this.findChildComponent("root/nodeChange/txtParkTime",h)},c.registerUpdateHandler=function(){this.addEvent(T.PARKING_CHANGE_CUR_SEL_CAR,this.refreshHorseChange,this)},c.onAfterOpen=function(){var t,i=this;IS(b).reqCarListInfo(),this.carList=[];for(var r,n=configParking_mount.getDataByList("level",1),o=e(n);!(r=o()).done;)for(var a,s=r.value,d=e(IS(k).skin_list);!(a=d()).done;){var h=a.value;s.id==h.k&&this.carList.push(s)}this.carList.sort((function(t,i){var e=configMount.getDataByKey(t.id),r=configMount.getDataByKey(i.id);return e.quality>r.quality?-1:1})),this.carList=this.carList.filter((function(t,e){return i.carList.indexOf(t)===e})),this.cur_Sel_Car=this.carList[0].id,this.cur_pos=null!=(t=this.openArgs[0])?t:0,1==IS(P).type&&(this.cur_pos=10*(IS(P).ceng-1)+this.cur_pos-10),this.updateData()},c.onBeforeClose=function(){this.carList=[]},c.onDestroy=function(){},c.refreshHorseChange=function(){var t,i=this,e=this.findChild("root/nodeShow/icon");this.adjustMirrorNode(e,0,!0);var r=this.findChildComponent("root/nodeShow/bgName/txtName",s);this.removeUIEffect(this.horseEffectID),this.horseEffectID=this.addUIEffect(configMount.getDataByKey(this.cur_Sel_Car).path,e,-1);var n=configMount.getDataByKey(this.cur_Sel_Car);r.string=n.name;var o=IS(P).car_list[this.cur_Sel_Car],a=configParking_mount.getDataByKeys("id",this.cur_Sel_Car,"level",null!=(t=null==o?void 0:o.car_lev)?t:0).drop_show;this.scrollAward.datas=a,this.scrollCar.datas=this.carList;var d=IS(P).car_list[this.cur_Sel_Car];this.checkPageBtn(),this.refreshStatus(),this.refreshBuff(),this.refreshParkTime(),this.addTimer(1,-1,(function(){Math.min(Math.max(g.serverTime-d.parking_data.start_time,0),60*p.park_time_limit)%60==0&&i.refreshParkTime()}))},c.refreshParkTime=function(){var t=IS(P).car_list[this.cur_Sel_Car],i=0;if(0==t.parking_data.start_time)i=t.minute;else{var e=g.ServerDate(1e3*g.serverTime),r=g.ServerDate(1e3*t.parking_data.start_time),n=f.formatStr("%s/%s/%s %s:%s:%s",e.getFullYear(),e.getMonth()+1,e.getDate(),0,0,0);i=n==f.formatStr("%s/%s/%s %s:%s:%s",r.getFullYear(),r.getMonth()+1,r.getDate(),0,0,0)?t.minute+Math.min(Math.floor((g.serverTime-t.parking_data.start_time)/60),480):t.minute+Math.min(Math.floor((g.serverTime-Math.floor(g.getServerDateByLocalStr(n).getTime()/1e3))/60),480)}this.txtParkTime.string=i<720?m.formatStrWithMirrorDeal(GetLanguage(201450),i):GetLanguage(201451)},c.refreshBuff=function(){var t=IS(P).car_list[this.cur_Sel_Car],i=configParking_mount.getDataByKeys("id",this.cur_Sel_Car,"level",t.car_lev),e=p.park_exp_rate,r=[{id:201,rate:i.rate,buff:0},{id:e[0][0],rate:e[0][1],buff:0}],n=IS(P).getDecGainBuffInfo();3==IS(P).type?(this.nodeBuff.active=!0,this.txtBuff.string="+"+p.park_cross_buff[2][1]/100+"%",r=[{id:201,rate:i.rate,buff:p.park_cross_buff[0][1]},{id:e[0][0],rate:e[0][1],buff:p.park_cross_buff[1][1]}]):1==IS(P).type?(this.nodeBuff.active=!0,this.txtBuff.string="+"+p.park_public_buff[2][1]/100+"%",r=[{id:201,rate:i.rate,buff:p.park_public_buff[0][1]},{id:e[0][0],rate:e[0][1],buff:p.park_public_buff[1][1]}]):0==IS(P).type&&(n&&n.spec?(this.nodeBuff.active=!0,this.txtBuff.string="+"+n.spec/100+"%"):this.nodeBuff.active=!1,r=[{id:201,rate:i.rate,buff:n.coin},{id:e[0][0],rate:e[0][1],buff:n.exp}]),this.scrollGain.datas=r},c.checkPageBtn=function(){this.btnLeft.active=!0,this.btnRight.active=!0;for(var t,i=e(this.carList);!(t=i()).done;){var r=t.value;r.id==this.cur_Sel_Car&&(0==this.carList.indexOf(r)&&(this.btnLeft.active=!1),this.carList.indexOf(r)==this.carList.length-1&&(this.btnRight.active=!1))}},c.refreshStatus=function(){for(var t,i,r=this,n=IS(P).getParkingCarList(),o=null!=(t=IS(P).extInfo)?t:[],a=0,s=e(o);!(i=s()).done;){var d=i.value;5==d.k&&(a=d.v)}if(this.nodeParking.active=!1,this.nodeCD.active=!1,this.nodeStart.active=!1,a>g.serverTime)return this.nodeCD.active=!0,this.updateTime(),this.cdTimer&&this.removeTimer(this.cdTimer),void(this.cdTimer=this.addTimer(1,-1,(function(){r.updateTime()})));n.includes(this.cur_Sel_Car)?this.nodeParking.active=!0:this.nodeStart.active=!0},c.updateTime=function(){for(var t,i=IS(P).extInfo,r=0,n=e(i);!(t=n()).done;){var o=t.value;5==o.k&&(r=o.v)}var a=g.getTimeLeft(r-g.serverTime);this.txtCD.string=a,r-g.serverTime<0&&(this.cdTimer&&this.removeTimer(this.cdTimer),this.refreshStatus())},c.updateData=function(){this.refreshHorseChange()},r}(C));var w=function(t){function e(){for(var i,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return(i=t.call.apply(t,[this].concat(r))||this).itemGridNode=void 0,i.itemGrid=void 0,i}i(e,t);var r=e.prototype;return r.onInit=function(){this.itemGridNode=v.findChild(this.node,"itemGrid"),this.itemGrid=new u(this.view,this.itemGridNode)},r.onRender=function(t,i){this.itemGrid.SetItemId(t)},e}(l),D=function(t){function e(){for(var i,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return(i=t.call.apply(t,[this].concat(r))||this).imgIcon=void 0,i.txtSpeed=void 0,i.txtBuff=void 0,i}i(e,t);var r=e.prototype;return r.onInit=function(){this.imgIcon=v.findChildComponent(this.node,"Sprite",c),this.txtSpeed=v.findChildComponent(this.node,"speed",s),this.txtBuff=v.findChildComponent(this.node,"buff",s)},r.onRender=function(t,i){this.view.loadIcon(this.imgIcon,"icon_item",t.id),this.txtSpeed.string=t.rate+"/min",this.txtBuff.node.active=t.buff>0,this.txtBuff.string="+"+t.buff/100+"%"},e}(l),x=function(t){function e(){for(var i,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return(i=t.call.apply(t,[this].concat(r))||this).imgFrame=void 0,i.imgIcon=void 0,i.imgLock=void 0,i.imgRP=void 0,i.nodeUse=void 0,i.nodeSel=void 0,i}i(e,t);var r=e.prototype;return r.onInit=function(){var t=this;this.imgFrame=v.findChildComponent(this.node,"frame",c),this.imgIcon=v.findChildComponent(this.node,"icon",c),this.imgLock=v.findChild(this.node,"lock"),this.imgRP=v.findChild(this.node,"rp"),this.nodeUse=v.findChild(this.node,"nodeUse"),this.nodeSel=v.findChild(this.node,"sel"),this.view.addComponentCallbackListener(this.node,n.EventType.CLICK,(function(){t.view.cur_Sel_Car=t.data.id,normalEvent.emit(T.PARKING_CHANGE_CUR_SEL_CAR)}))},r.onRender=function(t,i){this.data=t;var e=configMount.getDataByKey(t.id).icon_small,r=configMount.getDataByKey(t.id).quality,n=configColor.getDataByKey(r).path;this.view.loadIcon(this.imgFrame,"icon_equip",n),this.view.loadIcon(this.imgIcon,"icon_item",e);var o=this.view;this.nodeSel.active=o.cur_Sel_Car==t.id,IS(P).getParkingCarList().includes(t.id)?this.nodeUse.active=!0:this.nodeUse.active=!1},e}(l),B=function(t){function e(){for(var i,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return(i=t.call.apply(t,[this].concat(r))||this).imgOne=void 0,i.imgTwo=void 0,i.imgThree=void 0,i.imgDark=void 0,i}i(e,t);var r=e.prototype;return r.onInit=function(){this.imgOne=v.findChild(this.node,"one"),this.imgTwo=v.findChild(this.node,"two"),this.imgThree=v.findChild(this.node,"three"),this.imgDark=v.findChild(this.node,"dark")},r.onRender=function(t,i){this.imgDark.active=0==t,this.imgOne.active=1==t,this.imgTwo.active=2==t,this.imgThree.active=3==t},e}(l);r._RF.pop()}}}));

