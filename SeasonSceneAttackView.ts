System.register("chunks:///_virtual/SeasonSceneAttackView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./ConfigSeason_kv.ts","./MessageView.ts","./RoleDataCache.ts","./SeasonDataCache.ts","./SeasonDefine.ts","./SeasonSceneControl.ts","./SeasonSceneDataCache.ts","./BaseView.ts"],(function(t){"use strict";var e,i,n,o,s,a,d,h,r,c,f,l,u,v,C,p,m,S,g,I,x,w,N,y;return{setters:[function(t){e=t.inheritsLoose,i=t.createForOfIteratorHelperLoose},function(t){n=t.cclegacy,o=t.Button,s=t.Label,a=t.ScrollView,d=t.Layout,h=t.EditBox,r=t.sys,c=t.Vec2,f=t.Sprite},function(t){l=t.ItemGrid},function(t){u=t.ListItem},function(t){v=t.default},function(t){C=t.default},function(t){p=t.default},null,function(t){m=t.ConfigSeason_kv},function(t){S=t.default},function(t){g=t.RoleDataCache},function(t){I=t.SeasonDataCache},function(t){x=t.SeasonEventDefine},function(t){w=t.default},function(t){N=t.SeasonSceneDataCache},function(t){y=t.BaseView}],execute:function(){n._RF.push({},"03f01rYWhdEKZDpFuzHPfK9","SeasonSceneAttackView",void 0);t("default",function(t){function n(){var e;return(e=t.call(this)||this).txtName=void 0,e.txtTime=void 0,e.txtV=void 0,e.txtHint=void 0,e.pos=new c,e.txtMove=void 0,e.txtTitle=void 0,e.leftNode=void 0,e.rightNode=void 0,e.nodeInfo=void 0,e.nodeSweep=void 0,e.preList=void 0,e.baseId=void 0,e.baseType=void 0,e.editBox=void 0,e.useNum=1,e.maxNum=10,e.name="SeasonSceneAttackView",e.url="ui/module/season/scene-view/SeasonSceneAttackView",e}e(n,t);var f=n.prototype;return f.onInit=function(){var t=this,e=this.findChild("content/btnClose");this.addComponentCallbackListener(e,o.EventType.CLICK,(function(){t.close()}));var i=this.findChild("content/btnMove");this.txtMove=v.findChildComponent(i,"Label",s),this.addComponentCallbackListener(i,o.EventType.CLICK,(function(){var e=t.pos;if(IS(I).isInNight){var i=GetLanguage(204954);S.showBoxTip({tip:i,title:GetLanguage(200048),func:function(i){"type_yes"==i&&(IS(w).reqMove(1,{x:e.x,y:e.y},t.useNum),t.close())}})}else IS(w).reqMove(1,{x:e.x,y:e.y},t.useNum),t.close()}));var n=this.findChild("imgMask");this.addComponentCallbackListener(n,o.EventType.CLICK,(function(){t.close()})),this.nodeSweep=this.findChild("content/info/view");var r=v.findChildComponent(this.nodeSweep,"rewardScroll",a);this.preList=this.addUIList(r,b),this.preList.lackCenter=!0;var c=this.findChild("content/info");this.nodeInfo=this.findChild("content/info/info"),this.txtName=v.findChildComponent(c,"txtName",s),this.txtTime=v.findChildComponent(c,"txtTime",s),this.txtTitle=v.findChildComponent(c,"txtTitle",s),this.dealMirrorLayout(v.findChildComponent(c,"power",d)),this.txtV=v.findChildComponent(c,"power/txtV",s),this.txtHint=v.findChildComponent(c,"power/txtHint",s);var f=this.findChild("content/info/info/left");this.leftNode=new L(this,f);var l=this.findChild("content/info/info/right");this.rightNode=new L(this,l);var u=this.findChild("content/info/view/btnAdd");this.addComponentCallbackListener(u,o.EventType.CLICK,(function(){t.changeNum(1)}));var C=this.findChild("content/info/view/btnMinus");this.addComponentCallbackListener(C,o.EventType.CLICK,(function(){t.changeNum(-1)}));var p=this.findChild("content/info/view/btnAddTen");this.addComponentCallbackListener(p,o.EventType.CLICK,(function(){t.changeNum(10)}));var m=this.findChild("content/info/view/btnMinusTen");this.addComponentCallbackListener(m,o.EventType.CLICK,(function(){t.changeNum(-10)})),this.editBox=this.findChildComponent("content/info/view/EditBox",h),this.editBox.string=String(this.useNum)},f.registerUpdateHandler=function(){this.addEvent(x.SEASON_SCENE_ATTCK_INFO,this.onAttackInfo,this)},f.onAfterOpen=function(){this.maxNum=Math.max(1,Math.min(IS(N).roleInfo.action_point,10));var t=this.openArgs[0],e=this.openArgs[1],i=this.openArgs[2];this.baseId=t,this.baseType=i;var n=configSeason_building_plot.getDataByKey(t);this.txtName.string=C.formatStr(r.uiMirror?"[##2,##3] ##1":"##1 [##2,##3]",n.name,e.x,e.y),this.pos.set(e),this.txtV.string=IS(I).isInNight?"-2":"-1",this.txtHint.node.active=IS(I).isInNight,IS(w).reqAttackInfo({x:e.x,y:e.y}),1==i?(this.txtTitle.string=GetLanguage(204623),this.txtMove.string=GetLanguage(204784),this.nodeInfo.active=!0,this.nodeSweep.active=!1):(this.txtTitle.string=GetLanguage(204785),this.txtMove.string=GetLanguage(204785),this.nodeInfo.active=!1,this.nodeSweep.active=!0)},f.onBeforeClose=function(){},f.onDestroy=function(){},f.onAttackInfo=function(t){1==this.baseType?(this.txtTime.string=p.formatTimeForSecond(t.move_time),this.leftNode.show(t.atk_queue),this.rightNode.show(t.def_queue)):2==this.baseType&&this.refreshSweepInfo()},f.refreshSweepInfo=function(){for(var t,e,n=m.SEASON_SWEEP_REWARD_PREVIEW,o=i(n);!(e=o()).done;){var s=e.value;s[0]==this.baseId&&(t=s[1])}this.preList.datas=t},f.changeNum=function(t){null!=t&&(this.useNum=this.useNum+t),this.useNum=Math.min(this.maxNum,Math.max(this.useNum,1)),this.editBox.string=String(this.useNum),this.preList.updateAll()},n}(y));var L=function(){function t(t,e){this.view=void 0,this.scroll=void 0,this.nodeNone=void 0,this.view=t;var i=v.findChildComponent(e,"ScrollView",a);this.scroll=this.view.addUIList(i,T),this.nodeNone=v.findChild(e,"none")}return t.prototype.show=function(t){!t||t.length<=0?(this.scroll.node.active=!1,this.nodeNone.active=!0):(this.scroll.node.active=!0,this.scroll.datas=t,this.nodeNone.active=!1)},t}(),T=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).head=void 0,e.nodeSelf=void 0,e}e(i,t);var n=i.prototype;return n.onInit=function(){this.head=v.findChildComponent(this.node,"icon",f),this.nodeSelf=v.findChild(this.node,"self")},n.onRender=function(t,e){this.view.loadRemoteIcon(t.head.url,this.head),this.nodeSelf.active=!1,t.role_id==IS(g).GetRoleId()&&(this.nodeSelf.active=!0)},i}(u),b=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).itemGridNode=void 0,e.itemGrid=void 0,e}e(i,t);var n=i.prototype;return n.onInit=function(){this.itemGridNode=v.findChild(this.node,"itemGrid"),this.itemGrid=new l(this.view,this.itemGridNode)},n.onRender=function(t,e){var i=this.view;this.itemGrid.SetItemId(t[0],t[1]*i.useNum)},i}(u);n._RF.pop()}}}));

