System.register("chunks:///_virtual/ChapterTeam3.ts",["./rollupPluginModLoBabelHelpers.js","cc","./index83.ts","./EnumDefine.ts","./EventDefine.ts","./ChapterNormal.ts","./UnitGroupCtr.ts"],(function(t){"use strict";var e,a,n,r,i,o,s;return{setters:[function(t){e=t.inheritsLoose,a=t.createForOfIteratorHelperLoose},function(t){n=t.cclegacy},null,function(t){r=t.UnityType},function(t){i=t.EventDefine},function(t){o=t.ChapterNormal},function(t){s=t.UnitGroupCtr}],execute:function(){n._RF.push({},"656abo56yxAmIKwxMS2LYKc","ChapterTeam3",void 0);var l={2:290,1:90,3:-110};t("ChapterTeam3",function(t){function n(){for(var e,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).curDef=0,e.playerDeadNum=0,e}e(n,t);var o=n.prototype;return o.init=function(){this.battleMain.on(i.TFMonsterTriggerDef,this.onDefChange,this),this.battleMain.on(i.UnitDead,this.onUnitDead,this),this.curDef=configLegacy_team_chapter.getDataByKey(this.config.id).level_defence},o.destroy=function(){},o.getConfig=function(t){return configLegacy_team_chapter.getDataByKey(t)},o.loadData=function(t){var e,a=this.battleMain;for(var n in a.data.playerList){var i=a.data.playerList[n],o=new s;o.offsetY=l[i.pos],o.playerData=i;for(var u=i.units,c=0;c<u.length;c++){var f=void 0;u[c].config.type==r.Player?(f=a.unitMgr.addTFPlayer(u[c]),o.player=f):f=a.unitMgr.addPlayer(u[c]),o.units.push(f)}o.positionSelected(t,!0),a.playerCtrs.push(o)}a.mainCtr=null!=(e=a.mainCtr)?e:a.playerCtrs[0],a.showMainCtr=a.mainCtr},o.onDefChange=function(t){this.curDef<=0||(this.curDef-=t,this.curDef=Math.max(this.curDef,0),this.battleMain.emit(i.TFDefChange,this.curDef))},o.onUnitDead=function(t){var e=this.battleMain;if(!t.isCallType&&t.config.type==r.Player){this.playerDeadNum++;for(var n,i=a(e.playerCtrs);!(n=i()).done;){if(n.value.playerData.id==t.data.roleId){e.unitMgr.playerGroupDead(t.data.roleId);break}}}},o.checkPlayerDead=function(){if(this.curDef<=0)return!0;var t=this.battleMain.playerCtrs;return this.playerDeadNum>=t.length},o.toResult=function(t,e){var a=this,n=this.battleMain,r=this.config,i=configLegacy_team_chapter.getDataByKey(r.next_part);return!(0!=t||null==i||i.level!=r.level)&&(n.data.chapterId=i.id,n.addFrameTimer(1,1,(function(){a.nextPart(i.id)})),!0)},n}(o));n._RF.pop()}}}));

