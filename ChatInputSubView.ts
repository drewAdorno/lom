System.register("chunks:///_virtual/ChatInputSubView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./PlatformUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./ConfigGlobal.ts","./MessageView.ts","./GuildDataCache.ts","./GuildDefine.ts","./LoginDefine.ts","./SdkControl.ts","./ChatControl.ts","./ChatDataCache.ts","./ChatDefine.ts","./BaseSubView.ts"],(function(t){"use strict";var e,n,i,s,o,a,h,c,r,d,p,l,u,C,_,v,f,g,S,T,I,y;return{setters:[function(t){e=t.inheritsLoose},function(t){n=t.cclegacy,i=t.Label,s=t.EditBox,o=t.Button,a=t.UITransform,h=t.Node,c=t.Vec3},function(t){r=t.PlatformUtil},function(t){d=t.default},function(t){p=t.default},null,function(t){l=t.ConfigGlobal},function(t){u=t.default},function(t){C=t.default},function(t){_=t.GuildEventDefine},function(t){v=t.LoginEventDefine},function(t){f=t.default},function(t){g=t.default},function(t){S=t.ChatDataCache},function(t){T=t.ChatDefine,I=t.ChatEventDefine},function(t){y=t.BaseSubView}],execute:function(){n._RF.push({},"85c47Umb7xD44Yu5m5bC+fn","ChatInputSubView",void 0);t("ChatInputSubView",function(t){function n(){for(var e,n,i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];return(n=t.call.apply(t,[this].concat(s))||this).notInputChannel=((e={})[T.Channel.News]=GetLanguage(600000205),e[T.Channel.Activity]=GetLanguage(600000206),e[T.Channel.SeasonMapBattle]=GetLanguage(204707),e),n.inputGo=void 0,n.newsInput=void 0,n.input=void 0,n.faceBtn=void 0,n.sendBtn=void 0,n.noInputBtn=void 0,n.answer=void 0,n.channel=void 0,n.target_id=void 0,n.cacheContentType=void 0,n.cacheLinkType=void 0,n.cacheData=void 0,n.changeBtn=void 0,n.speedBtn=void 0,n.speedBtnTrans=void 0,n.changeBtnSpeed=void 0,n.changeBtnInput=void 0,n.recordPanel=void 0,n.recordState1=void 0,n.recordState2=void 0,n.min_x=0,n.min_y=0,n.max_x=0,n.max_y=0,n.is_speed=!1,n.is_in_btn_out=!1,n.is_record_voice=!1,n.record_sec=0,n.record_timer=void 0,n.is_success_voice=!1,n.voiceBtnX=188,n.inputBtnX=102,n.is_set_cache=0,n}e(n,t);var y=n.prototype;return y.onInit=function(){var t=this;this.inputGo=this.findChild("input"),this.newsInput=this.findChildComponent("newsInputGo",i),this.input=this.findChildComponent("input/inputField",s),this.addComponentCallbackListener(this.input.node,s.EventType.EDITING_DID_BEGAN,(function(){""==t.input.string&&IS(S).GetHasMentionRole()&&IS(S).ClearMentionRole(),t.target_id!=T.VIPGmUid?r.UpdateCurrentEditBox(t.input):r.ClearEditBox(),t.answer.active&&IS(S).GetShowAnswerTip&&(IS(S).SetShowAnswerTip(!1),t.showAnswerTip())})),this.addComponentCallbackListener(this.input.node,s.EventType.TEXT_CHANGED,(function(){t.cacheContentType=null,t.cacheLinkType=null,t.cacheData=null,t.is_set_cache=2})),this.answer=this.findChild("input/answer"),this.faceBtn=this.findChild("input/faceBtn"),this.addComponentCallbackListener(this.faceBtn,o.EventType.CLICK,(function(){IS(S).IsOpenInput()?t.parentView.showFaceView(!0):u.showFlyTip(d.formatStrWithMirrorDeal(GetLanguage(200172),l.chat_level))})),this.sendBtn=this.findChild("input/sendBtn"),this.addComponentCallbackListener(this.sendBtn,o.EventType.CLICK,(function(){t.target_id!=T.VIPGmUid&&r.checkIsCurrentEditBox(t.input)||t.sendMessage(t.input.string,T.ChatContentType.Conetnt,null)})),this.noInputBtn=this.findChildComponent("input/noInput",i),this.addComponentCallbackListener(this.noInputBtn.node,o.EventType.CLICK,(function(){u.showFlyTip(d.formatStrWithMirrorDeal(GetLanguage(200172),l.chat_level))})),this.changeBtnSpeed=this.findChild("input/changeBtn/speed"),this.changeBtnInput=this.findChild("input/changeBtn/input"),this.changeBtn=this.findChild("input/changeBtn"),1==GlobalDefine.IS_APP&&(this.changeBtn.active=!1),this.addComponentCallbackListener(this.changeBtn,o.EventType.CLICK,(function(){IS(S).IsOpenInput()?(t.is_speed=!t.is_speed,t.updateSpeedPanel()):u.showFlyTip(d.formatStrWithMirrorDeal(GetLanguage(200172),l.chat_level))})),this.recordPanel=this.findChild("input/recordPanel"),this.recordState1=this.findChild("input/recordPanel/open"),this.recordState2=this.findChild("input/recordPanel/cancel"),this.recordPanel.active=!1,this.recordState2.active=!1,this.speedBtn=this.findChild("input/speedBtn"),this.speedBtnTrans=this.findChildComponent("input/speedBtn",a),this.addComponentCallbackListener(this.speedBtn,h.EventType.TOUCH_START,(function(){printLogErr("log111111111111111111111111->手指开始触摸事件"),t.beginRecordVoice(),t.is_in_btn_out=!1,t.recordPanel.active=!0,t.recordState1.active=!0,t.recordState2.active=!1})),this.addComponentCallbackListener(this.speedBtn,h.EventType.TOUCH_MOVE,(function(e){var n,i=e.touch.getUILocation();(n=!(i.x>=t.min_x&&i.x<=t.max_x&&i.y>=t.min_y&&i.y<=t.max_y))!=t.is_in_btn_out&&(t.recordState1.active=!n,t.recordState2.active=n),t.is_in_btn_out=n})),this.addComponentCallbackListener(this.speedBtn,h.EventType.TOUCH_END,(function(){t.SuccessEndVoice()})),this.addComponentCallbackListener(this.speedBtn,h.EventType.TOUCH_CANCEL,(function(){t.CancelEndVoice()}))},y.SuccessEndVoice=function(){this.stopRecordVoice(),this.is_record_voice&&(this.is_success_voice=!0),this.recordPanel.active=!1,this.is_record_voice=!1,0==GlobalDefine.SERVER_LIST_TYPE&&this.sendVoiceProto("test_vcode123456","pc")},y.CancelEndVoice=function(){this.is_success_voice=!1,this.is_record_voice=!1,this.recordPanel.active=!1,this.stopRecordVoice()},y.beginRecordVoice=function(){var t=this;this.is_record_voice||(this.is_success_voice=!1,this.record_sec=1,this.is_record_voice=!0,this.record_timer=this.addTimer(1,30,(function(){t.record_sec++,t.record_sec>=30&&(u.showFlyTip(GetLanguage(200175)),t.SuccessEndVoice())})),r.GetSoundScope((function(){IS(f).setCallbackRecordVoice(),IS(f).setCallbackPlayVoice(),IS(f).startRecordVoice()})))},y.stopRecordVoice=function(){this.removeTimer(this.record_timer),this.record_timer=null,r.GetSoundScope((function(){IS(f).finishRecordVoice()}))},y.sendVoiceProto=function(t,e){if(this.is_success_voice){var n=[];n.push({k:3,v:0,s:t}),n.push({k:4,v:this.record_sec,s:""}),this.sendMessage(e,T.ChatContentType.Voice,n)}this.is_success_voice=!1},y.registerUpdateHandler=function(){this.addEvent(I.UpdateCopyContent,this.UpdateCopyContent),this.addEvent(I.SendFace,this.sendMessage),this.addEvent(_.GUIDE_UPDATE_QUESTION,this.showAnswerTip),this.addEvent(v.BAIDUSPEECHTOTEXT_BACK,this.sendVoiceProto,this),this.addEvent(I.UpdateMentionName,this.UpdateMentionRole,this)},y.onAfterOpen=function(){this.is_success_voice=!1,this.is_record_voice=!1,this.is_in_btn_out=!1,this.is_set_cache=0,this.is_speed=!1,this.recordPanel.active=!1,this.min_x=this.speedBtn.worldPosition.x-this.speedBtnTrans.contentSize.x/2,this.min_y=this.speedBtn.worldPosition.y-this.speedBtnTrans.contentSize.y/2,this.max_x=this.speedBtn.worldPosition.x+this.speedBtnTrans.contentSize.x/2,this.max_y=this.speedBtn.worldPosition.y+this.speedBtnTrans.contentSize.y/2,this.updateSpeedPanel()},y.UpdateCopyContent=function(t){if(IS(S).IsOpenInput())if((this.input.string+t.content).length<=this.input.maxLength){if(t.links[0]&&t.links[0].type==T.ChatLinkType.MentionRole)for(var e=0;e<t.links[0].args_list.length;e++){var n=t.links[0].args_list[e],i=t.links[0].string_list[e];n&&i&&IS(S).SetMentionRole({role_id:n,name:i})}this.input.string+=t.content}else u.showFlyTip(GetLanguage(200203))},y.updateSpeedPanel=function(){this.changeBtnSpeed.active=!this.is_speed,this.changeBtnInput.active=this.is_speed,this.sendBtn.active=!this.is_speed,this.speedBtn.active=this.is_speed;var t=this.faceBtn.position;this.faceBtn.position=new c(this.is_speed?this.voiceBtnX:this.inputBtnX,t.y,0);this.parentView.faceView.node.position},y.UpdateMentionRole=function(t){IS(S).IsOpenInput()&&((this.input.string+"@"+t.name).length<=this.input.maxLength?(IS(S).SetMentionRole(t),this.input.string=this.input.string+"@"+t.name+" "):u.showFlyTip(GetLanguage(200203)))},y.setViewType=function(t,e){this.channel=t,this.target_id=e;var n=this.notInputChannel[this.channel];n?(this.inputGo.active=!1,this.newsInput.node.active=!0,this.newsInput.string=n):(this.newsInput.node.active=!1,this.inputGo.active=!0,IS(S).IsOpenInput()?(this.noInputBtn.node.active=!1,this.input.placeholder=GetLanguage(200176)):(this.noInputBtn.node.active=!0,this.input.placeholder="",this.noInputBtn.string=d.formatStrWithMirrorDeal(GetLanguage(200172),l.chat_level)),this.showAnswerTip())},y.sendMessage=function(t,e,n){if(e==T.ChatContentType.Face&&this.parentView.showFaceView(!1),IS(S).IsOpenInput()){if(this.cacheContentType==T.ChatContentType.Share)return this.channel!=T.Channel.Cross||this.cacheLinkType!=T.ChatLinkType.MakeTeam&&this.cacheLinkType!=T.ChatLinkType.ParkingCall?this.cacheLinkType==T.ChatLinkType.DoubleChapterInvateShare&&this.channel!=T.Channel.Private?u.showFlyTip(GetLanguage(201340)):IS(S).SendShareData(this.cacheLinkType,this.cacheData,this.channel,this.target_id):u.showFlyTip(GetLanguage(201340)),this.cacheContentType=null,this.cacheLinkType=null,this.cacheData=null,this.input.string="",void IS(S).ClearMentionRole();var i=t||this.input.string;""==t&&(i=t);var s=e||T.ChatContentType.Conetnt;if(""==i&&e!=T.ChatContentType.Voice)return void u.showFlyTip(GetLanguage(200177));IS(g).reqChatMessage(this.channel,s,i,this.target_id,null,n),this.input.string="",IS(S).ClearMentionRole()}else u.showFlyTip(d.formatStrWithMirrorDeal(GetLanguage(200172),l.chat_level))},y.setCacheShareInfo=function(t,e,n,i){this.cacheContentType=t,this.cacheLinkType=e,this.cacheData=n,this.input.string=i,this.is_set_cache=1},y.showAnswerTip=function(){if(this.channel==T.Channel.Guild&&IS(S).GetShowAnswerTip()){var t=IS(C).GetGuildQuestion();t&&t.question>0&&p.serverTime<t.countdown&&1!=t.is_show?this.answer.active=!0:this.answer.active=!1}else this.answer.active=!1},y.onBeforeClose=function(){r.ClearCurrentEditBox(this.input),this.record_timer=null,this.is_record_voice&&this.CancelEndVoice(),sdkControl.ResetVoiceState(),this.cacheContentType=null,this.cacheLinkType=null,this.cacheData=null,this.input.string="",IS(S).ClearMentionRole()},y.onDestroy=function(){},n}(y));n._RF.pop()}}}));

