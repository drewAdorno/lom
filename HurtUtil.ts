System.register("chunks:///_virtual/HurtUtil.ts",["cc","./ConfigGlobal.ts","./FixMath.ts","./MetaAttrib.ts","./EnumDefine.ts"],(function(t){"use strict";var r,a,n,e,d,i;return{setters:[function(t){r=t.cclegacy},function(t){a=t.ConfigGlobal},function(t){n=t.FixMath},function(t){e=t.AttribDefine},function(t){d=t.UnityType,i=t.AttackType}],execute:function(){r._RF.push({},"0c561qs1MhCP4+rdZbtUfrL","HurtUtil",void 0);t("normalHurt",(function(t,r,a){var i=t.data.getAttrib(e.att),u=r.data.getAttrib(e.def),g=r.data.getAttrib(e.def_coe),b=t.data.getAttrib(e.crit_dam),l=r.data.getAttrib(e.crit_def),c=r.data.getAttrib(e.att_resist),m=t.data.getAttrib(e.att_dam);if(t.config.type==d.Partner){c=r.data.getAttrib(e.partner_resist),m=t.data.getAttrib(e.partner_dam);var s=t.data.getAttrib(e.partner_dam_extra);m=n.round(m*n.round(1+s))}else t.config.type==d.Gun&&(m=t.data.getAttrib(e.partner_dam),c=r.data.getAttrib(e.season_cannon_att_def));var A=n.roundInt(Math.max(n.roundInt(i-u*(1+g)),1)*n.round(m*n.round(1-c)));return A=o(A,r,t),1==a||(A=n.roundInt(A*Math.max(1.5,n.round(b/l)))),Math.max(1,A)}));var o=t("calHurt",(function(t,r,a){var d=r.data.getAttrib(e.resist),i=r.data.getAttrib(e.pve_resist),o=a.data.getAttrib(e.pve_dam);t=n.roundInt(t*n.round(1+o));var u=n.roundInt(n.roundInt(t*n.round(1-d))*n.round(1-i));return Math.max(1,u)})),u=(t("normalDoubleHurt",(function(t,r,a){var i=t.data.getAttrib(e.att),u=r.data.getAttrib(e.def),g=r.data.getAttrib(e.def_coe),b=t.data.getAttrib(e.crit_dam),l=r.data.getAttrib(e.crit_def),c=r.data.getAttrib(e.double_hit_def),m=t.data.getAttrib(e.double_hit_dam),s=0;if(t.config.type==d.Partner){var A=t.data.getAttrib(e.partner_dam),f=t.data.getAttrib(e.partner_dam_extra);A=n.round(A*n.round(1+f));var _=r.data.getAttrib(e.partner_resist),p=n.roundInt(Math.max(n.roundInt(i-u*(1+g)),1)*A)*n.round(1-_);s=n.roundInt(n.roundInt(p)*m)*n.round(1-c),s=n.roundInt(s)}else if(t.config.type==d.Gun){var M=t.data.getAttrib(e.partner_dam);M=t.data.getAttrib(e.partner_dam);var h=r.data.getAttrib(e.season_cannon_att_def),I=n.roundInt(Math.max(n.roundInt(i-u*(1+g)),1)*M)*n.round(1-h);s=n.roundInt(n.roundInt(I)*m)*n.round(1-c),s=n.roundInt(s)}else s=n.roundInt(Math.max(n.roundInt(i-u*(1+g)),1)*m)*n.round(1-c),s=n.roundInt(s);return s=o(s,r,t),1==a||(s=n.roundInt(s*Math.max(1.5,n.round(b/l)))),Math.max(1,s)})),t("normalCounterHurt",(function(t,r,a){var d=t.data.getAttrib(e.att),i=r.data.getAttrib(e.def),u=r.data.getAttrib(e.def_coe),g=t.data.getAttrib(e.crit_dam),b=r.data.getAttrib(e.crit_def),l=r.data.getAttrib(e.counter_def),c=t.data.getAttrib(e.counter_dam),m=n.roundInt(Math.max(n.roundInt(d-i*(1+u)),1)*c)*n.round(1-l);return m=n.roundInt(m),m=o(m,r,t),1==a||(m=n.roundInt(m*Math.max(1.5,n.round(g/b)))),Math.max(1,m)})),t("normailHpsteal",(function(t,r,a){var d=t.data.getAttrib(e.att_hpsteal)-r.data.getAttrib(e.att_hpsteal_def);return d=n.roundInt(d),d=Math.max(0,d),n.roundInt(a*d)})),t("normailHpsteal1",(function(t,r){var a=t.data.getAttrib(e.hpsteal_amount),d=t.data.getAttrib(e.ignore_hpsteal),i=n.round(a*Math.max(0,n.round(1-d))),o=t.data.getAttribByInt(e.hp);return n.roundInt(o*i)})),t("skillHpsteal",(function(t,r,a){var d=t.data.getAttrib(e.skill_hpsteal)-r.data.getAttrib(e.skill_hpsteal_def);return d=Math.max(0,n.round(d)),n.roundInt(a*d)})),[0,0,0]);t("checkHit",(function(t,r,d){void 0===d&&(d=!1);var o=t.data.getAttrib(e.hit),g=d?0:r.data.getAttrib(e.miss),b=t.data.getAttrib(e.crit_rate),l=Math.max(n.round(g-o),0),c=t.battleMain.random.randomInt(0,1e4);u[i.Miss]=n.roundInt(Math.pow(n.round(100*l),n.round(a.miss_correct/1e4))/100*1e4),u[i.Normal]=n.roundInt(u[i.Miss]+n.roundInt(n.round(1-l)*n.round(1-b)*1e4)),u[i.Cirt]=n.roundInt(u[i.Normal]+n.roundInt(n.round(1-l)*b*1e4));var m=-1;t.battleMain.printLogFlag&&t.battleMain.printLogDebug("rand: "+c+" cirt: "+u[i.Cirt]+" miss: "+u[i.Miss]);for(var s=0;s<2;s++)if(u[s]>0&&c<=u[s]){m=s;break}return-1==m&&(m=i.Cirt),m})),t("checkDoubleAct",(function(t,r){var a=t.data.getAttrib(e.double_hit),d=0;r&&(d=r.data.getAttrib(e.ignore_double_hit));var i=n.roundInt(1e4*Math.max(n.round(a-d),0));if(i<=0)return!1;var o=t.battleMain.random.randomInt(0,1e4);return t.battleMain.printLogFlag&&t.battleMain.printLogDebug("连击 rand: "+o+" tem: "+i),o<=i})),t("checkCounterAct",(function(t,r){var a=t.data.getAttrib(e.counter),d=r.data.getAttrib(e.ignore_counter),i=n.roundInt(1e4*Math.max(n.round(a-d),0));if(i<=0)return!1;var o=t.battleMain.random.randomInt(0,1e4);return t.battleMain.printLogFlag&&t.battleMain.printLogDebug("反击 rand: "+o+" tem: "+i),o<=i})),t("checkThrowHit",(function(t,r){var a=t.data.getAttrib(e.suspend),d=r.data.getAttrib(e.suspend_def),i=n.roundInt(1e4*n.round(a-d));if(i<=0)return!1;var o=t.battleMain.random.randomInt(0,1e4);return t.battleMain.printLogFlag&&t.battleMain.printLogDebug("击飞 rand: "+o+" tem: "+i),o<=i})),t("checkCounterThrowHit",(function(t,r){var a=t.data.getAttrib(e.counter_suspend),d=r.data.getAttrib(e.suspend_def),i=n.roundInt(1e4*n.round(a-d));if(i<=0)return!1;var o=t.battleMain.random.randomInt(0,1e4);return t.battleMain.printLogFlag&&t.battleMain.printLogDebug("反击击飞 rand: "+o+" tem: "+i),o<=i})),t("checkDizz",(function(t,r){var d=t.data.getAttrib(e.vertigo),i=r.data.getAttrib(e.vertigo_def),o=Math.max(0,n.round(d-i));if(o<=0)return!1;var u=n.round(Math.pow(n.round(100*o),n.round(a.vertigo_correct/1e4))/100);if((u=n.roundInt(1e4*u))<=0)return!1;var g=t.battleMain.random.randomInt(0,1e4);return t.battleMain.printLogFlag&&t.battleMain.printLogDebug("击晕 rand: "+g+" tem: "+u),g<=u})),t("checkSkillCirt",(function(t){var r=t.data.getAttrib(e.skill_crit_rate),a=n.roundInt(1e4*r);if(a<=0)return!1;var d=t.battleMain.random.randomInt(0,1e4);return t.battleMain.printLogFlag&&t.battleMain.printLogDebug("击晕 rand: "+d+" tem: "+a),d<a})),t("checkNormailHpsteal1",(function(t,r){var a=t.data.getAttrib(e.hpsteal_rate)-r.data.getAttrib(e.hpsteal_res);if((a=n.roundInt(Math.max(0,1e4*n.round(a))))<=0)return!1;var d=t.battleMain.random.randomInt(0,1e4);return t.battleMain.printLogFlag&&t.battleMain.printLogDebug("击晕 rand: "+d+" tem: "+a),d<=a}));r._RF.pop()}}}));

