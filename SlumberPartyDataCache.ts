System.register("chunks:///_virtual/SlumberPartyDataCache.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ConfigGlobal.ts","./MainViewModel.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./SlumberPartyControl.ts"],(function(t){"use strict";var e,i,n,r,a,o,s,u;return{setters:[function(t){e=t.createForOfIteratorHelperLoose},function(t){i=t.cclegacy},function(t){n=t.ConfigGlobal},function(t){r=t.MainViewModel},function(t){a=t.default},function(t){o=t.ActivityType,s=t.ActivityEventDefine},function(t){u=t.default}],execute:function(){i._RF.push({},"16f17FDtQ5M+JcZRHDyXTjn","SlumberPartyDataCache",void 0);t("SlumberPartyDataCache",function(){var t=i.prototype;function i(){this.info={},this.FightRed=void 0,this.PartyRed=void 0,this.fightInfo={lev:0,lev_succ:0,boss_id:0,hp:0,hp_max:0,times:0,score_list_self:{},score_list_serv:{}},normalEvent.on(s.OnActivityInfoTaskUpdate,this.RefreshRed,this),normalEvent.on(s.OnActivityInfoUpdate,this.RefreshRed,this)}return t.clear=function(){},t.updateInfo=function(t){var i,n,r;this.PartyRed=0,this.info[t.act_type]||(this.info[t.act_type]={count:0,gotReward:{},lucky_list:[],remain_draw:90,get_drop:[],choose_list:{},guaranteed_list:{}}),this.info[t.act_type].count=t.count,this.info[t.act_type].gotReward={};for(var u,f=e(null!=(l=t.count_reward_list)?l:{});!(u=f()).done;){var l,d=u.value;this.info[t.act_type].gotReward[d]=!0}this.info[t.act_type].choose_list={};for(var c,h=e(null!=(_=t.choose_list)?_:[]);!(c=h()).done;){var _,v=c.value;this.info[t.act_type].choose_list[v.k]=v.list}var g=configMount_draw_cumulative_times.getDatas(),p=IS(a).GetActivityInfo(o.OpenGaCha);if(p){for(var y,R=0,m=e(g);!(y=m()).done;){var I=y.value;I.type==p.type&&I.group_id==p.roundCfg.group_id&&I.cumulative_times<=t.count&&(R+=1)}this.PartyRed=R-t.count_reward_list.length,this.info[t.act_type].guaranteed_list={};for(var w,F=e(null!=(P=t.guaranteed_list)?P:[]);!(w=F()).done;){var P,S=w.value;this.info[t.act_type].guaranteed_list[S.k]=S.v}this.info[t.act_type].lucky_list=null!=(i=t.lucky_list)?i:[],this.info[t.act_type].remain_draw=null!=(n=t.remain_draw)?n:90,this.info[t.act_type].get_drop=null!=(r=t.get_drop)?r:[],normalEvent.emit(s.OnSlumberPartyUpdate),IS(a).UpdateMainRedByActType(t.act_type)}},t.updateReward=function(t){this.info[t.act_type].gotReward[t.id]=!0,normalEvent.emit(s.OnSlumberPartyReward),IS(a).UpdateMainRedByActType(t.act_type)},t.updateFightInfo=function(t){this.fightInfo.lev=t.lev,this.fightInfo.lev_succ=t.lev_succ,this.fightInfo.boss_id=t.boss_id,this.fightInfo.hp=t.hp,this.fightInfo.hp_max=t.hp_max,this.fightInfo.times=t.times,this.FightRed=0;for(var i,n=e(null!=(r=t.score_list_self)?r:{});!(i=n()).done;){var r,a=i.value;this.fightInfo.score_list_self[a.id]={status:null,reward:null},this.fightInfo.score_list_self[a.id].status=a.status,1==a.status&&(this.FightRed=this.FightRed+1),this.fightInfo.score_list_self[a.id].reward=a.reward_list[0]}for(var o,u=e(null!=(f=t.score_list_serv)?f:{});!(o=u()).done;){var f,l=o.value;this.fightInfo.score_list_serv[l.id]={status:null,reward:null},this.fightInfo.score_list_serv[l.id].status=l.status,1==l.status&&(this.FightRed=this.FightRed+1),this.fightInfo.score_list_serv[l.id].reward=l.reward_list[0]}normalEvent.emit(s.OnPartyFightInfoUpdate),this.RefreshRed()},t.updateFightReward=function(t){uiMgr.openView("GoodsGetView",t.reward_list),normalEvent.emit(s.OnPartyFightRewardUpdate),IS(u).send_24_19(o.SlumberFight)},t.getInfo=function(t){var e;return null!=(e=this.info[t])?e:{count:0,gotReward:{},lucky_list:[],remain_draw:90,get_drop:[],choose_list:{},guaranteed_list:{}}},t.getFightInfo=function(){return this.fightInfo},t.getRedNum=function(t){var e=IS(a).GetActivityInfo(t);if(!e)return 0;var i=configMount_draw_cumulative_times.getDatas(),n=this.getInfo(t);for(var r in i)if(i.hasOwnProperty(r)){var o=i[r];if(n.count>=o.cumulative_times&&!n.gotReward[o.id]&&o.type==e.type&&o.group_id==e.roundCfg.group_id)return 1}return 0},t.canSelectReward=function(t,i){var n,r=IS(a).GetActivityInfo(t);if(!r)return!1;var o=configMount_draw.getDatas();if(i){for(var s in o)if(o.hasOwnProperty(s)){var u=o[s];u.id==i&&(n=u)}}else for(var f in o)if(o.hasOwnProperty(f)){var l=o[f];if(l.type==r.type&&l.group_id==r.roundCfg.group_id&&4==l.quality){n=l;break}}if(!n)return!1;for(var d,c=e(n.reward_replace);!(d=c()).done;){var h,_;d.value;return(null!=(h=null==(_=this.getInfo(t).choose_list[n.id])?void 0:_[1])?h:0)>0}return!1},t.GetCost=function(t){for(var i,r=n.mount_draw_expend,a=e(r);!(i=a()).done;){var o=i.value;if(o[0]==t)return o[1]}},t.GetFightCost=function(t){var e=IS(a).GetActivityInfo(t);return configActivity_boss.getDataByKeys("type",t,"group_id",e.roundCfg.group_id).expend},t.GetFightRed=function(){return this.FightRed},t.RefreshRed=function(){var t=IS(a).GetActivityInfo(o.OpenGaCha);null==this.FightRed&&(this.FightRed=0),(null==this.PartyRed||this.PartyRed<0)&&(this.PartyRed=0),t&&t.activityCfg&&IS(r).updateIconRedDot(t.activityCfg.main_icon,this.FightRed+this.PartyRed+IS(a).GetTaskRedNum(o.OpenGaCha))},i}());i._RF.pop()}}}));

