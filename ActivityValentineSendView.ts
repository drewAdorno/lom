System.register("chunks:///_virtual/ActivityValentineSendView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIList.ts","./RedPoint.ts","./RedPointMgr.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./BagDefine.ts","./CommonModel.ts","./ResItems.ts","./MessageView.ts","./FriendControl.ts","./RoleDataCache.ts","./ActivityControl.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./ActivityValentineDataCache.ts","./ActivityValentineDefine.ts","./BaseView.ts"],(function(t){"use strict";var e,i,n,s,o,a,d,r,c,l,h,u,f,m,v,p,g,C,I,x,S,T,L,R,y,w,b,N,_,G,D,A;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,n=t.Label,s=t.Button,o=t.ScrollView,a=t.EditBox,d=t.js,r=t.LabelOutline,c=t.Color,l=t.Sprite,h=t.RichText,u=t.Vec2},function(t){f=t.ListItem},function(t){m=t.RedPointType},function(t){v=t.RedPointMgr},function(t){p=t.default},function(t){g=t.default},function(t){C=t.default},null,function(t){I=t.BagEventDefine},function(t){x=t.CommonModel},function(t){S=t.ResItems},function(t){T=t.default},function(t){L=t.default},function(t){R=t.RoleDataCache},function(t){y=t.default},function(t){w=t.default},function(t){b=t.ActivityEventDefine,N=t.ActivityType,_=t.ActivityState},function(t){G=t.ActivityValentineDataCache},function(t){D=t.ActivityValentineEvent},function(t){A=t.BaseView}],execute:function(){i._RF.push({},"d5508jIvfxPP6YKFAzIqRaT","ActivityValentineSendView",void 0);var U=1,V=2,E=3,O=[1118,1119],k=(t("default",function(t){function i(){var e;return(e=t.call(this)||this).resItems=void 0,e.scrollSendNode=void 0,e.scrollSend=void 0,e.inputNode=void 0,e.input=void 0,e.scrollRecordNode=void 0,e.scrollRecord=void 0,e.btnCancel=void 0,e.tabBtns=[],e.curIndex=0,e.rankInfo=void 0,e.txtTimeDesc=void 0,e.txtLeftTime=void 0,e.leftTime=0,e.deltaTime=0,e.canUpdate=!1,e.name="ActivityValentineSendView",e.url="ui/module/valentine/ActivityValentineSendView",e}e(i,t);var r=i.prototype;return r.onInit=function(){var t=this;this.txtTimeDesc=this.findChildComponent("view/nodeTime/txtDesc",n),this.txtLeftTime=this.findChildComponent("view/nodeTime/txtTime",n),this.resItems=new S(this),this.resItems.init(O);var e=this.findChild("view/btnClose");this.addComponentCallbackListener(e,s.EventType.CLICK,(function(){t.close()}));for(var i=function(e){var i=p.findChild(t.node,d.formatStr("view/tabBtn/item%s",e));t.addRedPoint("qixi_record/tab"+e,i,new u(50,20),m.Dot),IS(v).updateRed("qixi_record/tab"+e);var n={itemGo:i,normalGo:p.findChild(i,"normal"),selectedGo:p.findChild(i,"selected"),index:e};t.addComponentCallbackListener(i,s.EventType.CLICK,(function(){t.SetIndex(n.index)})),t.tabBtns[e]=n},r=1;r<=3;r++)i(r);this.scrollSendNode=this.findChild("view/scrollSend"),this.scrollSend=this.addUIList(this.scrollSendNode.getComponent(o),k),this.scrollRecordNode=this.findChild("view/scrollRecord"),this.scrollRecord=this.addUIList(this.scrollRecordNode.getComponent(o),B),this.addComponentCallbackListener(this.scrollRecordNode,o.EventType.SCROLL_TO_BOTTOM,(function(){var e,i;if(t.curIndex==V?(e=IS(G).getRecordList().send,i=1):t.curIndex==E&&(e=IS(G).getRecordList().receive,i=2),e&&!e.isMax){var n=e.curPage+1;IS(y).send_24_35(i,n)}})),this.inputNode=this.findChild("view/input"),this.input=this.findChildComponent("view/input/input",a),this.addComponentCallbackListener(this.input.node,a.EventType.EDITING_DID_ENDED,(function(){""==t.input.string?(t.UpdateRankInfo(),t.btnCancel.active=!1):t.btnCancel.active=!0}));var c=this.findChild("view/input/btnSearch");this.addComponentCallbackListener(c,s.EventType.CLICK,(function(){var e=t.input.string;""!=e?e.length<5?T.showFlyTip(GetLanguage(200070)):IS(y).send_24_32(e):t.UpdateRankInfo()})),this.btnCancel=this.findChild("view/input/btnCancel"),this.addComponentCallbackListener(this.btnCancel,s.EventType.CLICK,(function(){t.input.string="",t.btnCancel.active=!1,t.UpdateRankInfo()}))},r.registerUpdateHandler=function(){this.addEvent(D.OnActivityValentineRecommendList,this.UpdateRankInfo,this),this.addEvent(b.OnActivityQixiUidSearch,this.onSearchUpdate,this),this.addEvent(D.OnActivityValentineRecordList,this.upateRecord,this),this.addEvent(I.GOODS_INFO_UPDATE,this.updateResShow,this),this.addEvent(b.OnActivityInfoUpdate,this.updateInfo,this)},r.onAfterOpen=function(){this.input.placeholder=GetLanguage_UI(100049);var t=IS(w).GetActivityInfo(N.Qixi);if(t){var e,i=null!=(e=t.state_time[t.state])?e:t.state_time[_.Open];if(this.leftTime=i.end_time-C.serverTime,this.leftTime>0){var n="";t.state==_.Preview?n=GetLanguage(200763):t.state==_.Open?n=GetLanguage(200764):t.state==_.EndShow&&(n=GetLanguage(200765)),this.txtTimeDesc.string=n,this.canUpdate=!0,this.txtLeftTime.string=d.formatStr("%s",C.formatTimeStringForSecond(this.leftTime))}else this.txtLeftTime.string=GetLanguage(200026)}else this.txtTimeDesc.string=GetLanguage(200765),this.txtLeftTime.string=GetLanguage(200026);this.updateResShow(),IS(w).GetActivityInfo(N.QiXiFlowerRank).roundCfg.rank_id,this.SetIndex(U)},r.onBeforeClose=function(){this.curIndex>0&&(this.tabBtns[this.curIndex].normalGo.active=!0,this.tabBtns[this.curIndex].selectedGo.active=!1,this.curIndex=0),this.canUpdate=!1},r.onDestroy=function(){},r.onUpdate=function(t){this.canUpdate&&(this.deltaTime=this.deltaTime+t,this.deltaTime>=1&&(this.deltaTime=0,this.leftTime=this.leftTime-1,this.leftTime>0?this.txtLeftTime.string=d.formatStr("%s",C.formatTimeStringForSecond(this.leftTime)):(this.txtLeftTime.string=GetLanguage(200026),this.canUpdate=!1)))},r.updateResShow=function(){this.resItems.update()},r.SetIndex=function(t){this.curIndex!=t&&(this.curIndex>0&&(this.tabBtns[this.curIndex].selectedGo.active=!1,this.tabBtns[this.curIndex].normalGo.active=!0),this.curIndex=t,this.tabBtns[this.curIndex].normalGo.active=!1,this.tabBtns[this.curIndex].selectedGo.active=!0,this.curIndex==U?(this.scrollSendNode.active=!0,this.scrollRecordNode.active=!1,this.inputNode.active=!0,this.input.string="",this.btnCancel.active=!1,IS(y).send_24_145()):this.curIndex==V?(this.scrollSendNode.active=!1,this.scrollRecordNode.active=!0,this.inputNode.active=!1,IS(y).send_24_35(1,1)):this.curIndex==E&&(this.scrollSendNode.active=!1,this.scrollRecordNode.active=!0,this.inputNode.active=!1,IS(y).send_24_35(2,1)))},r.UpdateRankInfo=function(){if(this.rankInfo=IS(G).getRecRoleList().role_list,this.rankInfo){for(var t=[],e=0;e<this.rankInfo.length;e++){var i=this.rankInfo[e];i&&t.push(i)}this.scrollSend.datas=t}},r.onSearchUpdate=function(t){this.scrollSend.datas=t},r.upateRecord=function(){var t;this.curIndex==V?t=IS(G).getRecordList().send:this.curIndex==E&&(t=IS(G).getRecordList().receive),t&&(this.scrollRecord.datas=t.list)},r.updateInfo=function(t){if(t.type==N.Qixi&&t.state!=_.Null){var e,i=null!=(e=t.state_time[t.state])?e:t.state_time[_.Open];if(this.leftTime=i.end_time-C.serverTime,this.leftTime>0){var n="";t.state==_.Preview?n=GetLanguage(200763):t.state==_.Open?n=GetLanguage(200764):t.state==_.EndShow&&(n=GetLanguage(200765)),this.txtTimeDesc.string=n,this.canUpdate=!0,this.txtLeftTime.string=d.formatStr("%s",C.formatTimeStringForSecond(this.leftTime))}else this.txtLeftTime.string=GetLanguage(200026)}},i}(A)),function(t){function i(){for(var e,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))||this).roleNode=void 0,e.txtName=void 0,e.nameOutline=void 0,e.nodePeer=void 0,e.txtNum=void 0,e.model=void 0,e}e(i,t);var o=i.prototype;return o.onInit=function(){var t=this;this.roleNode=p.findChild(this.node,"role/icon"),this.txtName=p.findChildComponent(this.node,"txtName",n),this.nameOutline=p.findChildComponent(this.node,"txtName",r),this.nodePeer=p.findChild(this.node,"peer"),this.txtNum=p.findChildComponent(this.node,"num/num",n);var e=p.findChild(this.node,"btnSend");this.view.addComponentCallbackListener(e,s.EventType.CLICK,(function(){t.data.belong_id!=IS(R).GetRoleId()?uiMgr.openView("ActivityValentineSendTipsView",t.data.belong_id):T.showFlyTip(GetLanguage(200071))}))},o.onRender=function(t,e){this.txtName.string=t.name,this.txtNum.string=g.GetNumString(t.score),this.nameOutline.color=new c(133,70,187),this.nodePeer.active=!1,t.belong_id==IS(G).getPartnerId()?(this.nameOutline.color=new c(233,84,0),this.nodePeer.active=!0):(this.nameOutline.color=new c(133,70,187),this.nodePeer.active=!1),null!=this.model&&(this.view.removeUnitModel(this.model),this.model=null),this.model=IS(x).AddRoleModel(this.view,t.figure,this.roleNode)},i}(f)),B=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),s=0;s<i;s++)n[s]=arguments[s];return(e=t.call.apply(t,[this].concat(n))||this).imgFrame=void 0,e.imgIcon=void 0,e.txtName=void 0,e.txtTime=void 0,e.txtDesc=void 0,e.btnDesc=void 0,e}e(i,t);var o=i.prototype;return o.onInit=function(){var t=this;this.imgFrame=p.findChildComponent(this.node,"imgFrame",l),this.imgIcon=p.findChildComponent(this.node,"imgFrame/imgIcon",l),this.txtName=p.findChildComponent(this.node,"name",n),this.txtTime=p.findChildComponent(this.node,"txtTime",n),this.txtDesc=p.findChildComponent(this.node,"txtDesc",h),this.btnDesc=p.findChildComponent(this.node,"btnSend/Label",n);var e=p.findChild(this.node,"btnSend");this.view.addComponentCallbackListener(e,s.EventType.CLICK,(function(){t.data.belong_id!=IS(R).GetRoleId()?uiMgr.openView("ActivityValentineSendTipsView",t.data.role_id):T.showFlyTip(GetLanguage(200071))})),this.view.addComponentCallbackListener(this.imgFrame.node,s.EventType.CLICK,(function(){IS(L).reqOtherRoleNotice(t.data.belong_id)}))},o.onRender=function(t,e){this.txtName.string=t.name,this.view.loadRemoteIcon(t.head.url,this.imgIcon);var i=configGoods.getDataByKey(t.cfg_id),n="",s=i.id==O[0]?"#138c13":"#d81f61";this.view.curIndex==V?n=GetLanguage(200072):this.view.curIndex==E&&(n=GetLanguage(200073)),this.txtDesc.string=d.formatStr(n,s,i.name,t.num),this.btnDesc.string=this.view.curIndex==V?GetLanguage(400423):GetLanguage(400424);var o=C.formatDate(new Date(1e3*t.time),"yy.MM.dd hh:mm:ss");this.txtTime.string=o},i}(f);i._RF.pop()}}}));

