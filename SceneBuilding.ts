System.register("chunks:///_virtual/SceneBuilding.ts",["./rollupPluginModLoBabelHelpers.js","cc","./V2.ts","./NodeUtil.ts","./TimeUtil.ts","./UIEffectAsset.ts","./SLGMapData.ts","./SeasonSceneDataCache.ts","./SceneUnit4.ts"],(function(e){"use strict";var i,t,n,o,a,l,s,d,r,u,f,c,m,h,p;return{setters:[function(e){i=e.inheritsLoose,t=e.createForOfIteratorHelperLoose,n=e.createClass},function(e){o=e.cclegacy,a=e.Vec2,l=e.Label,s=e.sys,d=e.Color},function(e){r=e.V2},function(e){u=e.default},function(e){f=e.default},function(e){c=e.UIEffectAsset},function(e){m=e.SLGMapData},function(e){h=e.SeasonSceneDataCache},function(e){p=e.SceneUnit}],execute:function(){o._RF.push({},"b2afdC76gtHyaYt9u554fb6","SceneBuilding",void 0);var _=new a;e("SceneBuilding",function(e){function o(i,n,o){var a;(a=e.call(this)||this).info=void 0,a.map=void 0,a.model=void 0,a.buildName=void 0,a.map=i,a.info=n,a.uid=o;var f=m.getIndexToCR(n.id);_.set(f),f=m.getCRToPos(f.x,f.y);var h=new r(f.x,f.y),p=configSeason_building_plot.getDataByKey(n.fill_obj.base_id);if(a.model=c.alloc("prefab/map/slgmap/"+p.prefab_name,i.nodeUnitMap.obj,-1,(function(e){a.onInit(e)})),a.model.position=h,a.id=n.id,1==p.name_show&&(a.buildName=c.alloc("ui/module/season/scene/BuildName",i.nodeUnitMap.shipName,-1,(function(e){var i=u.findChildComponent(e.node,"txtName",l);i.string=p.name,s.uiMirror&&i.node.setScale(1,1,1),i.color=d.WHITE})),a.buildName.position=h),n.fill_obj.area_id&&n.fill_obj.area_id>0)for(var g,b=_.x%2==0?p.plot_number_even:p.plot_number,v=t(b);!(g=v()).done;){var y=g.value,S=m.getCRToIndex(_.x+y[0],_.y+y[1]);i.addRegion(S,n.fill_obj.area_id,a.uid)}return a}i(o,e);var a=o.prototype;return a.onInit=function(e){},a.onDestroy=function(){this.model&&this.model.free(),this.model=null,this.buildName&&this.buildName.free(),this.buildName=null},a.delRegion=function(){if(this.info&&this.info.area_id)for(var e,i=configSeason_building_plot.getDataByKey(this.info.fill_obj.base_id),n=_.x%2==0?i.plot_number_even:i.plot_number,o=t(n);!(e=o()).done;){var a=e.value,l=m.getCRToIndex(_.x+a[0],_.y+a[1]);this.map.delRegion(l,this.uid)}},a.onUpdate=function(e){if(this.info&&IS(h).roleInfo){var i=IS(h).gridTimeMap;if(this.model.node){var t=this.model.node.children[0];if(!t)return;t.active=i[this.info.id]&&f.serverTime<i[this.info.id].time}}},n(o,[{key:"position",get:function(){return this.model.position},set:function(e){this.model.position=e}},{key:"depth",get:function(){return this.model.depth},set:function(e){this.model.depth=e}},{key:"del",get:function(){return this._del},set:function(e){this._del=e,e&&this.delRegion()}}]),o}(p));o._RF.pop()}}}));

