System.register("chunks:///_virtual/ParkingMainView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./V2.ts","./UIList.ts","./RedPoint.ts","./RedPointMgr.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./BaseView.ts","./ItemIcon.ts","./UIUnitModelObj.ts","./ConfigGlobal.ts","./BagDefine.ts","./BagModel.ts","./ChapterControl.ts","./CommonModel.ts","./MessageView.ts","./EquipModel.ts","./FriendControl.ts","./RoleDataCache.ts","./RoleDefine.ts","./ParkingControl.ts","./ParkingDataCache.ts","./ParkingDefine.ts","./ParkingMapScene.ts"],(function(e){"use strict";var i,t,n,o,s,a,r,d,l,h,c,p,u,f,v,C,g,m,S,I,T,w,P,b,k,_,R,y,M,L,E,V,D,B,x,N,O,G,A,K,H,U,F;return{setters:[function(e){i=e.inheritsLoose,t=e.createForOfIteratorHelperLoose,n=e.assertThisInitialized},function(e){o=e.cclegacy,s=e.Button,a=e.ScrollView,r=e.UITransform,d=e.NodeEventType,l=e.Vec3,h=e.Vec2,c=e.Label,p=e.sys,u=e.Sprite,f=e.js,v=e.ProgressBar},function(e){C=e.V2},function(e){g=e.ListItem},function(e){m=e.RedPointType},function(e){S=e.RedPointMgr},function(e){I=e.default},function(e){T=e.default},function(e){w=e.default},function(e){P=e.ViewEvent,b=e.BaseView},function(e){k=e.IconAseetType},function(e){_=e.UIUnitModelObj},function(e){R=e.ConfigGlobal},function(e){y=e.BagEventDefine},function(e){M=e.BagModel},function(e){L=e.default},function(e){E=e.CommonModel},function(e){V=e.default},function(e){D=e.EquipModel},function(e){B=e.default},function(e){x=e.RoleDataCache},function(e){N=e.RoleEventDefine,O=e.RoleRedPointSystemEnum,G=e.PlayerAttr},function(e){A=e.default},function(e){K=e.ParkingDataCache},function(e){H=e.DEC_TYPE,U=e.ParkingEventDefine},function(e){F=e.ParkingMapScene}],execute:function(){o._RF.push({},"69efaFuyN5HeJ2F4rjUxcdr","ParkingMainView",void 0);var j=[201,203],Y=(e("default",function(e){function o(){var i;return(i=e.call(this)||this).mapScene=void 0,i.nodeBtnClose=void 0,i.nodeBtnBack=void 0,i.curOpenView=void 0,i.openTypeItems=void 0,i.posToParkingSpot=void 0,i.scrollCar=void 0,i.txtName=void 0,i.nodeSettingTax=void 0,i.nodeShowTax=void 0,i.txtNoneTax=void 0,i.nodeManage=void 0,i.nodeMasterShowCar=void 0,i.txtShowTax=void 0,i.btnCollect=void 0,i.btnRename=void 0,i.nodeResParent=void 0,i.nodeResItem=void 0,i.resItems=void 0,i.typeToDec=void 0,i.btnCloseList=void 0,i.btnOpenList=void 0,i.btnRule=void 0,i.nodeBuff=void 0,i.nodeTip=void 0,i.txtTips=void 0,i.bgContent=void 0,i.bgCommon=void 0,i.bgCommonBuilding=void 0,i.crossBtn=void 0,i.crossPlayer=void 0,i.bgNormal=void 0,i.bgNormalBuilding=void 0,i.freeDecTemp=void 0,i.nodeFreeDec=void 0,i.scrollBase=void 0,i.parkName=void 0,i.defModelList=[],i.freeDecList=[],i.refreshCount=0,i.mainTimer=0,i.isLongPressing=!1,i.longPressDuration=.6,i.timer=0,i.longPressTimer=0,i.nodeSubRoot=void 0,i.name="ParkingMainView",i.url="ui/module/parking/ParkingMainView",i.fullScreen=!0,i.mapScene=new F(n(i)),i.poolTime=2e4,i}i(o,e);var g=o.prototype;return g.onInit=function(){var e,i=this,t=this.findChild("top/btnGuide");this.adjustMirrorNode(this.findChild("top/btnGuide"),0,!0),this.addComponentCallbackListener(t,s.EventType.CLICK,(function(){uiMgr.openView("CommonGuideView",1)})),this.scrollBase=this.findChildComponent("scrollMiddleShow",a),this.bgContent=this.findChildComponent("scrollMiddleShow/view/content",r),this.bgContent.node.on(d.SIZE_CHANGED,(function(){0==IS(K).type?(i.bgContent.node.position=new l(-360,1476),i.scrollBase.scrollToTop()):(i.bgContent.node.position=new l(-736,1476),i.scrollBase.scrollToTop())})),this.bgCommon=this.findChild("scrollMiddleShow/view/content/bgcommon"),this.bgNormal=this.findChild("scrollMiddleShow/view/content/bg"),this.bgNormalBuilding=this.findChild("scrollMiddleShow/view/content/buildingRoot"),this.bgCommonBuilding=this.findChild("scrollMiddleShow/view/content/buildingRoot1"),this.crossBtn=this.findChild("nodeCross"),this.crossPlayer=this.findChild("scrollMiddleShow/view/content/buildingRoot1/nodeCross"),this.curOpenView=null,this.nodeBtnClose=this.findChild("bottom/btnClose"),this.nodeSubRoot=this.findChild("container"),this.addComponentCallbackListener(this.nodeBtnClose,s.EventType.CLICK,(function(){uiMgr.close("ParkingLogView"),uiMgr.close("ParkingSpaceView"),uiMgr.close("ParkingShopView"),uiMgr.close("ParkingDecorateView"),i.updatePreviewStatus(2),i.close()})),this.nodeBtnBack=this.findChild("bottom/btnBack"),this.adjustMirrorNode(this.nodeBtnBack,0,!0),this.addComponentCallbackListener(this.nodeBtnBack,s.EventType.CLICK,(function(){IS(A).reqParkingInfo(0,IS(x).GetRoleId())}));var n=this.findChild("bottom/btnReport");this.addComponentCallbackListener(n,s.EventType.CLICK,(function(){if(i.curOpenView){if("ParkingLogView"==i.curOpenView)return void uiMgr.close("ParkingLogView");uiMgr.close(i.curOpenView)}uiMgr.openView("ParkingLogView",0,i.openArgs[0])})),this.addRedPoint("ParkingMainView/btnReport",n,new h(20,25),m.Dot);var o=this.findChild("bottom/btnSkin");this.addComponentCallbackListener(o,s.EventType.CLICK,(function(){if(i.curOpenView){if("ParkingDecorateView"==i.curOpenView)return void uiMgr.close("ParkingDecorateView");uiMgr.close(i.curOpenView)}IS(K).master_id==IS(x).GetRoleId()?uiMgr.openView("ParkingDecorateView"):V.showFlyTip(GetLanguage(201466))})),this.addRedPoint("ParkingMainView/btnDec",o,new h(20,25),m.Dot);var u=this.findChild("bottom/btnShop");this.addComponentCallbackListener(u,s.EventType.CLICK,(function(){if(i.curOpenView){if("ParkingShopView"==i.curOpenView)return void uiMgr.close("ParkingShopView");uiMgr.close(i.curOpenView)}uiMgr.openView("ParkingShopView")}));var f=this.findChild("bottom/btnSpace");this.addComponentCallbackListener(f,s.EventType.CLICK,(function(){if(i.curOpenView){if("ParkingSpaceView"==i.curOpenView)return void uiMgr.close("ParkingSpaceView");uiMgr.close(i.curOpenView)}uiMgr.openView("ParkingSpaceView")}));var v=this.findChild("scrollMiddleShow/view/content/buildingRoot/btnSetting");this.addComponentCallbackListener(v,s.EventType.CLICK,(function(){IS(K).master_id==IS(x).GetRoleId()&&uiMgr.openView("ParkingTaxSettingView")})),this.nodeSettingTax=I.findChild(v,"imgSetting"),this.nodeShowTax=I.findChild(v,"imgTax"),this.txtShowTax=I.findChildComponent(this.nodeShowTax,"num",c),this.txtNoneTax=I.findChild(this.nodeShowTax,"txtNone");var C=this.findChild("scrollMiddleShow/view/content/buildingRoot/btnManage");this.addComponentCallbackListener(C,s.EventType.CLICK,(function(){IS(K).master_id==IS(x).GetRoleId()&&uiMgr.openView("ParkingHorseManageView")})),this.nodeManage=I.findChild(C,"nodeManage"),this.nodeMasterShowCar=I.findChild(C,"nodeCar");var g=this.findChild("scrollMiddleShow/view/content/buildingRoot/door");this.addComponentCallbackListener(g,s.EventType.CLICK,(function(){IS(K).master_id==IS(x).GetRoleId()&&uiMgr.openView("ParkingRenameView")})),this.btnRename=g;var S=this.findChild("top/nodeCollect");this.addComponentCallbackListener(S,s.EventType.CLICK,(function(){var e=IS(K);IS(A).reqParkCollect(1==e.is_collect?0:1,e.master_id),V.showFlyTip(1==e.is_collect?GetLanguage(201331):GetLanguage(201330))})),this.btnCollect=S,this.txtName=this.findChildComponent("scrollMiddleShow/view/content/buildingRoot/door/txtName",c),p.uiMirror&&(this.txtName.node.scale=new l(1,1,1));var T=this.findChildComponent("top/scrollHorse",a);T.node.active=!1,this.scrollCar=this.addUIList(T,Y),this.btnOpenList=this.findChild("top/btnOpen"),this.addComponentCallbackListener(this.btnOpenList,s.EventType.CLICK,(function(){i.btnOpenList.active=!1,i.btnCloseList.active=!0,i.scrollCar.node.active=!0})),this.btnCloseList=this.findChild("top/btnClose"),this.addComponentCallbackListener(this.btnCloseList,s.EventType.CLICK,(function(){i.btnOpenList.active=!0,i.btnCloseList.active=!1,i.scrollCar.node.active=!1})),this.btnRule=this.findChild("top/btnRule"),this.addComponentCallbackListener(this.btnRule,s.EventType.CLICK,(function(){uiMgr.openView("ParkingRuleTips",[201238,2012381,2012382,2012383,2012384])})),this.nodeBuff=this.findChild("top/SpecialBuff"),this.nodeTip=this.findChild("top/tips");var w=this.findChild("top/tips/txt/mask");this.nodeTip.active=!1,this.addComponentCallbackListener(this.nodeBuff,s.EventType.CLICK,(function(){i.nodeTip.active=!i.nodeTip.active})),this.addComponentCallbackListener(w,s.EventType.CLICK,(function(){i.nodeTip.active=!1})),this.txtTips=this.findChildComponent("top/tips/txt",c),this.parkName=this.findChildComponent("scrollMiddleShow/view/content/bgcommon/parkName/Label",c),this.openTypeItems=((e={}).ParkingLogView={normal:I.findChild(n,"normal"),selected:I.findChild(n,"selected")},e.ParkingSpaceView={normal:I.findChild(f,"normal"),selected:I.findChild(f,"selected")},e.ParkingShopView={normal:I.findChild(u,"normal"),selected:I.findChild(u,"selected")},e.ParkingDecorateView={normal:I.findChild(o,"normal"),selected:I.findChild(o,"selected")},e),this.adjustMirrorNode(I.findChild(n,"normal/icon"),0,!0),this.adjustMirrorNode(I.findChild(f,"normal/icon"),0,!0),this.adjustMirrorNode(I.findChild(u,"normal/icon"),0,!0),this.adjustMirrorNode(I.findChild(o,"normal/icon"),0,!0),this.adjustMirrorNode(I.findChild(n,"selected/icon"),0,!0),this.adjustMirrorNode(I.findChild(f,"selected/icon"),0,!0),this.adjustMirrorNode(I.findChild(u,"selected/icon"),0,!0),this.adjustMirrorNode(I.findChild(o,"selected/icon"),0,!0),this.initResShow(),this.initParkingSpots(),this.initDecorate(),this.initCrossShow()},g.initParkingSpots=function(){var e=this;this.posToParkingSpot={};for(var i=function(i){var t=e.findChild(f.formatStr("scrollMiddleShow/view/content/buildingRoot/building%s",i+1));e.posToParkingSpot[i+1]={node:t,nodeTime:I.findChild(t,"upgrade"),txtTime:I.findChildComponent(t,"upgrade/txtTime",c),nodeCar:I.findChild(t,"nodeCar"),nodePlayer:I.findChild(t,"nodePlayer"),nodeHpBar:I.findChildComponent(t,"nodeHp/ProgressBar",v),nodeHp:I.findChild(t,"nodeHp"),imgSelf:I.findChild(t,"upgrade/imgSelf"),spotID:i+1},e.addComponentCallbackListener(t,s.EventType.CLICK,(function(){e.onClickParkingSpot(i+1)}))},t=0;t<4;t++)i(t);for(var n=function(i){var t=e.findChild(f.formatStr("scrollMiddleShow/view/content/buildingRoot1/building%s",i+1));e.posToParkingSpot[i+11]={node:t,nodeTime:I.findChild(t,"upgrade"),txtTime:I.findChildComponent(t,"upgrade/txtTime",c),nodeCar:I.findChild(t,"nodeCar"),nodePlayer:I.findChild(t,"nodePlayer"),nodeHpBar:I.findChildComponent(t,"nodeHp/ProgressBar",v),nodeHp:I.findChild(t,"nodeHp"),imgSelf:I.findChild(t,"upgrade/imgSelf"),spotID:i+11},e.addComponentCallbackListener(t,s.EventType.CLICK,(function(){e.onClickParkingSpot(i+11)}))},o=0;o<10;o++)n(o)},g.initDecorate=function(){this.typeToDec={};var e=[],i=[],t=[],n=[],o=[],s=[],a=[],r=this.findChildComponent("scrollMiddleShow/view/content/bg",u);n.push(r);var d=this.findChildComponent("scrollMiddleShow/view/content/buildingRoot/door",u);e.push(d);for(var l=1;l<3;l++){var h=this.findChildComponent("scrollMiddleShow/view/content/buildingRoot/fance"+l,u);i.push(h)}for(var c=1;c<5;c++){var p=this.findChildComponent("scrollMiddleShow/view/content/buildingRoot/light"+c,u);t.push(p)}for(var v=1;v<5;v++){var C=this.findChildComponent(f.formatStr("scrollMiddleShow/view/content/buildingRoot/building%s/imgBuilding",v),u);o.push(C)}var g=this.findChildComponent("scrollMiddleShow/view/content/buildingRoot/btnManage/icon",u);s.push(g);var m=this.findChildComponent("scrollMiddleShow/view/content/buildingRoot/btnSetting/img",u);a.push(m),this.typeToDec[H.TYPE_DOOR]=e,this.typeToDec[H.TYPE_FANCE]=i,this.typeToDec[H.TYPE_LIGHT]=t,this.typeToDec[H.TYPE_FLOOR]=n,this.typeToDec[H.TYPE_SPOT]=o,this.typeToDec[H.TYPE_STAGE]=s,this.typeToDec[H.TYPE_BOARD]=a,this.freeDecTemp=this.findChild("scrollMiddleShow/view/content/buildingRoot/freeDecTemp"),this.freeDecTemp.active=!1,this.nodeFreeDec=this.findChild("scrollMiddleShow/view/content/buildingRoot")},g.initResShow=function(){var e=this;this.nodeResParent=this.findChild("top/resRoot"),this.nodeResItem=this.findChild("top/resRoot/resItem"),this.nodeResItem.active=!1,this.resItems=new Array;for(var i=function(i){var t=nodeInstantiate.instantiate(e.nodeResItem),n=j[i];e.addComponentCallbackListener(t,s.EventType.CLICK,(function(){IS(M).OpenItemTips(n,I.findChild(t,"txtNum"))})),t.parent=e.nodeResParent,t.active=!0;var o=I.findChildComponent(t,"imgIcon",u),a=configGoods.getDataByKey(n);e.loadIcon(o,"icon_item",a.icon),e.resItems.push({node:t,txtNum:I.findChildComponent(t,"txtNum",c),goodsGtid:n})},t=0;t<j.length;t++)i(t)},g.initCrossShow=function(){var e=this.findChild("nodeCross/btnRob");this.addComponentCallbackListener(e,s.EventType.CLICK,(function(){uiMgr.openView("ParkingCrossRobEnemyInfoView")}));var i=this.findChild("nodeCross/btnBattle");this.addComponentCallbackListener(i,s.EventType.CLICK,(function(){uiMgr.openView("ParkingCrossReportView")}));var t=this.findChild("nodeCross/btnDef");this.addComponentCallbackListener(t,s.EventType.CLICK,(function(){uiMgr.openView("ParkingCrossRobInfoView")}));var n=this.findChild("nodeCross/btnReport");this.addComponentCallbackListener(n,s.EventType.CLICK,(function(){uiMgr.openView("ParkingCrossRecordView")}));for(var o=1;o<11;o++){var a=I.findChild(this.crossPlayer,"Node"+o);this.defModelList.push({ClickNode:I.findChild(a,"nodeClick"),nodePlayer:I.findChild(a,"nodeModel"),nodeHpBar:I.findChildComponent(a,"nodeHp/ProgressBar",v),nodeHp:I.findChild(a,"nodeHp"),nodeCombat:I.findChild(a,"combat"),index:o})}},g.onViewOpen=function(e){for(var i in this.openTypeItems)i==e&&(this.curOpenView=i,this.updateSelect())},g.onViewClose=function(e){null!=this.curOpenView&&e==this.curOpenView&&(this.curOpenView=null,this.updateSelect())},g.updateSelect=function(){for(var e in this.openTypeItems){var i=this.openTypeItems[e];i.normal.active=null==this.curOpenView||e!=this.curOpenView,i.selected.active=this.curOpenView&&e==this.curOpenView}},g.registerUpdateHandler=function(){this.addEvent(P.ViewOpen,this.onViewOpen,this),this.addEvent(P.ViewClose,this.onViewClose,this),this.addEvent(y.GOODS_INFO_UPDATE,this.updateResShow,this),this.addEvent(N.ROLE_RES_UPDATE,this.updateResShow,this),this.addEvent(N.ROLE_RED_POINT_LIST_UPDATE,this.updateRedPoint,this),this.addEvent(N.ROLE_RED_DETAIL_UPDATE,this.onRoleRedDetailUpdate,this),this.addEvent(U.PARKING_CUR_PARKING_INFO_UPDATE,this.updateMainInfo,this),this.addEvent(U.PARKING_CAR_LIST_UPDATE,this.updateCarListInfo,this),this.addEvent(U.PARKING_NAME_ROOT_INFO_CHANGE,this.updateNameRoot,this),this.addEvent(U.PARKING_SKIN_INFO_CHANGE,this.updateDec,this),this.addEvent(U.PARKING_SPOT_INFO_UPDATE,this.updateSpotInfo,this),this.addEvent(U.PARKING_SKIN_PREVIEW_STATUS,this.updatePreviewStatus,this)},g.onAfterOpen=function(){var e,i,t;this.mapScene.open(),this.scrollBase.node.active=!0,this.curOpenView=null,this.updateSelect(),this.updateRedPoint(),this.updateResShow();var n=null!=(e=this.openArgs[0])?e:0,o=null!=(i=this.openArgs[1])?i:IS(x).GetRoleId(),s=null!=(t=this.openArgs[2])?t:0;3==n?(IS(A).reqCrossParkDetail(o),IS(A).reqCarListInfo()):(IS(A).reqParkingInfo(n,o,s),IS(A).reqCarListInfo())},g.onBeforeClose=function(){var e;null==(e=this.mapScene)||e.close()},g.onDestroy=function(){for(var e,i=0;i<this.resItems.length;i++)this.resItems[i].node.destroy();this.resItems={},null==(e=this.mapScene)||e.destroy()},g.onUpdate=function(e){var i;null==(i=this.mapScene)||i.onUpdate(e)},g.updatePreviewStatus=function(e){1==e?(IS(D).setAutoOpen(!1),battleMain.stopChapter(),uiMgr.getView("MainView").visible=!1,this.scrollBase.node.active=!1,this.nodeSubRoot.active=!1,this.findChild("top").active=!1):(this.nodeSubRoot.active=!0,this.findChild("top").active=!0,IS(L).reqEnterChapter(0),battleMain.enterChapter(0,!1,!0),uiMgr.getView("MainView").visible=!0,this.scrollBase.node.active=!0)},g.updateRedPoint=function(){IS(S).changeValue("ParkingMainView/btnReport",IS(x).getRedNumByModule(O.System_Parking,1)+IS(x).getRedNumByModule(O.System_Parking,2))},g.onRoleRedDetailUpdate=function(e){e==O.System_Parking&&this.updateRedPoint()},g.updatedecRP=function(){IS(S).changeValue("ParkingMainView/btnDec",IS(K).checkDecRP())},g.rebaseSpotsInfo=function(){for(var e in this.posToParkingSpot)if(this.posToParkingSpot.hasOwnProperty(e)){var i=this.posToParkingSpot[e];i.nodeCar.removeAllChildren(),i.nodePlayer.removeAllChildren(),i.nodeTime.active=!1,i.nodeHp.active=!1}},g.updateDebuffTime=function(){for(var e,i=IS(K).extInfo,n=0,o=0,s=0,a=t(i);!(e=a()).done;){var r=e.value;2==r.k?n=r.v:3==r.k?o=r.v:4==r.k&&(s=r.v)}if(!configPark_pvp_debuff.getDataByKeys("num",n,"type",3!=IS(K).type?2:4)||0==n&&0==o&&s<=w.serverTime)this.nodeBuff.active=!1;else{var d,l=I.findChildComponent(this.nodeBuff,"nodeTime/txtTime",c);d=s>w.serverTime?w.getTimeLeft(s-w.serverTime):w.getTimeLeft(o-w.serverTime),l.string=d}},g.updateBuffInfo=function(){for(var e,i=IS(K).extInfo,n=0,o=0,s=0,a=t(i);!(e=a()).done;){var r=e.value;2==r.k?n=r.v:3==r.k?o=r.v:4==r.k&&(s=r.v)}var d=configPark_pvp_debuff.getDataByKeys("num",n,"type",3!=IS(K).type?2:4);if(!d||0==n&&0==o&&s<=w.serverTime)this.nodeBuff.active=!1;else{var l=I.findChildComponent(this.nodeBuff,"num",c);this.nodeBuff.active=!0;var h=I.findChildComponent(this.nodeBuff,"imgIcon",u);s>w.serverTime?(this.loadIcon(h,"parking","gg_ui_debuff02"),this.txtTips.string=GetLanguage(201325),l.string=""):(this.loadIcon(h,"parking","gg_ui_debuff"),this.txtTips.string=T.formatStr.apply(T,[d.debuff_desc].concat(d.desc_parm)),l.string=0==n?"":n+""),this.updateDebuffTime()}},g.updateNameRoot=function(){var e=IS(K);if(1==e.type||3==e.type)return this.btnRule.active=!1,void(this.btnCollect.active=!1);this.txtName.string=e.name,this.btnRule.active=!0,this.btnCollect.active=!1,e.master_id!=IS(x).GetRoleId()&&(this.btnCollect.active=!0,this.btnRule.active=!1,I.findChild(this.btnCollect,"sel").active=1==e.is_collect,I.findChild(this.btnCollect,"normal").active=0==e.is_collect)},g.updateSpotInfo=function(e){for(var i,n=t(e);!(i=n()).done;){var o=i.value;if(0!=o.role_id){var s=o.pos;1!=IS(K).type&&3!=IS(K).type||(s=(o.pos-1)%10+11);var a=this.posToParkingSpot[s];this.addUIEffect(configMount.getDataByKey(o.mount_id).path,a.nodeCar,-1);var r=o.figure;r.mount_figure=0,a.nodeTime.active=!0;var d=o.start_time,h=Math.min(Math.max(w.serverTime-d,0),60*R.park_time_limit),c=w.formatTimeForSecond(h);if(a.txtTime.string=c,a.imgSelf.active=!1,o.role_id==IS(x).GetRoleId()&&(a.imgSelf.active=!0),3!=IS(K).type){for(var p=r.skin_list||[],u=0,f=0;f<p.length;f++)2==p[f].k&&(u=p[f].v);var v=1,g=r.gender||1,m=IS(x).GetTypeUsedSkin(0),S=_.getModelId(m,u,g),I=configUnitModel.getDataByKey(S);I&&I.skin_scale>0&&(v=.66*I.skin_scale);var T=IS(E).AddRoleModel(this,r,a.nodePlayer,C.ZERO,v);a.nodeHp.active=!0;var P=this.getUnitModel(T).modelHeight;a.nodeHpBar.node.position=new l(0,P+30);for(var b,k=o.ext,y=0,M=1,L=t(k);!(b=L()).done;){var V=b.value;1==V.k?y=V.v:2==V.k&&(M=V.v)}a.nodeHpBar.progress=y/M}}}},g.updateTime=function(){for(var e,i=IS(K),n=t(i.space_list);!(e=n()).done;){var o=e.value,s=o.pos;1!=IS(K).type&&3!=IS(K).type||(s=(o.pos-1)%10+11);var a=this.posToParkingSpot[s];if(a){var r=o.start_time,d=Math.min(Math.max(w.serverTime-r,0),60*R.park_time_limit),l=w.formatTimeForSecond(d);a.txtTime.string=l,a.nodeTime.active=!0}}this.updateDebuffTime(),this.updateCrossParkShow()},g.updateCrossParkShow=function(){3==IS(K).type?(this.refreshCount+=1,this.refreshCount>30&&(this.refreshCount=0,IS(A).reqCrossParkDetail(IS(K).master_id))):this.refreshCount=0},g.updateMainInfo=function(){var e=this,i=IS(K);i&&(i.is_focus=!1,this.txtName.string=i.name,i.master_id==IS(x).GetRoleId()?(this.nodeBtnClose.active=!0,this.nodeBtnBack.active=!1,this.nodeSettingTax.active=!0,this.nodeShowTax.active=!1,this.nodeManage.active=!0):(this.nodeBtnClose.active=!1,this.nodeBtnBack.active=!0,this.nodeSettingTax.active=!1,this.nodeShowTax.active=!0,1==i.protect.is_open?(this.txtShowTax.node.active=!0,this.txtShowTax.string=i.protect.protect_ratio+"%",this.txtNoneTax.active=!1):(this.txtShowTax.node.active=!1,this.txtNoneTax.active=!0),this.nodeManage.active=!1),this.rebaseSpotsInfo(),this.updateDec(),this.updateShowCar(),this.updateCarListInfo(),this.updateNameRoot(),this.updateBuffInfo(),this.updateSpotInfo(i.space_list),this.mainTimer&&this.removeTimer(this.mainTimer),this.mainTimer=this.addTimer(1,-1,(function(){e.updateTime()})))},g.updateShowCar=function(){var e=IS(K);this.nodeMasterShowCar.removeAllChildren(),0!=e.show_car&&this.addUIEffect(configMount.getDataByKey(e.show_car).path,this.nodeMasterShowCar,-1)},g.onClickParkingSpot=function(e){var i=!0,n=!1;if(IS(K).space_list){for(var o,s=t(IS(K).space_list);!(o=s()).done;){var a=o.value;a.role_id==IS(x).GetRoleId()&&(n=!0);var r=a.pos;if(1!=IS(K).type&&3!=IS(K).type||(r=(a.pos-1)%R.park_public_each_num+11),e==r)return i=!1,a.role_id==IS(x).GetRoleId()?void uiMgr.openView("ParkingGainView",a.mount_id):void uiMgr.openView("ParkingRobView",a.pos,IS(K).type,IS(K).master_id)}if(!n)for(var d in IS(K).car_list){IS(K).car_list[d].parking_data.master_id==IS(K).master_id&&(n=!0)}if(i){if(n)return void V.showFlyTip(GetLanguage(201166));if(IS(K).serv_id!=IS(x).GetServerId())return void V.showFlyTip(GetLanguage(201968));uiMgr.openView("ParkingHorseParkManageView",e)}}},g.updateCarListInfo=function(){var e=IS(K).getParkingCarList();this.scrollCar.datas=e,e.length>0?(this.btnCloseList.active=!0,this.btnOpenList.active=!1,this.scrollCar.node.active=!0):(this.btnCloseList.active=!1,this.btnOpenList.active=!0,this.scrollCar.node.active=!1)},g.updateResShow=function(){for(var e=0;e<this.resItems.length;e++)this.resItems[e].txtNum.string=T.GetNumString(IS(M).getGoodsCountByGoodsGtid(this.resItems[e].goodsGtid));this.updatedecRP()},g.updateDec=function(){if(this.crossBtn.active=!1,this.crossPlayer.active=!1,0==IS(K).type){this.bgContent.width=720,this.bgCommon.active=!1,this.bgCommonBuilding.active=!1,this.bgNormal.active=!0,this.bgNormalBuilding.active=!0,this.bgContent.node.position=new l(-360,1476);var e=IS(K).getDecUsingInfo(),i="",n=[],o="";for(var s in e){var a=this.typeToDec[s],r=configParking_design.getDataByKey(e[s]);if(r){r.position==H.TYPE_FLOOR&&(i=r.admin_path,n=r.park_pos,o=r.park_stage);for(var d,h=t(a);!(d=h()).done;){var c=d.value;this.loadIcon(c,"parking_dec",r.path,null,k.ICON_SPRITE)}}}for(var p,f=t(this.typeToDec[H.TYPE_SPOT].entries());!(p=f()).done;){var v=p.value,C=v[0],g=v[1];this.loadIcon(g,"parking_dec",n[C],null,k.ICON_SPRITE)}for(var m,S=t(this.typeToDec[H.TYPE_STAGE]);!(m=S()).done;){var I=m.value;this.loadIcon(I,"parking_dec",o,null,k.ICON_SPRITE)}for(var w,P=t(this.typeToDec[H.TYPE_BOARD]);!(w=P()).done;){var b=w.value;this.loadIcon(b,"parking_dec",i,null,k.ICON_SPRITE)}for(var _,y=t(this.freeDecList);!(_=y()).done;){var M=_.value;this.nodeFreeDec.removeChild(M)}for(var L,E=t(IS(K).getUsingFreeDec());!(L=E()).done;){var V=L.value,D=nodeInstantiate.instantiate(this.freeDecTemp);D.active=!0;var B=configParking_design.getDataByKey(V.skin_id);this.loadIcon(D.getComponent(u),"parking_dec",B.path,null,k.ICON_SPRITE),D.scale=new l(B.scaling,B.scaling,B.scaling),D.setParent(this.nodeFreeDec),D.position=new l(V.x,V.y),this.freeDecList.push(D),IS(K).master_id==IS(x).GetRoleId()&&this.onLoad(D,V.skin_id)}var N=[];this.nodeFreeDec.children.forEach((function(e,i,t){N.push(e)})),N.sort((function(e,i){return i.position.y-e.position.y}));for(var O,G=t(N.entries());!(O=G()).done;){var A=O.value,U=A[0];A[1].setSiblingIndex(U)}}else{if(this.bgContent.width=1472,this.bgCommon.active=!0,this.bgCommonBuilding.active=!0,this.bgNormal.active=!1,this.bgNormalBuilding.active=!1,this.parkName.string="[s"+IS(K).serv_id+"]"+T.formatStrWithMirrorDeal(GetLanguage(201468),IS(K).ceng),3==IS(K).type){var F=IS(K).master_id%100;this.parkName.string="[s"+IS(K).serv_id+"]"+T.formatStrWithMirrorDeal(GetLanguage(201712),F),this.crossBtn.active=!0,this.crossPlayer.active=!0,this.updateDefPlayer()}var j=new l(-736,1476);if(IS(K).is_focus){IS(K).is_focus=!1;for(var Y,q=0,W=t(IS(K).space_list);!(Y=W()).done;){var Z=Y.value;Z.role_id==IS(x).GetRoleId()&&(q=Z.pos)}(q-=(IS(K).ceng-1)*R.park_public_each_num)<4?j=new l(-360,1476):q>7&&(j=new l(-1112,1476))}this.bgContent.node.position=j}},g.onLoad=function(e,i){var t=this;this.addComponentCallbackListener(e,d.TOUCH_START,(function(){t.onTouchStart(i)})),this.addComponentCallbackListener(e,d.TOUCH_END,(function(){t.onTouchEnd()})),this.addComponentCallbackListener(e,d.TOUCH_CANCEL,(function(){t.onTouchCancel()}))},g.onTouchStart=function(e){var i=this;this.isLongPressing=!0,this.timer=0;this.longPressTimer=this.addTimer(.1,11,(function(){i.checkLongPress(.1,e)}))},g.onTouchEnd=function(){this.isLongPressing=!1,this.longPressTimer&&this.removeTimer(this.longPressTimer)},g.onTouchCancel=function(){this.isLongPressing=!1,this.longPressTimer&&this.removeTimer(this.longPressTimer)},g.checkLongPress=function(e,i){this.isLongPressing&&(this.timer+=e,this.timer>=this.longPressDuration&&(normalEvent.emit(U.PARKING_SKIN_PREVIEW_STATUS,1),normalEvent.emit(U.PARKING_SKIN_PREVIEW_ENTER_ITEM,i),this.longPressTimer&&this.removeTimer(this.longPressTimer)))},g.updateDefPlayer=function(){for(var e,i=this,n=IS(K).defPlayerInfo,o=function(){var o=e.value,a=o[0],r=o[1];if(r.nodePlayer.removeAllChildren(),n.length>a){for(var d,l=0,h=t(n[a].ext);!(d=h()).done;){var c=d.value;1==c.k&&(l=c.v)}var p=n[a].figure;p.mount_figure=0;var u=IS(E).createRoleModel(p,r.nodePlayer);r.nodeHp.active=!0,r.nodeHpBar.progress=(l/1e4).toFixed(2);var f=u.modelHeight;r.nodeHp.setPosition(0,f+50),r.nodeCombat.active=1==n[a].status,i.addComponentCallbackListener(r.ClickNode,s.EventType.CLICK,(function(){for(var e,i,o,s=null!=(e=null==(i=n[a].info_list)?void 0:i.kv)?e:{},r=0,d=t(s);!(o=d()).done;){var l=o.value;l.k==G.ROLE_ATTR_ID&&(r=l.v)}0!=r&&IS(B).reqOtherRoleNotice(r)}))}else r.nodeHp.active=!1,r.nodeCombat.active=!1},a=t(this.defModelList.entries());!(e=a()).done;)o()},o}(b)),function(e){function n(){for(var i,t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return(i=e.call.apply(e,[this].concat(n))||this).txtTime=void 0,i.imgIcon=void 0,i.pbHP=void 0,i.txtHP=void 0,i.txtLimit=void 0,i.parkTimer=void 0,i.nodeCross=void 0,i}i(n,e);var o=n.prototype;return o.onInit=function(){var e=this;this.txtTime=I.findChildComponent(this.node,"txtTime",c),this.imgIcon=I.findChildComponent(this.node,"Icon",u),this.pbHP=I.findChildComponent(this.node,"ProgressBar",v),this.txtHP=I.findChildComponent(this.node,"ProgressBar/txtHp",c),this.txtLimit=I.findChild(this.node,"txtLimit"),this.view.addComponentCallbackListener(this.node,s.EventType.CLICK,(function(){uiMgr.openView("ParkingGainView",e.data.mount_id)})),this.nodeCross=I.findChild(this.node,"nodeCorss")},o.onRender=function(e,i){var n=this,o=IS(K).car_list[e];this.data=o;var s=configMount.getDataByKey(o.mount_id).icon_small;this.view.loadIcon(this.imgIcon,"icon_item",s);for(var a,r=o.parking_data.ext,d=0,l=1,h=t(r);!(a=h()).done;){var c=a.value;1==c.k?d=c.v:2==c.k&&(l=c.v)}this.pbHP.progress=d/l,this.txtHP.string=(d/l*100).toFixed(2)+"%",this.parkTimer&&this.view.removeTimer(this.parkTimer),this.updateTime(),this.parkTimer=this.view.addTimer(1,-1,(function(){n.updateTime()}));var p=o.parking_data.type;this.nodeCross.active=3==p},o.updateTime=function(){var e=this.data.parking_data.start_time,i=Math.min(Math.max(w.serverTime-e,0),60*R.park_time_limit),t=w.formatTimeForSecond(i);if(i>=60*R.park_time_limit)return this.txtLimit.active=!0,this.txtTime.node.active=!1,void this.view.removeTimer(this.parkTimer);this.txtLimit.active=!1,this.txtTime.node.active=!0,this.txtTime.string=t},n}(g));o._RF.pop()}}}));

