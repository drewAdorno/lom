System.register("chunks:///_virtual/EquipDataCache.ts",["cc","./RedPointMgr.ts","./StorageUtil.ts","./ConfigGlobal.ts","./ObjectUtil.ts","./BagModel.ts","./GuideModel.ts","./LoginDefine.ts","./RoleDataCache.ts","./RoleDefine.ts","./NativeToJs.ts","./EquipDefine.ts","./EquipModel.ts"],(function(t){"use strict";var e,i,o,n,a,u,r,s,l,f,c,g,h,p,d,v,E,I;return{setters:[function(t){e=t.cclegacy,i=t.js},function(t){o=t.RedPointMgr},function(t){n=t.default},function(t){a=t.ConfigGlobal},function(t){u=t.default},function(t){r=t.BagModel},function(t){s=t.GuideModel},function(t){l=t.LoginEventDefine},function(t){f=t.RoleDataCache},function(t){c=t.RoleEventDefine,g=t.PlayerAttr},function(t){h=t.NativeToJs},function(t){p=t.EquipChangeType,d=t.EquipQuality,v=t.EquipEventDefine},function(t){E=t.EquipModel,I=t.locationToCanFigure}],execute:function(){e._RF.push({},"08fbeZ98zdLXJNeZx8liICz","EquipDataCache",void 0);var S=a.equip_skin,R=[1,2,3,4,5,6,7,8,9,10];t("EquipDataCache",function(){var t=e.prototype;function e(){this.equipList=void 0,this.boxInfo=void 0,this.openCondition=void 0,this.hasLoadInfo=void 0,this.locationToFigure=void 0,this.equipCidToGot=void 0,this.autoStopByGetTicket=void 0,this.selectAutoMultiNum=void 0,this.tabInfo={tab:1,unlock_list:[{k:1,s:""}]},this.curSkin=1,this.equipList=[],this.boxInfo={lv:1,exp:0,etime:0},this.locationToFigure={},this.equipCidToGot={},this.hasLoadInfo=!1,normalEvent.on(c.ROLE_RES_UPDATE,this.onRoleResUpdate,this),normalEvent.on(l.RECONNECT_NET_LINK,this.onReConnectNetLink,this)}return t.clear=function(){normalEvent.off(c.ROLE_RES_UPDATE,this.onRoleResUpdate,this),normalEvent.off(l.RECONNECT_NET_LINK,this.onReConnectNetLink,this)},t.onReConnectNetLink=function(){IS(E).tryReStartAutoOpen()},t.onRoleResUpdate=function(t){t==g.ROLE_ATTR_GOLD&&this.updateBoxProgressRedPoint()},t.updateEquipList=function(t,e,i){for(var o,a,u={},r=0;r<e.length;r++)if(o=e[r].equip_id,t!=p.ADD)u[o]=e[r];else{a=e[r].config_id;var s=configEquipment.getDataByKey(a);if(null==s){console.error("错误 装备id "+a+" 找不到配置");continue}if(I[s.part]&&IS(E).trySetEquipRemindIcon(s.icon,s.unlock_level),s.quality>d.GOLD){var l,c="GameEvaluatePop"+IS(f).GetRoleId();"1"!=(null!=(l=n.get(c))?l:"")&&(printLogErr("调出评价"),h.storePraiseGuide(),n.set(c,1))}this.equipList.push(e[r]),normalEvent.emit(v.EQUIP_ADD,o,i)}if(t!=p.ADD){for(var g={},m={},P=0;P<S.length;P++)g[S[P]]=IS(E).getEquipByLocation(S[P]);for(var _=0;_<R.length;_++)m[R[_]]=IS(E).getEquipByLocation(R[_]);for(var T=this.equipList.length-1;T>=0;T--)null!=u[o=this.equipList[T].equip_id]&&(t!=p.UPDATE?(this.equipList.splice(T,1),normalEvent.emit(v.EQUIP_REMOVE,o)):(this.equipList[T]=u[o],normalEvent.emit(v.EQUIP_INFO_UPDATE,o)));for(var D=!1,x=0;x<S.length;x++){var y=IS(E).getEquipByLocation(S[x]),B=g[S[x]];null==y&&null==B||(y&&B&&y.config_id==B.config_id||(D=!0))}var L=IS(E).getEmptyEquipIdList(!1,0);for(var q in m){if(null==m[q]&&null!=IS(E).getEquipByLocation(Number(q))&&L.length<=0){IS(E).tryReStartAutoOpen(!0);break}}D&&normalEvent.emit(v.EQUIP_SKIN_UPDATE),normalEvent.emit(v.EQUIP_LIST_UPDATE,t,i)}else normalEvent.emit(v.EQUIP_LIST_UPDATE,t,i)},t.getRoleSaveStr=function(t){return i.formatStr("%s_%s",t,IS(f).GetRoleId())},t.saveLocalOpenConditionData=function(){n.set(this.getRoleSaveStr("autoOpenCondition"),JSON.stringify(this.openCondition))},t.loadLocalOpenConditionData=function(){var t=n.get(this.getRoleSaveStr("autoOpenCondition"));return!(!t||""==t)&&(this.openCondition=t,!0)},t.saveLocalStopByTicketData=function(){n.set(this.getRoleSaveStr("autoStopByTicket"),String(this.autoStopByGetTicket))},t.loadLocalStopByTicketData=function(){var t=n.get(this.getRoleSaveStr("autoStopByTicket"));return null!=t&&(("string"!=typeof t||""!=t)&&(this.autoStopByGetTicket=t,!0))},t.saveLocalSelectAutoMultiNum=function(){n.set(this.getRoleSaveStr("selectAutoMultiNum"),String(this.selectAutoMultiNum))},t.loadLocalSelectAutoMultiNum=function(){var t=n.get(this.getRoleSaveStr("selectAutoMultiNum"));return!(!t||""==t)&&(this.selectAutoMultiNum=Number(t),!0)},t.setEquipGot=function(t,e){if(null!=t){for(var i=!1,o=0;o<t.length;o++){var n=t[o];if(!u.isEmpty(configEquipment.getDataByKey(n))){var a=configEquipment.getDataByKey(n);i||(i=2==a.part),this.equipCidToGot[n]=!0}}1!=e&&normalEvent.emit(v.EQUIP_GOT_UPDATE,i)}},t.initEquipFigure=function(t){if(null!=t)for(var e=0;e<t.length;e++){var i=t[e];this.locationToFigure[i.k]=i.v}},t.updateFigure=function(t){u.isEmpty(t)||(this.locationToFigure[t.k]=t.v,normalEvent.emit(v.EQUIP_FIGURE_UPDATE,t.k),normalEvent.emit(v.EQUIP_SKIN_UPDATE))},t.updateBoxProgressRedPoint=function(){var t=this.getBoxUpgradeRedPoint();IS(o).changeValue("btnBox/btnBuy",this.getBoxProgressRedPoint()),IS(o).changeValue("btnBox",t+this.getBoxProgressRedPoint()),t+this.getBoxProgressRedPoint()>0&&1==this.boxInfo.lv&&IS(s).openGuide(50003)},t.getBoxProgressRedPoint=function(){if(!this.boxInfo)return 0;if(this.boxInfo.etime&&0!=this.boxInfo.etime)return 0;var t=this.boxInfo.lv;if(t>=configTreasure_level.getDatas().length)return 0;var e=configTreasure_level.getDataByKey(t).expend;if(this.boxInfo.exp>=e.length)return 0;var i=e[this.boxInfo.exp];return IS(r).getGoodsCountByGoodsGtid(i[0])>=i[1]?1:0},t.updateBoxUpgradeRedPoint=function(){var t=this.getBoxUpgradeRedPoint();IS(o).changeValue("btnBox/btnUpgrade",t),IS(o).changeValue("btnBox",t+this.getBoxProgressRedPoint()),t+this.getBoxProgressRedPoint()>0&&1==this.boxInfo.lv&&IS(s).openGuide(50003)},t.getBoxUpgradeRedPoint=function(){if(!this.boxInfo)return 0;if(this.boxInfo.etime&&0!=this.boxInfo.etime)return 0;var t=this.boxInfo.lv;if(t>=configTreasure_level.getDatas().length)return 0;var e=configTreasure_level.getDataByKey(t).expend;return this.boxInfo.exp>=e.length?1:0},t.updateTabInfo=function(t){this.tabInfo=t,normalEvent.emit(v.EQUIP_TAB_INFO_UPDATE),normalEvent.emit(v.EQUIP_SKIN_UPDATE)},e}());e._RF.pop()}}}));

