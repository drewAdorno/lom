System.register("chunks:///_virtual/FateMainView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIList.ts","./NodeUtil.ts","./index57.ts","./ItemIcon.ts","./ConfigGlobal.ts","./BagModel.ts","./CommonModel.ts","./MessageView.ts","./FateControl.ts","./FateDataCache.ts","./FateDefine.ts","./BaseSubView.ts"],(function(i){"use strict";var e,t,n,o,a,s,d,r,h,c,l,f,v,u,g,C,I,m,p;return{setters:[function(i){e=i.inheritsLoose,t=i.createForOfIteratorHelperLoose},function(i){n=i.cclegacy,o=i.Button,a=i.Sprite,s=i.Label,d=i.ScrollView},function(i){r=i.ListItem},function(i){h=i.default},null,function(i){c=i.IconAseetType},function(i){l=i.ConfigGlobal},function(i){f=i.BagModel},function(i){v=i.CommonModel},function(i){u=i.default},function(i){g=i.default},function(i){C=i.default},function(i){I=i.FateEventDefine,m=i.FateDefine},function(i){p=i.BaseSubView}],execute:function(){n._RF.push({},"dfc99woendNLZ5J2l1cua6Y","FateMainView",void 0);i("default",function(i){function n(){var e;return(e=i.call(this)||this).nodeBag=void 0,e.txtTtile=void 0,e.fateScroll=void 0,e.fateList=[],e.nodeWearMask=void 0,e.nothing=void 0,e.curChooseUid=void 0,e.tabScroll=void 0,e.curOpenId=0,e.name="FateMainView",e.url="ui/module/fate/FateMainView",e}e(n,i);var r=n.prototype;return r.onInit=function(){var i=this,e=this.findChild("view/root/btnGuide");this.addComponentCallbackListener(e,o.EventType.CLICK,(function(){uiMgr.openView("CommonGuideView",3)})),this.loadIcon(e.getComponent(a),"common","ggcw_icon_zhiyin01");var t=this.findChild("view/root/btnPre");this.addComponentCallbackListener(t,o.EventType.CLICK,(function(){uiMgr.openView("FatePreView")}));var n=this.findChild("view/root/btnAttr");this.addComponentCallbackListener(n,o.EventType.CLICK,(function(){uiMgr.openView("FateAttrView")}));var r=this.findChild("view/root/btnUse");this.addComponentCallbackListener(r,o.EventType.CLICK,(function(){uiMgr.openView("FateUseView")})),this.nodeWearMask=this.findChild("view/root/btnWearMask"),this.addComponentCallbackListener(this.nodeWearMask,o.EventType.CLICK,(function(){i.SelectWear(0)}));for(var h=1;h<=8;h++){var c=new w;c.init(this.findChild("view/root/fateList/item"+h),this,h),this.fateList.push(c)}this.nodeBag=this.findChild("view/root/bag"),this.txtTtile=this.findChildComponent("view/root/bag/title/Label",s);var l=this.findChild("view/root/bag/btn");this.addComponentCallbackListener(l,o.EventType.CLICK,(function(){i.tabScroll.node.active=!0,i.nodeBag.active=!1})),this.nothing=this.findChild("view/root/bag/nothing");var f=this.findChildComponent("view/root/bag/fateScroll",d);this.fateScroll=this.addUIList(f,y);var v=this.findChildComponent("view/root/tabScroll",d);this.tabScroll=this.addUIList(v,S)},r.registerUpdateHandler=function(){this.addEvent(I.OnFateInfoUpdate,this.updateInfo,this),this.addEvent(I.FateSelectWear,this.SelectWear,this)},r.onAfterOpen=function(){IS(v).checkCommonGuideView(3),this.tabScroll.datas=configFate_fusion.getDatas(),this.tabScroll.node.active=!0,this.nodeBag.active=!1,this.tabScroll.scrollTo(0,0),this.curChooseUid=0,this.nodeWearMask.active=!1;for(var i,e=t(this.fateList);!(i=e()).done;){i.value.show()}},r.onBeforeClose=function(){this.curOpenId=0},r.onDestroy=function(){},r.updateInfo=function(){for(var i,e=t(this.fateList);!(i=e()).done;){i.value.show()}this.updateBag(),this.tabScroll.updateAll()},r.SelectWear=function(i){this.curChooseUid=i,this.nodeWearMask.active=0!=i||!1},r.openBag=function(i){this.curOpenId=i,this.tabScroll.node.active=!1,this.nodeBag.active=!0;var e=configFate.getDataByKey(configFate_fusion.getDataByKey(i).get_fate_id);this.txtTtile.string=e.name,this.updateBag()},r.updateBag=function(){for(var i,e=IS(C).GetFateList(),n=[],o=[],a=configGoods.getDatas(),s=t(a);!(i=s()).done;){var d=i.value;if(20==d.type){var r=IS(f).getGoodsCountByGoodsGtid(d.id);if(r>0)for(var h=0;h<r;h++)o.push(d)}}if(0!=this.curOpenId){var c=configFate_fusion.getDataByKey(this.curOpenId);for(var l in e)e.hasOwnProperty(l)&&c.same_kind.includes(e[l].cfg_id)&&n.push(e[l])}n.sort((function(i,e){return i.cfg.quality!=e.cfg.quality?e.cfg.quality-i.cfg.quality:i.lv!=e.lv?e.lv-i.lv:i.cfg_id-e.cfg_id})),n=o.concat(n),this.fateScroll.datas=n,this.nothing.active=0==n.length},n}(p));var w=function(){function i(){this.view=void 0,this.node=void 0,this.index=void 0,this.nodeWear=void 0,this.imgBg=void 0,this.imgIcon=void 0,this.txtLevel=void 0,this.nodeLock=void 0,this.btnWear=void 0,this.nodeRed=void 0}var e=i.prototype;return e.init=function(i,e,t){this.view=e,this.node=i,this.index=t,this.onInit()},e.onInit=function(){var i=this;this.imgBg=h.findChildComponent(this.node,"imgBg",a),this.nodeLock=h.findChild(this.node,"imgLock"),this.btnWear=h.findChild(this.node,"btnWear"),this.nodeWear=h.findChild(this.node,"nodeWear"),this.nodeRed=h.findChild(this.node,"red"),this.imgIcon=h.findChildComponent(this.node,"nodeWear/imgIcon",a),this.txtLevel=h.findChildComponent(this.node,"nodeWear/txtLevel",s),this.view.addComponentCallbackListener(this.node,o.EventType.CLICK,(function(){if(i.nodeLock.active){var e=l.fate_pos;u.showFlyTip(StringUtil.formatStrWithMirrorDeal(GetLanguage(200287),e[i.index-1]))}else if(i.btnWear.active){var n,o=IS(C).GetFateList();for(var a in o)if(o.hasOwnProperty(a)){var s=o[a];IS(C).GetWearPos(s.id)||IS(C).CheckSameUseType(s.id)||(n||(n=s),(s.cfg.quality>n.cfg.quality||s.cfg.quality==n.cfg.quality&&s.cfg_id<n.cfg_id)&&(n=s))}if(n)for(var d,r=configFate_fusion.getDatas(),h=t(r);!(d=h()).done;){var c=d.value;if(c.same_kind.includes(n.cfg_id)){i.view.openBag(c.id);break}}}else{if(0!=i.view.curChooseUid){var f=IS(C).CheckSameUseType(i.view.curChooseUid);return f?(IS(g).send_35_2(0,f,i.view.curChooseUid),void i.view.SelectWear(0)):(IS(g).send_35_2(0,i.index,i.view.curChooseUid),void i.view.SelectWear(0))}if(i.nodeWear.active){var v=IS(C).GetPosInfoByPos(i.index),I=IS(C).GetFateItem(v.id);uiMgr.openView("FateInfoView",I)}}}))},e.show=function(){var i,e=IS(C).GetPosInfoByPos(this.index),t=null!=(i=null==e?void 0:e.state)?i:m.PosState.lock;if(t==m.PosState.lock)this.nodeLock.active=!0,this.nodeWear.active=!1,this.btnWear.active=!1,this.nodeRed.active=!1,this.view.loadIcon(this.imgBg,"fate","mg_ui_hui");else if(t==m.PosState.empty){this.nodeLock.active=!1,this.nodeWear.active=!1,this.btnWear.active=!0,this.view.loadIcon(this.imgBg,"fate","mg_ui_pinzhidi");var n=IS(C).GetFateList();for(var o in this.nodeRed.active=!1,n)if(n.hasOwnProperty(o)){var a=n[o];if(!IS(C).GetWearPos(a.id)&&!IS(C).CheckSameUseType(a.id)){this.nodeRed.active=!0;break}}}else if(t==m.PosState.Equipped){this.nodeLock.active=!1,this.nodeWear.active=!0,this.btnWear.active=!1,this.nodeRed.active=!1;var s=IS(C).GetFateItem(e.id);s&&(this.txtLevel.string="lv."+s.lv,this.view.loadIcon(this.imgBg,"fate",l.fate_quality_pos[s.cfg.quality-1][1]),this.view.loadIcon(this.imgIcon,"icon_fate",s.cfg.icon,null,c.ICON_SPRITE))}},i}(),y=function(i){function t(){for(var e,t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return(e=i.call.apply(i,[this].concat(n))||this).imgIcon=void 0,e.txtLevel=void 0,e.nodeHasWear=void 0,e.redNode=void 0,e.new=void 0,e}e(t,i);var n=t.prototype;return n.onInit=function(){var i=this;this.imgIcon=h.findChildComponent(this.node,"imgIcon",a),this.txtLevel=h.findChildComponent(this.node,"txtLevel",s),this.nodeHasWear=h.findChild(this.node,"imgHasWear"),this.new=h.findChild(this.node,"new"),this.view.loadIcon(this.new.getComponent(a),"fate","mg_ui_new"),this.redNode=h.findChild(this.node,"red"),this.redNode.active=!1,this.view.addComponentCallbackListener(this.node,o.EventType.CLICK,(function(){i.data.cfg?(uiMgr.openView("FateInfoView",i.data),i.new.active&&IS(g).send_35_15(i.data.id)):uiMgr.openView("FateChooseView",i.data.id)}))},n.onRender=function(i,e){if(i.cfg){this.txtLevel.node.active=!0,this.txtLevel.string="lv."+i.lv,this.view.loadIcon(this.imgIcon,"icon_fate",i.cfg.icon,null,c.ICON_SPRITE),this.new.active=i.is_red,this.nodeHasWear.active=!1;var t=IS(C).GetPosInfo();for(var n in t){if(t.hasOwnProperty(n))if(t[n].id==i.id){this.nodeHasWear.active=!0;break}}}else this.txtLevel.node.active=!1,this.nodeHasWear.active=!1,this.new.active=!1,this.view.loadIcon(this.imgIcon,i.icon_group,i.icon)},t}(r),S=function(i){function t(){for(var e,t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return(e=i.call.apply(i,[this].concat(n))||this).txtName=void 0,e.imgIcon1=void 0,e.imgIcon2=void 0,e.imgIcon3=void 0,e.redNode=void 0,e.hasWear1=void 0,e.hasWear2=void 0,e.hasWear3=void 0,e}e(t,i);var n=t.prototype;return n.onInit=function(){var i=this;this.redNode=h.findChild(this.node,"red"),this.redNode.active=!1,this.txtName=h.findChildComponent(this.node,"txtName",s),this.imgIcon1=h.findChildComponent(this.node,"imgIcon1",a),this.imgIcon2=h.findChildComponent(this.node,"imgIcon2",a),this.imgIcon3=h.findChildComponent(this.node,"imgIcon3",a),this.hasWear1=h.findChild(this.node,"imgIcon1/imgHasWear"),this.hasWear1.active=!1,this.hasWear2=h.findChild(this.node,"imgIcon2/imgHasWear"),this.hasWear3=h.findChild(this.node,"imgIcon3/imgHasWear"),this.view.addComponentCallbackListener(this.node,o.EventType.CLICK,(function(){i.view.openBag(i.data.id)}))},n.onRender=function(i,e){var t=configFate.getDataByKey(i.get_fate_id);this.txtName.string=t.name,this.view.loadIcon(this.imgIcon1,"icon_fate",t.icon,null,c.ICON_SPRITE);var n=configFate.getDataByKey(i.material_fate_id[0][0]);this.view.loadIcon(this.imgIcon2,"icon_fate",n.icon,null,c.ICON_SPRITE);var o=configFate.getDataByKey(i.material_fate_id[0][1]);this.view.loadIcon(this.imgIcon3,"icon_fate",o.icon,null,c.ICON_SPRITE),this.hasWear1.active=IS(C).CheckSameUseByCfgId(i.get_fate_id),this.hasWear2.active=null!=IS(C).CheckSameUseTypeByCfgId(i.material_fate_id[0][0]),this.hasWear3.active=null!=IS(C).CheckSameUseTypeByCfgId(i.material_fate_id[0][1]),this.redNode.active=!1;var a=IS(C).GetFateList();for(var s in a)if(a.hasOwnProperty(s)&&i.same_kind.includes(a[s].cfg_id)&&a[s].is_red){this.redNode.active=!0;break}},t}(r);n._RF.pop()}}}));

