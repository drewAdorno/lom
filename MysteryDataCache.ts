System.register("chunks:///_virtual/MysteryDataCache.ts",["cc","./RedPointMgr.ts","./index57.ts","./ConfigGlobal.ts","./BagDefine.ts","./BagModel.ts","./CommonDefine.ts","./RoleDataCache.ts","./RoleDefine.ts","./MysteryDefine.ts","./UIDefine.ts"],(function(e){"use strict";var t,i,n,o,a,s,r,c,d,h,f,u,l;return{setters:[function(e){t=e.cclegacy,i=e.js},function(e){n=e.RedPointMgr},null,function(e){o=e.ConfigGlobal},function(e){a=e.BagEventDefine},function(e){s=e.BagModel},function(e){r=e.CommonEventDefine},function(e){c=e.RoleDataCache},function(e){d=e.RoleEventDefine},function(e){h=e.mine_row_count,f=e.MysteryEventDefine},function(e){u=e.OpenFunction,l=e.PanelTabType}],execute:function(){t._RF.push({},"88959LnumpJjpQYXs+LnZsP","MysteryDataCache",void 0);var I=o.mine_grid_background||[];e("MysteryDataCache",function(){var e=t.prototype;function t(){this.maxAxeNum=void 0,this.nextRecoverTime=void 0,this.curArea=void 0,this.baseLine=void 0,this.blockIdToActive=void 0,this.areaIdToMineCfgId=void 0,this.blockIdToUpdateInfo=void 0,this.blockCfgIdToSpeBg=void 0,this.lastReqTime=0,this.maxAxeNum=0,this.nextRecoverTime=0,this.curArea=0,this.baseLine=0,this.blockIdToActive={},this.areaIdToMineCfgId={},this.blockIdToUpdateInfo={},this.blockCfgIdToSpeBg={};for(var e=0;e<I.length;e++)this.blockCfgIdToSpeBg[I[e][0]]=I[e][1];normalEvent.on(a.GOODS_INFO_UPDATE,this.onGoodsInfoUpdate,this),normalEvent.on(d.ROLE_OPEN_FUNCTION_UPDATE,this.onRoleOpenFunctionUpdate,this)}return e.clear=function(){normalEvent.off(a.GOODS_INFO_UPDATE,this.onGoodsInfoUpdate,this),normalEvent.off(d.ROLE_OPEN_FUNCTION_UPDATE,this.onRoleOpenFunctionUpdate,this)},e.onRoleOpenFunctionUpdate=function(e){e==u.FUNC_MINE&&this.updateMineRedPoint()},e.onGoodsInfoUpdate=function(e,t){t==o.mine_pickaxe&&this.updateMineRedPoint()},e.initMineInfo=function(e){var t=this.maxAxeNum;this.maxAxeNum=e.max_num,this.nextRecoverTime=e.next_time,this.curArea=e.area,this.baseLine=e.baseline;var i=e.actives||[];this.blockIdToActive={};for(var n=0;n<i.length;n++)this.blockIdToActive[i[n]]=!0;var o=e.area_info||[];this.areaIdToMineCfgId={};for(var a=0;a<o.length;a++)this.areaIdToMineCfgId[o[a].k]=o[a].v;var s=e.blocks||[];this.blockIdToUpdateInfo={};for(var r=0;r<s.length;r++){var c=s[r];this.blockIdToUpdateInfo[c.id]=c}t!=this.maxAxeNum&&this.updateMineRedPoint()},e.updateMineInfo=function(e){this.curArea=e.area,this.baseLine=e.baseline;var t=e.actives||[];for(var i in this.blockIdToActive){if(this.baseLine<=2*h)break;Number(i)<=100*(this.baseLine-2*h)&&(this.blockIdToActive[i]=null)}for(var n=0;n<t.length;n++)this.blockIdToActive[t[n]]=!0;for(var o in this.areaIdToMineCfgId){if(this.curArea<=2)break;Number(o)<=this.curArea-2&&(this.areaIdToMineCfgId[o]=null)}for(var a=e.area_info||[],s=0;s<a.length;s++)this.areaIdToMineCfgId[a[s].k]=a[s].v;for(var r in this.blockIdToUpdateInfo){if(this.baseLine<=2*h)break;Number(r)<=100*(this.baseLine-2*h)&&(this.blockIdToUpdateInfo[r]=null)}for(var c=e.blocks||[],d=0;d<c.length;d++){var u=c[d];this.blockIdToUpdateInfo[u.id]=u}normalEvent.emit(f.MINE_INFO_UPDATE,{actives:t,blocks:c,reward:e.reward})},e.updateMineRedPoint=function(){IS(n).changeValue(i.formatStr("MainView/tab-%s/mine",l.Main_Mystery),this.getMineRedPoint()),normalEvent.emit(r.UPDATE_MAIN_MYSTERY_RED_POINT)},e.getMineRedPoint=function(){return IS(c).CheckFuncOpen(u.FUNC_MINE)&&IS(s).getGoodsCountByGoodsGtid(o.mine_pickaxe)>=this.maxAxeNum?1:0},t}());t._RF.pop()}}}));

