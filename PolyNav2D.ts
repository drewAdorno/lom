System.register("chunks:///_virtual/PolyNav2D.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ByteArray.ts","./AStar.ts","./PathNode.ts"],(function(n){"use strict";var t,e,r,o,i,s,a,l,u,h,c,p;return{setters:[function(n){t=n.applyDecoratedDescriptor,e=n.inheritsLoose,r=n.initializerDefineProperty,o=n.assertThisInitialized},function(n){i=n.cclegacy,s=n._decorator,a=n.Vec2,l=n.BufferAsset,u=n.Component},function(n){h=n.ByteArray},function(n){c=n.AStar},function(n){p=n.PathNode}],execute:function(){var f,y,d,g,v;i._RF.push({},"779e0ONLlxPg65WrSyAtBb7","PolyNav2D",void 0);var P=s.ccclass,x=s.property,m=function(n){this.points=void 0,this.points=n},I=function(){this.allPolygons=[]},w=new a,S=new a;n("PolyNav2D",(f=P("PolyNav2D"),y=x(l),f((v=t((g=function(n){function t(){for(var t,e=arguments.length,i=new Array(e),s=0;s<e;s++)i[s]=arguments[s];return t=n.call.apply(n,[this].concat(i))||this,r(t,"data",v,o(t)),t.map=void 0,t.nodes=[],t}e(t,n);var i=t.prototype;return i.onLoad=function(){var n=new h(this.data.buffer()),t=n.readShort();this.map=new I;for(var e=0;e<t;e++){for(var r=n.readShort(),o=[],i=0;i<r;i++)o[i]=new a(n.readFloat(),n.readFloat());this.map.allPolygons.push(new m(o))}for(var s=n.readShort(),l=0;l<s;l++){for(var u=new p(new a(n.readFloat(),n.readFloat())),c=n.readShort(),f=0;f<c;f++)u.links.push(n.readShort());this.nodes.push(u)}},i.checkLOS=function(n,e){if(a.squaredDistance(e,n)<Number.EPSILON)return!0;for(var r=null,o=this.map,i=0;i<o.allPolygons.length;i++){r=o.allPolygons[i];for(var s=0;s<r.points.length;s++)if(t.segmentsCross(n,e,r.points[s],r.points[(s+1)%r.points.length]))return!1}return!0},i.pointIsValid=function(n){for(var e=this.map,r=0;r<e.allPolygons.length;r++)if(0==r?!t.pointInsidePolygon(e.allPolygons[r].points,n):t.pointInsidePolygon(e.allPolygons[r].points,n))return!1;return!0},i.findPath=function(n,t,e){if(e.length=0,this.checkLOS(n,t))return e.push(n),e.push(t),!0;var r=new p(n),o=new p(t),i=this.nodes;i.push(r),this.linkStart(r,i),i.push(o),this.linkEnd(o,i),c.calculatePath(r,o,i,e);try{for(var s=i.indexOf(o),a=0;a<o.links.length;a++){var l=i[o.links[a]].links;l.splice(l.indexOf(s),1)}i.splice(s,1),i.splice(i.indexOf(r),1)}catch(n){}return 0!=e.length},i.linkStart=function(n,t){for(var e=0;e<t.length;e++)this.checkLOS(n.pos,t[e].pos)&&n.links.push(e)},i.linkEnd=function(n,t){for(var e=0;e<t.length;e++)this.checkLOS(n.pos,t[e].pos)&&(n.links.push(e),t[e].links.push(t.indexOf(n)))},t.inflatePolygon=function(n,t){for(var e=[],r=new a,o=new a,i=new a,s=0;s<n.length;s++)a.subtract(r,n[(s+1)%n.length],n[s]).normalize(),a.subtract(o,n[0==s?n.length-1:s-1],n[s]).normalize(),a.add(i,r,o).normalize(),i.multiplyScalar(this.pointIsConcave(n,s)?t:-t),e[s]=new a(n[s]).add(i);return e},t.pointIsConcave=function(n,t){var e=n[t],r=n[(t+1)%n.length],o=n[0==t?n.length-1:t-1],i=new a(e.x-o.x,e.y-o.y),s=new a(r.x-e.x,r.y-e.y);return i.x*s.y-i.y*s.x>0},t.segmentsCross=function(n,t,e,r){var o=(t.x-n.x)*(r.y-e.y)-(t.y-n.y)*(r.x-e.x);if(0==o)return!1;var i=(n.y-e.y)*(r.x-e.x)-(n.x-e.x)*(r.y-e.y),s=(n.y-e.y)*(t.x-n.x)-(n.x-e.x)*(t.y-n.y);if(0==i||0==s)return!1;var a=i/o,l=s/o;return a>0&&a<1&&l>0&&l<1},t.pointInsidePolygon=function(n,t){for(var e=0,r=0;r<n.length;r++)e=Math.min(e,n[r].x);for(var o=new a(e-.1,t.y),i=0,s=0;s<n.length;s++){var l=n[s],u=n[(s+1)%n.length];this.segmentsCross(o,t,l,u)&&i++}return 1==(1&i)},i.getCloserEdgePoint=function(n){for(var e=[],r=a.ZERO,o=Number.POSITIVE_INFINITY,i=null,s=this.map,l=null,u=0;u<s.allPolygons.length;u++){i=s.allPolygons[u],l=t.inflatePolygon(i.points,1);for(var h=0;h<l.length;h++){var c=l[h],p=l[(h+1)%l.length],f=i.points[h],y=i.points[(h+1)%i.points.length];a.subtract(w,n,c),a.subtract(S,p,c);var d=w.project(S).add(c).clone();t.segmentsCross(n,d,f,y)&&this.pointIsValid(d)&&e.push(d);var g=a.squaredDistance(l[h],n);g<o&&this.pointIsValid(l[h])&&(o=g,r=l[h])}}e.push(r);for(var v=Number.POSITIVE_INFINITY,P=0,x=0;x<e.length;x++){var m=a.squaredDistance(e[x],n);m<v&&(v=m,P=x)}return e[P]},t}(u)).prototype,"data",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),d=g))||d));i._RF.pop()}}}));

