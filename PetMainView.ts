System.register("chunks:///_virtual/PetMainView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AudioMgr.ts","./UIList.ts","./RedPoint.ts","./RedPointMgr.ts","./NodeUtil.ts","./StringUtil.ts","./index57.ts","./BaseSubView.ts","./ItemIcon.ts","./ConfigGlobal.ts","./ObjectUtil.ts","./BagControl.ts","./BagDefine.ts","./BagModel.ts","./ChatDataCache.ts","./ChatDefine.ts","./MessageView.ts","./RoleDataCache.ts","./PetControl.ts","./PetDataCache.ts","./PetDefine.ts","./PetModel.ts","./UIDefine.ts"],(function(t){"use strict";var e,n,i,o,a,s,d,h,r,l,c,p,m,f,u,C,v,g,I,P,b,y,S,T,L,k,w,_,E,M,B,K,x,U,W,D,N,R,O;return{setters:[function(t){e=t.inheritsLoose},function(t){n=t.cclegacy,i=t.Button,o=t.js,a=t.Vec2,s=t.Sprite,d=t.LabelOutline,h=t.Label,r=t.ScrollView,l=t.UITransform,c=t.sys,p=t.HorizontalTextAlignment,m=t.Color,f=t.isValid,u=t.Vec3,C=t.ProgressBar},function(t){v=t.audioMgr},function(t){g=t.SelectedType,I=t.ListItem},function(t){P=t.RedPointType},function(t){b=t.RedPointMgr},function(t){y=t.default},function(t){S=t.default},null,function(t){T=t.BaseSubView},function(t){L=t.IconAseetType},function(t){k=t.ConfigGlobal},function(t){w=t.default},function(t){_=t.default},function(t){E=t.BagEventDefine},function(t){M=t.BagModel},function(t){B=t.ChatDataCache},function(t){K=t.ChatDefine},function(t){x=t.default},function(t){U=t.RoleDataCache},function(t){W=t.default},function(t){D=t.PetDataCache},function(t){N=t.PetEventDefine},function(t){R=t.PetModel},function(t){O=t.PanelTabType}],execute:function(){n._RF.push({},"48c87c+reVK9bIQdx1PJgMJ","PetMainView",void 0);var V=k.pet_tab_num,A=(t("default",function(t){function n(){var e;return(e=t.call(this)||this).nodeWearMask=void 0,e.imgBtnOneKeyUpgrade=void 0,e.outLineBtnUpgrade=void 0,e.scrollPetList=void 0,e.nodeScroll=void 0,e.posItemList=void 0,e.petList=void 0,e.curChoosePetId=void 0,e.recommendPet=void 0,e.hasCanUpgrade=void 0,e.txtTotalEffect=void 0,e.txtTabName=void 0,e.nodeTabChange=void 0,e.isSwitching=!1,e.nodeTabContent=void 0,e.nodeTabItem=void 0,e.utTabContent=void 0,e.nodeTabMask=void 0,e.tabToItem={},e.btnOneKeyCompose=void 0,e.name="PetMainView",e.url="ui/module/pet/PetMainView",e}e(n,t);var I=n.prototype;return I.onInit=function(){var t=this;this.nodeWearMask=this.findChild("btnWearMask"),this.addComponentCallbackListener(this.nodeWearMask,i.EventType.CLICK,(function(){t.onWearMaskClick()}));var e=this.findChild("content/bottom/btnOneKeyWear");this.addComponentCallbackListener(e,i.EventType.CLICK,(function(){t.onOneKeyWearClick()}));var n=this.findChild("imgMask");this.addComponentCallbackListener(n,i.EventType.CLICK,(function(){t.isSwitching&&t.onSwitchClick()})),this.addRedPoint(o.formatStr("MainView/tab-%s/equip",O.Main_Partner),e,new a(90,25),P.Dot);var m=this.findChild("content/bottom/btnOneKeyUpgrade");this.addComponentCallbackListener(m,i.EventType.CLICK,(function(){t.onOneKeyUpgradeClick()})),this.addRedPoint(o.formatStr("MainView/tab-%s/upgrade",O.Main_Partner),m,new a(90,25),P.Dot),this.btnOneKeyCompose=this.findChild("content/bottom/btnOneKeyCompose"),this.addComponentCallbackListener(this.btnOneKeyCompose,i.EventType.CLICK,(function(){t.onOneKeyComposeClick()})),this.addRedPoint(o.formatStr("MainView/tab-%s/compose",O.Main_Partner),this.btnOneKeyCompose,new a(90,25),P.Dot),this.imgBtnOneKeyUpgrade=m.getComponent(s),this.outLineBtnUpgrade=this.findChildComponent("content/bottom/btnOneKeyUpgrade/Label",d),this.txtTotalEffect=this.findChildComponent("totalEffect/txtEffect",h);var f=this.findChildComponent("content/scrollPetList",r);this.nodeScroll=f.node,this.scrollPetList=this.addUIList(f,A),this.scrollPetList.selectedMode=g.SINGLE,this.posItemList=[];for(var u=function(e){var n=t.findChild(o.formatStr("wearParent/item%s",e)),a={node:n,nodeWear:y.findChild(n,"nodeWear"),imgFrame:y.findChildComponent(n,"imgFrame",s),imgIcon:y.findChildComponent(n,"nodeWear/imgIcon",s),txtLevel:y.findChildComponent(n,"nodeWear/txtLevel",h),pbNum:y.findChildComponent(n,"nodeWear/pbNum",C),txtNum:y.findChildComponent(n,"nodeWear/txtNum",h),btnRemove:y.findChild(n,"nodeWear/btnRemove"),nodeEmpty:y.findChild(n,"btnWear"),nodeLock:y.findChild(n,"imgLock"),pos:e};t.addComponentCallbackListener(a.node,i.EventType.CLICK,(function(){t.onPosItemClick(e)})),t.addComponentCallbackListener(a.btnRemove,i.EventType.CLICK,(function(){t.onPosRemoveClick(e)})),t.posItemList.push(a)},v=1;v<=5;v++)u(v);this.txtTabName=this.findChildComponent("tabInfo/name/txtName",h),this.nodeTabChange=this.findChild("tabChange"),this.nodeTabChange.active=!1,this.nodeTabContent=this.findChild("tabChange/scroll/view/content"),this.utTabContent=this.nodeTabContent.getComponent(l),this.nodeTabItem=this.findChild("tabChange/scroll/view/content/Item"),this.nodeTabItem.active=!1;var I=this.findChild("tabInfo/btnSwitch");this.addComponentCallbackListener(I,i.EventType.CLICK,(function(){t.onSwitchClick()})),this.nodeTabMask=this.findChild("imgTabMask"),this.addComponentCallbackListener(this.nodeTabMask,i.EventType.CLICK,(function(){t.onSwitchClick()})),this.nodeTabMask.active=!1;var b=this.findChild("content/btnTip");this.addComponentCallbackListener(b,i.EventType.CLICK,(function(){x.showBoxTip({tip:GetLanguage(201102),btnCnt:1,horizontalAlign:c.uiMirror?p.RIGHT:p.LEFT})}));var S=this.findChildComponent("tabInfo/btnSwitch",s);this.loadIcon(S,"pet","tb_ui_btn03"),this.initTabItems()},I.initTabItems=function(){for(var t=this,e=function(e){var n=nodeInstantiate.instantiate(t.nodeTabItem);n.parent=t.nodeTabContent,y.findChildComponent(n,"name/txtIndex",h).string=String(e);var a=y.findChild(n,"name");t.addComponentCallbackListener(a,i.EventType.CLICK,(function(){t.onEditClick(e)}));var d=y.findChild(n,"btnSwitch");t.addComponentCallbackListener(d,i.EventType.CLICK,(function(){t.onChangeClick(e)})),t.loadIcon(d.getComponent(s),"pet","tb_ui_btn03");var r=y.findChild(n,"btnShare");t.addComponentCallbackListener(r,i.EventType.CLICK,(function(){t.onShareClick(e)})),t.loadIcon(r.getComponent(s),"pet","tb_ui_btn02");var l=y.findChildComponent(n,"name/imgEdit",s);t.loadIcon(l,"player","grxx_ui_xiugai"),y.findChild(n,"imgSpace").active=e<V;for(var c=[],p=1;p<=5;p++){var m=y.findChild(n,o.formatStr("wearParent/item%s",p));c.push({node:m,pos:p,nodeLock:y.findChild(m,"imgLock"),nodeEmpty:y.findChild(m,"btnWear"),nodeWear:y.findChild(m,"nodeWear"),imgFrame:y.findChildComponent(m,"imgFrame",s),imgIcon:y.findChildComponent(m,"nodeWear/imgIcon",s),txtLevel:y.findChildComponent(m,"nodeWear/txtLevel",h)})}n.active=!0,t.tabToItem[e]={tab:e,node:n,txtName:y.findChildComponent(n,"name/txtName",h),nodeBtnChange:d,nodeCur:y.findChild(n,"current"),petItems:c}},n=1;n<=V;n++)e(n);this.utTabContent.height=174.6*V+20*(V-1)},I.registerUpdateHandler=function(){this.addEvent(N.PET_LIST_UPDATE,this.onPetListUpdate,this),this.addEvent(N.PET_POS_UNLOCK,this.onPetPosUnlock,this),this.addEvent(N.PET_INFO_VIEW_SELECT_WEAR,this.onPetInfoViewSelectWear,this),this.addEvent(N.PET_INFO_ADD,this.onPetInfoAdd,this),this.addEvent(N.PET_TAB_INFO_UPDATE,this.onPetTabInfoUpdate,this),this.addEvent(N.PET_CUR_TAB_CHANGE,this.onPetCurTabChange,this),this.addEvent(E.GOODS_LIST_UPDATE,this.onGoodsListUpdate,this)},I.onAfterOpen=function(){this.petList=IS(D).getSortAllPetList(),v.playSound("common_jiemian");var t=IS(U).GetJob(),e=configJobs.getDataByKey(t);this.recommendPet={};var n=e.recommend_pet;if(null!=n)for(var i=0;i<n.length;i++)this.recommendPet[n[i]]=!0;this.curChoosePetId=0,this.nodeWearMask.active=!1,this.updatePosItems(),this.showPetList(),this.updateBtnStatus(),this.updateCurTabName(),this.updateTabItems(),this.updateTabCur(),this.updateComposeState(),IS(b).changeValue(o.formatStr("MainView/tab-%s/upgrade",O.Main_Partner),IS(D).getAllPetUpgradeRedPoint()),IS(b).changeValue(o.formatStr("MainView/tab-%s/equip",O.Main_Partner),IS(D).getAllPetEquipRedPoint()),IS(b).changeValue(o.formatStr("MainView/tab-%s/compose",O.Main_Partner),IS(D).getAllPetComposeRedPoint()),this.updateTotalEffectShow()},I.updatePosItems=function(){for(var t=0;t<this.posItemList.length;t++)this.updateSinglePosItem(this.posItemList[t])},I.updateSinglePosItem=function(t){t.nodeLock.active=!1,t.nodeEmpty.active=!1,t.nodeWear.active=!1;var e=t.pos;if(1!=IS(R).checkPosUnlock(e))return t.nodeLock.active=!0,this.loadIcon(t.imgFrame,"icon_pet","zjm_ui_pinzhikuangbai"),void(t.imgFrame.grayscale=!0);t.imgFrame.grayscale=!1;var n=IS(R).getPetByPos(e);if(w.isEmpty(n))return this.loadIcon(t.imgFrame,"icon_pet","zjm_ui_pinzhikuangbai"),void(t.nodeEmpty.active=!0);var i=n.pet_id,a=configPet.getDataByKey(i);this.loadIcon(t.imgFrame,"icon_pet",configColor.getDataByKey(a.quality).path),this.loadIcon(t.imgIcon,"icon_pet",a.icon),t.nodeWear.active=!0;var s=n.level;t.txtLevel.string=o.formatStr("Lv.%s",s);var d=s+1,h=configPetlevel.getDataByKeys("id",i,"level",d),r=(0==(w.isEmpty(h)||!1)?h:configPetlevel.getDataByKeys("id",i,"level",s)).expend[0],l=IS(M).getGoodsCountByGoodsGtid(r[0]),c=r[1];t.txtNum.string=o.formatStr("%s/%s",l,c),t.pbNum.progress=Math.min(l/c,1)},I.updateTabItems=function(){for(var t in this.tabToItem)this.updateSingleTabItem(this.tabToItem[t])},I.updateTabCur=function(){var t=IS(R).getCurTab();for(var e in this.tabToItem){var n=this.tabToItem[e];n.nodeBtnChange.active=n.tab!=t,n.nodeCur.active=n.tab==t}},I.updateComposeState=function(){this.btnOneKeyCompose.active=IS(R).checkAnyPetCompose()},I.updateSingleTabItem=function(t){if(null!=t){var e=t.tab,n=IS(R).getTabInfo(e);t.txtName.string=IS(R).getTabName(e);for(var i=t.petItems,a=n?n.pos_info:[],s={},d=0;d<a.length;d++)s[a[d].k]=a[d].v;for(var h=0;h<i.length;h++){var r=i[h],l=r.pos;if(r.nodeLock.active=!1,r.nodeEmpty.active=!1,r.nodeWear.active=!1,1==IS(R).checkPosUnlock(l)){r.imgFrame.grayscale=!1;var c=s[l];if(c&&0!=c){var p=IS(R).getPetInfoByPetId(c),m=configPet.getDataByKey(c);this.loadIcon(r.imgFrame,"icon_pet",configColor.getDataByKey(m.quality).path),this.loadIcon(r.imgIcon,"icon_pet",m.icon),r.nodeWear.active=!0;var f=p.level;r.txtLevel.string=o.formatStr("Lv.%s",f)}else this.loadIcon(r.imgFrame,"icon_pet","zjm_ui_pinzhikuangbai"),r.nodeEmpty.active=!0}else r.nodeLock.active=!0,this.loadIcon(r.imgFrame,"icon_pet","zjm_ui_pinzhikuangbai"),r.imgFrame.grayscale=!0}}},I.showPetList=function(){this.scrollPetList.datas=this.petList},I.updateBtnStatus=function(){var t,e;this.hasCanUpgrade=!1;for(var n=0;n<this.petList.length;n++){e=this.petList[n];var i=IS(R).getPetInfoByPetId(e);if(!w.isEmpty(i)){t=i.level+1;var o=configPetlevel.getDataByKeys("id",e,"level",t);if(!w.isEmpty(o)){var a=o.expend[0];IS(M).getGoodsCountByGoodsGtid(a[0])<a[1]||(this.hasCanUpgrade=!0)}}}this.loadIcon(this.imgBtnOneKeyUpgrade,"common",this.hasCanUpgrade?"common_ICON_luanniu":"common_ICON_zhihuianniu",null,L.UI_ATLAS,!0),this.outLineBtnUpgrade.color=this.hasCanUpgrade?new m(41,65,21):new m(76,76,76)},I.updateTotalEffectShow=function(){for(var t,e,n={},i=0;i<this.petList.length;i++){t=this.petList[i];var o=IS(R).getPetInfoByPetId(t);if(!w.isEmpty(o)){e=o.level;for(var a=configPetlevel.getDataByKeys("id",t,"level",e).ownEffect,s=void 0,d=void 0,h=0;h<a.length;h++)s=a[h][0],d=a[h][1],n[s]||(n[s]=0),n[s]=n[s]+d}}var r=0;for(var l in n){r=n[l]||0;break}this.txtTotalEffect.string=S.formatStrWithMirrorDeal(GetLanguage(200099),r/100)},I.updateCurTabName=function(){this.txtTabName.string=IS(R).getTabName(IS(R).getCurTab())},I.onBeforeClose=function(){this.isSwitching=!1,f(this.nodeTabChange)&&(this.nodeTabChange.active=!1,this.nodeTabMask.active=!1)},I.onDestroy=function(){},I.onOneKeyWearClick=function(){for(var t,e=this,n=[],i=0;i<this.petList.length;i++){t=this.petList[i];var o=IS(R).getPetInfoByPetId(t);w.isEmpty(o)||n.push(t)}if(n.length<=0)x.showFlyTip(GetLanguage(200100));else{n.sort((function(t,n){var i=e.recommendPet[t]||!1;if(i!=(e.recommendPet[n]||!1))return 1==i?-1:1;var o=configPet.getDataByKey(t),a=configPet.getDataByKey(n),s=o.quality,d=a.quality;if(s!=d)return s>d?-1:1;var h=IS(R).getPetInfoByPetId(t),r=IS(R).getPetInfoByPetId(n),l=h.level,c=r.level;return l!=c?l>c?-1:1:t>n?-1:1}));for(var a={},s=new Array,d=0;d<n.length;d++){var h=n[d],r=configPet.getDataByKey(h).type[0];null!=a[r]?s.push(h):a[r]={firstPet:h,firstPetIndex:d}}var l=new Array;for(var c in a)null!=a[c]&&l.push(a[c]);l.sort((function(t,e){return t.firstPetIndex-e.firstPetIndex}));for(var p,m,f=new Array,u=0,C=1;C<=5&&0!=IS(R).checkPosUnlock(C);C++)null==(p=C-1<=l.length-1?l[C-1]:null)?u>s.length-1?m=null:(m=s[u],u+=1):m=p.firstPet,null!=m&&f.push({k:C,v:m});IS(W).reqOnKeySetPos(f)}},I.onPetListUpdate=function(){this.updatePosItems(),this.showPetList(),this.updateBtnStatus(),this.updateTotalEffectShow(),this.updateComposeState()},I.onPetPosUnlock=function(){this.updatePosItems(),this.showPetList(),this.updateBtnStatus()},I.onPetInfoViewSelectWear=function(t){this.setChoosePetId(t)},I.onPetInfoAdd=function(t){this.showPetList(),this.updateTotalEffectShow()},I.onPetTabInfoUpdate=function(t){t==IS(R).getCurTab()&&this.updateCurTabName(),this.updateSingleTabItem(this.tabToItem[t])},I.onPetCurTabChange=function(){this.updateCurTabName(),this.updateTabCur()},I.onGoodsListUpdate=function(){this.showPetList(),this.updateComposeState(),this.updateBtnStatus()},I.onOneKeyUpgradeClick=function(){0!=this.hasCanUpgrade?(v.playSound("common_shengji"),IS(W).reqPetLevUp(0)):x.showFlyTip(GetLanguage(200489))},I.onOneKeyComposeClick=function(){var t=IS(R).getAllComposePet();IS(_).reqGoodsComposeSkillPet(1,1,t)},I.setChoosePetId=function(t){this.curChoosePetId=t,this.nodeWearMask.active=0!=t||!1,this.updatePosItems()},I.onWearMaskClick=function(){this.setChoosePetId(0)},I.onPosItemClick=function(t){if(1==IS(R).checkPosUnlock(t)){var e=IS(R).getPetByPos(t);if(!w.isEmpty(e))return 0!=this.curChoosePetId?(IS(W).reqPetSetPos(this.curChoosePetId,t),void this.setChoosePetId(0)):void uiMgr.openView("PetInfoView",e.pet_id)}else IS(R).tryShowPosLockTips(t)},I.onPosRemoveClick=function(t){var e=IS(R).getPetByPos(t);w.isEmpty(e)||0==this.curChoosePetId&&IS(W).reqPetSetPos(e.pet_id,0)},I.onSwitchClick=function(){this.nodeTabContent.setPosition(new u(0,0,0)),this.nodeTabChange.active=!this.isSwitching,this.nodeTabMask.active=!this.isSwitching,this.isSwitching=!this.isSwitching},I.onEditClick=function(t){uiMgr.openView("TabRenameView",t,"pet")},I.onChangeClick=function(t){IS(W).reqPetChooseTab(t)},I.onShareClick=function(t){if(IS(B).IsOpenInput()){for(var e=IS(R).getTabInfo(t),n=e?e.pos_info:[],i=[],o={},a=0;a<n.length;a++)o[n[a].k]=n[a].v;for(var s=1;s<=5;s++){if(IS(R).checkPosUnlock(s)){var d=o[s];if(null!=d&&0!=d){var h=IS(R).getPetInfoByPetId(d);i.push({pos:s,pet_id:d,level:h.level})}else i.push({pos:s,pet_id:0,level:0})}else i.push({pos:s,pet_id:-1,level:0})}uiMgr.openView("ChatView",null,null,{contentType:K.ChatContentType.Share,linkType:K.ChatLinkType.PetTab,cacheData:{tabName:IS(R).getTabName(t),petListStr:JSON.stringify(i)},showString:GetLanguage(200163)})}else x.showFlyTip(S.formatStrWithMirrorDeal(GetLanguage(200490),k.chat_level))},n}(T)),function(t){function n(){for(var e,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))||this).imgFrame=void 0,e.imgIcon=void 0,e.txtLevel=void 0,e.pbNum=void 0,e.txtNum=void 0,e.nodeRecommend=void 0,e.btnWear=void 0,e.btnRemove=void 0,e.nodeHasWear=void 0,e.nodeLock=void 0,e.nodeCanUpgrade=void 0,e.nodeMask=void 0,e.petId=void 0,e.nodeMax=void 0,e}e(n,t);var a=n.prototype;return a.onInit=function(){var t=this;this.imgFrame=y.findChildComponent(this.node,"imgFrame",s),this.imgIcon=y.findChildComponent(this.node,"imgIcon",s),this.nodeMask=y.findChild(this.node,"imgMask"),this.txtLevel=y.findChildComponent(this.node,"txtLevel",h),this.pbNum=y.findChildComponent(this.node,"pbNum",C),this.txtNum=y.findChildComponent(this.node,"txtNum",h),this.nodeRecommend=y.findChild(this.node,"imgRecommend"),this.btnWear=y.findChild(this.node,"btnWear"),this.view.addComponentCallbackListener(this.btnWear,i.EventType.CLICK,(function(){t.onWearClick()})),this.btnRemove=y.findChild(this.node,"btnRemove"),this.view.addComponentCallbackListener(this.btnRemove,i.EventType.CLICK,(function(){t.onRemoveClick()})),this.nodeLock=y.findChild(this.node,"imgLock"),this.nodeCanUpgrade=y.findChild(this.node,"imgCanUpgrade"),this.nodeHasWear=y.findChild(this.node,"txtHasWear"),this.nodeMax=y.findChild(this.node,"max")},a.onRender=function(t,e){this.petId=t;var n=configPet.getDataByKey(this.petId);this.view.loadIcon(this.imgFrame,"icon_pet",configColor.getDataByKey(n.quality).path),this.view.loadIcon(this.imgIcon,"icon_pet",n.icon);var i=IS(R).getPetInfoByPetId(this.petId),a=w.isEmpty(i)||!1;this.nodeMask.active=a,this.nodeLock.active=a||!1,this.txtLevel.string=a?"":o.formatStr("Lv.%s",i.level);var s=a?0:i.level,d=s+1,h=configPetlevel.getDataByKeys("id",this.petId,"level",d),r=w.isEmpty(h)||!1;this.nodeMax.active=r,this.txtLevel.node.active=!r;var l=(0==r?h:configPetlevel.getDataByKeys("id",this.petId,"level",s)).expend[0],c=IS(M).getGoodsCountByGoodsGtid(l[0]),p=configMix.getDataByKey(l[0]);if(!r||null!=p&&null!=p.cost&&0!=p.cost){var m=r?p.cost:l[1];this.txtNum.string=o.formatStr("%s/%s",c,m),this.pbNum.progress=Math.min(c/m,1)}else this.pbNum.progress=1,this.txtNum.string=o.formatStr("%s/%s",c,0);this.nodeCanUpgrade.active=IS(R).checkPetCanUpgrade(this.petId);var f=this.view;this.nodeRecommend.active=1==f.recommendPet[this.petId]||!1,this.btnWear.active=0==a&&0==i.pos||!1,this.btnRemove.active=0==a&&0!=i.pos||!1,this.nodeHasWear.active=0==a&&0!=i.pos||!1},a.onItemClick=function(){uiMgr.openView("PetInfoView",this.petId)},a.onWearClick=function(){var t=IS(R).getEmptyPos();null==t?this.view.setChoosePetId(this.petId):IS(W).reqPetSetPos(this.petId,t)},a.onRemoveClick=function(){IS(W).reqPetSetPos(this.petId,0)},n}(I));n._RF.pop()}}}));

