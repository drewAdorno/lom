System.register("chunks:///_virtual/AchievementView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AudioMgr.ts","./index3.ts","./UIList.ts","./RedPoint.ts","./RedPointMgr.ts","./NodeUtil.ts","./StringUtil.ts","./index57.ts","./ItemIcon.ts","./MessageView.ts","./PetModel.ts","./SkillModel.ts","./AchievementControl.ts","./AchievementDataCache.ts","./AchievementDefine.ts","./EaseMethod.ts","./BaseSubView.ts"],(function(t){"use strict";var e,i,n,o,s,l,a,d,r,c,h,f,v,u,p,m,I,w,g,C,S,y,L,b,A,R,T,k;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,n=t.ScrollView,o=t.Vec2,s=t.Sprite,l=t.Label,a=t.UITransform,d=t.Button,r=t.Vec3,c=t.Color,h=t.js},function(t){f=t.audioMgr},null,function(t){v=t.ListItem},function(t){u=t.RedPointType},function(t){p=t.RedPointMgr,m=t.RedPointNode},function(t){I=t.default},function(t){w=t.default},null,function(t){g=t.IconAseetType},function(t){C=t.default},function(t){S=t.PetModel},function(t){y=t.SkillModel},function(t){L=t.default},function(t){b=t.AchievementDataCache},function(t){A=t.AchievementEventDefine,R=t.AchievementDefine},function(t){T=t.EasingMethod},function(t){k=t.BaseSubView}],execute:function(){i._RF.push({},"f6c5a5dh1JAqZNLHU5dKQ4G","AchievementView",void 0);t("default",function(t){function i(){var e;return(e=t.call(this)||this).isActive=!1,e.tabList=[],e.closeBtn=void 0,e.parentView=void 0,e.curIndex=void 0,e.illustrateList=void 0,e.scrollView=void 0,e.name="AchievementView",e}e(i,t);var s=i.prototype;return s.registerUpdateHandler=function(){this.addEvent(A.AchievementUpdate,this.RefreshScroll,this)},s.onInit=function(){var t=this;this.tabList=[];for(var e=function(e){t.findChild("tab/scrollTab/view/content/item"+e);var i={itemGo:t.findChild("tab/scrollTab/view/content/item"+e),normalSelect:t.findChild("tab/scrollTab/view/content/item"+e+"/normal"),select:t.findChild("tab/scrollTab/view/content/item"+e+"/selected")};t.addComponentCallbackListener(i.itemGo,d.EventType.CLICK,(function(){t.RefreshSelectItem(e)})),t.tabList[e]=i},i=0;i<2;i++)e(i);var o=this.findChildComponent("ScrollView",n);this.scrollView=this.addUIList(o,V);var s=configIllustrated.getDatas();this.illustrateList={};for(var l=0;l<s.length;l++){var a=s[l];null==this.illustrateList[a.type]&&(this.illustrateList[a.type]={}),null==this.illustrateList[a.type][a.id]&&(this.illustrateList[a.type][a.id]={}),this.illustrateList[a.type][a.id][a.level]=a}},s.RefreshSelectItem=function(t){if(this.curIndex!=t){for(var e=0;e<this.tabList.length;e++)this.tabList[e].normalSelect.active=t!=e,this.tabList[e].select.active=t==e;this.curIndex=t,this.scrollView.scrollTo(0,.1),this.RefreshScroll()}},s.onAfterOpen=function(){this.curIndex=null,this.UpdateTabRed();for(var t=0,e=1;e<=2;e++)if(IS(b).GetRedByType(e)){t=e-1;break}this.RefreshSelectItem(t)},s.UpdateTabRed=function(){for(var t=0;t<this.tabList.length;t++){var e=this.tabList[t];this.addRedPoint("collect_red/"+(t+1),e.itemGo,new o(97,13),u.Dot),IS(p).updateRed("collect_red/"+(t+1))}},s.RefreshScroll=function(){var t=[],e=this.curIndex+1,i=this.illustrateList[e];if(null!=i){for(var n in i){var o=IS(b).GetCollectionLevelByTypeAndId(e,n),s=i[n][o],l=[],a=IS(b).GetCollectionStateByTypeAndId(e,n);for(var d in s.condition)l.push({cond:s.condition[d],state:a});t.push({cfg:s,state:a,condList:l})}t.sort((function(t,e){var i=0,n=0;return t.state==R.AchievementState.Reward&&(i+=1e7),e.state==R.AchievementState.Reward&&(n+=1e7),t.state==R.AchievementState.Normal&&(i+=1e5),e.state==R.AchievementState.Normal&&(n+=1e5),t.state==R.AchievementState.Lock&&(i+=1e3),e.state==R.AchievementState.Lock&&(n+=1e3),t.cfg.id<e.cfg.id&&(i+=100),t.cfg.id>e.cfg.id&&(n+=100),i<n?1:-1})),this.scrollView.datas=t}else this.scrollView.datas=t},s.onBeforeClose=function(){},s.onDestroy=function(){},i}(k));var D=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).icon=void 0,e.bg=void 0,e.level=void 0,e.mask=void 0,e.poolInfo=void 0,e}e(i,t);var n=i.prototype;return n.onInit=function(){this.bg=I.findChildComponent(this.node,"bg",s),this.icon=I.findChildComponent(this.node,"bg/icon",s),this.level=I.findChildComponent(this.node,"level",l),this.mask=I.findChild(this.node,"mask")},n.onRender=function(t,e){this.poolInfo=t.cond;var i=this.poolInfo[0];if(1==i){var n=this.poolInfo[1],o=IS(y).getSystemSkillInfoBySkillId(n),s=configSkill.getDataByKey(n),l=0,a=this.poolInfo[2];null!=o&&(l=o.skill_lv),this.level.color=l<a?c.RED:c.WHITE,this.level.string=h.formatStr("Lv.%s/%s",l,this.poolInfo[2]),this.mask.active=t.state!=R.AchievementState.Lock&&l<a;var d=configColor.getDataByKey(s.quality);this.view.loadIcon(this.icon,"icon_skill",s.icon,null,g.UI_ATLAS,!0),this.view.loadIcon(this.bg,"icon_equip",d.path)}else if(2==i){var r=this.poolInfo[1],f=IS(S).getPetInfoByPetId(r),v=configPet.getDataByKey(r),u=0,p=this.poolInfo[2];null!=f&&(u=f.level),this.level.color=u<p?c.RED:c.WHITE,this.level.string=h.formatStr("Lv.%s/%s",u,this.poolInfo[2]),this.mask.active=t.state!=R.AchievementState.Lock&&u<p;var m=configColor.getDataByKey(v.quality);this.view.loadIcon(this.icon,"icon_pet",v.icon),this.view.loadIcon(this.bg,"icon_pet",m.path)}},i}(v),V=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).full=void 0,e.btn=void 0,e.btnBg=void 0,e.title=void 0,e.attrDes=void 0,e.mask=void 0,e.addAttr=void 0,e.attrDesTrans=void 0,e.arrow=void 0,e.scrollView=void 0,e.poolInfo=void 0,e.state=void 0,e.rewardRedPoint=void 0,e.moveTween=void 0,e}e(i,t);var c=i.prototype;return c.onInit=function(){var t=this;this.btn=I.findChild(this.node,"btn"),this.full=I.findChild(this.node,"full"),this.btnBg=I.findChildComponent(this.node,"btn",s),this.arrow=I.findChild(this.node,"arrow"),this.title=I.findChildComponent(this.node,"title",l),this.attrDes=I.findChildComponent(this.node,"attrDes/attrdes",l),this.attrDesTrans=I.findChildComponent(this.node,"attrDes/attrdes",a),this.addAttr=I.findChildComponent(this.node,"attrDes/attrdes2",l),this.mask=I.findChild(this.node,"mask"),this.view.addComponentCallbackListener(this.btn,d.EventType.CLICK,(function(){if(t.state==R.AchievementState.Reward){f.playSound("common_shengji"),null!=t.moveTween&&t.moveTween.stop();var e=new r,i=t.node.getComponent(a).contentSize,n=t.node.position,o=new r(n.x,n.y);t.moveTween=t.view.addTween(0,1,.15,(function(n,s){e.set(o).add3f(-1.1*i.x*s,0,0),t.node.position=e})).easing(T.LINEAR).call((function(){IS(L).reqCollectionEnhance(t.poolInfo.id)})).start()}else C.showFlyTip(GetLanguage(200020))}));var e=I.findChildComponent(this.node,"ScrollView",n);this.scrollView=this.view.addUIList(e,D,!1),this.scrollView.virtual=!1,this.rewardRedPoint=new m,this.rewardRedPoint.addRedPoint(this.btn,new o(64,17),u.Dot)},c.onRender=function(t,e){this.poolInfo=t.cfg;IS(b).GetCollectionInfoByTypeAndId(this.poolInfo.type,this.poolInfo.id);this.state=t.state,this.title.string=this.poolInfo.name+" LV."+this.poolInfo.level,this.attrDes.string=w.formatStr.apply(w,[this.poolInfo.desc].concat(this.poolInfo.desc_parm)),this.addAttr.string=this.poolInfo.urgrade_desc;var i=t.condList;this.scrollView.datas=i,this.mask.active=this.state==R.AchievementState.Lock,this.rewardRedPoint.notifyNum=this.state==R.AchievementState.Reward?1:0,this.arrow.active=this.state==R.AchievementState.Reward,this.view.loadIcon(this.btnBg,"common",this.state!=R.AchievementState.Reward?"common_ICON_zhihuianniu":"common_ICON_luanniu",null,g.UI_ATLAS,!0),configIllustrated.getDataByKeys("id",this.poolInfo.id,"level",this.poolInfo.level+1)?(this.btn.active=!0,this.full.active=!1):(this.btn.active=!1,this.full.active=!0)},i}(v);i._RF.pop()}}}));

