System.register("chunks:///_virtual/RankingRushView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./ItemIcon.ts","./MessageView.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./RankingRushDataCache.ts","./BaseView.ts"],(function(t){"use strict";var e,i,n,a,s,o,r,d,h,u,l,m,g,c,f,p,v,T,C,S,y;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,n=t.ScrollView,a=t.Button,s=t.Label,o=t.js,r=t.Sprite},function(t){d=t.SelectedType,h=t.ListItem},function(t){u=t.default},function(t){l=t.default},function(t){m=t.default},null,function(t){g=t.IconAseetType},function(t){c=t.default},function(t){f=t.default},function(t){p=t.ActivityEventDefine,v=t.ActivityType,T=t.ActivityState,C=t.RankRushRes},function(t){S=t.RankingRushDataCache},function(t){y=t.BaseView}],execute:function(){i._RF.push({},"6ae11DiTblL0rGpWBueBy1P","RankingRushView",void 0);t("default",function(t){function i(){var e;return(e=t.call(this)||this).MenuUIList=void 0,e.nothing=void 0,e.deltaTime=0,e.leftTime=0,e.canUpdate=!1,e.name="RankingRushView",e.url="ui/module/activity/RankingRushView",e.poolTime=3e3,e}e(i,t);var r=i.prototype;return r.onInit=function(){var t=this,e=this.findChildComponent("root/ScrollView",n);this.MenuUIList=this.addUIList(e,I),this.MenuUIList.selectedMode=d.SINGLE;var i=this.findChild("imgMask");this.addComponentCallbackListener(i,a.EventType.CLICK,(function(){t.close()}));var o=this.findChild("root/bg/btnClose");this.addComponentCallbackListener(o,a.EventType.CLICK,(function(){t.close()}));var r=this.findChild("root/btnShop");this.addComponentCallbackListener(r,a.EventType.CLICK,(function(){uiMgr.openView("RankingRushStoreView")})),this.nothing=this.findChildComponent("root/nothing",s)},r.onAfterOpen=function(){this.UpdateInfo()},r.registerUpdateHandler=function(){this.addEvent(p.OnActivityInfoTaskUpdate,this.UpdateInfo,this),this.addEvent(p.OnActivityInfoUpdate,this.UpdateInfo,this)},r.onBeforeClose=function(){this.canUpdate=!1},r.onDestroy=function(){},r.onUpdate=function(t){this.canUpdate&&(this.deltaTime=this.deltaTime+t,this.deltaTime>=1&&(this.deltaTime=0,this.leftTime=this.leftTime-1,this.leftTime>0?this.nothing.string=GetLanguage(300200)+"\n"+m.formatTimeStringForSecond(this.leftTime):(this.nothing.string=GetLanguage(201664),this.canUpdate=!1)))},r.UpdateInfo=function(){for(var t=[],e=1;e<=9;e++){var i=IS(f).GetActivityInfo(v[o.formatStr("RankRush_%s",e)]);i&&i.state==T.Open&&t.push(i)}if(t.sort((function(t,e){var i=t.state_time[T.Open].end_time-t.state_time[T.Open].start_time,n=e.state_time[T.Open].end_time-e.state_time[T.Open].start_time;return i!=n?n-i:t.id-e.id})),this.MenuUIList.datas=t,0==t.length){this.nothing.node.active=!0;var n=IS(f).GetActivityInfo(v.Seven2);if(n){var a=m.ServerDate(1e3*n.state_time[T.Open].start_time),s=o.formatStr("%s/%s/%s %s:%s:%s",a.getFullYear(),a.getMonth()+1,a.getDate(),0,0,0),r=m.getServerDateByLocalStr(s).getTime()/1e3,d=a.getDay();this.leftTime=0==d?r+86400-m.serverTime:r+86400*(8-d)-m.serverTime,this.canUpdate=!0,this.nothing.string=GetLanguage(300200)+"\n"+m.formatTimeStringForSecond(this.leftTime)}else this.nothing.string=GetLanguage(201664)}else this.nothing.node.active=!1},i}(y));var I=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),a=0;a<i;a++)n[a]=arguments[a];return(e=t.call.apply(t,[this].concat(n))||this).imgBG=void 0,e.txtTitle=void 0,e.txtDate=void 0,e.txtTime=void 0,e.txtTime_str=void 0,e.redNode=void 0,e.timer=void 0,e}e(i,t);var n=i.prototype;return n.onInit=function(){this.imgBG=u.findChildComponent(this.node,"bg",r),this.txtTitle=u.findChildComponent(this.node,"title",s),this.txtDate=u.findChildComponent(this.node,"Node/date",s),this.txtTime_str=u.findChildComponent(this.node,"node1/txt",s),this.txtTime=u.findChildComponent(this.node,"node1/time",s),this.redNode=u.findChild(this.node,"red")},n.onRender=function(t,e){var i=this;this.view.loadIcon(this.imgBG,"xscb_icon_2",C[t.type].bg1,null,g.UI_ATLAS,!0),this.txtTitle.string=GetLanguage(C[t.type].titleID);var n=m.formatDate(new Date(1e3*t.state_time[T.Open].start_time),"MM/dd"),a=m.formatDate(new Date(1e3*t.state_time[T.Open].end_time),"MM/dd");this.txtDate.string=o.formatStr("%s-%s%s",n,a,m.GetServerTimeZoneStr()),this.redNode.active=IS(f).GetTaskRedNum(t.type)+IS(S).getRed(t.type)>0,this.timer&&this.view.removeTimer(this.timer);var s=function(){var e=t.end_time-m.serverTime;if(t.state!=T.EndShow&&e>=0){var n=m.getTimeData(e),a=n[0],s=n[1],o=n[2],r=n[3],d="";r>0?d=l.formatStrWithMirrorDeal(GetLanguage(200006),r,o):o>0?d=l.formatStrWithMirrorDeal(GetLanguage(200003),o,s,a):s>0?d=l.formatStrWithMirrorDeal(GetLanguage(200004),s,a):a>0&&(d=l.formatStrWithMirrorDeal(GetLanguage(200005),a)),t.state==T.Preview?(i.txtTime_str.string=GetLanguage(200084),i.txtTime.string=d):t.state==T.Open?(i.txtTime_str.string=GetLanguage(200085),i.txtTime.string=d):(i.txtTime_str.string="",i.txtTime.string=GetLanguage(200026))}else i.txtTime_str.string="",i.txtTime.string=GetLanguage(200026)};s(),this.timer=this.view.addTimer(1,-1,s)},n.onItemClick=function(){this.data.state==T.Preview?c.showFlyTip(GetLanguage(200086)):(this.data.type==v.RankRush_5?uiMgr.openView("RankingRushMainView_2",this.data):uiMgr.openView("RankingRushMainView",this.data),this.redNode.active&&(IS(S).setRed(this.data.type),this.redNode.active=IS(f).GetTaskRedNum(this.data.type)+IS(S).getRed(this.data.type)>0))},i}(h);i._RF.pop()}}}));

