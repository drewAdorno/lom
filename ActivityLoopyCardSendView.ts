System.register("chunks:///_virtual/ActivityLoopyCardSendView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./BagModel.ts","./MessageView.ts","./FriendControl.ts","./FriendDefine.ts","./FriendModel.ts","./GuildDataCache.ts","./GuildDefine.ts","./RoleDataCache.ts","./RoleDefine.ts","./ActivityControl.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./ActivityLoopyDefine.ts","./BaseView.ts"],(function(e){"use strict";var t,i,n,o,a,s,r,d,l,h,c,f,m,u,g,v,p,C,I,y,L,_,T,S,w,G,b,B;return{setters:[function(e){t=e.inheritsLoose},function(e){i=e.cclegacy,n=e.Button,o=e.Label,a=e.Sprite,s=e.EditBox,r=e.UITransform,d=e.ScrollView},function(e){l=e.ListItem},function(e){h=e.default},function(e){c=e.default},function(e){f=e.default},null,function(e){m=e.BagModel},function(e){u=e.default},function(e){g=e.default},function(e){v=e.FriendListType,p=e.FriendDefine},function(e){C=e.FriendModel},function(e){I=e.default},function(e){y=e.GuildEventDefine},function(e){L=e.RoleDataCache},function(e){_=e.PlayerAttr},function(e){T=e.default},function(e){S=e.default},function(e){w=e.ActivityEventDefine,G=e.ActivityType},function(e){b=e.CardItemIcon},function(e){B=e.BaseView}],execute:function(){i._RF.push({},"8507ct48nVKj4vMtEoSO7Zh","ActivityLoopyCardSendView",void 0);e("default",function(e){function i(){var t;return(t=e.call(this)||this).operateType=0,t.curIndex=void 0,t.itemId=void 0,t.page=0,t.isSendToServer=void 0,t.itemIcon=void 0,t.title=void 0,t.searchItem=void 0,t.itemName=void 0,t.editBox=void 0,t.msgTip=void 0,t.tabList=void 0,t.scrollView=void 0,t.scrollViewTrans=void 0,t.cardItemList=[],t.name="ActivityLoopyCardSendView",t.url="ui/module/activityLoopy/ActivityLoopyCardSendView",t}t(i,e);var l=i.prototype;return l.onInit=function(){var e=this,t=this.findChild("bg/btnClose");this.addComponentCallbackListener(t,n.EventType.CLICK,(function(){e.close()})),this.msgTip=this.findChildComponent("bg/imgTitle",o),this.itemIcon=this.findChildComponent("itemNode/itemIcon",a),this.itemName=this.findChildComponent("itemNode/Label",o),this.searchItem=this.findChild("searchItem"),this.editBox=this.findChildComponent("searchItem/EditBox",s);var i=this.findChild("searchItem/searchBtn");this.addComponentCallbackListener(i,n.EventType.CLICK,(function(){var t=e.editBox.string;""!=t?IS(T).send_gift_search(t):IS(g).reqFriendList(v.FriendRecommend,1)})),this.tabList=[];for(var l=function(t){e.findChild("select/item"+(t+1));var i={itemGo:e.findChild("select/item"+(t+1)),select:e.findChild("select/item"+(t+1)+"/select")};e.addComponentCallbackListener(i.itemGo,n.EventType.CLICK,(function(){2!=t||IS(L).HasGuild()?e.RefreshSelectItem(t):u.showFlyTip(GetLanguage(200165))})),e.tabList[t]=i},h=0;h<3;h++)l(h);this.scrollViewTrans=this.findChildComponent("ScrollView",r);var c=this.findChildComponent("ScrollView",d);this.scrollView=this.addUIList(c,F),this.addComponentCallbackListener(c.node,d.EventType.SCROLL_TO_BOTTOM,(function(){e.isSendToServer||1!=e.curIndex||(e.page+=1,IS(g).reqFriendList(v.FriendList,e.page),e.isSendToServer=!0)}))},l.registerUpdateHandler=function(){this.addEvent(p.FriendInfoBack,this.RefreshScroll,this),this.addEvent(w.OnActivityGiftSearchBack,this.RefreshScroll,this),this.addEvent(y.GUILD_INFO_UPDATE,this.RefreshScroll,this)},l.RefreshSelectItem=function(e){if(this.curIndex!=e){for(var t=0;t<this.tabList.length;t++)this.tabList[t].select.active=e==t;this.curIndex=e,this.scrollView.scrollTo(0,-1),this.editBox.string="",0==this.curIndex?(this.scrollViewTrans.height=400,this.searchItem.active=!0,IS(g).reqFriendList(v.FriendRecommend,1)):1==this.curIndex?(this.scrollViewTrans.height=455,this.searchItem.active=!1,this.page=1,IS(g).reqFriendList(v.FriendList,this.page)):(this.scrollViewTrans.height=455,this.searchItem.active=!1),this.RefreshScroll()}},l.onAfterOpen=function(){this.editBox.placeholder=GetLanguage_UI(400289),this.curIndex=null,this.itemId=this.openArgs[0],this.operateType=this.openArgs[1];var e=configGoods.getDataByKey(this.itemId);this.loadIcon(this.itemIcon,"act_loopy_card",b[this.itemId]),1==this.operateType?(this.msgTip.string=GetLanguage(200787),this.itemName.string=c.formatStrWithMirrorDeal(GetLanguage(200778),e.name)):(this.msgTip.string=GetLanguage(200789),this.itemName.string=c.formatStrWithMirrorDeal(GetLanguage(200779),e.name)),this.RefreshSelectItem(0)},l.onBeforeClose=function(){},l.onDestroy=function(){},l.RefreshScroll=function(e){void 0===e&&(e=null);var t=[];if(0==this.curIndex){var i;if(""==this.editBox.string)t=IS(C).GetListByType(v.FriendRecommend);else t=null!=(i=e)?i:[];this.editBox.string=""}else if(1==this.curIndex)t=IS(C).GetListByType(v.FriendList);else if(2==this.curIndex){var n=[],o=IS(I).GetMemberList();for(var a in o)if(o.hasOwnProperty(a)){var s=o[a];s.role_id!=IS(L).GetRoleAttr(_.ROLE_ATTR_ID)&&n.push(s)}n.sort((function(e,t){return e.donate_week!=t.donate_week?t.donate_week-e.donate_week:e.is_online==t.is_online?0==e.is_online&&e.offline_time!=t.offline_time?t.offline_time-e.offline_time:e.career!=t.career?IS(I).CompareCareer(e.career,t.career):e.role_id-t.role_id:0==e.is_online?1:-1}));for(var r=0;r<n.length;r++){var d=n[r];t.push({role_id:d.role_id,name:d.role_name,head:d.role_head,is_online:d.is_online,offline_time:d.offline_time})}}this.scrollView.datas=t},l.updateTask=function(){},i}(B));var F=function(e){function i(){for(var t,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(t=e.call.apply(e,[this].concat(n))||this).name=void 0,t.time=void 0,t.btn=void 0,t.btnTxt=void 0,t.imgHeadFrame=void 0,t.headImg=void 0,t.operateType=void 0,t}t(i,e);var s=i.prototype;return s.onInit=function(){var e=this;this.name=h.findChildComponent(this.node,"name",o),this.time=h.findChildComponent(this.node,"time",o),this.btnTxt=h.findChildComponent(this.node,"btn/Label",o),this.btn=h.findChild(this.node,"btn"),this.view.addComponentCallbackListener(this.btn,n.EventType.CLICK,(function(){var t=IS(S).getCollectInfo(G.LoopyCard),i=e.view.itemId,n=configGoods.getDataByKey(i);if(1==e.operateType){if(IS(m).getGoodsCountByGoodsGtid(i)<=0)return void u.showFlyTip(GetLanguage(200748));var o=configCollect_cards.getDataByKey(G.LoopyCard).gift_live_time,a=c.formatStrWithMirrorDeal(GetLanguage(200756),e.data.name,n.name,Math.floor(o/3600));u.showBoxTip({tip:a,title:GetLanguage(200048),func:function(t){var n;"type_yes"==t&&IS(T).send_collect_send(G.LoopyCard,i,0,null!=(n=e.data.role_id)?n:e.data.belong_id,0)}})}else{var s;if((null!=(s=t.recv_times)?s:0)<=0)return void u.showFlyTip(GetLanguage(204418));var r=c.formatStrWithMirrorDeal(GetLanguage(200757),e.data.name,n.name);u.showBoxTip({tip:r,title:GetLanguage(200048),func:function(t){var n;"type_yes"==t&&IS(T).send_collect_ask(G.LoopyCard,i,1,null!=(n=e.data.role_id)?n:e.data.belong_id)}})}})),this.imgHeadFrame=h.findChildComponent(this.node,"head/imgHeadFrame",a),this.headImg=h.findChildComponent(this.node,"head/image",a)},s.onRender=function(e,t){this.operateType=this.view.operateType,this.name.string=e.name;var i=e.head.frame_id;if(1==this.operateType?this.btnTxt.string=GetLanguage(200795):this.btnTxt.string=GetLanguage(200796),i>0){this.imgHeadFrame.node.active=!0;var n=configAvatar_frame.getDataByKey(i);this.view.loadIcon(this.imgHeadFrame,"icon_frame",n.icon)}else this.imgHeadFrame.node.active=!1;this.view.loadRemoteIcon(e.head.url,this.headImg),this.time.string=0==e.is_online?f.getDateDiff(e.offline_time)+GetLanguage(200171):GetLanguage(200057)},i}(l);i._RF.pop()}}}));

