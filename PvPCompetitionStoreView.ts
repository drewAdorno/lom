System.register("chunks:///_virtual/PvPCompetitionStoreView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./index57.ts","./BagDefine.ts","./BagModel.ts","./MessageView.ts","./MallControl.ts","./MallDataCache.ts","./MallDefine.ts","./BaseView.ts"],(function(t){"use strict";var i,e,n,o,s,a,r,h,d,l,u,c,m,f,v,p,C,g,I,L,y,T;return{setters:[function(t){i=t.inheritsLoose,e=t.createForOfIteratorHelperLoose},function(t){n=t.cclegacy,o=t.Button,s=t.ScrollView,a=t.UITransform,r=t.Label,h=t.Vec3,d=t.Sprite,l=t.RichText},function(t){u=t.ItemGrid},function(t){c=t.ListItem},function(t){m=t.default},function(t){f=t.default},null,function(t){v=t.BagEventDefine},function(t){p=t.BagModel},function(t){C=t.default},function(t){g=t.default},function(t){I=t.default},function(t){L=t.MallEventDefine,y=t.MallType},function(t){T=t.BaseView}],execute:function(){n._RF.push({},"538aaBtzJRE7JoAVt7p8BO4","PvPCompetitionStoreView",void 0);var w=[12],S=(t("default",function(t){function n(){var i;return(i=t.call(this)||this).scroll=void 0,i.time=0,i.nodeResParent=void 0,i.nodeResItem=void 0,i.resItems=void 0,i.name="PvPCompetitionStoreView",i.url="ui/module/pvp/PvPCompetitionStoreView",i}i(n,t);var a=n.prototype;return a.onInit=function(){var t=this,i=this.findChild("imgMask");this.addComponentCallbackListener(i,o.EventType.CLICK,(function(){t.close()}));var e=this.findChild("view/btnClose");this.addComponentCallbackListener(e,o.EventType.CLICK,(function(){t.close()}));var n=this.findChildComponent("view/scrollList",s);this.scroll=this.addUIList(n,S,!0,0),this.initResShow()},a.initResShow=function(){var t=this;this.nodeResParent=this.findChild("resRoot"),this.nodeResItem=this.findChild("resRoot/resItem"),this.nodeResItem.active=!1,this.resItems=new Array;for(var i=function(i){var e=nodeInstantiate.instantiate(t.nodeResItem),n=w[i];t.addComponentCallbackListener(e,o.EventType.CLICK,(function(){var t=m.findChild(e,"txtNum");IS(p).OpenItemTips(n,t)})),e.parent=t.nodeResParent,e.active=!0;var s=m.findChildComponent(e,"imgIcon",d),a=configGoods.getDataByKey(n);t.loadIcon(s,"icon_item",a.icon),t.resItems.push({node:e,txtNum:m.findChildComponent(e,"txtNum",r),goodsGtid:n})},e=0;e<w.length;e++)i(e)},a.registerUpdateHandler=function(){this.addEvent(L.MAll_INFO_UPDATE,this.updateInfo,this),this.addEvent(v.GOODS_INFO_UPDATE,this.updateResShow,this)},a.onAfterOpen=function(){this.updateResShow(),IS(g).send_27_1(y.PvpCompetitionDay),IS(g).send_27_1(y.PvpCompetitionWeek);for(var t=[],i=[{type:y.PvpCompetitionDay,name:GetLanguage(200369)},{type:y.PvpCompetitionWeek,name:GetLanguage(200370)}],n=0;n<i.length;n++){var o=configMall.getDataByList("type",i[n].type);if(o){t.push({type:1,name:i[n].name});for(var s,a=[],r=e(o);!(s=r()).done;){var h=s.value;a.push(h)}a.sort((function(t,i){return t.sort-i.sort}));for(var d=[],l=0;l<a.length;l++)d.push(a[l]),2!=d.length&&l!=a.length-1||(t.push({type:2,list:d}),d=[])}}this.scroll.datas=t,this.scroll.scrollView.scrollToTop()},a.onBeforeClose=function(){},a.onDestroy=function(){for(var t=0;t<this.resItems.length;t++)this.resItems[t].node.destroy();this.resItems={}},a.updateResShow=function(){for(var t=0;t<this.resItems.length;t++)this.resItems[t].txtNum.string=f.GetNumString(IS(p).getGoodsCountByGoodsGtid(this.resItems[t].goodsGtid))},a.updateInfo=function(){this.scroll.updateAll()},n}(T)),function(t){function e(){for(var i,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(i=t.call.apply(t,[this].concat(n))||this).txtTitle=void 0,i.topLine=void 0,i.titleTrans=void 0,i.itemListTrans=void 0,i.itemList=[],i}i(e,t);var n=e.prototype;return n.onInit=function(){this.adaptiveSize=!0,this.topLine=m.findChild(this.node,"title/topLine"),this.titleTrans=m.findChildComponent(this.node,"title",a),this.txtTitle=m.findChildComponent(this.node,"title/Label",r),this.itemListTrans=m.findChildComponent(this.node,"itemList",a);for(var t=0;t<2;t++){var i=new B;i.onInit(this.view,m.findChild(this.node,"itemList/item"+(t+1))),this.itemList.push(i)}},n.onRender=function(t,i){if(1==t.type){var e=this.titleTrans.height;if(this.topLine.active=i>0,0==i){e-=30;var n=this.titleTrans.node.position;this.titleTrans.node.position=new h(n.x,22,0)}else this.titleTrans.node.position=h.ZERO;this.titleTrans.node.active=!0,this.itemListTrans.node.active=!1,this.txtTitle.string=t.name,this.ut.height=e}else{this.titleTrans.node.active=!1,this.itemListTrans.node.active=!0,this.txtTitle.string=t.name,this.ut.height=this.itemListTrans.height;for(var o=0;o<2;o++)this.itemList[o].onRender(t.list[o])}},e}(c)),B=function(){function t(){this.node=void 0,this.view=void 0,this.data=void 0,this.txtName=void 0,this.txtPrice=void 0,this.priceIcon=void 0,this.btnBuy=void 0,this.out=void 0,this.limit=void 0,this.txtLimit=void 0,this.itemGrid=void 0,this.num=void 0}var i=t.prototype;return i.onInit=function(t,i){var e=this;this.node=i,this.view=t,this.txtPrice=m.findChildComponent(this.node,"btnBuy/Label",r),this.priceIcon=m.findChildComponent(this.node,"btnBuy/Label/icon",d),this.txtName=m.findChildComponent(this.node,"txtName",r),this.num=m.findChildComponent(this.node,"num",l),this.out=m.findChild(this.node,"out"),this.limit=m.findChild(this.node,"limit"),this.txtLimit=m.findChildComponent(this.node,"limit/Label",r),this.itemGrid=new u(this.view,m.findChild(this.node,"itemGrid")),this.btnBuy=m.findChild(this.node,"btnBuy"),this.view.addComponentCallbackListener(this.btnBuy,o.EventType.CLICK,(function(){e.out.active?C.showFlyTip(GetLanguage(200039)):e.limit.active?C.showFlyTip(GetLanguage(200371)):uiMgr.openView("MallTipsView",e.data)}))},i.onRender=function(t,i){if(this.data=t,t){this.node.active=!0,this.txtName.string=t.name;var e=configGoods.getDataByKey(t.price[0]);this.txtPrice.string=t.price[1],this.view.loadIcon(this.priceIcon,"icon_item",e.icon),this.itemGrid.SetItemId(t.goods[0],t.goods[1]);var n=IS(I).GetBuyInfoByType(t.type);if(-1!=t.limit){var o;this.num.node.active=!0;var s=null!=(o=n[t.id])?o:0;s>=t.limit?(this.out.active=!0,this.num.string=f.formatStrWithMirrorDeal(GetLanguage(200373),t.limit-s,t.limit)):(this.out.active=!1,this.num.string=f.formatStrWithMirrorDeal(GetLanguage(200374),t.limit-s,t.limit))}else this.num.node.active=!1}else this.node.active=!1},t}();n._RF.pop()}}}));

