System.register("chunks:///_virtual/RobCasePassView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./ConfigGlobal.ts","./ObjectUtil.ts","./BagDefine.ts","./BagModel.ts","./BattlePassControl.ts","./BattlePassDataCache.ts","./BattlePassDefine.ts","./MessageView.ts","./PayDataCache.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./BaseView.ts"],(function(t){"use strict";var e,i,s,n,o,a,r,d,l,h,c,v,f,u,g,m,p,w,C,I,x,y,b,_,G,S,P,B,L,R,T,D,E;return{setters:[function(t){e=t.inheritsLoose,i=t.createForOfIteratorHelperLoose},function(t){s=t.cclegacy,n=t.Button,o=t.Label,a=t.ScrollView,r=t.UITransform,d=t.Node,l=t.Vec3,h=t.ProgressBar,c=t.js,v=t.Sprite,f=t.RichText},function(t){u=t.ItemGrid},function(t){g=t.ListItem},function(t){m=t.default},function(t){p=t.default},function(t){w=t.default},null,function(t){C=t.ConfigGlobal},function(t){I=t.default},function(t){x=t.ItemIdDefine,y=t.BagEventDefine},function(t){b=t.BagModel},function(t){_=t.default},function(t){G=t.BattlePassDataCache},function(t){S=t.BattlePassDefine},function(t){P=t.default},function(t){B=t.default},function(t){L=t.default},function(t){R=t.ActivityType,T=t.ActivityEventDefine,D=t.ActivityState},function(t){E=t.BaseView}],execute:function(){s._RF.push({},"44967xf1XZNeYupf6eTbPlh","RobCasePassView",void 0);var N=1153,k=(t("default",function(t){function s(){var e;return(e=t.call(this)||this).btnRed=void 0,e.txtNum=void 0,e.txtNumReward=void 0,e.numScroll=void 0,e.scroll=void 0,e.txtPrice=void 0,e.btnBuy=void 0,e.txtPrice2=void 0,e.btnBuy2=void 0,e.curPassId=0,e.passInfo=void 0,e.lineScrollContent=void 0,e.numScrollContent=void 0,e.lineScrollProgress=void 0,e.numScrollList=void 0,e.rewardScore=[],e.isFirstReceived=!1,e.frontRewardIndex=1e3,e.txtLeftTime=void 0,e.txtTimeDesc=void 0,e.deltaTime=0,e.leftTime=0,e.canUpdate=!1,e.name="RobCasePassView",e.url="ui/module/robcase/RobCasePassView",e}e(s,t);var v=s.prototype;return v.onInit=function(){var t=this,e=this.findChild("view/imgBg/btnClose");this.addComponentCallbackListener(e,n.EventType.CLICK,(function(){t.close()})),this.txtNum=this.findChildComponent("view/imgBg/banner/num/num",o),this.btnRed=this.findChild("view/imgBg/banner/btnSend/red");var i=this.findChild("view/imgBg/banner/btnSend");this.addComponentCallbackListener(i,n.EventType.CLICK,(function(){uiMgr.openView("RobCasePassUseView",N)})),this.txtPrice=this.findChildComponent("view/imgBg/scroll/titleHigh/btnBuy/Label",o),this.btnBuy=this.findChild("view/imgBg/scroll/titleHigh/btnBuy"),this.addComponentCallbackListener(this.btnBuy,n.EventType.CLICK,(function(){var e=configWartoken.getDataByKey(t.curPassId),i=configPay_mall.getDataByKey(e.bundle_id);IS(b).getGoodsCountByGoodsGtid(x.FakeRechare)>=i.price?uiMgr.openView("RobCasePassBuyView",R.RobCasePass,1):IS(B).Pay(e.bundle_id)})),this.txtPrice2=this.findChildComponent("view/imgBg/scroll/titleHigh2/btnBuy/Label",o),this.btnBuy2=this.findChild("view/imgBg/scroll/titleHigh2/btnBuy"),this.addComponentCallbackListener(this.btnBuy2,n.EventType.CLICK,(function(){var e=configWartoken.getDataByKey(t.curPassId),i=configPay_mall.getDataByKey(e.bundle_id2);IS(b).getGoodsCountByGoodsGtid(x.FakeRechare)>=i.price?uiMgr.openView("RobCasePassBuyView",R.RobCasePass,2):IS(B).Pay(e.bundle_id2)}));var s=this.findChildComponent("view/imgBg/scroll",a);this.scroll=this.addUIList(s,k,!0,0),this.txtNumReward=this.findChildComponent("view/imgBg/numReward/num",o);var c=this.findChildComponent("view/imgBg/numReward/ScrollView",a);this.numScroll=this.addUIList(c,A),this.lineScrollContent=this.findChildComponent("view/imgBg/numReward/lineScroll/content",r),this.numScrollContent=this.findChild("view/imgBg/numReward/ScrollView/view/content"),this.addComponentCallbackListener(this.numScrollContent,d.EventType.TRANSFORM_CHANGED,(function(e){e&d.TransformBit.POSITION&&(t.lineScrollContent.node.position=new l(t.numScrollContent.position.x,0,0))})),this.lineScrollProgress=this.findChildComponent("view/imgBg/numReward/lineScroll/content/ProgressBar",h),this.txtTimeDesc=this.findChildComponent("view/imgBg/nodeTime/txtDesc",o),this.txtLeftTime=this.findChildComponent("view/imgBg/nodeTime/txtTime",o)},v.registerUpdateHandler=function(){this.addEvent(S.BATTLE_PASS_INFO_UPDATE,this.updateBattlePass,this),this.addEvent(y.GOODS_INFO_UPDATE,this.onBagUpdate,this),this.addEvent(T.OnActivityInfoUpdate,this.updateActInfo,this)},v.onAfterOpen=function(){var t,e=this;this.isFirstReceived=!1,this.frontRewardIndex=1e3;var s=IS(L).GetActivityInfo(R.RobCasePass);if(s){var n,o=null!=(n=s.state_time[s.state])?n:s.state_time[D.Open];if(this.leftTime=o.end_time-w.serverTime,this.leftTime>0){var a="";s.state==D.Preview?a=GetLanguage(200763):s.state==D.Open?a=GetLanguage(200764):s.state==D.EndShow&&(a=GetLanguage(200765)),this.txtTimeDesc.string=a,this.canUpdate=!0,this.txtLeftTime.string=c.formatStr("%s",w.formatTimeStringForSecond(this.leftTime))}else this.txtLeftTime.string=GetLanguage(200026)}else this.txtTimeDesc.string=GetLanguage(200765),this.txtLeftTime.string=GetLanguage(200026);if(this.curPassId=s.roundCfg.group_id,this.passInfo=IS(G).getPassInfo(this.curPassId),this.passInfo){if(this.passInfo){this.btnBuy.active=!this.passInfo.if_buy,this.btnBuy2.active=!this.passInfo.if_buy_2;var r=configPay_mall.getDataByKey(this.passInfo.bundle_id);this.txtPrice.string=IS(B).GetPriceString(r.cost_level);var d=configPay_mall.getDataByKey(configWartoken.getDataByKey(this.curPassId).bundle_id2);this.txtPrice2.string=IS(B).GetPriceString(d.cost_level),this.txtNumReward.string=this.passInfo.total_exp}else this.btnBuy.active=!0,this.btnBuy2.active=!0;var l=I.copyArray(null!=(t=configWartoken_reward.getDataByList("id",this.curPassId))?t:[]);l.sort((function(t,e){return t.level-e.level}));l.length;var h=0;this.rewardScore[1]=0;for(var v=0;v<l.length;v++){var f=l[v];f&&(h+=f.exp,this.rewardScore[f.level+1]=h)}l.push({level:l[l.length-1].level+1}),this.scroll.setCustomItemsSize(l,(function(t){return l[t].level<=e.passInfo.max_lev?110:160}),!0),this.scroll.datas=l;for(var u,g=C.autumn_panghong_gift,m=i(g);!(u=m()).done;){var p=u.value;if(p[0]==this.curPassId){this.numScrollList=p[1],this.numScroll.datas=p[1];break}}for(var x=0,y=0;y<this.numScrollList.length;y++){var _;(null!=(_=this.passInfo.total_exp)?_:0)>=this.numScrollList[y][1]&&x++}this.lineScrollContent.width=80*this.numScrollList.length+40*(this.numScrollList.length-1)+42,this.lineScrollProgress.totalLength=this.lineScrollContent.width-3;var S=0;x>0&&(S=80*x+40*(x-1)+42-3),this.lineScrollProgress.progress=S/this.lineScrollProgress.totalLength,this.txtNum.string="x"+IS(b).getGoodsCountByGoodsGtid(N),this.btnRed.active=IS(b).getGoodsCountByGoodsGtid(N)>0}},v.onBeforeClose=function(){},v.onDestroy=function(){},v.onUpdate=function(t){this.canUpdate&&(this.deltaTime=this.deltaTime+t,this.deltaTime>=1&&(this.deltaTime=0,this.leftTime=this.leftTime-1,this.leftTime>0?this.txtLeftTime.string=c.formatStr("%s",w.formatTimeStringForSecond(this.leftTime)):(this.txtLeftTime.string=GetLanguage(200026),this.canUpdate=!1)))},v.updateActInfo=function(t){if(t.type==R.RobCasePass&&t.state!=D.Null){var e,i=null!=(e=t.state_time[t.state])?e:t.state_time[D.Open];if(this.leftTime=i.end_time-w.serverTime,this.leftTime>0){var s="";t.state==D.Preview?s=GetLanguage(200763):t.state==D.Open?s=GetLanguage(200764):t.state==D.EndShow&&(s=GetLanguage(200765)),this.txtTimeDesc.string=s,this.canUpdate=!0,this.txtLeftTime.string=c.formatStr("%s",w.formatTimeStringForSecond(this.leftTime))}else this.txtLeftTime.string=GetLanguage(200026)}},v.onBagUpdate=function(t,e){e==N&&(this.txtNum.string="x"+IS(b).getGoodsCountByGoodsGtid(N),this.btnRed.active=IS(b).getGoodsCountByGoodsGtid(N)>0)},v.updateBattlePass=function(){if(this.passInfo=IS(G).getPassInfo(this.curPassId),this.passInfo){this.btnBuy.active=!this.passInfo.if_buy,this.btnBuy2.active=!this.passInfo.if_buy_2;var t=configPay_mall.getDataByKey(this.passInfo.bundle_id);this.txtPrice.string=IS(B).GetPriceString(t.cost_level);var e=configPay_mall.getDataByKey(configWartoken.getDataByKey(this.curPassId).bundle_id2);this.txtPrice2.string=IS(B).GetPriceString(e.cost_level),this.txtNumReward.string=this.passInfo.total_exp}else this.btnBuy.active=!0,this.btnBuy2.active=!0;this.scroll.updateAll(),this.numScroll.updateAll();for(var i=0,s=0;s<this.numScrollList.length;s++){var n;(null!=(n=this.passInfo.total_exp)?n:0)>=this.numScrollList[s][1]&&i++}var o=0;i>0&&(o=80*i+40*(i-1)+42-3),this.lineScrollProgress.progress=o/this.lineScrollProgress.totalLength},s}(E)),function(t){function s(){for(var e,i=arguments.length,s=new Array(i),n=0;n<i;n++)s[n]=arguments[n];return(e=t.call.apply(t,[this].concat(s))||this).state1=void 0,e.state2=void 0,e.scrollNormal=void 0,e.scrollHigh=void 0,e.scrollHigh2=void 0,e.lockNode=void 0,e.lockNode2=void 0,e.txtLev=void 0,e.imgLev=void 0,e.pbExp=void 0,e.boxDesc=void 0,e.boxCount=void 0,e.boxExp=void 0,e.boxPb=void 0,e.boxImg=void 0,e}e(s,t);var r=s.prototype;return r.onInit=function(){var t=this;this.state1=m.findChild(this.node,"state1"),this.state2=m.findChild(this.node,"state2"),this.lockNode=m.findChild(this.node,"state1/high/lock"),this.lockNode2=m.findChild(this.node,"state1/high2/lock"),this.imgLev=m.findChildComponent(this.node,"state1/pbExp/icon",v),this.txtLev=m.findChildComponent(this.node,"state1/pbExp/icon/txtLabel",o),this.pbExp=m.findChildComponent(this.node,"state1/pbExp",h);var e=m.findChildComponent(this.node,"state1/normal/scroll",a);this.scrollNormal=this.view.addUIList(e,K,!1,0),this.scrollNormal.touchEvent=!1,this.scrollNormal.lackCenter=!0;var i=m.findChildComponent(this.node,"state1/high/scroll",a);this.scrollHigh=this.view.addUIList(i,U,!1,0),this.scrollHigh.touchEvent=!1,this.scrollHigh.lackCenter=!0;var s=m.findChildComponent(this.node,"state1/high2/scroll",a);this.scrollHigh2=this.view.addUIList(s,V,!1,0),this.scrollHigh2.touchEvent=!1,this.scrollHigh2.lackCenter=!0,this.boxDesc=m.findChildComponent(this.node,"state2/imgExtBG/Label",o),this.boxCount=m.findChildComponent(this.node,"state2/txtExtCount",o),this.boxExp=m.findChildComponent(this.node,"state2/pbExperience/txtExtExp",o),this.boxPb=m.findChildComponent(this.node,"state2/pbExperience",h),this.boxImg=m.findChildComponent(this.node,"state2/imgBox",v),this.view.addComponentCallbackListener(this.boxImg.node,n.EventType.CLICK,(function(){t.onGetExtReward()}));var r=m.findChild(this.node,"state1/high/lock/btnLock");this.view.addComponentCallbackListener(r,n.EventType.CLICK,(function(){var e=configWartoken.getDataByKey(t.view.curPassId),i=configPay_mall.getDataByKey(e.bundle_id);IS(b).getGoodsCountByGoodsGtid(x.FakeRechare)>=i.price?uiMgr.openView("RobCasePassBuyView",R.RobCasePass,1):IS(B).Pay(e.bundle_id)}));var d=m.findChild(this.node,"state1/high/lock/mask");this.view.addComponentCallbackListener(d,n.EventType.CLICK,(function(){var e=configWartoken.getDataByKey(t.view.curPassId),i=configPay_mall.getDataByKey(e.bundle_id);IS(b).getGoodsCountByGoodsGtid(x.FakeRechare)>=i.price?uiMgr.openView("RobCasePassBuyView",R.RobCasePass,1):IS(B).Pay(e.bundle_id)}));var l=m.findChild(this.node,"state1/high2/lock/btnLock");this.view.addComponentCallbackListener(l,n.EventType.CLICK,(function(){var e=configWartoken.getDataByKey(t.view.curPassId),i=configPay_mall.getDataByKey(e.bundle_id2);IS(b).getGoodsCountByGoodsGtid(x.FakeRechare)>=i.price?uiMgr.openView("RobCasePassBuyView",R.RobCasePass,2):IS(B).Pay(e.bundle_id2)}));var c=m.findChild(this.node,"state1/high2/lock/mask");this.view.addComponentCallbackListener(c,n.EventType.CLICK,(function(){var e=configWartoken.getDataByKey(t.view.curPassId),i=configPay_mall.getDataByKey(e.bundle_id2);IS(b).getGoodsCountByGoodsGtid(x.FakeRechare)>=i.price?uiMgr.openView("RobCasePassBuyView",R.RobCasePass,2):IS(B).Pay(e.bundle_id2)}))},r.onRender=function(t,e){var i=this.view.passInfo;i&&t.level>i.max_lev?(this.state1.active=!1,this.state2.active=!0,this.showBox()):(this.state1.active=!0,this.state2.active=!1,this.showLev())},r.showLev=function(){var t=this,e=this.view.passInfo,s=this.data;if(this.txtLev.string=this.view.rewardScore[s.level],this.lockNode.active=!!e&&!e.if_buy,this.lockNode2.active=!!e&&!e.if_buy_2,e){var n,o,a=null!=(n=null==(o=configWartoken_reward.getDataByKeys("id",e.id,"level",e.lev))?void 0:o.exp)?n:e.need_exp;0==a?this.pbExp.progress=1:s.level==e.lev+1?this.pbExp.progress=e.exp/a-.5:s.level==e.lev?this.pbExp.progress=.5+e.exp/a:s.level<e.lev?this.pbExp.progress=1:this.pbExp.progress=0}else this.pbExp.progress=0;for(var r,d=[],l=i(s.reward);!(r=l()).done;){var h=r.value;d.push({id:s.id,lev:s.level,rewrad:h})}this.scrollNormal.datas=d;for(var c,v=[],f=i(s.high_reward);!(c=f()).done;){var u=c.value;v.push({id:s.id,lev:s.level,rewrad:u})}this.scrollHigh.datas=v;for(var g,m=[],p=i(s.middle_reward);!(g=p()).done;){var w=g.value;m.push({id:s.id,lev:s.level,rewrad:w})}this.scrollHigh2.datas=m,this.view.addTimer(.2,0,(function(){console.error("最先可领奖index：",t.view.frontRewardIndex),t.view.frontRewardIndex<1e3&&t.view.frontRewardIndex>0&&(t.view.scroll.scrollTo(t.view.frontRewardIndex),t.view.frontRewardIndex=-1)}))},r.showBox=function(){var t=this.view.passInfo;this.boxDesc.string=p.formatStr(GetLanguage(201750),this.view.rewardScore[t.max_lev],GetLanguage(104405),t.extra_need_exp,GetLanguage(104405),t.extra_max_times),this.boxCount.string="("+t.extra_times+"/"+t.extra_max_times+")",t.lev<t.max_lev?(this.boxExp.string="0/"+t.extra_need_exp,this.boxPb.progress=0):(this.boxImg.grayscale=t.exp<t.extra_need_exp,this.boxExp.string=t.exp+"/"+t.extra_need_exp,this.boxPb.progress=t.exp/t.extra_need_exp)},r.onGetExtReward=function(){var t=this.view.passInfo;t.extra_times>=t.extra_max_times?P.showFlyTip(GetLanguage(200030)):t.lev>=t.max_lev&&t.exp>=t.extra_need_exp?t.if_buy?1==this.view.curPassId?IS(_).reqBattlePassExtReward():IS(_).send_40_6(this.view.curPassId):P.showFlyTip(p.formatStrWithMirrorDeal(GetLanguage(201062),GetLanguage(104407))):P.showFlyTip(GetLanguage(200032))},s}(g)),K=function(t){function i(){for(var e,i=arguments.length,s=new Array(i),n=0;n<i;n++)s[n]=arguments[n];return(e=t.call.apply(t,[this].concat(s))||this).canGet=void 0,e.received=void 0,e.itemGridNode=void 0,e.itemGrid=void 0,e}e(i,t);var s=i.prototype;return s.onInit=function(){var t=this;this.canGet=m.findChild(this.node,"canGet"),this.received=m.findChild(this.node,"received"),this.itemGridNode=m.findChild(this.node,"itemGrid"),this.itemGrid=new u(this.view,this.itemGridNode,(function(){t.canGet.active?IS(_).send_40_5(t.view.curPassId,t.data.lev,3):IS(b).OpenItemTips(t.data.rewrad[0],t.node)}))},s.onRender=function(t,e){var i;this.itemGrid.SetItemId(t.rewrad[0],t.rewrad[1]);var s=null==(i=this.view.passInfo)?void 0:i.free_reward[t.lev-1].status;this.canGet.active=1==s,this.received.active=2==s,1==s&&t.lev-1<this.view.frontRewardIndex&&(this.view.frontRewardIndex=t.lev-1)},i}(g),U=function(t){function i(){for(var e,i=arguments.length,s=new Array(i),n=0;n<i;n++)s[n]=arguments[n];return(e=t.call.apply(t,[this].concat(s))||this).canGet=void 0,e.received=void 0,e.itemGridNode=void 0,e.itemGrid=void 0,e}e(i,t);var s=i.prototype;return s.onInit=function(){var t=this;this.canGet=m.findChild(this.node,"canGet"),this.received=m.findChild(this.node,"received"),this.itemGridNode=m.findChild(this.node,"itemGrid"),this.itemGrid=new u(this.view,this.itemGridNode,(function(){t.canGet.active?IS(_).send_40_5(t.view.curPassId,t.data.lev,3):IS(b).OpenItemTips(t.data.rewrad[0],t.node)}))},s.onRender=function(t,e){var i,s,n;this.itemGrid.SetItemId(t.rewrad[0],t.rewrad[1]);var o=null==(i=this.view.passInfo)?void 0:i.high_reward[t.lev-1].status;this.canGet.active=(null==(s=this.view.passInfo)?void 0:s.if_buy)&&1==o,this.received.active=(null==(n=this.view.passInfo)?void 0:n.if_buy)&&2==o,1==o&&t.lev-1<this.view.frontRewardIndex&&(this.view.frontRewardIndex=t.lev-1)},i}(g),V=function(t){function i(){for(var e,i=arguments.length,s=new Array(i),n=0;n<i;n++)s[n]=arguments[n];return(e=t.call.apply(t,[this].concat(s))||this).canGet=void 0,e.received=void 0,e.itemGridNode=void 0,e.itemGrid=void 0,e}e(i,t);var s=i.prototype;return s.onInit=function(){var t=this;this.canGet=m.findChild(this.node,"canGet"),this.received=m.findChild(this.node,"received"),this.itemGridNode=m.findChild(this.node,"itemGrid"),this.itemGrid=new u(this.view,this.itemGridNode,(function(){t.canGet.active?IS(_).send_40_5(t.view.curPassId,t.data.lev,3):IS(b).OpenItemTips(t.data.rewrad[0],t.node)}))},s.onRender=function(t,e){var i,s,n,o,a;this.itemGrid.SetItemId(t.rewrad[0],t.rewrad[1]);var r=null!=(i=null==(s=this.view.passInfo)||null==(n=s.high_reward_2[t.lev-1])?void 0:n.status)?i:0;this.canGet.active=(null==(o=this.view.passInfo)?void 0:o.if_buy_2)&&1==r,this.received.active=(null==(a=this.view.passInfo)?void 0:a.if_buy_2)&&2==r,1==r&&t.lev-1<this.view.frontRewardIndex&&(this.view.frontRewardIndex=t.lev-1)},i}(g),A=function(t){function i(){for(var e,i=arguments.length,s=new Array(i),n=0;n<i;n++)s[n]=arguments[n];return(e=t.call.apply(t,[this].concat(s))||this).txtDesc=void 0,e.itemGridNode=void 0,e.effNode=void 0,e.isReward=void 0,e.itemGrid=void 0,e.isRewardNode=void 0,e.eff=void 0,e}e(i,t);var s=i.prototype;return s.onInit=function(){var t=this;this.txtDesc=m.findChildComponent(this.node,"desc",f),this.itemGridNode=m.findChild(this.node,"itemGrid"),this.effNode=m.findChild(this.node,"eff"),this.isRewardNode=m.findChild(this.node,"isReward"),this.itemGrid=new u(this.view,this.itemGridNode,(function(){var e,i,s=null!=(e=null==(i=t.view)?void 0:i.passInfo.total_exp)?e:0;!t.isReward&&s>=t.data[1]?IS(_).send_40_8(t.view.curPassId,t.data[0]):IS(b).OpenItemTips(t.data[2][0],t.itemGridNode)}))},s.onRender=function(t,e){var i,s,n,o=t[2];this.itemGrid.SetItemId(o[0],o[1]);var a=null!=(i=null==(s=this.view)?void 0:s.passInfo.total_exp)?i:0,r=t[1];this.isReward=null==(n=this.view)?void 0:n.passInfo.specialReward[t[0]],this.view.removeUIEffect(this.eff),this.isReward?(this.isRewardNode.active=!0,this.txtDesc.string=c.formatStr("<outline color=#21150f width=2><color=#ffffff>%s</color></outline>",GetLanguage(200314))):a>=r?(this.isRewardNode.active=!1,this.txtDesc.string=c.formatStr("<outline color=#21150f width=2><color=#ffffff>%s</color></outline>",GetLanguage(200732)),this.eff=this.view.addUIEffect("prefab/ui-effect/MX_tx_tongyong_daojulingqu",this.effNode,-1),0==e?this.view.isFirstReceived=!0:this.view.isFirstReceived||this.view.numScroll.scrollTo(1)):(this.isRewardNode.active=!1,this.txtDesc.string=c.formatStr("<b><outline color=#21150f width=2><color=#ff1c1c>%s</color><color=#ffffff>/%s</color></outline></b>",a,r))},i}(g);s._RF.pop()}}}));

