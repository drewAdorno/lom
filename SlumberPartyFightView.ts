System.register("chunks:///_virtual/SlumberPartyFightView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./V2.ts","./AudioMgr.ts","./index3.ts","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./SpineSkeleton.ts","./UIEffectAsset.ts","./ConfigGlobal.ts","./MulLanguageUtil.ts","./BagDefine.ts","./BagModel.ts","./MessageView.ts","./RoleDefine.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./SlumberPartyControl.ts","./SlumberPartyDataCache.ts","./EaseMethod.ts","./BaseView.ts"],(function(t){"use strict";var i,e,n,o,s,r,a,d,h,l,f,c,u,m,p,v,g,w,y,I,S,C,T,b,x,G,_,R,L,A,B,E,F,D,U;return{setters:[function(t){i=t.inheritsLoose},function(t){e=t.cclegacy,n=t.Button,o=t.Label,s=t.Sprite,r=t.RichText,a=t.HorizontalTextAlignment,d=t.ScrollView,h=t.ProgressBar,l=t.UITransform,f=t.js,c=t.Vec3},function(t){u=t.V2},function(t){m=t.audioMgr},null,function(t){p=t.ItemGrid},function(t){v=t.ListItem},function(t){g=t.default},function(t){w=t.default},function(t){y=t.default},null,function(t){I=t.SpineSkeleton},function(t){S=t.UIEffectAsset},function(t){C=t.ConfigGlobal},function(t){T=t.default},function(t){b=t.BagEventDefine},function(t){x=t.BagModel},function(t){G=t.default},function(t){_=t.RoleEventDefine},function(t){R=t.default},function(t){L=t.ActivityEventDefine,A=t.ActivityState,B=t.ActivityType},function(t){E=t.default},function(t){F=t.SlumberPartyDataCache},function(t){D=t.EasingMethod},function(t){U=t.BaseView}],execute:function(){e._RF.push({},"956ddw002hF37EmhfXCMeml","SlumberPartyFightView",void 0);t("default",function(t){function e(){var i;return(i=t.call(this)||this).actType=void 0,i.nodeResParent=void 0,i.nodeResItem=void 0,i.resItems=void 0,i.txtLeftTime=void 0,i.deltaTime=0,i.leftTime=0,i.canUpdate=!1,i.refreshTimer=void 0,i.flyTimer=void 0,i.iconTen=void 0,i.iconOne=void 0,i.txtOne=void 0,i.txtTen=void 0,i.pbBoss=void 0,i.txtProgress=void 0,i.txtLv=void 0,i.bossSpine=void 0,i.bossEffectID=0,i.BossIDSel=void 0,i.txtNumReward=void 0,i.numScroll=void 0,i.txtWinReward=void 0,i.winScroll=void 0,i.nodeFly=void 0,i.utFly=void 0,i.target=void 0,i.name="SlumberPartyFightView",i.url="ui/module/slumberparty/SlumberPartyFightView",i.actType=B.SlumberFight,i}i(e,t);var p=e.prototype;return p.onInit=function(){var t=this;this.initResShow();var i=this.findChild("view/btnClose");this.addComponentCallbackListener(i,n.EventType.CLICK,(function(){t.close()})),this.txtLeftTime=this.findChildComponent("view/top/nodeTime/txtTime",o),this.iconOne=this.findChildComponent("view/btnOne/icon",s),this.iconTen=this.findChildComponent("view/btnTen/icon",s),this.txtOne=this.findChildComponent("view/btnOne/num",r),this.txtTen=this.findChildComponent("view/btnTen/num",r);var e=this.findChild("view/btnOne");this.addComponentCallbackListener(e,n.EventType.CLICK,(function(){var i=IS(F).GetFightCost(t.actType),n=i[0],o=i[1];IS(x).getGoodsCountByGoodsGtid(n)>=o?(IS(E).send_24_20(t.actType,1),t.onAttack(1,e)):G.showFlyTip(GetLanguage(200088))}));var f=this.findChild("view/btnTen");this.addComponentCallbackListener(f,n.EventType.CLICK,(function(){var i=IS(F).GetFightCost(t.actType),e=i[0],n=10*i[1];IS(x).getGoodsCountByGoodsGtid(e)>=n?(IS(E).send_24_20(t.actType,10),t.clearTimer(t.flyTimer),t.flyTimer=t.addTimer(.1,10,(function(){t.onAttack(2,f)}))):G.showFlyTip(GetLanguage(200088))}));var c=this.findChild("view/top/btnTips");this.addComponentCallbackListener(c,n.EventType.CLICK,(function(){for(var i=C.LIMITED_RANK_SYSTEM_DETAILS,e="",n=0;n<i.length;n++)i[n][0]==t.actType&&(e=T.GetconfigLanguage_Text(i[n][1]).text);""!=e&&G.showBoxTip({tip:e,btnCnt:1,horizontalAlign:a.LEFT})})),this.txtNumReward=this.findChildComponent("view/numReward/num",o),this.numScroll=this.addUIList(this.findChildComponent("view/numReward/ScrollView",d),P),this.txtWinReward=this.findChildComponent("view/winReward/num",o),this.winScroll=this.addUIList(this.findChildComponent("view/winReward/ScrollView",d),N),this.pbBoss=this.findChildComponent("view/pbBoss",h),this.txtProgress=this.findChildComponent("view/pbBoss/txtProgress",o),this.txtLv=this.findChildComponent("view/txtLv",o),this.nodeFly=this.findChild("flyRoot"),this.utFly=this.nodeFly.getComponent(l),this.target=this.findChild("target");var u=IS(F).GetFightCost(this.actType),m=configGoods.getDataByKey(u[0]);this.loadIcon(this.iconOne,m.icon_group,m.icon),this.loadIcon(this.iconTen,m.icon_group,m.icon)},p.initResShow=function(){var t=this;this.nodeResParent=this.findChild("resRoot"),this.nodeResItem=this.findChild("resRoot/resItem"),this.nodeResItem.active=!1;var i=[IS(F).GetFightCost(this.actType)[0]];this.resItems=new Array;for(var e=function(e){var r=nodeInstantiate.instantiate(t.nodeResItem),a=i[e];t.addComponentCallbackListener(r,n.EventType.CLICK,(function(){IS(x).OpenItemTips(a,g.findChild(r,"txtNum"))})),r.parent=t.nodeResParent,r.active=!0;var d=g.findChildComponent(r,"imgIcon",s),h=configGoods.getDataByKey(a);t.loadIcon(d,"icon_item",h.icon),t.resItems.push({node:r,txtNum:g.findChildComponent(r,"txtNum",o),goodsGtid:a})},r=0;r<i.length;r++)e(r)},p.registerUpdateHandler=function(){this.addEvent(L.OnPartyFightInfoUpdate,this.updateInfo,this),this.addEvent(L.OnPartyFightAttack,this.updateInfo,this),this.addEvent(L.OnPartyFightRewardUpdate,this.updateRewardInfo,this),this.addEvent(b.GOODS_INFO_UPDATE,this.updateResShow,this),this.addEvent(_.ROLE_RES_UPDATE,this.updateResShow,this)},p.onAfterOpen=function(){var t,i=this;this.updateResShow(),IS(E).send_24_19(this.actType),this.clearTimer(this.refreshTimer),this.refreshTimer=this.addTimer(5,-1,(function(){IS(E).send_24_19(i.actType)})),this.refreshBossShow();var e=IS(R).GetActivityInfo(this.actType),n=null!=(t=e.state_time[e.state])?t:e.state_time[A.Open];this.leftTime=n.end_time-y.serverTime,this.leftTime>0?(this.canUpdate=!0,this.txtLeftTime.string=y.formatTimeStringForSecond(this.leftTime)):this.txtLeftTime.string=GetLanguage(14810206)},p.updateResShow=function(){for(var t=0;t<this.resItems.length;t++)this.resItems[t].txtNum.string=w.GetNumString(IS(x).getGoodsCountByGoodsGtid(this.resItems[t].goodsGtid));var i,e,n=IS(F).GetFightCost(this.actType),o=IS(x).getGoodsCountByGoodsGtid(n[0]);o>=n[1]?(e="#5aff42",i="#27720d"):(e="#ff1f1f",i="#891000"),this.txtOne.string=f.formatStr("<b><outline color=%s width=2><color=%s>%s<color></outline></b>",i,e,n[1]),o>=10*n[1]?(e="#5aff42",i="#27720d"):(e="#ff1f1f",i="#891000"),this.txtTen.string=f.formatStr("<b><outline color=%s width=2><color=%s>%s<color></outline></b>",i,e,10*n[1])},p.updateInfo=function(){this.updateBossInfo(),this.updateRewardInfo()},p.updateBossInfo=function(){var t=IS(F).getFightInfo();this.txtLv.string="Lev. "+t.lev,this.pbBoss.progress=t.hp/t.hp_max,this.txtProgress.string=t.hp+"/"+t.hp_max},p.updateRewardInfo=function(){var t=IS(F).getFightInfo(),i=t.score_list_self,e=[];for(var n in i)if(i.hasOwnProperty(n)){var o=i[n],s={id:n,status:o.status,reward:o.reward};e.push(s)}for(var r in this.numScroll.datas=e,e=[],i=t.score_list_serv)if(i.hasOwnProperty(r)){var a=i[r],d={id:r,status:a.status,reward:a.reward};e.push(d)}this.winScroll.datas=e,this.txtNumReward.string=t.times.toString(),this.txtWinReward.string=t.lev_succ.toString(),this.numScroll.updateAll(),this.winScroll.updateAll()},p.onBeforeClose=function(){this.canUpdate=!1,this.clearTimer(this.refreshTimer),normalEvent.emit(L.OnPartyFightInfoUpdate)},p.onDestroy=function(){},p.onUpdate=function(t){this.canUpdate&&(this.deltaTime=this.deltaTime+t,this.deltaTime>=1&&(this.deltaTime=0,this.leftTime=this.leftTime-1,this.leftTime>0?this.txtLeftTime.string=y.formatTimeStringForSecond(this.leftTime):(this.txtLeftTime.string=GetLanguage(14810206),this.canUpdate=!1)))},p.refreshBossShow=function(){var t=this.findChild("view/bossRoot/icon");this.removeUIEffect(this.bossEffectID);var i=IS(R).GetActivityInfo(this.actType),e=configActivity_boss.getDataByKeys("type",this.actType,"group_id",i.roundCfg.group_id);if(e.bossModel){var n=configUnitModel.getDataByKey(e.bossModel);this.bossEffectID=this.addUIEffect(n.path,t,-1,null,.4);var o=n.path.split("/")[n.path.split("/").length-1];this.bossSpine=g.findChildComponent(t,o+"/model",I)}},p.refreshBossSpine=function(){var t=this.findChild("view/bossRoot/icon"),i=IS(R).GetActivityInfo(this.actType),e=configActivity_boss.getDataByKeys("type",this.actType,"group_id",i.roundCfg.group_id),n=configUnitModel.getDataByKey(e.bossModel),o=n.path.split("/")[n.path.split("/").length-1];this.bossSpine=g.findChildComponent(t,o+"/model",I)},p.onAttack=function(t,i){var e=this;this.flyPil(i.worldPosition),m.playSound("skill_touzhifeixingwu"),this.addTween(0,1,.95,(function(t,i){})).easing(D.BACK_IN).call((function(){e.AttackBoss(t)})).start()},p.AttackBoss=function(t){this.bossSpine?(this.bossSpine.setAnimation(0,"hit",!1),this.bossSpine.addAnimation(0,"idle",!0)):(this.refreshBossSpine(),this.bossSpine.setAnimation(0,"hit",!1),this.bossSpine.addAnimation(0,"idle",!0))},p.clearTimer=function(t){null!=t&&(this.removeTimer(t),t=null)},p.flyPil=function(t){var i=new c,e=new u;this.utFly.convertToNodeSpaceAR(t,i);var n=this.utFly.convertToNodeSpaceAR(this.target.worldPosition,new c),o=S.alloc("ui/module/slumberparty/FlyPillow",this.nodeFly,1);o.position=e.set(i.x,i.y);var s=new u(i.x,i.y),r=c.subtract(new c,n,i);this.addTween(0,1,.95,(function(t,n){c.multiplyScalar(i,r,n),e.set(s).add2f(i.x,i.y),o.position=e})).easing(D.CIRC_IN).call((function(){m.playSound("skill_zidan_hit")})).start()},e}(U));var P=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(i=t.call.apply(t,[this].concat(n))||this).txtDesc=void 0,i.itemGridNode=void 0,i.itemGrid=void 0,i.isReward=void 0,i.eff=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){var t=this;this.txtDesc=g.findChildComponent(this.node,"desc",r),this.itemGridNode=g.findChild(this.node,"itemGrid"),this.itemGrid=new p(this.view,this.itemGridNode,(function(){1==t.isReward?IS(E).send_24_21(t.view.actType,1,t.data.id):IS(x).OpenItemTips(t.data.reward.gtid,t.itemGridNode)}))},n.onRender=function(t,i){this.itemGrid.SetItemId(t.reward.gtid,t.reward.num);var e=IS(F).getFightInfo();this.isReward=t.status,this.view.removeUIEffect(this.eff),2==t.status?this.txtDesc.string=f.formatStr("<b><color=#80342e>"+GetLanguage(200314)+"</color></b>"):1==t.status?(this.txtDesc.string=f.formatStr("<b><color=#80342e>"+GetLanguage(200732)+"</color></b>"),this.eff=this.view.addUIEffect("prefab/ui-effect/MX_tx_tongyong_daojulingqu",this.itemGridNode,-1)):this.txtDesc.string=f.formatStr("<b><color=#ff1c1c>%s</color><color=#80342e>/%s</color></b>",e.times,t.id)},e}(v),N=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return(i=t.call.apply(t,[this].concat(n))||this).txtDesc=void 0,i.itemGridNode=void 0,i.itemGrid=void 0,i.isReward=void 0,i.eff=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){var t=this;this.txtDesc=g.findChildComponent(this.node,"desc",r),this.itemGridNode=g.findChild(this.node,"itemGrid"),this.itemGrid=new p(this.view,this.itemGridNode,(function(){1==t.isReward?IS(E).send_24_21(t.view.actType,2,t.data.id):IS(x).OpenItemTips(t.data.reward.gtid,t.itemGridNode)}))},n.onRender=function(t,i){this.itemGrid.SetItemId(t.reward.gtid,t.reward.num);var e=IS(F).getFightInfo();this.isReward=t.status,this.view.removeUIEffect(this.eff),2==t.status?this.txtDesc.string=f.formatStr("<b><color=#80342e>"+GetLanguage(200314)+"</color></b>"):1==t.status?(this.txtDesc.string=f.formatStr("<b><color=#80342e>"+GetLanguage(200732)+"</color></b>"),this.eff=this.view.addUIEffect("prefab/ui-effect/MX_tx_tongyong_daojulingqu",this.itemGridNode,-1)):this.txtDesc.string=f.formatStr("<b><color=#ff1c1c>%s</color><color=#80342e>/%s</color></b>",e.lev_succ,t.id)},e}(v);e._RF.pop()}}}));

