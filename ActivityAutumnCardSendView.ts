System.register("chunks:///_virtual/ActivityAutumnCardSendView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./ConfigGlobal.ts","./BagModel.ts","./MessageView.ts","./FriendControl.ts","./FriendDefine.ts","./FriendModel.ts","./GuildDataCache.ts","./GuildDefine.ts","./RoleDataCache.ts","./RoleDefine.ts","./ActivityControl.ts","./ActivityAutumnDataCache.ts","./ActivityAutumnDefine.ts","./BaseView.ts"],(function(e){"use strict";var t,i,n,o,a,s,r,d,l,h,c,u,f,m,p,v,g,I,C,_,y,L,T,S,w,b,G,F;return{setters:[function(e){t=e.inheritsLoose},function(e){i=e.cclegacy,n=e.Button,o=e.Sprite,a=e.Label,s=e.EditBox,r=e.UITransform,d=e.ScrollView},function(e){l=e.ListItem},function(e){h=e.default},function(e){c=e.default},function(e){u=e.default},null,function(e){f=e.ConfigGlobal},function(e){m=e.BagModel},function(e){p=e.default},function(e){v=e.default},function(e){g=e.FriendListType,I=e.FriendDefine},function(e){C=e.FriendModel},function(e){_=e.default},function(e){y=e.GuildEventDefine},function(e){L=e.RoleDataCache},function(e){T=e.PlayerAttr},function(e){S=e.default},function(e){w=e.default},function(e){b=e.ActivityAutumnEventDefine,G=e.CardItemIcon},function(e){F=e.BaseView}],execute:function(){i._RF.push({},"5ad926KZSlNboMG5s3DoEv+","ActivityAutumnCardSendView",void 0);e("default",function(e){function i(){var t;return(t=e.call(this)||this).operateType=0,t.curIndex=void 0,t.itemId=void 0,t.page=0,t.isSendToServer=void 0,t.itemIcon=void 0,t.title=void 0,t.searchItem=void 0,t.itemName=void 0,t.editBox=void 0,t.msgTip=void 0,t.tabList=void 0,t.scrollView=void 0,t.scrollViewTrans=void 0,t.cardItemList=[],t.name="ActivityAutumnCardSendView",t.url="ui/module/autumn/ActivityAutumnCardSendView",t}t(i,e);var l=i.prototype;return l.onInit=function(){var e=this,t=this.findChild("imgMask");this.addComponentCallbackListener(t,n.EventType.CLICK,(function(){e.close()}));var i=this.findChild("bg/btnClose");this.addComponentCallbackListener(i,n.EventType.CLICK,(function(){e.close()})),this.msgTip=this.findChildComponent("bg/title/msgTip",o),this.itemIcon=this.findChildComponent("itemNode/itemIcon",o),this.itemName=this.findChildComponent("itemNode/Label",a),this.searchItem=this.findChild("searchItem"),this.editBox=this.findChildComponent("searchItem/EditBox",s);var l=this.findChild("searchItem/searchBtn");this.addComponentCallbackListener(l,n.EventType.CLICK,(function(){var t=e.editBox.string;""!=t?IS(S).send_24_65(t):IS(v).reqFriendList(g.FriendRecommend,1)})),this.tabList=[];for(var h=function(t){e.findChild("select/item"+t);var i={itemGo:e.findChild("select/item"+t),select:e.findChild("select/item"+t+"/select")};e.addComponentCallbackListener(i.itemGo,n.EventType.CLICK,(function(){2!=t||IS(L).HasGuild()?e.RefreshSelectItem(t):p.showFlyTip(GetLanguage(200165))})),e.tabList[t]=i},c=0;c<3;c++)h(c);this.scrollViewTrans=this.findChildComponent("ScrollView",r);var u=this.findChildComponent("ScrollView",d);this.scrollView=this.addUIList(u,x),this.addComponentCallbackListener(u.node,d.EventType.SCROLL_TO_BOTTOM,(function(){e.isSendToServer||1!=e.curIndex||(e.page+=1,IS(v).reqFriendList(g.FriendList,e.page),e.isSendToServer=!0)}))},l.registerUpdateHandler=function(){this.addEvent(I.FriendInfoBack,this.RefreshScroll,this),this.addEvent(b.UpdateActCardSearchRoleInfo,this.RefreshScroll,this),this.addEvent(y.GUILD_INFO_UPDATE,this.RefreshScroll,this)},l.RefreshSelectItem=function(e){if(this.curIndex!=e){for(var t=0;t<this.tabList.length;t++)this.tabList[t].select.active=e==t;this.curIndex=e,this.scrollView.scrollTo(0,-1),this.editBox.string="",0==this.curIndex?(this.scrollViewTrans.height=400,this.searchItem.active=!0,IS(v).reqFriendList(g.FriendRecommend,1)):1==this.curIndex?(this.scrollViewTrans.height=455,this.searchItem.active=!1,this.page=1,IS(v).reqFriendList(g.FriendList,this.page)):(this.scrollViewTrans.height=455,this.searchItem.active=!1),this.RefreshScroll()}},l.onAfterOpen=function(){this.curIndex=null,this.itemId=this.openArgs[0],this.operateType=this.openArgs[1];var e=configGoods.getDataByKey(this.itemId);this.loadIcon(this.itemIcon,"autumn2",G[this.itemId]),1==this.operateType?(this.loadIcon(this.msgTip,"autumn2","zq_ui_biaoti_slzs"),this.itemName.string=c.formatStrWithMirrorDeal(GetLanguage(200778),e.name)):(this.loadIcon(this.msgTip,"autumn2","zq_ui_biaoti_slsy"),this.itemName.string=c.formatStrWithMirrorDeal(GetLanguage(200779),e.name)),this.RefreshSelectItem(0)},l.onBeforeClose=function(){},l.onDestroy=function(){},l.RefreshScroll=function(e){void 0===e&&(e=null);var t=[];if(0==this.curIndex){var i;if(""==this.editBox.string)t=IS(C).GetListByType(g.FriendRecommend);else t=null!=(i=e)?i:[];this.editBox.string=""}else if(1==this.curIndex)t=IS(C).GetListByType(g.FriendList);else if(2==this.curIndex){var n=[],o=IS(_).GetMemberList();for(var a in o)if(o.hasOwnProperty(a)){var s=o[a];s.role_id!=IS(L).GetRoleAttr(T.ROLE_ATTR_ID)&&n.push(s)}n.sort((function(e,t){return e.donate_week!=t.donate_week?t.donate_week-e.donate_week:e.is_online==t.is_online?0==e.is_online&&e.offline_time!=t.offline_time?t.offline_time-e.offline_time:e.career!=t.career?IS(_).CompareCareer(e.career,t.career):e.role_id-t.role_id:0==e.is_online?1:-1}));for(var r=0;r<n.length;r++){var d=n[r];t.push({role_id:d.role_id,name:d.role_name,head:d.role_head,is_online:d.is_online,offline_time:d.offline_time})}}this.scrollView.datas=t},l.updateTask=function(){},i}(F));var x=function(e){function i(){for(var t,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(t=e.call.apply(e,[this].concat(n))||this).name=void 0,t.time=void 0,t.btn=void 0,t.btnTxt=void 0,t.imgHeadFrame=void 0,t.headImg=void 0,t.operateType=void 0,t}t(i,e);var s=i.prototype;return s.onInit=function(){var e=this;this.name=h.findChildComponent(this.node,"name",a),this.time=h.findChildComponent(this.node,"time",a),this.btnTxt=h.findChildComponent(this.node,"btn/Label",a),this.btn=h.findChild(this.node,"btn"),this.view.addComponentCallbackListener(this.btn,n.EventType.CLICK,(function(){1==e.operateType?f.autumn_card_dailygift:f.autumn_card_dailyask;var t=1==e.operateType?IS(w).send_times:IS(w).ask_times,i=e.view.itemId,n=configGoods.getDataByKey(i);if(1==e.operateType){if(t<=0)return void p.showFlyTip(GetLanguage(200749));if(IS(m).getGoodsCountByGoodsGtid(i)<=0)return void p.showFlyTip(GetLanguage(200748));var o=f.autumn_card_validity_period,a=c.formatStrWithMirrorDeal(GetLanguage(200756),e.data.name,n.name,Math.floor(o/3600));p.showBoxTip({tip:a,title:GetLanguage(200048),func:function(t){"type_yes"==t&&IS(S).send_24_60(i,0,e.data.role_id,0)}})}else{if(t<=0)return void p.showFlyTip(GetLanguage(200750));var s=c.formatStrWithMirrorDeal(GetLanguage(200757),e.data.name,n.name);p.showBoxTip({tip:s,title:GetLanguage(200048),func:function(t){"type_yes"==t&&IS(S).send_24_59(i,1,e.data.role_id)}})}})),this.imgHeadFrame=h.findChildComponent(this.node,"head/imgHeadFrame",o),this.headImg=h.findChildComponent(this.node,"head/image",o)},s.onRender=function(e,t){this.operateType=this.view.operateType,this.name.string=e.name;var i=e.head.frame_id;if(1==this.operateType?this.btnTxt.string=GetLanguage(200795):this.btnTxt.string=GetLanguage(200796),i>0){this.imgHeadFrame.node.active=!0;var n=configAvatar_frame.getDataByKey(i);this.view.loadIcon(this.imgHeadFrame,"icon_frame",n.icon)}else this.imgHeadFrame.node.active=!1;this.view.loadRemoteIcon(e.head.url,this.headImg),this.time.string=0==e.is_online?u.getDateDiff(e.offline_time)+GetLanguage(200171):GetLanguage(200057)},i}(l);i._RF.pop()}}}));

