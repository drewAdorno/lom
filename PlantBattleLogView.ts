System.register("chunks:///_virtual/PlantBattleLogView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIList.ts","./NodeUtil.ts","./TimeUtil.ts","./index57.ts","./ConfigGlobal.ts","./ChatDataCache.ts","./ChatDefine.ts","./MessageView.ts","./RoleDataCache.ts","./PlantControl.ts","./PlantDefine.ts","./BaseSubView.ts"],(function(t){"use strict";var e,i,n,o,a,s,r,h,d,l,f,g,m,c,u,v,p,C,w,L,_;return{setters:[function(t){e=t.inheritsLoose,i=t.createForOfIteratorHelperLoose},function(t){n=t.cclegacy,o=t.ScrollView,a=t.Sprite,s=t.Label,r=t.Button,h=t.Layout,d=t.js},function(t){l=t.ListItem},function(t){f=t.default},function(t){g=t.default},null,function(t){m=t.ConfigGlobal},function(t){c=t.ChatDataCache,u=t.EPvpShareType},function(t){v=t.ChatDefine},function(t){p=t.default},function(t){C=t.RoleDataCache},function(t){w=t.default},function(t){L=t.PlantEventDefine},function(t){_=t.BaseSubView}],execute:function(){n._RF.push({},"84f97RYrAVDE7RvU37QmeAZ","PlantBattleLogView",void 0);t("PlantBattleLogView",function(t){function n(){var e;return(e=t.call(this)||this).scrollList=void 0,e.curPage=1,e.uidMap=new Map,e.isEnd=!1,e.isRequesting=!1,e.name="PlantBattleLogView",e.url="ui/module/plant/sub/PlantBattleLogView",e}e(n,t);var a=n.prototype;return a.onInit=function(){var t=this,e=this.findChildComponent("scroll",o);this.scrollList=this.addUIList(e,I),this.scrollList.inBottomFunc=function(){t.requestNextPage()}},a.registerUpdateHandler=function(){this.addEvent(L.FARM_LOG_BATTLE,this.onUpdateRecordList,this)},a.onAfterOpen=function(){IS(w).reqBattleLogList()},a.onBeforeClose=function(){},a.onDestroy=function(){},a.onUpdateRecordList=function(t){if(0==t.battle_report_list.length)return this.isEnd=!0,void(this.isRequesting=!1);this.curPage=t.page;for(var e,n=i(t.battle_report_list);!(e=n()).done;){var o=e.value;this.uidMap.set(o.id,o)}for(var a,s=[],r=i(this.uidMap.values());!(a=r()).done;){var h=a.value;s.push(h)}s.sort((function(t,e){return e.time-t.time})),this.scrollList.datas=s,this.isRequesting=!1},a.requestNextPage=function(){this.isEnd||this.isRequesting||this.scrollList.getIsShowBottomItem(this.uidMap.size-1)&&(console.log("[PlantBattleLog] request page: ",this.curPage+1),this.isRequesting=!0,IS(w).reqBattleLogList(this.curPage+1))},n}(_));var I=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).left={},e.right={},e.txtTime=void 0,e.imgLeftWin=void 0,e.imgRightWin=void 0,e.nodeNew=void 0,e}e(i,t);var n=i.prototype;return n.onInit=function(){var t=this;this.imgLeftWin=f.findChild(this.node,"imgLeftWin"),this.imgRightWin=f.findChild(this.node,"imgRightWin"),this.left.imgLose=f.findChild(this.node,"left/imgLose"),this.left.imgIcon=f.findChildComponent(this.node,"left/imgIcon",a),this.left.imgHeadFrame=f.findChildComponent(this.node,"left/imgHeadFrame",a),this.left.txtName=f.findChildComponent(this.node,"left/txtName",s),this.left.txtPower=f.findChildComponent(this.node,"left/txtPower",s),this.right.imgLose=f.findChild(this.node,"right/imgLose"),this.right.imgIcon=f.findChildComponent(this.node,"right/imgIcon",a),this.right.imgHeadFrame=f.findChildComponent(this.node,"right/imgHeadFrame",a),this.right.txtName=f.findChildComponent(this.node,"right/txtName",s),this.right.txtPower=f.findChildComponent(this.node,"right/power/txtPower",s),this.txtTime=f.findChildComponent(this.node,"txtTime",s),this.nodeNew=f.findChild(this.node,"imgNew"),this.nodeNew.active=!1;var e=f.findChild(this.node,"btnShare");this.view.addComponentCallbackListener(e,r.EventType.CLICK,(function(){IS(c).IsOpenInput()?t.data.atk_role&&t.data.def_role&&IS(c).SendShareData(v.ChatLinkType.PvpShare,t.data,void 0,void 0,u.farmBattle):p.showFlyTip("玩家等级达到"+m.chat_level+"级后开启分享")}));var i=f.findChild(this.node,"btnPlayRecord");this.view.addComponentCallbackListener(i,r.EventType.CLICK,(function(){IS(w).reqBattleRecordInfo(t.data.vid,t.view.parentView.openArgs[0]),battleMain.enterChapter(0),uiMgr.closeAllView(["MainView","MessageView","GuideView","BattleHubView"]),uiMgr.getOpenView("MainView").setIndex(0)})),this.view.loadIcon(f.findChildComponent(this.node,"imgVs",a),"jjc","jjc_ui_vs"),this.view.loadIcon(this.nodeNew.getComponent(a),"farm","zy_ui_new"),this.view.loadIcon(this.imgLeftWin.getComponent(a),"common","gvg_img_shengli"),this.view.loadIcon(this.imgRightWin.getComponent(a),"common","gvg_img_shengli"),this.view.dealMirrorLayout(f.findChildComponent(this.node,"right/power",h))},n.onRender=function(t,e){var i=IS(C).GetRoleId();i!=t.atk_role.id&&i!=t.def_role.id&&(i=t.atk_role.id);var n=i==t.win_id;this.imgLeftWin.active=n,this.imgRightWin.active=!n,this.left.imgLose.active=!n,this.right.imgLose.active=n;var o=t.atk_role.id==i?[t.atk_role,t.def_role]:[t.def_role,t.atk_role],a=o[0],s=o[1];if(this.left.txtName.string=a.name,this.left.txtPower.string=a.power,null!=a.head)if(this.view.loadRemoteIcon(a.head.url,this.left.imgIcon),a.head.frame_id>0){var r=configAvatar_frame.getDataByKey(a.head.frame_id);this.view.loadIcon(this.left.imgHeadFrame,"icon_frame",r.icon),this.left.imgHeadFrame.node.active=!0}else this.left.imgHeadFrame.node.active=!1;if(this.right.txtName.string=s.name,this.right.txtPower.string=s.power,null!=s.head)if(this.view.loadRemoteIcon(s.head.url,this.right.imgIcon),s.head.frame_id>0){var h=configAvatar_frame.getDataByKey(s.head.frame_id);this.view.loadIcon(this.right.imgHeadFrame,"icon_frame",h.icon),this.right.imgHeadFrame.node.active=!0}else this.right.imgHeadFrame.node.active=!1;this.nodeNew.active=0==t.is_read;var l=g.serverTimeZone>0?d.formatStr("+%s",g.serverTimeZone):g.serverTimeZone;this.txtTime.string=d.formatStr("%s(UTC%s)",g.formatDate(new Date(1e3*t.time),"yyyy/MM/dd hh:mm:ss"),l)},i}(l);n._RF.pop()}}}));

