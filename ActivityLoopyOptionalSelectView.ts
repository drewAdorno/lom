System.register("chunks:///_virtual/ActivityLoopyOptionalSelectView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./index57.ts","./BagModel.ts","./MessageView.ts","./PayControl.ts","./PayDataCache.ts","./PayDefine.ts","./BaseView.ts"],(function(e){"use strict";var t,i,o,n,s,h,d,c,l,a,r,v,u,f;return{setters:[function(e){t=e.inheritsLoose},function(e){i=e.cclegacy,o=e.Button,n=e.ScrollView,s=e.Node},function(e){h=e.ItemGrid},function(e){d=e.ListItem},function(e){c=e.default},null,function(e){l=e.BagModel},function(e){a=e.default},function(e){r=e.default},function(e){v=e.default},function(e){u=e.PayEventDefine},function(e){f=e.BaseView}],execute:function(){i._RF.push({},"4b503h177tEsLv8PwF0FefU","ActivityLoopyOptionalSelectView",void 0);e("default",function(e){function i(){var t;return(t=e.call(this)||this).chooseList=void 0,t.gift_id=void 0,t.selectIndex=-1,t.chooseIndex=1,t.saveChoose=[],t.chooseScroll=void 0,t.rewardScroll=void 0,t.time=0,t.isTouch=void 0,t.itemId=0,t.showNode=void 0,t.name="ActivityLoopyOptionalSelectView",t.url="ui/module/activityLoopy/ActivityLoopyOptionalSelectView",t}t(i,e);var s=i.prototype;return s.onInit=function(){var e=this,t=this.findChild("imgMask");this.addComponentCallbackListener(t,o.EventType.CLICK,(function(){e.close()}));var i=this.findChild("view/btnClose");this.addComponentCallbackListener(i,o.EventType.CLICK,(function(){e.close()}));var s=this.findChild("view/btnCancel");this.addComponentCallbackListener(s,o.EventType.CLICK,(function(){e.close()}));var h=this.findChild("view/btnSave");this.addComponentCallbackListener(h,o.EventType.CLICK,(function(){var t=[];for(var i in e.saveChoose)e.saveChoose.hasOwnProperty(i)&&function(){var o=e.saveChoose[i],n=Number(i),s=e.chooseList.find((function(e){return e[0]==n}))[1][o-1];t.push({k:n,v:s[0]})}();0!=t.length?(IS(r).send_19_9({id:e.gift_id,list:t}),e.close()):a.showFlyTip(GetLanguage(202017))}));var d=this.findChildComponent("view/chooseScroll",n);this.chooseScroll=this.addUIList(d,C),this.chooseScroll.lackCenter=!0;var c=this.findChildComponent("view/rewardScroll",n);this.rewardScroll=this.addUIList(c,m)},s.registerUpdateHandler=function(){this.addEvent(u.PAY_CUSTOM_INFO_SET,this.close,this)},s.onAfterOpen=function(){var e,t,i=this;this.gift_id=this.openArgs[0],this.chooseIndex=null!=(e=this.openArgs[1])?e:1;var o=configCustom_mall.getDataByKey(this.gift_id);this.chooseList=o.custom_reward;var n=null!=(t=IS(v).GetCustomInfoList(this.gift_id))?t:[];for(var s in n)n.hasOwnProperty(s)&&function(){var e=n[s],t=e.v,o=i.chooseList.find((function(t){return t[0]==e.k}))[1].findIndex((function(e){return e[0]==t}));i.saveChoose[e.k]=o+1}();this.chooseScroll.datas=this.chooseList,this.changeChoose(this.chooseIndex)},s.onBeforeClose=function(){this.saveChoose=[],this.selectIndex=0,this.chooseIndex=1,this.selectIndex=-1},s.onDestroy=function(){},s.onUpdate=function(e){this.isTouch&&(this.time=this.time+e,0!=this.itemId&&this.time>=.5&&IS(l).OpenItemTips(this.itemId,this.showNode))},s.changeChoose=function(e){var t;this.chooseIndex=e;var i=null!=(t=this.saveChoose[e])?t:0;this.selectIndex=i,this.rewardScroll.datas=this.chooseList.find((function(t){return t[0]==e}))[1],this.chooseScroll.updateAll()},s.setChoose=function(e){this.selectIndex=e,this.saveChoose[this.chooseIndex]=e,this.chooseScroll.updateAll(),this.rewardScroll.updateAll()},i}(f));var C=function(e){function i(){for(var t,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return(t=e.call.apply(e,[this].concat(o))||this).itemGrid=void 0,t.notSet=void 0,t.select=void 0,t.itemId=0,t}t(i,e);var o=i.prototype;return o.onInit=function(){var e=this;this.itemGrid=new h(this.view,c.findChild(this.node,"itemGrid")),this.notSet=c.findChild(this.node,"notSet"),this.select=c.findChild(this.node,"select"),this.view.addComponentCallbackListener(this.node,s.EventType.TOUCH_START,(function(){e.view.itemId=e.itemId,e.view.showNode=e.node,e.view.time=0,e.view.isTouch=!0})),this.view.addComponentCallbackListener(this.node,s.EventType.TOUCH_CANCEL,(function(){e.view.time=0,e.view.isTouch=!1})),this.view.addComponentCallbackListener(this.node,s.EventType.TOUCH_END,(function(){e.view.time<.5&&e.view.changeChoose(e.index+1),e.view.time=0,e.view.isTouch=!1}))},o.onRender=function(e,t){var i,o=null!=(i=this.view.saveChoose[t+1])?i:0;if(o){this.notSet.active=!1,this.itemGrid.node.active=!0;var n=this.view.chooseList.find((function(e){return e[0]==t+1}))[1][o-1];this.itemGrid.SetItemId(n[0],n[1]),this.itemId=n[0]}else this.itemId=0,this.notSet.active=!0,this.itemGrid.node.active=!1;this.SetSelect()},o.SetSelect=function(){this.select.active=this.index==this.view.chooseIndex-1},i}(d),m=function(e){function i(){for(var t,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return(t=e.call.apply(e,[this].concat(o))||this).itemGridNode=void 0,t.itemGrid=void 0,t.select=void 0,t.itemId=0,t}t(i,e);var o=i.prototype;return o.onInit=function(){var e=this;this.itemGridNode=c.findChild(this.node,"itemGrid"),this.itemGrid=new h(this.view,this.itemGridNode),this.select=c.findChild(this.node,"select"),this.view.addComponentCallbackListener(this.node,s.EventType.TOUCH_START,(function(){e.view.itemId=e.itemId,e.view.showNode=e.node,e.view.time=0,e.view.isTouch=!0})),this.view.addComponentCallbackListener(this.node,s.EventType.TOUCH_CANCEL,(function(){e.view.time=0,e.view.isTouch=!1})),this.view.addComponentCallbackListener(this.node,s.EventType.TOUCH_END,(function(){e.view.time<.5&&e.view.setChoose(e.index+1),e.view.time=0,e.view.isTouch=!1}))},o.onRender=function(e,t){this.itemId=e[0],this.itemGrid.SetItemId(e[0],e[1]),this.SetSelect()},o.SetSelect=function(){this.select.active=this.index==this.view.selectIndex-1},i}(d);i._RF.pop()}}}));

