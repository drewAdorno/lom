System.register("chunks:///_virtual/EquipAsset.ts",["cc","./AssetPool.ts","./SpineSkeleton.ts"],(function(t){"use strict";var i,e,o,s,a;return{setters:[function(t){i=t.cclegacy,e=t.isValid,o=t.Prefab},function(t){s=t.AssetPoolState},function(t){a=t.SpineSkeleton}],execute:function(){var n,l;i._RF.push({},"b1a0eGJdlVLp58J0+6mL2cO","EquipAsset",void 0),function(t){t[t.Not=0]="Not",t[t.Ready=1]="Ready",t[t.Loading=2]="Loading",t[t.Finish=3]="Finish"}(n||(n={})),function(t){t.MX_j_wuqi="MX_j_wuqi",t.MX_j_mianju="MX_j_mianju",t.MX_j_toushi1="MX_j_toushi1",t.MX_j_toushi2="MX_j_toushi2",t.MX_j_maozi="MX_j_maozi",t.MX_j_maozi2="MX_j_maozi2",t.qi="qi",t.zhuangjiao="zhuangjiao"}(l||(l={}));t("EquipAsset",function(){function t(){this.freeTime=void 0,this.url=void 0,this.poolState=void 0,this.pool=void 0,this.unit=void 0,this.spine=void 0,this.part=0,this._loadState=n.Not,this._loadCb=void 0}t.alloc=function(t,i,e){var o=equipPool.alloc(i,5);return o.unit=t,o.part=e,o.loadSync(),o},t.free=function(t){t.free()};var i=t.prototype;return i.loadSync=function(){return e(this.spine)&&this.applySlot(),!(this.poolState>s.Useing)&&(null!=this.url&&(this._loadState==n.Not&&(this._loadState=n.Ready,this.resLoad(),!0)))},i.resLoad=function(){var t=this;this._loadState==n.Ready&&(this._loadState=n.Loading,this._loadCb=function(i){t.onModelLoaded(i)},resourceMgr.loadRes(this.url,o,this._loadCb))},i.replaceSlot=function(t,i){if(void 0===i&&(i=!1),e(this.unit)){var o=this.unit.findSlot(t);if(null!=o)if(i)o.setToSetupPose();else{var s=this.spine.findSlot(t);null!=s&&(this.spine.customMaterial&&s.attachment&&(s.attachment.material=this.spine.customMaterial),o.attachment=s.attachment,o.bone.ax=s.bone.ax,o.bone.ay=s.bone.ay)}else printLogErr("找不到装备插槽:",t)}},i.applySlot=function(t){switch(void 0===t&&(t=!1),this.part){case 1:this.replaceSlot(l.MX_j_wuqi,t);break;case 2:this.replaceSlot(l.MX_j_toushi1,t),this.replaceSlot(l.MX_j_toushi2,t),this.replaceSlot(l.MX_j_maozi,t),this.replaceSlot(l.MX_j_maozi2,t);break;case 3:this.replaceSlot(l.MX_j_mianju,t);break;case 102:this.replaceSlot(l.qi,t);break;case 104:this.replaceSlot(l.zhuangjiao,t)}},i.onModelLoaded=function(t){if(this._loadState=n.Finish,this._loadCb=null,null!=t.item&&null!=t.item.asset){var i=t.item.asset;null!=i?(this.spine=i.data.getComponent(a),null!=this.spine?(this.spine.__preload(),this.applySlot()):printLogErr("预制未绑【SpineSkeleton】组件：",this.url)):printLogErr("预制为空，路径：",this.url)}else printLogErr("预制加载错误:",this.url)},i.destroy=function(){this.poolState=s.Destroy,this._loadState!=n.Finish?(this._loadState==n.Loading&&resourceMgr.cancelLoadRes(this.url,this._loadCb),this._loadCb=null):(this._loadState==n.Finish&&resourceMgr.releaseResRef(this.url),this._loadState=n.Ready),this.unit=null,this.spine=null,this.url=null},i.free=function(){this.poolState==s.Useing&&this.pool.free(this)},i.onAfterCacheFree=function(){this.unit=null,this._loadState!=n.Finish&&(this._loadState==n.Loading&&resourceMgr.cancelLoadRes(this.url,this._loadCb),this._loadCb=null,this._loadState=n.Not)},t}());i._RF.pop()}}}));

