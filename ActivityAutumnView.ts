System.register("chunks:///_virtual/ActivityAutumnView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./RedPoint.ts","./RedPointMgr.ts","./TimeUtil.ts","./index57.ts","./BagDefine.ts","./BagModel.ts","./BattlePassDefine.ts","./MessageView.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./ActivityAutumnDataCache.ts","./ActivityAutumnDefine.ts","./AudioMgr.ts","./RoleDataCache.ts","./SdkDataCache.ts","./UIDefine.ts","./BaseView.ts"],(function(t){"use strict";var e,i,n,a,s,u,o,d,c,h,r,l,f,m,v,p,g,C,T,A,I,w,y,L,S;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,n=t.Button,a=t.Vec2,s=t.ProgressBar,u=t.Label,o=t.js},function(t){d=t.RedPointType},function(t){c=t.RedPointMgr},function(t){h=t.default},null,function(t){r=t.BagEventDefine},function(t){l=t.BagModel},function(t){f=t.BattlePassDefine},function(t){m=t.default},function(t){v=t.default},function(t){p=t.ActivityType,g=t.ActivityState,C=t.ActivityEventDefine},function(t){T=t.default},function(t){A=t.CardItemList},function(t){I=t.audioMgr},function(t){w=t.RoleDataCache},function(t){y=t.SdkDataCache},function(t){L=t.OpenFunction},function(t){S=t.BaseView}],execute:function(){i._RF.push({},"acb93c84G9Pv5TZ6eQIdWPH","ActivityAutumnView",void 0);t("default",function(t){function i(){var e;return(e=t.call(this)||this).txtTimeDesc=void 0,e.txtLeftTime=void 0,e.collectProgress=void 0,e.leftTime=0,e.deltaTime=0,e.canUpdate=!1,e.name="ActivityAutumnView",e.url="ui/module/autumn/ActivityAutumnView",e.fullScreen=!0,e}e(i,t);var S=i.prototype;return S.onInit=function(){var t=this,e=this.findChild("view/btnClose");this.addComponentCallbackListener(e,n.EventType.CLICK,(function(){t.close()}));var i=this.findChild("view/btnCollect");this.addComponentCallbackListener(i,n.EventType.CLICK,(function(){if(IS(w).CheckFuncOpen(L.FUNC_AUTUMN_ACTIVITY,!0)){var t=IS(v).GetActivityInfo(p.AutumnRiddles);t&&t.state==g.Open?uiMgr.openView("ActivityAutumnCardView"):t&&t.state==g.Preview?m.showFlyTip(GetLanguage(200086)):m.showFlyTip(GetLanguage(200026))}})),this.addRedPoint("ActivityAutumnCardRed",i,new a(20,40),d.Dot,1),IS(c).updateRed("ActivityAutumnCardRed"),this.collectProgress=this.findChildComponent("view/btnCollect/ProgressBar",s);var o=this.findChild("view/btnRiddles");this.addRedPoint("autumn_riddles",o,new a(65,110),d.Dot),this.addComponentCallbackListener(o,n.EventType.CLICK,(function(){if(IS(w).CheckFuncOpen(L.FUNC_AUTUMN_ACTIVITY,!0)){var t=IS(v).GetActivityInfo(p.AutumnRiddles);t&&t.state==g.Open?uiMgr.openView("ActivityAutumnRiddlesView"):t&&t.state==g.Preview?m.showFlyTip(GetLanguage(200086)):m.showFlyTip(GetLanguage(200026))}}));var h=this.findChild("view/btnGame");this.addRedPoint("autumn_game",h,new a(65,110),d.Dot),this.addComponentCallbackListener(h,n.EventType.CLICK,(function(){var t=IS(v).GetActivityInfo(p.AutumnGame);t&&t.state==g.Open?uiMgr.openView("ActivityAutumnShotView"):t&&t.state==g.Preview?m.showFlyTip(GetLanguage(200086)):m.showFlyTip(GetLanguage(200026))}));var r=this.findChild("view/btnFind");this.addRedPoint("autumn_find",r,new a(65,110),d.Dot),this.addComponentCallbackListener(r,n.EventType.CLICK,(function(){if(IS(w).CheckFuncOpen(L.FUNC_AUTUMN_ACTIVITY,!0)){var t=IS(v).GetActivityInfo(p.AutumnFind);t&&t.state==g.Open?uiMgr.openView("ActivityAutumnFindView"):t&&t.state==g.Preview?m.showFlyTip(GetLanguage(200086)):m.showFlyTip(GetLanguage(200026))}}));var l=this.findChild("view/btnTurn");this.addComponentCallbackListener(l,n.EventType.CLICK,(function(){if(IS(w).CheckFuncOpen(L.FUNC_AUTUMN_ACTIVITY,!0)){var t=IS(v).GetActivityInfo(p.AutumnTurn);t&&t.state==g.Open?uiMgr.openView("ActivityAutumnTurnView"):t&&t.state==g.Preview?m.showFlyTip(GetLanguage(200086)):m.showFlyTip(GetLanguage(200026))}}));var f=this.findChild("view/btnPass");this.addRedPoint("autumn_pass",f,new a(65,110),d.Dot),this.addComponentCallbackListener(f,n.EventType.CLICK,(function(){if(IS(w).CheckFuncOpen(L.FUNC_AUTUMN_ACTIVITY,!0)){var t=IS(v).GetActivityInfo(p.AutumnPass);t&&t.state==g.Open?uiMgr.openView("ActivityAutumnPassView"):t&&t.state==g.Preview?m.showFlyTip(GetLanguage(200086)):m.showFlyTip(GetLanguage(200026))}}));var C=this.findChild("view/btnRank");this.addComponentCallbackListener(C,n.EventType.CLICK,(function(){IS(w).CheckFuncOpen(L.FUNC_AUTUMN_ACTIVITY,!0)&&uiMgr.openView("ActivityAutumnRankView",p.Autumn)}));var T=this.findChild("view/btnTask");this.addRedPoint("autumn_task",T,new a(25,30),d.Dot),this.addComponentCallbackListener(T,n.EventType.CLICK,(function(){if(IS(w).CheckFuncOpen(L.FUNC_AUTUMN_ACTIVITY,!0)){var t=IS(v).GetActivityInfo(p.AutumnPass);t&&t.state==g.Open?uiMgr.openView("ActivityAutumnTaskView",p.AutumnPass):t&&t.state==g.Preview?m.showFlyTip(GetLanguage(200086)):m.showFlyTip(GetLanguage(200026))}}));var A=this.findChild("view/btnGift");this.addComponentCallbackListener(A,n.EventType.CLICK,(function(){if(IS(w).CheckFuncOpen(L.FUNC_AUTUMN_ACTIVITY,!0)){var t=IS(v).GetActivityInfo(p.AutumnTurn);t&&t.state==g.Open?uiMgr.openView("HorseCarnivalGiftView",p.AutumnTurn):t&&t.state==g.Preview?m.showFlyTip(GetLanguage(200086)):m.showFlyTip(GetLanguage(200026))}}));var I=this.findChild("view/btnStore");this.addComponentCallbackListener(I,n.EventType.CLICK,(function(){IS(w).CheckFuncOpen(L.FUNC_AUTUMN_ACTIVITY,!0)&&uiMgr.openView("ActivityAutumnStoreView",p.Autumn)}));var S=this.findChild("view/btnGift2");IS(y).showrechage||(S.active=!1),this.addRedPoint("autumn_gift",S,new a(25,30),d.Dot),this.addComponentCallbackListener(S,n.EventType.CLICK,(function(){if(IS(w).CheckFuncOpen(L.FUNC_AUTUMN_ACTIVITY,!0)){var t=IS(v).GetActivityInfo(p.AutumnGift);!t||t.state!=g.Open&&t.state!=g.Preview?m.showFlyTip(GetLanguage(200026)):uiMgr.openView("ActivityAutumnGiftView")}})),this.txtTimeDesc=this.findChildComponent("view/nodeTime/txtDesc",u),this.txtLeftTime=this.findChildComponent("view/nodeTime/txtTime",u)},S.registerUpdateHandler=function(){this.addEvent(C.OnActivityInfoUpdate,this.updateInfo,this),this.addEvent(C.OnActivityInfoTaskUpdate,this.updateRed,this),this.addEvent(C.OnActivityInfoUpdate,this.updateRed,this),this.addEvent(f.BATTLE_PASS_INFO_UPDATE,this.updateRed,this),this.addEvent(r.GOODS_LIST_UPDATE,this.updateCollectProgress,this),this.addEvent(C.OnAutumnRiddlesUpdate,this.updateRed,this),this.addEvent(C.OnAutumnFindUpdate,this.updateRed,this)},S.onAfterOpen=function(){I.playMusic("zhongqiu_huodongbgm"),this.updateRed(),this.updateCollectProgress();var t=IS(v).GetActivityInfo(p.Autumn);if(t){var e,i=null!=(e=t.state_time[t.state])?e:t.state_time[g.Open];if(this.leftTime=i.end_time-h.serverTime,this.leftTime>0){var n="";t.state==g.Preview?n=GetLanguage(200763):t.state==g.Open?n=GetLanguage(200764):t.state==g.EndShow&&(n=GetLanguage(200765)),this.txtTimeDesc.string=n,this.canUpdate=!0,this.txtLeftTime.string=o.formatStr("%s",h.formatTimeStringForSecond(this.leftTime))}else this.txtLeftTime.string=GetLanguage(200026)}},S.onBeforeClose=function(){I.playMusic("battle"),this.canUpdate=!1},S.onUpdate=function(t){this.canUpdate&&(this.deltaTime=this.deltaTime+t,this.deltaTime>=1&&(this.deltaTime=0,this.leftTime=this.leftTime-1,this.leftTime>0?this.txtLeftTime.string=o.formatStr("%s",h.formatTimeStringForSecond(this.leftTime)):(this.txtLeftTime.string=GetLanguage(200026),this.canUpdate=!1)))},S.onDestroy=function(){},S.updateRed=function(){IS(c).changeValue("autumn_task",IS(v).GetTaskRedNum(p.AutumnPass)),IS(c).changeValue("autumn_pass",IS(T).getPassRedNum()),IS(c).changeValue("autumn_gift",IS(T).GetGiftRed()),IS(c).changeValue("autumn_riddles",IS(T).getRiddlesRedNum()),IS(c).changeValue("autumn_find",IS(T).getFindRedNum()),IS(c).changeValue("autumn_game",IS(T).getGameRed())},S.updateCollectProgress=function(){for(var t=0,e=0;e<A.length;e++){var i=A[e];IS(l).getGoodsCountByGoodsGtid(i)>0&&(t+=1)}this.collectProgress.progress=t/5},S.updateInfo=function(t){if(t.type==p.Autumn&&t.state!=g.Null){var e,i=null!=(e=t.state_time[t.state])?e:t.state_time[g.Open];if(this.leftTime=i.end_time-h.serverTime,this.leftTime>0){var n="";t.state==g.Preview?n=GetLanguage(200763):t.state==g.Open?n=GetLanguage(200764):t.state==g.EndShow&&(n=GetLanguage(200765)),this.txtTimeDesc.string=n,this.canUpdate=!0,this.txtLeftTime.string=o.formatStr("%s",h.formatTimeStringForSecond(this.leftTime))}else this.txtLeftTime.string=GetLanguage(200026)}},i}(S));i._RF.pop()}}}));

