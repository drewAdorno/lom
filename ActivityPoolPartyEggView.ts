System.register("chunks:///_virtual/ActivityPoolPartyEggView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./V2.ts","./AudioMgr.ts","./index3.ts","./ItemGrid.ts","./RedPoint.ts","./RedPointMgr.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./SpineSkeleton.ts","./ConfigGlobal.ts","./ObjectUtil.ts","./BagDefine.ts","./BagModel.ts","./ResItems.ts","./MessageView.ts","./ActivityControl.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./HorseCarnivalDataCache.ts","./BaseView.ts","./EaseMethod.ts"],(function(t){"use strict";var e,i,o,n,s,a,r,d,h,l,c,u,f,g,m,p,v,w,y,_,T,I,C,S,G,L,b,k,E,x,A,N;return{setters:[function(t){e=t.inheritsLoose,i=t.createForOfIteratorHelperLoose},function(t){o=t.cclegacy,n=t.Label,s=t.Button,a=t.Vec2,r=t.Sprite,d=t.Layout,h=t.RichText},function(t){l=t.V2},function(t){c=t.audioMgr},null,function(t){u=t.ItemGrid},function(t){f=t.RedPointType},function(t){g=t.RedPointMgr},function(t){m=t.default},function(t){p=t.default},function(t){v=t.default},null,function(t){w=t.SpineSkeleton},function(t){y=t.ConfigGlobal},function(t){_=t.default},function(t){T=t.BagEventDefine},function(t){I=t.BagModel},function(t){C=t.ResItems},function(t){S=t.default},function(t){G=t.default},function(t){L=t.default},function(t){b=t.ActivityType,k=t.ActivityEventDefine,E=t.ActivityState},function(t){x=t.HorseCarnivalDataCache},function(t){A=t.BaseView},function(t){N=t.EasingMethod}],execute:function(){var P;o._RF.push({},"b9ed7Cy6HpKYa63BoZ6gG80","ActivityPoolPartyEggView",void 0);var R=((P={})[4]={left:220,top:220,num:2},P[9]={left:140,top:80,Num:3},P[16]={left:58,top:6,Num:4},P),V=(t("default",function(t){function o(){var e;return(e=t.call(this)||this).actType=void 0,e.resItems=void 0,e.btnGift=void 0,e.btnStore=void 0,e.skipAnim=void 0,e.showList=[],e.eggList=[],e.layout=void 0,e.txtTitle=void 0,e.txtNum=void 0,e.isGetReward=void 0,e.canGetReward=void 0,e.rewardItem=void 0,e.selectItem=void 0,e.btnWear=void 0,e.btnOneKey=void 0,e.rewardNum=16,e.txtLeftTime=void 0,e.deltaTime=0,e.leftTime=0,e.canUpdate=!1,e.btnNextDoor=void 0,e.reward_list=[],e.lastItemNum=0,e.lastTaskNum=0,e.lastTaskNum2=0,e.costId=0,e.costNum=0,e.extraReward=void 0,e.name="ActivityPoolPartyEggView",e.url="ui/module/activityPoolParty/ActivityPoolPartyEggView",e.actType=b.PoolPartyEgg,e}e(o,t);var l=o.prototype;return l.onInit=function(){var t=this,e=y.break_gold_egg_expend.find((function(e){return e[0]==t.actType}));this.costId=e[1][0],this.resItems=new C(this),this.resItems.init([e[1][0]]),this.txtLeftTime=this.findChildComponent("root/top/nodeTime/txtTime",n);var o=this.findChild("root/btnClose");this.addComponentCallbackListener(o,s.EventType.CLICK,(function(){t.close()}));var l=this.findChild("root/top/nodeTime/tips");this.addComponentCallbackListener(l,s.EventType.CLICK,(function(){IS(L).ShowSysTips(t.actType)})),this.btnStore=this.findChild("root/bottomBtn/btnStore"),this.addRedPoint("poolparty_store",this.btnStore,new a(25,30),f.Dot),this.addComponentCallbackListener(this.btnStore,s.EventType.CLICK,(function(){uiMgr.openView("ActivityPoolPartyStoreView",b.PoolParty)})),this.btnGift=this.findChild("root/bottomBtn/btnGift"),this.addComponentCallbackListener(this.btnGift,s.EventType.CLICK,(function(){uiMgr.openView("ActivityPoolPartyGiftView",t.actType)})),this.btnNextDoor=this.findChild("btnNextFloor"),this.addComponentCallbackListener(this.btnNextDoor,s.EventType.CLICK,(function(){IS(G).send_egg_next(t.actType)}));var c=this.findChild("root/btnShow");this.addComponentCallbackListener(c,s.EventType.CLICK,(function(){uiMgr.openView("ActivityPoolPartyEggTipsView",t.actType)})),this.selectItem=new u(this,this.findChild("root/btnSelect/itemGrid")),this.btnWear=this.findChild("root/btnSelect/btnWear");var g=this.findChild("root/btnSelect");this.addComponentCallbackListener(g,s.EventType.CLICK,(function(){uiMgr.openView("ActivityPoolPartyEggSelectView",t.actType)})),this.skipAnim=this.findChild("mask"),this.addComponentCallbackListener(this.skipAnim,s.EventType.CLICK,(function(){t.SkipAnim()})),this.btnOneKey=this.findChildComponent("root/btnOneKeyDraw",r),this.addComponentCallbackListener(this.btnOneKey.node,s.EventType.CLICK,(function(){if(t.btnNextDoor.active)S.showFlyTip(GetLanguage(400185));else{var e=IS(L).getEggInfo(t.actType);if(e)if(e.ceng<y.one_click_break_gold_egg)S.showFlyTip(p.formatStrWithMirrorDeal(GetLanguage(202101),y.one_click_break_gold_egg));else{if(0==e.choose_goods.gtid)return uiMgr.openView("ActivityPoolPartyEggSelectView",t.actType),void S.showFlyTip(GetLanguage(202016));var o=y.break_gold_egg_expend.find((function(e){return e[0]==t.actType}))[1];if(IS(I).getGoodsCountByGoodsGtid(o[0])<o[1])return S.showFlyTip(GetLanguage(200069)),void uiMgr.openView("ActivityPoolPartyGiftView",t.actType);t.lastItemNum=IS(I).getGoodsCountByGoodsGtid(t.costId),t.lastTaskNum=e.total;for(var n,s=0,a=configBreak_cumulative_times.getDataByList("type",t.actType),r=i(a);!(n=r()).done;){var d=n.value;if(!e.sum_rewards[d.id])break;s++}s>=a.length&&(s=a.length-1),t.lastTaskNum2=a[s].cumulative_times,IS(G).send_egg_open(t.actType,0)}}}));for(var m=1;m<=5;m++){var v=new V;v.init(this.findChild("root/top/rewardContent/rewardItem"+m),this,m),this.showList.push(v)}this.layout=this.findChildComponent("root/turn/itemRoll",d);for(var w=1;w<=this.rewardNum;w++){var _=new D;_.init(this.findChild("root/turn/itemRoll/item"+w),this,w),this.eggList[w]=_}this.txtTitle=this.findChildComponent("root/top/title/Label",n),this.txtNum=this.findChildComponent("root/task/num",h),this.isGetReward=this.findChild("root/task/itemGrid/get"),this.canGetReward=this.findChild("root/task/itemGrid/canGet"),this.rewardItem=new u(this,this.findChild("root/task/itemGrid"),(function(){var e=0,o=IS(L).getEggInfo(t.actType);if(o){for(var n,s=IS(L).GetActivityInfo(t.actType),a=configBreak_cumulative_times.getDataByList("type",s.type),r=i(a);!(n=r()).done;){var d=n.value;if(!o.sum_rewards[d.id])break;e++}e>=a.length&&(e=a.length-1);var h=a[e];!o.sum_rewards[h.id]&&o.total>=h.cumulative_times?IS(G).send_egg_reward(t.actType,h.id):IS(I).OpenItemTips(h.reward[0],t.rewardItem.node)}}))},l.registerUpdateHandler=function(){this.addEvent(T.GOODS_INFO_UPDATE,this.updateResShow,this),this.addEvent(k.OnActivityEggUpdate,this.updateInfo,this),this.addEvent(k.OnActivityEggOpen,this.onEggOpenCallBack,this),this.addEvent(k.OnActivityEggReward,this.updateNumReward,this)},l.onAfterOpen=function(){var t;IS(g).updateRed("poolparty_store"),this.updateResShow(),IS(G).send_egg_info(this.actType),this.skipAnim.active=!1,this.lastItemNum=0,this.lastTaskNum=0;var e=IS(L).GetActivityInfo(this.actType),i=null!=(t=e.state_time[e.state])?t:e.state_time[E.Open];this.leftTime=i.end_time-v.serverTime,this.leftTime>0?(this.canUpdate=!0,this.txtLeftTime.string=v.formatTimeStringForSecond(this.leftTime)):this.txtLeftTime.string=GetLanguage(200026),this.eggList.forEach((function(t){t.addEffect()}))},l.onBeforeClose=function(){this.eggList.forEach((function(t){t.removeTimer(),t.removeTween()})),this.reward_list=[],this.extraReward=null},l.onDestroy=function(){},l.onUpdate=function(t){this.canUpdate&&(this.deltaTime=this.deltaTime+t,this.deltaTime>=1&&(this.deltaTime=0,this.leftTime=this.leftTime-1,this.leftTime>0?this.txtLeftTime.string=v.formatTimeStringForSecond(this.leftTime):(this.txtLeftTime.string=GetLanguage(200026),this.canUpdate=!1)))},l.updateResShow=function(){0==this.lastItemNum&&this.resItems.update()},l.updateInfo=function(){var t,e=IS(L).getEggInfo(this.actType);if(e){var o=IS(L).GetActivityInfo(this.actType);this.txtTitle.string=p.formatStrWithMirrorDeal(GetLanguage(200284),e.ceng),this.btnOneKey.grayscale=e.ceng<y.one_click_break_gold_egg;for(var n,s=[],a=i(configBreak_gold_egg_layers.getDatas());!(n=a()).done;){var r=n.value;r.type==o.type&&r.group_id==o.roundCfg.group_id&&s.push(r)}s.sort((function(t,e){return t.layers-e.layers}));var d=(null!=(t=s.find((function(t){return t.layers==e.ceng})))?t:s[s.length-1]).num,h=R[d];this.layout.paddingLeft=h.left,this.layout.paddingTop=h.top,this.layout.constraintNum=h.num,this.layout.updateLayout(),0==e.choose_goods.gtid?(this.selectItem.node.active=!1,this.btnWear.active=!0):(this.selectItem.node.active=!0,this.btnWear.active=!1,this.selectItem.SetItemId(e.choose_goods.gtid,e.choose_goods.num));for(var l,c=[],u=i(configBreak_big_prize_preview.getDatas());!(l=u()).done;){var f=l.value;f.type==o.type&&c.push(f)}c.sort((function(t,e){return t.id-e.id}));for(var g=-1,m=0;m<c.length-5;m++){var v=c[m];if(e.ceng<=v.level[0])break;g=m}g++;for(var w=0;w<this.showList.length;w++){var T=c[g+w],I=T.good_id[0],C=T.good_id[1],S=T.level[0],G=e.ceng>S?3:1;this.showList[w].show([S,[I,C]],G)}for(var b=1;b<=this.rewardNum;b++)b<=d?(this.eggList[b].node.active=!0,this.eggList[b].show(e.pos_rewards[b])):this.eggList[b].node.active=!1;this.btnNextDoor.active=e.pos_rewards&&_.getPropertyCount(e.pos_rewards)==d,this.updateNumReward()}},l.updateNumReward=function(){for(var t,e=IS(L).getEggInfo(this.actType),o=IS(L).GetActivityInfo(this.actType),n=0,s=configBreak_cumulative_times.getDataByList("type",o.type),a=i(s);!(t=a()).done;){var r=t.value;if(!e.sum_rewards[r.id])break;n++}this.isGetReward.active=n>=s.length,n>=s.length&&n--,this.canGetReward.active=!e.sum_rewards[s[n].id]&&e.total>=s[n].cumulative_times,0==this.lastTaskNum&&(this.txtNum.string=p.formatStrWithMirrorDeal(GetLanguage(700030184),p.formatStrWithMirrorDeal(GetLanguage(700030185),e.total),s[n].cumulative_times)),this.rewardItem.SetItemId(s[n].reward[0],s[n].reward[1])},l.onEggOpenCallBack=function(t){var e=this;if(t.act_type==this.actType){var o=IS(x).GetDrawReward(this.actType),n=o[1]*t.cost_num;if(this.extraReward=[o[0],n],this.updateNumReward(),this.reward_list=[],this.skipAnim.active=!0,0==t.pos){this.reward_list=t.reward;var s=_.copyArray(t.pos_rewards);s.sort((function(t,e){return t.pos-e.pos}));!function i(o){var n=s[o],a=n.goods_id,r=n.goods_num;e.resItems.updateGtid(e.costId,e.lastItemNum-(o+1)),e.txtNum.string=p.formatStrWithMirrorDeal(GetLanguage(700030186),p.formatStrWithMirrorDeal(GetLanguage(700030185),e.lastTaskNum+o+1),e.lastTaskNum2),e.eggList[n.pos].doAnim(a,r,(function(){o==s.length-1||t.is_big==n.pos?(uiMgr.openView("GoodsGetView",e.reward_list,e.extraReward),e.skipAnim.active=!1,e.lastItemNum=0,e.lastTaskNum=0,e.updateInfo(),e.updateResShow()):i(o+1)}))}(0)}else if(0!=t.is_big){var a=t.pos_rewards.find((function(e){return e.pos==t.pos})),r=a.goods_id,d=a.goods_num;this.reward_list=t.reward,this.eggList[t.pos].doAnim(r,d,(function(){for(var o,n=i(t.pos_rewards);!(o=n()).done;){var s=o.value;if(s.pos!=t.pos){var a;a=function(){uiMgr.openView("GoodsGetView",e.reward_list,e.extraReward),e.skipAnim.active=!1,e.btnNextDoor.active=!0},e.eggList[s.pos].doAnim(s.goods_id,s.goods_num,a)}}}))}else{var h=t.pos_rewards.find((function(e){return e.pos==t.pos})),l=h.goods_id,c=h.goods_num;this.reward_list=t.reward,this.eggList[t.pos].doAnim(l,c,(function(){uiMgr.openView("GoodsGetView",e.reward_list,e.extraReward),e.skipAnim.active=!1}))}}},l.SkipAnim=function(){this.skipAnim.active=!1,this.lastItemNum=0,this.lastTaskNum=0,this.eggList.forEach((function(t){t.skipAnim()})),0!=this.reward_list.length&&(uiMgr.openView("GoodsGetView",this.reward_list,this.extraReward),this.reward_list=[]),this.updateInfo(),this.updateResShow()},o}(A)),function(){function t(){this.view=void 0,this.node=void 0,this.index=void 0,this.itemGrid=void 0,this.txtFloor=void 0,this.imgSelect=void 0,this.complete=void 0}var e=t.prototype;return e.init=function(t,e,i){this.view=e,this.node=t,this.index=i,this.onInit()},e.onInit=function(){this.itemGrid=new u(this.view,m.findChild(this.node,"itemGrid")),this.txtFloor=m.findChildComponent(this.node,"txtFloor",n),this.imgSelect=m.findChild(this.node,"imgSelect"),this.complete=m.findChild(this.node,"complete")},e.show=function(t,e){this.txtFloor.string=p.formatStrWithMirrorDeal(GetLanguage(200284),t[0]),this.itemGrid.SetItemId(t[1][0],t[1][1]),this.imgSelect.active=2==e,this.complete.active=3==e},t}()),D=function(){function t(){this.view=void 0,this.node=void 0,this.index=void 0,this.itemGrid=void 0,this.effNode=void 0,this.eff=void 0,this.timer=void 0,this.tween=void 0}var e=t.prototype;return e.init=function(t,e,i){this.view=e,this.node=t,this.index=i,this.onInit()},e.onInit=function(){var t=this;this.itemGrid=new u(this.view,m.findChild(this.node,"itemGrid")),this.effNode=m.findChild(this.node,"eff"),this.view.addComponentCallbackListener(this.node,s.EventType.CLICK,(function(){var e=IS(L).getEggInfo(t.view.actType);if(e){if(0==e.choose_goods.gtid)return uiMgr.openView("ActivityPoolPartyEggSelectView",t.view.actType),void S.showFlyTip(GetLanguage(202016));var i=y.break_gold_egg_expend.find((function(e){return e[0]==t.view.actType}))[1];if(IS(I).getGoodsCountByGoodsGtid(i[0])<i[1])return S.showFlyTip(GetLanguage(200069)),void uiMgr.openView("ActivityPoolPartyGiftView",t.view.actType);e.pos_rewards[t.index]||IS(G).send_egg_open(t.view.actType,t.index)}}))},e.show=function(t){if(!t){var e=IS(L).getEggInfo(this.view.actType);t=null==e?void 0:e.pos_rewards[this.index]}if(t){var i=this.view.getUIEffect(this.eff);if(i&&i.node)i.node.getComponent(w).setAnimation(0,"idle2",!0)}else{var o=this.view.getUIEffect(this.eff);if(o&&o.node)o.node.getComponent(w).setAnimation(0,"idle",!0)}},e.addEffect=function(){var t=this;this.itemGrid.node.active=!1,this.eff=this.view.addUIEffect("prefab/ui-effect/MX_tx_ycpd_zajindan",this.effNode,-1,new l(0,0),1,(function(e){var i=IS(L).getEggInfo(t.view.actType),o=null==i?void 0:i.pos_rewards[t.index];t.show(o)}))},e.doAnim=function(t,e,i){var o=this;this.removeTimer(),this.removeTween(),c.playSound("zajindan_kaibang");var n=this.view.getUIEffect(this.eff);n&&n.node&&n.node.getComponent(w).setAnimation(0,"skill1",!1);this.timer=this.view.addTimer(.5,0,(function(){o.itemGrid.node.active=!0,o.itemGrid.SetItemId(t,e),o.tween=o.view.addTween(0,1,.5,(function(t,e){o.itemGrid.node.setPosition(5,40*e+40)})).easing(N.SINE_OUT).call((function(){o.itemGrid.node.active=!1;var t=IS(L).getEggInfo(o.view.actType),e=null==t?void 0:t.pos_rewards[o.index];o.show(e),i&&i()}),.2).start()}))},e.skipAnim=function(){this.removeTimer(),this.removeTween(),this.itemGrid.node.active=!1},e.removeTimer=function(){this.timer&&(this.view.removeTimer(this.timer),this.timer=null)},e.removeTween=function(){this.tween&&(this.tween.stop(),this.tween=null)},t}();o._RF.pop()}}}));

