System.register("chunks:///_virtual/PetDataCache.ts",["cc","./AudioMgr.ts","./RedPointMgr.ts","./index57.ts","./ObjectUtil.ts","./BagDefine.ts","./RoleDataCache.ts","./RoleDefine.ts","./PetDefine.ts","./PetModel.ts","./UIDefine.ts"],(function(t){"use strict";var e,n,o,i,a,r,u,P,p,s,d,l,f;return{setters:[function(t){e=t.cclegacy,n=t.js},function(t){o=t.audioMgr},function(t){i=t.RedPointMgr},null,function(t){a=t.default},function(t){r=t.BagEventDefine,u=t.GoodsType},function(t){P=t.RoleDataCache},function(t){p=t.RoleEventDefine},function(t){s=t.PetEventDefine},function(t){d=t.PetModel},function(t){l=t.OpenFunction,f=t.PanelTabType}],execute:function(){var c;e._RF.push({},"7fa6b53NJJMWrLqMq9RoTaR","PetDataCache",void 0);var h=((c={})[1]="pos",c);t("PetDataCache",function(){var t=e.prototype;function e(){this.petIdToInfo=void 0,this.posToUnlock=void 0,this.petCfgIdToAttr=void 0,this.curTab=1,this.tabToInfo={},this.petIdToInfo={},this.posToUnlock={},this.petCfgIdToAttr={},normalEvent.on(r.GOODS_INFO_UPDATE,this.onGoodsInfoUpdate,this),normalEvent.on(p.ROLE_OPEN_FUNCTION_UPDATE,this.onRoleOpenFunctionUpdate,this)}return t.clear=function(){normalEvent.off(r.GOODS_INFO_UPDATE,this.onGoodsInfoUpdate,this),normalEvent.off(p.ROLE_OPEN_FUNCTION_UPDATE,this.onRoleOpenFunctionUpdate,this)},t.onGoodsInfoUpdate=function(t,e){var o=configGoods.getDataByKey(e);null!=o?o.type==u.Pet&&(this.updateAllUpgradeRedPoint(),this.updateAllComposeRedPoint()):printLogErr(n.formatStr("没有该道具配置-> %s",e))},t.onRoleOpenFunctionUpdate=function(t){t==l.FUNC_PET&&(this.updateAllPetEquipRedPoint(),this.updateAllUpgradeRedPoint(),this.updateAllComposeRedPoint())},t.updatePetInfo=function(t,e){if(!(t.length<=0)){for(var n,i,r,u=new Array,P=0;P<t.length;P++){var p=t[P],d=!1;n=p.pet_id;var l=this.petIdToInfo[n];a.isEmpty(l)?d=!0:(i=l.level,(r=p.level)>i&&u.push({petId:n,oriLevel:i,nowLevel:r})),this.petIdToInfo[n]=p,1==d?normalEvent.emit(s.PET_INFO_ADD,n):normalEvent.emit(s.PET_INFO_UPDATE,n)}u.length>0&&o.playSound("common_qianghua"),u.length>0&&null==uiMgr.getOpenView("PetInfoView")&&(u.sort((function(t,e){return t.petId<e.petId?-1:1})),uiMgr.openView("PetUpgradeFinishView",u)),e||normalEvent.emit(s.PET_LIST_UPDATE)}},t.updatePetPartData=function(t,e){if(null!=t&&!a.isEmpty(this.petIdToInfo[t])){for(var n=0;n<e.length;n++)this.petIdToInfo[t][h[e[n].k]]=e[n].v;normalEvent.emit(s.PET_INFO_UPDATE,t),normalEvent.emit(s.PET_LIST_UPDATE)}},t.updatePosUnlock=function(t,e){if(null!=t){for(var n=0;n<t.length;n++){var o=t[n];this.posToUnlock[o.k]=!0}1==e&&normalEvent.emit(s.PET_POS_UNLOCK)}},t.updatePetAttrInfo=function(t,e){if(!(null==e||e.length<=0)){this.petCfgIdToAttr[t]||(this.petCfgIdToAttr[t]={});for(var n=0;n<e.length;n++)this.petCfgIdToAttr[t][e[n].k]=e[n].v;normalEvent.emit(s.PET_ATTR_UPDATE,t)}},t.updatePetUpgradeRedPoint=function(t){IS(i).changeValue(n.formatStr("MainView/tab-%s/upgrade/pet-%s",f.Main_Partner,t),this.getPetUpgradeRedPoint(t))},t.getPetUpgradeRedPoint=function(t){return IS(P).CheckFuncOpen(l.FUNC_PET)&&IS(d).checkPetCanUpgrade(t)?1:0},t.updatePetUpgradeRootRedPoint=function(){IS(i).changeValue(n.formatStr("MainView/tab-%s/upgrade",f.Main_Partner),this.getAllPetUpgradeRedPoint()),IS(i).changeValue(n.formatStr("MainView/tab-%s",f.Main_Partner),this.getAllPetEquipRedPoint()+this.getAllPetUpgradeRedPoint()+this.getAllPetComposeRedPoint())},t.updateAllUpgradeRedPoint=function(){for(var t in this.petIdToInfo)this.updatePetUpgradeRedPoint(Number(t));this.updatePetUpgradeRootRedPoint()},t.getAllPetUpgradeRedPoint=function(){if(!IS(P).CheckFuncOpen(l.FUNC_PET))return 0;var t=0;for(var e in this.petIdToInfo)t+=this.getPetUpgradeRedPoint(Number(e));return t},t.updatePetEquipRedPoint=function(t){IS(i).changeValue(n.formatStr("MainView/tab-%s/equip/pos-%s",f.Main_Partner,t),this.getPetEquipRedPoint(t))},t.getPetEquipRedPoint=function(t){return IS(P).CheckFuncOpen(l.FUNC_PET)&&IS(d).checkPosUnlock(t)&&this.checkHasNoWearPet()&&null==IS(d).getPetByPos(t)?1:0},t.checkHasNoWearPet=function(){for(var t in this.petIdToInfo)if(IS(d).checkPetCanShow(Number(t))&&0==this.petIdToInfo[t].pos)return!0;return!1},t.updatePetEquipRootRedPoint=function(){IS(i).changeValue(n.formatStr("MainView/tab-%s/equip",f.Main_Partner),this.getAllPetEquipRedPoint()),IS(i).changeValue(n.formatStr("MainView/tab-%s",f.Main_Partner),this.getAllPetEquipRedPoint()+this.getAllPetUpgradeRedPoint()+this.getAllPetComposeRedPoint())},t.getAllPetEquipRedPoint=function(){if(!IS(P).CheckFuncOpen(l.FUNC_PET))return 0;var t=0;for(var e in this.posToUnlock)t+=this.getPetEquipRedPoint(Number(e));return t},t.updateAllPetEquipRedPoint=function(){for(var t in this.posToUnlock)this.updatePetEquipRedPoint(Number(t));this.updatePetEquipRootRedPoint()},t.updatePetComposeRedPoint=function(t){IS(i).changeValue(n.formatStr("MainView/tab-%s/compose/pet-%s",f.Main_Partner,t),this.getPetUpgradeRedPoint(t))},t.getPetComposeRedPoint=function(t){return IS(P).CheckFuncOpen(l.FUNC_PET)&&IS(d).checkPetCanCompose(t)?1:0},t.updatePetComposeRootRedPoint=function(){IS(i).changeValue(n.formatStr("MainView/tab-%s/compose",f.Main_Partner),this.getAllPetComposeRedPoint()),IS(i).changeValue(n.formatStr("MainView/tab-%s",f.Main_Partner),this.getAllPetEquipRedPoint()+this.getAllPetUpgradeRedPoint()+this.getAllPetComposeRedPoint())},t.updateAllComposeRedPoint=function(){for(var t in this.petIdToInfo)this.updatePetComposeRedPoint(Number(t));this.updatePetComposeRootRedPoint()},t.getAllPetComposeRedPoint=function(){if(!IS(P).CheckFuncOpen(l.FUNC_PET))return 0;var t=0;for(var e in this.petIdToInfo)t+=this.getPetComposeRedPoint(Number(e));return t},t.getSortAllPetList=function(){var t=[],e=configPet.getDatas();for(var n in e)IS(d).checkPetCanShow(e[n].id)&&t.push(e[n].id);return t.sort((function(t,e){var n=configPet.getDataByKey(t),o=configPet.getDataByKey(e);return n.quality!=o.quality?n.quality<o.quality?-1:1:t<e?-1:1})),t},e}());e._RF.pop()}}}));

