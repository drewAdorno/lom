System.register("chunks:///_virtual/ActivityLoopyMusicGameRankView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./index57.ts","./MessageView.ts","./FriendControl.ts","./RankControl.ts","./RankDefine.ts","./RankModel.ts","./RoleDataCache.ts","./RoleDefine.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./ActivityLoopyDataCache.ts","./BaseView.ts"],(function(t){"use strict";var n,i,e,o,a,r,s,d,h,c,f,l,m,u,k,v,R,y,I,p,C;return{setters:[function(t){n=t.inheritsLoose},function(t){i=t.cclegacy,e=t.Button,o=t.Label,a=t.Sprite,r=t.ScrollView,s=t.js},function(t){d=t.ListItem},function(t){h=t.default},function(t){c=t.default},null,function(t){f=t.default},function(t){l=t.default},function(t){m=t.default},function(t){u=t.RankDefine},function(t){k=t.RankModel},function(t){v=t.RoleDataCache},function(t){R=t.PlayerAttr},function(t){y=t.default},function(t){I=t.ActivityType},function(t){p=t.default},function(t){C=t.BaseView}],execute:function(){var x;i._RF.push({},"68dd3C3KztOtZjkUzyRXrGu","ActivityLoopyMusicGameRankView",void 0);var g="",S=((x={})[I.LoopyMusic]=!1,x),L=[1059,1060,1061,1062,1063],M=(t("default",function(t){function i(){var n;return(n=t.call(this)||this).tabBtns=[],n.actType=void 0,n.curIndex=0,n.nodeReward=void 0,n.nodeRank=void 0,n.nodeTopRank=void 0,n.nodeMyRank=void 0,n.rankList=void 0,n.txtMyRank=void 0,n.txtMyScore=void 0,n.myFrame=void 0,n.myIcon=void 0,n.txtMyName=void 0,n.txtServer=void 0,n.actInfo=void 0,n.rankId=0,n.rankInfo=void 0,n.curRankPage=void 0,n.name="ActivityLoopyMusicGameRankView",n.url="ui/module/activityLoopy/ActivityLoopyMusicGameRankView",n}n(i,t);var d=i.prototype;return d.onInit=function(){var t=this,n=this.findChild("imgMask");this.addComponentCallbackListener(n,e.EventType.CLICK,(function(){t.close()}));var i=this.findChild("btnClose");this.addComponentCallbackListener(i,e.EventType.CLICK,(function(){t.close()})),this.nodeReward=this.findChild("root/nodeReward"),this.nodeRank=this.findChild("root/nodeRank"),this.nodeTopRank=this.findChild("root/nodeTopRank"),this.nodeMyRank=this.findChild("root/myRank"),this.txtMyRank=this.findChildComponent("root/myRank/rankNum",o),this.txtMyScore=this.findChildComponent("root/myRank/score",o),this.txtMyName=this.findChildComponent("root/myRank/info/name",o),this.txtServer=this.findChildComponent("root/myRank/info/txtServer",o),this.myFrame=this.findChildComponent("root/myRank/imgFrame",a),this.myIcon=this.findChildComponent("root/myRank/imgFrame/imgIcon",a);var s=this.findChildComponent("root/nodeRank/rankList",r);this.rankList=this.addUIList(s,M),this.addComponentCallbackListener(s.node,r.EventType.SCROLL_TO_BOTTOM,(function(){if(t.curRankPage<t.rankInfo.max_page){t.curRankPage++;var n=new Array;n.push({type:t.rankId,server:1,page:t.curRankPage}),IS(m).reqRankList(n)}}));for(var d=function(n){var i=t.findChild("root/bottomBtn/item"+n),a={itemGo:i,normalTxt:h.findChildComponent(i,"normal/Label",o),selectTxt:h.findChildComponent(i,"selected/Label",o),normalGo:h.findChild(i,"normal"),selectedGo:h.findChild(i,"selected"),index:n-1};t.addComponentCallbackListener(i,e.EventType.CLICK,(function(){IS(p).act_day<n?f.showFlyTip(c.formatStrWithMirrorDeal(GetLanguage(201212),n)):t.SetIndex(a.index)})),a.normalTxt.string=c.formatStr(GetLanguage(300686),n),a.selectTxt.string=c.formatStr(GetLanguage(300686),n),t.tabBtns[n-1]=a},l=1;l<=5;l++)d(l)},d.registerUpdateHandler=function(){this.addEvent(u.RankInfoBack,this.UpdateRankInfo,this)},d.onAfterOpen=function(){this.actType=I.LoopyMusic,this.txtMyName.string=IS(v).GetRoleAttr(R.ROLE_ATTR_NAME),S[this.actType]?(this.txtMyName.node.setPosition(this.txtMyName.node.getPosition().x,0),this.txtServer.node.active=!1):(this.txtMyName.node.setPosition(this.txtMyName.node.getPosition().x,15),this.txtServer.node.active=!0,this.txtServer.string=s.formatStr("[s%s]",IS(v).GetRoleAttr(R.ROLE_ATTR_SERVER))),this.loadRemoteIcon(IS(v).GetRoleAttr(R.ROLE_ATTR_HEAD_URL),this.myIcon),this.actInfo=IS(y).GetActivityInfo(this.actType),this.ReqRankInfo()},d.onBeforeClose=function(){this.rankId=0,this.rankList.clearData(),this.curIndex>0&&(this.tabBtns[this.curIndex].normalGo.active=!0,this.tabBtns[this.curIndex].selectedGo.active=!1,this.curIndex=0)},d.onDestroy=function(){},d.ReqRankInfo=function(){this.rankId=L[this.curIndex];var t=configRanktype.getDataByKey(this.rankId);g=t.prefix;var n=new Array;n.push({type:this.rankId,server:1,page:1}),this.curRankPage=1,IS(m).reqRankList(n)},d.UpdateRankInfo=function(){if(this.rankInfo=IS(k).GetRankInfoByType(this.rankId),this.rankInfo){var t;this.txtMyRank.string=0!=this.rankInfo.my_info.rank?this.rankInfo.my_info.rank:GetLanguage(200037),this.txtMyScore.string=s.formatStr("%s%s",g,c.GetNumString(null!=(t=this.rankInfo.my_info.score)?t:0));for(var n=[],i=0;i<this.rankInfo.rank_list.length;i++)n.push(this.rankInfo.rank_list[i]);this.rankList.datas=n}},d.SetIndex=function(t){if(this.curIndex!=t){this.curIndex=t;for(var n=0;n<5;n++)n==this.curIndex?this.tabBtns[n].selectedGo.active=!0:this.tabBtns[n].selectedGo.active=!1;this.ReqRankInfo()}},i}(C)),function(t){function i(){for(var n,i=arguments.length,e=new Array(i),o=0;o<i;o++)e[o]=arguments[o];return(n=t.call.apply(t,[this].concat(e))||this).imgFrame=void 0,n.imgIcon=void 0,n.txtRank=void 0,n.txtName=void 0,n.txtServer=void 0,n.txtScore=void 0,n.rankIcon=void 0,n}n(i,t);var r=i.prototype;return r.onInit=function(){var t=this;this.imgFrame=h.findChildComponent(this.node,"imgFrame",a),this.imgIcon=h.findChildComponent(this.node,"imgFrame/imgIcon",a),this.txtRank=h.findChildComponent(this.node,"rankNum",o),this.txtName=h.findChildComponent(this.node,"info/name",o),this.txtServer=h.findChildComponent(this.node,"info/txtServer",o),this.txtScore=h.findChildComponent(this.node,"score",o),this.rankIcon=h.findChildComponent(this.node,"rankIcon",a),this.view.addComponentCallbackListener(this.imgFrame.node,e.EventType.CLICK,(function(){IS(l).reqOtherRoleNotice(t.data.belong_id)}))},r.onRender=function(t,n){this.view.loadRemoteIcon(t.head.url,this.imgIcon),this.txtName.string=t.name,this.txtServer.node.active=!0,this.txtServer.string=s.formatStr("[s%s]",t.serv_id),this.txtScore.string=g+c.GetNumString(t.score),this.txtRank.node.active=!0,this.txtRank.string=t.rank,t.rank<=3?(this.rankIcon.node.active=!0,this.txtRank.node.active=!1,this.view.loadIcon(this.rankIcon,"common","common_ICON_paiming0"+t.rank)):(this.rankIcon.node.active=!1,this.txtRank.node.active=!0,this.txtRank.string=t.rank)},r.onItemClick=function(){IS(l).reqOtherRoleNotice(this.data.info.belong_id)},i}(d));i._RF.pop()}}}));

