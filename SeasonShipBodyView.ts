System.register("chunks:///_virtual/SeasonShipBodyView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./V2.ts","./ItemGrid.ts","./UIList.ts","./RedPoint.ts","./RedPointMgr.ts","./NodeUtil.ts","./StringUtil.ts","./index57.ts","./ItemIcon.ts","./BagModel.ts","./MessageView.ts","./SeasonControl.ts","./SeasonDataCache.ts","./SeasonDefine.ts","./BaseView.ts"],(function(t){"use strict";var i,e,n,s,o,h,a,d,r,l,c,S,p,f,g,u,v,I,m,k,C,y,L,b,_;return{setters:[function(t){i=t.inheritsLoose,e=t.createForOfIteratorHelperLoose},function(t){n=t.cclegacy,s=t.Button,o=t.ScrollView,h=t.Vec2,a=t.Label,d=t.Layout,r=t.sys,l=t.Sprite},function(t){c=t.V2},function(t){S=t.ItemGrid},function(t){p=t.SelectedType,f=t.ListItem},function(t){g=t.RedPointType},function(t){u=t.RedPointMgr},function(t){v=t.default},function(t){I=t.default},null,function(t){m=t.IconAseetType},function(t){k=t.BagModel},function(t){C=t.default},function(t){y=t.default},function(t){L=t.SeasonDataCache},function(t){b=t.SeasonShipEventDefind},function(t){_=t.BaseView}],execute:function(){n._RF.push({},"9eecaowBnpE6J/R0FmGt9k7","SeasonShipBodyView",void 0);t("default",function(t){function n(){var i;return(i=t.call(this)||this).skinIDSel=1,i.starUIList=void 0,i.HorseUIList=void 0,i.ownUIList=void 0,i.useUIList=void 0,i.shipListInfo=void 0,i.btnUse=void 0,i.using=void 0,i.txtTips1=void 0,i.txtTips2=void 0,i.iconShip=void 0,i.btnTop=void 0,i.btnPreview=void 0,i.btnUnlock=void 0,i.btnUpgrade=void 0,i.Item=void 0,i.shipid=void 0,i.name="SeasonShipBodyView",i.url="ui/module/season/SeasonShipBodyView",i.poolTime=3e3,i}i(n,t);var l=n.prototype;return l.onInit=function(){var t=this,i=this.findChild("bottom/btnClose");this.addComponentCallbackListener(i,s.EventType.CLICK,(function(){t.close()}));var e=this.findChildComponent("bottom/startScrollView",o);this.starUIList=this.addUIList(e,D);var n=this.findChildComponent("bottom/nodeSkill/ScrollView",o);this.ownUIList=this.addUIList(n,U);var l=this.findChildComponent("bottom/nodeChange/ScrollView",o);this.useUIList=this.addUIList(l,U);var c=this.findChildComponent("bottom/ScrollView",o);this.HorseUIList=this.addUIList(c,w),this.HorseUIList.selectedMode=p.SINGLE,this.btnTop=this.findChild("bottom/nodeChange/btnTop"),this.btnPreview=this.findChild("bottom/nodeSkill/btnUpgrade"),this.addComponentCallbackListener(this.btnPreview,s.EventType.CLICK,(function(){uiMgr.openView("SeasonShipUpgradePreview",t.skinIDSel)})),this.btnUse=this.findChild("bottom/btnUse"),this.addComponentCallbackListener(this.btnUse,s.EventType.CLICK,(function(){IS(y).reqShipUse(t.skinIDSel)})),this.using=this.findChild("bottom/using"),this.btnUnlock=this.findChild("bottom/nodeChange/btnUnlock"),IS(u).addRedPoint("Season/Equip/body/lock",this.btnUnlock,new h(0,0),g.Dot),this.addComponentCallbackListener(this.btnUnlock,s.EventType.CLICK,(function(){var i=IS(L).getSkinLevelByID(t.skinIDSel),e=configSeason_ship_skin.getDataByKeys("mount_id",t.skinIDSel,"skin_level",i);IS(k).getGoodsCountByGoodsGtid(e.expend[0][0])>=e.expend[0][1]?IS(y).reqShipSkinLevelUp(t.skinIDSel):C.showFlyTip(GetLanguage(200069))})),this.btnUpgrade=this.findChild("bottom/nodeChange/btnUpgrade"),IS(u).addRedPoint("Season/Equip/body/upgrade",this.btnUpgrade,new h(0,0),g.Dot),this.addComponentCallbackListener(this.btnUpgrade,s.EventType.CLICK,(function(){var i=IS(L).getSkinLevelByID(t.skinIDSel),e=configSeason_ship_skin.getDataByKeys("mount_id",t.skinIDSel,"skin_level",i);IS(k).getGoodsCountByGoodsGtid(e.expend[0][0])>=e.expend[0][1]?IS(y).reqShipSkinLevelUp(t.skinIDSel):C.showFlyTip(GetLanguage(200069))}));var f=this.findChild("bottom/nodeChange/itemGrid");this.Item=new S(this,f),this.iconShip=this.findChild("bottom/icon"),this.txtTips1=this.findChildComponent("bottom/nodeSkill/common_ui_xiaotidi/txtName",a),this.txtTips2=this.findChildComponent("bottom/nodeChange/common_ui_xiaotidi/txtName",a);for(var v=this.node.getComponentsInChildren(d),I=0;I<v.length;I++)1==v[I].type&&this.dealMirrorLayout(v[I]);r.uiMirror&&this.iconShip.setScale(-1,1,1)},l.registerUpdateHandler=function(){this.addEvent(b.TYPE_SHIP_BODY_SKIN_SEL,this.refreshShipShowChange,this),this.addEvent(b.TYPE_SHIP_BODY_SKIN_INFO_UPDATE,this.refreshShipShowChange,this),this.addEvent(b.SHIP_EQUIP_LIST_UPDATE,this.showShipModel,this),this.addEvent(b.TYPE_SHIP_FIGURE_CHANGE_UPDATE,this.showShipModel,this)},l.rebuildHorseList=function(){var t=configSeason_ship_skin.getDataByList("skin_level",1),i=0;this.shipListInfo=[];for(var n,s=e(t.entries());!(n=s()).done;){var o=n.value,h=(o[0],o[1]);if(IS(L).checkShipSkinCanShow(h.mount_id)){var a=IS(L).getSkinLevelByID(h.mount_id);this.shipListInfo.push({skin:h.mount_id,level:a,state:IS(L).getShipSkinState(h.mount_id)})}}this.shipListInfo.sort((function(t,i){return t.state>i.state?-1:1}));for(var d,r=e(this.shipListInfo.entries());!(d=r()).done;){var l=d.value,c=l[0];l[1].skin==this.skinIDSel&&(i=c)}return i},l.onAfterOpen=function(){this.refreshStarShow(),this.refreshAttrShow(),this.showShipModel(),this.refreshBtnShow()},l.refreshShipShowChange=function(t){this.skinIDSel=t,this.refreshStarShow(),this.refreshAttrShow(),this.showShipModel(),this.refreshBtnShow()},l.refreshAttrShow=function(){var t=IS(L).getSkinLevelByID(this.skinIDSel),i=configSeason_ship_skin.getDataByKeys("mount_id",this.skinIDSel,"skin_level",t),e=configSeason_ship_skin.getDataByKeys("mount_id",this.skinIDSel,"skin_level",t+1);if(0==t?(this.ownUIList.datas=e.attr,this.useUIList.datas=e.use_attr,this.txtTips1.string=GetLanguage(204238),this.txtTips2.string=GetLanguage(204238)):(this.ownUIList.datas=i.attr,this.useUIList.datas=i.use_attr,this.txtTips1.string=GetLanguage(204239),this.txtTips2.string=GetLanguage(204239)),null!=e){this.btnTop.active=!1,this.btnPreview.active=!0,this.Item.node.active=!0,this.btnUnlock.active=!1,this.btnUpgrade.active=!0,0==IS(L).getSkinLevelByID(this.skinIDSel)&&(this.btnUnlock.active=!0,this.btnUpgrade.active=!1),this.Item.SetItemId(i.expend[0][0],0);var n=IS(k).getGoodsCountByGoodsGtid(i.expend[0][0]),s=i.expend[0][1];this.findChildComponent("bottom/nodeChange/itemGrid/num",a).string=n+"/"+s}else this.btnPreview.active=!1,this.Item.node.active=!1,this.btnUnlock.active=!1,this.btnUpgrade.active=!1,this.btnTop.active=!0;IS(L).checkShipBodyRP()},l.refreshStarShow=function(){this.findChild("bottom/icon");var t=this.findChildComponent("bottom/bgName/txtName",a),i=this.rebuildHorseList();this.HorseUIList.datas=this.shipListInfo,this.HorseUIList.scrollTo(i);var e=configSeason_ship.getDataByKey(this.skinIDSel);t.string=e.name;for(var n=[0,0,0,0,0],s=0;s<IS(L).getSkinLevelByID(this.skinIDSel);s++){n[s%5]+=1}this.starUIList.datas=n},l.showShipModel=function(){this.shipid&&this.removeShipModel(this.shipid);var t=IS(L).getShipShowFigureInfo();this.shipid=this.addShipModel({shipId:this.skinIDSel,flag:t.flag,ram:t.ram,parent:this.iconShip,gunId:t.gunId},c.ZERO,.5)},l.refreshBtnShow=function(){for(var t,i=IS(L).skin_list,n=this.skinIDSel==IS(L).cur_ship_skin,s=!1,o=e(i);!(t=o()).done;){if(t.value.skin_id==this.skinIDSel){s=!0;break}}var h=IS(L).getShipSkinState(this.skinIDSel);v.findChild(this.btnUpgrade,"rp").active=5==h,v.findChild(this.btnUnlock,"rp").active=5==h,this.using.active=s&&n,this.btnUse.active=s&&!n},l.onBeforeClose=function(){},l.onDestroy=function(){},n}(_));var U=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return(i=t.call.apply(t,[this].concat(n))||this).txtName=void 0,i.txtAttr=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){this.txtName=v.findChildComponent(this.node,"name",a),this.txtAttr=v.findChildComponent(this.node,"attr",a)},n.onRender=function(t,i){var e=configAttribute.getDataByKey(t[0]),n=1==e.num_type?"":"%";this.txtName.string=e.name,2==e.show_type?this.txtAttr.string=I.formatStr("+##1##2",I.GetNumString(t[1]/100),n):3==e.show_type?this.txtAttr.string=I.formatStr("+##1",I.GetNumString(Math.floor(t[1]/100)/100)):this.txtAttr.string=I.formatStr("+##1##2",I.GetNumString(t[1]),n)},e}(f),w=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return(i=t.call.apply(t,[this].concat(n))||this).imgFrame=void 0,i.imgIcon=void 0,i.imgLock=void 0,i.imgRP=void 0,i.nodeUse=void 0,i.nodeSel=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){this.imgFrame=v.findChildComponent(this.node,"frame",l),this.imgIcon=v.findChildComponent(this.node,"icon",l),this.imgLock=v.findChild(this.node,"lock"),this.imgRP=v.findChild(this.node,"rp"),this.nodeUse=v.findChild(this.node,"nodeUse"),this.nodeSel=v.findChild(this.node,"sel")},n.onRender=function(t,i){var e,n;this.data=t;var s=null!=(e=configSeason_ship.getDataByKey(this.data.skin).icon)?e:"",o=null!=(n=configSeason_ship.getDataByKey(this.data.skin).quality)?n:1,h=configColor.getDataByKey(o).big_path;this.view.loadIcon(this.imgFrame,"icon_equip",h),this.view.loadIcon(this.imgIcon,"season_equip",s,null,m.ICON_SPRITE),this.checkState();var a=this.view;this.nodeSel.active=a.skinIDSel==this.data.skin},n.checkState=function(){this.imgLock.active=!1,this.imgRP.active=!1,this.imgFrame.grayscale=!1,this.imgIcon.grayscale=!1,this.nodeUse.active=!1,1==this.data.state?(this.imgLock.active=!0,this.imgFrame.grayscale=!0,this.imgIcon.grayscale=!0):5==this.data.state&&(this.imgRP.active=!0),this.data.skin==IS(L).cur_ship_skin&&(this.nodeUse.active=!0)},n.onItemClick=function(){this.view.skinIDSel!=this.data.skin&&normalEvent.emit(b.TYPE_SHIP_BODY_SKIN_SEL,this.data.skin)},e}(f),D=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return(i=t.call.apply(t,[this].concat(n))||this).imgOne=void 0,i.imgTwo=void 0,i.imgThree=void 0,i.imgDark=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){this.imgOne=v.findChild(this.node,"one"),this.imgTwo=v.findChild(this.node,"two"),this.imgThree=v.findChild(this.node,"three"),this.imgDark=v.findChild(this.node,"dark")},n.onRender=function(t,i){this.imgDark.active=0==t,this.imgOne.active=1==t,this.imgTwo.active=2==t,this.imgThree.active=3==t},n.onItemClick=function(){},e}(f);n._RF.pop()}}}));

