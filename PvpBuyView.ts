System.register("chunks:///_virtual/PvpBuyView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./StringUtil.ts","./index57.ts","./ConfigGlobal.ts","./BagModel.ts","./ChapterDefine.ts","./MessageView.ts","./PvpControl.ts","./PvpDataCache.ts","./BaseView.ts"],(function(t){"use strict";var i,o,n,e,s,a,u,c,r,h,d,l,m,g,f,p;return{setters:[function(t){i=t.inheritsLoose},function(t){o=t.cclegacy,n=t.Button,e=t.Sprite,s=t.Label,a=t.RichText,u=t.EditBox,c=t.js},function(t){r=t.default},null,function(t){h=t.ConfigGlobal},function(t){d=t.BagModel},function(t){l=t.DungeonDefine},function(t){m=t.default},function(t){g=t.default},function(t){f=t.PvpDataCache},function(t){p=t.BaseView}],execute:function(){o._RF.push({},"5544eiL9LlAgq85Lpfx0rfX","PvpBuyView",void 0);t("default",function(t){function o(){var i;return(i=t.call(this)||this).txtPrice=void 0,i.editBox=void 0,i.imgFrame=void 0,i.imgIcon=void 0,i.priceIcon=void 0,i.txtNum=void 0,i.txtName=void 0,i.data=void 0,i.buyNum=1,i.goodID=void 0,i.name="PvpBuyView",i.url="ui/module/pvp/PvpBuyView",i}i(o,t);var p=o.prototype;return p.onInit=function(){var t=this,i=this.findChild("imgMask");this.addComponentCallbackListener(i,n.EventType.CLICK,(function(){t.onCloseClick()})),this.imgFrame=this.findChildComponent("item/imgFrame",e),this.imgIcon=this.findChildComponent("item/imgIcon",e),this.txtNum=this.findChildComponent("item/txtNum",s),this.txtName=this.findChildComponent("item/txtName",s),this.txtPrice=this.findChildComponent("price",a),this.priceIcon=this.findChildComponent("price/imgIcon",e),this.editBox=this.findChildComponent("EditBox",u),this.addComponentCallbackListener(this.editBox.node,u.EventType.EDITING_DID_ENDED,(function(){var i=Number(t.editBox.string);(isNaN(i)||i<=1)&&(i=1),t.buyNum=Math.floor(i),t.changeNum()}));var o=this.findChild("btnBuy");this.addComponentCallbackListener(o,n.EventType.CLICK,(function(){t.BuyClick()}));var c=this.findChild("btnAdd");this.addComponentCallbackListener(c,n.EventType.CLICK,(function(){t.changeNum(1)}));var r=this.findChild("btnMinus");this.addComponentCallbackListener(r,n.EventType.CLICK,(function(){t.changeNum(-1)}))},p.onCloseClick=function(){this.close()},p.registerUpdateHandler=function(){},p.onAfterOpen=function(){this.data=this.openArgs[0],this.buyNum=0,this.txtNum.string=this.data.goods[1],this.goodID=this.data.goods[0];var t=this.data.goods[0],i=configGoods.getDataByKey(t),o=i.quality,n=configColor.getDataByKey(o);this.txtName.string=i.name,this.loadIcon(this.imgIcon,i.icon_group,i.icon),this.loadIcon(this.imgFrame,"icon_equip",n.path);var e=configGoods.getDataByKey(this.data.price[0]);this.loadIcon(this.priceIcon,e.icon_group,e.icon),this.changeNum()},p.onBeforeClose=function(){},p.onDestroy=function(){},p.BuyClick=function(){for(var t=this.data.price[0],i=IS(d).getGoodsCountByGoodsGtid(t),o=this.getTimes(),n=this.getPrice(),e=0,s=o;s<o+this.buyNum;s++)e+=n[s];if(i>=e)console.log("arena",this.buyNum),1006==this.goodID?IS(g).reqBuyTicket(l.CHAPTER_TYPE_PVP,this.buyNum):1037==this.goodID&&IS(g).reqBuyTicket(l.CHAPTER_TYPE_CROSS_PVP,this.buyNum),this.close();else{var a=configGoods.getDataByKey(t);m.showFlyTip(r.formatStrWithMirrorDeal(GetLanguage(200453),a.name))}},p.changeNum=function(t){null!=t&&(this.buyNum=this.buyNum+t);var i=this.getTimes(),o=this.getPrice();this.buyNum=Math.min(o.length-i,Math.max(this.buyNum,1)),null!=t&&(this.txtNum.string=String(this.buyNum)),this.editBox.string=String(this.buyNum);for(var n=IS(d).getGoodsCountByGoodsGtid(this.data.price[0]),e=0,s=i;s<i+this.buyNum;s++)e+=o[s];var a="#2dc05a";n<e&&(a="#DB0C0C"),this.txtPrice.string=c.formatStr("<b><color=%s>%s</color></b>",a,e)},p.getTimes=function(){var t=0;return 1006==this.goodID?t=IS(f).buy_times:1037==this.goodID&&(t=IS(f).buy_times_cross),t},p.getPrice=function(){var t=[];return 1006==this.goodID?t=h.pvp_ticket_price:1037==this.goodID&&(t=h.cross_pvp_ticket_price),t},o}(p));o._RF.pop()}}}));

