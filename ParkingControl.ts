System.register("chunks:///_virtual/ParkingControl.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BattleData.ts","./BattleDataFill.ts","./EnumDefine.ts","./StringUtil.ts","./index57.ts","./BattleMainServer.ts","./TimeUtil.ts","./ControlMgr.ts","./ChapterControl.ts","./ChapterDataCache.ts","./ChapterDefine.ts","./MessageView.ts","./MainViewModel.ts","./PvpDataCache.ts","./RoleDataCache.ts","./SdkControl.ts","./ParkingDataCache.ts","./ParkingDefine.ts","./UIDefine.ts"],(function(a){"use strict";var r,e,t,_,n,s,c,i,o,p,k,d,l,u,f,v,h,P,g,m,I,E;return{setters:[function(a){r=a.createForOfIteratorHelperLoose},function(a){e=a.cclegacy},function(a){t=a.ChapterType,_=a.PlayerData,n=a.BattleData},function(a){s=a.BattleDataFill},function(a){c=a.RunState},function(a){i=a.default},null,function(a){o=a.BattleMainServer},function(a){p=a.default},function(a){k=a.controlMgr},function(a){d=a.default},function(a){l=a.ChapterDataCache},function(a){u=a.ChapterEventDefine},function(a){f=a.default,v=a.TYPE_YES},function(a){h=a.MainViewModel},function(a){P=a.PvpDataCache},function(a){g=a.RoleDataCache},null,function(a){m=a.ParkingDataCache},function(a){I=a.ParkingEventDefine},function(a){E=a.PanelTabType}],execute:function(){e._RF.push({},"ccb8fTFg/1BQZNfvrJcNY0C","ParkingControl",void 0);a("default",function(){var a=e.prototype;function e(){netManager.addEventListener("car_park.car_park_info_s2c",this.on_car_park_info_s2c,this),netManager.addEventListener("car_park.car_park_car_info_s2c",this.on_car_park_car_info_s2c,this),netManager.addEventListener("car_park.car_park_car_up_s2c",this.on_car_park_car_up_s2c,this),netManager.addEventListener("car_park.car_park_parking_start_s2c",this.on_car_park_parking_start_s2c,this),netManager.addEventListener("car_park.car_park_parking_stop_s2c",this.on_car_park_parking_stop_s2c,this),netManager.addEventListener("car_park.car_park_combat_s2c",this.on_car_park_combat_s2c,this),netManager.addEventListener("car_park.car_park_search_s2c",this.on_car_park_search_s2c,this),netManager.addEventListener("car_park.car_park_protect_s2c",this.on_car_park_protect_s2c,this),netManager.addEventListener("car_park.car_park_skin_use_s2c",this.on_car_park_skin_use_s2c,this),netManager.addEventListener("car_park.car_park_history_s2c",this.on_car_park_history_s2c,this),netManager.addEventListener("car_park.car_park_report_s2c",this.on_car_park_report_s2c,this),netManager.addEventListener("car_park.car_park_look_s2c",this.on_car_park_look_s2c,this),netManager.addEventListener("car_park.car_park_video_play_s2c",this.on_car_park_video_play_s2c,this),netManager.addEventListener("car_park.car_park_rename_s2c",this.on_car_park_rename_s2c,this),netManager.addEventListener("car_park.car_park_collect_s2c",this.on_car_park_collect_s2c,this),netManager.addEventListener("car_park.car_park_mount_id_s2c",this.on_car_park_mount_id_s2c,this),netManager.addEventListener("car_park.car_park_result_s2c",this.on_car_park_result_s2c,this),netManager.addEventListener("car_park.car_park_skin_up_s2c",this.on_car_park_skin_up_s2c,this),netManager.addEventListener("car_park.car_park_parking_help_s2c",this.on_car_park_parking_help_s2c,this),netManager.addEventListener("car_park.cross_car_park_preview_s2c",this.on_cross_car_park_preview_s2c,this),netManager.addEventListener("car_park.cross_car_park_info_s2c",this.on_cross_car_park_info_s2c,this),netManager.addEventListener("car_park.cross_car_park_parking_start_s2c",this.on_cross_car_park_parking_start_s2c,this),netManager.addEventListener("car_park.cross_car_park_parking_stop_s2c",this.on_cross_car_park_parking_stop_s2c,this),netManager.addEventListener("car_park.cross_car_park_battle_queue_s2c",this.on_cross_car_park_battle_queue_s2c,this),netManager.addEventListener("car_park.cross_car_park_look_fighting_s2c",this.on_cross_car_park_look_fighting_s2c,this),netManager.addEventListener("car_park.cross_car_park_report_list_s2c",this.on_cross_car_park_report_list_s2c,this),netManager.addEventListener("car_park.cross_car_park_role_state_s2c",this.on_cross_car_park_role_state_s2c,this),netManager.addEventListener("car_park.cross_car_park_rank_s2c",this.on_cross_car_park_rank_s2c,this),netManager.addEventListener("car_park.cross_car_park_settle_s2c",this.on_cross_car_park_settle_s2c,this),netManager.addEventListener("car_park.cross_car_park_video_play_s2c",this.on_cross_car_park_video_play_s2c,this),netManager.addEventListener("car_park.cross_car_park_next_time_s2c",this.on_cross_car_park_next_time_s2c,this),netManager.addEventListener("car_park.cross_car_park_merge_time_s2c",this.on_cross_car_park_merge_time_s2c,this),k.addControl(this)}return a.clear=function(){throw new Error("Method not implemented.")},a.onLogin=function(){this.reqCarListInfo(),this.reqCrossParkPreview(),this.reqCrossParkRoleState(0),this.reqCrossParkRoleState(1),this.reqCrossNextStamp()},a.onReconnect=function(){this.reqCarListInfo(),this.reqCrossParkPreview(),this.reqCrossNextStamp()},a.sendReadList=function(a){netManager.send("car_park.car_park_read_c2s",{nid_list:a})},a.sendLookList=function(a){netManager.send("car_park.car_park_look_c2s",{vid_list:a})},a.reqParkingInfo=function(a,r,e){void 0===e&&(e=0),netManager.send("car_park.car_park_info_c2s",{type:a,master_id:r,ceng:e})},a.reqCarListInfo=function(){netManager.send("car_park.car_park_car_info_c2s",{})},a.reqCarLevelUp=function(a,r){netManager.send("car_park.car_park_car_up_c2s",{mount_id:a,cost_num:r})},a.reqStartPark=function(a,r,e,t,_,n){netManager.send("car_park.car_park_parking_start_c2s",{type:a,master_id:r,mount_id:e,pos:t,is_protect:_,is_replace:n})},a.reqParkStop=function(a){netManager.send("car_park.car_park_parking_stop_c2s",{mount_id:a})},a.reqParkCombat=function(a,r,e){var _=IS(l);0==_.currentLoadType&&(_.chapterType=t.ParkPvp,_.currentLoadType=_.chapterType,_.battleData=null,netManager.send("car_park.car_park_combat_c2s",{type:a,master_id:r,pos:e}),normalEvent.emit(u.BATTLE_STATE,t.ParkPvp,!0))},a.reqParkResult=function(a,r){netManager.send("car_park.car_park_result_c2s",{win_id:a,hp:r})},a.reqParkSearch=function(a,r){netManager.send("car_park.car_park_search_c2s",{type:a,park_name:r})},a.reqTaxSetting=function(a){netManager.send("car_park.car_park_protect_c2s",{protect:a})},a.reqParkSkinUse=function(a,r,e,t){void 0===t&&(t={x:0,y:0}),netManager.send("car_park.car_park_skin_use_c2s",{type:a,skin_id:r,is_use:e,pos:t})},a.reqParkHistory=function(){netManager.send("car_park.car_park_history_c2s",{})},a.reqParkReport=function(){netManager.send("car_park.car_park_report_c2s",{})},a.reqParkVideoPlay=function(a,r){var e=IS(l);0==e.currentLoadType&&(e.chapterType=t.ParkPvp,e.currentLoadType=e.chapterType,e.battleData=null,netManager.send("car_park.car_park_video_play_c2s",{vid:a,source:r}),normalEvent.emit(u.BATTLE_STATE,t.ParkPvp,!0))},a.reqShowCar=function(a){netManager.send("car_park.car_park_mount_id_c2s",{mount_id:a})},a.reqParkRename=function(a){netManager.send("car_park.car_park_rename_c2s",{name:a})},a.reqParkCollect=function(a,r){netManager.send("car_park.car_park_collect_c2s",{role_id:r,code:a})},a.reqSkinUp=function(a,r){netManager.send("car_park.car_park_skin_up_c2s",{type:a,skin_id:r})},a.reqSpaceUpdate=function(){netManager.send("car_park.car_park_space_update_c2s",{})},a.reqHelpStop=function(a,r){netManager.send("car_park.car_park_parking_help_c2s",{car_role_id:a,pos:r})},a.on_car_park_info_s2c=function(a){var e=IS(m);e.type=a.type,e.master_id=a.master_id,e.ceng=a.ceng,e.name=a.name,e.show_car=a.show_car,e.space_num=a.space_num,e.space_list=a.space_list,e.skin_list=a.skin_list,e.protect=a.protect,e.serv_id=IS(g).GetServerId(),e.extInfo=a.ext;for(var t,_=r(a.ext);!(t=_()).done;){var n=t.value;1==n.k&&(e.is_collect=n.v)}e.info_list=a.info_list,normalEvent.emit(I.PARKING_CUR_PARKING_INFO_UPDATE),IS(m).checkOpenRobView()},a.on_car_park_car_info_s2c=function(a){IS(m).initCarList(a.car_list)},a.on_car_park_car_up_s2c=function(a){IS(m).updateCarList(a.update_car)},a.on_car_park_parking_start_s2c=function(a){a.master_id==IS(m).master_id&&(IS(m).space_list.push(a.space),normalEvent.emit(I.PARKING_CUR_PARKING_INFO_UPDATE)),uiMgr.close("ParkingPayTaxView"),uiMgr.close("ParkingHorseParkManageView")},a.on_car_park_parking_stop_s2c=function(a){if(a.master_id==IS(m).master_id){for(var e,t=[],_=r(IS(m).space_list);!(e=_()).done;){var n=e.value;n.role_id==a.space.role_id&&n.mount_id==a.space.mount_id?t.push(a.space):t.push(n)}IS(m).space_list=t,normalEvent.emit(I.PARKING_CUR_PARKING_INFO_UPDATE)}this.reqParkingInfo(IS(m).type,IS(m).master_id)},a.setPlayerList=function(a,r){s.setPlayerList(a,r,IS(l).chapterType)},a.on_car_park_combat_s2c=function(a){var r=IS(l);if(r.currentLoadType==t.ParkPvp){if(r.currentLoadType=0,a.code>0||!a.atk_data||!a.def_data)return IS(d).reqEnterChapter(0),normalEvent.emit(u.BATTLE_STATE,t.Main,!1),IS(h).TryJumpToMainViewPanel(E.Main_Mystery),void uiMgr.openView("ParkingMainView",IS(m).type,IS(m).master_id);var e=new n;e.chapterId=100001,e.seed=a.seed,e.chapterType=t.ParkPvp,e.playerList[1]=new _(1),e.playerList[2]=new _(2),this.setPlayerList(a.atk_data,e.playerList[1]),this.setPlayerList(a.def_data,e.playerList[2]);var s=new o(a.seed);for(s.start(e);s.runState==c.Running;)s.update(s.frameTime);var i=s.chapter.arenaPlayerCtr.player.data.currenHp;this.reqParkResult(0==s.result?a.atk_data.id:a.def_data.id,i),s.stop();var p=new n;p.chapterType=t.ParkPvp,p.chapterId=100001,p.seed=a.seed,p.playerList[1]=new _(1),p.playerList[2]=new _(2),p.battleCheckout=2,this.setPlayerList(a.atk_data,p.playerList[1]),this.setPlayerList(a.def_data,p.playerList[2]),r.battleData=p}},a.on_car_park_result_s2c=function(a){var r={isWin:1==a.is_win,objs:[{name:IS(g).GetRoleName(),head:IS(g).GetHeadUrl()},{name:a.e_name,head:null!=a.e_head?a.e_head.url:""}]};IS(P).result=r},a.on_car_park_search_s2c=function(a){var r=IS(m);r.null_space=a.null_space,r.collect_space=a.collect_space,normalEvent.emit(I.PARKING_SPACE_UPDATE)},a.on_car_park_protect_s2c=function(a){IS(m).protect=a.protect,uiMgr.close("ParkingTaxSettingView")},a.on_car_park_skin_use_s2c=function(a){var e=IS(m);if(e.type==a.type){for(var t,_=[],n=r(a.skin_list);!(t=n()).done;){for(var s,c=t.value,i=!1,o=r(e.skin_list);!(s=o()).done;){s.value.skin_id==c.skin_id&&(i=!0,_.push(c))}i||_.push(c)}for(var p,k=r(e.skin_list);!(p=k()).done;){for(var d,l=p.value,u=!1,f=r(a.skin_list);!(d=f()).done;){var v=d.value;l.skin_id==v.skin_id&&(u=!0)}u||_.push(l)}e.skin_list=_,normalEvent.emit(I.PARKING_SKIN_INFO_CHANGE)}},a.on_car_park_history_s2c=function(a){IS(m).record_list=a.record_list.reverse(),normalEvent.emit(I.PARKING_LOG_UPDATE)},a.on_car_park_report_s2c=function(a){IS(m).history_list=a.history_list.reverse(),normalEvent.emit(I.PARKING_RECORD_UPDATE)},a.on_car_park_look_s2c=function(a){normalEvent.emit(I.PARKING_RECORD_READ)},a.on_car_park_video_play_s2c=function(a){var r=IS(l);if(r.currentLoadType==t.ParkPvp&&(r.currentLoadType=0,0==a.code)){uiMgr.close("ChatView"),battleMain.enterChapter(0);var e=new n;e.chapterId=100001,e.seed=a.seed,e.chapterType=t.ParkPvp,e.recordType=i.isEmpty(a.collects)?1:2,e.source=a.source,e.collects=a.collects,e.recordWin=a.winner_id==a.atk_data.id?1:2,e.playerList[1]=new _(1),e.playerList[2]=new _(2),this.setPlayerList(a.atk_data,e.playerList[1]),this.setPlayerList(a.def_data,e.playerList[2]),r.battleData=e,normalEvent.emit(u.BATTLE_STATE,t.ParkPvp,!0)}},a.on_car_park_rename_s2c=function(a){IS(m).name=a.name,normalEvent.emit(I.PARKING_NAME_ROOT_INFO_CHANGE)},a.on_car_park_collect_s2c=function(a){a.role_id==IS(m).master_id&&(IS(m).is_collect=a.code,normalEvent.emit(I.PARKING_NAME_ROOT_INFO_CHANGE))},a.on_car_park_mount_id_s2c=function(a){IS(m).show_car=a.mount_id,normalEvent.emit(I.PARKING_CUR_PARKING_INFO_UPDATE)},a.on_car_park_skin_up_s2c=function(a){var e=IS(m);if(e.type==a.type){for(var t,_=[],n=r(a.skin_list);!(t=n()).done;){for(var s,c=t.value,i=!1,o=r(e.skin_list);!(s=o()).done;){s.value.skin_id==c.skin_id&&(i=!0,_.push(c))}i||_.push(c)}for(var p,k=r(e.skin_list);!(p=k()).done;){for(var d,l=p.value,u=!1,f=r(a.skin_list);!(d=f()).done;){var v=d.value;l.skin_id==v.skin_id&&(u=!0)}u||_.push(l)}e.skin_list=_,normalEvent.emit(I.PARKING_SKIN_INFO_CHANGE)}},a.on_car_park_space_update_s2c=function(a){var e=IS(m);if(e.type==a.type&&e.master_id==a.master_id){for(var t,_=[],n=!1,s=r(e.space_list);!(t=s()).done;){t.value.pos==a.space.pos&&(n=!0,_.push(a.space))}n||_.push(a.space),e.space_list=_,normalEvent.emit(I.PARKING_SPOT_INFO_UPDATE)}},a.on_car_park_parking_help_s2c=function(){uiMgr.close("ParkingRobView")},a.reqCrossParkPreview=function(){netManager.send("car_park.cross_car_park_preview_c2s",{})},a.reqCrossParkDetail=function(a){netManager.send("car_park.cross_car_park_info_c2s",{id:a})},a.reqCrossParkStart=function(a,r,e){netManager.send("car_park.cross_car_park_parking_start_c2s",{id:a,mount_id:r,pos:e})},a.reqCrossParkStop=function(a){netManager.send("car_park.cross_car_park_parking_stop_c2s",{mount_id:a})},a.reqCrossParkBattleQueue=function(a,r){netManager.send("car_park.cross_car_park_battle_queue_c2s",{type:a,id:r})},a.reqCrossParkBattleJoin=function(a,r,e){netManager.send("car_park.cross_car_park_queue_join_c2s",{type:a,id:r,action:e})},a.reqCrossParkBattleTop=function(a){netManager.send("car_park.cross_car_park_queue_stick_c2s",{id:a})},a.reqCrossParkBattleLook=function(a){netManager.send("car_park.cross_car_park_look_fighting_c2s",{id:a})},a.reqCrossParkReportList=function(a){netManager.send("car_park.cross_car_park_report_list_c2s",{id:a})},a.reqCrossParkRoleState=function(a){netManager.send("car_park.cross_car_park_role_state_c2s",{type:a})},a.reqCrossParkRank=function(){netManager.send("car_park.cross_car_park_rank_c2s",{})},a.reqCrossVideoPlay=function(a){var r=IS(l);0==r.currentLoadType&&(r.chapterType=t.CrossParkPvp,r.currentLoadType=r.chapterType,r.battleData=null,netManager.send("car_park.cross_car_park_video_play_c2s",{vid:a}),normalEvent.emit(u.BATTLE_STATE,t.CrossParkPvp,!0))},a.reqCrossNextStamp=function(){netManager.send("car_park.cross_car_park_next_time_c2s",{})},a.reqCrossMergeTime=function(){netManager.send("car_park.cross_car_park_merge_time_c2s",{},!0)},a.on_cross_car_park_preview_s2c=function(a){IS(m).crossParkPreviewInfo=a.park_list,normalEvent.emit(I.PARKING_SPACE_UPDATE)},a.on_cross_car_park_info_s2c=function(a){var e=IS(m);e.type=3,e.master_id=a.park_info.id,e.serv_id=a.park_info.server_id,e.space_list=a.park_info.space_list,e.defPlayerInfo=a.park_info.def_list,e.extInfo=a.park_info.ext;for(var t,_=r(a.park_info.ext);!(t=_()).done;){var n=t.value;1==n.k&&(e.is_collect=n.v)}normalEvent.emit(I.PARKING_CUR_PARKING_INFO_UPDATE)},a.on_cross_car_park_parking_start_s2c=function(a){var t=[],_=IS(m);if(0==_.space_list.length)t.push(a.space);else for(var n,s=r(_.space_list);!(n=s()).done;){var c=n.value;c.pos==a.space.pos?t.push(a.space):t.push(c)}_.space_list=t,normalEvent.emit(I.PARKING_CUR_PARKING_INFO_UPDATE),IS(e).reqCrossParkDetail(IS(m).master_id),IS(m).roleState[0].freeze_time<=p.serverTime&&f.showBoxTip({title:GetLanguage(201384),tip:GetLanguage(201956),func:function(a){a==v&&IS(e).reqCrossParkBattleJoin(0,_.master_id,1)}})},a.on_cross_car_park_parking_stop_s2c=function(a){for(var t,_=[],n=IS(m),s=r(n.space_list);!(t=s()).done;){var c=t.value;c.pos==a.space.pos?_.push(a.space):_.push(c)}n.space_list=_,normalEvent.emit(I.PARKING_CUR_PARKING_INFO_UPDATE),3==n.type&&IS(e).reqCrossParkDetail(IS(m).master_id)},a.on_cross_car_park_battle_queue_s2c=function(a){normalEvent.emit(I.PARKING_CROSS_FIGHTING_QUEUE_LIST,a)},a.on_cross_car_park_look_fighting_s2c=function(a){normalEvent.emit(I.PARKING_CROSS_FIGHTING_LOOK,a)},a.on_cross_car_park_report_list_s2c=function(a){normalEvent.emit(I.PARKING_CROSS_PVP_HISTORY,a)},a.on_cross_car_park_role_state_s2c=function(a){IS(m).roleState[a.type]=a,normalEvent.emit(I.PARKING_CROSS_STATUS_INFO)},a.on_cross_car_park_rank_s2c=function(a){IS(m).crossParkRank=a.rank_list,IS(m).CrossRankInfo=a,normalEvent.emit(I.PARKING_CROSS_REFRESH_RANK_INFO,a)},a.on_cross_car_park_settle_s2c=function(a){1==a.status&&(uiMgr.openView("ParkingCrossResultView",a),uiMgr.close("ParkingCrossRobEnemyInfoView"),this.reqCrossParkDetail(IS(m).master_id))},a.on_cross_car_park_video_play_s2c=function(a){var r=IS(l);if(r.currentLoadType==t.CrossParkPvp){r.currentLoadType=0,uiMgr.close("ChatView"),battleMain.enterChapter(0);var e=new n;e.chapterId=100001,e.seed=a.seed,e.chapterType=t.CrossParkPvp,e.recordType=1,e.recordWin=a.winner==a.atk_data.id?1:2,e.playerList[1]=new _(1),e.playerList[2]=new _(2),this.setPlayerList(a.atk_data,e.playerList[1]),this.setPlayerList(a.def_data,e.playerList[2]),r.battleData=e,normalEvent.emit(u.BATTLE_STATE,t.CrossParkPvp,!0)}},a.on_cross_car_park_next_time_s2c=function(a){IS(m).nextStamp=a.next_time},a.on_cross_car_park_merge_time_s2c=function(a){IS(m).merge_time=a.merge_time,normalEvent.emit(I.PARKING_CROSS_MERGE_INFO)},e}());e._RF.pop()}}}));

