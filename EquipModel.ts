System.register("chunks:///_virtual/EquipModel.ts",["./rollupPluginModLoBabelHelpers.js","cc","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./ConfigGlobal.ts","./ObjectUtil.ts","./MessageView.ts","./PrivilegeDataCache.ts","./PrivilegeDefine.ts","./RoleDataCache.ts","./BagModel.ts","./EquipControl.ts","./EquipDataCache.ts","./EquipDefine.ts","./UIDefine.ts"],(function(t){"use strict";var i,e,n,o,u,a,r,l,c,s,f,g,p,d,h,I,E;return{setters:[function(t){i=t.createForOfIteratorHelperLoose},function(t){e=t.cclegacy,n=t.Color},function(t){o=t.default},function(t){u=t.default},null,function(t){a=t.ConfigGlobal},function(t){r=t.default},function(t){l=t.default},function(t){c=t.PrivilegeDataCache},function(t){s=t.PrivilegeCardEffect},function(t){f=t.RoleDataCache},function(t){g=t.BagModel},function(t){p=t.default},function(t){d=t.EquipDataCache},function(t){h=t.EquipQuality,I=t.EquipEventDefine},function(t){E=t.OpenFunction}],execute:function(){e._RF.push({},"ec2a7kzdDhA56NCjK1qpXXF","EquipModel",void 0);for(var y=a.box_goods_id,v=a.equip_skin,q=a.pvp_ticket_max,S=a.batch_auto_open_box,m=a.auto_open_box_text,B=t("locationToCanFigure",{}),C=0;C<v.length;C++)B[v[C]]=!0;t("EquipModel",function(){var t=e.prototype;function e(){this.isAutoOpen=void 0,this.waitTimer=void 0,this.waitShwoReward=void 0,this.waitRemindFigures=void 0,this.isAutoOpen=!1,this.waitShwoReward=null,this.waitRemindFigures={}}return t.clear=function(){this.clearWaitTimer()},t.getEquipList=function(t){if(!t)return IS(d).equipList;for(var e,n=[],o=i(IS(d).equipList);!(e=o()).done;){var u=e.value;u.tab==t&&n.push(u)}return n},t.getEmptyEquipIdList=function(t,i){var e=this;null==i&&(i=IS(d).tabInfo.tab);for(var n=new Array,o=this.getEquipList(i),u=0;u<o.length;u++)0==o[u].location&&n.push(o[u].equip_id);return 1!=t||n.sort((function(t,i){var n=e.getEquipInfoByEquipId(t),o=e.getEquipInfoByEquipId(i),u=configEquipment.getDataByKey(null==n?void 0:n.config_id),a=configEquipment.getDataByKey(null==o?void 0:o.config_id);return(null==u?void 0:u.quality)!=(null==a?void 0:a.quality)?(null==u?void 0:u.quality)>(null==a?void 0:a.quality)?-1:1:(null==n?void 0:n.equip_lv)!=(null==o?void 0:o.equip_lv)?(null==n?void 0:n.equip_lv)>(null==o?void 0:o.equip_lv)?-1:1:t<i?-1:1})),n},t.getEquipByLocation=function(t,i){null==i&&(i=IS(d).tabInfo.tab);for(var e=this.getEquipList(i),n=0;n<e.length;n++)if(e[n].location==t)return e[n]},t.getWearEquipList=function(t){null==t&&(t=IS(d).tabInfo.tab);for(var i=new Array,e=this.getEquipList(t),n=0;n<e.length;n++)0!=e[n].location&&i.push(e[n]);return i},t.getEquipInfoByEquipId=function(t){for(var i=this.getEquipList(),e=0;e<i.length;e++)if(i[e].equip_id==t)return i[e]},t.getBoxInfo=function(){return IS(d).boxInfo},t.getEquipQualityNameAndColor=function(t,i){var e,o=configColor.getDataByKey(t).name;switch(t){case h.WHITE:e=i?new n(193,189,176):new n(83,62,42);break;case h.GREEN:e=i?new n(89,197,144):new n(36,115,67);break;case h.BLUE:e=i?new n(125,172,248):new n(47,69,130);break;case h.PURPLE:e=i?new n(216,121,255):new n(110,15,139);break;case h.GOLD:e=i?new n(243,207,67):new n(151,107,0);break;case h.ORANGE:e=i?new n(252,140,31):new n(167,76,0);break;case h.RED:e=i?new n(254,70,70):new n(156,9,9);break;case h.PINK:e=i?new n(205,105,137):new n(170,0,104);break;case h.MULTICOLOR:e=i?new n(60,208,235):new n(5,99,250);break;case h.GILT:e=new n(227,119,13);break;case h.FOREVER:e=new n(200,41,224)}return{nameStr:o,nameColor:e}},t.getEquipNameShowByEquipConfigId=function(t,i){var e=configEquipment.getDataByKey(t),n=this.getEquipQualityNameAndColor(e.quality);return i?{name:o.formatStr(GetLanguage(200244),n.nameStr,e.name),color:n.nameColor}:{name:o.formatStr(GetLanguage(200245),n.nameStr,e.name),color:n.nameColor}},t.getEquipWearCountBySuitId=function(t,i){null==i&&(i=IS(d).tabInfo.tab);for(var e,n=0,o=this.getEquipList(i),u=0;u<o.length;u++){if(0!=o[u].location)e=o[u].config_id,configEquipment.getDataByKey(e).suitId==t&&(n+=1)}return n},t.tryOpenBox=function(){return IS(g).getGoodsCountByGoodsGtid(y)<=0?(uiMgr.openView("ItemGetWayView",y),!1):(IS(p).reqOpenBox(),!0)},t.tryMultiOpenBox=function(t,i){IS(g).getGoodsCountByGoodsGtid(y)<t?l.showFlyTip(GetLanguage(200247)):IS(p).reqMutiOpenBox(t,i)},t.setQualityCodition=function(t){IS(d).openCondition.quality=t,IS(d).saveLocalOpenConditionData()},t.setAttrConditionUseFlag=function(t,i){IS(d).openCondition.attr[t].isUsing=i,IS(d).saveLocalOpenConditionData()},t.setAttrConditionDetail=function(t,i,e){IS(d).openCondition.attr[t].attr[i]=e,IS(d).saveLocalOpenConditionData()},t.setAutoOpen=function(t){1!=t&&this.clearWaitTimer(),this.isAutoOpen!=t&&(this.isAutoOpen=t,normalEvent.emit(I.AUTO_OPEN_STATUS_CHANGE))},t.getAutoOpen=function(){return this.isAutoOpen},t.tryLoadLocalInfo=function(){IS(d).hasLoadInfo||(0==IS(d).loadLocalOpenConditionData()&&(IS(d).openCondition={quality:3,attr:[{isUsing:!0,attr:[0,0]},{isUsing:!0,attr:[0,0]}]}),0==IS(d).loadLocalStopByTicketData()&&(IS(d).autoStopByGetTicket=!1),0==IS(d).loadLocalSelectAutoMultiNum()&&(IS(d).selectAutoMultiNum=1),IS(d).hasLoadInfo=!0)},t.setAutoStopByGetTicket=function(t){IS(d).autoStopByGetTicket!=t&&(IS(d).autoStopByGetTicket=t,IS(d).saveLocalStopByTicketData())},t.checkAutoStopByGetTicket=function(){return IS(d).autoStopByGetTicket},t.setSelectAutoMultiNum=function(t){IS(d).selectAutoMultiNum!=t&&(IS(d).selectAutoMultiNum=t,IS(d).saveLocalSelectAutoMultiNum())},t.getSelectAutoMultiNum=function(){return IS(d).selectAutoMultiNum},t.getQualityCondition=function(){return IS(d).openCondition.quality},t.getAttrConditionByIdx=function(t,i){return IS(d).openCondition.attr[t].attr[i]},t.getAttrConditionUseFlag=function(t){return IS(d).openCondition.attr[t].isUsing},t.doAfterOpenBox=function(t){var i=t[0],e=function(t){normalEvent.emit(I.OPEN_EQUIP_EDITOR_VIEW,i,!1,t)};if(0!=this.isAutoOpen){var n;if(1!=(IS(g).getGoodsCountByGoodsGtid(y)>0||!1))return l.showFlyTip(GetLanguage(200248)),this.setAutoOpen(!1),void e();for(var o=[],u=[],a=0;a<t.length;a++)n=t[a],this.checkEquipIsConditionOk(n)?u.push(n):o.push(n);u.length<=0?normalEvent.emit(I.OPEN_EQUIP_EDITOR_VIEW,i,!0):(i=u[0],o.length>0&&IS(p).reqSellEquip(o),e(!0))}else e()},t.checkEquipIsConditionOk=function(t){var i=this.getEquipInfoByEquipId(t),e=configEquipment.getDataByKey(null==i?void 0:i.config_id);if((null==e?void 0:e.quality)<this.getQualityCondition())return!1;for(var n=(null==i?void 0:i.rand_attr)||[],o={},u=0;u<n.length;u++)o[n[u].k]=!0;for(var a,r=!1,l=0;l<2;l++)if(0!=this.getAttrConditionUseFlag(l)){for(var c=!0,s=0;s<2;s++)0!=(a=this.getAttrConditionByIdx(l,s))&&null==o[a]&&(c=!1);1==c&&(r=!0)}return 0==this.getAttrConditionUseFlag(0)&&0==this.getAttrConditionUseFlag(1)&&(r=!0),r},t.checkHasEmptyBetterEquip=function(){var t=this.getEmptyEquipIdList(!1,0);if(t.length<=0)return!1;for(var i=0;i<t.length;i++)if(1==this.checkIsBetterEquip(t[i]))return!0;return!1},t.checkIsBetterEquip=function(t){var i=this.getEquipInfoByEquipId(t),e=configEquipment.getDataByKey(null==i?void 0:i.config_id).part,n=this.getEquipByLocation(e);if(r.isEmpty(n))return!0;for(var o=null==i?void 0:i.base_attr,u=null==n?void 0:n.base_attr,a={},l=0;l<(null==o?void 0:o.length);l++)a[o[l].k]=o[l].v;for(var c=!0,s=0;s<(null==u?void 0:u.length);s++){var f=a[u[s].k]||0;if(u[s].v!=f&&(c=!1),u[s].v>f)return!1}return!c},t.checkEquipGot=function(t){if(IS(d).equipCidToGot[t])return!0;var i=configEquipment.getDataByKey(t);if(null==i)return!1;var e=i.unlock_level;return null!=e&&0!=e&&IS(f).GetLevel()>=e},t.getEquipFigureByLocation=function(t){return IS(d).locationToFigure[t]||0},t.getShowEquipCfgIdByLocation=function(t){var i=this.getEquipFigureByLocation(t);if(-1==i)return 0;if(0!=i)return i;var e=this.getEquipByLocation(t);return r.isEmpty(e)?0:e.config_id},t.getWearEquipCfgIdByLocation=function(t){var i=this.getEquipByLocation(t);return r.isEmpty(i)?0:i.config_id},t.checkEquipSkinFunctionOpen=function(){return IS(f).CheckFuncOpen(E.FUNC_EQUIP_SKIN)},t.checkFigureTipShow=function(t){return 1==this.checkEquipSkinFunctionOpen()&&(B[t]||!1)},t.clearWaitTimer=function(){this.waitTimer&&clearTimeout(this.waitTimer),this.waitTimer=null},t.tryOpenEquipEditView=function(t){if(null!=!t&&0!=t){var i=this.getEquipInfoByEquipId(t);if(null!=i){var n=configEquipment.getDataByKey(i.config_id).part,o=IS(e).getEquipByLocation(n);null!=o&&o.equip_id==t||uiMgr.openView("EquipEditView",t)}}},t.tryReStartAutoOpen=function(t){if(this.isAutoOpen&&(t||null==uiMgr.getOpenView("EquipTempBagView")&&null==uiMgr.getOpenView("EquipEditView"))){var i=this.getEmptyEquipIdList(!1,0);if(i.length<=0)this.tryAutoMultiOpenBox();else{for(var e=0;e<i.length;e++){var n=i[e];if(this.checkEquipIsConditionOk(n))return}IS(p).reqSellEquip(i)}}},t.onGetTicketByOpenBox=function(t){this.isAutoOpen?1==this.checkAutoStopByGetTicket()&&IS(g).getGoodsCountByGoodsGtid(1006)>=q+ +IS(c).getPrivilegeCardValue(s.CHALLENGE)&&(this.setAutoOpen(!1),l.showFlyTip(GetLanguage(200249))):this.waitShwoReward=t},t.trySetEquipRemindIcon=function(t,i){if(null!=t&&!(i&&i>0&&IS(f).GetLevel()>=i)){for(var e in IS(d).equipCidToGot){if(configEquipment.getDataByKey(Number(e)).icon==t)return}this.waitRemindFigures[t]=!0}},t.clearEquipRemindByIcon=function(t){null!=t&&delete this.waitRemindFigures[t]},t.checkNeedShowRemindIcon=function(t){if(null!=t)return this.waitRemindFigures[t]||!1},t.tryAutoMultiOpenBox=function(){var t=Math.min(IS(d).selectAutoMultiNum,IS(g).getGoodsCountByGoodsGtid(y));t<=0?l.showFlyTip(GetLanguage(200247)):IS(p).reqMutiOpenBox(t,0)},t.getMultiNumName=function(t){for(var i=0;i<m.length;i++)if(m[i][0]==t)return GetLanguage(m[i][1]);return GetLanguage(200685+t)||o.formatStrWithMirrorDeal(GetLanguage(200250),t)},t.checkNumUnlock=function(t){for(var i=0;i<S.length;i++)if(t==S[i][1]&&this.getBoxInfo().lv>=S[i][0])return!0;return!1},t.getEquipTabName=function(t){for(var i=IS(d).tabInfo.unlock_list,e=0;e<i.length;e++)if(i[e].k==t&&""!=i[e].s)return i[e].s;return o.formatStrWithMirrorDeal(GetLanguage(200488),GetLanguage(200662+t))},t.tryChangeBoxSkin=function(t){if(t!=IS(d).curSkin)if(this.isAutoOpen)l.showFlyTip(GetLanguage(204528));else if(this.getEmptyEquipIdList(!1,0).length>0)l.showFlyTip(GetLanguage(204529));else{var i=configTreasure_skin.getDataByKey(t),e=i.condition;if(e&&e.length>0)for(var n=0;n<e.length;n++)if(!this.checkBoxSingleConditionOk(e[n],!0))return;var o=i.open_time,a=i.close_time;o&&o.length>0&&!u.checkOpenTime(o)||a&&a.length>0&&!u.checkCloseTime(a)?l.showFlyTip(GetLanguage(204527)):IS(p).reqEquipChangeBoxSkin(t)}},t.checkBoxConditionOk=function(t,i){void 0===i&&(i=!1);var e=configTreasure_skin.getDataByKey(t).condition;if(e&&e.length>0)for(var n=0;n<e.length;n++)if(!this.checkBoxSingleConditionOk(e[n],i))return!1;return!0},t.checkBoxSingleConditionOk=function(t,i){if(void 0===i&&(i=!1),1==t[0]){var e=this.getBoxInfo();if((null==e?1:e.lv)<t[1])return i&&l.showFlyTip(o.formatStr(GetLanguage(12910006),t[1])),!1}else if(2==t[0]){var n=t[1];if(IS(g).getGoodsCountByGoodsGtid(n)<=0){if(i){var u=configGoods.getDataByKey(n);l.showFlyTip(u.desc)}return!1}}return!0},e}());e._RF.pop()}}}));

