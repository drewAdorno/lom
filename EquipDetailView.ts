System.register("chunks:///_virtual/EquipDetailView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./NodeUtil.ts","./BaseView.ts","./ItemIcon.ts","./ConfigGlobal.ts","./ObjectUtil.ts","./EquipDefine.ts","./EquipModel.ts","./RoleDataCache.ts","./EquipEditView.ts"],(function(t){"use strict";var e,i,n,o,r,a,s,u,d,h,l,p,f,g,c,m,v,C,I,q,E,x,S;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,n=t.math,o=t.UITransform,r=t.Button,a=t.Sprite,s=t.Label,u=t.Node,d=t.Overflow,h=t.sys,l=t.Layout,p=t.RichText,f=t.js,g=t.Color},function(t){c=t.default},function(t){m=t.BaseView},function(t){v=t.IconAseetType},function(t){C=t.ConfigGlobal},function(t){I=t.default},function(t){q=t.EquipEventDefine},function(t){E=t.EquipModel},function(t){x=t.RoleDataCache},function(t){S=t.attrToIndex}],execute:function(){i._RF.push({},"366e99RcV9Jw7mOwb/ibeId","EquipDetailView",void 0);var F=C.equip_type,y={};n.Vec3,n.Vec2,t("default",function(t){function i(){var e;(e=t.call(this)||this).equipItem=void 0,e.nodeContent=void 0,e.utContent=void 0,e.nodeSpeAttr=void 0,e.utSpeAttr=void 0,e.nodeSuit=void 0,e.nodeFigure=void 0,e.imgFigure=void 0,e.txtFigure=void 0,e.equipId=void 0,e.isFake=void 0,e.fakeEquipCid=void 0,e.otherEquip=void 0,e.name="EquipDetailView",e.url="ui/module/equip/EquipDetailView";for(var i=0;i<F.length;i++)y[F[i][0]]=GetLanguage(F[i][1]);return e}e(i,t);var n=i.prototype;return n.onInit=function(){var t=this;this.nodeContent=this.findChild("content"),this.utContent=this.nodeContent.getComponent(o);var e=this.findChild("imgMask");this.addComponentCallbackListener(e,r.EventType.CLICK,(function(){t.close()})),this.nodeSpeAttr=this.findChild("content/info/detail/speAttr"),this.utSpeAttr=this.nodeSpeAttr.getComponent(o),this.nodeSuit=this.findChild("content/info/detail/suit"),this.nodeFigure=this.findChild("content/info/detail/figure"),this.addComponentCallbackListener(this.nodeFigure,r.EventType.CLICK,(function(){t.onFigureClick()})),this.imgFigure=this.findChildComponent("content/info/detail/figure/figureParent/imgFigure",a),this.loadIcon(this.imgFigure,"equip","zbhh_ICON_huanhua"),this.txtFigure=this.findChildComponent("content/info/detail/figure/figureParent/txtFigure",s),this.addComponentCallbackListener(this.txtFigure.node,u.EventType.SIZE_CHANGED,(function(){var e=t.txtFigure.node.getComponent(o);e.width>=263?(t.txtFigure.overflow=d.SHRINK,e.width=263):t.txtFigure.overflow=d.NONE})),h.uiMirror&&this.dealMirrorLayout(this.findChildComponent("content/info/detail/figure/figureParent",l)),this.equipItem={imgFrame:this.findChildComponent("content/info/head/imgFrame",a),imgIcon:this.findChildComponent("content/info/head/imgIcon",a),txtLevel:this.findChildComponent("content/info/txtLevel",s),txtName:this.findChildComponent("content/info/txtName",s),txtCarrer:this.findChildComponent("content/info/txtCarrer",s),txtSuit:this.findChildComponent("content/info/detail/suit/txtSuit",p),AttrItmes:{normalAttrItems:[],speAttrItems:[]}};for(var i=0;i<4;i++){var n=this.findChild(f.formatStr("content/info/detail/attr/baseAttrItem%s",i+1)),g={txtName:c.findChildComponent(n,"txtName",s),txtValue:c.findChildComponent(n,"txtValue",s),imgFlag:null,node:n};this.equipItem.AttrItmes.normalAttrItems.push(g),i<=1&&function(){var e=t.findChild(f.formatStr("content/info/detail/speAttr/speAttrItem%s",i+1)),n={txtName:c.findChildComponent(e,"txtName",s),txtValue:c.findChildComponent(e,"txtValue",s),txtDesc:c.findChildComponent(e,"txtDesc",s),node:e,btnDetail:c.findChild(e,"txtName"),descStr:null,nameStr:null};t.addComponentCallbackListener(n.btnDetail,r.EventType.CLICK,(function(){uiMgr.openView("EquipEditTipsView",n.nameStr,n.descStr,n.btnDetail)})),t.equipItem.AttrItmes.speAttrItems.push(n)}()}},n.registerUpdateHandler=function(){this.addEvent(q.EQUIP_FIGURE_UPDATE,this.onEquipFigureUpdate,this)},n.onAfterOpen=function(){this.txtFigure.overflow=d.NONE,this.isFake=this.openArgs[1]||!1,this.otherEquip=this.openArgs[2]||!1,this.isFake?this.fakeEquipCid=this.openArgs[0]:this.equipId=this.openArgs[0]||0,this.showEquipInfo()},n.showEquipInfo=function(){if(this.isFake||0!=this.equipId){var t;if(this.isFake){var e=configEquipment.getDataByKey(this.fakeEquipCid);t={equip_id:-1,config_id:this.fakeEquipCid,equip_lv:e.level,location:0,base_attr:new Array,rand_attr:new Array};for(var i=e.preAttr,n=i[0],o=0;o<n.length;o++)t.base_attr.push({k:n[o][0],v:n[o][1]});for(var r=i[1],a=0;a<r.length;a++)t.rand_attr.push({k:r[a][0],v:r[a][1]})}else t=IS(E).getEquipInfoByEquipId(this.equipId);if(this.otherEquip&&(t=this.openArgs[2]),null!=t){var s=IS(E).getEquipNameShowByEquipConfigId(t.config_id,!0);this.equipItem.txtName.string=s.name,this.equipItem.txtName.color=s.color;var u=configEquipment.getDataByKey(t.config_id);this.loadIcon(this.equipItem.imgIcon,u.atlas,u.icon,null,v.ICON_SPRITE),this.loadIcon(this.equipItem.imgFrame,"icon_equip",configColor.getDataByKey(u.quality).path),this.equipItem.txtLevel.string=f.formatStr("Lv.%s",t.equip_lv);var d=u.wearable||0;if(0==d)this.equipItem.txtCarrer.string="";else{this.equipItem.txtCarrer.string=y[d];var h=IS(x).GetJob(),l=configJobs.getDataByKey(h).type;this.equipItem.txtCarrer.color=l==d?new g(77,65,49):new g(191,67,67)}var p=IS(E).checkFigureTipShow(u.part)||!1;this.otherEquip&&(p=!1),this.isFake&&(p=!1),this.nodeFigure.active=p;var c=p?70:20;if(p){var m,C=IS(E).getEquipFigureByLocation(u.part);this.imgFigure.grayscale=0==C||-1==C,m=0==C?GetLanguage(200266):-1==C?GetLanguage(200267):GetLanguage(200268),this.txtFigure.string=m}var q,F,A=t.base_attr;A.sort((function(t,e){return S[t.k]<S[e.k]?-1:1}));for(var w=0;w<4;w++){var _=this.equipItem.AttrItmes.normalAttrItems[w],k=A[w];if(I.isEmpty(k))_.node.active=!1;else{_.node.active=!0,q=k.k,F=k.v;var D=configAttribute.getDataByKey(q);_.txtName.string=D.name,_.txtValue.string=3==D.show_type?String(Math.floor(F/100)/100):String(F)}}for(var b=t.rand_attr||[],N=0;N<2;N++){var L=this.equipItem.AttrItmes.speAttrItems[N],V=b[N];if(I.isEmpty(V))L.node.active=!1;else{L.node.active=!0,q=V.k,F=V.v;var B=configAttribute.getDataByKey(q);L.txtName.string=B.name,L.txtValue.string=f.formatStr("%s%",100*F/1e4),L.txtDesc.string=B.desc,L.nameStr=B.name,L.descStr=B.desc}}this.nodeSpeAttr.active=b.length>0||!1;var T=b.length>0?30*b.length+26:0;this.utSpeAttr.height=30*b.length+26;var K=u.suitId;this.nodeSuit.active=0!=K||!1;var G=0;if(0!=K){var M=configEquipment_suit.getDataByList("suit_id",K);G=M.length;for(var O,R="",U=IS(E).getEquipWearCountBySuitId(K),P=0;P<M.length;P++){var H=M[P];P>0&&(R=f.formatStr("%s\n",R));var j=f.formatStr("%s(%s/%s):%s",H.name,U,H.num,H.desc);O=U>=H.num?"#FDF9B8":"#908474",j=f.formatStr("<color=%s>%s</color>",O,j),R=f.formatStr("%s%s",R,j)}this.equipItem.txtSuit.string=R}var J=G>0?22*G+20:0;this.utContent.height=280+c+T+J}}else self.close()},n.onBeforeClose=function(){this.equipId=0},n.onDestroy=function(){},n.onEquipFigureUpdate=function(){this.isFake||(this.txtFigure.overflow=d.NONE,this.showEquipInfo())},n.onFigureClick=function(){var t=IS(E).getEquipInfoByEquipId(this.equipId),e=configEquipment.getDataByKey(t.config_id);uiMgr.openView("EquipFigureView",e.part)},i}(m));i._RF.pop()}}}));

