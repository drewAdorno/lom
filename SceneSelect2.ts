System.register("chunks:///_virtual/SceneSelect2.ts",["./rollupPluginModLoBabelHelpers.js","cc","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./ItemIcon.ts","./UIEffectAsset.ts","./ObjectUtil.ts","./SLGMapData.ts","./MessageView.ts","./RoleDataCache.ts","./SeasonDefine.ts","./SeasonSceneControl.ts","./SeasonSceneDataCache.ts","./SceneUnit4.ts"],(function(e){"use strict";var i,t,n,o,s,a,r,c,m,p,d,h,f,l,u,v,S,g,T,I,b,w,y,_;return{setters:[function(e){i=e.inheritsLoose,t=e.createClass},function(e){n=e.cclegacy,o=e.Vec3,s=e.Label,a=e.ProgressBar,r=e.sys,c=e.Vec2,m=e.Sprite,p=e.Button},function(e){d=e.default},function(e){h=e.default},function(e){f=e.default},function(e){l=e.IconAseetType},function(e){u=e.UIEffectAsset},function(e){v=e.default},function(e){S=e.SLGMapData},function(e){g=e.default},function(e){T=e.RoleDataCache},function(e){I=e.SceneObjType,b=e.SceneActionType},function(e){w=e.default},function(e){y=e.SeasonSceneDataCache},function(e){_=e.SceneUnit}],execute:function(){n._RF.push({},"99abcOcIy1KE6FwnT9IQNsH","SceneSelect",void 0);var x=[[new o(0,62)],[new o(-75,56),new o(75,56)],[new o(-115,42),new o(0,62),new o(115,42)]],C=(e("SceneSelect",function(e){function n(i){var t;return(t=e.call(this)||this).map=void 0,t.model=void 0,t.select=void 0,t.opt=void 0,t.info=void 0,t.txtName=void 0,t.itemList=[],t.updateInfo=!1,t.plot=void 0,t.baseId=void 0,t.empire=void 0,t.txtEmpire=void 0,t.empireTimer=0,t.pbTime=void 0,t.txtTimeNum=void 0,t.map=i,t.model=u.alloc("ui/module/season/scene/SelectInfo",i.nodeUnitMap.select,-1,(function(e){t.onInit(e)})),t.id=1,t}i(n,e);var m=n.prototype;return m.onInit=function(e){var i=e.node;this.select=d.findChild(i,"select");for(var t=d.findChild(i,"opt"),n=1;n<=3;n++)this.itemList[n-1]=new C(this,n,d.findChild(t,"btnItem"+n));this.opt=t;var o=d.findChild(i,"info");this.info=o,this.txtName=d.findChildComponent(o,"txtName",s),this.empire=d.findChild(i,"empire"),this.txtEmpire=d.findChildComponent(i,"empire/txtEmpire",s),this.pbTime=d.findChildComponent(i,"pbTime",a),this.txtTimeNum=d.findChildComponent(i,"pbTime/txtNum",s),r.uiMirror&&(this.txtName.node.setScale(1,1,1),this.txtEmpire.node.setScale(1,1,1),this.txtTimeNum.node.setScale(1,1,1))},m.removeEvent=function(){this.model},m.refresh=function(){this.updateInfo=!0},m.onAction=function(e){var i=this,t=this.plot[e-1],n=S.getPosToCR(this.position.x,this.position.y);this.map.cancelSelect();var o=new c(n.x,n.y),s=this.map.selectGrid;switch(t){case 1:uiMgr.openView("SeasonSceneAttackView",this.baseId,o,1);break;case 9:uiMgr.openView("SeasonSceneAttackView",this.baseId,o,2);break;case 2:uiMgr.openView("SeasonSceneDefView",this.baseId,o);break;case 6:uiMgr.openView("SeasonSceneLookView",this.baseId,o);break;case 7:uiMgr.openView("SeasonSceneReviveView",this.baseId,o);break;case 3:if(IS(y).roleInfo.action_point<=0)return void g.showFlyTip(configErrorInfo.getDataByKey(309).info);var a=IS(y).gridTimeMap;if(s&&a[s.id]&&f.serverTime<a[s.id].time)return void g.showFlyTip(configErrorInfo.getDataByKey(382).info);var r=configSeason_building_plot.getDataByKey(this.baseId),m=h.formatStr(GetLanguage(204708),r.name,n.x,n.y);g.showBoxTip({tip:m,func:function(e){if("type_yes"==e){if(IS(y).roleInfo.action_point<=0)return void g.showFlyTip(configErrorInfo.getDataByKey(309).info);IS(w).reqInspect(o),uiMgr.openView("SeasonSceneShareView",i.baseId,o,t)}},ensure:GetLanguage(200129)});break;case 4:case 5:uiMgr.openView("SeasonSceneShareView",this.baseId,o,t);break;case 8:if(s&&s.fill_obj)switch(s.fill_obj.obj_type){case I.S1_AirDrop:uiMgr.openView("SeasonSceneDetailAirdropView");break;case I.S1_Empire:uiMgr.openView("SeasonSceneDetailRoyalView",s,o);break;case I.S1_Monster:uiMgr.openView("SeasonSceneDetailMonsterView",this.baseId,o);break;case I.S1_Relic:uiMgr.openView("SeasonSceneDetailRelicView",this.baseId,o)}}},m.onUpdate=function(e){if(this.opt&&this.updateInfo){this.updateInfo=!1;var i=this.map.selectGrid,t=11;i&&i.fill_obj?(t=i.fill_obj.base_id,this.select.active=!1):this.select.active=!0;var n=configSeason_building_plot.getDataByKey(t);this.opt.position=new o(this.opt.position.x,n.height+45,0),0==n.name_show?(this.info.active=!0,this.txtName.string=n.name):this.info.active=!1;var s=n.not_plot_function;i&&i.serv_id==IS(T).GetServerId()&&(s=n.my_plot_function),this.plot=s;var a=IS(y),r=!1;if(a.teamInfo&&i&&i.serv_id==IS(T).GetServerId()){var c=S.getPosToCR(this.position.x,this.position.y);null!=i.fill_obj&&a.teamInfo.born_pos&&c.x==a.teamInfo.born_pos.x&&c.y==a.teamInfo.born_pos.y&&s.includes(b.Revive)&&(this.plot=v.copyArray(s),r=!0,this.plot.splice(s.indexOf(b.Revive),1)),a.teamInfo.defend_pos&&c.x==a.teamInfo.defend_pos.x&&c.y==a.teamInfo.defend_pos.y&&s.includes(b.Def)&&(r||(this.plot=v.copyArray(s)),r=!0,this.plot.splice(s.indexOf(b.Def),1))}if(i&&i.spy_end_time-f.serverTime>0){r||(this.plot=v.copyArray(s)),r=!0;for(var m=0;m<s.length;m++){if(s[m]==b.Detection){this.plot[m]=b.Look;break}}}this.empireTimer>0&&this.map.view.removeTimer(this.empireTimer),this.empireTimer=0,this.empire.active=!1,this.pbTime.node.active=!1;var p=IS(y).gridTimeMap;i&&p[i.id]&&f.serverTime<p[i.id].time?(this.empire.active=!0,this.updateTime(p[i.id].time)):i&&i.event&&f.serverTime<i.event.end_time&&(this.pbTime.node.active=!0,this.updatePbTime(i.event.start_time,i.event.end_time)),this.baseId=t;for(var d=x[this.plot.length-1],h=0;h<3;h++)h>=this.plot.length?this.itemList[h].node.active=!1:(this.itemList[h].node.active=!0,this.itemList[h].node.position=d[h],this.itemList[h].updateView(this.plot[h]))}},m.updateTime=function(e){var i=this;if(e){var t=e-f.serverTime;this.txtEmpire.string=f.formatTimeStringForSecond(t),this.empireTimer=this.map.view.addTimer(1,-1,(function(){var t=e-f.serverTime;i.txtEmpire.string=f.formatTimeStringForSecond(t)}))}},m.updatePbTime=function(e,i){var t=this,n=f.serverTime-e,o=i-e;this.pbTime.progress=n/o,this.txtTimeNum.string=f.formatTimeForSecond(n),this.empireTimer=this.map.view.addTimer(1,-1,(function(){var i=f.serverTime-e;i>o?t.pbTime.node.active=!1:(t.pbTime.progress=i/o,t.txtTimeNum.string=f.formatTimeForSecond(i))}))},m.onDestroy=function(){this.removeEvent(),this.model&&this.model.free(),this.empireTimer>0&&this.map.view.removeTimer(this.empireTimer),this.empireTimer=0},t(n,[{key:"position",get:function(){return this.model.position},set:function(e){this.model.position=e}},{key:"depth",get:function(){return this.model.depth},set:function(e){this.model.depth=e}}]),n}(_)),function(){function e(e,i,t){this.id=void 0,this.node=void 0,this.select=void 0,this.imgIcon=void 0,this.txtName=void 0,this.node=t,this.id=i,this.select=e,this.imgIcon=d.findChildComponent(t,"imgIcon",m),this.txtName=d.findChildComponent(t,"txtName",s),r.uiMirror&&this.txtName.node.setScale(1,1,1),e.map.view.addComponentCallbackListener(t,p.EventType.CLICK,(function(){e.onAction(i)}))}return e.prototype.updateView=function(e){var i=configSeason_building_function.getDataByKey(e);this.txtName.string=i.name,this.select.map.view.loadIcon(this.imgIcon,"season_map",i.icon,null,l.UI_ATLAS,!0)},e}());n._RF.pop()}}}));

