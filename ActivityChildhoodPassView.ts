System.register("chunks:///_virtual/ActivityChildhoodPassView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./BagModel.ts","./BattlePassControl.ts","./BattlePassDataCache.ts","./BattlePassDefine.ts","./MessageView.ts","./PayDataCache.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./BaseView.ts"],(function(t){"use strict";var e,i,s,n,o,a,r,d,h,l,v,p,c,x,f,u,m,g,I,C,b,_,w;return{setters:[function(t){e=t.inheritsLoose,i=t.createForOfIteratorHelperLoose},function(t){s=t.cclegacy,n=t.Button,o=t.Label,a=t.ProgressBar,r=t.ScrollView,d=t.Sprite},function(t){h=t.ItemGrid},function(t){l=t.ListItem},function(t){v=t.default},function(t){p=t.default},function(t){c=t.default},null,function(t){x=t.BagModel},function(t){f=t.default},function(t){u=t.BattlePassDataCache},function(t){m=t.BattlePassDefine},function(t){g=t.default},function(t){I=t.default},function(t){C=t.default},function(t){b=t.ActivityType,_=t.ActivityState},function(t){w=t.BaseView}],execute:function(){s._RF.push({},"0b2237/ZTRKS60JSxGX1kkg","ActivityChildhoodPassView",void 0);t("default",function(t){function i(){var e;return(e=t.call(this)||this).scroll=void 0,e.txtPrice=void 0,e.txtDiscount=void 0,e.expPB=void 0,e.expTxt=void 0,e.levTxt=void 0,e.btnBuy=void 0,e.boxDesc=void 0,e.boxCount=void 0,e.boxExp=void 0,e.boxPb=void 0,e.boxImg=void 0,e.txtLeftTime=void 0,e.deltaTime=0,e.leftTime=0,e.canUpdate=!1,e.curPassId=0,e.passInfo=void 0,e.name="ActivityChildhoodPassView",e.url="ui/module/childhood/ActivityChildhoodPassView",e}e(i,t);var s=i.prototype;return s.onInit=function(){var t=this,e=this.findChild("view/btnClose");this.addComponentCallbackListener(e,n.EventType.CLICK,(function(){t.close()})),this.txtPrice=this.findChildComponent("view/btnBuy/txtPrice",o),this.txtDiscount=this.findChildComponent("view/btnBuy/discount/Label",o),this.btnBuy=this.findChild("view/btnBuy"),this.addComponentCallbackListener(this.btnBuy,n.EventType.CLICK,(function(){IS(I).Pay(IS(u).getPassInfo(t.curPassId).bundle_id)})),this.txtLeftTime=this.findChildComponent("view/txtLeftTime",o),this.expPB=this.findChildComponent("view/top/pbExperience",a),this.expTxt=this.findChildComponent("view/top/pbExperience/txtExp",o),this.levTxt=this.findChildComponent("view/top/imgGradeBack/txtGrade",o);var i=this.findChildComponent("view/scroll",r);this.scroll=this.addUIList(i,y,!0,0),this.boxDesc=v.findChildComponent(this.node,"view/state2/imgExtBG/Label",o),this.boxCount=v.findChildComponent(this.node,"view/state2/txtExtCount",o),this.boxExp=v.findChildComponent(this.node,"view/state2/pbExperience/txtExtExp",o),this.boxPb=v.findChildComponent(this.node,"view/state2/pbExperience",a),this.boxImg=v.findChildComponent(this.node,"view/state2/imgBox",d),this.addComponentCallbackListener(this.boxImg.node,n.EventType.CLICK,(function(){t.onGetExtReward()}))},s.registerUpdateHandler=function(){this.addEvent(m.BATTLE_PASS_INFO_UPDATE,this.updateBattlePass,this)},s.onAfterOpen=function(){var t,e=IS(C).GetActivityInfo(b.ChildhoodPass),i=null!=(t=e.state_time[e.state])?t:e.state_time[_.Open];if(this.leftTime=i.end_time-c.serverTime,this.leftTime>0?(this.canUpdate=!0,this.txtLeftTime.string=c.formatTimeStringForSecond(this.leftTime)):this.txtLeftTime.string=GetLanguage(200026),this.curPassId=e.roundCfg.group_id,this.passInfo=IS(u).getPassInfo(this.curPassId),this.passInfo){var s,n,o=null!=(s=null==(n=configWartoken_reward.getDataByKeys("id",this.curPassId,"level",this.passInfo.lev))?void 0:n.exp)?s:this.passInfo.need_exp;this.btnBuy.active=!this.passInfo.if_buy,this.expTxt.string=this.passInfo.lev>=this.passInfo.max_lev?"max":this.passInfo.exp+"/"+o,this.expPB.progress=this.passInfo.lev>=this.passInfo.max_lev?1:this.passInfo.exp/o,this.levTxt.string=""+this.passInfo.lev;var a=configPay_mall.getDataByKey(this.passInfo.bundle_id);this.txtPrice.string=IS(I).GetPriceString(a.cost_level),this.txtDiscount.string=100*a.ratio+"%",this.showBox()}else this.btnBuy.active=!0;var r=[].concat(configWartoken_reward.getDataByList("id",this.curPassId));r.sort((function(t,e){return t.level-e.level})),this.scroll.datas=r},s.onBeforeClose=function(){this.canUpdate=!1},s.onDestroy=function(){},s.onUpdate=function(t){this.canUpdate&&(this.deltaTime=this.deltaTime+t,this.deltaTime>=1&&(this.deltaTime=0,this.leftTime=this.leftTime-1,this.leftTime>0?this.txtLeftTime.string=c.formatTimeStringForSecond(this.leftTime):(this.txtLeftTime.string=GetLanguage(200026),this.canUpdate=!1)))},s.updateBattlePass=function(){if(this.passInfo=IS(u).getPassInfo(this.curPassId),this.passInfo){var t,e,i=null!=(t=null==(e=configWartoken_reward.getDataByKeys("id",this.curPassId,"level",this.passInfo.lev))?void 0:e.exp)?t:this.passInfo.need_exp;this.btnBuy.active=!this.passInfo.if_buy,this.expTxt.string=this.passInfo.lev>=this.passInfo.max_lev?"max":this.passInfo.exp+"/"+i,this.expPB.progress=this.passInfo.lev>=this.passInfo.max_lev?1:this.passInfo.exp/i,this.levTxt.string=""+this.passInfo.lev;var s=configPay_mall.getDataByKey(this.passInfo.bundle_id);this.txtPrice.string=IS(I).GetPriceString(s.cost_level),this.txtDiscount.string=100*s.ratio+"%",this.showBox()}else this.btnBuy.active=!0;this.scroll.updateAll()},s.showBox=function(){var t=this.passInfo;this.boxDesc.string=p.formatStrWithMirrorDeal(GetLanguage(201064),t.max_lev,t.extra_need_exp,t.extra_max_times),this.boxCount.string="("+t.extra_times+"/"+t.extra_max_times+")",t.lev<t.max_lev?(this.boxExp.string="0/"+t.extra_need_exp,this.boxPb.progress=0):(this.boxImg.grayscale=t.exp<t.extra_need_exp,this.boxExp.string=t.exp+"/"+t.extra_need_exp,this.boxPb.progress=t.exp/t.extra_need_exp)},s.onGetExtReward=function(){var t=this.passInfo;t.extra_times>=t.extra_max_times?g.showFlyTip(GetLanguage(200030)):t.lev>=t.max_lev&&t.exp>=t.extra_need_exp?t.if_buy?1==this.curPassId?IS(f).reqBattlePassExtReward():IS(f).send_40_6(this.curPassId):g.showFlyTip(p.formatStrWithMirrorDeal(GetLanguage(201062),GetLanguage(201065))):g.showFlyTip(GetLanguage(200032))},i}(w));var y=function(t){function s(){for(var e,i=arguments.length,s=new Array(i),n=0;n<i;n++)s[n]=arguments[n];return(e=t.call.apply(t,[this].concat(s))||this).state1=void 0,e.state2=void 0,e.scrollNormal=void 0,e.scrollHigh=void 0,e.lockNode=void 0,e.txtLev=void 0,e.pbExp=void 0,e.boxDesc=void 0,e.boxCount=void 0,e.boxExp=void 0,e.boxPb=void 0,e.boxImg=void 0,e}e(s,t);var h=s.prototype;return h.onInit=function(){var t=this;this.adaptiveSize=!0,this.state1=v.findChild(this.node,"state1"),this.state2=v.findChild(this.node,"state2"),this.lockNode=v.findChild(this.node,"state1/high/lock"),this.txtLev=v.findChildComponent(this.node,"state1/pbExp/txtLabel",o),this.pbExp=v.findChildComponent(this.node,"state1/pbExp",a);var e=v.findChildComponent(this.node,"state1/normal/scroll",r);this.scrollNormal=this.view.addUIList(e,P,!1,0),this.scrollNormal.touchEvent=!1,this.scrollNormal.lackCenter=!0;var i=v.findChildComponent(this.node,"state1/high/scroll",r);this.scrollHigh=this.view.addUIList(i,L,!1,0),this.scrollHigh.touchEvent=!1,this.scrollNormal.lackCenter=!0,this.boxDesc=v.findChildComponent(this.node,"state2/imgExtBG/Label",o),this.boxCount=v.findChildComponent(this.node,"state2/txtExtCount",o),this.boxExp=v.findChildComponent(this.node,"state2/pbExperience/txtExtExp",o),this.boxPb=v.findChildComponent(this.node,"state2/pbExperience",a),this.boxImg=v.findChildComponent(this.node,"state2/imgBox",d),this.view.addComponentCallbackListener(this.boxImg.node,n.EventType.CLICK,(function(){t.onGetExtReward()}));var s=v.findChild(this.node,"state1/high/lock/btnLock");this.view.addComponentCallbackListener(s,n.EventType.CLICK,(function(){IS(I).Pay(IS(u).getPassInfo(t.view.curPassId).bundle_id)}));var h=v.findChild(this.node,"state1/high/lock/mask");this.view.addComponentCallbackListener(h,n.EventType.CLICK,(function(){IS(I).Pay(IS(u).getPassInfo(t.view.curPassId).bundle_id)}))},h.onRender=function(t,e){var i=this.view.passInfo;i&&t.level>i.max_lev?(this.state1.active=!1,this.state2.active=!0,this.ut.height=210,this.showBox()):(this.state1.active=!0,this.state2.active=!1,this.ut.height=120,this.showLev())},h.showLev=function(){var t=this.view.passInfo,e=this.data;if(this.txtLev.string=e.level,this.lockNode.active=!!t&&!t.if_buy,t){var s,n,o=null!=(s=null==(n=configWartoken_reward.getDataByKeys("id",t.id,"level",t.lev))?void 0:n.exp)?s:t.need_exp;0==o?this.pbExp.progress=1:e.level==t.lev+1?this.pbExp.progress=t.exp/o-.4:e.level==t.lev?this.pbExp.progress=.6+t.exp/o:e.level<t.lev?this.pbExp.progress=1:this.pbExp.progress=0}else this.pbExp.progress=0;for(var a,r=[],d=i(e.reward);!(a=d()).done;){var h=a.value;r.push({id:e.id,lev:e.level,rewrad:h})}this.scrollNormal.datas=r;for(var l,v=[],p=i(e.high_reward);!(l=p()).done;){var c=l.value;v.push({id:e.id,lev:e.level,rewrad:c})}this.scrollHigh.datas=v},h.showBox=function(){var t=this.view.passInfo;this.boxDesc.string=p.formatStrWithMirrorDeal(GetLanguage(201064),t.max_lev,t.extra_need_exp,t.extra_max_times),this.boxCount.string="("+t.extra_times+"/"+t.extra_max_times+")",t.lev<t.max_lev?(this.boxExp.string="0/"+t.extra_need_exp,this.boxPb.progress=0):(this.boxImg.grayscale=t.exp<t.extra_need_exp,this.boxExp.string=t.exp+"/"+t.extra_need_exp,this.boxPb.progress=t.exp/t.extra_need_exp)},h.onGetExtReward=function(){var t=this.view.passInfo;t.extra_times>=t.extra_max_times?g.showFlyTip(GetLanguage(200030)):t.lev>=t.max_lev&&t.exp>=t.extra_need_exp?t.if_buy?1==this.view.curPassId?IS(f).reqBattlePassExtReward():IS(f).send_40_6(this.view.curPassId):g.showFlyTip(p.formatStrWithMirrorDeal(GetLanguage(201062),GetLanguage(201065))):g.showFlyTip(GetLanguage(200032))},s}(l),P=function(t){function i(){for(var e,i=arguments.length,s=new Array(i),n=0;n<i;n++)s[n]=arguments[n];return(e=t.call.apply(t,[this].concat(s))||this).canGet=void 0,e.received=void 0,e.itemGridNode=void 0,e.itemGrid=void 0,e}e(i,t);var s=i.prototype;return s.onInit=function(){var t=this;this.canGet=v.findChild(this.node,"canGet"),this.received=v.findChild(this.node,"received"),this.itemGridNode=v.findChild(this.node,"itemGrid"),this.itemGrid=new h(this.view,this.itemGridNode,(function(){t.canGet.active?IS(f).send_40_5(t.view.curPassId,t.data.lev,1):IS(x).OpenItemTips(t.data.rewrad[0],t.node)}))},s.onRender=function(t,e){var i;this.itemGrid.SetItemId(t.rewrad[0],t.rewrad[1]);var s=null==(i=this.view.passInfo)?void 0:i.free_reward[t.lev-1].status;this.canGet.active=1==s,this.received.active=2==s},i}(l),L=function(t){function i(){for(var e,i=arguments.length,s=new Array(i),n=0;n<i;n++)s[n]=arguments[n];return(e=t.call.apply(t,[this].concat(s))||this).canGet=void 0,e.received=void 0,e.itemGridNode=void 0,e.itemGrid=void 0,e}e(i,t);var s=i.prototype;return s.onInit=function(){var t=this;this.canGet=v.findChild(this.node,"canGet"),this.received=v.findChild(this.node,"received"),this.itemGridNode=v.findChild(this.node,"itemGrid"),this.itemGrid=new h(this.view,this.itemGridNode,(function(){t.canGet.active?IS(f).send_40_5(t.view.curPassId,t.data.lev,2):IS(x).OpenItemTips(t.data.rewrad[0],t.node)}))},s.onRender=function(t,e){var i,s,n;this.itemGrid.SetItemId(t.rewrad[0],t.rewrad[1]);var o=null==(i=this.view.passInfo)?void 0:i.high_reward[t.lev-1].status;this.canGet.active=(null==(s=this.view.passInfo)?void 0:s.if_buy)&&1==o,this.received.active=(null==(n=this.view.passInfo)?void 0:n.if_buy)&&2==o},i}(l);s._RF.pop()}}}));

