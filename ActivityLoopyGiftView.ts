System.register("chunks:///_virtual/ActivityLoopyGiftView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./TimeUtil.ts","./index57.ts","./MessageView.ts","./PayControl.ts","./PayDataCache.ts","./PayDefine.ts","./ActivityDataCache.ts","./ActivityDefine.ts","./BaseView.ts"],(function(t){"use strict";var i,e,n,s,a,o,r,d,c,h,u,f,l,m,y,v,p,g,x,I;return{setters:[function(t){i=t.inheritsLoose},function(t){e=t.cclegacy,n=t.Button,s=t.Label,a=t.ScrollView,o=t.js},function(t){r=t.ItemGrid},function(t){d=t.ListItem},function(t){c=t.default},function(t){h=t.default},function(t){u=t.default},null,function(t){f=t.default},function(t){l=t.default},function(t){m=t.default},function(t){y=t.PayEventDefine,v=t.GiftType},function(t){p=t.default},function(t){g=t.ActivityState,x=t.ActivityType},function(t){I=t.BaseView}],execute:function(){e._RF.push({},"45fb6BGzW5NmruuX9GsDMyg","ActivityLoopyGiftView",void 0);var b=1,C=2,L=(t("default",function(t){function e(){var i;return(i=t.call(this)||this).tabBtns=[],i.curIndex=0,i.txtLeftTime=void 0,i.payList=void 0,i.deltaTime=0,i.leftTime=0,i.canUpdate=!1,i.actType=0,i.name="ActivityLoopyGiftView",i.url="ui/module/activityLoopy/ActivityLoopyGiftView",i}i(e,t);var r=e.prototype;return r.onInit=function(){var t=this,i=this.findChild("imgMask");this.addComponentCallbackListener(i,n.EventType.CLICK,(function(){t.close()}));var e=this.findChild("btnClose");this.addComponentCallbackListener(e,n.EventType.CLICK,(function(){t.close()})),this.txtLeftTime=this.findChildComponent("container/bg/nodeTime/txtLeftTime",s);var r=this.findChildComponent("container/payList",a);this.payList=this.addUIList(r,L,!0);for(var d=function(i){var e=c.findChild(t.node,o.formatStr("bottomBtn/item%s",i)),a={itemGo:e,normalTxt:c.findChildComponent(e,"normal/Label",s),normalGo:c.findChild(e,"normal"),selectedGo:c.findChild(e,"selected"),selectTxt:c.findChildComponent(e,"selected/Label",s),index:i};t.addComponentCallbackListener(e,n.EventType.CLICK,(function(){if(a.index!=C)t.SetIndex(a.index);else{var i=IS(p).GetActivityInfo(x.LoopyBox);if(i&&i.state==g.Open)t.SetIndex(a.index);else if(i&&i.state==g.Preview){var e=i.state_time[g.Open].start_time-u.serverTime;f.showFlyTip(h.formatStrWithMirrorDeal(GetLanguage(201410),u.formatTimeStringForSecond(e)))}else f.showFlyTip(GetLanguage(200026))}})),t.tabBtns[i]=a},l=1;l<=2;l++)d(l)},r.registerUpdateHandler=function(){this.addEvent(y.PAY_INFO_UPDATE,this.OnPayGiftInfoUpdate,this)},r.onAfterOpen=function(){var t=IS(p).GetActivityInfo(this.openArgs[0]);if(t){var i,e=null!=(i=t.state_time[t.state])?i:t.state_time[g.Open];this.leftTime=e.end_time-u.serverTime,this.leftTime>0?(this.canUpdate=!0,this.txtLeftTime.string=u.formatTimeStringForSecond(this.leftTime)):this.txtLeftTime.string=GetLanguage(200026)}else this.txtLeftTime.string=GetLanguage(200026);t?this.SetIndex(t.type==x.LoopyBox?C:b):this.SetIndex(b)},r.onBeforeClose=function(){this.canUpdate=!1,this.actType=0,this.curIndex>0&&(this.tabBtns[this.curIndex].normalGo.active=!0,this.tabBtns[this.curIndex].selectedGo.active=!1,this.curIndex=0)},r.onDestroy=function(){},r.onUpdate=function(t){this.canUpdate&&(this.deltaTime=this.deltaTime+t,this.deltaTime>=1&&(this.deltaTime=0,this.leftTime=this.leftTime-1,this.leftTime>0?this.txtLeftTime.string=u.formatTimeStringForSecond(this.leftTime):(this.txtLeftTime.string=GetLanguage(200026),this.canUpdate=!1)))},r.SetIndex=function(t){this.curIndex!=t&&(this.curIndex>0&&(this.tabBtns[this.curIndex].selectedGo.active=!1,this.tabBtns[this.curIndex].normalGo.active=!0),this.curIndex=t,this.tabBtns[this.curIndex].normalGo.active=!1,this.tabBtns[this.curIndex].selectedGo.active=!0,this.curIndex==b?this.actType=x.LoopyTurn:this.actType=x.LoopyBox,this.OnPayGiftInfoUpdate())},r.OnPayGiftInfoUpdate=function(){if(0!=this.actType){var t=IS(p).GetActivityInfo(this.actType);if(t){var i=IS(m).GetAcivityGift(v.Activity,t.type,t.round);i.sort((function(t,i){var e=IS(m).GetPayGiftInfo(t.id),n=IS(m).GetPayGiftInfo(i.id),s=e&&0!=e.payCfg.buy_times&&e.bought_times&&e.bought_times>=e.payCfg.buy_times;return s!=(n&&0!=n.payCfg.buy_times&&n.bought_times&&n.bought_times>=n.payCfg.buy_times)?s?1:-1:t.id-i.id})),this.payList.datas=i}else this.payList.clearData()}},e}(I)),function(t){function e(){for(var i,e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return(i=t.call.apply(t,[this].concat(n))||this).txtName=void 0,i.txtDesc=void 0,i.txtPrice=void 0,i.btnBuy=void 0,i.out=void 0,i.rewardScroll=void 0,i}i(e,t);var o=e.prototype;return o.onInit=function(){var t=this;this.txtName=c.findChildComponent(this.node,"title/Label",s),this.txtDesc=c.findChildComponent(this.node,"txtDesc",s),this.txtPrice=c.findChildComponent(this.node,"btnBuy/Label",s),this.out=c.findChild(this.node,"out"),this.btnBuy=c.findChild(this.node,"btnBuy"),this.view.addComponentCallbackListener(this.btnBuy,n.EventType.CLICK,(function(){0==t.data.price?IS(l).send_19_2(t.data.id):IS(m).Pay(t.data.id)}));var i=c.findChildComponent(this.node,"rewardScroll",a);this.rewardScroll=this.view.addUIList(i,G,!1),this.rewardScroll.touchEvent=!1},o.onRender=function(t,i){this.txtName.string=t.name,this.rewardScroll.datas=t.reward;var e=IS(m).GetPayGiftInfo(t.id);0==t.price?(this.txtPrice.string=GetLanguage(200045),e&&2==e.rewardState?(this.out.active=!0,this.btnBuy.active=!1,this.txtDesc.node.active=!1):(this.out.active=!1,this.btnBuy.active=!0,this.txtDesc.node.active=!0,this.txtDesc.string=h.formatStrWithMirrorDeal(GetLanguage(200046),t.buy_times))):(this.txtPrice.string=IS(m).GetPriceString(t.cost_level),0==t.buy_times?(this.out.active=!1,this.btnBuy.active=!0,this.txtDesc.node.active=!1):e&&e.bought_times?e.bought_times>=e.payCfg.buy_times?(this.out.active=!0,this.btnBuy.active=!1,this.txtDesc.node.active=!1):(this.out.active=!1,this.btnBuy.active=!0,this.txtDesc.node.active=!0,this.txtDesc.string=h.formatStrWithMirrorDeal(GetLanguage(200028),t.buy_times-e.bought_times,t.buy_times)):(this.out.active=!1,this.btnBuy.active=!0,this.txtDesc.node.active=!0,this.txtDesc.string=h.formatStrWithMirrorDeal(GetLanguage(200028),t.buy_times,t.buy_times)))},e}(d)),G=function(t){function e(){for(var i,e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return(i=t.call.apply(t,[this].concat(n))||this).itemGridNode=void 0,i.itemGrid=void 0,i}i(e,t);var n=e.prototype;return n.onInit=function(){this.itemGridNode=c.findChild(this.node,"itemGrid"),this.itemGrid=new r(this.view,this.itemGridNode)},n.onRender=function(t,i){this.itemGrid.SetItemId(t[0],t[1])},e}(d);e._RF.pop()}}}));

