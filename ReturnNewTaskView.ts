System.register("chunks:///_virtual/ReturnNewTaskView.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ItemGrid.ts","./UIList.ts","./NodeUtil.ts","./StringUtil.ts","./index57.ts","./ConfigGlobal.ts","./ChapterDataCache.ts","./MessageView.ts","./GuildControl.ts","./MainViewModel.ts","./RoleDataCache.ts","./ActivityDefine.ts","./ReturnControl.ts","./ReturnDataCache.ts","./ReturnDefine.ts","./BaseSubView.ts"],(function(t){"use strict";var e,i,n,o,a,s,r,c,d,l,u,h,f,v,w,p,m,C,g,G,k,b,I;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,n=t.ScrollView,o=t.Label,a=t.RichText,s=t.Button,r=t.js},function(t){c=t.ItemGrid},function(t){d=t.ListItem},function(t){l=t.default},function(t){u=t.default},null,function(t){h=t.ConfigGlobal},function(t){f=t.ChapterDataCache},function(t){v=t.default},function(t){w=t.default},function(t){p=t.MainViewModel},function(t){m=t.RoleDataCache},function(t){C=t.ActivityTaskState},function(t){g=t.default},function(t){G=t.ReturnDataCache},function(t){k=t.ReturnEventDefine,b=t.ReturnTaskType},function(t){I=t.BaseSubView}],execute:function(){i._RF.push({},"a8f82XWQANOEZDsXbhD3zv3","ReturnNewTaskView",void 0);t("default",function(t){function i(){var e;return(e=t.call(this)||this).limitReward={},e.taskList=void 0,e.name="ReturnNewTaskView",e.url="ui/module/return/ReturnNewTaskView",e}e(i,t);var o=i.prototype;return o.onInit=function(){for(var t=0;t<h.back_rare2.length;t++)this.limitReward[h.back_rare2[t]]=!0;var e=this.findChildComponent("container/taskList",n);this.taskList=this.addUIList(e,S)},o.registerUpdateHandler=function(){this.addEvent(k.UpdatReturnTaskInfo,this.OnTaskUpdate,this)},o.onAfterOpen=function(){IS(g).send_return_task_c2s(b.NewReturnTask),this.OnTaskUpdate()},o.onBeforeClose=function(){},o.onDestroy=function(){},o.OnTaskUpdate=function(){for(var t=[],e=configNew_server_meet.getDatas(),i=[],n=0;n<e.length;n++){var o=IS(G).GetReturnTaskInfo(b.NewReturnTask,e[n].id);o?t.push({cfg:e[n],state:o.state,count:o.count}):i.push({cfg:e[n],state:C.Normal,count:0,isLock:!0})}t.sort((function(t,e){return t.state==C.CanGet&&e.state!=C.CanGet?-1:t.state!=C.CanGet&&e.state==C.CanGet?1:t.state!=e.state?t.state-e.state:t.id-e.id}));for(var a=0;a<i.length;a++)t.push(i[a]);this.taskList.datas=t},i}(I));var S=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).txtDesc=void 0,e.btnGet=void 0,e.received=void 0,e.undone=void 0,e.itemGridNode=void 0,e.itemGrid=void 0,e.btnGo=void 0,e.rewardScroll=void 0,e.lockItem=void 0,e.lockTime=void 0,e}e(i,t);var c=i.prototype;return c.onInit=function(){var t=this;this.lockItem=l.findChild(this.node,"lock"),this.lockTime=l.findChildComponent(this.node,"lock/unlockTime",o);var e=l.findChildComponent(this.node,"rewardScroll",n);this.rewardScroll=this.view.addUIList(e,T,!1),this.rewardScroll.virtual=!1,this.txtDesc=l.findChildComponent(this.node,"txtDesc",a),this.received=l.findChild(this.node,"received"),this.undone=l.findChild(this.node,"undone"),this.btnGet=l.findChild(this.node,"btnGet"),this.view.addComponentCallbackListener(this.btnGet,s.EventType.CLICK,(function(){IS(g).send_return_task_reward_c2s(b.NewReturnTask,t.data.cfg.id)})),this.btnGo=l.findChild(this.node,"btnGoto"),this.view.addComponentCallbackListener(this.btnGo,s.EventType.CLICK,(function(){var e=t.data.cfg.access;if(null!=e&&0!=e){var i=configGoods_source.getDataByKey(e);if(IS(f).curChapterId>i.chapter_id){if(""!=i.view)if("MainView"==i.view)IS(p).TryJumpToMainViewPanel(i.openArgs[0],i.openArgs[1],i.openArgs[2]);else{if(("GuildDonateView"==i.view||"SingleEnterView"==i.view)&&!IS(m).HasGuild())return void v.showFlyTip(GetLanguage(200165));if("SingleEnterView"==i.view)IS(w).send_29_21(1);else{var n,o=i.openArgs.slice(0);(n=uiMgr).openView.apply(n,[i.view].concat(o))}}t.view.parentView.close()}}}))},c.onRender=function(t,e){var i=r.formatStr("(<color=b40000>%s</color>/%s)",t.count,t.cfg.condition[2]);t.count>=t.cfg.condition[2]&&(i=r.formatStr("(<color=1aa307>%s/%s</color>)",t.count,t.cfg.condition[2])),this.txtDesc.string=r.formatStr("<b><color=#774B20>%s</color></b>",t.cfg.desc+i),this.rewardScroll.datas=t.cfg.reward,t.state==C.CanGet?(this.received.active=!1,this.undone.active=!1,this.btnGet.active=!0,this.btnGo.active=!1):t.state==C.HadGet?(this.received.active=!0,this.undone.active=!1,this.btnGet.active=!1,this.btnGo.active=!1):(this.received.active=!1,this.undone.active=!1,this.btnGo.active=!0,this.btnGet.active=!1),t.isLock?(this.lockItem.active=!0,this.lockTime.string=u.formatStrWithMirrorDeal(GetLanguage(204671),t.cfg.day-IS(G).returnTaskDay)):this.lockItem.active=!1},i}(d),T=function(t){function i(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).itemGridNode=void 0,e.itemGrid=void 0,e.limit=void 0,e}e(i,t);var n=i.prototype;return n.onInit=function(){this.itemGridNode=l.findChild(this.node,"itemGrid"),this.itemGrid=new c(this.view,this.itemGridNode),this.limit=l.findChild(this.node,"limit")},n.onRender=function(t,e){var i;this.itemGrid.SetItemId(t[0],t[1]),this.limit.active=null!=(i=this.view.limitReward[t[0]])&&i},i}(d);i._RF.pop()}}}));

